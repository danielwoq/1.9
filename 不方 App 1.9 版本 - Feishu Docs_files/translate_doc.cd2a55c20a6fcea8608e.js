(this.webpackJsonp=this.webpackJsonp||[]).push([["translate_doc"],{"/1Vk":function(e,t,n){},"5FHm":function(e,T,C){"use strict";(function(n){C.d(T,"a",function(){return y});var e=C("lwsE"),o=C.n(e),t=C("W8MJ"),a=C.n(t),r=C("a1gu"),s=C.n(r),i=C("Nsbk"),l=C.n(i),c=C("7W2i"),u=C.n(c),d=C("q1tI"),h=C.n(d),g=C("UlbS"),p=C("ybRk"),f=C("SGN9"),m=(C("YrMx"),C("jp/M")),v=C("G8Hj"),b=C("iP/4");function _(e,t){return b.a&&b.a.isLark&&t||e}var y=function(e){function i(e){var t;o()(this,i),(t=s()(this,l()(i).call(this,e))).handleClose=function(){t.setState({visible:!1})};var n=window.innerWidth,a=window.innerHeight,r=n-840<120||a-644<120;return t.state={visible:!1,useMiniSize:r},t}return u()(i,e),a()(i,[{key:"componentDidUpdate",value:function(){this.state.visible||this.showDialog()}},{key:"componentDidMount",value:function(){this.state.visible||this.showDialog()}},{key:"showDialog",value:function(){var e=this;this.getVisible()&&this.setState({visible:!0},function(){e.props.closeUserGuide(v.STEP_TYPES.translate_comment_guide)})}},{key:"getVisible",value:function(){return this.props.userGuideStatus===m.common.StatusMap.loaded&&!Object(f.n)(this.props.userGuide,v.STEP_TYPES.translate_comment_guide)}},{key:"renderHeader",value:function(){return h.a.createElement("div",{className:"translate-feature-tutorial-modal-header"},h.a.createElement("span",{className:"translate-feature-tutorial-modal-header-text"},n("CreationDoc_TranslateView_Comment_Onboarding_Title")))}},{key:"renderTip",value:function(){return h.a.createElement("div",{className:"translate-feature-tutorial-modal-tips"},n("CreationDoc_TranslateView_Comment_Onboarding_Desc"))}},{key:"renderImg",value:function(){var e=this.state.useMiniSize,t={height:e?260:341,margin:"24px ".concat(e?"0":"24px"," 0")};return h.a.createElement("div",{className:"translate-feature-tutorial-modal-img",style:t},h.a.createElement("video",{className:"video-wrap",controls:!1,autoPlay:!0,loop:!0,src:_(n("doc.translate.comment_guide_url"),n("doc.translate.comment_guide_url_oversea"))}))}},{key:"renderFooter",value:function(){return h.a.createElement("div",{className:"translate-feature-tutorial-modal-footer"},h.a.createElement(g.Button,{type:"primary",className:"translate-feature-tutorial-modal-footer-primary",onClick:this.handleClose},n("CreationDoc_TranslateView_Comment_Onboarding_GotIt_Button")))}},{key:"render",value:function(){var e=this.state,t=e.visible,n=e.useMiniSize;return t?h.a.createElement(p.a,{visible:t,footer:null,width:n?614:840,title:null,className:"translate-feature-tutorial-modal",bodyClassName:"feature-tutorial-dialog",closeClassName:"feature-tutorial-close",onClose:this.handleClose,maskClick:!1,center:!0},this.renderHeader(),this.renderTip(),this.renderImg(),this.renderFooter()):null}}]),i}(h.a.Component)}).call(this,C("2vAP"))},"9ajS":function(e,t,n){"use strict";var a=n("lSNA"),_=n.n(a),r=n("J4zp"),y=n.n(r),i=n("o0o1"),g=n.n(i),o=n("yXPU"),s=n.n(o),l=n("lwsE"),u=n.n(l),c=n("W8MJ"),d=n.n(c),h=n("7EGn"),p=n("XIp8"),f=n("TYER"),m=n("UXvI"),T=n("y2sV"),v=n("+om4"),b=function(){function e(){u()(this,e),this._deltas={}}return d()(e,[{key:"get",value:function(e){return this._deltas[e]}},{key:"set",value:function(e,t){return this._deltas[e]=t,this}},{key:"delete",value:function(e){return delete this._deltas[e],this}},{key:"each",value:function(e){for(var t=0,n=Object.entries(this._deltas);t<n.length;t++){var a=y()(n[t],2),r=a[0];e(a[1],r)}}}]),e}(),C=function(){function a(e){u()(this,a),this.zoneType=T.F.Content,this.ops=[];var t=e.zoneId,n=e.ops;this.zoneId=t,n&&0<n.length&&(this.ops=n)}return d()(a,[{key:"delete",value:function(e){return e<=0?this:this.push({delete:e})}},{key:"retain",value:function(e){return e<=0?this:this.push({retain:e})}},{key:"insert",value:function(e){return this.push({insert:e})}},{key:"getLastOp",value:function(){return this.ops[this.ops.length-1]}},{key:"push",value:function(e){var t=this.getLastOp();return t?k(e)&&k(t)?t.delete+=e.delete:O(e)&&O(t)?t.retain+=e.retain:this.ops.push(e):this.ops.push(e),this}},{key:"chop",value:function(){var e=this.getLastOp();return e&&e.retain&&this.ops.pop(),this}}]),a}();function O(e){return"number"==typeof e.retain}function k(e){return"number"==typeof e.delete}function E(e){var i=e.previous,t=e.deltaSet,o=e.current,s=e.changes,l=new b;return t.forEach(function(e){var t,n,a,r=e.zoneId;e.zoneType===T.F.Content?(t=i.getZoneState(r),a=(n=o.getZoneState(r))?t?L(r,s):w(n):S(t),l.set(r,a.chop())):l.set(r,e)}),l}function S(e){return new C({zoneId:e.getZoneId()}).delete(e.length())}function w(e){var t=new C({zoneId:e.getZoneId()});return e.getContent().eachLine(function(e){t.insert(e.ops)}),t}function L(e,t){var s=new C({zoneId:e}),l=0,n=t[e];return n&&n.forEach(function(e){var t=e.start,n=e.inserts,a=void 0===n?[]:n,r=e.deletes,i=(void 0===r?[]:r).length,o=t-l;s.retain(o),s.delete(i),l+=i+o,a.forEach(function(e){s.insert(e.getOps())})}),s}function I(a,e){var r=new T.e;return e.each(function(e){var t=e.zoneId,n=e.zoneType===T.F.Content?j(a.getZoneState(t),e):e;r.add(t,n)}),r}function j(i,e){var t=e.zoneId,o=e.ops,s=new T.E({zoneId:t}),l=0,c=-1,u=i.length();return o.forEach(function(e,a){var t,n,r;e.delete?(c+=e.delete,n=t=i.getLine(c).getOffset().end,(o[a+1]&&o[a+1].insert||c===u-1)&&(n=t-1),s.delete(n-l),l=n):e.retain?(c+=e.retain,r=i.getLine(c).getOffset().end,s.retain(r-l),l=r):e.insert&&e.insert.forEach(function(e){var t=e.insert,n=e.attributes;("\n"!==t||o[a+1]&&o[a+1].insert)&&s.insert(t,n)})}),s.chop()}var M=n("2ACu"),x=n("skFV");function D(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};Object(x.v)()&&N("".concat(e," ").concat(t,": "),n);var a=n.rev,r=n.msg,i=n.status,o=n.error,s={rev:a,action:t,status:i,type:n.type,is_stop_apply:n.isStopApply,msg:o?"".concat(r," : ").concat(o.message,"; ").concat(o.stack):r};Object(M.default)("translate_action",s)}function N(e,t){var r=Object.assign({},t);Object.entries(t).forEach(function(e){var t=y()(e,2),n=t[0],a=t[1];a instanceof T.e?r[n]=R(a):a instanceof T.d&&(r[n]=P(a))}),console.log(e,r),r.error&&console.error(r.error)}function P(e){var n={};return e.content.forEach(function(e,t){n[t]={ops:e.content.ops,lines:e.lines}}),n}function R(e){var r={};return Object.entries(e._deltas).map(function(e){var t=y()(e,2),n=t[0],a=t[1];r[n]=a.ops}),r}var B=n("SLjs"),U="[ __TRANS__ originalController ]",F=1e3,H=f.h.NEW_CHANGES,V=f.h.USER_CHANGES,z=f.h.ACCEPT_COMMIT,q=function(){function o(e){var a=this,t=e.docInfo,n=e.onLineChangeCb,r=e.sync,i=e.onStatusChangeCb;u()(this,o),this._stopApply=!1,this.handleNewChanges=function(e){a.currentRev=e.note_revision;var t=Object(T.M)(e.zone_changesets,e.apool);a.setRemoteDelta(a.remoteDelta?a.remoteDelta.compose(t):t),a.checkAndApplyTimer()},this.handleAcceptCommit=function(e){var t;a.currentRev=e.note_revision,a.submittedDelta&&(t=a.remoteDelta?a.remoteDelta.compose(a.remoteDelta.transform(a.submittedDelta,!0)):a.submittedDelta,a.setRemoteDelta(t),a.setSubmittedDelta()),a.checkAndSendToRemote(),a.checkAndApply()},this.checkAndApply=function(){var e=a._stopApply,t=a.remoteDelta;if(D(U,"check_apply",Object.assign({},t,{rev:a.currentRev,isStopApply:e})),!e&&t){a.userDelta&&a.setUserDelta(t.transform(a.userDelta)),a.submittedDelta&&a.setSubmittedDelta(t.transform(a.submittedDelta)),a.setRemoteDelta(),t.forEach(function(e,t){var n=e.zoneType;a.contentState.getZoneState(t)||n!==T.F.Content||a.contentState.addZone(t)});try{a.translatorRev=a.currentRev,a.contentState.apply(t)}catch(e){a.onStatusChangeCb(B.d.SYNC_FAIL,{msg:"origin contentState apply error",error:e})}}},this.checkAndApplyTimer=Object(m.default)(this.checkAndApply,F,{leading:!1}),this.onContentStateChange=function(e){try{var t=E(e);D(U,"content_change",Object.assign({},e,{rev:a.currentRev,lineDeltaSet:t})),a.onLineChangeCb(t,a.currentRev)}catch(e){a.onStatusChangeCb(B.d.SYNC_FAIL,{msg:"origin delta transform lineDelta error",error:e})}},this.token=t.token,this.currentRev=t.rev,this.translatorRev=t.rev,this.onLineChangeCb=n,this.onStatusChangeCb=i,this.contentState=Y(t.contentState),this.contentState.onChange(this.onContentStateChange),this.sync=r,this.sync.on(H,this.handleNewChanges),this.sync.on(z,this.handleAcceptCommit),D(U,"origin_init",{rev:t.rev})}return d()(o,[{key:"destroy",value:function(){this.sync.off(H,this.handleNewChanges),this.sync.off(z,this.handleAcceptCommit),this.onLineChangeCb=void 0}},{key:"performAttrsAtLine",value:function(e,t,n){D(U,"perform_attr",{zone:e,lineNumber:t,attrs:n,rev:this.currentRev,isStopApply:this._stopApply});try{var a=n.reduce(function(e,t){var n=y()(t,2),a=n[0],r=n[1];return e[a]=r,e},{}),r=this.contentState.getZoneState(e).getLine(t),i=r.getOffset(),o=i.start,s=i.end,l=new T.E({zoneId:e}),c=r.hasLineMarker()?o+1:o,u=!0;l.retain(c),l.retain(s-c-(u?1:0),a);var d=new T.e(_()({},l.zoneId,l)),h=this.userDelta||K();this.setUserDelta(h.compose(d)),this.checkAndSendToRemote()}catch(e){this.onStatusChangeCb(B.d.COMMENT_FAIL,{msg:"origin perform_attr error",error:e})}}},{key:"setSubmittedDelta",value:function(e){this.submittedDelta=e||void 0}},{key:"setRemoteDelta",value:function(e){this.remoteDelta=e||void 0}},{key:"setUserDelta",value:function(e){this.userDelta=e||void 0}},{key:"checkAndSendToRemote",value:function(){var e,n,a,o,t,r,i,s=this;!this.submittedDelta&&this.userDelta&&(this.setSubmittedDelta(this.userDelta),e=this.userDelta,this.setUserDelta(),n=e.deltas,a={},o=new v.AttributePool,Object.keys(n).forEach(function(e){var t=s.contentState.getZoneState(e).lines.map(function(e){return e.getModelText()}).join("");a[e]=t,n[e].ops.forEach(function(e){if(e.attributes)for(var t=0,n=Object.entries(e.attributes);t<n.length;t++){var a=y()(n[t],2),r=a[0],i=a[1];o.putAttrib([r,i])}})}),t=Object(T.O)({deltaSet:e,apool:o,texts:a}),r=Object(v.formatCs)(t),i={type:V,baseRev:this.translatorRev,changeset:r[0]||"",zone_changesets:r,apool:o.toJsonableNoCloning(),uuid_v4:Z(),retryTimes:0,token:this.token,member_id:Number(this.sync.memberId),user_ticket:this.sync.io.getTicket(),user_id:window.User.id},this.sync.sendMessage(i.type,i))}},{key:"suspendApply",value:function(){this._stopApply=!0}},{key:"resumeApply",value:function(){this._stopApply=!1,this.checkAndApplyTimer()}}]),o}();function W(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function Z(){var e=(new Date).getTime();return W()+"-"+e}function K(){return new T.e({0:new T.E({zoneId:"0"})})}function Y(e){var t=e.schema,n=e.getContent(),a=new T.e;return n.forEach(function(e,t){a.add(t,e.getContent())}),new T.d({deltaSet:a,schema:t})}var J,Q,X=n("SA+Z"),$=n.n(X),ee=n("RIqP"),te=n.n(ee),ne=n("owWc"),ae=n("FJEn"),re=n("7SOz"),ie=n("HIeq"),oe=n("2spZ"),se=n("H6oK"),le=n("nN3d"),ce=n("toa8"),ue=n("vEhQ"),de="temp_guid",he=function(){function e(){u()(this,e),this.dataMap=_()({},de,{heading:!1,not_need_translate:!0,line_attribs:[]}),this.zoneGuidMap={}}return d()(e,[{key:"addZone",value:function(e){Object(ue.a)(this.zoneGuidMap,[e],[de])}},{key:"eachGuid",value:function(n){for(var a=this,e=function(){var e=y()(i[r],2),t=e[0];e[1].forEach(function(e){n(e,a.getData([e]),t)})},r=0,i=Object.entries(this.zoneGuidMap);r<i.length;r++)e()}},{key:"getGuids",value:function(e){return this.zoneGuidMap[e]}},{key:"getData",value:function(e){return Object(h.default)(this.dataMap,e)}},{key:"updateData",value:function(e,t){Object(ue.a)(this.dataMap,e,t)}},{key:"insertLine",value:function(e,t,n,a){var r=Object(h.default)(this.zoneGuidMap,[e],[]);r.splice(t,0,n),Object(ue.a)(this.zoneGuidMap,[e],r),this.updateData([n],a)}},{key:"addLine",value:function(e,t,n){var a=Object(h.default)(this.zoneGuidMap,[e],[]);a.push(t),Object(ue.a)(this.zoneGuidMap,[e],a),this.updateData([t],n)}},{key:"deleteLine",value:function(e,t,n){var a=this,r=this.zoneGuidMap[e];r&&r.splice(t,n).forEach(function(e){e!==de&&delete a.dataMap[e]})}}]),e}(),ge=n("+4eN");(Q=J=J||{}).SUCCESS="success",Q.FAILURE="failure",Q.CANCEL="cancel",Q.FAIL="fail";var pe,fe,me=function(e,t){var n=e.split(" "),a=y()(n,2),r=a[0],i=a[1];return ae.tableIds.getSortedTableCellIdsByTableIdFromVectorReps(t,{rowId:r,colId:i})},ve="origin",be="[ __TRANS__ transfer ]",_e=function(){function l(e){var n=this,t=e.originEditorData,a=e.context,r=e.translateConfig,i=e.requestConfig,o=e.onChange,s=e.matchNotNeedTransData;u()(this,l),this.data=new he,this.translate=function(e){var t=e.translateParams;return t.text_list.length?Object(re.a)(t,ce.d,n.requestConfig):Promise.reject()},this.requestConfig=i,this.context=a,this.displayType=r.display_type,this.srcLang=r.src_lang,this.targetLang=r.target_lang,this.onChangeStatus=o,this.matchNotNeedTransData=s,this.protectedSuppl={A:["dataMetaBlockProps","mention-chatId_","gallery"],B:["mention-link_","mention-token_","mention-type_","mention-uuid_"]},this.setWholeTranslateData(ae.DEFAULT_REP_ZONE,t)}function e(e){return t.apply(this,arguments)}var t,n,a;function r(e){return n.apply(this,arguments)}function i(){return a.apply(this,arguments)}return d()(l,[{key:"resetConfig",value:function(e){this.stopTranslating(),this.targetLang=e.target_lang,this.displayType=e.display_type}},{key:"getOriginalLineText",value:function(e){var t=this.data.getData([e,ve]);return t?Object(re.d)(t):[]}},{key:"getOriginalLineNum",value:function(e,t){return this.data.getGuids(e).indexOf(t)}},{key:"getTranslateLineNum",value:function(e,t){if(this.displayType===B.b.ONLY_TRANSLATION)return t;for(var n=0,a=this.data.zoneGuidMap[e],r=this.data.dataMap,i=0;i<t;i++)n+=r[a[i]][this.targetLang]?2:1;return n}},{key:"setWholeTranslateData",value:function(i,l){var c=this,u=l[i];u&&Object.keys(u).forEach(function(e){var o,s,t=u[e],n=c.generateLineData(t,i),a=n.guid,r=n.lineData;c.data.addLine(i,a,r),t.forEach(function(e){var t=e.attribs,n=Object(ge.i)(t),a=y()(n,2),r=a[0],i=a[1];o=r&&r[1],s=i&&i[1]}),o?me(o,c.context.vectorReps).forEach(function(e){c.setWholeTranslateData(e,l)}):s&&c.setWholeTranslateData(s,l)})}},{key:"translateAllUnTranslateData",value:(a=s()(g.a.mark(function e(){var t,n,a,r,i,o,s,l,c,u,d,h=arguments;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=0<h.length&&void 0!==h[0]?h[0]:new Set,1<(n=1<h.length&&void 0!==h[1]?h[1]:0))return e.abrupt("return",{msg:J.FAILURE,codes:Array.from(t)});e.next=4;break;case 4:if(n)return e.next=7,Object(oe.c)(500*n);e.next=7;break;case 7:if(a=this.getTranslateGroupGuids(),(r=a.unTranslate).length)return i=this.generateTranslateParams(r),o=this.translateRequest=this.translate(i),e.next=13,o;e.next=21;break;case 13:if(s=e.sent,o.cancel_status)return e.abrupt("return",{msg:J.CANCEL});e.next=16;break;case 16:if(l=s.failure_data,c=s.data,u=s.target_lang,d=s.codes,c.text_list.length&&this.generateGuidsFromAILabTranslateData(c,!0,u),l.text_list.length)return d.forEach(function(e){return t.add(e)}),e.abrupt("return",this.translateAllUnTranslateData(t,n+1));e.next=21;break;case 21:return e.abrupt("return",{msg:J.SUCCESS});case 22:case"end":return e.stop()}},e,this)})),i)},{key:"translateWholeData",value:(n=s()(g.a.mark(function e(t){var n;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.resetConfig(t),this.changeTranslateStatus(B.d.LOADING),e.next=4,this.translateAllUnTranslateData();case 4:if((n=e.sent).msg===J.SUCCESS)return e.abrupt("return",{data:this.genWholeTranslateData()});e.next=7;break;case 7:return e.abrupt("return",{codes:n.codes,data:null,msg:n.msg});case 8:case"end":return e.stop()}},e,this)})),r)},{key:"genWholeTranslateData",value:function(){var r=this;return Object(ne.a)(this.data.zoneGuidMap,function(e,t,n){var a=[];return t.forEach(function(e,t){var n=r.genTranslateLineByGuid(e,String(t));return a.push.apply(a,te()(n))}),e[n]=a,e},{})}},{key:"handleOriginEditorChange",value:(t=s()(g.a.mark(function e(t){var n,a,r,i;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.genTempDeltaSet(t),a=n.tempDeltaSet,r=n.changeGuids,this.changeTranslateStatus(B.d.SYNC_LOADING,{guids:r}),e.next=4,this.translateAllUnTranslateData();case 4:if((i=e.sent).msg===J.SUCCESS)return e.abrupt("return",{lineDeltaSet:this.genRealDeltaSet(a)});e.next=7;break;case 7:return e.abrupt("return",{msg:"transfer request error: ".concat(i.msg),codes:i.codes});case 8:case"end":return e.stop()}},e,this)})),e)},{key:"genRealDeltaSet",value:function(i){var o=this;return i.each(function(e,t){var n,a=e.zoneType,r=e.ops;a===T.F.Content&&(n=new C({zoneId:t}),r.forEach(function(e){e.delete?n.delete(e.delete):e.retain?n.retain(e.retain):e.insert&&o.genLinesOps(e.insert).forEach(function(e){n.insert(e)})}),i.set(t,n))}),i}},{key:"genLinesOps",value:function(e){var n=this;return this.genTranslateLineByGuid(e).reduce(function(e,t){return e.push(n.translateLineToOps(t)),e},[])}},{key:"translateLineToOps",value:function(e){var t=e.reduce(function(e,t){var n=t.text,a=t.attribs.reduce(function(e,t){return e[t[0]]=t[1],e},{});return e.push({insert:n,attributes:a}),e},[]);return t.push({insert:"\n"}),t}},{key:"genTempDeltaSet",value:function(a){var d=this,h=[];return a.each(function(e,l){var c,u,t=e.zoneType,n=e.ops;t===T.F.Content&&(c=new C({zoneId:l}),d.data.getGuids(l)||d.data.addZone(l),u=0,n.forEach(function(e){var t,n,a,r,i,o,s;e.delete?(n=(t=d.calculateLineDistance(l,u,u+e.delete)).distance,a=t.centerGuids,h.push.apply(h,te()(a)),c.delete(n),d.data.deleteLine(l,u,e.delete)):e.retain?(r=d.calculateLineDistance(l,u,u+e.retain).distance,c.retain(r),u+=e.retain):e.insert&&(o=(i=d.generateLineData(e.insert,l)).guid,s=i.lineData,d.data.insertLine(l,u,o,s),c.insert(o),u++)}),a.set(l,c))}),{tempDeltaSet:a,changeGuids:h}}},{key:"calculateLineDistance",value:function(e,t,n){for(var a=0,r=this.data.getGuids(e),i=[],o=t;o<n;){var s=r[o];i.push(s);a=this.data.getData([s]).not_need_translate||this.displayType===B.b.ONLY_TRANSLATION?a+1:a+2;o++}return{distance:a,centerGuids:i}}},{key:"generateLineData",value:function(e,t){var n="id-".concat(Object(ie.b)()),u=[["translate-guid",n]],a=e.reduce(function(e,t,n){var a=t.text||t.insert;if(void 0===a&&console.error(be,"generateLineData text is undefined",t),""===(a=a.split("\n")[0]))return e;var r=t.attribs||Object.entries(t.attributes||{}),i=!a.replace(/\*/g,"").length;if(0===n&&i){var o=Object(ge.i)(r),s=y()(o,2),l=s[0],c=s[1];if(!l&&!c)return u.push.apply(u,te()(r.filter(function(e){var t=y()(e,1)[0];return["translate","translate-guid"].indexOf(t)<0}))),e}return e.push({text:a,attribs:r}),e},[]);1===u.length&&u.push(["lmkr","1"]);var r=Object(re.c)(a),i=r.text,o=r.suppl,s=this.matchNotNeedTransData({text:i,suppl:o,line_attribs:u,zoneId:t});return{guid:n,lineData:_()({zone_id:t,line_attribs:u,not_need_translate:s},ve,{text:i,suppl:Object.assign({},o,_()({},n,[[0,Math.max(0,i.length-1)]]))})}}},{key:"genTranslateLineByGuid",value:function(e,t){var n=this.data.getData([e]),a=n[ve],r=n[this.targetLang],i=n.zone_id,o=n.line_attribs,s=Object.assign({},a,{guid:e,zone_id:i,line_attribs:o});t&&(s.line_num=t);var l=this.generateTranslateTexts(s);if(!r)return[l];var c,u,d,h=Object.assign({},s,{},r);this.displayType===B.b.WITH_ORIGINAL&&(u=(c=this.generateWithOriginalSuppl(h)).newSuppl,d=c.newLineAttribs,h.suppl=u,h.line_attribs=[].concat(te()(h.line_attribs),te()(d)));var g=this.generateTranslateTexts(h);return this.displayType===B.b.ONLY_TRANSLATION?[g]:[l,g]}},{key:"generateTranslateTexts",value:function(e){var t=e.text,n=e.suppl,a=e.line_attribs,r=Object.assign({},n),i=this.findIdSuppl(n);i&&delete r[i];var o=Object(re.d)({text:t,suppl:r});return 0<a.length&&o.unshift({text:"*",attribs:te()(a)}),o}},{key:"generateWithOriginalSuppl",value:function(e){var t=e.zone_id,n=e.line_num,a=e.suppl,r=e.line_attribs,i=[["translate","true"]],s=Object.assign({},a);"0"===n&&t===ae.DEFAULT_REP_ZONE&&(r.some(function(e){var t=y()(e,2),n=t[0];t[1];return/^heading/.test(n)})||i.push(["heading","h1"]));var o=this.filterInlineBlockSuppl(a);return o.length&&o.forEach(function(e){var t,n=e.split(","),a=$()(n),r=a[0],i=a.slice(1).join(","),o=Object(se.getBlockPropsFromAttributesMap)(_()({},r,i));o&&(o.blockId=Object(le.a)(),t="".concat(r,",").concat(JSON.stringify(o)),s[t]=s[e],delete s[e])}),{newLineAttribs:i,newSuppl:s}}},{key:"findIdSuppl",value:function(e){return Object.keys(e).find(function(e){return/^id-/.test(e)})}},{key:"filterInlineBlockSuppl",value:function(e){return Object.keys(e).filter(function(e){return/^dataMetaBlockProps/.test(e)&&/displayMode\"\:\"inline\"/.test(e)})}},{key:"stopTranslating",value:function(){Object(h.default)(this.translateRequest,"cancel",function(){return null})()}},{key:"generateGuidsFromAILabTranslateData",value:function(e){var i=this,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],s=2<arguments.length?arguments[2]:void 0,l=e.text_list,c=e.suppl,u=[],d=[],h=c.map(function(e){return i.findIdSuppl(e)});return this.data.eachGuid(function(t,e){var n,a=e.not_need_translate,r=h.findIndex(function(e){return e===t});-1!==r||a?a||(n={text:l[r],suppl:c[r]},u.push(t),o&&i.data.updateData([t,s],n)):d.push(t)}),{translateGuids:u,unTranslateGuids:d}}},{key:"generateTranslateParams",value:function(e){var n=this,a=[],r=[];return e.forEach(function(e){var t=n.data.getData([e])[ve];a.push(t.text),r.push(t.suppl)}),{translateParams:{protected_suppl:this.protectedSuppl,src_lang:this.srcLang,target_lang:this.targetLang,text_list:a,suppl:r},guids:e}}},{key:"getTranslateGroupGuids",value:function(){var n=this,a=[];return this.data.eachGuid(function(e,t){t.not_need_translate||t[n.targetLang]||a.push(e)}),{unTranslate:a}}},{key:"changeTranslateStatus",value:function(e,t){this.onChangeStatus(e,t)}}]),l}(),ye=n("AW8B"),Te=n("QILm"),Ce=n.n(Te),Oe=n("a1gu"),ke=n.n(Oe),Ee=n("Nsbk"),Se=n.n(Ee),we=n("iWIM"),Le=n.n(we),Ie=n("7W2i"),je=n.n(Ie),Ae=n("5gS9"),Me=n("f9b/"),xe=n("77Gt"),De=n("QM+C"),Ne=1e3,Pe=2;(fe=pe=pe||{}).USER_NEWINFO="USER_NEWINFO",fe.USER_LEAVE="USER_LEAVE",fe.ROOM_MEMBERS="ROOM_MEMBERS",fe.USER_CHANGES="USER_CHANGES",fe.MESSAGE_CHANNEL="MESSAGE_CHANNEL";var Re=function(e){function r(e,t){var a;u()(this,r),(a=ke()(this,Se()(r).call(this,{io:Ae.b.getInstance(),token:e,type:f.d.DOC,requestMessageOptions:{version:Pe},registerChannels:function(e){return _()({},Me.a,new f.f(e,{fetchMemberList:function(){return e.fetchMemberInfos()},shouldFetchMemberList:function(){return Object(xe.d)(f.d.DOC,e.token).length<150}}))},logger:{log:M.default}}))).missVersionLimit=Ne,a.fetchMemberInfos=function(){return Object(xe.b)(a.memberId,a.token,De.NUM_SUITE_TYPE.DOC)},a.handleMembersMessageData=function(e){var t=e.count,n=e.members;Object(xe.f)("doc",Object.assign(e,{token:a.token,members:a.assignMemberInfo(e,n),count:t}))},a.handleUserNewInfo=function(e){var t=e.entities,n=Ce()(e,["entities"]),a=Object(h.default)(t,"users",{}),r=Object.assign(n,a[n.user_id],{count:t.users_count});Object(xe.j)("doc",r)},a.handleUserLeave=function(e){Object(xe.i)("doc",e)};var n=a.channels[Me.a];return n.on(f.h.ROOM_MEMBERS,a.handleMembersMessageData),n.on(f.h.USER_NEWINFO,a.handleUserNewInfo),n.on(f.h.USER_LEAVE,a.handleUserLeave),a.on(f.h.ACCEPT_WATCH,a.fetchMemberInfos),a.setClientVars(t),a}return je()(r,e),d()(r,[{key:"getVersionOfOversize",value:function(e){return e.note_version}},{key:"getVersionOfChangeset",value:function(e){return e.note_revision}},{key:"getChangesets",value:function(e){return e.changeset_list}},{key:"isSelfChangeset",value:function(e){return!1}},{key:"getVersionOfClientVars",value:function(e){return e.collab_client_vars.rev}},{key:"getVersionOfAcceptCommit",value:function(e){return e.note_revision}},{key:"assignMemberInfo",value:function(e,t){var n=Object(h.default)(e,"entities.users",{}),a=Object.assign(t);return a.forEach(function(e){e=Object.assign(e,n[e.suid||e.user_id])}),a}},{key:"destroy",value:function(){Le()(Se()(r.prototype),"destroy",this).call(this),Object(xe.g)("doc",this.token)}},{key:"sendMessage",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e!==f.h.USER_CHANGES)return Promise.reject(new Error("not support"));var n=Object(h.default)(window,"current_space_wiki.space_id",0);return this.sendUserChange(Object.assign({type:e,token:this.token},t,{},n?{wiki_space_id:n}:{}))}}]),r}(f.j),Be=n("OX8E"),Ue=n("sLU5"),Ge=n("4udo"),Fe=n("kESg");n.d(t,"a",function(){return Ve});var He="[ __TRANS__ Controller ]",Ve=function(){function c(e){var s=this,t=e.token,n=e.originEditor,a=e.translateConfig,r=e.changeCbk;u()(this,c),this.enable=Object(ye.e)(),this.matchNotNeedTransData=function(e){var t=e.text,n=e.line_attribs,a=e.suppl,r=e.zoneId,i=/list-code|aceTable/,o=new RegExp("aceTable,|".concat(Fe.k.ZoneType,","));return Object(ge.n)(s.originEditor||s.translateEditor,r)===Fe.l.CodeBlock||0===t.trim().length||n.some(function(e){return i.test(e.join("-"))})||o.test(Object.keys(a).join(""))},this.initTransfer=function(e){var t=[0,s.originEditor.getContentState().getZoneState(ae.DEFAULT_REP_ZONE).length()-1],n=s.originEditor.translator.getTranslationData(t),a=n.translationData,r=n.context;s.transferData=new _e({originEditorData:a,context:r,translateConfig:e,requestConfig:ye.f,onChange:s.onTransferStatusChange,matchNotNeedTransData:s.matchNotNeedTransData})},this.handleOriginModelLineChange=function(e,r){s.originModel.suspendApply(),s.readyPromise=s.transferData.handleOriginEditorChange(e).then(function(e){var t=e.lineDeltaSet,n=e.msg,a=e.codes;t?(s.applyToTranslate(t,r),s.changeStatus(B.d.SYNC_FINISH,{title:s.getTranslateTitle()}),s.originModel.resumeApply()):s.changeStatus(B.d.SYNC_FAIL,{msg:"transfer request error: ".concat(n),codes:a})}).catch(function(e){s.changeStatus(B.d.SYNC_FAIL,{msg:"transfer genDelta error: ".concat(e.message),error:e})})},this.applyToTranslate=function(e,t){var a=s.translateEditor.getContentState();e.each(function(e,t){var n=e.zoneType;a.getZoneState(t)||"Z"!==n||a.addZone(t)}),s.fixCommentAttr(e,a);var n=I(a,e);try{D(He,"apply_to_translator",{deltaSet:n,rev:t}),a.apply(n,{preventScrolling:!0})}catch(e){return s.changeStatus(B.d.SYNC_FAIL,{msg:"apply to translator error",error:e,deltaSet:n,rev:t})}},this.onTransferStatusChange=function(e,t){s.changeStatus(e,t)},this.onOriginalModelStatusChange=function(e,t){s.changeStatus(e,t)},this.handleSyncEvent=function(e){var t,n=e.data||{},a=n.type,r=n.payload;a&&(0!==ze.indexOf(a)&&Be.a.trigger(Ue.a.PC.DOCS.SYNC_NOTE_META,[n]),s.translateEditor&&(t="handleClientMessage_".concat(a),s.translateEditor.hook.callAll(t,{payload:r,msg:n,evt:e})))};var i=n.plugins.client.rev,o=Object.assign({},n.getClientVars(),{rev:i}),l=n.getContentState();this.originInfo={token:t,rev:i,contentState:l,clientVars:o},this.originEditor=n,this._changeCbk=r,this.initTransfer(a)}function e(e){return t.apply(this,arguments)}var t;return d()(c,[{key:"destroy",value:function(){this.sync&&(this.sync.off(f.h.MESSAGE,this.handleSyncEvent),this.sync.destroy())}},{key:"performAttributes",value:function(e,t,n){var a,r;this.enable&&this.translateEditor&&(a=Object(Ge.b)(t,this.translateEditor),-1!==(r=this.transferData.getOriginalLineNum(e,a))?this.originModel.performAttrsAtLine(e,r,n):D(He,"perform_attr_not_found_lineNum",{zone:e,guid:a}))}},{key:"startTranslate",value:(t=s()(g.a.mark(function e(t){var n,a,r,i,o,s;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.originModel&&this.originModel.suspendApply(),e.next=3,this.transferData.translateWholeData(t);case 3:if(n=e.sent,a=n.data,r=n.codes,i=void 0===r?[]:r,o=n.msg,a){e.next=11;break}return this.changeStatus(B.d.FAIL,{codes:i,msg:"startTranslate error:"+o}),e.abrupt("return");case 11:s=this.getTranslateClientVars(a,this.getContext()),this.changeStatus(B.d.FINISH,{initClientVar:s});case 13:case"end":return e.stop()}},e,this)})),e)},{key:"setTranslateEditor",value:function(e){this.translateEditor=e;var t=this.originInfo,n=t.token,a=t.rev;Object(h.default)(this.originEditor,"plugins.client.sync")&&this.originEditor.plugins.client.destory(),this.sync||(this.sync=new Re(n,a),this.sync.on(f.h.MESSAGE,this.handleSyncEvent),this.setOriginModel(this.originInfo)),this.changeStatus(B.d.MOUNT,{title:this.getTranslateTitle()}),this.originEditor=null,this.originModel&&this.originModel.resumeApply()}},{key:"setOriginModel",value:function(e){this.enable&&(this.originModel=new q({docInfo:e,onLineChangeCb:this.handleOriginModelLineChange,sync:this.sync,onStatusChangeCb:this.onOriginalModelStatusChange}))}},{key:"waitForReady",value:function(){return this.readyPromise||Promise.resolve()}},{key:"fixCommentAttr",value:function(e,b){e.each(function(e,t){var n=e.zoneType,a=e.ops,r=b.getZoneState(t);if(r&&"Z"===n)for(var i=0,o=0;o<a.length;o++){var s=a[o];if("retain"in s)i+=s.retain;else if("delete"in s){var l=s.delete;if(1<l)return;for(var c=0;c<l;c++){var u=r.getLine(i);if(!u)return;var d=u.getAttributes(0,2).find(function(e){var t=y()(e,2),n=t[0];t[1];return/clientside-comment-local-id/.test(n)});if(d&&a[o+1]&&"insert"in a[o+1]){var h=a[o+1].insert,g=new T.E({ops:h}),p=h.reduce(function(e,t){return e+t.insert.length},0),f=!!h[0].attributes&&h[0].attributes.lmkr?1:0,m=h[h.length-1].insert||"",v=p-f-("\n"===m[m.length-1]?1:0);return void(a[o+1].insert=g.compose((new T.E).retain(f).retain(v,_()({},d[0],d[1]))).ops)}i+=1}}}})}},{key:"changeStatus",value:function(e,t){this.status=e,D(He,"change_status",Object.assign({},t,{status:e})),this._changeCbk(e,t)}},{key:"getTranslateClientVars",value:function(e,t){var n=this.originInfo.clientVars,a=(this.originEditor||this.translateEditor).translator.translationDataToClientVars({translationData:e,context:t}),r=a.initialAttributedTexts,i=a.apool;return Object.assign({},n,{initialAttributedTexts:r,apool:i,time:(new Date).getTime()})}},{key:"getOriginalLineText",value:function(e){return this.transferData.getOriginalLineText(e)}},{key:"getTranslateTitle",value:function(){return this.translateEditor.getContentState().getZoneState(ae.DEFAULT_REP_ZONE).getLine(0).getText().trim()}},{key:"getContext",value:function(){var t=this;if(!this.translateEditor)return this.transferData.context;var n=this.translateEditor.vectorReps,a={vectorReps:{},numToAttribs:{}},r=this.translateEditor.getRep(ae.DEFAULT_REP_ZONE).apool,e=Object.keys(n);return e.length&&(a.vectorReps=Object(p.default)(n),e.forEach(function(e){n[e].alines.forEach(function(e){t.translateEditor.changesetHelper.eachAttribNumber(e,function(e){var t=r.getAttribKey(e),n=r.getAttribValue(e);a.numToAttribs[e]=[t,n]})})})),a}}],[{key:"getInstance",value:function(e){return!this.instance&&e&&(this.instance=new c(e),D(He,"init")),this.instance}},{key:"destroy",value:function(){this.instance&&this.instance.destroy(),this.instance=null,D(He,"destroy")}}]),c}(),ze=[f.h.ACCEPT_COMMIT,f.h.USER_CHANGES]},BKLJ:function(e,t,n){"use strict";var a=n("lwsE"),r=n.n(a),i=n("W8MJ"),o=n.n(i),s=n("a1gu"),l=n.n(s),c=n("Nsbk"),u=n.n(c),d=n("7W2i"),h=n.n(d),g=n("cDf5"),p=n.n(g),f=n("q1tI"),m=n.n(f),v=n("4PSP"),b=n("RIqP"),_=n.n(b),y=n("nMtL"),T=n("KhPb"),C=n("DCy2"),O=n("0Hpa"),k=n("njD1"),E=n("5Ucn"),S=n("A9Q4"),w=n("IcLG"),L=n("46iY"),I=n("WtIE"),j=n("TBry"),M=n("ZuTZ"),x=n("CXkg"),D=n("SLR9"),N=n("nyf+"),P=n("k8MZ"),R=n("Kboj"),B=n("uGsk"),U=n("AiBH"),F=n("mRaX"),H=n("jJw9"),V=n("PyL4"),z=n.n(V),q=n("rLED"),W=function(){function t(e){r()(this,t),e&&(this.editor=e,this.addMentionCls())}return o()(t,[{key:"addMentionCls",value:function(){var e;Object(q.G)()&&(e=this.editor.getDocBody(),Object(F.a)(e))}},{key:"aceAttribsToClasses",value:function(e,t){var n=t.key,a=t.value;return-1<["mention-type","mention-link","mention-token","mention-id","mention-tempId","mention-chatId"].indexOf(n)?"".concat(n,"_").concat(a):/mention/.test(n)||/at-(.+)/.test(n)?n:[]}},{key:"aceCreateDomLine",value:function(e,t){var n,a,r,i,o,s,l,c,u=t.spanClass;/mention-token/.test(u)&&(a=(n=Object(F.e)(u)).type,i=(r=n.link)&&decodeURIComponent(r)||"",-1<[U.E.USER,U.E.CHAT,U.E.GROUP].indexOf(Number(a))||(s=Object(H.parseAnchorUrl)(i).isCurDocAnchor,l=z.a.escapeHTMLAttribute(i),c=s?'<a href="javascript:void(0);" data-href="'.concat(l,'"\n          rel="noopener noreferrer" contenteditable="false">'):'<a href="'.concat(l,'" data-href="').concat(l,'"\n          rel="noopener noreferrer" target="_blank" contenteditable="false">'),t.spanClass+=" mention",o="</a>",t.extraOpenTags="".concat(t.extraOpenTags).concat(c),t.extraCloseTags="".concat(o).concat(t.extraCloseTags)))}}]),t}(),Z=n("H6oK"),K=n("Hj9z"),Y=n("OX8E"),J=n("Kwn9"),Q=n("EBUI"),X=n("gBrI"),$=n("BkG1"),ee=Object(Z.Commentable)(Z.BlockPlugin);function te(e){var t=new ee({editor:e,blockManager:new Z.BlockManager([new K.AtUserCreator({ExternalServices:J.a.AtUserCreator}),new K.ReminderCreator({ExternalServices:J.a.ReminderCreator(Y.a)})]),defaultSupportModules:new Map([].concat(_()(Object(Z.getAllDisableModulesConfig)()),[[Z.PermissionModule,!0],[Z.LoadingModule,!0]]))});return[new y.default(e),new T.a(e),new C.a(e),new M.a(e),x.b,new O.a(e,{hasCollapse:!0}),new k.a(e),new E.HyperLinks({editor:e}),new S.a(e),new w.a(e),new L.b(e),new I.b(e),new j.b(e),new Q.a({editor:e,adaptor:new X.a}),new D.b(e),N.a,t,new R.a(e),new W(e),new P.a(e)].concat(_()(Object($.a)(e)))}Object(B.a)();var ne=n("FJEn"),ae=n("4O8T"),re=n.n(ae);n.d(t,"a",function(){return oe});var ie=function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":p()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(o=(i<3?r(o):3<i?r(t,n,o):r(t,n))||o);return 3<i&&o&&Object.defineProperty(t,n,o),o},oe=function(e){function t(){return r()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),o()(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.lines;e.lines!==t&&this.performLine(t)}},{key:"componentWillUnmount",value:function(){this.editor&&(this.editor=null)}},{key:"performLine",value:function(e){if(this.editor){var t=this.editor.getRep("0").alines.length;try{this.editor.translator.spliceTranslationData("0",0,t,e)}catch(e){console.error("editor perform lines fail",e)}}}},{key:"render",value:function(){var t=this,e=this.props.copyable;return m.a.createElement(ne.EditorReact,{registerPlugin:te,idleWorkTimer:!1,onMount:function(e){t.editor=e.editor},copyable:e,editable:!1,bus:new re.a})}}]),t}(f.PureComponent);ie([Object(v.Bind)()],oe.prototype,"performLine",null)},BnfA:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a="COMMON_TRANSLATE"},C7G7:function(e,t,n){},Pihw:function(e,t,n){},"Qm/3":function(e,T,C){"use strict";(function(a){C.d(T,"a",function(){return y});var e=C("lwsE"),n=C.n(e),t=C("W8MJ"),r=C.n(t),i=C("a1gu"),o=C.n(i),s=C("Nsbk"),l=C.n(s),c=C("7W2i"),u=C.n(c),d=C("cDf5"),h=C.n(d),g=C("q1tI"),p=C.n(g),f=C("fco7"),m=C("UlbS"),v=C("4PSP"),b=C("Z8fA"),_=(C("C7G7"),function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":h()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(o=(i<3?r(o):3<i?r(t,n,o):r(t,n))||o);return 3<i&&o&&Object.defineProperty(t,n,o),o}),y=function(e){function t(){return n()(this,t),o()(this,l()(t).apply(this,arguments))}return u()(t,e),r()(t,[{key:"handleOpenSettingModal",value:function(){this.props.openSettingModal({source:"guide"})}},{key:"handleTranslate",value:function(){this.props.onTranslate()}},{key:"handleClose",value:function(){this.props.onClose()}},{key:"handleRemove",value:function(){this.props.onRemove()}},{key:"render",value:function(){var e=this.props,t=e.translateConfig,n=e.autoTranslateEnabled;return p.a.createElement("div",{className:"translate-quick-entry"},p.a.createElement("div",{className:"translate-quick-entry__rectangle"}),p.a.createElement("div",{className:"translate-quick-entry__card"},p.a.createElement("div",{className:"translate-quick-entry__title"},p.a.createElement("span",null,a("common.translate_quick_entry_title",f.a.getText(t.target_lang))),p.a.createElement(b.a,{onClick:this.handleRemove,className:"translate-quick-entry__remove"})),p.a.createElement("div",{className:"translate-quick-entry__body"},p.a.createElement("span",{onClick:this.handleOpenSettingModal},n?a("common.translate_quick_entry_setting"):"")),p.a.createElement("div",{className:"translate-quick-entry__footer right"},p.a.createElement(m.Button,{prefixCls:"cp-btn",onClick:this.handleClose},a("common.translate_quick_entry_dont_show_again")),p.a.createElement(m.Button,{prefixCls:"cp-btn",type:"primary",onClick:this.handleTranslate},a("common.ai_translate")))))}}]),t}(g.PureComponent);_([Object(v.Bind)()],y.prototype,"handleOpenSettingModal",null),_([Object(v.Bind)()],y.prototype,"handleTranslate",null),_([Object(v.Bind)()],y.prototype,"handleClose",null),_([Object(v.Bind)()],y.prototype,"handleRemove",null)}).call(this,C("2vAP"))},YrMx:function(e,t,n){},Z8fA:function(e,t,n){"use strict";var a=n("pVnL"),r=n.n(a),i=n("QILm"),o=n.n(i),s=n("q1tI"),l=n.n(s);t.a=function(e){e.styles;var t=o()(e,["styles"]);return l.a.createElement("svg",r()({width:"11",height:"11",viewBox:"0 0 11 11"},t),l.a.createElement("path",{d:"M5.5 4.8L1.35.64a.5.5 0 00-.7.7L4.79 5.5.65 9.65a.5.5 0 00.7.7L5.5 6.21l4.15 4.14a.5.5 0 00.7-.7L6.21 5.5l4.14-4.15a.5.5 0 00-.7-.7L5.5 4.79z"}))}},aBXQ:function(e,t){e.exports='<div class="comment-number" style="{{{style}}}">\n    <div class="comment-number__text">{{{number}}}</div>\n</div>'},atwd:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("7EGn"),i=n("H6oK"),o=n("KJZc");function a(e){var t,n=0,a=0;return o.a&&(t=Object(o.a)(e),n=Object(r.default)(t,i.BlockType.SHEET_BLOCK,0),a=Object(r.default)(t,i.BlockType.POLL_BLOCK,0)),{sheet_block_number:n,vote_block_number:a}}},g3tQ:function(e,t,n){"use strict";n.d(t,"a",function(){return O});var a=n("lwsE"),r=n.n(a),i=n("W8MJ"),o=n.n(i),s=n("a1gu"),l=n.n(s),c=n("Nsbk"),u=n.n(c),d=n("7W2i"),h=n.n(d),g=n("q1tI"),p=n.n(g),f=n("i8i4"),m=n.n(f),v=n("Qm/3"),b=n("aXiW"),_=n("OX8E"),y=n("sLU5"),T=n("G8Hj"),C=n("SGN9"),O=function(e){function n(e){var t;return r()(this,n),(t=l()(this,u()(n).call(this,e))).closeStepGuide=function(){Object(C.f)(T.STEP_TYPES.translate_guide)},t.handleGuideTranslate=function(){Object(b.a)("translation_fixed_guide").report({action:"translate"}),t.props.toggleTranslate(!0)},t.removeQuickEntry=function(){t.toggleShowQuickEntry(!1),Object(b.a)("translation_fixed_guide").report({action:"cancel"})},t.closeQuickEntry=function(){t.props.closeUserGuide(T.STEP_TYPES.close_translate_quick_entry),t.toggleShowQuickEntry(!1),Object(b.a)("translation_fixed_guide").report({action:"never_remind"})},t.openSettingModel=function(){_.a.emit(y.a.PC.COMMON.OPEN_TRANSLATE_SETTING,{source:"guide"}),Object(b.a)("translation_fixed_guide").report({action:"more_settings"})},t.state={showQuickEntry:!1},t}return h()(n,e),o()(n,[{key:"componentDidMount",value:function(){this.handleShowQuickGuide(),_.a.on(y.a.PC.DOCS.CLOSE_TRANSLATE_GUIDE,this.closeStepGuide)}},{key:"componentWillUnmount",value:function(){Object(C.q)(T.STEP_TYPES.translate_guide),_.a.off(y.a.PC.DOCS.CLOSE_TRANSLATE_GUIDE,this.closeStepGuide)}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.isFullscreen,a=t.userGuide;Object(C.n)(a,T.STEP_TYPES.close_translate_quick_entry)!==Object(C.n)(e.userGuide,T.STEP_TYPES.close_translate_quick_entry)&&this.handleShowQuickGuide(),n!==e.isFullscreen&&(n?(this.toggleShowQuickEntry(!1),Object(C.q)(T.STEP_TYPES.translate_guide)):this.handleShowQuickGuide())}},{key:"handleShowQuickGuide",value:function(){var e=this.props.userGuide;return Object(C.n)(e,T.STEP_TYPES.close_translate_quick_entry)?Object(C.n)(e,T.STEP_TYPES.translate_guide)?void 0:Object(C.b)(T.STEP_TYPES.translate_guide):this.toggleShowQuickEntry(!0)}},{key:"toggleShowQuickEntry",value:function(e){e&&Object(b.a)("translation_fixed_guide").report({action:"show"}),this.setState({showQuickEntry:e})}},{key:"render",value:function(){var e=this.props.editor,t=document.querySelector(".app-main-container");if(!this.state.showQuickEntry||!e||!t)return null;var n=this.props,a=n.autoTranslateEnabled,r=n.translateConfig;return m.a.createPortal(p.a.createElement(v.a,{autoTranslateEnabled:a,translateConfig:r,onTranslate:this.handleGuideTranslate,onClose:this.closeQuickEntry,onRemove:this.removeQuickEntry,openSettingModal:this.openSettingModel}),t)}}]),n}(g.PureComponent)},hfMJ:function(e,Y,J){"use strict";(function(o){J.d(Y,"a",function(){return K});var e=J("o0o1"),c=J.n(e),t=J("yXPU"),s=J.n(t),n=J("lwsE"),l=J.n(n),a=J("W8MJ"),u=J.n(a),r=J("a1gu"),d=J.n(r),i=J("Nsbk"),h=J.n(i),g=J("7W2i"),p=J.n(g),f=J("cDf5"),m=J.n(f),v=J("3Hq1"),b=J("q1tI"),_=J.n(b),y=J("zfY2"),T=J("G8Hj"),C=J("hvYP"),O=J("sLU5"),k=J("4PSP"),E=J("OX8E"),S=J("aXiW"),w=J("kUgE"),L=J("iP/4"),I=J("2spZ"),j=J("hjac"),M=J("fco7"),x=J("GVmr"),D=J("C+Is"),N=J("fHNB"),P=J("n/R6"),R=J("GACP"),B=J("SLjs"),U=J("D28M"),F=J("atwd"),H=J("7SOz"),V=J("BnfA"),z=J("9ajS"),q=J("AW8B"),W=J("g3tQ"),Z=function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":m()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(o=(i<3?r(o):3<i?r(t,n,o):r(t,n))||o);return 3<i&&o&&Object.defineProperty(t,n,o),o},K=function(e){function t(e){var a;return l()(this,t),(a=d()(this,h()(t).call(this,e))).translateStartTime=0,a.hasSendPerformanceTea=!1,a.hasReportFail=!1,a.wordCount=0,a.initAutoTranslate=!1,a.withOriginal=!1,a.initialDoc=!0,a.isAuto=!1,a.targetLang="",a.title="",a.syncEnable=Object(q.e)(),a.autoTranslateEnabled=Object(q.b)(),a.changeTranslateStatus=function(e,t){var n=a.props.translateStatus.translated;switch(e){case B.d.LOADING:return n&&P.a.removeAll(),void a.toggleTranslating(!0);case B.d.FINISH:return void a.translateFinish(t);case B.d.FAIL:return void a.translateFail(t);case B.d.MOUNT:return Object(S.a)("translation_performance").push({first_screen_loading_time:Date.now()-a.translateStartTime}),void a.setTranslateFinish(t);case B.d.SYNC_FINISH:return void a.setTranslateFinish(t);case B.d.SYNC_FAIL:return void a.showReload(t)}},a.state={isFinish:!1,canShowGuid:!1},a.bindEvents(),a}function n(e){return a.apply(this,arguments)}var a,r;function i(){return r.apply(this,arguments)}return p()(t,e),u()(t,[{key:"bindEvents",value:function(){E.a.on(O.a.PC.COMMON.REFRESH_TRANSLATE,this.refreshTranslate),E.a.on(O.a.PC.COMMON.CLOSE_TRANSLATE,this.closeTranslate),E.a.on(O.a.PC.COMMON.UPDATE_TRANSLATE_SETTING,this.handleTranslateSettingsChange),E.a.on(O.a.PC.COMMON.CLICK_TRANSLATE_MENU,this.clickMoreMenu)}},{key:"unBindEvents",value:function(){E.a.off(O.a.PC.COMMON.REFRESH_TRANSLATE,this.refreshTranslate),E.a.off(O.a.PC.COMMON.CLOSE_TRANSLATE,this.closeTranslate),E.a.off(O.a.PC.COMMON.UPDATE_TRANSLATE_SETTING,this.handleTranslateSettingsChange),E.a.off(O.a.PC.COMMON.CLICK_TRANSLATE_MENU,this.clickMoreMenu)}},{key:"clickMoreMenu",value:function(e){var t=e.action,n=e.targetLang,a=this.props,r=a.translateConfig,i=a.editor;this.wordCount=Object(x.d)(i),Object(S.a)("translation_operation").report(Object.assign({action_translation:t,original_language:r.src_lang,target_language:n,web_language:window.navigator.language,space_language:Object(w.getLanguage)(),content_type:"doc_comment",word_count:this.wordCount,is_synced:this.syncEnable},Object(F.a)(i)))}},{key:"fetchTranslateConfig",value:function(){var o=this,e=this.props,s=e.noteToken,t=e.noteType,l=e.editor,n=e.fetchTranslateConfig;this.initialDoc=!1,this.wordCount=Object(x.d)(l),n(s,t).then(function(e){var t,n,a,r,i;s===o.props.noteToken&&(n=(t=e.payload).target_lang,a=t.src_lang,l&&(delete t.token,r=Object(w.getLanguage)(),Object(S.a)("view_auto_translate_doc").report(Object.assign({is_equal_to_space_lang:a===r,is_equal_to_web_lang:a===window.navigator.language,lark_language:n,doc_environment_language:r,doc_language:a,word_count:o.wordCount},t)),L.a.isOpendoc||(o.prevTargetLang=n,i=Object(H.b)(t),o.checkAutoTranslate(i)?o.autoTranslateDoc(i):o.checkShowGuideOrQuickEntry(i))))})}},{key:"checkAutoTranslate",value:function(e){var t=this.props.oldVersion,n=e.enable_auto_translate_doc_body;return!(!this.autoTranslateEnabled||!n||t||!this.isAllowTranslate(e))}},{key:"autoTranslateDoc",value:function(e){var t=e.src_lang,n=e.target_lang,a=e.display_type;this.initAutoTranslate=!0,this.withOriginal=a===B.b.WITH_ORIGINAL,Object(S.a)("translation_operation").report(Object.assign({source:"translation_view",action_translation:"perform_automatic_translation",original_language:t,target_language:n,is_synced:this.syncEnable},this.commonTeaLogParams())),this.toggleTranslate(!0,!0)}},{key:"isAllowTranslate",value:function(e){var t=e.supported_src_langs,n=void 0===t?[]:t,a=e.src_lang,r=void 0===a?"not_lang":a;return e.target_lang!==r&&"not_lang"!==r&&-1<n.indexOf(r)}},{key:"checkShowGuideOrQuickEntry",value:function(e){var t=this.props.isNewUser,n=this.isAllowTranslate(e),a=e.enable_auto_translate_doc_body;L.a.isFeed||!Object(q.c)()||a||!n||t||this.setState({canShowGuid:!0})}},{key:"commonTeaLogParams",value:function(){return Object.assign({is_auto:String(this.initAutoTranslate),is_opened_comparison:String(this.withOriginal),web_language:window.navigator.language,space_language:Object(w.getLanguage)(),word_count:this.wordCount,content_type:"doc_comment",enter_translation_type:"direct"},this.blockCount)}},{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.editor,a=e.translateToggle;n&&this.initialDoc&&this.fetchTranslateConfig(),a&&a(function(){return t.toggleTranslate(!0)},function(){return t.toggleTranslate(!1)},function(e){return t.refreshTranslate({targetLang:e})}),L.a.isOpendoc&&Object(y.registerOpendocApi)(D.b.toggleTranslate,this._toggleTranslate)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.noteToken,n=e.noteType,a=e.toggleTranslate,r=e.updateTranslateConfig,i=e.updateTranslateStatus;this.clear(),this.unBindEvents(),a(!1,{token:t,type:n}),i({translating:!1,error:"",translated:!1,comment_enable_translate:!1}),r({enable_auto_translate_doc_comment:!1})}},{key:"_toggleTranslate",value:function(e,t){this.targetLang&&t?this.refreshTranslate({targetLang:t}):this.toggleTranslate(e,!1,t)}},{key:"toggleTranslate",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=2<arguments.length?arguments[2]:void 0;this.isAuto=t,this.targetLang=n||"";var a=this.props,r=a.noteToken,i=a.noteType,o=a.toggleTranslate;e?o(e,{token:r,type:i,targetLang:n}):this.closeTranslate()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.translateStatus,a=t.translateConfig,r=t.noteToken,i=t.isOnline,o=e.translateStatus,s=e.translateConfig,l=n.translating,c=n.translate_start,u=n.translated,d=n.error,h=n.translate_exiting,g=o.translate_start,p=o.translated,f=o.translating,m=o.error,v=o.translate_exiting,b=a.target_lang!==s.target_lang,_=a.display_type!==s.display_type;if(e.noteToken!==r&&this.initialTranslateStatus(),this.props.editor&&!e.editor&&this.initialDoc&&this.fetchTranslateConfig(),u&&(b||_)&&(this.prevTargetLang=s.target_lang,this.controller.startTranslate({target_lang:a.target_lang,display_type:a.display_type,src_lang:a.src_lang})),l&&!f&&this.enterTranslating(),c&&!g)try{this.controller=z.a.getInstance({originEditor:this.props.editor,token:r,translateConfig:a,changeCbk:this.changeTranslateStatus}),this.controller&&this.controller.startTranslate(a)}catch(e){this.changeTranslateStatus(B.d.FAIL,{msg:"init TranslateController error: ".concat(e.message)})}if(u&&!p&&(this.enterTranslateMode(),this.sendTranslateEventToOpendoc(a.target_lang)),b&&p&&u&&this.sendTranslateEventToOpendoc(a.target_lang),p&&!u)return this.exitTranslateMode(),void this.sendTranslateEventToOpendoc();!h||v?(d&&d!==m&&this.showError(),i&&!e.isOnline&&P.a.removeAll()):this.translateExiting()}},{key:"sendTranslateEventToOpendoc",value:function(e){Object(y.sendOpendocEvent)(D.d.TRANSLATE_CHANGE,e)}},{key:"commentEnableTranslate",value:function(){var e;0<arguments.length&&void 0!==arguments[0]&&arguments[0]&&(e=this.props.translateConfig,Object(S.a)("translation_operation").report(Object.assign({source:"translation_view",action_translation:"perform_automatic_translation",original_language:e.src_lang,target_language:e.target_lang,is_synced:this.syncEnable},this.commonTeaLogParams(),{content_type:"comment",is_auto:"true"}))),this.props.updateTranslateStatus({comment_enable_translate:!0})}},{key:"commentDisableTranslate",value:function(){this.props.updateTranslateStatus({comment_enable_translate:!1})}},{key:"initialTranslateStatus",value:function(){this.initialDoc=!0,this.clear(),this.props.cancelTranslateRequestConfig(),this.props.toggleTranslate(!1)}},{key:"translateExiting",value:function(){P.a.show({type:"loading",content:o("common.loading"),duration:0,closable:!1,key:V.a})}},{key:"showError",value:(r=s()(c.a.mark(function e(){var t,n,a,r,i;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,n=t.translateStatus,a=t.updateTranslateStatus,r=n.error,i=["reload","disconnected"],r){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,Object(I.c)(50);case 7:P.a.removeAll(),P.a.error({content:this.getTranslateError(r),duration:-1<i.indexOf(r)?0:6e3,closable:"reload"!==r}),a({error:""});case 10:case"end":return e.stop()}},e,this)})),i)},{key:"enterTranslating",value:function(){P.a.removeAll(),this.setState({canShowGuid:!1});var e,t=this.props,n=t.translateStatus,a=t.onChange,r=t.translateConfig;a&&a(B.d.LOADING),!L.a.isFeed&&n.translated||(e=this.targetLang||r.target_lang,P.a.show({type:"loading",content:o("common.translate.translating",M.a.getText(e)),duration:0,closable:!1,key:V.a}))}},{key:"exitTranslateMode",value:function(){this.clear(),this.props.updateTranslateConfig({enable_auto_translate:!1}),this.commentDisableTranslate(),this.isAuto=!1}},{key:"enterTranslateMode",value:function(){P.a.removeAll(),this.commentEnableTranslate(!0),Object(j.a)(""),Object(U.a)(document.querySelector("#mainBox"),"translate")}},{key:"updateConfig",value:function(e){var t=e.targetLang,n=e.displayType,a=e.autoTranslateDoc,r=e.autoTranslateComment,i=this.props,o=i.updateTranslateConfig,s=i.translateConfig;return o(Object.assign({},s,{target_lang:t||s.target_lang,display_type:n||s.display_type,enable_auto_translate_doc_body:Object(v.default)(a)?s.enable_auto_translate_doc_body:a,enable_auto_translate_doc_comment:Object(v.default)(r)?s.enable_auto_translate_doc_comment:r}))}},{key:"refreshTranslate",value:function(e){var t=e.targetLang,n=e.displayType,a=e.source,r=this.props.translateConfig,i=t!==r.target_lang,o=n!==r.display_type,s=i||o;this.targetLang=t,this.updateConfig(e),i&&Object(S.a)("translation_operation").report(Object.assign({source:a||"translation_view",action_translation:"change_langeuages",original_language:r.src_lang,target_language:t,is_synced:this.syncEnable},this.commonTeaLogParams(),{is_opened_comparison:String(n===B.b.WITH_ORIGINAL)})),s&&this.resetStart()}},{key:"resetStart",value:function(){this.translateStartTime=Date.now(),this.hasReportFail=!1,this.hasSendPerformanceTea=!1,this.toggleTranslating(!0)}},{key:"translateFinish",value:(a=s()(c.a.mark(function e(t){var n,a,r,i,o,s,l;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.initClientVar,a=this.props,r=a.setOriginClientVars,i=a.updateTranslateStatus,o=a.clientVars,s=a.translateStatus,l=a.updateUserGuide,e.next=4,Object(I.c)(34);case 4:r(Object.assign({},o,{collab_client_vars:n})),s.translated||(l(T.STEP_TYPES.toggle_translate),i({translated:!0}));case 6:case"end":return e.stop()}},e,this)})),n)},{key:"dealErrorCode",value:function(e){var t,n=e.codes,a=e.is_partial,r=e.fail_paragraph,i=void 0===r?0:r,o=e.target_lang;n?(t=n.find(function(e){return e!==B.c.DATA_ERROR}),this.reportFail({code:t||B.c.DATA_ERROR,codes:n,is_partial:a,fail_paragraph:i,target_lang:o})):this.reportFail({code:B.c.FAILED,codes:n,is_partial:"true",fail_paragraph:i,target_lang:o})}},{key:"showReload",value:function(e){var t=this.props,n=t.updateTranslateStatus,a=t.translateStatus,r=t.isOnline;"reload"!==a.error&&(this.setState({isFinish:!1}),r?(n({error:"reload"}),e.is_finish&&(this.reportPerformance(e.fail_paragraph),this.dealErrorCode(Object.assign({},e,{is_partial:"true"})))):n({error:"disconnected"}))}},{key:"handleTranslateSettingsChange",value:function(e){var t=this.props,n=t.translateConfig,a=t.translateStatus,r=Object.assign({},n,{},e),i=Object(H.b)(r),o=i.target_lang,s=i.display_type,l=i.enable_auto_translate_doc_body,c=i.enable_auto_translate_doc_comment;if(a.translated){var u=n.target_lang,d=n.enable_auto_translate_doc_body,h=n.enable_auto_translate_doc_comment;if(this.isAuto){if(!l)return this.closeTranslate(),void this.updateConfig({autoTranslateComment:c});u=o,d=l,h=c}this.refreshTranslate({targetLang:u,displayType:s,autoTranslateDoc:d,autoTranslateComment:h})}}},{key:"reportPerformance",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.hasSendPerformanceTea||this.hasReportFail||(this.hasSendPerformanceTea=!0,e=this.props.translateConfig,Object(S.a)("translation_performance").report({translate_time:Date.now()-this.translateStartTime,original_language:e.src_lang,target_language:e.target_lang,word_count:this.wordCount,content_type:"doc_comment",is_auto:String(this.initAutoTranslate),fail_paragraph:t,is_opened_comparison:String(e.display_type===B.b.WITH_ORIGINAL)}))}},{key:"reportFail",value:function(e){var t;this.hasReportFail||(this.hasReportFail=!0,t=this.props.translateConfig,Object(S.a)("translation_failed").report({error_code:e.code,error_codes:e.codes,original_language:t.src_lang,target_language:e.target_lang||t.target_lang,word_count:this.wordCount,content_type:"doc_comment",is_partial:e.is_partial,fail_paragraph:e.fail_paragraph,is_auto:String(this.initAutoTranslate),is_opened_comparison:String(t.display_type===B.b.WITH_ORIGINAL)}))}},{key:"setTranslateFinish",value:function(e){this.reportPerformance(),P.a.removeAll();var t=this.props,n=t.onChange,a=t.updateTranslateStatus;n&&n(B.d.FINISH),a({error:"",translating:!1}),this.setState({isFinish:!0}),e&&e.title&&this.title!==e.title&&(this.title=e.title,E.a.emit(C.a.UPDATE_TRANS_TITLE,[this.title]))}},{key:"toggleTranslating",value:function(e){e?this.props.updateTranslateStatus({translating:!0,error:""}):this.props.updateTranslateStatus({translating:!1})}},{key:"translateFail",value:function(e){var t=this.props,n=t.updateTranslateConfig,a=t.translateConfig;this.dealErrorCode({codes:e.codes,is_partial:"true",target_lang:a.target_lang}),n({target_lang:this.prevTargetLang});var r=this.props,i=r.onChange,o=r.updateTranslateStatus;i&&i(B.d.FAIL),o({error:"fail",translating:!1})}},{key:"clear",value:function(){this.targetLang="",this.title="",P.a.removeAll(),this.controller=null,z.a.destroy(),Object(U.p)(document.querySelector("#mainBox"),"translate")}},{key:"closeTranslate",value:function(e){var t=this.props,n=t.translateConfig,a=t.updateTranslateStatus,r=t.editor,i=n.src_lang,o=n.target_lang,s=n.display_type;this.blockBridgeExitTranslate(r),a({translate_exit_start:!0}),r&&r.call("translate.exiting"),Object(S.a)("translation_operation").report(Object.assign({source:e||"translation_view",action_translation:"click_view_original",original_language:i,target_language:o,is_synced:this.syncEnable},this.commonTeaLogParams(),{is_opened_comparison:String(s===B.b.WITH_ORIGINAL)})),this.controller=null,z.a.destroy()}},{key:"blockBridgeExitTranslate",value:function(e){var t=e.plugins.sheetBridge,n=e.plugins.bitableBridge;t.exitTranslateMode(),n.exitTranslateMode()}},{key:"getTranslateError",value:function(e){if(e)switch(e){case"reload":return this.renderReload();case"disconnected":return o("common.translated_disconnected");default:return o("common.translated_fail")}}},{key:"renderReload",value:function(){return _.a.createElement(R.I18n,{name:o("CreationDoc_Translate_Timeout_Toast1"),noWrapper:!0},_.a.createElement("span",{className:"translate-reload",onClick:function(){return Object(N.a)()}},o("CreationDoc_Translate_Timeout_Toast2")))}},{key:"render",value:function(){var e=this.props,t=e.editor,n=e.translateConfig,a=e.isFullscreen,r=e.userGuide,i=e.closeUserGuide;return _.a.createElement(_.a.Fragment,null,this.state.canShowGuid&&_.a.createElement(W.a,{editor:t,autoTranslateEnabled:this.autoTranslateEnabled,translateConfig:n,isFullscreen:a,userGuide:r,closeUserGuide:i,toggleTranslate:this.toggleTranslate}))}}]),t}(b.PureComponent);Z([Object(k.Bind)()],K.prototype,"clickMoreMenu",null),Z([Object(k.Bind)()],K.prototype,"_toggleTranslate",null),Z([Object(k.Bind)()],K.prototype,"toggleTranslate",null),Z([Object(k.Bind)()],K.prototype,"refreshTranslate",null),Z([Object(k.Bind)()],K.prototype,"handleTranslateSettingsChange",null),Z([Object(k.Bind)()],K.prototype,"translateFail",null),Z([Object(k.Bind)()],K.prototype,"closeTranslate",null),Z([Object(k.Bind)()],K.prototype,"getTranslateError",null)}).call(this,J("2vAP"))},hvYP:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var a={UPDATE_TRANS_TITLE:"UPDATE_TRANS_TITLE"}},jQMZ:function(e,t,n){"use strict";n.r(t);var a=n("m/+l"),r=n("hfMJ"),i=n("jzcD"),o=n("xXG4"),s=n("qKwb"),l=n("n3ZB"),c=n("yaX4"),u=n("5cZX"),d=n("eL/v"),h=n("peh1"),g=Object(h.createSelector)(i.b,l.i,u.u,function(e){return Object(s.d)(e)&&Object(s.h)(e)},s.f,d.a,l.f,function(e,t,n,a,r,i,o){return{isBlankDoc:a,translateStatus:e.status,translateConfig:e.config,clientVars:e.originClientVars,copyable:n&&n.copyable,userGuide:t,isOnline:i,isFullscreen:r,isNewUser:o}}),p={updateTranslateStatus:o.f,toggleTranslate:o.d,fetchTranslateConfig:o.b,cancelTranslateRequestConfig:o.a,updateTranslateConfig:o.e,setOriginClientVars:o.c,closeUserGuide:c.a,updateUserGuide:c.d,updateTranslateView:o.g},f=Object(a.connect)(g,p)(r.a);t.default=f},odlc:function(e,m,v){"use strict";v.r(m),function(g){v.d(m,"default",function(){return h});var e=v("lwsE"),n=v.n(e),t=v("W8MJ"),a=v.n(t),r=v("a1gu"),i=v.n(r),o=v("Nsbk"),s=v.n(o),l=v("7W2i"),c=v.n(l),u=v("q1tI"),p=v.n(u),f=v("BKLJ"),d=v("aXiW"),h=function(e){function t(){return n()(this,t),i()(this,s()(t).apply(this,arguments))}return c()(t,e),a()(t,[{key:"componentDidUpdate",value:function(e){!e.visible&&this.props.visible&&this.reportTea()}},{key:"reportTea",value:function(){var e=this.props.source,t=void 0===e?"sheet":e;Object(d.a)("translation_hover_view_original").report({source:t})}},{key:"render",value:function(){var e=this.props,t=e.visible,n=e.selectedPos,a=e.selectedLines,r=e.className,i=e.selectedStyle,o=e.copyable,s=void 0!==o&&o,l=e.onRef,c=e.onMouseEnter,u=e.onMouseLeave,d="up",h={left:n.left};return n.bottom?(h.top=n.top,d="bottom"):h.top=n.top,h=Object.assign({},h,{},this.props.style),p.a.createElement("div",{className:"translate-original-popover ".concat(d," ").concat(t?"visible":""," ").concat(r),style:h,ref:l,onMouseEnter:c,onMouseLeave:u},p.a.createElement("div",{className:"translate-original__title"},p.a.createElement("span",{className:"translate-original__text"},g("common.translate_original_text"))),p.a.createElement("div",{className:"translate-original__content",style:i},p.a.createElement(f.a,{copyable:s,lines:a})))}}]),t}(u.PureComponent);h.defaultProps={selectedPos:{left:0,top:0}}}.call(this,v("2vAP"))},q51M:function(e,t,n){"use strict";n.r(t);var a=n("m/+l"),r=n("lwsE"),o=n.n(r),i=n("W8MJ"),s=n.n(i),l=n("a1gu"),c=n.n(l),u=n("Nsbk"),d=n.n(u),h=n("7W2i"),g=n.n(h),p=n("q1tI"),f=n.n(p),m=n("5FHm"),v=n("m1/u"),b=n("n3ZB"),_=n("yaX4"),y={closeUserGuide:_.a,updateUserGuide:_.d},T=function(e){return{userGuide:Object(b.i)(e),userGuideStatus:Object(v.a)("userGuide")(e)}},C=Object(a.connect)(T,y)(m.a),O=n("cDf5"),k=n.n(O),E=n("rQ+X"),S=n("4PSP"),w=n("OX8E"),L=n("TSYQ"),I=n.n(L),j=n("RIqP"),M=n.n(j),x=n("nMtL"),D=n("KhPb"),N=n("DCy2"),P=n("0Hpa"),R=n("njD1"),B=n("5Ucn"),U=n("bqU8"),F=n("A9Q4"),H=n("bPgG"),V=n("/Mcf"),z=n("grVa"),q=n("o0o1"),W=n.n(q),Z=n("yXPU"),K=n.n(Z),Y=n("iWIM"),J=n.n(Y),Q=n("hbEN"),X=n("HmyT"),ee=n("BScZ"),te=n("8kCL"),ne=(n("3OMI"),n("SCx9")),ae=n("Vor4"),re=n("7EGn"),ie=n("yIs4"),oe=n("OZf9"),se=n("3Hq1"),le=n("sFgt"),ce=n("aBXQ"),ue=n.n(ce),de=function e(){var n=this;o()(this,e),this.setNumber=function(e){n._number=e},this.addNumber=function(e){n._number+=e},this.removeNumber=function(e){return n._number-=e,n._number},this.setStyle=function(e){n._style=e},this.highlight=function(){n._$root.addClass("comment-number--hl")},this.render=function(){var e=n._number,t=n._style;n._html=Object(le.k)(ue.a)({style:t,number:n.formatNumber(e)})},this.update=function(){var e=n.formatNumber(n._number);n._$root.find(".comment-number__text").text(e)},this.formatNumber=function(e){return 99<e?"99+":e},this.attach=function(e){n._$root=Object(X.$)(n._html),e.append(n._$root)},this.detach=function(){n._$root.remove(),n._number=0},this._number=0},he=(n("vL6y"),function e(t){var u=this;o()(this,e),this.setListeners=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u._listeners=e},this.addListCount=function(e,t){var n,a,r,i=u._commentIds[e];i&&(n=i.numberTop,a=i.listCount,(r=u._numbers[n])&&(r.addNumber(t),r.update(),u._commentIds[e]={numberTop:n,listCount:a+t}))},this.update=function(e){var t=e.commentId,n=e.top,a=e.height,r=e.listCount,i=n,o=u._commentIds[t],s=Object(re.default)(o,"numberTop",0),l=Object(re.default)(o,"listCount",0),c=Object(ie.default)(r)?r:l;i===s&&c===l||(u.remove(t),u.add({commentId:t,height:a,numberTop:i,listCount:c}))},this.add=function(e){var t=e.commentId,n=e.numberTop,a=(e.height,e.listCount);u._commentIds[t]={numberTop:n,listCount:a};var r=u._numbers[n];r||!a?r&&(r.addNumber(a),r.update()):u.addNumberView(a,n)},this.remove=function(e){var t,n,a,r,i=u._commentIds[e];Object(se.default)(i)||(t=i.numberTop,n=i.listCount,(a=u._numbers[t])&&(r=a.removeNumber(n),a.update(),r||(a.detach(),delete u._numbers[t]),delete u._commentIds[e]))},this.addNumberView=function(e,t){var n=new de,a="top: ".concat(t,"px;");n.setNumber(e),n.setStyle(a),n.render(),n.attach(u._$root),u._numbers[t]=n},this.hasAttach=function(){return u._$root&&u._$doc[0].contains(u._$root[0])},this.isEmpty=function(){return Object.keys(u._numbers).length<=0},this.getCommentsInView=function(e){var a=Object(le.c)(e.style.top),r=-1,i=[];return Object(oe.a)(u._commentIds,function(e,t){var n=e.numberTop;Number(n)<a&&r++,Number(n)===a&&i.push(t)}),{index:r+1,commentIds:i}},this.handleNumberClick=function(e){var t,n,a,r,i=e.currentTarget,o=u._listeners;o&&o.onNumberClick&&(n=(t=u.getCommentsInView(i)).index,a=t.commentIds,Object(X.$)(".comment-number").removeClass("comment-number--hl"),Object(X.$)(i).addClass("comment-number--hl"),r=i.offsetTop,o.onNumberClick(n,a,r))},this.highlight=function(e){var t=e.top,n=(e.height,u._numbers[t]);n&&(Object(X.$)(".comment-number").removeClass("comment-number--hl"),n.highlight())},this.cancelHighlight=function(){Object(X.$)(".comment-number").removeClass("comment-number--hl")},this.attach=function(){u._$doc.append(u._$root),Object(le.m)(u._$root,".comment-number","click",u.handleNumberClick)},this.detach=function(){u._$root.remove(),Object(X.$)(".comment-numbers").remove(),u._numbers={},u._commentIds={},u._listeners={}},this._context=t,this._$root=Object(X.$)('<div class="comment-numbers"></div>'),this._listeners={},this._numbers={},this._commentIds={},this._$doc=Object(X.$)(this._context.getOuterContainer())}),ge=n("H6oK"),pe=n("FJEn"),fe=n("KJZc");function me(e){return!!Object(re.default)(Object(fe.a)(e),ge.BlockType.SHEET_BLOCK,0)}function ve(e){return!!Object(re.default)(Object(fe.a)(e),ge.BlockType.BITABLE_BLOCK,0)}function be(e){return!!Object(re.default)(Object(fe.a)(e),ge.BlockType.MINDNOTE_BLOCK,0)}function _e(e,a){var t=e.getMatchedAttributePositionOnSelection(null,function(e,t){if(e!==ge.BLOCK_DATA_META_BLOCK_PROPS)return"sheet-id"===e&&t===a;var n=JSON.parse(t);return n.blockType===ge.BlockType.SHEET_BLOCK&&(n.blockMeta&&n.blockMeta.sheet_id===a)});return 0<t.length?t[0].docPosition:null}function ye(e,a){var t=e.getMatchedAttributePositionOnSelection(null,function(e,t){if(e!==ge.BLOCK_DATA_META_BLOCK_PROPS)return!1;var n=JSON.parse(t);return n.blockType===ge.BlockType.BITABLE_BLOCK&&n.token===a});return 0<t.length?t[0].docPosition:null}function Te(e,a){var t=e.getMatchedAttributePositionOnSelection(null,function(e,t){if(e!==ge.BLOCK_DATA_META_BLOCK_PROPS)return!1;var n=JSON.parse(t);return n.blockType===ge.BlockType.MINDNOTE_BLOCK&&n.blockId===a});return 0<t.length?t[0].docPosition:null}function Ce(e){if(e)try{return"bitable"===JSON.parse(e.source_file_type).type}catch(e){return!1}return!1}function Oe(e){if(e)try{return"mindnote"===JSON.parse(e.source_file_type).type}catch(e){return!1}return!1}var ke=n("HIeq"),Ee=n("2ACu"),Se=n("hLtC"),we=n("eAOf"),Le=function(e){function t(){return o()(this,t),c()(this,d()(t).apply(this,arguments))}return g()(t,e),s()(t,[{key:"logClickPopup",value:function(){}},{key:"logTriggerStartNewCommentByShortcut",value:function(){}},{key:"logTriggerStartNewCommentByEditorbar",value:function(){}}]),t}(ae.a),Ie=".doc-right",je=function(e){function i(e){var g;return o()(this,i),(g=c()(this,d()(i).call(this,e))).notify=null,g.messageList=[],g.needUpdateCommentIds=[],g.currentUserId=Object(ke.d)(),g.logger=new Le,g.renderCommentsForce=function(){g.messageList=g.getNewMessages(g.comments),g.renderComments([],{source:"",forceUpdate:!0})},g.handleNumberClick=function(e,t,n){var a=g.comments[e],r=a.serviceType,i=a.serviceToken,o=a.commentId;g.deactivateComment(),g.activateComment(r,i,o,function(e){g.notify&&g.notify(ne.c.CLICK_COMMENT_ON_DOC,{serviceType:r,serviceToken:i,commentId:o,activeTop:n})})},g.commentToMessage=function(e){var t=e.serviceType,n=e.serviceToken;return{commentId:e.commentId,context:{serviceType:t,serviceToken:n,isSubmitted:e.isSubmitted}}},g.mentionPositionToMessage=function(e){var t=e.id,n={};if(/^mention-id:/.test(t)){var a=t.split(":")[1];if(!a)throw new Error("not match id: positionId");n.mentionId=a}else if(/^mention-id_/.test(t)){var r=/^mention-id_(\d+):/.exec(t);if(r&&!r[1])throw new Error("not match id: positionId");r&&(n.mentionId=r[1])}else{var i,o=t.slice("dataMetaBlockProps:".length);if(!o||(i=JSON.parse(o))&&i.blockType===ge.BlockType.AT_USER_BLOCK&&i.props&&i.props.data&&i.props.data.mentionId&&(n.mentionId=i.props.data.mentionId),!n.mentionId)return null}return n},g.getNewMessages=function(a){var e=g.attributeManagerController.getPositions({groupId:"mention"}),t=g.attributeManagerController.getPositions({groupId:"comment"}),n=e.positions||[],r=t.positions||[],i=g.editor.plugins.sheetBridge.getBridge(),o=g.editor.plugins.bitableBridge.getBridge(),s=g.editor.plugins.mindnoteBridge.getBridge(),l=[],c=[],u=[];i&&(l=i.getAllMention()||[]),o&&(c=o.getAllMentionList()||[]),s&&(u=s.getAllMentionList()||[]);var d=n.concat(r),h=[].concat(l,c,u);return d.forEach(function(t){if(/^(mention-id|dataMetaBlockProps)/.test(t.id)){var e=g.mentionPositionToMessage(t);if(e)return h.push(e)}var n=a.filter(function(e){return e.positionId===t.id});0<n.length&&(h=h.concat(n.map(g.commentToMessage)))}),h},g.handleMessagePositionsInit=function(e){g.messageList=g.getNewMessages(g.comments)},g.handleLogPositionUpdate=function(){var e=g.attributeManagerController.getPositions({groupId:"comment"});g.logger.logPositionUpdate(e,g.comments)},g.getTopBySelection=function(e,t){return g.editor.getLineTop(e,t)},g.shouldUpdateMessageList=function(r,e){return e.find(function(e,t){var n=e.commentId,a=e.mentionId;return t!==r.findIndex(function(e){return e.commentId&&e.commentId===n||e.mentionId&&e.mentionId===a})})},g.handleResize=Object(Q.default)(function(e){g.reizeComment(e)},100),g.handleResizeComment=function(e,t){t?g.reizeComment(e):g.handleResize(e)},g.reizeComment=function(e){g.numbersView&&g.comments.forEach(function(e){var t,n=e.serviceType,a=e.serviceToken,r=e.commentId,i=g.keyOfComment({serviceType:n,serviceToken:a,commentId:r}),o=g.findComment(n,a,r);o&&o.visible&&((t=g.getRectByCommentId(n,a,r,0))&&g.numbersView.update(Object.assign({commentId:i},t)))})},g.detectActiveComment=function(e){var t=g.getCoveredCommentBySelection(e);if(!t)return g.deactivateComment(),void(g.notify&&g.notify(ne.c.CLEAR_ACTIVE_COMMENT,void 0));var n=t.comment,a=t.matchedSelection,r=n.serviceType,i=n.serviceToken,o=n.commentId,s=n.relativeTopToThirdParty,l=a.selStart,c=a.selZone,u=g.getTopBySelection(c,l)+(s||0),d=g.getCurrentActiveComment();d&&g.isSameComment(n,d)||(d&&g.deactivateComment(),g.activateComment(r,i,o,function(){g.notify&&g.notify(ne.c.CLICK_COMMENT_ON_DOC,{serviceType:r,serviceToken:i,commentId:o,activeTop:u})}))},g.getEntryTop=function(e,t){var n=e.getRep("0").lines.atIndex(t);return n?n.getLineRect().top:void 0},g.findMentionInBitable=function(){var n=K()(W.a.mark(function e(t,n){var a,r,i,o,s,l,c;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a="client_bitable_find_mention",Object(Ee.default)(a,{value:"FIND"}),!ve(g.editor)||!n){e.next=21;break}if(!(r=g.editor.plugins.bitableBridge.getBridge())){e.next=21;break}if(i=r.getTableIdFromMention(t,n))return o=r.getBlockToken(i),e.next=11,r.locateMention(i,t,n);e.next=19;break;case 11:return s=e.sent,l=ye(g.editor,o),e.next=15,g.openFoldBlock(l);case 15:if(c=l&&g.getEntryTop(g.editor,l.selStart[0])||0,s)return Object(Ee.default)(a,{value:"LOCATE_SUCC"}),e.abrupt("return",{top:c+s.top,type:ne.b.Bitable,x:s.x});e.next=19;break;case 19:return Object(Ee.default)(a,{value:"LOCATE_FAIL",moreInfo:"".concat(i,":").concat(t,":").concat(n.source_file_type)}),e.abrupt("return",null);case 21:return Object(Ee.default)(a,{value:"UNREADY"}),e.abrupt("return",null);case 23:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),g.findeMentionInMindnote=function(){var n=K()(W.a.mark(function e(t,n){var a,r,i,o;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(be(g.editor)&&n){e.next=3;break}return e.abrupt("return",null);case 3:if(a=g.editor.plugins.mindnoteBridge.getBridge()){e.next=6;break}return e.abrupt("return",null);case 6:if(r=a.getBlockIdFromExtra(n,g.editor)){e.next=9;break}return e.abrupt("return",null);case 9:return i=Te(g.editor,r),e.next=12,g.openFoldBlock(i);case 12:return o=i&&g.getEntryTop(g.editor,i.selStart[0])||0,e.abrupt("return",{top:o,type:ne.b.Mindnote});case 14:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),g.openFoldBlock=function(){var t=K()(W.a.mark(function e(t){var n,a,r,i;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t)return n=t.selStart,a=t.selEnd,r=t.selZone,i=void 0===r?pe.DEFAULT_REP_ZONE:r,g.emitInvakeCollapse(n,a,i),e.next=5,g.waitUntilLineRendered(n,a,i);e.next=6;break;case 5:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",null);case 7:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),g.onNotify=function(e){g.notify=e},g.highlight=new te.a,g.attributeManagerController.register({groupId:"mention",attributeReg:function(e,t){var n=g.getMentionUserIdFromAttribute(e,t);return!(!n||n!==g.currentUserId)}}),g.attributeManagerController.onPositionsInit(g.handleMessagePositionsInit),g.attributeManagerController.onPositionsUpdate(g.handleLogPositionUpdate),g.numbersView=new he(g.editor),g.numbersView.setListeners({onNumberClick:g.handleNumberClick}),w.a.on("LOADED_BITABLE_BLOCK",g.renderCommentsForce),w.a.on("LOADED_MINDNOTE_BLOCK",g.renderCommentsForce),g}function t(e,t){return n.apply(this,arguments)}var n;return g()(i,e),s()(i,[{key:"getMentionUserIdFromAttribute",value:function(e,t){if("dataMetaBlockProps"!==e||!t){if("mention-token"===e)return t;var n=/^mention-token_(\d+)/.exec(e);return n?n[1]:null}if(t){var a=JSON.parse(t);if(a&&a.blockType===ge.BlockType.AT_USER_BLOCK&&a.props&&a.props.data&&a.props.data.user)return a.props.data.user.id}}},{key:"getCurrentSelection",value:function(){var e=this.editor.getRep(),t=e.selStart,n=e.selEnd,a=e.zoneId;if(t&&n&&a)return{selStart:t,selEnd:n,selZone:a}}},{key:"beforeCommentsUpdate",value:function(e){var d=this,h=e.comments,t=e.newComments,n=e.deletedComments,a=this.messageList,r=this.getNewMessages(t);this.messageList=r;var g=this.shouldUpdateMessageList(a,r),i=this.getCurrentActiveComment();if(i){var o=!0,s=!1,l=void 0;try{for(var c,u=n.values()[Symbol.iterator]();!(o=(c=u.next()).done);o=!0)if(c.value.find(function(e){return d.isSameComment(e,i)})){this.deactivateComment();break}}catch(e){s=!0,l=e}finally{try{o||null==u.return||u.return()}finally{if(s)throw l}}}return t.forEach(function(e){var t,n,a,r,i,o,s=e.serviceType,l=e.serviceToken,c=e.commentId,u=h.find(function(e){return e.commentId===c});u&&(t=u.docPositions[u.docPositions.length-1],n=e.docPositions[e.docPositions.length-1],a=t.selZone===n.selZone,r=Object(ee.e)(t.selStart,n.selStart),i=Object(ee.e)(t.selEnd,n.selEnd),(o=!a||!r||!i)&&(g=!0),!o&&u.visible===e.visible||d.needUpdateCommentIds.push({serviceType:s,serviceToken:l,commentId:c}))}),g}},{key:"onPositionInited",value:function(){this.notify&&this.notify(ne.c.COMMENT_FIRST_START_LOADING,0<this.comments.length)}},{key:"addDocHighlight",value:function(e){J()(d()(i.prototype),"addDocHighlight",this).call(this,e);var t=this.getDocServiceTypeAndToken(),n=t.serviceType,a=t.serviceToken,r=this.getRectByCommentId(n,a,e,0);r&&this.numbersView.highlight(r)}},{key:"removeDocHighlight",value:function(e){J()(d()(i.prototype),"removeDocHighlight",this).call(this,e),this.numbersView.cancelHighlight()}},{key:"onCommentResized",value:function(e){this.handleResize(e)}},{key:"onCommentDeleted",value:function(e,t,n){var a=this.keyOfComment({serviceType:e,serviceToken:t,commentId:n});this.numbersView.remove(a)}},{key:"onThirdPartyError",value:function(){}},{key:"onThirdPartyStartLoading",value:function(){}},{key:"onThirdPartyLoaded",value:function(e){0!==e.length&&this.notify&&this.notify(ne.c.THIRD_PARTY_LOADED,e)}},{key:"onDestroy",value:function(){this.numbersView.detach(),this.handleResize.cancel(),w.a.off("LOADED_BITABLE_BLOCK",this.renderCommentsForce),w.a.off("LOADED_MINDNOTE_BLOCK",this.renderCommentsForce)}},{key:"onThirdPartyActiveCommentChanged",value:function(){var e=this.editor.getRep(),t=e.selStart,n=e.selEnd,a=e.zoneId;t&&n&&a&&this.detectActiveComment({selStart:t,selEnd:n,selZone:a})}},{key:"setCommentData",value:function(e){var d=this;this.numbersView.hasAttach()||this.numbersView.attach();var h=this.messageList;e.forEach(function(e){var t,n,a,r,i,o,s,l=e.commentId,c=e.commentList,u=h.find(function(e){return e&&e.commentId&&e.commentId===l});u&&(n=(t=u.context).serviceType,a=t.serviceToken,(r=d.findComment(n,a,l))&&r.visible&&((i=d.getRectByCommentId(n,a,l,0))&&(o=c.length,s=d.keyOfComment({serviceType:n,serviceToken:a,commentId:l}),d.numbersView.update(Object.assign({},i,{commentId:s,listCount:o})))))})}},{key:"emitInvakeCollapse",value:function(e,t,n){w.a.emit("invokeCollapse",{zoneId:n,range:{selStart:e,selEnd:t},source:"activateMention"})}},{key:"waitUntilLineRendered",value:function(e,t,n){var r=this,i={selStart:e,selEnd:t,selZone:n};return new Promise(function(n){var t,a=Object(Se.a)(r.editor,"lark-comment");function e(e){return t.apply(this,arguments)}r.editor.scrollToSelection(i,{scrollFn:(t=K()(W.a.mark(function e(t){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,we.a.getInstance(r.editor).waitZoneMount(i);case 2:a(),n(t);case 4:case"end":return e.stop()}},e)})),e)})})}},{key:"activateMention",value:(n=K()(W.a.mark(function e(n,t){var a,r,i,o,s,l,c,u,d,h,g,p,f,m=this;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.attributeManagerController.getPositions({groupId:"mention"}),r=a.positions||[],i=r.find(function(e){if(/^(mention-id|dataMetaBlockProps)/.test(e.id)){var t=m.mentionPositionToMessage(e);if(t)return t.mentionId===n}return!1}))return o=i.docPositions[0].selStart,s=i.docPositions[0].selEnd,l=i.docPositions[0].selZone,this.emitInvakeCollapse(o,s,l),e.next=10,this.waitUntilLineRendered(o,s,l);e.next=13;break;case 10:return c=e.sent,"0"!==l&&this.horizontalScrollToZone({selZone:l,selStart:o,selEnd:s}),e.abrupt("return",{type:ne.b.Doc,top:c,height:0});case 13:if(Oe(t))return e.next=16,this.findeMentionInMindnote(n,t);e.next=17;break;case 16:return e.abrupt("return",e.sent);case 17:if(Ce(t))return e.next=20,this.findMentionInBitable(n,t);e.next=21;break;case 20:return e.abrupt("return",e.sent);case 21:if(!me(this.editor)){e.next=44;break}u=this.editor.plugins.sheetBridge.getBridge(),d=[],u&&(d=u.getAllMention()||[]),g=0;case 27:if(!(g<d.length)){e.next=35;break}if((p=d[g]).mentionId===n)return h=p.sheetId,e.abrupt("break",35);e.next=32;break;case 32:g++,e.next=27;break;case 35:if(h)return f=_e(this.editor,h),e.next=39,this.openFoldBlock(f);e.next=39;break;case 39:return e.next=41,u.findMention(n,Object(X.$)(Ie));case 41:if(e.sent)return e.abrupt("return",{type:ne.b.Sheet});e.next=44;break;case 44:return e.abrupt("return",null);case 45:case"end":return e.stop()}},e,this)})),t)},{key:"renderComments",value:function(e,t){var l=this;this.needUpdateCommentIds.forEach(function(e){var t,n,a,r=e.serviceType,i=e.serviceToken,o=e.commentId,s=l.keyOfComment({serviceType:r,serviceToken:i,commentId:o});l.findComment(r,i,o)&&(!(t=l.getRectByCommentId(r,i,o,0))||(n=l.commentService.getComments().comments.find(function(e){return e.commentId===o}))&&(a=n.commentList.length,l.numbersView.update(Object.assign({commentId:s,listCount:a},t))))});var n=this.messageList;this.notify&&this.notify(ne.c.RENDER_COMMENTS,Object.assign({commentIds:e,allMessages:n},t))}},{key:"shouldDeactivate",value:function(e,t,n){var a=this.getCurrentSelection();if(!a)return!0;var r=this.getCoveredCommentBySelection(a);return!r||this.isSameComment(r.comment,{serviceType:e,serviceToken:t,commentId:n})}}]),i}(ee.a),Ae=n("IcLG"),Me=n("46iY"),xe=n("WtIE"),De=n("TBry"),Ne=n("3UIW"),Pe=n("ZuTZ"),Re=n("XC0b"),Be=n("/WRf"),Ue=n("CXkg"),Ge=n("tvAd"),Fe=n("RooE"),He=n("sxjD"),Ve=n("EupG"),ze=n("euE0"),qe=n("FKAX"),We=n("trzc"),Ze=n("kWuU"),Ke=n("SLR9"),Ye=n("XUVG"),Je=n("gX+J"),Qe=n("WP/d"),Xe=n("DKi5"),$e=n("mELL"),et=n("hrO2"),tt=n("k8MZ"),nt=n("CZAk"),at=n("jnLa"),rt=n("Kboj"),it=n("gUre"),ot=n("9GRl"),st=n("p7Cg"),lt=n("nyf+"),ct=n("avPc"),ut=n("on5/"),dt=n("4O8T"),ht=n.n(dt),gt=n("xKvl"),pt=n("FnDM"),ft=n("uGsk"),mt=n("kPRI"),vt=n("1CG5"),bt=n("VN5G"),_t=n("bwyh"),yt=n("QM+C"),Tt=n("iP/4"),Ct=n("Hj9z"),Ot=n("kUgE"),kt=n("D7h9"),Et=n("iR+8"),St=n("vE74"),wt=n("MEJ+"),Lt=n("1dfU"),It=n("IyQe"),jt=n("wd/R"),At=n.n(jt),Mt=n("qYkn"),xt=n("CVSs"),Dt=n("ZGZ5"),Nt=n("5cZX"),Pt=n("n/R6"),Rt=n("FrgG"),Bt=n("90+h"),Ut=n("Q2zD"),Gt=n("LT0/"),Ft=n("jUga"),Ht=n("Kwn9"),Vt=n("4PFL"),zt=n("5UUe"),qt=n("KhU0"),Wt=n("toa8"),Zt=n("AiBH"),Kt=n("VI6H"),Yt=n("rFy5"),Jt=n("bsrO"),Qt=n("rhi5"),Xt=n("GIL9"),$t=n("y9S/"),en=n("D28M"),tn=n("5gS9"),nn=n("EBUI"),an=n("gBrI"),rn=n("qTk9"),on=n("rLED"),sn=n("BkG1"),ln=n("PIJw"),cn=n("PGru"),un=n("/2EM"),dn=(n("/1Vk"),n("bn+F")),hn=n("AW8B"),gn=n("Cf53");Object(vt.a)(),Object(mt.a)();var pn=Object(ge.Commentable)(ge.BlockPlugin);function fn(){var e,t=!0;return Tt.a.isOpendoc&&(t=!(!(e=Object(gn.a)())||!e.partial.enable)),t}function mn(e,t){var n=new ht.a,a=new ut.AttributePositionManagerController(n),r=Object(bt.a)(yt.NUM_FILE_TYPE.DOC,e.getDocId());Object(ft.b)({CommentService:r});var i=new _t.a({editor:e}),o=new Bt.a({editor:e,eventEmitter:w.a}),s=new Vt.a({editor:e,isTemplate:t}),l=Tt.a.isFeed?je:z.a,c=new zt.a({editor:e,isTemplate:t}),u=new qt.a({editor:e}),d=Object(Ht.e)({regionSelector:"#innerdocbody",ignoreComment:!0}),h=Object(Ht.g)(),g=Object(Ht.d)(),p=fn(),f={SOURCE:Zt.z.DOC,SUITE_TYPE:yt.NUM_FILE_TYPE.DOC,JOIN_CHAT_ERROR_MSG:Zt.s},m={createCustomEvent:St.b,getPageToken:ke.e,encryptTea:Lt.a,getIsCurrentUserToCUser:Kt.g,queryParents:en.o,isShortCut:Xt.a,htmlEncode:Yt.b,htmlDecode:Yt.a},v={browser:Tt.a,getLanguage:Ot.getLanguage,getLocale:Ot.getLocale,getUserPermissions:It.getUserPermissions,moment:At.a},b={copyTextWithoutPermission:Mt.a,clearFailedServices:xt.clearFailedServices},_={selectCurrentUser:Dt.a,selectCurrentSuiteOtherPermissions:Nt.u,selectCanEditInvolvingEditMode:Nt.e,selectFromMinaConfig:Nt.A},y=[new Ct.AtUserCreator({ExternalServices:Ht.a.AtUserCreator,moduleConfigs:M()(g)}),new Ct.FileCardCreator({ExternalServices:Ht.a.FileCardCreator}),new Ct.IframeCreator({ExternalServices:Ht.a.IframeCreator,moduleConfigs:[].concat(M()(d),M()(g))}),new Ct.PollCreator({ExternalServices:{LogService:{teaLogger:gt.b,collectEvent:Ee.default,collectSuiteEvent:Ee.collectSuiteEvent},t:Et.b,Utils:m,Helpers:v,Redux:{store:kt.default,selectors:_,actions:b},Toast:Pt.a,VotePicker:Ht.c,VoteEmoji:Ht.b,io:tn.b.getInstance(),EventEmitter:w.a},moduleConfigs:M()(g)}),new Ct.SheetCreator({ExternalServices:Object.assign({LogService:{teaLogger:gt.b,collectEvent:Ee.default,collectSuiteEvent:Ee.collectSuiteEvent},t:Et.b,Utils:m,Helpers:v,EventEmitter:w.a},Object(dn.a)(),{},Object(Vt.b)(s))}),new Ct.PlaceholderCreator({ExternalServices:{t:Et.b}}),new Ct.ReminderCreator({ExternalServices:Ht.a.ReminderCreator(w.a)}),new Ct.ChatCardCreator({ExternalServices:{Redux:{store:kt.default,selectors:_,actions:b},LogService:{teaLogger:gt.b,collectEvent:Ee.default,collectSuiteEvent:Ee.collectSuiteEvent,getFileType:pt.f,getEncryptToken:pt.d},Toast:Pt.a,Constants:f,Utils:m,Request:Wt.d,t:Et.b},moduleConfigs:M()(g)}),new Ct.LinkBlockCreator({ExternalServices:Ht.a.LinkBlockCreator}),new Ct.DiagramCreator({ExternalServices:Ht.a.DiagramCreator(w.a),moduleConfigs:M()(g)}),new Ct.EquationCreator({ExternalServices:Ht.a.EquationCreator})];y.push(new Ct.BitableCreator({ExternalServices:Object.assign({},Ht.a.BitableCreator(w.a),{},Object(zt.b)(c))})),Object(on.u)()&&y.push(new Ct.MindnoteCreator({ExternalServices:Object.assign({},Ht.a.MindnoteCreator(w.a),{},Object(qt.b)(u)),moduleConfigs:M()(g)})),Object(Jt.f)()&&y.push(new Ct.JiraIssueCreator({ExternalServices:Object.assign({},Ht.a.JiraCreator(w.a),{components:{JiraIssueCard:Qt.c,SyncBtn:Qt.d,JiraFieldConfigurePopover:Qt.b},request:Wt.d})})),Object(Jt.d)()&&y.push(new Ct.JiraFilterCreator({ExternalServices:Object.assign({},Ht.a.JiraCreator(w.a),{components:{SyncBtn:Qt.d},viewManager:$t.a.getInstance})})),Object(on.w)()&&y.push(new Ct.ISVCreator({ExternalServices:Ht.a.ISVCreator(w.a)}));var T=new pn({editor:e,modules:[].concat(M()(h),M()(g)),blockManager:new ge.BlockManager(y)});s.setBlockEventEmitter(T.event),c.setBlockEventEmitter(T.event),u.setBlockEventEmitter(T.event);var C=Object(un.b)({editor:e,moduleMap:Object.assign({},Object(un.a)(),{galleryComment:i}),eventEmitter:n,newGalleryEnable:Object(on.Q)()});return[new it.a(e),new ot.a(e),new H.a(e,!1),new x.default(e),new Ne.a(e),new U.c(e),new P.a(e,{hasCollapse:!1}),new D.a(e),new N.a(e),new ut.AttributePositionManager(e,n),new Pe.a(e),new Ue.a({editor:e}),new R.a(e),new B.HyperLinks({editor:e}),lt.a,C,new F.a(e),Object(at.a)(e,{fullWidth:!0,platform:"pc"}),p&&new V.a({editor:e,comment:new l({changeSetCommitWatcher:new Ft.a,editor:e,attributePositionController:a,commentService:r,plugins:[T,i]})}),new Re.a({editor:e,commentable:Object(hn.e)()}),new Ae.a(e),new Me.b(e),new xe.b(e),new De.b(e),new Ve.a({editor:e,sheetBridgePlugin:s}),new Ge.a(e),new Fe.b(e),new He.a(e),new ze.a(e),new We.a(e),new nn.a({editor:e,adaptor:new an.a}),new Ke.b(e),new nt.a({editor:e,eventEmitter:w.a}),o,T,s,c,u,new cn.a(e),new Ye.a(e),new wt.a(e),new qe.a(e),new Ze.a(e),new Je.a(e),new Qe.a(e),new Xe.a(e),new $e.a(e),new et.a(e),new tt.a(e),new rt.a(e),new ct.a(e),new Rt.a(e),new Ut.a({editor:e,eventEmitter:w.a}),new Gt.a(e),new st.a(e),new rn.a(e,{waitForDone:!1}),p&&new Be.a({editor:e})].concat(M()(Object(sn.a)(e)),M()(Object(ln.a)(e))).filter(function(e){return e})}Object(ft.a)();var vn=n("ftdE"),bn=n("9ajS"),_n=n("Vr4U"),yn=n("SLjs"),Tn=n("DVUE"),Cn=(n("HWuX"),function(e,t,n,a){var r,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":k()(Reflect))&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(o=(i<3?r(o):3<i?r(t,n,o):r(t,n))||o);return 3<i&&o&&Object.defineProperty(t,n,o),o}),On=function(e){function t(e){return o()(this,t),c()(this,d()(t).call(this,e))}return g()(t,e),s()(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.translateStatus,a=t.fetching,r=t.updateTranslateStatus;e.noteToken!==this.props.noteToken||n.translate_exit_start&&!e.translateStatus.translate_exit_start?r({translate_exiting:!0,translate_exit_start:!1}):n.translate_exiting&&n.translated&&!a&&e.fetching&&setTimeout(this.exitTransMode)}},{key:"exitTransMode",value:function(){var e,t,n,a,r;this.controller&&(t=(e=this.props).noteToken,n=e.toggleTranslate,a=e.destroyEditor,r=e.noteType,a(this.editor.editorUniqueId),this.editor=null,this.controller=null,n(!1,{token:t,type:r}))}},{key:"registerPlugins",value:function(e){return[new _n.default(Object.assign({editor:e},e,{type:"doc",showable:!0,postAddMentionId:!0,hoverArea:"#innerdocbody",showChatCards:!0,source:Zt.z.DOC,container:".doc-position"}))].concat(mn(e,!1))}},{key:"componentWillUnmount",value:function(){this.exitTransMode(),window.editor=null}},{key:"editorOnMount",value:function(t){var e=this;this.editor=t;var n=this.props,a=n.setEditor,r=n.updateTranslateView;a(t),window.editor=t,this.controller=bn.a.getInstance(),this.controller&&(this.controller.setTranslateEditor(t),r({type:vn.b.TRANSLATION,isOpenHistory:!1}),t.once("paint",function(){requestAnimationFrame(function(){var e=t.getScrollContainer();e&&(e.scrollTop=0)}),e.renderCurrentView(t)}))}},{key:"renderCurrentView",value:function(e){var t=e.plugins.viewportObserver.getLineRange(e.getScrollTop()).inViewTopLineNu;e.scrollToSelection({selStart:[t,0],selEnd:[t,0],selZone:"0"},{scrollFn:function(){return Promise.resolve()}})}},{key:"render",value:function(){var e=this.props,t=e.noteToken,n=e.clientVars,a=e.translateConfig,r=e.copyable,i=n.colorPalette,o=n.user_id,s=n.permissions,l=n.collab_client_vars,c=l.rev,u=I()("innerdocbody maindocbody syntax flex",{with_original:a.display_type===yn.b.WITH_ORIGINAL,"doc-new-layout":a.display_type!==yn.b.WITH_ORIGINAL});return f.a.createElement(Tn.a,{key:"".concat(l.time),id:"innerdocbody",className:u,role:"application",spellCheck:"true",contentEditable:"false",editable:!1,copyable:r,placeholder:" ",autoCorrect:"false",resizeStrategy:"iframe",scroller:document.querySelector(".etherpad-container-wrapper"),token:t,autoFocus:!1,clientVars:Object.assign({},l,{rev:c,colorPalette:i,userId:o,permissions:s}),style:{minHeight:window.innerHeight-64,fontFamily:Object(E.a)()},onInit:this.editorOnMount,registerPlugin:this.registerPlugins,bus:w.a})}}]),t}(p.PureComponent);Cn([Object(S.Bind)()],On.prototype,"exitTransMode",null),Cn([Object(S.Bind)()],On.prototype,"registerPlugins",null),Cn([Object(S.Bind)()],On.prototype,"editorOnMount",null);var kn=On,En=n("odlc"),Sn=n("i8i4"),wn=n.n(Sn),Ln=(n("Pihw"),n("mRaX")),In=n("zTCG"),jn=n("kESg"),An=390,Mn=function(e){function t(e){var l;return o()(this,t),(l=c()(this,d()(t).call(this,e))).syncEnable=Object(hn.e)(),l.mousemoveHandle=function(e){var t,n,a,r,i,o=e.currentTarget,s=e.target;l.containBlackList(o,s)||(!(t=Object(en.o)(o,"ace-line"))||0===t.textContent.length||(a=(n=Object(en.g)(t,"translate-id"))&&n.split("translate-")[1])&&(l.hoverLineKey===a&&l.state.visible||(r=window.getSelection(),l.syncEnable&&r&&!1===r.isCollapsed||(i=l.translateController.getOriginalLineText(a),l.isEmptyText(i)||l.hoverLineKey&&l.hoverLineKey===a||(l.hoverLineKey=a,l.debounceShowOriginLine.cancel(),l.debounceHideOriginLine.cancel(),l.setOriginLineText(i),window.requestAnimationFrame(function(){var e=l.getOriginalPos(t);l.debounceShowOriginLine(i,e)}))))))},l.mouseleaveHandler=function(e){l.debounceShowOriginLine.cancel(),l.debounceHideOriginLine()},l.mouseupHandle=function(){var e=window.getSelection();e&&!1===e.isCollapsed&&(l.hoverLineKey="",l.setState({visible:!1}))},l.handlePopoverMouseEnter=function(){l.debounceHideOriginLine.cancel()},l.handlePopoverMouseLeave=function(){l.debounceHideOriginLine()},l.state={visible:!1,selectedLines:[],selectedPos:{}},l}return g()(t,e),s()(t,[{key:"componentDidMount",value:function(){this.translateController=bn.a.getInstance();var e=document.querySelector("#outerdocbody");e&&($(e).on("mouseleave","div[id^=magicdomid]",this.mouseleaveHandler),$(e).on("mouseup",this.mouseupHandle),$(e).on("mousemove","div[id^=magicdomid]",this.mousemoveHandle)),this.debounceShowOriginLine=Object(Q.default)(this.showOriginLine,300),this.debounceHideOriginLine=Object(Q.default)(this.hideOriginLine,200)}},{key:"componentWillUnmount",value:function(){var e=document.querySelector("#outerdocbody");e&&($(e).off("mouseleave","div[id^=magicdomid]",this.mouseleaveHandler),$(e).off("mouseup",this.mouseupHandle),$(e).off("mousemove","div[id^=magicdomid]",this.mousemoveHandle)),this.debounceShowOriginLine.cancel(),this.debounceHideOriginLine.cancel()}},{key:"containBlackList",value:function(e,t){if(Object(en.l)(e,"j-block-container")||Object(en.l)(t,"j-block-container"))return!0;var n=Object(en.o)(e,"ace-line");if(!n)return!0;if(Object(en.o)(t,In.a.ACE_LINE))return!0;var a=["single-line","aceTable-","list-code",jn.e.ACE_LINE],r=[e,t,n.firstChild];return n.firstChild&&r.push(n.firstChild.firstChild),r.some(function(e){return!!e&&!!Object(en.h)(e,a)})}},{key:"hasOtherPopoverShow",value:function(){if(document.querySelector(".reminder-popover-wrapper.visible"))return!0;var e=document.querySelector(".doc-position");return!(!e||!e.children.length)||!!document.querySelector(".selection-popup--visible")}},{key:"showOriginLine",value:function(e,t){this.hasOtherPopoverShow()||this.setState({visible:!0,selectedLines:[e],selectedPos:t})}},{key:"setOriginLineText",value:function(e){this.setState({visible:!1,selectedLines:[e]})}},{key:"hideOriginLine",value:function(){this.hoverLineKey="",this.setState({visible:!1,selectedLines:[]})}},{key:"getOriginalPos",value:function(e){var t=this.props.editor,n=t.domToRep(e);if(n&&n.selStart){var a=t.getRep(n.selStart[2]),r=a.lines.indexOfKey(e.id),i=a.lines.atIndex(r);if(i){var o=t.getOuterContainer();i.deleteLineRect();var s,l=i.getLineRect(),c=i.getCharRect(i.text.length-i.lineMarker),u=this.originTextDom||(this.originTextDom=document.querySelector(".translate-original-popover")),d=u&&u.offsetHeight||An,h=Object(Ln.v)(e,{$boxContainer:o,boxWidth:o.offsetWidth,horizontalAlign:"center",zoom:1,upFirst:!0,boxMaxHeight:d});return h.top?h.top=l.bottom+c.top+10:(s=o.getBoundingClientRect().height,h.top=s-d-h.bottom-5),h.left=l.left-17,h}}}},{key:"isEmptyText",value:function(e){return!e.reduce(function(e,t){return e+t.text},"").trim()}},{key:"render",value:function(){var e=this.props,t=e.copyable,n=e.outerDocBody;return wn.a.createPortal(f.a.createElement(En.default,{copyable:t,visible:this.state.visible,selectedLines:this.state.selectedLines,selectedPos:this.state.selectedPos,source:"doc",onMouseEnter:this.handlePopoverMouseEnter,onMouseLeave:this.handlePopoverMouseLeave}),n)}}]),t}(p.PureComponent),xn=function(e){function t(){var e;return o()(this,t),(e=c()(this,d()(t).apply(this,arguments))).transCommentEnable=Object(hn.e)(),e}return g()(t,e),s()(t,[{key:"renderDocPopover",value:function(){var e=this.props,t=e.translateConfig,n=e.translateStatus,a=e.editor,r=e.copyable,i=n.translating;if(t.display_type===yn.b.ONLY_TRANSLATION){var o=a&&a.docbody?a.getOuterContainer():null;if(o&&!i)return f.a.createElement(Mn,{copyable:r,editor:a,outerDocBody:o.parentElement})}return null}},{key:"render",value:function(){return f.a.createElement(f.a.Fragment,null,this.renderDocPopover(),this.transCommentEnable&&f.a.createElement(C,null),f.a.createElement(kn,Object.assign({},this.props)))}}]),t}(p.PureComponent),Dn=n("G2xZ"),Nn=n("xXG4"),Pn=n("jzcD"),Rn=n("qKwb"),Bn=function(e){return{translateStatus:Object(Pn.b)(e).status,translateConfig:Object(Pn.b)(e).config,isDocRendered:Object(Rn.e)(e),clientVars:Object(Pn.b)(e).originClientVars}},Un={setEditor:Dn.f,destroyEditor:Dn.a,setClientVars:Dn.d,resetClientVars:Dn.b,toggleTranslate:Nn.d,setDocRendered:Dn.e,updateTranslateStatus:Nn.f,updateTranslateView:Nn.g},Gn=Object(a.connect)(Bn,Un)(xn);t.default=Gn},vL6y:function(e,t,n){}}]);
//# sourceMappingURL=translate_doc.591e5c8ee275da643f7e.js.map