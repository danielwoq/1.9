(this.webpackJsonp=this.webpackJsonp||[]).push([["web-upload-progress-viewer"],{"0vdM":function(e,h,me){"use strict";(function(m){me.d(h,"a",function(){return _});var e=me("RIqP"),v=me.n(e),t=me("o0o1"),b=me.n(t),r=me("yXPU"),R=me.n(r),n=me("lwsE"),T=me.n(n),o=me("W8MJ"),I=me.n(o),i=me("a1gu"),S=me.n(i),s=me("Nsbk"),C=me.n(s),a=me("7W2i"),k=me.n(a),c=me("cDf5"),u=me.n(c),L=me("UXvI"),N=me("hbEN"),P=me("EWn2"),l=me("TSYQ"),M=me.n(l),D=me("TtEC"),w=me("3iXK"),F=me("b+Vi"),j=me("Mpt7"),d=me("04K3"),p=me("q1tI"),U=me.n(p),x=me("dvZ7"),V=me("Xngx"),B=me("LCeV"),H=me("y94N"),W=me("IQ5M"),q=me("9WA+"),z=me("n/R6"),Y=me("QM+C"),X=me("ahx2"),K=me("1T6K"),J=me("jryj"),Q=me("EQyw"),Z=me("dP4c"),$=me("gfe6"),ee=me("5dbN"),te=me("CQgL"),re=me("VI6H"),ne=me("erPj"),oe=me("4amg"),ie=me("u0v/"),se=me("jloT"),ae=me("I4by"),ce=me("NG+2"),ue=me("hLn5"),le=me("kUPN"),de=me("91xD"),pe=me("li/R"),fe=me("kWdx"),_e=me("LaPx"),he=me("Ir/a"),f=function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":u()(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s},Ee=1e3,ge=6e5,ye=300;function Oe(e){switch(e){case he.a.IMPORT_ERROR_FOLDER_NODE_LIMIT:return m("error.out_of_limit");case he.a.IMPORT_ERROR_SIZE_LIMIT:return m("box.uploader.file_too_large_title");case he.a.IMPORT_ERROR_ENCRYPTED:return m("drive.import_encrypt_file_not_support");case he.a.IMPORT_ERROR_UNSUPPORTED_TYPE:return m("box.import.unsupported");case he.a.FOLDER_EMPTY:return m("common.an_empty_folder");case he.a.FILE_TOO_LARGE_TO_UPLOAD:case he.a.FOLDER_ALL_FILES_TOO_LARGE_TO_UPLOAD:case he.a.FOLDER_HAS_FILE_TOO_LARGE_TO_UPLOAD:case he.a.FILE_TOO_LARGE_TO_IMPORT:return m("box.uploader.file_too_large_title");case he.a.FOLDER_HAS_FILE_NOT_IMPORTABLE:return m("import.folder_partly_not_importable");case he.a.FOLDER_ALL_FILES_NOT_IMPORTABLE:return m("import.folder_not_importable");case he.a.FILE_NOT_IMPORTABLE:return m("import.error_obj_type");case he.a.UPLOAD_BACKEND_TIME_OUT:case he.a.NETWORK_ERROR:return m("box.task.error.network");case he.a.UPLOAD_FORBIDDEN:case he.a.UPLOAD_LOGIN_REQUIRED:return m("box.task.error.no_upload_permission");case he.a.UPLOAD_CREATE_LIMIT:return m("common.storage_usage_limitation_title");case he.a.UPLOAD_USER_STORAGE_LIMIT:return m("CreationDoc_ECM_AdminSpaceTitle");case he.a.UPLOAD_ILLEGAL:return m("drive.upload_fail_illegal");case he.a.MOUNT_POINT_DELETED:return m("box.task.error.deleted");default:return m("box.uploader.common.error")}}var _=function(e){function t(){var n;return T()(this,t),(n=S()(this,C()(t).apply(this,arguments))).isUploadingBeforeOffline=!1,n.state={doneCount:0,fileAddedUnderSuiteRoute:!1,folderDialogDetail:null,online:Object($.c)(),progressList:[],viewerProgressList:[],totalSize:0,uploadSpeed:0,uploadStatus:P.e.Success},n.hasUploadInProgress=function(){return n.state.progressList.some(function(e){return e.status===P.e.Pending||e.status===P.e.Inflight})},n.getUnSaveTip=function(){return m("upload_manager.in_progress_upload_tip")},n.triggerFileListUpdate=Object(N.default)(n.props.uploadSuccess,Ee),n.setDragStart=Object(L.default)(function(){n.props.setIsFileDragging(!0)},ge),n.setDragEnd=Object(N.default)(function(){n.setDragStart.cancel(),n.props.setIsFileDragging(!1)},ye),n.getStatusIcon=function(e,t){var r=n.state.progressList.find(function(e){return e.uuid===t});if(!r)return null;if(n.getIsImportConverting(r))return(e?oe:ae).a;switch(r.status){case P.e.Success:return(n.isFolderTypeItem(r)?se:ce).a;case P.e.Inflight:return e?oe.a:null;case P.e.Pending:return oe.a;case P.e.Paused:return ae.a;case P.e.Error:return(e?ae:ie).a;default:return null}},n}function r(){return n.apply(this,arguments)}var n,o,i,s,a,c,u,l,d;function p(e){return o.apply(this,arguments)}function f(e){return i.apply(this,arguments)}function _(e){return s.apply(this,arguments)}function h(e){return a.apply(this,arguments)}function E(){return c.apply(this,arguments)}function g(){return u.apply(this,arguments)}function y(){return l.apply(this,arguments)}function O(e){return d.apply(this,arguments)}return k()(t,e),I()(t,[{key:"componentDidMount",value:function(){var e=this.props.currentRoute;this.initUploader(),this.setNetworkCheck(!0),e.get("isSuite")||this.setDragAndDrop(!0)}},{key:"componentDidUpdate",value:function(e,t){Object(j.is)(e.currentRoute,this.props.currentRoute)||this.setDndByRoute(e.currentRoute,this.props.currentRoute),t.progressList!==this.state.progressList&&(this.computeProgressViewerList(),0===t.progressList.length&&0<this.state.progressList.length&&this.props.expandBox(),this.updateOverallData()),t.online!==this.state.online&&this.handleNetworkStatusChanged()}},{key:"componentWillUnmount",value:function(){this.setDragAndDrop(!1),this.setNetworkCheck(!1)}},{key:"setNetworkCheck",value:function(e){Object(F.c)().setNetworkCheck(e)}},{key:"setDndByRoute",value:function(e,t){var r=e.get("isSuite"),n=t.get("isSuite");r&&!n&&(this.setState({fileAddedUnderSuiteRoute:!1}),this.setDragAndDrop(!0)),!r&&n&&this.setDragAndDrop(!1)}},{key:"initUploader",value:function(){var r=this,n=Object(F.d)();n.on("offline",this.onOffline),n.on("online",this.onOnline),n.on("parse_error",function(e){var t=e.list;t&&t.forEach(function(e){r.showUploadTips({errorType:e.parseError,fileNames:e.failedToParseFiles})})}),n.on("runtime_incident_occurred",function(e){r.showUploadTips(e)}),n.on("speed_changed",function(e){var t=e.speed;r.handleUploadSpeedChanged(t)}),n.on("tasks_added",function(e){var t=e.list;r.handleUploadTasksAdded(t),n.upload()}),n.on("tasks_changed",function(e){var t=e.list;r.handleUploadTasksChanged(t)}),n.on("tasks_removed",function(e){var t=e.list;r.handleUploadTasksRemoved(t)})}},{key:"onOnline",value:function(){this.setState({online:!0})}},{key:"onOffline",value:function(){this.setState({online:!1})}},{key:"handleNetworkStatusChanged",value:function(){this.state.online?this.isUploadingBeforeOffline&&this.retryAllPausedTasks():(this.isUploadingBeforeOffline=this.isUploading,this.pauseAllLoadingTasks())}},{key:"updateOverallData",value:function(){var e=this.state.progressList,r=0,n=0;e.forEach(function(e){var t=e.size||0;r+=t,e.status===P.e.Success&&(n+=1)}),this.setState({totalSize:r,doneCount:n,uploadStatus:this.getUploadStatus()})}},{key:"getUploadStatus",value:function(){return this.isCompleted?P.e.Success:this.isUploading?P.e.Inflight:this.isPaused?P.e.Paused:P.e.Error}},{key:"setDragAndDrop",value:function(e){var t;e?(t=document.querySelector("#mainContainer"))&&(this.unregisterDragAndDrop=Object(P.f)(t,{setDragging:this.setDragging,handleDrop:this.handleDrop})):this.unregisterDragAndDrop&&(this.unregisterDragAndDrop(),this.unregisterDragAndDrop=void 0)}},{key:"setDragging",value:function(e,t){t?(this.setDragEnd.cancel(),this.setDragStart()):this.setDragEnd()}},{key:"handleDrop",value:(d=R()(b.a.mark(function e(t){var r,n,o,i,s,a,c;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.event,n=t.list,o=this.props,i=o.currentFolderUserPermission,s=o.openModal,a=o.fileEntities,i===Y.FOLDER_PERMISSION.READABLE)return console.info("Current folder is read-only."),e.abrupt("return");e.next=5;break;case 5:if(Object(ne.f)()){e.next=8;break}return console.info("Upload disabled by administrator."),e.abrupt("return");case 8:if(c=this.getUploadParentToken(),Object(D.d)()||!Object(te.d)(n)){e.next=13;break}s(J.MODAL_TYPES.UPLOAD_FILES_IMPORT_CONFIRM,{files:Object(te.a)(n),event:r,uploadOptions:{parentToken:c}}),e.next=15;break;case 13:return e.next=15,Object(F.c)().loadFiles(n,r,{parentToken:c,jobType:P.b.Upload,shouldAddToRecents:!0,directoryType:Object(F.a)(a,c)});case 15:case"end":return e.stop()}},e,this)})),O)},{key:"handleUploadTasksAdded",value:function(t){var e=this;if(t){var r=0,n=0,o=!0,i=!1,s=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done);o=!0){var u=a.value;this.isImportTypeItem(u)?r+=1:n+=1}}catch(e){i=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw s}}0<r&&(this.props.closeModal(J.MODAL_TYPES.IMPORT_CENTER,J.CLOSE_TYPES.COMPLETE),Object(_e.d)({action:"web_trigger_import_confirm",taskCount:r})),0<n&&Object(_e.d)({action:"web_trigger_upload_confirm",taskCount:n}),this.setState(function(e){return{progressList:[].concat(v()(t),v()(e.progressList)),fileAddedUnderSuiteRoute:e.fileAddedUnderSuiteRoute||Object(ee.isUnderSuiteView)()}},function(){e.scrollerRef&&(e.scrollerRef.scrollTop=0)})}}},{key:"handleUploadTasksRemoved",value:function(r){this.setState(function(e){var t=r.map(function(e){return e.uuid});return{progressList:e.progressList.filter(function(e){return!t.includes(e.uuid)})}})}},{key:"handleUploadTasksChanged",value:function(t){var n=this,o=[];this.setState(function(e){var n=e.progressList.slice();return t.forEach(function(t){var e,r=n.findIndex(function(e){return e.uuid===t.uuid});-1!==r&&(e=n[r],t.errorType&&(t.errorText=Oe(t.errorType)),o.push({previousItem:e,currentItem:t}),n[r]=t)}),{progressList:n}},function(){o.forEach(function(e){var t=e.previousItem,r=e.currentItem;n.onTaskChanged(t,r)})})}},{key:"handleUploadSpeedChanged",value:function(e){this.setState({uploadSpeed:e})}},{key:"showUploadTips",value:function(e){switch(e&&e.errorType){case he.a.FILE_TOO_LARGE_TO_IMPORT:this.showErrorToast(m("box.uploader.import_file_too_large",e.fileNames[0],Object(V.g)(20971520)));break;case he.a.FOLDER_HAS_FILE_NOT_IMPORTABLE:this.showInfoToast(m("import.folder_partly_not_importable"));break;case he.a.FOLDER_ALL_FILES_NOT_IMPORTABLE:this.showErrorToast(m("import.folder_not_importable"));break;case he.a.FILE_NOT_IMPORTABLE:this.showErrorToast(m("import.error_obj_type"));break;case he.a.FOLDER_EMPTY:this.showErrorToast(m("common.an_empty_folder"));break;case he.a.FOLDER_HAS_FILE_TOO_LARGE_TO_UPLOAD:case he.a.FOLDER_ALL_FILES_TOO_LARGE_TO_UPLOAD:case he.a.FILE_TOO_LARGE_TO_UPLOAD:this.showErrorToast(m("box.uploader.file_too_large",e.fileNames[0],Object(V.g)(10737418240)));break;case he.a.IMPORT_WARNING_COLUMN_CUT:this.showInfoToast(m("drive.upload_warning_column_cut"));break;case he.a.IMPORT_WARNING_CELL_CUT:this.showInfoToast(m("drive.upload_warning_cell_cut"));break;case he.a.IMPORT_WARNING_COLUMN_AND_CELL_CUT:this.showInfoToast(m("drive.upload_warning_cell_and_column_cut"));break;case he.a.IMPORT_ERROR_SIZE_LIMIT:var t=20;this.showErrorToast(m("common.file_size_exceeds_limit",t));break;case he.a.IMPORT_ERROR_FOLDER_NODE_LIMIT:this.showErrorToast(X.maxShareFolderNodeErrorTips);break;case he.a.IMPORT_ERROR_ENCRYPTED:this.showErrorToast(m("drive.import_encrypt_file_not_support"));break;case he.a.IMPORT_ERROR_UNSUPPORTED_TYPE:var r=Object(V.d)(e.fileNames[0]);Y.docImportableTypes.includes(r)?this.showErrorToast(m("drive.import_xml_version_not_support_ms_word")):Y.sheetImportableTypes.includes(r)&&this.showErrorToast(m("drive.import_xml_version_not_support"));break;case he.a.IMPORT_ERROR_NUM_LIMITED:this.showErrorToast(m("drive.import_num_limited"));break;case he.a.IMPORT_ERROR_UNKNOWN_PROBLEM:this.showErrorToast(m("drive.import_unknown_problem"));break;case he.a.IMPORT_ERROR_FOLDER_NUM_LIMITED:this.showErrorToast(m("drive.import_forder_num_limited"));break;case he.a.IMPORT_ERROR_EMPTY_FILE:this.showErrorToast(m("drive.import.import_empty_file"));break;case he.a.IMPORT_ERROR_CREATE_LIMIT:this.props.manuallyShowUsageLimit(w.CreateLimitationModalType.ImportFile),this.pauseAllLoadingTasks();break;case he.a.UPLOAD_CREATE_LIMIT:this.props.manuallyShowUsageLimit(w.CreateLimitationModalType.UploadFile),this.pauseAllLoadingTasks();break;case he.a.UPLOAD_USER_STORAGE_LIMIT:this.props.manuallyShowUsageLimit(w.CreateLimitationModalType.UserStorageLimit),this.pauseAllLoadingTasks();break;case he.a.UPLOAD_ILLEGAL:this.showErrorToast(m("drive.upload_fail_illegal"))}e.responseData&&e.responseData.warningExtra&&Object(W.d)(e.responseData.warningExtra)}},{key:"showInfoToast",value:function(e){e&&z.a.info({content:e,key:"FileWarning",closable:!0,duration:5e3})}},{key:"showErrorToast",value:function(e){e&&z.a.error({content:e,key:"FileError",closable:!0,duration:5e3})}},{key:"onTaskChanged",value:function(e,t){e.status!==P.e.Success&&t.status===P.e.Success&&this.onTaskSuccess(t)}},{key:"shouldInsertUploadedFileToRecent",value:function(e){var t=this.props,r=t.currentFilterFileType,n=t.isCurrentFilterUnOrganized,o=Object(V.h)(Object(V.d)(e.name)),i=Boolean(e.parentToken),s=Object(ee.locateRoute)();return(s.isHome||s.isHomeRecents||s.isMe)&&!(n&&i)&&(r===H.d.ALL||r.includes(o))}},{key:"onTaskSuccess",value:function(e){var t,r,n,o=e.name,i=e.token,s=e.parentToken;i&&((t=this.isFolderTypeItem(e))||this.shouldInsertUploadedFileToRecent(e)&&(r=Object(re.c)().get("id"),n=Math.round(Date.now()/1e3),this.props.insertUploadedFileToRecent({currentUserId:r,now:n,file:{name:o,parentToken:s,fileToken:i,isImport:this.isImportTypeItem(e)}})),this.triggerFileListUpdate({token:i,isFolder:t,parentToken:s}))}},{key:"handleProgressBarButtonClicked",value:function(){switch(this.state.uploadStatus){case P.e.Error:this.retryAllFailedTasks();break;case P.e.Success:this.invokeUploadFileSelector();break;case P.e.Inflight:this.pauseAllLoadingTasks();break;case P.e.Paused:this.retryAllPausedTasks()}}},{key:"retryAllFailedTasks",value:(l=R()(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{t=this.state.progressList.filter(function(e){return e.status===P.e.Error}).length,Object(F.c)().retryAllFailed(),Object(_e.d)({action:"batch_re_upload",taskCount:t})}catch(e){console.error("retry all failed upload tasks error",e)}case 1:case"end":return e.stop()}},e,this)})),y)},{key:"invokeUploadFileSelector",value:function(){var i=this;Promise.all([me.e("commons--FilePicker--attachment_preview_modal--box-utils-upload-v2--box_index--doc_uploader_delay----afa6617f"),me.e("commons--box-utils-upload-v2--box_right_bar--doc_uploader_delay--lark-upload-progress-viewer--nativ--93a0e733"),me.e("box-utils-upload-v2")]).then(me.bind(null,"9k4S")).then(function(e){var t=i.props.fileEntities,r=i.getUploadParentToken(),n=e.triggerMultiFileUploadV2,o=e.JobType;n({parentToken:r,directoryType:(0,e.getDirectoryTypeByParentToken)(t,r),jobType:o.Upload,shouldAddToRecents:!0})})}},{key:"pauseAllLoadingTasks",value:(u=R()(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((e.prev=0)===(t=this.state.progressList.filter(function(e){return e.status===P.e.Inflight||e.status===P.e.Pending}).length))return e.abrupt("return");e.next=4;break;case 4:Object(F.c)().pauseAll(),Object(_e.d)({action:"batch_pause_upload",taskCount:t}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("pause all upload tasks error",e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])})),g)},{key:"retryAllPausedTasks",value:(c=R()(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{t=this.state.progressList.filter(function(e){return e.status===P.e.Paused}).length,Object(F.c)().retryAllPaused(),Object(_e.d)({action:"batch_continue_upload",taskCount:t})}catch(e){console.error("retry all paused upload tasks error",e)}case 1:case"end":return e.stop()}},e,this)})),E)},{key:"handleItemClick",value:function(t){var e=this.state.progressList.find(function(e){return e.uuid===t});if(e)switch(e.status){case P.e.Success:this.openFile(e);break;case P.e.Paused:case P.e.Error:this.retryTask(e);break;case P.e.Pending:case P.e.Inflight:this.pauseTask(e)}}},{key:"retryTask",value:(a=R()(b.a.mark(function e(t){var r,n,o,i;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{r=t.uuid,n=t.name,o=t.status,Object(F.c)().retry(r),i=o===P.e.Error?"re_upload":"continue_upload",Object(_e.d)({action:i,fileName:n})}catch(e){console.error("retry one upload task error",e)}case 1:case"end":return e.stop()}},e)})),h)},{key:"pauseTask",value:(s=R()(b.a.mark(function e(t){var r,n;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{r=t.uuid,n=t.name,Object(F.c)().pause(r),Object(_e.d)({action:"pause_upload",fileName:n})}catch(e){console.error("pause one upload task error",e)}case 1:case"end":return e.stop()}},e)})),_)},{key:"openFile",value:(i=R()(b.a.mark(function e(t){var r,n,o,i;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.token,n=t.name,this.isFolderTypeItem(t)?Object(ee.getFolderTokenFromPathname)()!==r&&Object(Z.c)("".concat(K.URL.FOLDER).concat(r)):this.isImportTypeItem(t)?(o=Y.mapTypeToSuite[Object(V.d)(n)]||"",(i=K.URL[o.toUpperCase()])&&Object(Z.c)("".concat(i).concat(r))):Object(Q.a)()?Object(Q.c)():Object(Z.c)("".concat(K.URL.FILE).concat(r)),Object(_e.d)({action:"upload_layer_open",fileToken:r,fileName:n});case 3:case"end":return e.stop()}},e,this)})),f)},{key:"handleItemLabelClick",value:(o=R()(b.a.mark(function e(t){var r,n,o;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.state.progressList.find(function(e){return e.uuid===t}))&&this.isFolderTypeItem(r)){e.next=3;break}return e.abrupt("return");case 3:try{n=Object(F.c)().getFolderUploadErrorDetail(t).files,o=n.map(function(e){var t=Oe(e.errorType);return Object.assign({},e,{errorText:t})}),this.setState({folderDialogDetail:{uuid:r.uuid,name:r.name,files:o}})}catch(e){console.error("get upload folder error msg error",e)}case 4:case"end":return e.stop()}},e,this)})),p)},{key:"clearAllUploadTasks",value:(n=R()(b.a.mark(function e(){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{Object(F.c)().cancelAll()}catch(e){console.error("clear all upload tasks error",e)}case 1:case"end":return e.stop()}},e)})),r)},{key:"onPanelClose",value:function(){var e=this;this.isCompleted?this.clearAllUploadTasks():(Object(_e.d)({action:"cancel_upload_batch"}),Object(q.a)({taskType:"upload",onAbort:function(){e.clearAllUploadTasks()}}))}},{key:"getUploadParentToken",value:function(){return Object(B.a)(Object(ee.getParentMeta)())||""}},{key:"retryFolderUpload",value:function(){var e,t=this.state,r=t.folderDialogDetail,n=t.progressList;return r&&(e=n.find(function(e){return e.uuid===r.uuid}),this.retryTask(e)),!0}},{key:"closeFolderErrorDialog",value:function(){this.setState({folderDialogDetail:null})}},{key:"setScrollerRef",value:function(e){this.scrollerRef=e}},{key:"isFolderTypeItem",value:function(e){return Y.folderType.includes(e.fileTypeNum)}},{key:"isImportTypeItem",value:function(e){return e.jobType===P.b.Import}},{key:"transformViewerStatus",value:function(e){switch(e){case P.e.Success:return"success";case P.e.Paused:return"paused";case P.e.Error:return"error";case P.e.Inflight:return"inflight";case P.e.Pending:default:return"pending"}}},{key:"getFileName",value:function(e){var t=e.status,r=e.name;return Object(de.d)(r,this.isImportTypeItem(e),t===P.e.Success)}},{key:"getDirectoryLabelText",value:function(e){var t=e.finishedCount,r=e.totalCount,n=e.status;return Object(de.a)(n===P.e.Error,t,r)}},{key:"getFileIcon",value:function(e){var t=e.name,r=e.status,n=this.isImportTypeItem(e)&&r===P.e.Success&&Object(x.k)(t);return Object(de.c)(t,this.isFolderTypeItem(e),n)}},{key:"getSubTitle",value:function(e){var t=e.status,r=e.errorText,n=e.size,o=e.progress,i=e.uploadedSize;return Object(de.e)({errorText:r,size:n,progress:o,loadedSize:i,isError:t===P.e.Error})}},{key:"getIsImportConverting",value:function(e){var t=e.status,r=e.progress;return Boolean(t===P.e.Inflight&&this.isImportTypeItem(e)&&1===r)}},{key:"getStatusIconTooltipText",value:function(e){if(this.getIsImportConverting(e))return m("box.uploader.button.cancel");switch(e.status){case P.e.Success:return this.isFolderTypeItem(e)?m("box.uploader.button.open_directory"):m("box.uploader.button.open");case P.e.Pending:case P.e.Inflight:return m("box.uploader.button.cancel");case P.e.Error:case P.e.Paused:return m("box.uploader.button.retry");default:return""}}},{key:"computeProgressViewerList",value:function(){var t=this,e=this.state.progressList.map(function(e){return{uuid:e.uuid,name:t.getFileName(e),status:t.transformViewerStatus(e.status),progress:e.progress,isDirectory:t.isFolderTypeItem(e),directoryLabelText:t.getDirectoryLabelText(e),FileIcon:t.getFileIcon(e),subTitle:t.getSubTitle(e),isImportConverting:t.getIsImportConverting(e),isDisabled:e.errorType===he.a.UPLOAD_ILLEGAL,statusIconTooltipText:t.getStatusIconTooltipText(e),getStatusIcon:t.getStatusIcon}});this.setState({viewerProgressList:e})}},{key:"render",value:function(){var e=this.props,t=e.isExpanded,r=e.expandBox,n=e.shrinkBox,o=e.currentRoute,i=this.state,s=i.doneCount,a=i.fileAddedUnderSuiteRoute,c=i.online,u=i.progressList,l=i.uploadStatus,d=i.viewerProgressList,p=0<u.length,f=Object(ee.isUnderSuiteView)()&&!a,_=M()("upload-progress-viewer",{"upload-progress-viewer-success":l===P.e.Success});return U.a.createElement(pe.a,{hasUnSaveData:this.hasUploadInProgress,getUnSaveTip:this.getUnSaveTip},U.a.createElement(fe.a,{className:_,isExpanded:t,isHidden:f,viewerProgressList:d,online:c,doneCount:s,viewerOverallStatus:this.transformViewerStatus(l),alive:p,handleProgressBarButtonClicked:this.handleProgressBarButtonClicked,setScrollerRef:this.setScrollerRef,handleItemClick:this.handleItemClick,handleItemLabelClick:this.handleItemLabelClick,onPanelClose:this.onPanelClose,expandBox:r,shrinkBox:n,currentRoute:o,viewerHeaderText:this.viewerHeaderText,viewerProgressBarButtonText:this.viewerProgressBarButtonText,viewerProgressBarStatusText:this.viewerProgressBarStatusText}),this.folderErrorDialog)}},{key:"isCompleted",get:function(){return this.state.progressList.every(function(e){return e.status===P.e.Success})}},{key:"isUploading",get:function(){return this.state.progressList.some(function(e){return e.status===P.e.Pending||e.status===P.e.Inflight})}},{key:"isPaused",get:function(){return this.state.progressList.some(function(e){return e.status===P.e.Paused})&&!this.isUploading}},{key:"folderErrorDialog",get:function(){return U.a.createElement(le.a,{key:"failure-upload-folder-modal",titleText:m("box.uploader.folder_failure_detail_title"),folderDialogDetail:this.state.folderDialogDetail,okText:m("box.uploader.folder_failure_detail_retry"),onOkClick:this.retryFolderUpload,onClose:this.closeFolderErrorDialog,progressViewerType:ue.f.WebUpload})}},{key:"viewerHeaderText",get:function(){var e=this.state,t=e.uploadStatus,r=e.online,n=e.doneCount,o=e.progressList.length;if(!r)return m("box.uploader.header.no_network");switch(t){case P.e.Success:return m("box.uploader.header.success");case P.e.Error:return m("box.uploader.header.fail");case P.e.Inflight:return"".concat(m("box.uploader.header.uploading")," ").concat(n,"/").concat(o);case P.e.Paused:return m("box.uploader.header.pause");default:return""}}},{key:"viewerProgressBarButtonText",get:function(){switch(this.state.uploadStatus){case P.e.Pending:case P.e.Inflight:return m("box.uploader.bar.all_cancel");case P.e.Paused:return m("box.uploader.bar.retry_cancel");case P.e.Error:return m("box.uploader.bar.retry");case P.e.Success:return m("box.uploader.bar.continue");default:return""}}},{key:"viewerProgressBarStatusText",get:function(){var e=this.state,t=e.uploadStatus,r=e.doneCount,n=e.uploadSpeed,o=e.progressList,i=e.totalSize,s=o.length;switch(t){case P.e.Pending:case P.e.Inflight:return"".concat(m("box.uploader.bar.speed"),": ").concat(Object(V.g)(n||0),"/s");case P.e.Paused:case P.e.Error:return m("box.uploader.bar.progress",r,s);case P.e.Success:return m("box.uploader.bar.success",s,Object(V.g)(i));default:return""}}}]),t}(U.a.PureComponent);f([Object(d.Bind)()],_.prototype,"onOnline",null),f([Object(d.Bind)()],_.prototype,"onOffline",null),f([Object(d.Bind)()],_.prototype,"setDragging",null),f([Object(d.Bind)()],_.prototype,"handleDrop",null),f([Object(d.Bind)()],_.prototype,"handleUploadTasksAdded",null),f([Object(d.Bind)()],_.prototype,"handleProgressBarButtonClicked",null),f([Object(d.Bind)()],_.prototype,"handleItemClick",null),f([Object(d.Bind)()],_.prototype,"handleItemLabelClick",null),f([Object(d.Bind)()],_.prototype,"onPanelClose",null),f([Object(d.Bind)()],_.prototype,"retryFolderUpload",null),f([Object(d.Bind)()],_.prototype,"closeFolderErrorDialog",null),f([Object(d.Bind)()],_.prototype,"setScrollerRef",null)}).call(this,me("2vAP"))},"3iXK":function(e,t,r){"use strict";var n,o,i,s,a,c;r.r(t),r.d(t,"CreateLimitationModalType",function(){return n}),r.d(t,"ConfirmationOrCancelType",function(){return i}),r.d(t,"ModuleTypeMap",function(){return a}),(o=n=n||{}).CloneFile="CloneFile",o.CopyPasteFileImage="CopyPasteFileImage",o.CreateSuite="CreateSuite",o.RestoreFileVersion="RestoreFileVersion",o.UploadFile="UploadFile",o.ImportFile="ImportFile",o.UserStorageLimit="UserStorageLimit",(s=i=i||{}).Destroy="Destroy",s.DeleteEntity="DeleteEntity",s.DeleteRecord="DeleteRecord",s.DeleteStorageFile="DeleteStorageFile",s.Default="Default",s.DeleteUnderSuite="DeleteUnderSuite",s.DeleteSoftLink="DeleteSoftLink",(c=a=a||{}).RECENT="recent",c.SEARCH="search",c.TREE="tree",c.NAME="name"},BAjd:function(e,t,r){"use strict";r.d(t,"b",function(){return c}),r.d(t,"k",function(){return n}),r.d(t,"m",function(){return i}),r.d(t,"l",function(){return f}),r.d(t,"c",function(){return u}),r.d(t,"e",function(){return d}),r.d(t,"d",function(){return y}),r.d(t,"o",function(){return _}),r.d(t,"j",function(){return E}),r.d(t,"f",function(){return O}),r.d(t,"g",function(){return m}),r.d(t,"h",function(){return v}),r.d(t,"i",function(){return b}),r.d(t,"a",function(){return R}),r.d(t,"n",function(){return T});var n,o,i,s,a=r("VIFs"),c={CHUNK_CHECK:Object(a.prependAPI)("/api/box/upload/block/check/"),CHUNK_UPLOAD:Object(a.prependDriveStreamAPI)("/api/box/stream/upload/block/"),FINISH:Object(a.prependAPI)("/api/box/upload/finish/"),PREPARE:Object(a.prependAPI)("/api/box/upload/prepare/"),IMPORT_UPLOAD:Object(a.prependAPI)("/api/parser/uploadfile/"),IMPORT_STATUS:Object(a.prependAPI)("/api/parser/getresult/")};(o=n=n||{}).beforeAdd="beforeAdd",o.cancel="cancel",o.cancelAll="cancelAll",o.complete="complete",o.error="error",o.taskProgress="taskProgress",o.fileProgress="fileProgress",o.fileError="fileError",o.fileWarning="fileWarning",o.taskAdded="taskAdded",o.taskError="taskError",o.taskRetry="taskRetry",o.tasksAdded="tasksAdded",o.taskSuccess="taskSuccess",o.pause="pause",o.pauseAll="pauseAll",o.progress="progress",o.uploadStart="uploadStart",o.offline="offline",o.online="online",o.usageLimitReached="usageLimitReached",o.collectReport="collectReport",o.pending="pending",(s=i=i||{}).upload="upload",s.import="import";var u,l,d,p,f={clearInput:"clearInput",dragOverClass:"dragOverClass",fileType:"fileType",importableType:"importableType",fileTypeErrorCallback:"fileTypeErrorCallback",finishTarget:"finishTarget",getParentToken:"getParentToken",createDirectory:"createDirectory",uploadChunk:"uploadChunk",uploadMergedChunk:"uploadMergedChunk",getMountPoint:"getMountPoint",maxFileSize:"maxFileSize",maxImportFileSize:"maxImportFileSize",maxFileSizeErrorCallback:"maxFileSizeErrorCallback",minFileSize:"minFileSize",minFileSizeErrorCallback:"minFileSizeErrorCallback",fastModeEnabled:"fastModeEnabled",emptyDirectoryCallback:"emptyDirectoryCallback",directoryNotImportableCallback:"directoryNotImportableCallback",prepareTarget:"prepareTarget",setChunkTypeFromFile:"setChunkTypeFromFile",simultaneousUploads:"simultaneousUploads",testTarget:"testTarget",throttleProgressCallbacks:"throttleProgressCallbacks",uploadTarget:"uploadTarget",xhrTimeout:"xhrTimeout",onDragStart:"onDragStart",onDragEnd:"onDragEnd",shouldAddToRecents:"shouldAddToRecents",preferMergedChunks:"preferMergedChunks"};(l=u=u||{}).ERROR="error",l.PROGRESS="progress",l.RETRY="retry",l.SUCCESS="success",l.REPORT_ERROR="report_error",(p=d=d||{}).ERROR="error",p.PENDING="pending",p.SUCCESS="success",p.UPLOADING="uploading",p.ABORT="abort";var _,h,E,g,y=3;(h=_=_||{}).ChunkError="ChunkError",h.ChunkSuccess="ChunkSuccess",h.FileFinishError="FileFinishError",h.FilePrepareError="FilePrepareError",h.FileSuccess="FileSuccess",h.FolderCreateError="FolderCreateError",h.ImportUploadError="ImportUploadError",h.ImportParseError="ImportParseError",(g=E=E||{}).Upload="upload",g.Import="import",g.Exit="Exit";var O="directory-a47de874",m=11001,v=10009,b=90002007,R="api.sheet.parser.uploadfile",T=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"]},CQgL:function(e,d,p){"use strict";(function(r){p.d(d,"c",function(){return s}),p.d(d,"a",function(){return c}),p.d(d,"d",function(){return u}),p.d(d,"b",function(){return l});var e=p("RIqP"),t=p.n(e),n=p("lZeq"),o=p("Xngx"),i=(p("BAjd"),p("QM+C")),s=(p("XMIC"),p("jryj"),[].concat(t()(i.importableTypes),t()(i.importableMimeTypes))),a=function(t,e){return e.some(function(e){return t.includes(e)})},c=function(e){return Array.from(e).map(function(e){if(e instanceof DataTransferItem){var t=e.webkitGetAsEntry();return t.isFile&&e.getAsFile?e.getAsFile():t}return e})},u=function(e){var t=c(e).map(function(e){return Object(o.d)(e.name)});return a(s,t)},l=function(e){var t=[];return(a(i.docImportableTypes,e)||a(i.sheetImportableTypes,e))&&t.push(r("filetype_office")),n.a&&a(i.mindnoteImportableTypes,e)&&t.push(r("filetype_mindnote")),t.join(r("common.comma_seperator"))}}).call(this,p("2vAP"))},FwbA:function(e,t,r){"use strict";r.d(t,"a",function(){return s}),r.d(t,"b",function(){return a});var n=r("m1/u"),o=r("H0C5"),i=r("y94N"),s=function(e){var t=Object(n.g)(e),r="";return"home"===t.get("module")?r=Object(o.k)(e).fileType.toUpperCase():"personal"===t.get("module")&&(r=Object(o.a)(i.p.MyObject)(e).fileType),r},a=function(e){return"personal"===Object(n.g)(e).get("module")&&Object(o.a)(i.p.MyObject)(e).onlyUnOrganized}},IQ5M:function(e,u,l){"use strict";(function(s){l.d(u,"d",function(){return e}),l.d(u,"c",function(){return t}),l.d(u,"b",function(){return r}),l.d(u,"a",function(){return c});var n=l("3doy"),o=l("QM+C"),i=l("ahx2"),a=l("n/R6");function e(e){var t=e.imgExceedLimit,r=e.imgNeedCharge,n=e.imgFailed,o=e.folderNotExist,i=[];t&&i.push(s("sheet.import_exceed_image_limit")),r&&i.push(s("common.storage_usage_limitation_body_upload")),n&&i.push(s("sheet.import_image_upload_error")),o&&i.push(s("sheet.import.folder_not_exist")),i.forEach(function(e){a.a.info({key:e,content:e,closable:!0,duration:c})})}function t(e){var t="";switch(e){case n.WarningType.CellCut:t=s("drive.upload_warning_cell_cut");break;case n.WarningType.ColumnAndCellCut:t=s("drive.upload_warning_cell_and_column_cut");break;case n.WarningType.ColumnCut:t=s("drive.upload_warning_column_cut")}return t}function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r="";switch(e){case n.FileErrorType.NumLimited:r=s("drive.import_num_limited");break;case n.FileErrorType.UnknownProblem:r=s("drive.import_unknown_problem");break;case n.FileErrorType.ForderNumLimited:r=s("drive.import_forder_num_limited");break;case n.FileErrorType.SizeLimited:r=s("common.file_size_exceeds_limit",20);break;case n.FileErrorType.EmptyFile:r=s("drive.import.import_empty_file");break;case n.FileErrorType.FileEncrypted:r=s("drive.import_encrypt_file_not_support");break;case n.FileErrorType.xmlVersionNotSupport:o.docImportableMimeTypes.includes(t)||o.docImportableTypes.includes(t)?r=s("drive.import_xml_version_not_support_ms_word"):(o.sheetImportableMimeTypes.includes(t)||o.sheetImportableTypes.includes(t))&&(r=s("drive.import_xml_version_not_support"));break;case n.FileErrorType.FolderNodeLimited:r=i.maxShareFolderNodeErrorTips}return r}var c=8e3}).call(this,l("2vAP"))},"Ir/a":function(e,t,r){"use strict";r.d(t,"a",function(){return u});var n=r("EWn2"),o=r("3doy"),i=10009,s=11001,a=90001041,c=90001061,u={IMPORT_WARNING_COLUMN_CUT:"WARNING-".concat(o.WarningType.ColumnCut),IMPORT_WARNING_CELL_CUT:"WARNING-".concat(o.WarningType.CellCut),IMPORT_WARNING_COLUMN_AND_CELL_CUT:"WARNING-".concat(o.WarningType.ColumnAndCellCut),IMPORT_ERROR_CREATE_LIMIT:"ERROR-".concat(s),IMPORT_ERROR_SIZE_LIMIT:"ERROR-".concat(o.FileErrorType.SizeLimited),IMPORT_ERROR_FOLDER_NODE_LIMIT:"ERROR-".concat(o.FileErrorType.FolderNodeLimited),IMPORT_ERROR_ENCRYPTED:"ERROR-".concat(o.FileErrorType.FileEncrypted),IMPORT_ERROR_UNSUPPORTED_TYPE:"ERROR-".concat(o.FileErrorType.xmlVersionNotSupport),IMPORT_ERROR_NUM_LIMITED:"ERROR-".concat(o.FileErrorType.NumLimited),IMPORT_ERROR_UNKNOWN_PROBLEM:"ERROR-".concat(o.FileErrorType.UnknownProblem),IMPORT_ERROR_FOLDER_NUM_LIMITED:"ERROR-".concat(o.FileErrorType.ForderNumLimited),IMPORT_ERROR_EMPTY_FILE:"ERROR-".concat(o.FileErrorType.EmptyFile),FOLDER_EMPTY:n.c.FolderEmpty,FOLDER_HAS_FILE_TOO_LARGE_TO_UPLOAD:n.c.FolderHasFileTooLargeToUpload,FOLDER_ALL_FILES_TOO_LARGE_TO_UPLOAD:n.c.FolderAllFilesTooLargeToUpload,FILE_TOO_LARGE_TO_UPLOAD:n.c.FileTooLargeToUpload,FOLDER_HAS_FILE_NOT_IMPORTABLE:n.c.FolderHasFileNotImportable,FOLDER_ALL_FILES_NOT_IMPORTABLE:n.c.FolderAllFilesNotImportable,FILE_TOO_LARGE_TO_IMPORT:n.c.FileTooLargeToImport,FILE_NOT_IMPORTABLE:n.c.FileNotImportable,UPLOAD_FORBIDDEN:4,UPLOAD_LOGIN_REQUIRED:5,UPLOAD_BACKEND_TIME_OUT:6,UPLOAD_ILLEGAL:i,UPLOAD_CREATE_LIMIT:s,MOUNT_POINT_DELETED:a,UPLOAD_USER_STORAGE_LIMIT:c,NETWORK_ERROR:"Network Error"}},LCeV:function(e,t,c){"use strict";c.d(t,"a",function(){return r});var u=c("uzgA"),l=c("5dbN");function r(e){var t=c("D7h9").default,r=Object(u.c)(t.getState()),n=Object(l.locateRoute)(),o=Object(l.locateRoute)(r),i=r&&o.isFolder,s=0<e.length,a="";return(n.isFolder||i)&&s&&(a=e[e.length-1].token),a}},"NG+2":function(e,t,r){"use strict";var n=r("pVnL"),o=r.n(n),i=r("QILm"),s=r.n(i),a=r("q1tI"),c=r.n(a);t.a=function(e){e.styles;var t=s()(e,["styles"]);return c.a.createElement("svg",o()({width:"16",height:"16",viewBox:"0 0 16 16"},t),c.a.createElement("path",{d:"M7 0a7 7 0 015.6 11.2l2.89 2.88a1 1 0 01-1.42 1.41l-2.88-2.88A7 7 0 117 0zm0 2a5 5 0 100 10A5 5 0 007 2z",fill:"#646A73",fillRule:"nonzero"}))}},TYER:function(e,t,r){"use strict";r.d(t,"a",function(){return d}),r.d(t,"b",function(){return Y}),r.d(t,"c",function(){return u}),r.d(t,"d",function(){return o}),r.d(t,"e",function(){return T}),r.d(t,"f",function(){return q}),r.d(t,"g",function(){return a}),r.d(t,"h",function(){return R}),r.d(t,"i",function(){return b}),r.d(t,"j",function(){return V});var b,n,o,i,R,s,a,c,u,l,d,p,T,f,_=r("cDf5"),h=r.n(_),I=r("UXvI"),S=r("XhtD"),E=r("vJtL"),g=r("YHdI"),y=r("4O8T"),C=r.n(y);(n=b=b||{})[n.SUCCESS=0]="SUCCESS",n[n.FAILED=1]="FAILED",n[n.INVALID_PARAM=2]="INVALID_PARAM",n[n.NOT_FOUND=3]="NOT_FOUND",n[n.FORBIDDEN=4]="FORBIDDEN",n[n.LOGIN_REQUIRED=5]="LOGIN_REQUIRED",n[n.LIMIT_EXCEED=6]="LIMIT_EXCEED",n[n.CHANGESET_LIMIT_EXCEED=1001]="CHANGESET_LIMIT_EXCEED",n[n.OBJECT_DELETED=1002]="OBJECT_DELETED",n[n.NOT_IN_SESSION=1003]="NOT_IN_SESSION",n[n.CHAGESET_INVALID=1005]="CHAGESET_INVALID",n[n.INTERNAL_ERROR=1006]="INTERNAL_ERROR",n[n.INVALID_MESSAGE=1007]="INVALID_MESSAGE",n[n.SYNC_FAILED=1008]="SYNC_FAILED",n[n.VERSION_TOO_OLD=1010]="VERSION_TOO_OLD",n[n.WRITE_PERMISSION_DENIED=1012]="WRITE_PERMISSION_DENIED",n[n.COMMENT_PERMISSION_DENIED=1013]="COMMENT_PERMISSION_DENIED",n[n.SERVICE_ERROR=1015]="SERVICE_ERROR",n[n.DATABASE_CONFLICT=1021]="DATABASE_CONFLICT",n[n.SERVER_BUSY=9998]="SERVER_BUSY",n[n.MISSING_VERSION_VERIFY_FAILED=-1101]="MISSING_VERSION_VERIFY_FAILED",n[n.RETRY_OVER_TIMES=-1102]="RETRY_OVER_TIMES",(i=o=o||{}).JSON="JSON",i.MESSAGE_BOX="MESSAGE_BOX",i.DOC="DOC",(s=R=R||{}).USER_NEWINFO="USER_NEWINFO",s.USER_LEAVE="USER_LEAVE",s.CLIENT_VARS="CLIENT_VARS",s.GET_VERSION="GET_VERSION",s.ENGAGEMENT_CURSOR="ENGAGEMENT_CURSOR",s.WATCH="WATCH",s.ACCEPT_WATCH="ACCEPT_WATCH",s.ACCEPT_COMMIT="ACCEPT_COMMIT",s.NEW_CHANGES="NEW_CHANGES",s.GET_MESSAGE="GET_MESSAGE",s.USER_CHANGES="USER_CHANGES",s.MESSAGE_CHANNEL="MESSAGE_CHANNEL",s.ROOM_MEMBERS="ROOM_MEMBERS",s.ERROR="ERROR",s.MESSAGE="MESSAGE",(c=a=a||{}).ENGINE_CHANNEL="engine_channel",c.MEMBER_CHANNEL="member_channel",(l=u=u||{}).Content="content",l.Note="note",l.Topic="topic",l.Title="title",l.Image="image",l.None="none",(p=d=d||{})[p.MISSING_VERSION_TOO_MANY=0]="MISSING_VERSION_TOO_MANY",p[p.MISSING_VERSION_VERIFY_FAILED=1]="MISSING_VERSION_VERIFY_FAILED",(f=T=T||{}).CLIENT_ERROR="CLIENT_ERROR",f.RESPONSE_ERROR="RESPONSE_ERROR";var k=function(){return(k=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function O(e,t){var r={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]]);return r}function m(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===("undefined"==typeof Reflect?"undefined":h()(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;0<=a;a--)(o=e[a])&&(s=(i<3?o(s):3<i?o(t,r,s):o(t,r))||s);return 3<i&&s&&Object.defineProperty(t,r,s),s}function v(e,t){if("object"===("undefined"==typeof Reflect?"undefined":h()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function L(e,s,r,a){function c(t){return t instanceof r?t:new r(function(e){e(t)})}return new(r=r||Promise)(function(t,r){function n(e){try{i(a.next(e))}catch(e){r(e)}}function o(e){try{i(a.throw(e))}catch(e){r(e)}}function i(e){e.done?t(e.value):c(e.value).then(n,o)}i((a=a.apply(e,s||[])).next())})}function N(e,r){var n,o,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function a(t){return function(e){return c([t,e])}}function c(t){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,o=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){s.label=t[1];break}if(6===t[0]&&s.label<i[1]){s.label=i[1],i=t;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(t);break}i[2]&&s.ops.pop(),s.trys.pop();continue}t=r.call(e,s)}catch(e){t=[6,e],o=0}finally{n=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function P(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function M(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function D(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(M(arguments[t]));return e}function w(e){return e&&"function"==typeof e.then}function F(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[2],o=(r.get,r.set,r.writable,r.value),n=O(r,["get","set","writable","value"]);if(!Object(E.default)(o))return r;var i=new Map;return k(k({},n),{value:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0]||s;if(!i.get(r)){var n=o.call.apply(o,D([this],e));return w(n)?(i.set(r,!0),n.then(function(e){return i.delete(r),e}).catch(function(e){throw i.delete(r),e})):console.error("should return an Promise")}}})}}function j(t){return new Promise(function(e){setTimeout(function(){e()},t)})}var U=(x.prototype.log=function(e,t){this.loggable&&console.log(this.prefix,e,t)},x.prototype.enable=function(){this.loggable=!0},x.prototype.disable=function(){this.loggable=!1},x);function x(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.loggable=!0,this.prefix="["+e.join("][")+"]"}var V=(B.prototype._log=function(e,t){void 0===t&&(t={}),this._logger.log(e,k(k({},this._loggerOptions),t))},Object.defineProperty(B.prototype,"NEW_CHANGES",{get:function(){return this._alias&&this._alias[R.NEW_CHANGES]||R.NEW_CHANGES},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"CLIENT_VARS",{get:function(){return this._alias&&this._alias[R.CLIENT_VARS]||R.CLIENT_VARS},enumerable:!0,configurable:!0}),B.prototype.registerEntity=function(){return L(this,void 0,void 0,function(){var t,r,n,o,i,s=this;return N(this,function(e){switch(e.label){case 0:return t={interval:1,callback:function(e){var t=s._version;e<=t||(console.log("engine: local: "+t+", remote: "+e),s.fetchMissVersionWithLimitingFrequency(e))}},r=Object.values(this.channels).reduce(function(e,t){var r,n=t.channel,o=t.heartbeat;return n&&o?k(k({},e),((r={})[n]=o,r)):e},((i={})[a.ENGINE_CHANNEL]=t,i)),n=this.generateWatchEntity(),o={handler:this.handleMessageFromServer,filter:n},[4,Promise.resolve(this._io.isEntityRegistered(n))];case 1:return e.sent()?(this._io.addHeartbeat(n,a.ENGINE_CHANNEL,t),this._io.addMessage(n,a.ENGINE_CHANNEL,o)):this._io.register(n,{message:o,heartbeats:r,acceptWatchHandler:this.handleAcceptWatch,isNewHeartbeatsProtocol:this._isNewProtocol}),[2]}})})},B.prototype.generateWatchEntity=function(){return k(k({type:this._syncType,token:this._token},this._requestDataOptions),this._requestWatchDataOptions)},B.prototype.syncEngineBaseRev=function(e){this.syncBaseRev("engine_channel",e)},B.prototype.syncBaseRev=function(e,t){this._receiveClientVars&&this._io.setHeartbeatVersion({type:this._syncType,token:this._token},e,t)},B.prototype.verrifyFetchMiss=function(e,t){return t[0]===e[0]},B.prototype.fetchMissVersionWithLimitingFrequency=function(e){e>this._latestVersion&&(this._latestVersion=e),this.fetchMissVersionFromCurrentToLatest()},B.prototype.fetchMissVersion=function(o){var i=this;if(this._receiveClientVars){if(!this._isFetching){var e=o[0];return o[o.length-1]-e>this.missVersionLimit?(this._log("dev_sync_fetch_missing_version_too_old"),void this.emit(R.ERROR,{type:T.RESPONSE_ERROR,msg:"version too old",code:b.VERSION_TOO_OLD,requestType:R.NEW_CHANGES})):0!==o.length?(this._log("dev_sync_fetch_missing",{rev_list:o,version:this._version}),this._isFetching=!0,(this._isNewProtocol&&this._request&&this._requestAPI?this.autoRetryRequestDoNotRelyOnIO(this._requestAPI.NEW_CHANGES,{member_id:this.memberId,token:this._token,rev_list:o}).then(function(e){return i.tryHandleErrorV2(e,R.NEW_CHANGES)}).then(function(e){var t,r=e.data,n=i.getChangesets(r);n?(t=n.sort(function(e,t){return i.getVersionOfChangeset(e)-i.getVersionOfChangeset(t)}).map(function(e){return i.getVersionOfChangeset(e)}),i.verrifyFetchMiss(o,t)?(W("NEW_CHANGES",e),i.handleNewChanges(r)):(i._log("dev_sync_fetch_missing_verrify_failed",{version:i._version,fetching_list:o,fetched_verion:t}),i.emit(R.ERROR,{code:b.MISSING_VERSION_VERIFY_FAILED,type:T.CLIENT_ERROR,msg:"fetched missing version verrified failed",options:{send:o,receive:t}}))):i._log("dev_sync_fetch_missing_no_changes")}):this.autoRetryRequest({type:this.NEW_CHANGES,member_id:this.memberId,token:this._token,rev_list:o},g.c.http).then(function(e){return i.tryHandleError(e,R.NEW_CHANGES)}).then(function(e){var t,r=e.data,n=i.getChangesets(r);n?(t=n.sort(function(e,t){return i.getVersionOfChangeset(e)-i.getVersionOfChangeset(t)}).map(function(e){return i.getVersionOfChangeset(e)}),i.verrifyFetchMiss(o,t)?i.handleMessageFromServer(e):(i._log("dev_sync_fetch_missing_verrify_failed",{version:i._version,fetching_list:o,fetched_verion:t}),i.emit(R.ERROR,{code:b.MISSING_VERSION_VERIFY_FAILED,type:T.CLIENT_ERROR,msg:"fetched missing version verrified failed",options:{send:o,receive:t}}))):i._log("dev_sync_fetch_missing_no_changes")})).finally(function(){i._log("dev_sync_fetch_missing_end",{rev_list:o,version:i._version}),i._isFetching=!1})):void this._log("dev_sync_fetch_missing_versions_is_empty",{version:this._version})}}else this._log("dev_sync_fetch_missing_before_client_vars")},B.prototype.verifyMessage=function(e){return e.type===this._syncType&&(e.data&&e.data.type===R.ERROR?e.token===this._token:e.data&&e.data.token===this._token)},B.prototype.autoRetryRequestDoNotRelyOnIO=function(n,o,i){return void 0===i&&(i=0),L(this,void 0,void 0,function(){var t,r;return N(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,6]),[4,this._request({url:n,method:"post",headers:k({"Content-Type":"application/json"},this._requestExceptWatchHeaderOptions),data:k(k({},o),this._requestDataOptions)})];case 1:return t=e.sent(),i<=0?[2,t]:t.code!==b.SERVICE_ERROR&&t.code!==b.DATABASE_CONFLICT?[3,3]:[4,j(3/i*1e3)];case 2:return e.sent(),this._log("dev_sync_request_retry_since_code",{retry:i,res_code:t.code,rev:this.version}),console.warn("[sync] retry request by server code"),[2,this.autoRetryRequestDoNotRelyOnIO(n,o,i-1)];case 3:return[3,6];case 4:if(r=e.sent(),i<=0)throw console.error("[sync] error response when io reject"),r;return[4,j(3/i*1e3)];case 5:return e.sent(),this._log("dev_sync_request_retry_since_reject",{retry:i,rev:this.version}),console.warn("[sync] retry request by net error"),[2,this.autoRetryRequestDoNotRelyOnIO(n,o,i-1)];case 6:return[2,t]}})})},B.prototype.autoRetryRequest=function(n,o,i){return void 0===o&&(o=g.c.http),void 0===i&&(i=0),L(this,void 0,void 0,function(){var t,r;return N(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,6]),[4,this._io.request(k({type:this._syncType,data:k(k({},n),this._requestDataOptions)},this._requestMessageOptions),{channel:o})];case 1:return t=e.sent(),i<=0?[2,t]:t.code!==b.SERVICE_ERROR&&t.data.code!==b.SERVICE_ERROR&&t.data.code!==b.DATABASE_CONFLICT?[3,3]:[4,j(3/i*1e3)];case 2:return e.sent(),this._log("dev_sync_request_retry_since_code",{retry:i,res_code:t.code,data_code:t.data.code,rev:this.version}),console.warn("[sync] retry request by server code"),[2,this.autoRetryRequest(n,g.c.http,i-1)];case 3:return[3,6];case 4:if(r=e.sent(),i<=0)throw console.error("[sync] error response when io reject"),r;return[4,j(3/i*1e3)];case 5:return e.sent(),this._log("dev_sync_request_retry_since_reject",{retry:i,rev:this.version}),console.warn("[sync] retry request by net error"),[2,this.autoRetryRequest(n,g.c.http,i-1)];case 6:return[2,t]}})})},B.prototype.handleChannelMessage=function(e){var t,r,n,o,i,s=e.type,a=this._channelMessageMap.get(s);a&&(t=a.getVersionOfChannelMessage,r=a.channel,n=a.refetchMessageIfVersionBreak,t&&r&&(o=t(e),(i=(this.io.getHeartbeatInfo(this.syncType,this.token)||{})[r].version)&&i+1<o&&n?n(i,o):this.syncBaseRev(r,o)),a.onChannelMessage&&a.onChannelMessage(e))},B.prototype.emit=function(e,t){this._em.emit(e,t)},B.prototype.on=function(e,t){this._em.on(e,t)},B.prototype.off=function(e,t){this._em.off(e,t)},Object.defineProperty(B.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"memberId",{get:function(){return this._io.getMemberId()+""},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"io",{get:function(){return this._io},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"channels",{get:function(){return this._channels},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"syncType",{get:function(){return this._syncType},enumerable:!0,configurable:!0}),Object.defineProperty(B.prototype,"receiveClientVars",{get:function(){return this._receiveClientVars},enumerable:!0,configurable:!0}),B.prototype.setClientVars=function(e){this.handleClientVars(e)},B.prototype.fetchClientVars=function(c){return void 0===c&&(c={}),L(this,void 0,void 0,function(){var t,r,n,o,i,s,a=this;return N(this,function(e){switch(e.label){case 0:return this._log("dev_fetch_client_vars"),this._isNewProtocol&&this._request&&this._requestAPI?[4,this.autoRetryRequestDoNotRelyOnIO(this._requestAPI.CLIENT_VARS,k({token:this._token,member_id:this.memberId},c),3).then(function(e){return a.tryHandleErrorV2(e,R.CLIENT_VARS)})]:[3,2];case 1:return(t=e.sent()).code!==b.SUCCESS?(console.error("fetchClientVars failed: ",t.data),[2,Promise.reject(t.data)]):(r=t.data,n=this.getVersionOfClientVars(r),this.handleClientVars(n),[2,r]);case 2:return[4,this.autoRetryRequest(k({type:this.CLIENT_VARS,token:this._token,member_id:this.memberId},c),g.c.http,3).then(function(e){return a.tryHandleError(e,R.CLIENT_VARS)})];case 3:return(o=e.sent()).data.type===R.ERROR?(console.error("fetchClientVars failed: ",o.data),[2,Promise.reject(o.data)]):(i=o.data,s=this.getVersionOfClientVars(i),this.handleClientVars(s),[2,i])}})})},B.prototype.handleClientVars=function(e){var t=this;this._log("dev_handle_client_vars",{version:e}),this._receiveClientVars=!0,this._version=e,this.syncEngineBaseRev(this._version);var r=this.generateWatchEntity();this._io.watch(r,{isNewProtocol:this._isNewProtocol}).catch(function(e){t._log("dev_watch_failed"),t.emit(R.ERROR,k(k({},e),{type:T.RESPONSE_ERROR,requestType:R.WATCH}))})},B.prototype.sendUserChange=function(e){var r=this;return this._log("dev_user_changes",{local_rev:this._version,rev:this._version+1}),this._isNewProtocol&&this._request&&this._requestAPI?this.autoRetryRequestDoNotRelyOnIO(this._requestAPI.USER_CHANGES,k({token:this._token,type:R.USER_CHANGES,member_id:this.memberId},e),3).then(function(e){return r.tryHandleErrorV2(e,R.USER_CHANGES)}).then(function(e){var t=e.data;W("ACCEPT_COMMIT",e),r.handleAcceptCommit(t),r.emit(R.MESSAGE,e)}):this.autoRetryRequest(k({token:this._token,type:R.USER_CHANGES,member_id:this.memberId},e),g.c.socket,3).then(function(e){return r.tryHandleError(e,R.USER_CHANGES)}).then(this.handleMessageFromServer)},B.prototype.destroy=function(){var e,t;null!==(t=(e=this.fetchMissVersionFromCurrentToLatest).cancel)&&void 0!==t&&t.call(e);var r=this.generateWatchEntity();this._io.removeMessage(r,a.ENGINE_CHANNEL),this._io.removeHeartbeat(r,a.ENGINE_CHANNEL),this._io.unRegister(r),this._em.removeEvent()},B);function B(e){var t,r,p=this,n=e.io,o=e.type,i=e.token,s=e.alias,a=e.requestMessageOptions,c=e.requestDataOptions,u=e.requestWatchDataOptions,l=e.requestExceptWatchHeaderOptions,d=e.request,f=e.requestAPI,_=e.isNewProtocol,h=e.registerChannels,E=e.logger,g=e.fetchMissWait,y=void 0===g?1e3:g;this._version=1,this._receiveClientVars=!1,this._loggerOptions={},this._em=new C.a,this._channelMessageMap=new Map,this._isFetching=!1,this._isNewProtocol=!1,this._latestVersion=1,this.tryHandleError=function(e,t){var r,n,o=e.data,i=e.request_id;return o.type===R.ERROR&&(r=o.code,n=o.msg,p._log("dev_sync_error",{code:r,requestType:t,msg:n,requestId:i}),p.emit(R.ERROR,k(k({},o),{type:T.RESPONSE_ERROR,requestType:t}))),e},this.tryHandleErrorV2=function(e,t){var r=e.code,n=e.msg;return r!==b.SUCCESS&&(p._log("dev_sync_error",{code:r,requestType:t,msg:n}),p.emit(R.ERROR,k(k({},e),{type:T.RESPONSE_ERROR,requestType:t}))),e},this.fetchMissVersionFromCurrentToLatest=function(){p._version>=p._latestVersion||p.fetchMissVersion(Object(S.a)(p._version+1,p._latestVersion+1))},this.handleMessageFromServer=function(e){if(!e.data)return p.emit(R.MESSAGE,e),e;if(H(e),!p.verifyMessage(e))return p.emit(R.MESSAGE,e),e;var t=e.data;switch(t.type){case p.NEW_CHANGES:p.handleNewChanges(t);break;case R.ACCEPT_COMMIT:p.handleAcceptCommit(t);break;default:p.handleChannelMessage(t)}return p.emit(R.MESSAGE,e),e},this.handleAcceptWatch=function(e){var t,r,n=e.data.entities,o=p._version;p.emit(R.ACCEPT_WATCH);try{for(var i=P(n),s=i.next();!s.done;s=i.next()){var a=s.value,c=a.type,u=a.token,l=a.version;if(c===p._syncType&&u===p._token)return void(l&&o<l&&p.fetchMissVersionWithLimitingFrequency(l))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},this.handleNewChanges=function(e){var t,r;if(e.over_size){var n=p.getVersionOfOversize(e);return(p._log("dev_sync_new_changes_oversize",{version:n,rev:p.version}),n<=p._version)?void p._log("dev_sync_new_changes_oversize_return"):void p.fetchMissVersionWithLimitingFrequency(n)}var o=p.getChangesets(e);if(p._log("dev_sync_new_changes",{rev_list:o.map(function(e){return p.getVersionOfChangeset(e)}),rev:p._version}),o.length)if(o.sort(function(e,t){return p.getVersionOfChangeset(e)-p.getVersionOfChangeset(t)}),p.getVersionOfChangeset(o[0])>p._version+1){var i=o[o.length-1],s=p.getVersionOfChangeset(i);p.fetchMissVersionWithLimitingFrequency(s)}else try{for(var a=P(o),c=a.next();!c.done;c=a.next()){var u=c.value,l=p.getVersionOfChangeset(u);if(!(l<=p._version)){if(l>p._version+1)break;var d=p.version;if(p._version=l,p.syncEngineBaseRev(p._version),p.isSelfChangeset(u))return p._log("dev_sync_new_changes_ack",{rev:p.version}),void p.emit(R.ACCEPT_COMMIT,u);p._log("dev_sync_emit_new_changes",{oldVersion:d,rev:p.version}),p.emit(R.NEW_CHANGES,u)}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},this.handleAcceptCommit=function(e){var t=p.getVersionOfAcceptCommit(e);p._log("dev_sync_ack",{rev:t,local_rev:p._version});var r=p._version;t===r+1?(p._version=t,p.syncEngineBaseRev(p._version),p.emit(R.ACCEPT_COMMIT,e)):r<t&&p.fetchMissVersionWithLimitingFrequency(t)},this.fetchMissVersionFromCurrentToLatest=Object(I.default)(this.fetchMissVersionFromCurrentToLatest,y),this._io=n,this._syncType=o,this._token=i,this._alias=s,this._requestMessageOptions=a||{},this._requestDataOptions=c||{},this._requestWatchDataOptions=u||{},this._requestExceptWatchHeaderOptions=l||{},this._request=d,this._requestAPI=f,this._isNewProtocol=Boolean(_),this._channels=h?h(this):{};var O=function(t){t.messageTypes&&Array.from(t.messageTypes).forEach(function(e){p._channelMessageMap.set(e,t)})};try{for(var m=P(Object.values(this.channels)),v=m.next();!v.done;v=m.next())O(v.value)}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}this._loggerOptions={sync_type:this._syncType,sync_token:window.encryptTea?window.encryptTea(this._token):""},this._logger=E||new U("DataJS","Sync",o),this.registerEntity()}function H(e){var t=e.data,r=t.type;"RESPONSE"===r||r===R.ENGAGEMENT_CURSOR||r===R.CLIENT_VARS&&"gzip_snapshot"in t||(r!==R.ERROR?console.log("received!",r,t.new_rev||t.revision||t.note_revision,e.request_id):console.error("received!",r,t.code,t.msg,e.request_id))}function W(e,t){var r=t.data;console.log("received!",e,r.new_rev||r.revision||r.note_revision,t)}var q=(Object.defineProperty(z.prototype,"messageTypes",{get:function(){return new Set([R.USER_LEAVE,R.USER_NEWINFO,R.ROOM_MEMBERS])},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"channel",{get:function(){return"member_channel"},enumerable:!0,configurable:!0}),Object.defineProperty(z.prototype,"heartbeat",{get:function(){var r=this;return{interval:1,callback:function(e,t){e<=t||(console.log("oldVersion: "+t+", newVersion: "+e),r.fetchRoomMembers())}}},enumerable:!0,configurable:!0}),z.prototype.getVersionOfChannelMessage=function(e){return e.version},z.prototype.fetchRoomMembers=function(){var n=this;return this.fetchMemberList().then(function(e){var t=e.data,r=t.version;n.setHeartbeatVersion(r),n.emit(R.ROOM_MEMBERS,t)})},z.prototype.setHeartbeatVersion=function(e){this.sync.io.setHeartbeatVersion({type:this.sync.syncType,token:this.sync.token},this.channel,e)},z.prototype.onChannelMessage=function(e){switch(e.type){case R.USER_NEWINFO:this.emit(R.USER_NEWINFO,e);break;case R.USER_LEAVE:this.emit(R.USER_LEAVE,e)}},z.prototype.on=function(e,t){this._em.on(e,t)},z.prototype.off=function(e,t){this._em.off(e,t)},z.prototype.emit=function(e,t){this._em.emit(e,t)},m([F(),v("design:type",Function),v("design:paramtypes",[]),v("design:returntype",void 0)],z.prototype,"fetchRoomMembers",null),z);function z(e,t){var r=this,n=t.fetchMemberList,o=t.shouldFetchMemberList;this.sync=e,this._em=new C.a,this.handleAcceptWatch=function(){r.fetchRoomMembers()},this.refetchMessageIfVersionBreak=function(e,t){t<=e+1||r.shouldFetchMemberList&&!1===r.shouldFetchMemberList()||r.fetchRoomMembers()},this.fetchMemberList=n,this.shouldFetchMemberList=o,e.on(R.ACCEPT_WATCH,this.handleAcceptWatch)}var Y=(Object.defineProperty(X.prototype,"messageTypes",{get:function(){return new Set([R.ENGAGEMENT_CURSOR])},enumerable:!0,configurable:!0}),X.prototype.onChannelMessage=function(e){this.emit(R.ENGAGEMENT_CURSOR,e)},X.prototype.on=function(e,t){this._em.on(e,t)},X.prototype.off=function(e,t){this._em.off(e,t)},X.prototype.emit=function(e,t){this._em.emit(e,t)},X);function X(){this._em=new C.a}},WzBf:function(e,t,r){"use strict";r.d(t,"a",function(){return d});var n=r("lwsE"),o=r.n(n),i=r("W8MJ"),s=r.n(i),a=r("mJXI"),c=r("5gS9"),u=r("toa8"),l=r("rLED"),d=function(){function i(){o()(this,i)}return s()(i,null,[{key:"register",value:function(e,t){var r=this.generateOptions(e),n=r.token,o=i.messageBoxMap.get(n);o||(o=new a.a(r,c.b.getInstance(),u.d,Object(l.H)()),i.messageBoxMap.set(n,o)),o.register(t,r.subtype)}},{key:"deregister",value:function(e,t){var r=this.generateOptions(e),n=i.messageBoxMap.get(r.token);n&&(n.deregister(t,r.subtype),n.isRegistered()||(n.destory(),i.messageBoxMap.delete(r.token)))}},{key:"onError",value:function(e,t){var r=this.generateOptions(e),n=i.messageBoxMap.get(r.token);n||(n=new a.a(r,c.b.getInstance(),u.d,Object(l.H)()),i.messageBoxMap.set(r.token,n)),n.onError(t)}},{key:"removeErrorListener",value:function(e,t){var r=this.generateOptions(e),n=i.messageBoxMap.get(r.token);n&&n.removeErrorListener(t)}},{key:"generateOptions",value:function(e){return"string"==typeof e?{token:e}:e}}]),i}();d.messageBoxMap=new Map},XhtD:function(e,t,r){"use strict";var n=r("eHo2"),o=Object(n.a)();t.a=o},YsLn:function(e,t,r){"use strict";r.d(t,"a",function(){return i}),r.d(t,"c",function(){return s}),r.d(t,"b",function(){return a}),r.d(t,"i",function(){return c}),r.d(t,"d",function(){return u}),r.d(t,"h",function(){return l}),r.d(t,"l",function(){return d}),r.d(t,"k",function(){return p}),r.d(t,"e",function(){return f}),r.d(t,"g",function(){return _}),r.d(t,"j",function(){return h}),r.d(t,"f",function(){return E}),r.d(t,"m",function(){return g});var n=r("S9xK"),o=r("jp/M"),i=function(){return{type:o.actionTypes.box.EMIT_UPDATE_STORAGE_USAGES}},s=function(e){return{type:n.a.SET_CURRENT_FOLDER_IMAGE_LIST_INFO,payload:e}},a=function(){return{type:n.a.RESET_CURRENT_FOLDER_IMAGE_LIST_INFO}},c=function(e){return{type:o.actionTypes.box.SET_PREVIEW_SDK_DOWNLOAD,payload:e}},u=function(e){return{type:o.actionTypes.box.SET_FILE_FIND,payload:e}},l=function(e){return{type:o.actionTypes.box.SET_PDF_PRINT,payload:e}},d=function(){return{type:o.actionTypes.box.UPDATE_VERSION_SEED}},p=function(e,t){return{type:o.actionTypes.box.FILE_NAME_UPDATED,payload:{fileName:e,version:t}}},f=function(e){return{type:o.actionTypes.box.SET_IFRAME_LAYER_SHOW,payload:e}},_=function(e){return{type:n.a.SET_BOX_SUITE_IS_IN_EDIT_MODE,payload:e}},h=function(){return{type:o.actionTypes.box.TOGGLE_FILE_INFO_PANEL}},E=function(e){return{type:n.a.SET_IS_FILE_DRAGGING,payload:e}},g=function(e){var t=e.token,r=e.isFolder,n=e.parentToken;return{type:o.actionTypes.box.UPLOAD_SUCCESS,payload:{token:t,isFolder:r,parentToken:n}}}},"b+Vi":function(e,t,r){"use strict";r.d(t,"b",function(){return p}),r.d(t,"d",function(){return f}),r.d(t,"c",function(){return _}),r.d(t,"a",function(){return h});var n,o=r("7EGn"),i=r("EWn2"),s=r("skFV"),a=r("VIFs"),c=r("rAc3"),u=r("wCm6"),l=r("+mgp");function d(){var e=Object(a.getDomainConfig)("tea");if(e&&!0===e.open)return{appID:Object(o.default)(e,"config.appId.drive_sdk"),channelDomain:Object(o.default)(e,"config.channel_domain"),userID:window.User.id,tenantID:window.User.tenantId}}function p(){return{customRequest:l.i?u.a:void 0,spaceAPIHosts:Object(s.r)(),driveAPIHosts:Object(s.i)(),nearbyDriveAPIHosts:Object(s.j)(),isOnlineEnv:!(Object(s.D)()||Object(s.z)()),isLocalhost:Object(s.z)(),teaConfig:d(),source:"CCM"}}function f(){return n?(console.warn("Uploader already initialized."),n):n=new i.d({envConfigs:p()})}function _(){if(!n)throw new Error("Uploader not initialized.");return n}function h(e,t){if(e&&t){var r=e.get(t);if(r&&Object(c.a)(r))return i.a.NewSharedFolder;if(r&&Object(c.k)(r))return i.a.V3Folder}return i.a.Normal}},cMuO:function(e,t,r){"use strict";r.r(t);var n=r("YsLn"),o=r("m/+l"),i=r("/PhZ"),s=r("XMIC"),a=r("m1/u"),c=r("5cZX"),u=r("aR0j"),l=r("FwbA"),d=r("0vdM"),p=function(e){return{currentRoute:Object(a.g)(e),currentFilterFileType:Object(l.a)(e),isCurrentFilterUnOrganized:Object(l.b)(e),currentFolderUserPermission:Object(c.h)(e),fileEntities:Object(u.y)(e)}},f={openModal:s.c,closeModal:s.b,setIsFileDragging:n.f,uploadSuccess:n.m,insertUploadedFileToRecent:i.insertUploadedFileToRecent,manuallyShowUsageLimit:i.manuallyShowUsageLimit};t.default=Object(o.connect)(p,f)(d.a)},dvZ7:function(e,t,r){"use strict";var O=r("7EGn"),i=r("BmhO"),s=r("TtEC"),n=r("WzBf");function o(e){return{token:"DRIVE_PREVIEW_EVENT_".concat(e),resourceType:"DRIVE_PREVIEW_EVENT",routeType:"local",routeKey:""}}function a(e,t){var r=o(e);n.a.register(r,t),n.a.onError(r,function(e){console.error("[MessageBoxError]:",e)})}function c(e,t){var r=o(e);n.a.deregister(r,t)}var u={register:a,deregister:c},m=r("Xngx"),l=r("rLED"),d=r("vE74"),p=r("QM+C"),f=r("iP/4"),v=r("skFV"),_=r("f8Ac"),b=r("5dbN"),h=r("omim"),E=r("EVj1"),g=r("VI6H"),y=r("EQyw"),R=r("erPj"),T=r("wCm6"),I=r("zaV1"),S=r("2ACu"),C=r("lgTS"),k=r("ucr6"),L=r("1dfU");function N(e){var t=e.file,r=e.files;if(!t||t instanceof C.e)return null;var n=t.get("type"),o=(t.get("subtype")||"").toLowerCase();return n===p.NUM_SUITE_TYPE.FILE&&i.u.includes(o)?r.filter(function(e){var t=e.get("type"),r=(e.get("subtype")||"").toLowerCase();return e instanceof C.f&&t===p.NUM_SUITE_TYPE.FILE&&i.u.includes(r)}).map(function(e){return e.get("obj_token")}):null}function P(e){var t=p.mapTypeToSuite[Object(m.d)(e).toLowerCase()]||"";return p.NUM_SUITE_TYPE[t.toUpperCase()]}function M(e){var t=e.action,r=void 0===t?"":t,n=e.fileToken,o=void 0===n?"":n,i=e.fileName,s=void 0===i?"":i,a=e.status,c=void 0===a?"success":a,u=e.subConfirmType,l=void 0===u?"":u,d=e.source,p=void 0===d?"":d,f=e.isCrossTenant,_=e.dummyToken,h=Object(m.d)(s),E=Object(b.getCurrentRouteObj)(),g=E&&E.module?E.module:"",y=E&&E.subModule?E.subModule:"";Object(S.default)("client_content_management",{action:r,source:p,sub_file_type:h,file_id:o?Object(L.a)(o):"",dummy_token:_&&Object(L.a)(_),module:g,sub_module:y,status_name:c,sub_confirm_type:l,file_is_cross_tenant:f,api_host:v.d,location_country:Object(O.default)(window,"User.locationCountry")})}function D(e){var t=e.action,r=void 0===t?"":t,n=e.status,o=void 0===n?"success":n,i=e.subConfirmType,s=void 0===i?"":i,a=e.source,c=void 0===a?"":a,u=e.isCrossTenant,l=Object(b.getCurrentRouteObj)(),d=l&&l.module?l.module:"",p=l&&l.subModule?l.subModule:"";Object(S.default)("client_content_management",{action:r,source:c,file_type:"folder",sub_file_type:"",file_id:"",module:d,sub_module:p,status_name:o,sub_confirm_type:s,file_is_cross_tenant:u||void 0,api_host:v.d,location_country:Object(O.default)(window,"User.locationCountry")})}function w(e){var t,r=e.action,n=void 0===r?"":r,o=e.source,i=void 0===o?"direct":o,s=e.eventType,a=void 0===s?"mouseclick":s,c=e.commentId,u=void 0===c?"":c,l=e.replyId,d=void 0===l?"":l,p=e.statusCode,f=void 0===p?0:p,_=e.statusName,h=void 0===_?"success":_,E=e.commentType,g=void 0===E?"full_comment":E,y=Object(I.a)();y&&y.type&&(t=y.type,Object(S.default)("client_comment",{action:n,eventType:a,source:i,comment_type:g,comment_id:u,reply_id:d,comment_target_type:"whole_file",zone:"full_comment",mode:"drive_view",status_code:f,status_name:h,sub_file_type:t||""}))}function F(e){var t=e.action,r=void 0===t?"":t,n=e.source,o=void 0===n?"":n,i=e.eventType,s=void 0===i?"mouseclick":i,a=e.subFileType,c=Object(I.a)(),u=a||c&&c.type||"";Object(S.default)("toggle_attribute",{product_type:"drive",eventType:s,sub_file_type:u,mode:"drive_view",action:r,source:o})}function j(e){var t=e.source,r=e.action,n=e.subFileType,o=e.fileToken,i=Object(b.getCurrentRouteObj)(),s=i&&i.module?i.module:"";Object(S.default)("office_online_edit",{source:t,action:r,module:s,file_type:"file",sub_file_type:n,file_id:o?Object(L.a)(o):""})}function U(e){var t=e.costTime,r=e.fileToken,n=e.stage;Object(S.default)("dev_box_load_performance",{stage:n,file_id:r?Object(L.a)(r):"",cost_time:t})}function x(){window.dispatchEvent(Object(d.b)("resize"))}r.d(t,"i",function(){return N}),r.d(t,"k",function(){return P}),r.d(t,"b",function(){return M}),r.d(t,"d",function(){return D}),r.d(t,"a",function(){return w}),r.d(t,"f",function(){return F}),r.d(t,"e",function(){return j}),r.d(t,"c",function(){return U}),r.d(t,"p",function(){return x}),r.d(t,"h",function(){return H}),r.d(t,"j",function(){return z}),r.d(t,"g",function(){return X}),r.d(t,"m",function(){return K}),r.d(t,"l",function(){return J}),r.d(t,"o",function(){return Q}),r.d(t,"n",function(){return Z});var V={isOnlineEnv:!(Object(v.D)()||Object(v.z)()),apiHosts:Object(v.r)(),driveApiHosts:Object(v.i)(),fileUrlPrefix:Object(v.k)().fileURLPrefix||"",isLocalhost:Object(v.z)(),fileWebOfficeDomain:Object(v.k)().fileWebOfficeDomain||"",updatePreviewTplSeed:Object(v.k)().updatePreviewTplSeed},B=Object(v.g)().tea;function H(e){var t=Object(g.c)(),n=[],r=f.a.isInVC;r&&n.push(i.n.SHEET),(r||p.isAnonymousAccess||f.a.isFeed||!e)&&n.push(i.n.WPS);var o=function(e){var t=n.slice(),r=K(e);return r.edit||r.preview||t.push(i.n.WPS),t};return{customRequest:T.a,PreviewMessageHandler:u,envConfig:V,seclinkEnabled:s.j,languageType:Object(_.a)(),userId:t.get("id")||window.User.id,tenantId:t.get("tenant_id")||window.User.tenantId,showDownloadProgress:h.g,enablePDFProgressCache:!0,enableSheetProgressCache:!0,enableMediaProgressCache:!0,getDisabledPreviewComponents:o,maxPollCount:Object(s.f)(),pdfRangeChunkSize:Object(s.g)(),showPDFDigitalSign:!0,unsupportedVideoCodec:Object(s.h)(),authority:{downloadable:Object(R.c)(),printable:Object(R.e)(),exportable:Object(R.d)(),copyable:Object(R.b)()},floatingToolbarHiddenOnStart:f.a.isInVC}}B&&!0===B.open&&(V.teaConfig={sdkAppId:Object(O.default)(B,"config.appId.drive_sdk"),suiteAppId:Object(O.default)(B,"config.appId.doc"),singleProductAppID:Object(O.default)(B,"config.appId.single_product"),channelDomain:Object(O.default)(B,"config.channel_domain")}),V.slardarConfig={slardarCommonConfig:Object(v.g)().slardar,slardarMinaConfig:Object(l.L)("slardar_config"),sentryConfig:Object(v.g)().sentry,sentryMinaConfig:Object(l.L)("sentry_filter_config"),scm:Object(O.default)(window,"scm"),rvRev:Object(O.default)(window,"rv_rev")};var W=["pdf","csv"];function q(e){return!W.includes(e)&&i.l.includes(e)}function z(e){return Boolean(e&&e.weboffice)}function Y(e){var t=Object(m.d)(e);return Object(s.a)()&&i.H.includes(t)}function X(e){return Object(s.d)()&&q(Object(m.d)(e))||Y(e)}function K(e){if(!e)return{preview:!1,edit:!1};var t=z(e);return Y(e.name)?{preview:t,edit:t}:{preview:Boolean(t&&Object(s.e)()),edit:Boolean(t&&Object(s.d)()&&!W.includes(Object(m.d)(e.name)))}}function J(e,t){var r=K(e);return t?r.edit:r.preview}function Q(e){var t=Object(E.l)(k.a.location.search)||{};e?t.office_edit="1":delete t.office_edit,k.a.replace({search:Object(E.d)(t)})}function Z(e){return e&&!Object(y.a)()}},eHo2:function(e,t,r){"use strict";var a=Math.ceil,c=Math.max;function n(e,t,r,n){for(var o=-1,i=c(a((t-e)/(r||1)),0),s=Array(i);i--;)s[n?i:++o]=e,e+=r;return s}var o=n,i=r("XFn8"),s=r("ywm8");function u(n){return function(e,t,r){return r&&"number"!=typeof r&&Object(i.a)(e,t,r)&&(t=r=void 0),e=Object(s.a)(e),void 0===t?(t=e,e=0):t=Object(s.a)(t),r=void 0===r?e<t?1:-1:Object(s.a)(r),o(e,t,r,n)}}t.a=u},"li/R":function(e,t,r){"use strict";var n=r("lwsE"),o=r.n(n),i=r("W8MJ"),s=r.n(i),a=r("a1gu"),c=r.n(a),u=r("Nsbk"),l=r.n(u),d=r("7W2i"),p=r.n(d),f=r("q1tI"),_=r.n(f),h=function(e){function t(){var r;return o()(this,t),(r=c()(this,l()(t).apply(this,arguments))).handlePageBeforeUnload=function(e){if(r.props.hasUnSaveData()){var t=r.props.getUnSaveTip();return(e=e||window.event)&&(e.returnValue=t),t}},r}return p()(t,e),s()(t,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.handlePageBeforeUnload)}},{key:"componentWillUnMount",value:function(){window.removeEventListener("beforeunload",this.handlePageBeforeUnload)}},{key:"render",value:function(){return _.a.createElement(_.a.Fragment,null,this.props.children)}}]),t}(_.a.Component);t.a=h},mJXI:function(e,t,r){"use strict";r.d(t,"a",function(){return _});var a=r("Bw5p"),c=r("TYER"),n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function o(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var u=function(){return(u=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function d(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var i,p=(o(s,i=c.j),s.prototype.getVersionOfOversize=function(e){return e.version},s.prototype.getVersionOfChangeset=function(e){return e.version},s.prototype.getChangesets=function(e){return e.messages},s.prototype.getVersionOfClientVars=function(e){return e.version},s.prototype.getVersionOfAcceptCommit=function(e){return e.version},s.prototype.isSelfChangeset=function(){return!1},s);function s(e){var t=i.call(this,u(u({},e),{requestAPI:{CLIENT_VARS:"/api/msg_box/get_version",NEW_CHANGES:"/api/msg_box/get_message",USER_CHANGES:""}}))||this;return t.missVersionLimit=100,t}var f=(l.prototype.log=function(e,t){this.loggable&&console.log(this.prefix,e,t)},l.prototype.enable=function(){this.loggable=!0},l.prototype.disable=function(){this.loggable=!1},l);function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.loggable=!0,this.prefix="["+e.join("][")+"]"}var _=(h.prototype.destory=function(){this.sync&&this.sync.destroy(),this.messageCallbackSet.clear(),this.messageSubtypeCallbackMap.clear(),this.errorCallbackSet.clear()},h.prototype.getMessageCallbackSetSize=function(){return this.messageCallbackSet.size},h.prototype.isRegistered=function(){return!(!this.messageCallbackSet.size&&!this.messageSubtypeCallbackMap.size)},h.prototype.getErrorCallbackSetSize=function(){return this.errorCallbackSet.size},h);function h(e,t,r,n){var l=this;this.options=e,this.io=t,this.request=r,this.isNewProtocol=n,this.messageCallbackSet=new Set,this.messageSubtypeCallbackMap=new Map,this.errorCallbackSet=new Set,this.connect=function(){var e,t,r=l.options,n=l.io,o=l.request,i=r.token,s=r.version;l.sync=new p({token:i,io:n,type:c.d.MESSAGE_BOX,alias:((e={})[c.h.NEW_CHANGES]="GET_MESSAGE",e[c.h.CLIENT_VARS]="GET_VERSION",e),logger:r.resourceType?new f("DataJS","Sync",c.d.MESSAGE_BOX,null!=(t=r.resourceType)?t:""):new f("DataJS","Sync",c.d.MESSAGE_BOX),requestDataOptions:u(u({},Object(a.a)(r,["extra"])),{resource_type:r.resourceType}),requestWatchDataOptions:{route_type:r.routeType,route_key:r.routeKey},requestExceptWatchHeaderOptions:{"route-key":r.routeKey,"route-type":r.routeType},request:o,isNewProtocol:l.isNewProtocol}),l.sync.on(c.h.NEW_CHANGES,l.handleMessage),l.sync.on(c.h.ERROR,l.handleSyncError),void 0!==s?l.sync.setClientVars(s):l.sync.fetchClientVars()},this.register=function(e,t){var r,n=l.messageCallbackSet,o=l.messageSubtypeCallbackMap;t?((r=o.get(t))||(r=new Set,o.set(t,r)),r.add(e)):n.add(e)},this.deregister=function(e,t){var r,n=l.messageCallbackSet,o=l.messageSubtypeCallbackMap;t?(r=o.get(t))&&(r.delete(e),0===r.size&&o.delete(t)):n.delete(e)},this.onError=function(e){return l.errorCallbackSet.add(e),l.errorCallbackSet.size},this.removeErrorListener=function(e){return l.errorCallbackSet.delete(e),l.errorCallbackSet.size},this.handleMessage=function(e){var t,r,n=e.message,o=e.extra,i=e.sub_type;if(n){var s=i?l.messageSubtypeCallbackMap.get(i):l.messageCallbackSet;if(s)try{for(var a=d(s),c=a.next();!c.done;c=a.next()){var u=c.value;u&&u(n,o)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},this.handleSyncError=function(e){var t,r;try{for(var n=d(l.errorCallbackSet),o=n.next();!o.done;o=n.next()){var i=o.value;i&&i(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},this.connect()}},wCm6:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var n=r("gSGL"),o=r("toa8"),i=function(e){var t=Boolean(e.ignoreInterceptors),r=Math.max(e.url.indexOf("/api"),0);return e.url=e.url.substring(r),Object(o.d)(Object.assign({},e,{headers:Object.assign({"Content-Type":"application/json"},e.headers),ignoreInterceptors:t})).then(function(e){return t?e:{data:Object(n.a)(e.data)?e.data:e}}).catch(function(e){throw e.originalError||e})}}}]);
//# sourceMappingURL=web-upload-progress-viewer.38ea319b7c20dfbfdbc0.js.map