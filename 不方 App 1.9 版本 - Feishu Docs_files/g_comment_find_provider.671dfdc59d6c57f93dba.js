(this.webpackJsonp=this.webpackJsonp||[]).push([["g_comment_find_provider","comment_find_provider"],{D28M:function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"p",function(){return s}),n.d(e,"n",function(){return o}),n.d(e,"f",function(){return c}),n.d(e,"g",function(){return u}),n.d(e,"h",function(){return a}),n.d(e,"c",function(){return d}),n.d(e,"q",function(){return l}),n.d(e,"l",function(){return f}),n.d(e,"b",function(){return h}),n.d(e,"o",function(){return m}),n.d(e,"j",function(){return v}),n.d(e,"m",function(){return p}),n.d(e,"k",function(){return g}),n.d(e,"d",function(){return y}),n.d(e,"r",function(){return E}),n.d(e,"i",function(){return C}),n.d(e,"e",function(){return k});var r=n("nVH4");function i(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.classList?r.forEach(function(t){return e.classList.add(t)}):e.getAttribute&&(t=(e.getAttribute("class")||"").split(" ").filter(function(t){return!r.includes(t)}).concat(r).join(" "),e.setAttribute("class",t))}function s(e){for(var t,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.classList?r.forEach(function(t){return e.classList.remove(t)}):e.getAttribute&&(t=(e.getAttribute("class")||"").split(" ").filter(function(t){return!r.includes(t)}).join(" "),e.setAttribute("class",t))}function o(t){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelector(t)}function c(t,e){return t.classList?t.classList.contains(e):!!t.getAttribute&&(t.getAttribute("class")||"").split(" ").some(function(t){return t===e})}function u(t,e){return t.classList?Array.from(t.classList).find(function(t){return 0===t.indexOf(e)}):!!t.getAttribute&&(t.getAttribute("class")||"").split(" ").find(function(t){return 0===t.indexOf(e)})}function a(t,e){for(var n=!1,r=0;r<e.length;r++)u(t,e[r])&&(n=!0);return n}function d(t){var e=document.createElement("style");return e.appendChild(document.createTextNode(t)),e}function l(t){var e;!t||(e=t.parentNode)&&e.removeChild(t)}function f(t,e){for(;t;){if(c(t,e))return!0;t=t.parentNode}return!1}function h(t,e){for(;e;){if(e===t)return!0;e=e.parentNode}return!1}function m(t,e){for(;t;){if(c(t,e))return t;t=t.parentNode}return null}function v(t){var e=t.getBoundingClientRect();return 0<=e.top&&0<=e.left&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function p(t){return t.previousElementSibling||t.previousSibling}function g(t){return t.nextElementSibling||t.nextSibling}function y(t,e){if(!t)return null;for(var n=t,r=0;n!==e&&null!==n;){r+=n.offsetTop;var i=n.offsetParent||b(n);if(!(i instanceof HTMLElement))return console.error(i,"is not HTMLElement"),null;n=i}return r}function b(t){return t&&t.classList.contains("ace-line-collapsed")?t.parentNode:null}function E(t,e){var n=y(t,e);null!==n&&(e.scrollTop=n)}function C(t){return!!t.setAttribute}function k(t){return t instanceof HTMLElement&&-1!==t.className.indexOf(r.b)&&t.dataset.magicdomid&&document.getElementById(t.dataset.magicdomid)||t}},"RU+H":function(t,e,n){"use strict";var r=n("RIqP"),i=n.n(r),s=n("lwsE"),o=n.n(s),c=n("W8MJ"),u=n.n(c),a=n("26FU"),d=function(){function t(){o()(this,t),this.servicesSet=new Set,this.newServices$=new a.a([]),this.services$=this.newServices$.asObservable()}return u()(t,[{key:"sortServices",value:function(){return i()(this.servicesSet).sort(function(t,e){return t.constructor.ORDER_VALUE-e.constructor.ORDER_VALUE})}},{key:"register",value:function(t){this.servicesSet.has(t)||(this.servicesSet.add(t),this.newServices$.next(this.sortServices()))}},{key:"unregister",value:function(t){this.servicesSet.has(t)&&(this.servicesSet.delete(t),this.newServices$.next(this.sortServices()))}},{key:"services",get:function(){return this.newServices$.getValue()}}]),t}();e.a=new d},S5QH:function(t,e,n){"use strict";n.r(e);var r=n("lwsE"),i=n.n(r),s=n("W8MJ"),o=n.n(s),c=n("a1gu"),u=n.n(c),a=n("Nsbk"),d=n.n(a),l=n("7W2i"),f=n.n(l),h=function(t){function e(){return i()(this,e),u()(this,d()(e).apply(this,arguments))}return f()(e,t),e}(n("aucw").a),m=n("v3vQ");n.d(e,"GlobalCommentFindProvider",function(){return v}),n.d(e,"globalCommentFindProvider",function(){return p});var v=function(t){function e(){return i()(this,e),u()(this,d()(e).apply(this,arguments))}return f()(e,t),o()(e,[{key:"findImpl",value:function(o){var c=this;if(0===o.length)return[];var u=[];return this.commentList.map(function(t){var e=t.commentId,n=t.reply_id,r=t.content,i=t.translate_content,s={key:o,commentId:e,replyId:n,content:r,translateContent:i};c.findSelectionsFromData(s).map(function(t){u.push(c.createCommentFindMatch(t))})}),this.updateMatches(u),u}},{key:"createCommentFindMatch",value:function(t){return new h(t,this)}}]),e}(m.AbstractCommentFindProvider);v.ORDER_VALUE=11;var p=new v},aucw:function(t,e,n){"use strict";n.d(e,"a",function(){return m});var r=n("o0o1"),c=n.n(r),i=n("yXPU"),u=n.n(i),s=n("lwsE"),a=n.n(s),o=n("W8MJ"),d=n.n(o),l=n("Muja"),f=n("D28M");function h(t,e){var n,r=Object(f.d)(t,e);null!=r&&(n=e.offsetHeight,e.scrollTop=Math.max(0,r-n/2))}var m=function(){function n(t,e){a()(this,n),this.selection=t,this.provider=e,this.isDestroyed=!1}function t(){return e.apply(this,arguments)}var e,r,i;function s(){return r.apply(this,arguments)}function o(t){return i.apply(this,arguments)}return d()(n,[{key:"getRenderer",value:function(){var t=this.selection,e=t.commentId,n=t.replyId,r=t.isTranslateContent;return this.provider.getRenderer(e,n,r)}},{key:"highlight",value:(i=u()(c.a.mark(function t(e){var n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isDestroyed)return t.abrupt("return");t.next=2;break;case 2:if(void 0!==e&&(this.selection.isSelected=e),n=this.getRenderer(),e&&!n)return t.next=7,this.waitCommentRendered();t.next=8;break;case 7:n=this.getRenderer();case 8:if(n){t.next=10;break}return t.abrupt("return");case 10:if(this.isDestroyed)return t.abrupt("return");t.next=12;break;case 12:n.highlight(this.selection);case 13:case"end":return t.stop()}},t,this)})),o)},{key:"clearHighlight",value:function(){var t=this.getRenderer();t?t.clearHighlight(this.selection):console.warn("clearHighlight: renderer not found",JSON.stringify(this.selection))}},{key:"waitCommentRendered",value:(r=u()(c.a.mark(function t(){var e,n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.getRenderer())return t.abrupt("return",!0);t.next=3;break;case 3:return n=this.selection.commentId,t.next=6,this.provider.commentBox.waitCommentRendered(n);case 6:return(e=this.getRenderer())||console.warn("waitCommentRendered: renderer not found",JSON.stringify(this.selection)),t.abrupt("return",!!e);case 9:case"end":return t.stop()}},t,this)})),s)},{key:"scrollIntoView",value:(e=u()(c.a.mark(function t(){var e,n,r;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.waitCommentRendered();case 2:if(e=this.getRenderer()){t.next=5;break}return t.abrupt("return");case 5:try{n=this.provider.commentBox.getScrollContainer(),r=e.element,Object(f.j)(r)||h(r,n)}catch(t){console.error("scrollIntoView: ",t)}case 6:case"end":return t.stop()}},t,this)})),t)},{key:"destroy",value:function(){this.isDestroyed=!0}},{key:"isOnSelection",value:function(t){return Object(l.default)(t,this.selection)}},{key:"getSelectNextTimesAfterReplacement",value:function(){return 0}},{key:"getPosition",value:function(){return{top:0,left:0}}},{key:"isReplaceable",value:function(){return!1}}]),n}()},nVH4:function(t,e,n){"use strict";n.d(e,"c",function(){return r}),n.d(e,"a",function(){return i}),n.d(e,"d",function(){return s}),n.d(e,"b",function(){return o});var r={RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ESC:27,BACKSPACE:8,AT:50,A:65,DELETE:46,H:72},i={UP:r.UP,DOWN:r.DOWN,LEFT:r.LEFT,RIGHT:r.RIGHT},s={IMAGE:"POPUP_IMAGE",CARD:"POPUP_CARD",TEXT:"POPUP_TEXT",SHEET:"POPUP_SHEET",BLOCK:"POPUP_BLOCK",TABLE:"POPUP_TABLE",TABLE_CELL:"POPUP_TABLE_CELL",CODE_BLOCK_V2:"CODE_BLOCK_V2",CALLOUT_BLOCK:"CALLOUT_BLOCK"},o="fake-list-number-trigger"},s4kO:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("S5bw"),c=n("xlPZ");function r(t,e,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,s=new o.a(t,e,r);return function(t){return Object(c.a)(function(){return s},i)(t)}}},v3vQ:function(t,e,n){"use strict";n.r(e);var r=n("a1gu"),i=n.n(r),s=n("Nsbk"),o=n.n(s),c=n("7W2i"),u=n.n(c),a=n("lwsE"),d=n.n(a),l=n("W8MJ"),f=n.n(l),h=n("Gi3i"),m=n("p0Sj"),v=n("67Y/"),p=n("s4kO"),g=n("yGWI"),y=n("K9Ia"),b=n("p0ib"),E=n("F/XL"),C=n("RU+H"),k=n("aucw"),x=n("J4zp"),O=n.n(x),I=n("uQON");function w(t){return t.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function L(t){var c={},u=0,a="";return t.map(function(t){var e=t.startIndex,n=t.endIndex,r=t.content,i=e,s=n;t.isAtNode&&(i+=t.head.length,s-=t.tail.length),a+=r;for(var o=i;o<s;o++)c[u]=o,u++}),{newContent:a,textIndexMap:c}}function R(t,e,n){var r,i,s=O()(e,2),o=s[0],c=s[1],u=[];if(n.map(function(t,e){t.startIndex<=o&&(r=e),void 0===i&&t.endIndex>=c&&(i=e)}),void 0===r||void 0===i)return console.error("findBlocksByRange: no results"),[];var a=n[r];if(r===i)return[{startIndex:o,endIndex:c,content:t.slice(o,c)}];var d=Math.min(c,a.endIndex-(a.tail?a.tail.length:0));u.push({startIndex:o,endIndex:d,content:t.slice(o,d)});for(var l,f,h=r+1;h<i;h++){var m=n[h];u.push({startIndex:m.startIndex+(m.head?m.head.length:0),endIndex:m.endIndex-(m.tail?m.tail.length:0),content:m.content})}return r<i&&(f=(l=n[i]).startIndex+(l.head?l.head.length:0),u.push({startIndex:f,endIndex:c,content:t.slice(f,c)})),u}function S(t){var e=t.key,n=t.commentId,r=t.replyId,i=t.content,s=t.isTranslateContent,o=Object(I.d)(i),c=L(o),u=c.newContent,a=c.textIndexMap,d=new RegExp("".concat(w(e)),"gi");d.lastIndex=0;for(var l=[],f=d.exec(u);f&&f[0].length;){var h=f.index,m=h+f[0].length,v=R(i,[a[h],a[m-1]+1],o);l.push({ranges:v,key:e,commentId:n,replyId:r,isSelected:!1,isTranslateContent:!!s}),f=d.exec(u)}return l}var T,D,P=n("7ESD");n.d(e,"AbstractCommentFindProvider",function(){return F}),n.d(e,"CommentFindProvider",function(){return M}),n.d(e,"commentFindProvider",function(){return _}),(D=T=T||{}).DEFAULT="DEFAULT",D.WORKING="WORKING",D.DESTROYED="DESTROYED";var F=function(){function t(){d()(this,t),this.status=T.DEFAULT,this.rendererMap=P.a.rendererMap,this.commentList=[],this.commentMap={}}return f()(t,[{key:"setup",value:function(t,e){this.triggerFindDebounced$=new y.a,this.findDebounced$=this.triggerFindDebounced$.pipe(Object(h.a)(500)),this.triggerFindAsync$=new y.a,this.findAsync$=this.triggerFindAsync$.pipe(),this.commentBox=t,this.translateContentCompare=e,C.a.register(this),this.status=T.WORKING}},{key:"setTranslateContentCompare",value:function(t){this.translateContentCompare=t,this.triggerFindDebounced$.next()}},{key:"setCommentList",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.commentList=t,this.commentList.map(function(t){e.commentMap[t.commentId]=!0}),this.clearFind(),this.triggerFindAsync$.next()}},{key:"triggerFind",value:function(t){this.commentMap[t]&&this.triggerFindDebounced$.next()}},{key:"triggerFindWhenPageChange",value:function(){this.triggerFindAsync$.next()}},{key:"find",value:function(t){var e=this;return 0===t.length?this.clearFind():Object(b.a)(this.findDebounced$,this.findAsync$).pipe(Object(m.a)(void 0),Object(v.map)(function(){return e.findImpl(t)}),Object(p.a)(1),Object(g.a)())}},{key:"findSelectionsFromData",value:function(t){var e=t.translateContent,n=t.commentId,r=t.replyId,i=[],s=Object.assign({},t,{isTranslateContent:!1}),o=this.getRenderer(n,r,!1),c=this.getRenderer(n,r,!0),u=!1;if(o&&o.props.isEdit&&(u=!0),c&&c.props.isEdit&&(u=!0),u)return[];if(!e)return S(s);var a=Object.assign({},t,{content:e,isTranslateContent:!0}),i=i.concat(S(a));return this.translateContentCompare&&(i=i.concat(S(s))),i}},{key:"getRenderer",value:function(t,e,n){return this.rendererMap["".concat(t,"-").concat(e,"-").concat(n)]}},{key:"clearFind",value:function(){var e=this;return this.updateMatches([]),Object.keys(this.rendererMap).map(function(t){e.rendererMap[t].clearHighlight()}),Object(E.a)([])}},{key:"updateMatches",value:function(t){this.prevMatches&&this.prevMatches.map(function(t){t.destroy()}),this.prevMatches=t}},{key:"destroy",value:function(){this.status=T.DESTROYED,C.a.unregister(this),this.triggerFindDebounced$.complete(),this.triggerFindAsync$.complete(),delete this.commentBox}},{key:"replaceWith",value:function(){}},{key:"replaceAllWith",value:function(){}},{key:"getCurrentSelection",value:function(){return null}},{key:"isDestroyed",get:function(){return this.status===T.DESTROYED}}]),t}(),M=function(t){function e(){return d()(this,e),i()(this,o()(e).apply(this,arguments))}return u()(e,t),f()(e,[{key:"createCommentFindMatch",value:function(t){return new k.a(t,this)}},{key:"findImpl",value:function(o){var c=this;if(0===o.length)return[];var u=[];return this.commentList.map(function(t){var e=t.comment_list,s=t.commentId;e.forEach(function(t){var e=t.reply_id,n=t.content,r=t.translate_content,i={key:o,commentId:s,replyId:e,content:n,translateContent:r};c.findSelectionsFromData(i).map(function(t){u.push(c.createCommentFindMatch(t))})})}),this.updateMatches(u),u}}]),e}(F);M.ORDER_VALUE=12;var _=new M}}]);
//# sourceMappingURL=g_comment_find_provider.b570d55fcf10632b97cc.js.map