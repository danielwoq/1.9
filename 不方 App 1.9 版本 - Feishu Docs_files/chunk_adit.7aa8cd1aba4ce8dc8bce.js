(this.webpackJsonp=this.webpackJsonp||[]).push([["chunk_adit"],{Csto:function(e,t,n){},FJEn:function(e,t,n){"use strict";n.r(t),n.d(t,"ASYNC_NODE_DID_SHOW_LOADING_EVENT",function(){return Ds}),n.d(t,"ASYNC_NODE_DID_UPDATE_EVENT",function(){return _s}),n.d(t,"ASYNC_NODE_WILL_SHOW_LOADING_EVENT",function(){return Ls}),n.d(t,"ASYNC_NODE_WILL_UPDATE_EVENT",function(){return Ns}),n.d(t,"ArrowKeysEnum",function(){return qu}),n.d(t,"AttributePool",function(){return Ne}),n.d(t,"AttributePoolHelper",function(){return mp}),n.d(t,"BaseFormatter",function(){return lf}),n.d(t,"BlockUndoDispatcher",function(){return sc}),n.d(t,"CallStack",function(){return Yl}),n.d(t,"Changeset",function(){return mn}),n.d(t,"ChangesetHelper",function(){return Ar}),n.d(t,"ChangesetTracker",function(){return Cr}),n.d(t,"ChangesetUtils",function(){return Yd}),n.d(t,"CopyPasteKeysEnum",function(){return Ju}),n.d(t,"DEFAULT_REP_ZONE",function(){return Kr}),n.d(t,"Direction",function(){return Mc}),n.d(t,"DisplayType",function(){return da}),n.d(t,"Dom",function(){return Dom}),n.d(t,"DomLine",function(){return Fo}),n.d(t,"DomLineEntry",function(){return ma}),n.d(t,"Editor",function(){return Kf}),n.d(t,"EditorBase",function(){return Ho}),n.d(t,"EditorError",function(){return He}),n.d(t,"EditorReact",function(){return dh}),n.d(t,"EmbedFormatter",function(){return Ef}),n.d(t,"Fiber",function(){return dl}),n.d(t,"FiberPriority",function(){return il}),n.d(t,"FiberRecord",function(){return kl}),n.d(t,"Formatter",function(){return yp}),n.d(t,"FormatterManager",function(){return If}),n.d(t,"FormatterRenderer",function(){return vf}),n.d(t,"Hook",function(){return Tf}),n.d(t,"HookContext",function(){return Ip}),n.d(t,"InnerZoneEditorNode",function(){return cd}),n.d(t,"KeyCode",function(){return Ku}),n.d(t,"LineStyleFilter",function(){return ei}),n.d(t,"LineTracker",function(){return Vu}),n.d(t,"MacCtrlArrowKeysEnum",function(){return Yu}),n.d(t,"Managers",function(){return Rd}),n.d(t,"ON_FIBER_PAUSE",function(){return sl}),n.d(t,"ON_FIBER_RESUME",function(){return ll}),n.d(t,"ON_FIBER_TASK_DONE",function(){return cl}),n.d(t,"Pocket",function(){return ui}),n.d(t,"Position",function(){return Vo}),n.d(t,"RangeHelper",function(){return Ld}),n.d(t,"Rep",function(){return Zr}),n.d(t,"RepManager",function(){return Xr}),n.d(t,"Scroll",function(){return Ma}),n.d(t,"SkipList",function(){return Tr}),n.d(t,"Translator",function(){return Af}),n.d(t,"TreeFormatter",function(){return kp}),n.d(t,"UndoModule",function(){return fc}),n.d(t,"VectorReps",function(){return qr}),n.d(t,"ViewPort",function(){return Xl}),n.d(t,"_characterRangeFollow",function(){return Mt}),n.d(t,"_checkRep",function(){return $e}),n.d(t,"_mutateAttributionLines",function(){return It}),n.d(t,"_mutateTextLines",function(){return mt}),n.d(t,"_slicerZipperFuncWithDeletions",function(){return Qt}),n.d(t,"addAttributesToChangesetByOp",function(){return Xt}),n.d(t,"applyChangesetsToZatext",function(){return Ct}),n.d(t,"applyToAText",function(){return Bt}),n.d(t,"applyToAttribution",function(){return bt}),n.d(t,"applyToText",function(){return ht}),n.d(t,"attribsToDict",function(){return ft}),n.d(t,"browser",function(){return Ce}),n.d(t,"buildKeepRange",function(){return rn}),n.d(t,"buildKeepToStartOfRange",function(){return on}),n.d(t,"buildRemoveRange",function(){return nn}),n.d(t,"changesetInsertingZatext",function(){return qt}),n.d(t,"changesetReplacingZatext",function(){return Jt}),n.d(t,"characterRangeFollow",function(){return Nt}),n.d(t,"checkCSAppliesToRep",function(){return ot}),n.d(t,"checkRep",function(){return Xe}),n.d(t,"clipboardDataHelper",function(){return xd}),n.d(t,"cloneAText",function(){return Pt}),n.d(t,"cloneOp",function(){return Je}),n.d(t,"cloneZatext",function(){return Ft}),n.d(t,"collabErrors",function(){return _h}),n.d(t,"compareOpStr",function(){return We}),n.d(t,"composable",function(){return ut}),n.d(t,"composeWithDeletions",function(){return Yt}),n.d(t,"config",function(){return br}),n.d(t,"contentcollector",function(){return Pu}),n.d(t,"copyAText",function(){return jt}),n.d(t,"docToSheet",function(){return nh}),n.d(t,"domainConfigHelper",function(){return _a}),n.d(t,"extractAttribNumsByOpCode",function(){return $t}),n.d(t,"filterAttribNumbers",function(){return Lt}),n.d(t,"focusWithoutScroll",function(){return ta}),n.d(t,"genGuid",function(){return qi}),n.d(t,"generateChangeAttribKeysFromAline",function(){return dn}),n.d(t,"generateRandomString",function(){return Tn}),n.d(t,"getAlineAttributes",function(){return pn}),n.d(t,"getAlinesByAttributedText",function(){return Nr}),n.d(t,"getAttributeOnAline",function(){return hn}),n.d(t,"getAttributeValue",function(){return vn}),n.d(t,"getAttributesPerCharacter",function(){return yt}),n.d(t,"getChangesetBetweenRepAndAText",function(){return _r}),n.d(t,"getDefaultLineHeight",function(){return va}),n.d(t,"getFirstCharLen",function(){return od}),n.d(t,"getInlineAttributesInEnter",function(){return gn}),n.d(t,"getLastCharLen",function(){return sd}),n.d(t,"getListNumberId",function(){return An}),n.d(t,"getSearchMatchesByTraversal",function(){return $d}),n.d(t,"getTextAndAttrsOnSelection",function(){return Pr}),n.d(t,"getTextLength",function(){return _n}),n.d(t,"hotkeys",function(){return rp}),n.d(t,"identity",function(){return wt}),n.d(t,"insertAlinesToChangeset",function(){return cn}),n.d(t,"insertLine",function(){return sn}),n.d(t,"inverse",function(){return Zt}),n.d(t,"inverseOnRep",function(){return Kt}),n.d(t,"isAccelKey",function(){return Xu}),n.d(t,"isCopyCutPasteKey",function(){return Qu}),n.d(t,"isHTMLElement",function(){return Oo}),n.d(t,"isIdentity",function(){return Ht}),n.d(t,"joinAttributionLines",function(){return St}),n.d(t,"joinAttributionLinesAddingNewlines",function(){return qe}),n.d(t,"magicObjects",function(){return ws}),n.d(t,"makeAText",function(){return Dt}),n.d(t,"makeAttribution",function(){return _t}),n.d(t,"makeSplice",function(){return Rt}),n.d(t,"makeZatext",function(){return kt}),n.d(t,"mutateAttributionLines",function(){return Et}),n.d(t,"mutateTextLines",function(){return pt}),n.d(t,"newOpChars",function(){return Ge}),n.d(t,"opAttributeValue",function(){return Ut}),n.d(t,"opString",function(){return Ye}),n.d(t,"padShortcutEnabled",function(){return or}),n.d(t,"parseAttributesFromOpAttribs",function(){return tn}),n.d(t,"parseAttributesFromOpIter",function(){return en}),n.d(t,"prepareForWire",function(){return zt}),n.d(t,"registerHooks",function(){return wf}),n.d(t,"removeLines",function(){return an}),n.d(t,"replaceAttribs",function(){return fn}),n.d(t,"replaceCsCharsToPlaceHolder",function(){return Ke}),n.d(t,"replaceLine",function(){return ln}),n.d(t,"replaceSearchMatches",function(){return nf}),n.d(t,"replaceStrWithChars",function(){return Ze}),n.d(t,"reverse",function(){return Gt}),n.d(t,"safeGetRangeAt",function(){return ko}),n.d(t,"scrollToSelection",function(){return Ea}),n.d(t,"scrollVerticallyBySelectionPosition",function(){return Aa}),n.d(t,"setSelectionToLastCharacter",function(){return ch}),n.d(t,"sheetToDoc",function(){return th}),n.d(t,"singlePack",function(){return dt}),n.d(t,"singleUnpack",function(){return ct}),n.d(t,"splitAttributionLines",function(){return Tt}),n.d(t,"splitSelectionWithClassName",function(){return _d}),n.d(t,"splitTextLines",function(){return Ot}),n.d(t,"stringOp",function(){return Qe}),n.d(t,"subattribution",function(){return Vt}),n.d(t,"tableIds",function(){return bu}),n.d(t,"textLinesMutator",function(){return lt}),n.d(t,"toBaseTen",function(){return Ve}),n.d(t,"toLineSplices",function(){return At}),n.d(t,"toSplices",function(){return xt}),n.d(t,"trace",function(){return Ue}),n.d(t,"utils",function(){return Da}),n.d(t,"zoneRegistry",function(){return wd});var r=n("cDf5"),fe=n.n(r),v=n("HA5h"),w=n("oaNE"),i=n("IzLi"),o=n("NZ+B"),a=n("0VPD"),s=n("TGBA"),l=n("xWuZ"),c=n("/1FC"),u=n("oTSI"),m=n("m8R6"),d=n("yIs4"),f=n("UXvI"),I=n("BeL+"),M=n("XhtD"),b=n("XIp8"),y=n("hbEN"),W=n("7EGn"),h=n("1myf"),B=n("OZf9"),D=n("fujP"),p=n("ifKl"),g=n("vJtL"),C=n("Wy5O"),E=n("ipyK"),k=n("eaa2"),N=n("Muja"),S=n("YfG3"),T=n("3Hq1"),P=n("CpTu"),O=n("gSGL"),_=n("dYt1"),R=n("cZF4"),K=n("zmn3"),x=n("puQj"),L=n.n(x),F=n("+om4");n.d(t,"OpIterator",function(){return F.OpIterator}),n.d(t,"_applyToAttribution",function(){return F._applyToAttribution}),n.d(t,"_builder",function(){return F._builder}),n.d(t,"_compose",function(){return F._compose}),n.d(t,"_follow",function(){return F._follow}),n.d(t,"_mapFollow",function(){return F._mapFollow}),n.d(t,"_moveOpsToNewPool",function(){return F._moveOpsToNewPool}),n.d(t,"_opIterator",function(){return F._opIterator}),n.d(t,"_pack",function(){return F._pack}),n.d(t,"_slicerZipperFunc",function(){return F._slicerZipperFunc}),n.d(t,"_stringAssembler",function(){return F._stringAssembler}),n.d(t,"_unpack",function(){return F._unpack}),n.d(t,"appendATextToAssembler",function(){return F.appendATextToAssembler}),n.d(t,"applyToText_",function(){return F.applyToText_}),n.d(t,"applyToZatext",function(){return F.applyToZatext}),n.d(t,"applyZip",function(){return F.applyZip}),n.d(t,"arrayIterator",function(){return F.arrayIterator}),n.d(t,"assert",function(){return F.assert}),n.d(t,"attribsAttributeValue",function(){return F.attribsAttributeValue}),n.d(t,"attributeTester",function(){return F.attributeTester}),n.d(t,"bankAssembler",function(){return F.bankAssembler}),n.d(t,"bankIterator",function(){return F.bankIterator}),n.d(t,"builder",function(){return F.builder}),n.d(t,"clearAtext",function(){return F.clearAtext}),n.d(t,"clearOp",function(){return F.clearOp}),n.d(t,"compose",function(){return F.compose}),n.d(t,"composeAttributes",function(){return F.composeAttributes}),n.d(t,"composeUnpacked",function(){return F.composeUnpacked}),n.d(t,"copyOp",function(){return F.copyOp}),n.d(t,"csMap",function(){return F.csMap}),n.d(t,"csMapPack",function(){return F.csMapPack}),n.d(t,"doInverse",function(){return F.doInverse}),n.d(t,"eachAttribNumber",function(){return F.eachAttribNumber}),n.d(t,"follow",function(){return F.follow}),n.d(t,"followAttributes",function(){return F.followAttributes}),n.d(t,"formatCs",function(){return F.formatCs}),n.d(t,"formatCsFromObj",function(){return F.formatCsFromObj}),n.d(t,"getAttribNumbers",function(){return F.getAttribNumbers}),n.d(t,"getEmptyAttrib",function(){return F.getEmptyAttrib}),n.d(t,"getEmptyText",function(){return F.getEmptyText}),n.d(t,"listAssembler",function(){return F.listAssembler}),n.d(t,"makeAttribsString",function(){return F.makeAttribsString}),n.d(t,"mapAttribNumbers",function(){return F.mapAttribNumbers}),n.d(t,"mergingOpAssembler",function(){return F.mergingOpAssembler}),n.d(t,"moveOpsToNewPool",function(){return F.moveOpsToNewPool}),n.d(t,"newOp",function(){return F.newOp}),n.d(t,"numToString",function(){return F.numToString}),n.d(t,"opAssembler",function(){return F.opAssembler}),n.d(t,"opIterator",function(){return F.opIterator}),n.d(t,"pack",function(){return F.pack}),n.d(t,"parseNum",function(){return F.parseNum}),n.d(t,"reverseBuilder",function(){return F.reverseBuilder}),n.d(t,"smartOpAssembler",function(){return F.smartOpAssembler}),n.d(t,"stringAssembler",function(){return F.stringAssembler}),n.d(t,"stringIterator",function(){return F.stringIterator}),n.d(t,"toObject",function(){return F.toObject}),n.d(t,"toString",function(){return F.toString}),n.d(t,"unpack",function(){return F.unpack});var j=n("dVj6"),z=n.n(j),H=n("qAkX"),U=n("PyL4"),V=n.n(U),Z=n("TSYQ"),q=n.n(Z),J=n("EVdn"),he=n.n(J),Y=n("wMS7"),Q=n.n(Y),X=n("4O8T"),$=n.n(X),ee=n("Z3Pq"),te=n("NFsq"),ne=n("u3oV"),re=n("q1tI"),ie=n.n(re),oe=n("owWc"),ae=n("Bw5p"),se=n("mkut"),le=function(e,t){return(le=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function ce(e,t){function n(){this.constructor=e}le(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ue=function(){return(ue=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function de(e,a,n,s){function l(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n=n||Promise)(function(t,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function i(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){e.done?t(e.value):l(e.value).then(r,i)}o((s=s.apply(e,a||[])).next())})}function pe(e,n){var r,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function s(t){return function(e){return l([t,e])}}function l(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function ge(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ve(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function me(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ve(arguments[t]));return e}var ye,be,Ee=window.sessionStorage.getItem("__ENTER_FROM__"),ke=window.User&&window.User.userAgent||navigator.userAgent||"",Ce=Object.assign({},Object(x.detect)(ke),{isFeishu:!1,isLark:!1,isLarkPcTab:!1,isLarkWindow:!1,isDocs:!1,isDocsSDK:!1,isAndroidSDK:!1,isIOSSDK:!1,isMobileSDK:!1,isFeed:!1,isIphoneX:!1,isIPad:!1,isMobile:!1,isMac:!1,isWindows:!1,isSafari:!1,isIE:!1,isSougou:!1,isIOS:!1,isAndroid:!1,isQQ:!1,isX5:!1,is360:!1,is360Fast:!1,isUc:!1,isBaiDu:!1,isLB:!1,oldIE:!1,modernIE:!1,kernel:"",isLarkTab:!1,isOldLarkTab:!1,isEdge:!1,isFF:!1,isChrome:!1,isWebKit:!1,isBytedanceApp:!1,isIPhoneSeries:function(){return!1},isIOSBelow12:function(){return!1},getChromeVersion:function(){return null},isPrimaryChrome:!1,isOpera:!1,is2345:!1,isMaxthon:!1,isTheWorld:!1});Ce.isFeishu=/feishu/i.test(ke),Ce.isLark=Ce.isFeishu||/lark/i.test(ke),Ce.isLarkPcTab=Ce.isLark&&/TYPE\/PC_TAB/i.test(ke),Ce.isLarkWindow=Ce.isLark&&"lark.window"===Ee,Ce.isDocs=/Docs/i.test(ke),Ce.isDocsSDK=Ce.isLark&&Ce.isDocs,Ce.isAndroidSDK=/DocEditorSDk/i.test(ke),Ce.isIOSSDK=/DocsSDK/i.test(ke),Ce.isMobileSDK=Ce.isAndroidSDK||Ce.isIOSSDK,Ce.isFeed=/Feed/i.test(ke)||/lark=1/.test(location.search)||/sourceType=feed/.test(location.search),Ce.isIphoneX=Te()||!1,Ce.isIPad=/iPad/i.test(ke),Ce.mobile=Ce.mobile||/Mobile/i.test(ke),Ce.isMobile=Ce.mobile,Ce.isMac=Ce.mac,Ce.isWindows=Ce.windows,Ce.isSafari=Ce.safari,Ce.isIE=Ce.msie||Ce.msedge,Ce.isSougou=/MetaSr/i.test(ke),Ce.isIOS=!!ke.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Ce.isAndroid=-1<ke.indexOf("Android")||-1<ke.indexOf("Adr"),Ce.isQQ=/QQBrowser/i.test(ke),Ce.isX5=/MQQBrowser/i.test(ke),Ce.is360=/360SE/i.test(ke),Ce.is360Fast=/360EE/i.test(ke),Ce.isUc=/UBrowser/i.test(ke),Ce.isBaiDu=/BIDUBrowser/i.test(ke),Ce.is2345=/2345Explorer/i.test(ke),Ce.isMaxthon=/Maxthon/i.test(ke),Ce.isTheWorld=/TheWorld/i.test(ke),Ce.isLB=/LBBROWSER/i.test(ke),Ce.isEdge=/Edge/i.test(ke),Ce.isFF=/Firefox/i.test(ke),Ce.isOpera=/OPR/i.test(ke),Ce.isWebKit=/AppleWebKit/i.test(ke),Ce.isChrome="chrome"===Ce.name.toLocaleLowerCase(),Ce.isPrimaryChrome=Ce.isChrome&&!Ce.isOpera&&!Ce.isLB&&!Ce.isUc&&!Ce.isBaiDu&&!Ce.is360&&!Ce.is360Fast&&!Ce.isQQ&&!Ce.isSougou&&!Ce.isEdge&&!Ce.is2345&&!Ce.isTheWorld&&!Ce.isMaxthon,Ce.msie&&(ye=parseInt(String(Ce.version),10),Ce.oldIE=ye<11,Ce.modernIE=11<=ye),Ce.isSougou&&(Ce.name="sougou",be=/SE (\w*.\w*)\s/.exec(ke),Ce.version=be&&be[1]||Ce.version),Ce.isQQ&&(Ce.name="qq",be=ke.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1"),Ce.version=String(parseFloat(be))),Ce.is360&&(Ce.name="360"),Ce.is360Fast&&(Ce.name="360fast"),Ce.isLB&&(Ce.name="liebao"),Ce.isUc&&(Ce.name="uc"),Ce.isBaiDu&&(Ce.name="baidu");var Ie=["msie","webkit","blink","gecko","msedge","tablet","mobile"];Ce.kernel=Ie.find(function(e){return Ce[e]}),Ce.isLarkTab=/from\/(old_)?lark_tab/i.test(ke),Ce.isOldLarkTab=/from\/old_lark_tab/i.test(ke);var Se=Ce.isLark||Ce.isDocs;function Te(){return Oe("X")}function Oe(e){var t=new RegExp("(iPhone\\s"+e+")");return!!navigator.userAgent.match(t)}function we(){var e=navigator.userAgent;return 0<e.indexOf("iPhone")||0<e.indexOf("iPad")||0<e.indexOf("iPhone")}function Re(){if(we()){var e=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);return e?{major:+e[1],minor:+e[2]}:null}return null}function Ae(){var e=Re();return!!e&&e.major<12}function xe(){var e=navigator.userAgent.match(/Chrome\/([\d.]+)/i);return e&&e[1]?e[1]:null}Ce.isBytedanceApp=Se,Ce.isIPhoneSeries=Oe,Ce.isIOSBelow12=Ae,Ce.getChromeVersion=xe;var Me,Ne=(ce(_e,Me=F.AttributePool),_e.prototype.handleError=function(e){throw e.silence||this.editor&&this.editor.call("error",{type:"changeset",e:e,message:e.message,from:"etherpad"}),e},_e);function _e(e){var t=Me.call(this)||this;return t.editor=e,t}var Le=De;function De(e){var s=this;this.lines=e,this.curSpliceStart=0,this.curSpliceNumDelete=0,this.curSpliceNewLines=[],this.inSplice=!1,this.curLine=0,this.curCol=0,this.lines_toSource=function(){return s.lines.toSource()},this.enterSplice=function(){s.curSpliceStart=s.curLine,s.curSpliceNumDelete=0,s.curSpliceNewLines=[],0<s.curCol&&s.putCurLineInSplice(),s.inSplice=!0},this.leaveSplice=function(){var e=0,t=s.curSpliceStart+s.curSpliceNumDelete,n=s.curSpliceNewLines.length;(t>s.curSpliceStart||0<n)&&(s.performSplice(s.curSpliceStart+e,t-s.curSpliceStart,s.curSpliceNewLines.slice(0,n)),e+=n-(t-s.curSpliceStart)),s.curSpliceStart=0,s.curSpliceNumDelete=0,s.curSpliceNewLines=[],s.inSplice=!1},this.performSplice=function(e,t,n){s.lines.splice([e,t].concat(n))},this.isCurLineInSplice=function(){return s.curLine-s.curSpliceStart<s.curSpliceNewLines.length},this.debugPrint=function(e){console.log(e+": "+s.curSpliceStart+" "+s.curSpliceNumDelete+" "+s.curSpliceNewLines+" / "+s.curLine+","+s.curCol+" / "+s.lines_toSource())},this.putCurLineInSplice=function(){return s.isCurLineInSplice()||(s.curSpliceNewLines.push(s.lines.get(s.curSpliceStart+s.curSpliceNumDelete)),s.curSpliceNumDelete++),s.curLine-s.curSpliceStart},this.skipLines=function(e,t){if(e)if(t){s.inSplice||s.enterSplice();for(var n=0;n<e;n++)s.curCol=0,s.putCurLineInSplice(),s.curLine++}else s.inSplice&&(1<e?s.leaveSplice():s.putCurLineInSplice()),s.curLine+=e,s.curCol=0},this.skip=function(e,t,n){e&&(t?s.skipLines(t,n):(n&&!s.inSplice&&s.enterSplice(),s.inSplice&&s.putCurLineInSplice(),s.curCol+=e))},this.nextKLinesText=function(e){var t=s.curSpliceStart+s.curSpliceNumDelete;return s.lines.slice?s.lines.slice(t,t+e).join(""):null},this.removeLines=function(e){var t,n="";return e&&(s.inSplice||s.enterSplice(),s.isCurLineInSplice()?0===s.curCol?(n=s.curSpliceNewLines[s.curSpliceNewLines.length-1],s.curSpliceNewLines.length--,n+=s.nextKLinesText(e-1),s.curSpliceNumDelete+=e-1):(n=s.nextKLinesText(e-1),s.curSpliceNumDelete+=e-1,t=s.curSpliceNewLines.length-1,n=s.curSpliceNewLines[t].substring(s.curCol)+n,s.curSpliceNewLines[t]=s.curSpliceNewLines[t].substring(0,s.curCol)+s.lines.get(s.curSpliceStart+s.curSpliceNumDelete),s.curSpliceNumDelete+=1):(n=s.nextKLinesText(e),s.curSpliceNumDelete+=e)),n},this.remove=function(e,t){var n="";if(e){if(t)return s.removeLines(t);s.inSplice||s.enterSplice();var r=s.putCurLineInSplice(),n=s.curSpliceNewLines[r].substring(s.curCol,s.curCol+e);s.curSpliceNewLines[r]=s.curSpliceNewLines[r].substring(0,s.curCol)+s.curSpliceNewLines[r].substring(s.curCol+e)}return n},this.insert=function(e,t){var n,r,i,o,a;e&&(s.inSplice||s.enterSplice(),t?(n=s.splitTextLines(e),s.isCurLineInSplice()?(r=s.curSpliceNewLines.length-1,i=s.curSpliceNewLines[r],o=s.curCol,s.curSpliceNewLines[r]=i.substring(0,o)+n[0],s.curLine++,n.splice(0,1),Array.prototype.push.apply(s.curSpliceNewLines,n),s.curLine+=n.length,s.curSpliceNewLines.push(i.substring(o)),s.curCol=0):(Array.prototype.push.apply(s.curSpliceNewLines,n),s.curLine+=n.length)):(a=s.putCurLineInSplice(),s.curSpliceNewLines[a]=s.curSpliceNewLines[a].substring(0,s.curCol)+e+s.curSpliceNewLines[a].substring(s.curCol),s.curCol+=e.length))},this.splitTextLines=function(e){return e.match(/[^\n]*(?:\n|[^\n]$)/g)},this.hasMore=function(){var e=s.lines.length();return s.inSplice&&(e+=s.curSpliceNewLines.length-s.curSpliceNumDelete),s.curLine<e},this.close=function(){s.inSplice&&s.leaveSplice()}}var Be=Pe;function Pe(e){this.pos=0,this.skip=function(e,t,n){if(Object(F.assert)(0===t,""),Object(F.assert)(this.pos+e<=this.rows.length(),""),n){for(var r=[this.pos,e],i=this.pos;i<this.pos+e;i++)r.push(this.rows.get(i));this.rows.splice(r)}this.pos+=e},this.remove=function(e,t){Object(F.assert)(0===t,""),Object(F.assert)(this.pos+e<=this.rows.length(),""),this.rows.splice([this.pos,e])},this.insert=function(e,t){this.rows.splice([this.pos,0].concat(e)),this.pos+=e.length},this.close=function(){},this.hasMore=function(){return this.pos<this.rows.length()},this.removeLines=function(){Object(F.assert)(!1,"")},this.skipLines=function(){Object(F.assert)(!1,"")},this.rows=e}var Fe,je=(ce(ze,Fe=Error),ze);function ze(e,t){var n=Fe.call(this,e)||this;return n.silence=t,n}var He=Object.freeze({__proto__:null,EditorError:je}),Ue=function(n,e){var t,r,i,o=window.Slardar;o&&(r=(t=e||{}).tags,i=t.extras,o("Sentry",function(t){t.withScope(function(e){r&&e.setTags&&e.setTags(r),i&&e.setExtras&&e.setExtras(i),t.captureException(n)})}))};function Ve(e){var t=e.indexOf("$"),n=e.substring(0,t),r=e.substring(t);return n.replace(/[0-9a-z]+/g,function(e){return String(Object(F.parseNum)(e))})+r}function We(e,t){for(var n,r,i=Object(F.opIterator)(e),o=Object(F.opIterator)(t);i.hasNext()||o.hasNext();){var a=i.next(),s=o.next();if(a.chars!==s.chars)return!1;if(a.lines!==s.lines)return!1;if(a.opcode!==s.opcode)return!1;if(a.attribs.length!==s.attribs.length)return!1;var l=a.attribs.split("*"),c=s.attribs.split("*");try{for(var u=(n=void 0,ge(l)),d=u.next();!d.done;d=u.next()){var f=d.value;if(c.indexOf(f)<0)return!1}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}return!0}function Ke(e,n){return void 0===n&&(n="#"),Object(F._pack)(Object(F.csMap)(e,function(e,t){return t.charBank=Ze(t.charBank,n),t}))}function Ze(e,t){void 0===t&&(t="#");var n=function(e){return e.replace(/[^\r\n\s*]/g,function(){return t})};return Array.isArray(e)?e.map(n):n(e)}function Ge(e){var t=Object(F.smartOpAssembler)();return t.append({opcode:"+",chars:e,lines:0,attribs:""}),t.toString()}function qe(e){var n=Object(F.smartOpAssembler)(),r=Object(F.newOp)("+");return r.chars=1,r.lines=1,e.forEach(function(e){for(var t=Object(F.opIterator)(e);t.hasNext();)n.append(t.next());n.append(r)}),n.toString()}function Je(e){return{opcode:e.opcode,chars:e.chars,lines:e.lines,attribs:e.attribs}}function Ye(e){if(!e.opcode)return"null";var t=Object(F.opAssembler)();return t.append(e),t.toString()}function Qe(e){return Object(F.opIterator)(e).next()}function Xe(e,t){return $e(e,t)}function $e(n,i){var t,e,r=Object(F.unpack)(n),o={};try{for(var a=ge(Object.keys(r)),s=a.next();!s.done;s=a.next()){for(var l=s.value,c=r[l],u=c.oldLen,d=c.newLen,f=c.ops,h=c.itemType,p=Object(F.smartOpAssembler)(),g=Object(F.opIterator)(f),v=c.charBank,m=0,y=0,b=0,E=0,k=function(){var e,r,t=g.next();switch("Z"!==h&&Object(F.assert)(0===t.lines,"there should be no new lines in R or C zone"),t.opcode){case"=":m+=t.chars,b+=t.chars,"Z"===h?Object(F.assert)(m<=u,"for keep: oldPos >= oldLen in cs",!1,{oldPos:m,oldLen:u,cs:n}):Object(F.assert)(m<=u,"for keep: oldPos > oldLen in cs",!1,{oldPos:m,oldLen:u,cs:n});break;case"-":m+=t.chars,"Z"===h?Object(F.assert)(m<=u,"for delete: oldPos >= oldLen in cs",!1,{oldPos:m,oldLen:u,cs:n}):Object(F.assert)(m<=u,"for delete: oldPos > oldLen in cs",!1,{oldPos:m,oldLen:u,cs:n});break;case"+":"Z"===h&&((e=at(v,y,t.chars,t.lines))&&(console.log("cs:",Ke(n)),Ue(e)),st(v,y,t.chars),y+=t.chars),b+=t.chars,E+=t.chars,Object(F.assert)(b<=d,"calcNewLen > newLen in cs",!1,{calcNewLen:b,newLen:d,cs:n})}p.append(t),i&&(r={},Object(F.eachAttribNumber)(t.attribs,function(e){Object(F.assert)(e in i.numToAttrib,"changeset contains attrib number attr not in pool",!1,{attr:e});var t=i.getAttribKey(e),n=i.getAttribValue(e);r[t]=n}))};g.hasNext();)k();if(b+=u-m,"Z"===h)for(v=v.substring(0,E);v.length<E;)v+="?";else for(Object(F.assert)("R"===h||"C"===h,"itemtype is invalid",!1,{itemType:h}),v=v.slice(0,E);v.length<E;)v.push("?");p.endDocument(),o[l]={itemType:c.itemType,oldLen:u,newLen:b,ops:p.toString(),charBank:v}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}var C=Object(F._pack)(o);return C!==n&&(console.log("newCs",Ke(C)),console.log("cs",Ke(n))),Object(F.assert)(C===n,"changeset does not equal normalized changeset"),n}function et(e,t,n,r){for(var i=0,o=t;o<t+n;o++)10===e.charCodeAt(o)&&i++;return i!==r?"line count does not match":10!==e.charCodeAt(t+n-1)&&0!==r?"text range doesn't end in newline but should":""}var tt=function(e){return 55296<=e&&e<=56319},nt=function(e){return 56320<=e&&e<=57343};function rt(e,t,n,r){var i=e.charCodeAt(t),o=0===t?0:e.charCodeAt(t-1),a=e.charCodeAt(t+n-1),s=t+n===e.length?0:e.charCodeAt(t+n);Object(F.assert)(!(tt(o)&&nt(i)),"op text starts with low surrogate",r,{range:t+" - "+(t+n),charCodes:o.toString(16)+", "+i.toString(16)}),Object(F.assert)(!(tt(a)&&s),"op text ends with high surrogate",r,{range:t+" - "+(t+n),charCodes:a.toString(16)+", "+s.toString(16)})}function it(e,t,n){for(var r=Object(F.opIterator)(t),i=0;r.hasNext();){var o=r.next();switch(o.opcode){case"+":break;case"-":case"=":var a=et(e,i,o.chars,o.lines);a&&(console.log("str",Ze(e)),console.log("ops",t),Ue(a)),rt(e,i,o.chars,n),i+=o.chars}}}function ot(e,r,i,o){Object(F.assert)("string"==typeof e,"checkCsAppliesToRep cs must be string"),Object(F.csMap)(e,function(e,t){var n="Z"===t.itemType?r[e]?r[e].alltext:"\n":i[e]?i[e].vectorIds:[];Object(F.assert)(t.oldLen===n.length,"text length != changeset length in the zone",o,{oldLen:t.oldLen,allTextLen:n.length,zoneId:e}),"Z"===t.itemType&&it(n,t.ops,o)})}function at(e,t,n,r){for(var i=0,o=10,a=t;a<t+n;a++)e.charCodeAt(a)===o&&i++;return i!==r?"line count does not match":e.charCodeAt(t+n-1)!==o&&0!==r?"text range doesn't end in newline but should":""}function st(e,t,n){var r,i=e.substr(t,n),o=/^([\uD800-\uDBFF][\uDC00-\uDFFF]|[\u0000-\uD7FF\uE000-\uFFFF])*$/.exec(i),a="";o||(r=/([^\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF][^\uDC00-\uDFFF]|^[\uDC00-\uDFFF]|[\uD800-\uDBFF]$)/.exec(i))&&r[0]&&(a=r[0].split("").map(function(e){return e.charCodeAt(0)})),Object(F.assert)(o,"bank is not good UTF-16 string",!1,{invalidChars:a})}function lt(n){var a=[0,0],s=!1,l=0,c=0;function e(e){n.splice.apply(n,me(e))}function r(e){return n.get?n.get(e):n[e]}function i(e,t){return n.slice?n.slice(e,t):[]}function t(){return"number"==typeof n.length?n.length:n.length()}function u(){a[0]=l,(a[1]=0)<c&&f(),s=!0}function o(){e(a),a.length=2,a[0]=a[1]=0,s=!1}function d(){return l-a[0]<a.length-2}function f(){return d()||(a.push(r(a[0]+a[1])),a[1]++),2+l-a[0]}function h(e,t){if(e)if(t){s||u();for(var n=0;n<e;n++)c=0,f(),l++}else s&&(1<e?o:f)(),l+=e,c=0}function p(e,t,n){e&&(t?h(t,n):(n&&!s&&u(),s&&f(),c+=e))}function g(e){var t=a[0]+a[1];return i(t,t+e).join("")}function v(e){var t,n="";return e&&(s||u(),d()?0===c?(n=a[a.length-1],a.length--,n+=g(e-1),a[1]+=e-1):(n=g(e-1),a[1]+=e-1,t=a.length-1,n=a[t].substring(c)+n,a[t]=a[t].substring(0,c)+r(a[0]+a[1]),a[1]+=1):(n=g(e),a[1]+=e)),n}function m(e,t){var n="";if(e){if(t)return v(t);s||u();var r=f(),n=a[r].substring(c,c+e);a[r]=a[r].substring(0,c)+a[r].substring(c+e)}return n}function y(e,t){var n,r,i,o;e&&(s||u(),t?(n=Ot(e),d()?(o=a.length-1,r=a[o],i=c,a[o]=r.substring(0,i)+n[0],l++,n.splice(0,1),Array.prototype.push.apply(a,n),l+=n.length,a.push(r.substring(i)),c=0):(Array.prototype.push.apply(a,n),l+=n.length)):(o=f(),a[o]=a[o].substring(0,c)+e+a[o].substring(c),c+=e.length))}function b(){var e=t();return s&&(e+=a.length-2-a[1]),l<e}function E(){s&&o()}return{skip:p,remove:m,insert:y,close:E,hasMore:b,removeLines:v,skipLines:h}}function ct(e){var t=/Z:([0-9a-z]+)([><])([0-9a-z]+)|/.exec(e);if(!t||!t[0])throw new je("Not a exports: "+e);var n=Object(F.parseNum)(t[1]),r=n+(">"===t[2]?1:-1)*Object(F.parseNum)(t[3]),i=t[0].length,o=e.indexOf("$");return o<0&&(o=e.length),{oldLen:n,newLen:r,ops:e.substring(i,o),charBank:e.substring(o+1),itemType:"Z"}}function ut(e,t){for(var n in e)if(t[n]&&e[n].newLen!==t[n].oldLen)return!1;for(var n in t)if(e[n]&&e[n].newLen!==t[n].oldLen)return!1;return!0}function dt(e,t,n,r){var i=t-e,o=0<=i?">"+Object(F.numToString)(i):"<"+Object(F.numToString)(-i),a=[];return a.push("Z:",Object(F.numToString)(e),o,n,"$",r),a.join("")}function ft(e,t){var n,r,i={},o=Object(F.getAttribNumbers)(e);try{for(var a=ge(o),s=a.next();!s.done;s=a.next()){var l=s.value,c=t.getAttrib(l);i[c[0]]=c[1]}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}function ht(e,t,n){void 0===n&&(n="0");var r=Object(F.unpack)(e)[n];Object(F.assert)(t.length===r.oldLen,"mismatched apply: str.length / unpacked.oldLen",!1,{str:t.length,oldLen:r.oldLen});for(var i=Object(F.opIterator)(r.ops),o=Object(F.bankIterator)(r.charBank),a=Object(F.stringIterator)(t),s=Object(F.stringAssembler)();i.hasNext();){var l=i.next();switch(l.opcode){case"+":if(l.lines!==o.peek(l.chars).split("\n").length-1)throw new je("newline count is wrong in op +; cs:"+e);s.append(o.take(l.chars));break;case"-":if(l.lines!==a.peek(l.chars).split("\n").length-1)throw new je("newline count is wrong in op -; cs:"+e);a.skip(l.chars);break;case"=":if(l.lines!==a.peek(l.chars).split("\n").length-1)throw new je("newline count is wrong in op =; cs:"+e);s.append(a.take(l.chars))}}return s.append(a.take(a.remaining())),s.toString()}function pt(e,t,n){return mt(e,t)}var gt=function(o){return{splice:function(e){var t=ve(e),n=t[0],r=t[1],i=t.slice(2);o.splice.apply(o,me([n,r],i))},get:function(e){return o[e]},length:function(){return o.length},slice:function(e,t){return o.slice(e,t)}}},vt=function(e){return"[object Array]"===Object.prototype.toString.call(e)?gt(e):e};function mt(e,s,t){return Object(F.csMap)(e,function(e,t){for(var n=vt(s(e,t.itemType)),r=Object(F.opIterator)(t.ops),i=Object(F.bankIterator)(t.charBank),o=new("Z"===t.itemType?Le:Be)(n);r.hasNext();){var a=r.next();switch(a.opcode){case"+":o.insert(i.take(a.chars),a.lines);break;case"-":o.remove(a.chars,a.lines);break;case"=":o.skip(a.chars,a.lines,!!a.attribs)}}o.close()})}function yt(e,r){for(var i=Object(F.opIterator)(e),o=[],t=function(){var e=i.next(),t={};Object(F.eachAttribNumber)(e.attribs,function(e){t[r.getAttribKey(e)]=r.getAttribValue(e)});for(var n=0;n<e.chars;n++)o.push(Object(_.a)(t))};i.hasNext();)t();return o}function bt(e,t,n){return Object(F._applyToAttribution)(e,t,n)}function Et(e,t,n){return It(e,t,n)}function kt(e,t){return{rows:{},cols:{},text:{0:e},attribs:{0:t||_t(e)}}}function Ct(e,t,n){return Object(F.applyToZatext)(e,t,n)}function It(y,b,E){Object(F.csMap)(y,function(e,t){if("Z"===t.itemType){for(var n,r=vt(b(e,t.itemType)),i=Object(F.opIterator)(t.ops),o=t.charBank,a=0,s=new Le(r),l=null,c=null,u=Object(F.newOp)(),d=Object(F.newOp)(),f=Object(F.newOp)(),h=function(){return l&&l.hasNext()||s.hasMore()},p=function(e){(c=c||Object(F.mergingOpAssembler)()).append(e),0<e.lines&&(Object(F.assert)(1===e.lines,"Can't have more than one op.lines in attribution lines",!1,{opLines:e.lines}),s.insert(c.toString(),1),c=null)};(u.opcode||i.hasNext()||d.opcode||h())&&(!u.opcode&&i.hasNext()&&i.next(u),u.opcode||d.opcode||c||l&&l.hasNext());)!("="===u.opcode&&0<u.lines)||u.attribs||d.opcode||c||l&&l.hasNext()?"+"===u.opcode?(1<u.lines?(n=o.indexOf("\n",a)+1-a,Object(F.copyOp)(u,f),u.chars-=n,u.lines--,f.lines=1,f.chars=n):(Object(F.copyOp)(u,f),u.opcode=""),p(f),a+=f.chars,f.opcode=""):(!d.opcode&&h()&&(v=d,m=void 0,l&&l.hasNext()||!s.hasMore()||(m=s.removeLines(1),l=Object(F.opIterator)(m)),l&&l.hasNext()?l.next(v):v.opcode=""),Object(F._slicerZipperFunc)(d,u,f,E),f.opcode&&(p(f),f.opcode="")):(s.skipLines(u.lines),u.opcode="");c&&console.log("cs: ",Ke(y)),Object(F.assert)(!c,"line assembler not finished"),s.close()}else{var g=b(e,t.itemType);Object(F.assert)(1===g.length,"attribs length must be 1"),g[0]=bt(t,g[0],E)}var v,m})}function St(e){var t,n,r=Object(F.mergingOpAssembler)();try{for(var i=ge(e),o=i.next();!o.done;o=i.next())for(var a=o.value,s=Object(F.opIterator)(a);s.hasNext();)r.append(s.next())}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r.toString()}function Tt(e,t){var n=Object(F.opIterator)(e),r=Object(F.mergingOpAssembler)(),i=[],o=0;function a(e){r.append(e),0<e.lines&&(i.push(r.toString()),r.clear()),o+=e.chars}for(;n.hasNext();){for(var s=n.next(),l=s.chars,c=s.lines;1<c;){var u=t.indexOf("\n",o)+1;Object(F.assert)(0<u,"newlineEnd <= 0 in splitAttributionLines"),s.chars=u-o,s.lines=1,a(s),l-=s.chars,c-=s.lines}1===c&&(s.chars=l,s.lines=1),a(s)}return i}function Ot(e){return e.match(/[^\n]*(?:\n|[^\n]$)/g)}function wt(e){return Object(F.pack)(e,e,"","")}function Rt(e,t,n,r,i,o){var a=e.length;a<=t&&(t=a-1),n>e.length-t&&(n=e.length-t);var s=e.substring(t,t+n),l=a+r.length-s.length,c=Object(F.smartOpAssembler)();return c.appendOpWithText("=",e.substring(0,t)),c.appendOpWithText("-",s),c.appendOpWithText("+",r,i,o),c.endDocument(),Object(F.pack)(a,l,c.toString(),r)}function At(e){var s=[];return Object(F.csMap)(e,function(o,e){for(var t=Object(F.bankIterator)(e.charBank),n=new Le({splice:function(e){var t=ve(e),n=t[0],r=t[1],i=t.slice(2).length;s.push([n,r,i,o])},get:function(){return"\n"}}),r=Object(F.opIterator)(e.ops);r.hasNext();){var i=r.next();switch(i.opcode){case"+":var a=t.take(i.chars);n.insert(a,i.lines);break;case"-":n.remove(i.chars,i.lines);break;case"=":n.skip(i.chars,i.lines,!!i.attribs)}}n.close()}),s}function xt(e){var t,n,r=[],i=Object(F.unpack)(e);try{for(var o=ge(Object.keys(i)),a=o.next();!a.done;a=o.next()){var s=a.value,l=i[s];if("Z"===l.itemType)for(var c=0,u=Object(F.opIterator)(l.ops),d=Object(F.bankIterator)(l.charBank),f=!1;u.hasNext();){var h=u.next();"="===h.opcode?(c+=h.chars,f=!1):(f||(r.push([c,c,"",s]),f=!0),"-"===h.opcode?(c+=h.chars,r[r.length-1][1]+=h.chars):"+"===h.opcode&&(r[r.length-1][2]+=d.take(h.chars)))}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function Mt(e,t,n,r,i){var o,a,s=n,l=r,c=xt(e),u=0;try{for(var d=ge(c),f=d.next();!f.done;f=d.next()){var h,p,g,v,m=f.value;m[3]===t&&(h=m[0]+u,p=m[1]+u,v=(g=m[2].length)-(p-h),h<=s&&l<=p?s=l=i?h:h+g:p<=s?(s+=v,l+=v):l<=h||(s<=h&&p<=l?l+=v:p<l?(s=h+g,l+=v):l=h),u+=v)}}catch(e){o={error:e}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}return[s,l]}function Nt(e,t,n,r){var i,o,a=t,s=n,l=xt(e),c=0;try{for(var u=ge(l),d=u.next();!d.done;d=u.next()){var f=d.value,h=f[0]+c,p=f[1]+c,g=f[2].length,v=g-(p-h);h<=a&&s<=p?a=s=r?h:h+g:p<=a?(a+=v,s+=v):s<=h||(a<=h&&p<=s?s+=v:p<s?(a=h+g,s+=v):s=h),c+=v}}catch(e){i={error:e}}finally{try{d&&!d.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return[a,s]}function _t(e){var t=Object(F.smartOpAssembler)();return t.appendOpWithText("+",e),t.toString()}function Lt(e,t){return Object(F.mapAttribNumbers)(e,t)}function Dt(e,t){return{text:e,attribs:t||_t(e)}}function Bt(n,e,r,t){var i=Object(K.default)(e.attribs,function(e,t){return bt(n,t,r)});return{text:ht(n,e.text,t),attribs:i}}function Pt(e){if(e)return{text:e.text,attribs:e.attribs};throw new je("atext is null")}function Ft(e){if(e)return JSON.parse(JSON.stringify({rows:e.rows||{},cols:e.cols||{},text:e.text,attribs:e.attribs}));throw new je("zatext is null")}function jt(e,t){t.text=e.text,t.attribs=e.attribs}function zt(e,t,n){var r=new Ne(e);return{translated:Object(F.moveOpsToNewPool)(t,n,r),pool:r}}function Ht(e){var t,n,r=Object(F.unpack)(e),i=Object.keys(r);try{for(var o=ge(i),a=o.next();!a.done;a=o.next()){var s=r[a.value];if(""!==s.ops||s.oldLen!==s.newLen)return!1}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0}function Ut(e,t,n){return Object(F.attribsAttributeValue)(e.attribs,t,n)}function Vt(e,t,n){var r=Object(F.opIterator)(e,0),i=Object(F.smartOpAssembler)(),o=Object(F.newOp)(),a=Object(F.newOp)(),s=Object(F.newOp)();function l(){if(a.chars)for(;a.opcode&&(o.opcode||r.hasNext());)o.opcode||r.next(o),a.opcode&&o.opcode&&a.chars>=o.chars&&0<o.lines&&a.lines<=0&&a.lines++,Object(F._slicerZipperFunc)(o,a,s,null),s.opcode&&(i.append(s),s.opcode="")}if(a.opcode="-",a.chars=t,l(),void 0===n)for(o.opcode&&i.append(o);r.hasNext();)r.next(o),i.append(o);else a.opcode="=",a.chars=n-t,l();return i.toString()}var Wt=function(i){return function(s,t,n,a){function l(e){return t.atIndex?t.atIndex(e).text+"\n":t.get?t.get(e):t[e]}function o(e){return n.get?n.get(e):n[e]}var c,u=0,d=0,f=null,h=Object(F.newOp)("+"),e=s,p=Object(F.opIterator)(e.ops),g=i(e.newLen,e.itemType);function v(e,t){if(!f||c!==u){f=Object(F.opIterator)(o(u)),c=u;for(var n=0,r=!1;!r&&f.hasNext();)f.next(h),n+h.chars>=d?(h.chars-=d-n,r=!0):n+=h.chars}for(;0<e;){h.chars||f.hasNext()||(d=0,c=++u,h.chars=0,f=Object(F.opIterator)(o(u))),h.chars||f.next(h);var i=Math.min(e,h.chars);t(i,h.attribs,i===h.chars&&0<h.lines),e-=i,h.chars-=i,d+=i}h.chars||f.hasNext()||(u++,d=0)}function m(e,t){t?(u+=t,d=0):f&&c===u?v(e,function(){}):d+=e}function y(e){var t=0,n=Object(F.bankAssembler)(s.itemType),r=Object(F.bankIterator)(l(u));r.skip(d);var i=r.take(r.remaining());t+=i.length,n.append(i);for(var o=u+1;t<e;){var a=l(o);t+=a.length,n.append(a),o++}return(r=Object(F.bankIterator)(n.toResult())).take(Math.min(e,r.remaining()))}function b(t){var n={};return function(e){return n[e]||(n[e]=t(e)),n[e]}}for(var E=[],k=[],r=function(){var r,i,o,e=p.next();"="===e.opcode?e.attribs?(E.length=0,k.length=0,Object(F.eachAttribNumber)(e.attribs,function(e){E.push(a.getAttribKey(e)),k.push(a.getAttribValue(e))}),r=b(function(e){for(var t=[],n=0;n<E.length;n++){var r=E[n],i=k[n],o=Object(F.attribsAttributeValue)(e,r,a);i!==o&&t.push([r,o])}return Object(F.makeAttribsString)("=",t,a)}),v(e.chars,function(e,t,n){g.keep(e,n?1:0,r(t))})):(m(e.chars,e.lines),g.keep(e.chars,e.lines)):"+"===e.opcode?g.remove(e.chars,e.lines):"-"===e.opcode&&(i=y(e.chars),o=0,v(e.chars,function(e,t,n){var r=Object(F.bankIterator)(i);r.skip(o),g.insert(r.take(Math.min(r.remaining(),e)),t),o+=e}))};p.hasNext();)r();return g.toUnpacked()}};function Kt(e,l,c,u){return $e(Object(F.csMapPack)(e,function(e,t){if("Z"===t.itemType){var n=l[e],r=n.lines||["\n"],i=n.alines||["|1+1"];return Object(F.doInverse)(t,r,i,u)}var o=c[e],a=o?[o.vectorIds]:[[]],s=o?o.alines:[""];return Object(F.assert)(1===a.length,"lines length 1"),Object(F.assert)(1===s.length,"alines length 1"),Object(F.doInverse)(t,a,s,u)}))}var Zt=Wt(F.builder),Gt=Wt(F.reverseBuilder);function qt(e){return Jt({text:{},attribs:{}},e)}function Jt(v,m){var y={};return Object(R.a)(Object.keys(v.text),Object.keys(v.rows||{}),Object.keys(v.cols||{}),Object.keys(m.text),Object.keys(m.rows||{}),Object.keys(m.cols||{})).forEach(function(e){var t,n;e in v.text?t="Z":v.rows&&e in v.rows?t="R":v.cols&&e in v.cols&&(t="C"),e in m.text?n="Z":m.rows&&e in m.rows?n="R":m.cols&&e in m.cols&&(n="C"),Object(F.assert)(!t||!n||t===n,"itemTypes disagree");var r=t||n;if("Z"===r){var i,o,a,s=Object(F.smartOpAssembler)(),l=void 0,c=void 0,u=void 0,l=e in v.text?(o=(i=v.text[e]).substr(0,i.length-1),s.appendOpWithText("-",o),i.length):1,u=e in m.text?(a=m.text[e],Object(F.appendATextToAssembler)({text:a,attribs:m.attribs[e]},s),c=a.length,a.substr(0,a.length-1)):(c=1,"");y[e]={itemType:"Z",oldLen:l,newLen:c,ops:s.toString(),charBank:u}}else{var s=Object(F.smartOpAssembler)(),d=("R"===r?v.rows:v.cols)||[],f=("R"===r?m.rows:m.cols)||[],h=void 0;e in d?(h=d[e],s.append({opcode:"-",attribs:"",lines:0,chars:h.length})):h=[];var p=void 0;if(e in f)if(p=f[e],m.attribs[e])for(var g=Object(F.opIterator)(m.attribs[e]);g.hasNext();)s.append(g.next());else s.append({opcode:"+",attribs:"",lines:0,chars:p.length});else p=[];y[e]={itemType:r,oldLen:h.length,newLen:p.length,ops:s.toString(),charBank:p}}}),Object(F._pack)(y)}function Yt(e,t,o){var n=Object(F.unpack)(e),r=Object(F.unpack)(t),i=n.oldLen,a=n.newLen;Object(F.assert)(a===r.oldLen,"mismatched composition of two changesets");var s=r.newLen,l=Object(F.bankIterator)(n.charBank),c=Object(F.bankIterator)(r.charBank),u=Object(F.stringAssembler)(),d=Object(F.applyZip)(n.ops,0,r.ops,0,function(e,t,n){var r=e.opcode,i=t.opcode;"+"===r&&"-"===i&&l.skip(Math.min(e.chars,t.chars)),Qt(e,t,n,o),"+"===n.opcode&&("+"===i?u.append(c.take(n.chars)):u.append(l.take(n.chars)))});return Object(F.pack)(i,s,d,u.toString())}function Qt(e,t,n,r){if("-"===e.opcode)Object(F.copyOp)(e,n),e.opcode="";else if(e.opcode)switch(t.opcode){case"-":t.chars<=e.chars?("="===e.opcode&&(n.opcode="-",n.chars=t.chars,n.lines=t.lines,n.attribs=t.attribs),e.chars-=t.chars,e.lines-=t.lines,t.opcode="",e.chars||(e.opcode="")):("="===e.opcode&&(n.opcode="-",n.chars=e.chars,n.lines=e.lines,n.attribs=t.attribs),t.chars-=e.chars,t.lines-=e.lines,e.opcode="");break;case"+":Object(F.copyOp)(t,n),t.opcode="";break;case"=":t.chars<=e.chars?(n.opcode=e.opcode,n.chars=t.chars,n.lines=t.lines,n.attribs=Object(F.composeAttributes)(e.attribs,t.attribs,"="===e.opcode,r),t.opcode="",e.chars-=t.chars,e.lines-=t.lines,e.chars||(e.opcode="")):(n.opcode=e.opcode,n.chars=e.chars,n.lines=e.lines,n.attribs=Object(F.composeAttributes)(e.attribs,t.attribs,"="===e.opcode,r),e.opcode="",t.chars-=e.chars,t.lines-=e.lines);break;case"":Object(F.copyOp)(e,n),e.opcode=""}else Object(F.copyOp)(t,n),t.opcode=""}function Xt(e,t,r,n,i){for(var o,a=n.map(function(e){return Object(F.numToString)(r.putAttrib(e))}).join("*"),s=Object(F.unpack)(e)[t],l=s.itemType,c=Object(F.opIterator)(s.ops),u=Object(F.opAssembler)(),d=function(){var t=c.next(),e=i.find(function(e){return t.opcode===e}),n=t;e&&(n.attribs=Object(F.composeAttributes)(t.attribs,"*"+a,!0,r)),u.append(n)};c.hasNext();)d();return Object(F._pack)(((o={})[t]={itemType:l,oldLen:s.oldLen,newLen:s.newLen,ops:u.toString(),charBank:s.charBank},o))}function $t(e,t,n){var r=e.attribs,i=[];if("function"!=typeof n)throw new je("Invalid filter. Expect function but got "+n);for(var o,a=/\*(\w+)/gi;null!==(o=a.exec(r));){var s=Object(F.parseNum)(o[1]);n(s,e,t)&&i.push(s)}return i}function en(e,t){for(var n=[];e.hasNext();)for(var r=tn(e.next().attribs,t),i=0;i<r.length;i++)n.push(r[i]);return n}function tn(e,r){var i=[];return e.split("*").forEach(function(e){var t,n=parseInt(e,36);Number.isNaN(n)||(t=r.numToAttrib[n],i.push([t[0],t[1]]))}),i}function nn(e,t,n,r){var i=e.lines.offsetOfIndex(n[0]),o=e.lines.offsetOfIndex(r[0]);r[0]>n[0]?(t.remove(o-i-n[1],r[0]-n[0]),t.remove(r[1])):t.remove(r[1]-n[1])}function rn(e,t,n,r,i,o){var a=e.lines.offsetOfIndex(n[0]),s=e.lines.offsetOfIndex(r[0]);r[0]>n[0]?(t.keep(s-a-n[1],r[0]-n[0],i,o),t.keep(r[1],0,i,o)):t.keep(r[1]-n[1],0,i,o)}function on(e,t,n){var r=e.lines.offsetOfIndex(n[0]);t.keep(r,n[0]),t.keep(n[1])}function an(e,t){var n,r=Object(F.builder)(e.lines.totalWidth()),i=e.lines.indexOfOffset(t.selStartChar),o=e.lines.indexOfOffset(t.selEndChar),a=[i,0],s=[o,0];return o===e.lines.length()&&(a[0]=a[0]-1,n=e.lines.atIndex(a[0]),a[1]=n.width-1,s=[--o,e.lines.atIndex(o).width-1]),rn(e,r,[0,0],a),nn(e,r,a,s),r.toString()}function sn(e,t,n,r){var i=e.lines.atIndex(t),o=e.repManager.apool,a=Object(F.builder)(e.lines.totalWidth());return rn(e,a,[0,0],[t,i.width-1]),a.insert("\n",[],o),a.insert("*",me(r,[["insertorder","first"],["lmkr","1"]]),o),a.insert(n),a.toString()}function ln(e,t,n){var r=Object(F.builder)(e.lines.totalWidth()),i=e.lines.atIndex(n);if(!i)return"";var o=[n,0],a=[n,i.width-1],s=e.repManager.apool;rn(e,r,[0,0],o),nn(e,r,o,a);for(var l=Object(F.smartOpAssembler)(),c=Object(F.unpack)(r.toString())[e.zoneId],u=Object(F.opIterator)(c.ops);u.hasNext();){var d=u.next();l.append(ue({},d))}var f=t.alines[0],h=fn(f,dn(f,t.repManager.apool,s));Object(F.appendATextToAssembler)({text:t.alltext.slice(0,-1),attribs:h},l);var p=t.lines.atIndex(0).width-e.lines.atIndex(n).width+e.alltext.length;return Object(F.pack)(e.alltext.length,p,l.toString(),t.alltext.slice(0,-1))}function cn(e,t,n){var r=e.lines.atIndex(n),i=e.repManager.apool,o=Object(F.builder)(e.lines.totalWidth());rn(e,o,[0,0],[n,r.width-1]),o.insert("\n",[],i);for(var a=Object(F.unpack)(o.toString())[e.zoneId],s=Object(F.smartOpAssembler)(),l=Object(F.opIterator)(a.ops);l.hasNext();){var c=l.next();s.append(ue({},c))}var u=t.length;t.forEach(function(e,t){var n;Object(F.appendATextToAssembler)({text:e.text.slice(0,-1),attribs:e.attribs},s),t<u-1&&(n=un(),s.append(n))});var d=e.alltext.length,f=t.map(function(e){return e.text}).join(""),h=d+f.length;return Object(F.pack)(e.alltext.length,h,s.toString(),"\n"+f.slice(0,-1))}function un(){var e=Object(F.newOp)("+");return e.chars=1,e.lines=1,e.attribs="",e}function dn(e,o,a){for(var t=Object(F.opIterator)(e),s={};t.hasNext();){var n=t.next();Object(F.eachAttribNumber)(n.attribs,function(e){var t=ve(o.numToAttrib[e],2),n=t[0],r=t[1],i=a.attribToNum[n+","+r];void 0===i&&(i=a.putAttrib([n,r])),s[e]=i})}return s}function fn(e,r){for(var i=Object(F.smartOpAssembler)(),o=Object(F.opIterator)(e),t=function(){var e=o.next(),t=Je(e),n="";Object(F.eachAttribNumber)(e.attribs,function(e){void 0!==r[e]?n+="*"+Object(F.numToString)(r[e]):n+="*"+Object(F.numToString)(e)}),t.attribs=n,i.append(ue({},t))};o.hasNext();)t();return i.toString()}function hn(e,t,n){for(var r=Object(F.opIterator)(t),i=e.numToAttrib,o=[];r.hasNext();){var a=r.next();if(Object(F.eachAttribNumber)(a.attribs,function(e){i[e][0]===n&&(o=[e,i[e][1]])}),o.length)return o}return o}function pn(e,t){var n=e.numToAttrib,r={};return Object(F.eachAttribNumber)(t,function(e){r[e]=n[e]}),r}function gn(e,t){var n=e.numToAttrib,r=[],i=t.replace(/(\*[0-9a-z]+)+\+[0-9a-z]+/g,"");Object(F.eachAttribNumber)(i,function(e){r.push(n[e])});var o=["bold","underline","italic","strikethrough","backgroundcolor","fontcolor","fontfamily","fontsize","fontweight","lineguid"];return r.filter(function(e){var t=ve(e,2),n=t[0],r=t[1];return n&&r&&-1<o.indexOf(n)})}function vn(e,t){for(var n=Object.keys(e),r=n.length,i=0;i<r;i+=1){var o=ve(e[n[i]]||[],2),a=o[0],s=o[1];if(a===t)return s}return null}var mn=Object.freeze({__proto__:null,toBaseTen:Ve,compareOpStr:We,replaceCsCharsToPlaceHolder:Ke,replaceStrWithChars:Ze,newOpChars:Ge,joinAttributionLinesAddingNewlines:qe,cloneOp:Je,opString:Ye,stringOp:Qe,checkRep:Xe,_checkRep:$e,checkCSAppliesToRep:ot,textLinesMutator:lt,singleUnpack:ct,composable:ut,singlePack:dt,attribsToDict:ft,applyToText:ht,mutateTextLines:pt,_mutateTextLines:mt,getAttributesPerCharacter:yt,applyToAttribution:bt,mutateAttributionLines:Et,makeZatext:kt,applyChangesetsToZatext:Ct,_mutateAttributionLines:It,joinAttributionLines:St,splitAttributionLines:Tt,splitTextLines:Ot,identity:wt,makeSplice:Rt,toLineSplices:At,toSplices:xt,_characterRangeFollow:Mt,characterRangeFollow:Nt,makeAttribution:_t,filterAttribNumbers:Lt,makeAText:Dt,applyToAText:Bt,cloneAText:Pt,cloneZatext:Ft,copyAText:jt,prepareForWire:zt,isIdentity:Ht,opAttributeValue:Ut,subattribution:Vt,inverseOnRep:Kt,inverse:Zt,reverse:Gt,changesetInsertingZatext:qt,changesetReplacingZatext:Jt,composeWithDeletions:Yt,_slicerZipperFuncWithDeletions:Qt,addAttributesToChangesetByOp:Xt,extractAttribNumsByOpCode:$t,parseAttributesFromOpIter:en,parseAttributesFromOpAttribs:tn,buildRemoveRange:nn,buildKeepRange:rn,buildKeepToStartOfRange:on,removeLines:an,insertLine:sn,replaceLine:ln,insertAlinesToChangeset:cn,generateChangeAttribKeysFromAline:dn,replaceAttribs:fn,getAttributeOnAline:hn,getAlineAttributes:pn,getInlineAttributesInEnter:gn,getAttributeValue:vn,_applyToAttribution:F._applyToAttribution,_builder:F._builder,_compose:F._compose,_follow:F._follow,_mapFollow:F._mapFollow,_moveOpsToNewPool:F._moveOpsToNewPool,_opIterator:F._opIterator,_pack:F._pack,_slicerZipperFunc:F._slicerZipperFunc,_stringAssembler:F._stringAssembler,_unpack:F._unpack,appendATextToAssembler:F.appendATextToAssembler,applyToText_:F.applyToText_,applyToZatext:F.applyToZatext,applyZip:F.applyZip,arrayIterator:F.arrayIterator,assert:F.assert,attribsAttributeValue:F.attribsAttributeValue,attributeTester:F.attributeTester,bankAssembler:F.bankAssembler,bankIterator:F.bankIterator,builder:F.builder,clearAtext:F.clearAtext,clearOp:F.clearOp,compose:F.compose,composeAttributes:F.composeAttributes,composeUnpacked:F.composeUnpacked,copyOp:F.copyOp,csMap:F.csMap,csMapPack:F.csMapPack,doInverse:F.doInverse,eachAttribNumber:F.eachAttribNumber,follow:F.follow,followAttributes:F.followAttributes,formatCs:F.formatCs,formatCsFromObj:F.formatCsFromObj,getAttribNumbers:F.getAttribNumbers,getEmptyAttrib:F.getEmptyAttrib,getEmptyText:F.getEmptyText,listAssembler:F.listAssembler,makeAttribsString:F.makeAttribsString,mapAttribNumbers:F.mapAttribNumbers,mergingOpAssembler:F.mergingOpAssembler,moveOpsToNewPool:F.moveOpsToNewPool,newOp:F.newOp,numToString:F.numToString,opAssembler:F.opAssembler,opIterator:F.opIterator,OpIterator:F.OpIterator,pack:F.pack,parseNum:F.parseNum,reverseBuilder:F.reverseBuilder,smartOpAssembler:F.smartOpAssembler,stringAssembler:F.stringAssembler,stringIterator:F.stringIterator,toObject:F.toObject,toString:F.toString,unpack:F.unpack}),yn=new RegExp("(https?|http|ftp)://(("+/localhost:[0-9]{2,5}/.source+")|("+/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}(2[0-4][0-9]|25[0-5]|1[0-9]{2}|[1-9][0-9]|[0-9])(:[0-9]{2,5})?/.source+"))(/[-a-zA-Z0-9@:%_+.~#?&//=]*)?","gi"),bn=/((https?|http|ftp):\/\/)?[-a-zA-Z0-9:%._+~#=]{2,256}\.(com|org|net|edu|gov|aero|app|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|travel|arpa|asia|xxx|google|[a-z][a-z])\b([-a-zA-Z0-9@:%_+.~#?&//=;()$,!]*)/gi,En=/(?:mailto:)?[\w.!#$%&'*+-/=?^_`{|}~]+@[A-Za-z0-9.-]+\.(com|org|net|edu|gov|aero|app|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|travel|arpa|asia|xxx|[a-z][a-z])/gi,kn=new RegExp("("+yn.source+")|("+bn.source+")|("+En.source+")","gi"),Cn=/^(?!data:)(?:mailto:)?[\w.!#$%&'*+-/=?^_`{|}~]{1,2000}@[A-Za-z0-9.-]+\.(com|org|net|edu|gov|aero|app|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|travel|arpa|asia|xxx|[a-z][a-z])/gi,In="self-select-line",Sn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function Tn(e){void 0===e&&(e=20);for(var t="",n=0;n<e;n++){var r=Math.floor(Math.random()*Sn.length);t+=Sn[r]}return t}function On(e){void 0===e&&(e=20);for(var t="",n=0;n<e;n++){var r=Math.floor(Math.random()*Sn.length);t+=Sn[r]}return t}function wn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function Rn(){var e=(new Date).getTime();return wn()+"-"+e}function An(){return Tn(8)}var xn=z()().addRange(19968,40869).addRange(40870,40907).addRange(13312,19893).addRange(131072,173782).addRange(173824,177972).addRange(177984,178205).addRange(12032,12245).addRange(11904,12019).addRange(63744,64217).addRange(194560,195101).addRange(59413,59503).addRange(58368,58856).addRange(58880,59087).addRange(12736,12771).addRange(12272,12283).addRange(12549,12576).addRange(12704,12730),Mn=z()().addRange(0,1114111).removeRange(19968,40869).removeRange(40870,40907).removeRange(13312,19893).removeRange(131072,173782).removeRange(173824,177972).removeRange(177984,178205).removeRange(12032,12245).removeRange(11904,12019).removeRange(63744,64217).removeRange(194560,195101).removeRange(59413,59503).removeRange(58368,58856).removeRange(58880,59087).removeRange(12736,12771).removeRange(12272,12283).removeRange(12549,12576).removeRange(12704,12730).removeRange(65,90).removeRange(97,122).removeRange(48,57).remove(39);function Nn(t){var n=0,r=new RegExp("(\\S*?)(("+xn.toString()+")*)(\\S*?)(([a-zA-Z0-9]+'?)?[a-zA-Z0-9]*'?)","g"),i=0;function o(){r.lastIndex=i;var e=r.exec(t);return i=r.lastIndex,e}var a=o();function e(){return a&&a[0]}function s(e){void 0===e&&(e=!1),a[2]?n+=Array.from(a[2]).length:n+=0,a[5]&&"'"!==a[5]?n+=e?Array.from(a[5]).length:1:n+=0,a=o()}function l(){return n}return{counts:l,next:s,hasNext:e}}function _n(e,n){void 0===n&&(n=!1);var t=e.replace("\n"," "),r=0;return[].concat(t.split(Mn.toRegExp())).forEach(function(e){if(""!==e){for(var t=Nn(e);t.hasNext();)t.next(n);r+=t.counts()}}),r}function Ln(e){var t=[],n="";return e.split("").forEach(function(e){"\n"===e?(n&&(t.push(n),n=""),t.push(e)):n+=e}),n&&t.push(n),t}var Dn,Bn,Pn=2,Fn={div:1,p:1,pre:1,li:1,ol:1,ul:1,code:1},jn={bold:!0,italic:!0,underline:!0,strikethrough:!0,list:!0},zn="    ",Hn={bold:!0,italic:!0,underline:!0,strikethrough:!0},Un=8,Vn=4,Wn=4,Kn=20,Zn=8,Gn=40,qn=8203,Jn=8,Yn=/[\u0030-\u0039\u0041-\u005A\u0061-\u007A\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF\u0100-\u1FFF\u3040-\u9FFF\uF900-\uFDFF\uFE70-\uFEFE\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFDC]/,Qn=/\s/,Xn=/\n/,$n="lmkr",er={click:"onClick",keydown:"onKeyDown",keyup:"onKeyUp",keypress:"onKeyPress",compostionstart:"onCompositionStart",compositionend:"onCompositionEnd",input:"onInput",blur:"onBlur",focus:"onFocus",paste:"onPaste"},tr={click:"handleClickEvent",keydown:"handleKeyEvent",keyup:"handleKeyEvent",keypress:"handleKeyEvent",compositionstart:"handleCompositionEvent",compositionend:"handleCompositionEvent",paste:"handlePaste",copy:"handleCopy",cut:"handleCut",drop:"handleDrop",blur:"handleBlurEvent"},nr=["click","input","keydown","keyup","keypress","compositionstart","compositionend","paste","copy","cut","blur","drop"],rr=["template-placeholder","template","lang","align","list","heading","text-indent","blockquote"],ir="__DOC__",or={altF9:!0,altC:!0,cmdShift2:!0,delete:!0,return:!0,esc:!0,cmdS:!0,tab:!0,cmdZ:!0,cmdY:!0,cmdI:!0,cmdB:!0,cmdU:!0,cmdK:!0,cmdShiftX:!0,cmdAlt1:!0,cmdAlt2:!0,cmdAlt3:!0,cmdAltS:!0,cmdShiftU:!0,cmdShift8:!0,cmdShift7:!0,cmdShiftC:!0,cmdOptionM:!0,cmdOptionT:!0,cmdShiftRefer:!0,cmdShiftR:!0,cmdShiftL:!0,cmdShiftE:!0,cmdH:!0,ctrlHome:!0,pageUp:!0,pageDown:!0},ar={COPY_WITHOUT_PERMISSION:"COPY_WITHOUT_PERMISSION"},sr="0",lr="clientside",cr=lr+"-",ur='<span class="ace-line-pocket ignore-dom pocket-ignore" data-ignore-mutation data-fake-text="" contenteditable="false" data-ignore-selection=""></span>',dr='<span class="pocket-ignore pocket-ignore-faketext" data-fake-text="" data-contentcollector-ignore-space-at="end">&#8203;</span>',fr='<span class="pocket-ignore pocket-ignore-faketext" data-fake-text="" data-contentcollector-ignore-space-at="start">&#8203;</span>',hr="data-contentcollector-ignore-space-at",pr="data-faketext",gr="willHandleUserChangeset",vr="didHandleUserChangeset",mr="readyToPerformChangeset",yr="dirtyDomWithoutChangeset";(Bn=Dn=Dn||{}).native="native",Bn.perform="perform";var br=Object.freeze({__proto__:null,MOUSE_RIGHT_CLICK:Pn,BLOCK_ELEMENTS:Fn,STYLE_ATTRIBS:jn,THE_TAB:zn,INLINE_TAG:Hn,EDIT_BODY_PADDING_LEFT:Un,LINE_NUMBER_PADDING_RIGHT:Vn,LINE_NUMBER_PADDING_LEFT:Wn,MIN_LINEDIV_WIDTH:Kn,EDIT_BODY_PADDING_TOP:Zn,INNERDOCBODY_LEFT_PADDING:Gn,ZERO_WIDTH_SPACE_CODE:qn,BLOCKQUOTE_MARGIN_TOP:Jn,REGEX_WORDCHAR:Yn,REGEX_SPACE:Qn,REGEX_LINE:Xn,LINE_MARK_ATTIBUTE:$n,MAP_EVENT_TYPE_TO_REACT:er,MAP_EVENT_TYPE_TO_EDITOR_HANDLE:tr,EVENT_NAMES:nr,LINE_ATTRIBS:rr,DOC_ID:ir,padShortcutEnabled:or,EDITOR_EVENTS:ar,DEFAULT_REP_ZONE:sr,LOCAL:lr,PREFIX_LOCAL:cr,FAKEPOCKET:ur,FAKETEXT_PREFIX:dr,FAKETEXT_SUFFIX:fr,IGNORE_SPACE:hr,DATE_FAKETEXT:pr,WILL_HANDLE_USER_CHANGESET:gr,DID_HANDLE_USER_CHANGESET:vr,READY_TO_PERFORM_CHANGESET:mr,DIRTYDOM_WITHOUT_CHANGESET:yr,get UserChangesetType(){return Dn}}),Er="editor-kit",kr=!1,Cr=(Ir.validateWireApool=function(e){kr||e.eachAttrib(function(e,t){0===e.indexOf("clientside-")&&(kr=!0,console.warn("Found unsaveable attribute `"+e+"` in apool from server!"))})},Ir.prototype.initializeBaseAttributedText=function(e){this.tracking=!0,this.baseZatext=e,this.clearSubmittedData(),this.submittedCaretPos=null,this.resetUserChangeset(e.text[0].length),this.userCaretPos=null,this.updateLastTime()},Ir.prototype.clearSubmittedData=function(){this.submittedChangeset=null,this.submittedChangesetId=null},Ir.prototype.resetUserChangeset=function(e){this.userChangeset=this.editor.changesetHelper.identity(e),this.setUserhangesetId(Rn())},Ir.prototype._applyChangesToBase=function(e,t,n,r,i){var o,a;this.userCaretPos=null,this.submittedCaretPos=null;var s,l=this.editor.changesetHelper;t&&(s=new Ne(this.editor).fromJsonableNoCloning(t),Ir.validateWireApool(s),e=l._moveOpsToNewPool(e,s,this.apool));try{this.updateLastTime(),this.baseZatext=l.applyChangesetsToZatext(e,this.baseZatext,this.apool),this.editor.hooks.callAll("baseZatextDidUpdate",{baseZatext:this.baseZatext,apool:this.apool,rev:n})}catch(e){throw this.editor.call("error",{type:"error",e:e,message:e.message||"applyChangesetsToZatext error",from:"etherpad"}),e}var c={},u=l.formatCs(e);try{for(var d=ge(Object.keys(u)),f=d.next();!f.done;f=d.next()){var h,p,g,v=u[f.value],m=v;this.submittedChangeset&&(h=this.submittedChangeset,this.submittedChangeset=l.follow(v,h,!1,this.apool),m=l.follow(h,v,!0,this.apool)),this.submittedChangeset&&(p=l.prepareForWire(this.editor,this.submittedChangeset,this.apool),g=this.getSubmittedChangesetId(),this.editor.hooks.callAll("submittedChangesetFollowed",{baseRev:n,changeset:p.translated,apool:p.pool.toJsonableNoCloning(),uuid_v4:g}));var y,b,E,k=this.userChangeset;this.userChangeset=l.follow(m,k,!0,this.apool),this.userChangeset&&(y=l.prepareForWire(this.editor,this.userChangeset,this.apool),b=this.getUserChangesetId(),this.editor.hooks.callAll("userChangesetFollowed",{baseRev:n,changeset:y.translated,apool:y.pool.toJsonableNoCloning(),uuid_v4:b})),this.editor&&(E=l.follow(k,m,!1,this.apool),Object.assign(c,l._unpack(E)))}}catch(e){o={error:e}}finally{try{f&&!f.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}this.editor&&this.applyChangesetToEditor(l._pack(c,this.apool),r,i)},Ir.prototype.applyChangesToBase=function(e,t,n,r,i){var o=this;this.tracking&&this.editor.inCallStackIfNecessary("applyChangesToBase",function(){o._applyChangesToBase(e,t,n,r,i)},{shouldIncorp:!0,rev:n,cs:Ke(e)})},Ir.prototype.applyChangesetToEditor=function(e,t,n){var r=this;this.editor&&this.editor.callStack.makeNewEvent("nonundoable",function(){r.editor.performDocumentApplyChangeset(e,!0,t,!1,!0,n)})},Ir.prototype.prepareUserChangeset=function(){if(this.submittedChangeset){var e="cannot call prepareUserChangeset when one is already prepared!";throw this.editor&&this.editor.eventEmitter.trigger("Etherpad:Error",[{from:"etherpad",message:e}]),new Error(e)}var t,n=null,r=this.editor.changesetHelper,i=r.isIdentity(this.userChangeset)?null:this.userChangeset;i&&(this.submittedChangeset=i,this.setSubmittedChangesetId(this.userChangesetId),t=r.unpack(i)[0],this.resetUserChangeset(t.newLen),n=i);var o,a=null;return n&&(a=(o=r.prepareForWire(this.editor,n,this.apool)).pool.toJsonableNoCloning(),n=o.translated),{uuid_v4:this.getSubmittedChangesetId(),changeset:n,apool:a}},Ir.prototype.unprepare=function(){if(!this.submittedChangeset)throw new Error("cannot unprepare if there is no prepared changeset! wat u doin");this.userChangeset=this.editor.changesetHelper.compose(this.submittedChangeset,this.userChangeset,this.apool),this.clearSubmittedData()},Ir.prototype.userChangesetForWire=function(){var e=this.editor.changesetHelper.prepareForWire(this.editor,this.userChangeset,this.apool),t=e.pool.toJsonableNoCloning(),n=this.getUserChangesetId();return{changeset:e.translated,apool:t,uuid_v4:n}},Ir.prototype.submittedChangesetForWire=function(){if(this.submittedChangeset){var e=this.editor.changesetHelper.prepareForWire(this.editor,this.submittedChangeset,this.apool),t=e.pool.toJsonableNoCloning(),n=this.getSubmittedChangesetId();return{changeset:e.translated,apool:t,uuid_v4:n}}return{changeset:null,apool:null,uuid_v4:null}},Ir.prototype.applyPreparedChangesetToBase=function(e,l){var c=this;void 0===l&&(l=null),this.submittedChangeset||this.editor.call("error",{type:"error",message:"applySubmittedChangesToBase: no submitted changes to apply",from:"etherpad"});try{if(this.baseZatext=this.editor.changesetHelper.applyToZatext(this.submittedChangeset,this.baseZatext,this.apool),this.updateLastTime(),this.editor.hooks.callAll("baseZatextDidUpdate",{baseZatext:this.baseZatext,apool:this.apool,rev:e}),l&&l.numToAttrib&&this.containsBlockAttrib(l.attribToNum)){var t,n,r=[];for(t in l.attribToNum)-1<t.indexOf("blockId")&&(n=l.attribToNum[t],r.push({patchBlockKey:t,num:n}));r.forEach(function(e){var t=e.num,n=c.extractBlockInfo(l.numToAttrib[t][1]);if(n){for(var r in c.apool.attribToNum)if(0!==r.indexOf(lr)&&-1<r.indexOf(n.blockId)){var i=c.apool.attribToNum[r];if(!Sr(r)){delete c.apool.attribToNum[r];var o,a=c.apool.numToAttrib[i],s=l.numToAttrib[t];s[1]=JSON.stringify(JSON.parse(s[1])),c.editor.version.includes(Er)&&(o=c.editor.getContentState())._dangerouslyReplaceAttribute.apply(o,me(a,s)),c.apool.attribToNum[s.join(",")]=i,c.apool.numToAttrib[i]=s,c.editor.hooks.callAll("updateBlockAttributes",n),c.editor.hooks.callAll("afterUpdateBlockAttributes",{oldBlockAttribute:a,newBlockAttribute:s});break}}}else console.error("BlockId should not be null!")})}}catch(e){throw this.editor.call("error",{type:"error",e:e,message:e.message||"applyToZatext error",from:"etherpad"}),e}this.clearSubmittedData(),this.submittedCaretPos=null},Ir.prototype.setUserChangeNotificationCallback=function(e){this.changeCallback=e},Ir.prototype.hasSubmittedChangeset=function(){return!!this.submittedChangeset},Ir.prototype.hasUncommittedChanges=function(){var e=this.editor.changesetHelper;return!(!this.submittedChangeset&&e.isIdentity(this.userChangeset))},Ir.prototype.updateCaretPos=function(e){this.userCaretPos=e,this.setChangeCallbackTimeout()},Ir.prototype.isMarkingUnsaved=function(){return this.markingUnsaved},Ir.prototype.containsBlockAttrib=function(e){for(var t in e)if(-1<t.indexOf("blockId"))return!0;return!1},Ir.prototype.extractBlockInfo=function(e){try{return JSON.parse(e)}catch(e){return null}},Ir.prototype.setSubmittedChangesetId=function(e){this.submittedChangesetId=e},Ir.prototype.getSubmittedChangesetId=function(){return this.submittedChangesetId||Rn()},Ir.prototype.setUserhangesetId=function(e){this.userChangesetId=e},Ir.prototype.getUserChangesetId=function(){return this.userChangesetId||Rn()},Ir);function Ir(e){var i=this;this.markingUnsaved=!1,this.toSetMarkingUnsaved_=null,this.submittedChangeset=null,this.tracking=!1,this.changeCallback=null,this.submittedCaretPos=null,this.userCaretPos=null,this.changeCallbackTimeout=null,this.lastUpdateTime=(new Date).getTime(),this.asyncApplyCSQueue=[],this.submittedChangesetId=null,this.userChangesetId=null,this.consumeAsyncCS=function(){i.asyncApplyCSQueue.length&&(i.asyncApplyCSQueue.forEach(function(e){i.applyChangesToBase(e)}),i.asyncApplyCSQueue=[])},this.formatCSForWire=function(e){var t=i.editor.changesetHelper.prepareForWire(i.editor,e,i.apool),n=t.pool.toJsonableNoCloning();return{changeset:t.translated,apool:n}},this.followAsyncCS=function(){if(!i.asyncApplyCSQueue.length)return i.formatCSForWire(i.userChangeset);var t=i.userChangeset;return i.asyncApplyCSQueue.forEach(function(e){t=i.editor.changesetHelper.follow(e,t,!1,i.apool)}),i.formatCSForWire(t)},this.setApool=function(e){i.apool=e},this.setChangeCallbackTimeout=function(){return new Promise(function(e,t){i.changeCallback&&null===i.changeCallbackTimeout&&(i.changeCallbackTimeout=window.setTimeout(function(){try{i.changeCallback(),e()}catch(e){t(e)}finally{i.changeCallbackTimeout=null}},0))})},this.setSubmittedChangeset=function(e){i.submittedChangeset=e},this.setUserChangeset=function(e){i.userChangeset=e},this.setTraking=function(e){i.tracking=e},this.getAllUserChanges=function(){return i.userChangesetForWire()},this.getBaseZatext=function(){return i.baseZatext},this.getUnsavedChanges=function(){var e=i.editor.changesetHelper;return i.submittedChangeset?e.compose(i.submittedChangeset,i.userChangeset,i.apool):i.userChangeset},this.getUserChangeset=function(){return i.userChangesetForWire()},this.getSubmittedChanges=function(){return i.submittedChangesetForWire()},this.getApool=function(){return i.apool},this.dispose=function(){i.changeCallback=null},this.destoryTracker=function(){var e=i.changeCallbackTimeout;e&&(clearTimeout(e),i.changeCallback&&i.tryChangeCallback()),i.changeCallbackTimeout=null,i.baseZatext=null,i.userChangeset=null,i.clearSubmittedData()},this.tryChangeCallback=function(){try{i.changeCallback(),i.tracking=!0}catch(e){i.editor.call("error",{e:e,from:"etherpad",message:e.message||"try change call back pseudoError"})}finally{i.changeCallbackTimeout=null}},this.updateLastTime=function(){i.lastUpdateTime=(new Date).getTime()},this.getLastUpdateTime=function(){return i.lastUpdateTime},this.isTracking=function(){return i.tracking},this.baseAttributedTextForWire=function(){},this.composeUserChangeset=function(e,t){var n=i.editor.changesetHelper,r=i.editor;!i.tracking||t||n.isIdentity(e)||(r.call("composeUserChangeset",{currentUserChangeset:i.userChangeset,newChangeset:e}),i.userChangeset=i.editor.changesetHelper.compose(i.userChangeset,e,i.apool),i.userCaretPos=null,i.setChangeCallbackTimeout())},this.setBaseAttributedText=function(e){i.initializeBaseAttributedText(e)},this.asyncApplyChangesToBase=function(e,t){var n,r;i.tracking&&(n=new Ne(i.editor).fromJsonableNoCloning(t),Ir.validateWireApool(n),r=i.editor.changesetHelper._moveOpsToNewPool(e,n,i.apool),i.asyncApplyCSQueue.push(r),i.editor.getInInternationalComposition()||(i.followAsyncCS(),i.consumeAsyncCS()))},this.hasChangesetNeedToCollab=function(e){if(i.editor.changesetHelper.isIdentity(e))return!1;var t=0,n=!1,r=i.getApool();return i.editor.changesetHelper.eachAttribNumber(e,function(e){t++,0!==ve(me(r.getAttrib(e)),1)[0].indexOf(lr)&&(n=!0)}),0===t||n};var t=e.editor,n=e.apool;this.editor=t,this.apool=n||new Ne(this.editor),this.baseZatext=this.editor.changesetHelper.makeZatext("\n"),this.clearSubmittedData(),this.resetUserChangeset(1),this.lastUpdateTime=(new Date).getTime(),this.asyncApplyCSQueue=[]}function Sr(e){if(!Object(O.a)(e))return!1;for(var t=0,n=0,r='"token"';t<e.length;){var i=e[t];if("{"===i)n++;else if("}"===i)n--;else if(i===r[0]){for(var o=t;o<e.length&&r[o-t]===e[o];)o++;if(1===n&&o-t===r.length)return!0}t++}return!1}var Tr=(Or.prototype._getPoint=function(e){var t=this.start.levels,n=t-1,r=-1,i=0,o=new Array(t),a=new Array(t),s=new Array(t);for(o[n]=this.start,a[n]=-1,s[n]=0;0<=n;){for(var l=o[n];l.downPtrs[n]&&r+l.downSkips[n]<e;)r+=l.downSkips[n],i+=l.downSkipWidths[n],l=l.downPtrs[n];o[n]=l,a[n]=r,s[n]=i,0<=--n&&(o[n]=l)}return{nodes:o,idxs:a,loc:e,widthSkips:s,toString:function(){return"getPoint("+e+")"}}},Or.prototype._getNodeAtOffset=function(e){for(var t=this.start,n=this.end,r=0,i=t,o=t.levels-1;0<=o&&i.downPtrs[o];){for(;i.downPtrs[o]&&r+i.downSkipWidths[o]<=e;)r+=i.downSkipWidths[o],i=i.downPtrs[o];o--}return i===t?t.downPtrs[0]:i===n?n.upPtrs[0]:i},Or.prototype._entryWidth=function(e){return e&&e.width||0},Or.prototype._insertKeyAtPoint=function(e,t,n){for(var r=this.start,i=this.end,o={key:t,levels:0,upPtrs:[],downPtrs:[],downSkips:[],downSkipWidths:[]},a=e.nodes,s=e.idxs,l=e.loc,c=e.widthSkips[0]+e.nodes[0].downSkipWidths[0],u=this._entryWidth(n);0===o.levels||Math.random()<.01;){var d=o.levels;o.levels++,d===a.length&&(a[d]=r,s[d]=-1,r.levels++,i.levels++,((r.downPtrs[d]=i).upPtrs[d]=r).downSkips[d]=this.numNodes+1,r.downSkipWidths[d]=this._totalWidth,e.widthSkips[d]=0);var f=o,h=(y=a[d]).downPtrs[d],p=l-s[d],g=y.downSkips[d]+1-p;y.downSkips[d]=p,(y.downPtrs[d]=f).downSkips[d]=g,f.upPtrs[d]=y,(f.downPtrs[d]=h).upPtrs[d]=f;var v=c-e.widthSkips[d],m=y.downSkipWidths[d]+u-v;y.downSkipWidths[d]=v,f.downSkipWidths[d]=m}for(var y,d=o.levels;d<a.length;d++)(y=a[d]).downSkips[d]++,y.downSkipWidths[d]+=u;this.keyToNodeMap["$KEY$"+t]=o,this.numNodes++,this._totalWidth+=u},Or.prototype._getNodeAtPoint=function(e){return e.nodes[0].downPtrs[0]},Or.prototype._deleteKeyAtPoint=function(e){for(var t,n,r,i,o=e.nodes[0].downPtrs[0],a=this._entryWidth(o.entry),s=0;s<e.nodes.length;s++)s<o.levels?(i=o.upPtrs[s],t=o.downPtrs[s],n=i.downSkips[s]+o.downSkips[s]-1,((i.downPtrs[s]=t).upPtrs[s]=i).downSkips[s]=n,r=i.downSkipWidths[s]+o.downSkipWidths[s]-a,i.downSkipWidths[s]=r):((i=e.nodes[s]).downSkips[s]--,i.downSkipWidths[s]-=a);delete this.keyToNodeMap["$KEY$"+o.key],this.numNodes--,this._totalWidth-=a},Or.prototype._propagateWidthChange=function(e){for(var t=e.downSkipWidths[0],n=this._entryWidth(e.entry)-t,r=e,i=0;i<r.levels;)for(r.downSkipWidths[i]+=n,i++;i>=r.levels&&r.upPtrs[i-1];)r=r.upPtrs[i-1];this._totalWidth+=n},Or.prototype._getNodeIndex=function(e,t){for(var n=t?0:-1,r=e;r!==this.start;){if(!r)return-1;var i=r.levels-1,r=r.upPtrs[i];n+=(t?r.downSkipWidths:r.downSkips)[i]}return n},Or.prototype._getNodeByKey=function(e){return this.keyToNodeMap["$KEY$"+e]},Or.prototype._search=function(t){var n=this.start,r=this.end,e=n,i=n.levels-1,o=-1;function a(e){return e!==n&&(e===r||t(e.entry))}for(;0<=i;){for(var s=e.downPtrs[i];!a(s);)o+=e.downSkips[i],s=(e=s).downPtrs[i];i--}return o+1},Or.prototype.isStartOfLine=function(e,t){return this.atIndex(e).lineMarker===t},Or.prototype.isEndOfLine=function(e,t){return this.atIndex(e).width===t+1},Or.prototype.length=function(){return this.numNodes},Or.prototype.atIndex=function(e){e<0&&console.warn("atIndex("+e+")"),e>=this.numNodes&&console.warn("atIndex("+e+">="+this.numNodes+")");var t=this._getNodeAtPoint(this._getPoint(e));return t&&t.entry},Or.prototype.splice=function(e,t,n){void 0===n&&(n=[]),e<0&&console.warn("splice("+e+", ...)"),e+t>this.numNodes&&(console.warn("splice("+e+", "+t+", ...), N="+this.numNodes),console.warn("%s %s %s",fe()(e),fe()(t),fe()(this.numNodes)),console.trace()),n=n||[];for(var r=this._getPoint(e),i=0;i<t;i++)this._deleteKeyAtPoint(r);for(i=n.length-1;0<=i;i--){var o=n[i];this._insertKeyAtPoint(r,o.key,o),this._getNodeByKey(o.key).entry=o}},Or.prototype.next=function(e){return this._getNodeByKey(e.key).downPtrs[0].entry||null},Or.prototype.prev=function(e){return this._getNodeByKey(e.key).upPtrs[0].entry||null},Or.prototype.push=function(e){this.splice(this.numNodes,0,[e])},Or.prototype.slice=function(e,t){var n=this.numNodes;if(void 0===e?e=0:e<0&&(e+=n),void 0===t?t=n:t<0&&(t+=n),e<0&&(e=0),n<e&&(e=n),t<0&&(t=0),n<t&&(t=n),t<=e)return[];for(var r=this.atIndex(e),i=[r],o=1;o<t-e;o++)r=this.next(r),i.push(r);return i},Or.prototype.atKey=function(e){var t=this._getNodeByKey(e);return t&&t.entry},Or.prototype.indexOfKey=function(e){return this._getNodeIndex(this._getNodeByKey(e))},Or.prototype.indexOfEntry=function(e){return this.indexOfKey(e.key)},Or.prototype.containsKey=function(e){return!!this._getNodeByKey(e)},Or.prototype.atOffset=function(e){return this._getNodeAtOffset(e).entry},Or.prototype.keyAtOffset=function(e){return this.atOffset(e).key},Or.prototype.keyAtIndex=function(e){return this.atIndex(e).key},Or.prototype.offsetOfKey=function(e){return this._getNodeIndex(this._getNodeByKey(e),!0)},Or.prototype.offsetOfEntry=function(e){return this.offsetOfKey(e.key)},Or.prototype.offsetOfPoint=function(e,t){return this.offsetOfIndex(e)+t},Or.prototype.setEntryWidth=function(e,t){e.width=t,this._propagateWidthChange(this._getNodeByKey(e.key))},Or.prototype.totalWidth=function(){return this._totalWidth},Or.prototype.setTotalWidth=function(e){this._totalWidth=e},Or.prototype.offsetOfIndex=function(e){if(e<0)return 0;if(e>=this.numNodes&&0<=this.numNodes-1&&this.atIndex(this.numNodes-1)){var t=this.atIndex(this.numNodes-1);return this.offsetOfEntry(t)+t.width}return e>=this.numNodes?this._totalWidth:this.offsetOfEntry(this.atIndex(e))},Or.prototype.indexOfOffset=function(e){return e<=0?0:e>=this._totalWidth?this.numNodes:this.indexOfEntry(this.atOffset(e))},Or.prototype.selectionOfOffset=function(e){if(e<=0)return[0,0];if(e>this._totalWidth)return this.selectionOfOffset(this._totalWidth-1);var t=this.indexOfOffset(e);return[t,e-this.offsetOfIndex(t)]},Or.prototype.search=function(e){return this._search(e)},Or.prototype.debugDepth=function(){return this.start.levels},Or.prototype.getNumNodes=function(){return this.numNodes},Or.prototype.traverseEntries=function(e,t,n){for(var r=e,i=this.atIndex(r)||null;r<=t;r++,i=this.next(i)){if(!i)throw new Error("attempt to iterate lineEntry which doesn't exist at index: "+r);if(!i.lineNode)throw new Error("lineNode is missing on activateNodes");n(i,r)}},Or.prototype.clearRects=function(){this.traverseEntries(0,this.length()-1,function(e){e.deleteRect()})},Or);function Or(e){var t=this;this.debugGetPoint=function(e){t._getPoint(e)},this.start={key:null,levels:1,upPtrs:[],downPtrs:[],downSkips:[1],downSkipWidths:[0]},this.end={key:null,levels:1,upPtrs:[],downPtrs:[],downSkips:[],downSkipWidths:[]},this.numNodes=0,this._totalWidth=0,this.keyToNodeMap={},this.start.downPtrs.push(this.end),this.end.upPtrs.push(this.start)}var wr=(Rr.prototype.setErrorHandler=function(e){this.handleError=e},Rr.prototype.wrapError=function(n){var r=this;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return n.apply(void 0,me(e))}catch(e){r.handleError(e)}}},Rr.prototype.handleError=function(e){throw!e.silence&&this.editor&&this.editor.call("error",{type:"changeset",e:e,message:e.message,from:"etherpad"}),e},Rr);function Rr(e){for(var t in this.editor=e,mn)"function"==typeof mn[t]&&(this[t]=this.wrapError(mn[t]))}var Ar=Object.freeze({__proto__:null,ChangesetHelper:wr});function xr(e,t){for(var n=t.numToAttrib,r={},i=0,o=e.length;i<o;i++){var a=n[parseInt(e[i],36)]||[],s=/mention-token|mention-type|mention-link|mention-notify|mention-sharePermHeldBack|mention-icon/.exec(a[0]);s&&(r[s[0]]=a[0].split("_")[1]||a[1])}return r}function Mr(t,e){return e.find(function(e){return e[0]===t})}function Nr(e,t,n){var a={alines:["|1+1"],alltext:"\n"};n=n||new wr;var r=_r(a,e,n),i=n.checkRep(r);return n.mutateAttributionLines(i,function(){return a.alines||(a.alines=["|1+1"]),{splice:function(e){var t,n=ve(e),r=n[0],i=n[1],o=n.slice(2);(t=a.alines).splice.apply(t,me([r,i],o))},get:function(e){return a.alines[e]},length:function(){return a.alines.length},slice:function(e,t){return a.alines.slice(e,t)}}},t),a.alines}function _r(e,t,n){var r=t.text,i=n.smartOpAssembler(),o=n.newOp("-");o.chars=0,o.lines=0,i.append(o),o.chars=0,o.lines=0,i.append(o),n.appendATextToAssembler(t,i);var a=1+i.getLengthChange();return n.pack(e.alltext.length,a,i.toString(),r.slice(0,-1))}function Lr(e,t){return e.split("*").map(function(e){return/^\w+$/.test(e)&&t.getAttribKey(parseInt(e,36))||""}).filter(Boolean)}function Dr(e,t){var n=t.numToAttrib;return e.map(function(e){var t=parseInt(e,36);return n[t]||[]})}function Br(e,t){var i=t.numToAttrib;return e.reduce(function(e,t){var n=parseInt(t,36),r=i[n];return r&&(e[r[0]]=r[1]),e},{})}function Pr(n,e){var t=e.selStart,r=void 0===t?[0,0]:t,i=e.selEnd,o=void 0===i?[]:i,a=e.selZone,s=void 0===a?"0":a,l=n.getRep(s),c=l.alines,u=l.alinesWidth,d=l.lines,f=l.apool;0===o.length&&(o[0]=u.length-1,o[1]=u.slice(-1).pop());for(var h=[],p=[],g=r[0],v=o[0],m=g;m<=v;m++){var y=n.changesetHelper.opIterator(c[m]),b=d.atIndex(m);if(b){var E=m===r[0],k=m===o[0],C=E?r[1]:0,I=k?Math.min(o[1],b.text.length):b.text.length;"*"===b.text[0]&&(C+=1,I+=1);for(var S=0,T={selStart:[],selEnd:[],text:"\n",attributes:[],attribsNum:[],attributesMap:{}};y.hasNext();){var O=y.next(),w=O.chars,R=O.attribs;if(!((S+=w)<=C)){var x=[m,C],M=void 0,M=I<S?[m,I]:[m,S],N=b.text.slice(C,M[1]),C=S,_=R.split("*").slice(1),L=Dr(_,f),D=Br(_,f);if(D[$n]?(T.attributes=L,T.attributesMap=D,T.attribsNum=_):p.push({selStart:x,selEnd:M,text:N,attributes:L,attributesMap:D,attribsNum:_}),I<=C)break}}I>=b.text.length&&(T.selStart=[m,I],T.selEnd=[m,I],p.push(T))}else n.call("error",{type:"error",message:"Cannot find lineEntry at index "+m,from:"etherpad",e:new Error("CannotFindLineEntry")}),n.log("Cannot find lineEntry at index ",m,"from lines",d)}return p.forEach(function(e){var t=n.hooks.callAll("collectText",{attributes:e.attributes});t&&t.length?h.push({text:Object(H.a)(t),attributes:e.attributesMap}):h.push({text:e.text,attributes:e.attributesMap})}),h}function Fr(u,e){return e.reduce(function(e,t){var n=ve(t,4),r=n[0],i=n[1],o=n[2],a=n[3];if(a===Kr)return e.push({startIndex:r,deleteCount:i,addCount:o,zoneId:a,childZones:[]}),e;var s=u.getRep(Kr).lines,l=u.managers.zoneToLineEntry[a];if(!l)return e;if(!s.containsKey(l.key))return e;var c=s.indexOfEntry(l);return e.find(function(e){var t=e.startIndex,n=e.deleteCount;return t<=c&&c<t+n})||e.push({startIndex:c,deleteCount:1,addCount:1,zoneId:Kr,childZones:[{startIndex:r,deleteCount:i,addCount:o,zoneId:a}]}),e},[])}var jr="lmkr",zr=[jr,"list"],Hr="space-line",Ur=(Vr.prototype.applyChangeset=function(e){if(!this.applyChangesetCallback)return e;var t=this.editor.changesetHelper,n=e.toString();return t.isIdentity(n)||this.applyChangesetCallback(n),e},Vr.prototype.getClientSideAttrib=function(e){return e.map(function(e){var t=ve(e,2),n=t[0],r=t[1];return 0===n.indexOf(cr)?[n,r]:[""+cr+n,r]})},Vr.prototype.setAttributesOnRange=function(e,t,n,r){var i=this.attributeOp2Changeset({selStart:e,selEnd:t,attribs:n},r);return this.applyChangeset(i)},Vr.prototype.setAttributesOnMultiRanges=function(e,a){var s=this;if(e.length){var l=this.editor.changesetHelper,t=e.reduce(function(e,t){var n=t.selStart,r=t.selEnd,i=t.attribs,o=s.attributeOp2Changeset({selStart:n,selEnd:r,attribs:i},a);return e?l.compose(e.toString(),o.toString(),s.rep.repManager.apool):o},null);return this.applyChangeset(t)}},Vr.prototype.attributeOp2Changeset=function(e,t){for(var n=e.selStart,r=e.selEnd,i=e.attribs,i=this.handleLocalAttribute(t,i,n,r),o=this.editor.changesetHelper,a=n[0];a<=r[0];a++)var s=this._findRowRange(a,n,r),l=s[0],c=s[1],u=this._setAttributesOnRangeByLine(a,l,c,i),d=d?o.compose(d.toString(),u.toString(),this.rep.repManager.apool):u;return d},Vr.prototype._findRowRange=function(e,t,n){var r=this.rep.lines.offsetOfIndex(e),i=this.rep.lines.offsetOfIndex(e+1)-r,o=e===t[0]&&0!==t[1]?t[1]:this.lineHasMarker(e)?1:0,a=e===n[0]?n[1]:i-1;return[o,a]},Vr.prototype._setAttributesOnRangeByLine=function(e,t,n,r){var i=this.editor.changesetHelper,o=i.builder(this.rep.lines.totalWidth(),"Z",this.rep.zoneId);return i.buildKeepToStartOfRange(this.rep,o,[e,t]),i.buildKeepRange(this.rep,o,[e,t],[e,n],r,this.rep.repManager.apool),o},Vr.prototype.lineHasMarker=function(t){var n=this;return void 0!==Object(P.a)(zr,function(e){return""!==n.getAttributeOnLine(t,e)})},Vr.prototype.findAttributeOnLine=function(e,r){var i="",o=this.editor.changesetHelper,t=this.rep.alines[e];if(t)for(var n=function(t,e){var n=e.next().attribs;n&&o.eachAttribNumber(n,function(e){t.getAttribKey(e)===r&&(i=t.getAttribValue(e))})},a=this.rep.repManager.apool,s=o.opIterator(t,0);s.hasNext();)n(a,s);return i},Vr.prototype.getAttributeOnLine=function(e,t){var n=this.rep.alines[e],r=this.editor.changesetHelper;return n?r.attribsAttributeValue(n,t,this.rep.apool):""},Vr.prototype.getAttributesOnLine=function(e){var t=this,n=this.rep.alines[e],r=this.editor.changesetHelper,i=[];if(n){var o=r.opIterator(n,0),a=void 0;if(o.hasNext())return(a=o.next()).attribs?(r.eachAttribNumber(a.attribs,function(e){i.push([t.rep.repManager.apool.getAttribKey(e),t.rep.repManager.apool.getAttribValue(e)])}),i):[]}return[]},Vr.prototype.getAttributePoints=function(e,t,n,r){return this.getAttributesPoints([{attr:e,value:t}],n,r)},Vr.prototype.getAttributesPoints=function(e,t,n){var o=this;void 0===e&&(e=[]);var s=t||0,r=n||this.rep.lines.length(),l=this.editor.changesetHelper,i=this.rep.alines.slice(s,r),c=[],u=e.reduce(function(e,t){var n=t.attr,r=t.value,i=o.rep.repManager.apool.attribToNum[n+","+r];return Object(T.default)(i)||e.push(l.numToString(i)),e},[]);return u.length<=0||i.forEach(function(e,t){for(var n=0,r=t+s,i=l.opIterator(e,0);i.hasNext();){var o=i.next(),a=o.chars;o.attribs&&Object(P.a)(o.attribs.split("*"),function(e){return""!==e&&-1<u.indexOf(e)})&&c.push({selStart:[r,n],selEnd:[r,n+a]}),n+=a}}),c},Vr.prototype.getAttributesAndPoints=function(s,e,t){void 0===s&&(s=[]);var r=e||0,n=t||this.rep.lines.length(),l=this.editor.changesetHelper,i=this.rep.alines.slice(r,r===n?r+1:n),c=[];if(!s.length)return c;var u=this.rep.repManager.apool.numToAttrib;return Object(B.a)(i,function(e,t){for(var i=0,o=t+r,a=l.opIterator(e,0),n=function(){var e,n,t=a.next(),r=t.chars;t.attribs&&(e=t.attribs.split("*").filter(function(e){return e}).map(function(e){return parseInt(e,36)}).map(function(e){return u[e]}),n=[],s.forEach(function(t){e.forEach(function(e){t[0]!==e[0]||t[1]&&t[1]!==e[1]||n.push(e)})}),n.length===s.length&&c.push({attribs:n,selStart:[o,i],selEnd:[o,i+r]})),i+=r};a.hasNext();)n()}),c},Vr.prototype.hasIt=function(e,t){return e.test(t)},Vr.prototype.rangeHasAttrib=function(e,t,n,r){if(e[1]===t[1]&&e[0]===t[0])return!1;if(e[0]!==t[0]){for(var i=(i=!0)&&this.rangeHasAttrib(e,[e[0],n.lines.atIndex(e[0]).text.length],n,r),o=e[0]+1;o<t[0];o++)i=i&&this.rangeHasAttrib([o,0],[o,n.lines.atIndex(o).text.length],n,r);return i=i&&this.rangeHasAttrib([t[0],0],[t[0],t[1]],n,r)}for(var a=e[0],s=e[1],l=t[1],c=!0,u=this.editor.changesetHelper.opIterator(n.alines[a],0),d=0;u.hasNext();){var f=u.next(),h=d,p=h+f.chars;if(!this.hasIt(r,f.attribs)&&!(p<=s||l<=h)){c=!1;break}d=p}return c},Vr.prototype.formatAttribsToObj=function(e){for(var t={attribs:[].concat(e),attribsKey:{}},n=e.length,r=0;r<n;++r){var i=e[r]&&e[r][0]||"",o=e[r]&&e[r][1]||"";i&&(t.attribsKey[i+"-"+o]=!0)}return t},Vr.prototype.getLineMarkerAttribs=function(e,t){var n,r={attribs:[],attribsKey:{}};return e<0||e>=t.lines.length()||t.lines.atIndex(e).lineMarker&&(n=this.getAttributesOnPosition(e,0),r=this.formatAttribsToObj(n)),r},Vr.prototype.mergeAttribs=function(e,t){return e.attribs=e.attribs.concat(t.attribs),Object(S.a)(e.attribsKey,t.attribsKey),e},Vr.prototype.getCommonAttribs=function(e,h){var p=this;return void 0===e&&(e=[]),void 0===h&&(h=!1),e.length?1===e.length?e[0]:e.reduce(function(e,t){var n,r,i,o,a=e.attribsKey,s=e.attribs,l=t.attribsKey,c=t.attribs,u={attribs:[],attribsKey:{}};if(t.attribsKey[Hr+"-true"]){var d=p.mergeAttribs(e,t);return p.removeMagicKey(d)}if(h)for(var f in a)a.hasOwnProperty(f)&&l.hasOwnProperty(f)&&(u.attribsKey[f]=a[f],(n=f.match(/(\S*)-(\S*)/))&&(i=(r=ve(n,3))[1],o=r[2],u.attribs.push([i,o])));else s.forEach(function(t){c.forEach(function(e){t[0]===e[0]&&(u.attribsKey[t[0]+"-"+t[1]]||(u.attribs.push(t),u.attribsKey[t[0]+"-"+t[1]]=!0),t[1]===e[1]||u.attribsKey[e[0]+"-"+e[1]]||(u.attribs.push(e),u.attribsKey[e[0]+"-"+e[1]]=!0))})});return u},e[0]):{attribs:[],attribsKey:{}}},Vr.prototype.hasEntry=function(e,t){return!!e.lines.atIndex(t)},Vr.prototype.getCommonAttributesOnSelection=function(e,t,n,r,i){void 0===r&&(r=!0),void 0===i&&(i=!1);var o=this.getCommonAttributes(e,t,n,r,i),a=o.lineAttribs,s=o.inlineAttribs,l=this.mergeAttribs(a,s),c=l.attribs.filter(function(e){return e[0]!==Hr});return delete l.attribsKey[Hr+"-true"],{attribs:c,attribsKey:l.attribsKey}},Vr.prototype.getAttributesOnSelection=function(e,t,n,r){var i=this._getAttributesOnSelection(e,t,n,r),o=i.reduce(function(e,t){var n=ve(t,2);return e[n[0]+"-"+n[1]]=!0,e},{});return{attribs:i,attribsKey:o}},Vr.prototype._getAttributesOnSelection=function(e,t,n,r){var i,o=[],a=0!=r;if(!e||!t)return o;if(e[1]===t[1]&&e[0]===t[0]){var s=[],l=n.lines.atIndex(e[0]),c=l&&l.lineMarker;a&&e[1]&&c&&(s=this.getAttributesOnPosition(e[0],0));var u=this.getAttributesOnPosition(e[0],e[1]);return s.concat(u)}if(e[0]!==t[0]){this.hasEntry(n,e[0])&&(i=this._getAttributesOnSelection(e,[e[0],n.lines.atIndex(e[0]).text.length],n,r),o.push.apply(o,me(i)));for(var d,f=e[0]+1;f<t[0];f++)this.hasEntry(n,f)&&(d=this._getAttributesOnSelection([f,0],[f,n.lines.atIndex(f).text.length],n,r),o.push.apply(o,me(d)));u=this._getAttributesOnSelection([t[0],0],[t[0],t[1]],n,r);return o.push.apply(o,me(u)),o}var h=e[0],p=e[1],g=t[1],v=[],m=n.lines.atIndex(h),y=m&&m.lineMarker;a&&p&&y&&(v=this.getAttributesOnPosition(e[0],0));for(var b=this.editor.changesetHelper,E=b.opIterator(n.alines[h],0),k=0;E.hasNext();){var C=E.next(),I=k+C.chars;I<=p||g<=k||b.eachAttribNumber(C.attribs,function(e){o.push([n.repManager.apool.getAttribKey(e),n.repManager.apool.getAttribValue(e)])}),k=I}return v.length?v.concat(o):o},Vr.prototype.getAttributeOnSelection=function(e,t,n){var r=this.rep,i=this.editor.changesetHelper,o=n||r;if(o.selStart&&o.selEnd){o.selStart[0]===o.selEnd[0]&&o.selEnd[1]===o.selStart[1]&&t&&0!==o.selStart[1]&&o.selStart[1]--;var a=i.makeAttribsString("+",[[e,"true"]],this.rep.repManager.apool),s=new RegExp(a.replace(/\*/g,"\\*")+"(\\*|$)");return this.rangeHasAttrib(o.selStart,o.selEnd,r,s)}},Vr.prototype.getAttributesOnPosition=function(e,t){var n=this,r=this.rep.alines[e],i=this.editor.changesetHelper;if(!r)return[];for(var o,a=i.opIterator(r,0),s=0,l=[];a.hasNext();)if(t<=(s+=(o=a.next()).chars))return i.eachAttribNumber(o.attribs,function(e){l.push([n.rep.repManager.apool.getAttribKey(e),n.rep.repManager.apool.getAttribValue(e)])}),l;return l},Vr.prototype.getAttributesByKeysOnSelection=function(o,e,t,a){var n,s=this,l=[];if(!e||!t)return l;if(Object(N.default)(e,t)){var r=this.getLineMarkerAttribs(e[0],a).attribs,i=r.some(function(e){var t=ve(e,1)[0];return s.isLineAttribs(t)})&&e[1]<=1?this.getAttributesOnPosition(e[0],2):this.getAttributesOnPosition(e[0],e[1]);return o.forEach(function(e){var t;t=s.isLineAttribs(e)?Mr(e,r):Mr(e,i),l.push(t||[e,void 0])}),l}if(e[0]!==t[0]){this.hasEntry(a,e[0])&&(n=this.getAttributesByKeysOnSelection(o,e,[e[0],a.lines.atIndex(e[0]).text.length],a),l=this.mergeAttribPair(l,n));for(var c,u=e[0]+1;u<t[0];u++)this.hasEntry(a,u)&&(c=this.getAttributesByKeysOnSelection(o,[u,0],[u,a.lines.atIndex(u).text.length],a),l=this.mergeAttribPair(l,c));var d=this.getAttributesByKeysOnSelection(o,[t[0],0],[t[0],t[1]],a);return l=this.mergeAttribPair(l,d)}for(var f=e[0],h=e[1],p=t[1],g=this.editor.changesetHelper,v=g.opIterator(a.alines[f],0),m=0,y=function(){var r,e,t,n=v.next(),i=m+n.chars;i<=h||p<=m||(r=[],g.eachAttribNumber(n.attribs,function(e){var t=a.repManager.apool.getAttribKey(e),n=a.repManager.apool.getAttribValue(e);o.includes(t)&&(r.push(t),l.push([t,n]))}),(e=Object(C.a)(o,r)).length&&(t=[],e.forEach(function(e){s.isLineAttribs(e)||t.push([e,void 0])}),l=b.mergeAttribPair(l,t))),m=i},b=this;v.hasNext();)y();var E=this.getLineMarkerAttribs(f,a).attribs,k=[];return o.forEach(function(e){var t;s.isLineAttribs(e)&&(t=Mr(e,E),k.push(t||[e,void 0]))}),this.mergeAttribPair(l,k)},Vr.prototype.checkAttributeOnPosition=function(e,t,n,r){var i=this,o=this.rep.alines[e],a=this.editor.changesetHelper;if(!o)return[];for(var s,l=a.opIterator(o,0),c=0,u=!1;l.hasNext();)if(t<=(c+=(s=l.next()).chars))return a.eachAttribNumber(s.attribs,function(e){n===i.rep.repManager.apool.getAttribKey(e)&&r===i.rep.repManager.apool.getAttribValue(e)&&(u=!0)}),u;return u},Vr.prototype.getAttributesOnCaret=function(){var e=this.rep.selStart;return this.getAttributesOnPosition(e[0],e[1])},Vr.prototype.setAttributesOnLine=function(e,t){var n,r=this.editor.changesetHelper,i=[0,0],o=r.builder(this.rep.lines.totalWidth(),"Z",this.rep.zoneId),a=this.lineHasMarker(e);return r.buildKeepRange(this.rep,o,i,i=[e,0]),a?r.buildKeepRange(this.rep,o,i,i=[e,1],t,this.rep.repManager.apool):(n=(n=[["insertorder","first"],["lmkr","1"]]).concat(t),o.insert("*",n,this.rep.repManager.apool)),this.applyChangeset(o)},Vr.prototype.handleLocalAttribute=function(e,t,n,r){var i,o,a,s=this;return t=e===lr?this.getClientSideAttrib(t):(i=n&&r?this.getAttributesOnSelection(n,r,this.rep,!0).attribs:this.getAttributesOnLine(n),o=[],a=[],i.forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];0===n.indexOf(cr)&&""!==r&&o.push(n.substring(11))}),o.length&&t.forEach(function(e){var t=e[0];o.forEach(function(e){t===e&&a.push(s.getClientSideAttrib([[t,""]])[0])})}),a&&a.length?me(t,a):t)},Vr.prototype.setAttributeOnLine=function(e,t,n,r){var i,o,a=this.editor.changesetHelper,s=[0,0],l=a.builder(this.rep.lines.totalWidth(),"Z",this.rep.zoneId),c=this.lineHasMarker(e);return a.buildKeepRange(this.rep,l,s,s=[e,0]),c?(i=this.handleLocalAttribute(r,[[t,n]],e),a.buildKeepRange(this.rep,l,s,s=[e,1],i,this.rep.repManager.apool)):(o=[["insertorder","first"],[jr,"1"],[t,n]],o=this.handleLocalAttribute(r,o,e),l.insert("*",o,this.rep.repManager.apool)),this.applyChangeset(l)},Vr.prototype.removeAttributesOnLine=function(e,n){var t=this.editor.changesetHelper,r=t.builder(this.rep.lines.totalWidth(),"Z",this.rep.zoneId),i=this.lineHasMarker(e),a=!1,o=Object(K.default)(this.getAttributesOnLine(e),function(e){var t=ve(e,2),i=t[0],o=t[1];return n.find(function(e){if(Array.isArray(e)){var t=ve(e,2),n=t[0],r=t[1];return i===n&&(!r||o===r)}return i===e})?(a=!0,[i,""]):[i,o]});if(a){t.buildKeepToStartOfRange(this.rep,r,[e,0]);var s=o.filter(function(e){return!!e[1]}).map(function(e){return e[0]}).filter(function(e){return!["author","lmkr","insertorder","start","lineguid"].includes(e)}).length;return i&&!s?t.buildRemoveRange(this.rep,r,[e,0],[e,1]):t.buildKeepRange(this.rep,r,[e,0],[e,1],o,this.rep.repManager.apool),this.applyChangeset(r)}},Vr.prototype.removeAttributeOnMultiLines=function(e,o,a){var s=this,l=this.editor.changesetHelper;if(!Array.isArray(e)||!e.length)return!1;if(!o)return!1;var c=l.builder(this.rep.lines.totalWidth(),"Z",this.rep.zoneId),u=[0,0];return e.forEach(function(e){var t,n=s.lineHasMarker(e),r=!1,i=Object(K.default)(s.getAttributesOnLine(e),function(e){return e[0]!==o||a&&e[0]!==a?e:(r=!0,[o,""])});r&&(l.buildKeepRange(s.rep,c,u,u=[e,0]),t=i.filter(function(e){return!!e[1]}).map(function(e){return e[0]}).filter(function(e){return!["author","lmkr","insertorder","start","lineguid"].includes(e)}).length,n&&!t?l.buildRemoveRange(s.rep,c,[e,0],u=[e,1]):l.buildKeepRange(s.rep,c,[e,0],u=[e,1],i,s.rep.repManager.apool))}),this.applyChangeset(c)},Vr.prototype.toggleAttributeOnLine=function(e,t,n){return this.getAttributeOnLine(e,t)?this.removeAttributeOnLine(e,t):this.setAttributeOnLine(e,t,n)},Vr.prototype.checkAttributesByRegx=function(e,t){for(var n=this.editor.changesetHelper.opIterator(this.rep.alines[e],0);n.hasNext();){var r=this.hasIt(t,n.next().attribs);if(r)return r}return!1},Vr.prototype.checkAttributesByAttrs=function(e,t,n){var r;return void 0===n&&(n=!1),r=n?N.default:function(e,t){return e[0]===t[0]},0<Object(k.a)(t,e,r).length},Vr.prototype.createWithIt=function(e,t){return void 0===t&&(t="true"),this.editor.changesetHelper.makeAttribsString("+",[[e,t]],this.rep.repManager.apool)},Vr.prototype.createRegex=function(e){var n=this;if(!e||!Array.isArray(e))return!1;if(1===e.length){var t=e[0];return new RegExp(this.createWithIt(t[0],t[1]).replace(/\*/g,"\\*")+"(\\*|$)")}var r="";return e&&e.forEach(function(e){var t=n.createWithIt(e[0],e[1]);r+=t.replace(/\*/g,"\\*")+"(\\*|$)|"}),r=r.substr(0,r.length-1),new RegExp(r)},Vr.prototype.getAllAttributesOnLine=function(e){var t=this.editor.changesetHelper.opIterator(this.rep.alines[e],0),n=this.rep.repManager.apool;return this.parseAttributes(t,n)},Vr.prototype.parseAttributes=function(e,n){for(var r=[];e.hasNext();){var t=e.next();Object(B.a)(t.attribs.split("*"),function(e){var t=parseInt(e,36);isNaN(t)||r.push(n.numToAttrib[t])})}return r},Vr.prototype.setAttributeOnMultiLines=function(e,n,r){var i=this;void 0===r&&(r="");var o=this.editor.changesetHelper;if(!Array.isArray(e)||!e.length)return!1;if(!n||!r)return!1;var a=[0,0],s=o.builder(this.rep.lines.totalWidth(),"Z",this.rep.zoneId),l=[n,r];return e.forEach(function(e){var t=i.lineHasMarker(e);o.buildKeepRange(i.rep,s,a,a=[e,0]),t?o.buildKeepRange(i.rep,s,a,a=[e,1],[l],i.rep.repManager.apool):i._insertLineAttribute(s,[[n,r]])}),this.applyChangeset(s)},Vr.prototype.setAttributeOnMultiLinesExcludeAttrs=function(e,n,r,i){var o=this;void 0===r&&(r=[[]]),void 0===i&&(i=!1);var a=this.editor.changesetHelper,s=[0,0],l=a.builder(this.rep.lines.totalWidth(),"Z",this.rep.zoneId);return e.forEach(function(e){var t;(i?o.checkAttributesByRegx(e,o.createRegex(r)):(t=o.getAllAttributesOnLine(e),o.checkAttributesByAttrs(t,r,i)))||(a.buildKeepRange(o.rep,l,s,s=[e,0]),o.lineHasMarker(e)?a.buildKeepRange(o.rep,l,s,s=[e,1],n,o.rep.repManager.apool):o._insertLineAttribute(l,n))}),this.applyChangeset(l)},Vr.prototype._insertLineAttribute=function(e,t){e.insert("*",[["insertorder","first"],[jr,"1"]].concat(t),this.rep.repManager.apool)},Vr.prototype.markAsLineAttribs=function(e){this.lineAttribsSet.add(e)},Vr.prototype.isLineAttribs=function(e){return this.lineAttribsSet.has(e)},Vr.prototype.isEmptyLine=function(e){var t,n,r=this,i=this.editor.changesetHelper,o=this.editor.getRep(),a=i.opIterator(e,0).next(),s=!1;i.eachAttribNumber(a.attribs,function(e){var t=o.repManager.apool.getAttribKey(e);!s&&r.isLineAttribs(t)&&(s=!0)});var l=0;try{for(var c=ge(e),u=c.next();!u.done;u=c.next())"+"===u.value&&l++}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return s?2===l:1===l},Vr.prototype.getCommonAttributes=function(e,t,a,n,r,i){var o,s=this;void 0===n&&(n=!0),void 0===r&&(r=!1),void 0===i&&(i=!1);var l=!!n;if(!e||!t)return{lineAttribs:{attribs:[],attribsKey:{}},inlineAttribs:{attribs:[],attribsKey:{}}};if(e[1]===t[1]&&e[0]===t[0]){var c={attribs:[],attribsKey:{}};l&&(c=this.getLineMarkerAttribs(e[0],a));var u=c.attribs.some(function(e){var t=ve(e,1)[0];return s.isLineAttribs(t)})&&e[1]<=1?this.getAttributesOnPosition(e[0],2):this.getAttributesOnPosition(e[0],e[1]);return r&&u.push([Hr,"true"]),{lineAttribs:c,inlineAttribs:this.formatAttribsToObj(u)}}if(e[0]!==t[0]){var d,f=[];this.hasEntry(a,e[0])&&(d=this.getCommonAttributes(e,[e[0],a.lines.atIndex(e[0]).text.length],a,n,!0),f.push(d));for(var h,p=e[0]+1;p<t[0];p++)this.hasEntry(a,p)&&(h=this.getCommonAttributes([p,0],[p,a.lines.atIndex(p).text.length],a,n,!0),f.push(h));var g=this.getCommonAttributes([t[0],0],[t[0],t[1]],a,n,!0);return f.push(g),this.getCommonSplitAttributes(f,i)}var v=e[0],m=e[1],y=t[1],b={attribs:[],attribsKey:{}};l&&(b=this.getLineMarkerAttribs(v,a));for(var E=this.editor.changesetHelper,k=a.alines[v],C=E.opIterator(k,0),I=0,S={attribs:[],attribsKey:{}},T=[],O=function(){var o,e=C.next(),t=I+e.chars;t<=m||y<=I||(o=!1,E.eachAttribNumber(e.attribs,function(e){var t=a.repManager.apool.getAttribKey(e),n=a.repManager.apool.getAttribValue(e),r=[t,n],i=t+"-"+n;S.attribs.push(r),S.attribsKey[i]=!0,!o&&s.isLineAttribs(t)&&(o=!0)}),o||T.push(S),S={attribs:[],attribsKey:{}}),I=t};C.hasNext();)O();return r&&this.isEmptyLine(k)&&T.push({attribs:[[Hr,"true"]],attribsKey:((o={})[Hr+"-true"]=!0,o)}),{lineAttribs:b,inlineAttribs:this.getCommonAttribs(T,i)}},Vr.prototype.removeMagicKey=function(e){var t=e.attribs.filter(function(e){return e[0]!==Hr});return delete e.attribsKey[Hr+"-true"],{attribs:t,attribsKey:e.attribsKey}},Vr.prototype.getCommonSplitAttributes=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=!1);var n=[],r=[];return e.forEach(function(e){n.push(e.lineAttribs),r.push(e.inlineAttribs)}),{lineAttribs:this.getCommonAttribs(n,t),inlineAttribs:this.getCommonAttribs(r,t)}},Vr.prototype.mergeAttribPair=function(e,t){return Object(E.a)(e.concat(t),N.default)},Vr);function Vr(e,t,n){var i=this;this.editor=e,this.author="",this.lineAttribsSet=new Set(rr),this.removeAttributeOnLine=function(e,t,n){var r=n?[t,n]:t;return i.removeAttributesOnLine(e,[r])},this.rep=t,this.applyChangesetCallback=n}var Wr=new wr,Kr="0",Zr=(Object.defineProperty(Gr.prototype,"alltext",{get:function(){return this._alltext},set:function(e){this._alltext=e,this.alinesWidth.length||this.initAlineWidth(e)},enumerable:!0,configurable:!0}),Object.defineProperty(Gr.prototype,"alines",{get:function(){var i=this;return this._alines.splice=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return i.updateAlineWidth.apply(i,me([e,t],n)),[].splice.apply(i._alines,me([e,t],n))},this._alines},set:function(e){this._alines=e},enumerable:!0,configurable:!0}),Object.defineProperty(Gr.prototype,"apool",{get:function(){return this.repManager.apool},enumerable:!0,configurable:!0}),Gr.prototype.initAlineWidth=function(e){for(var t=e.split("\n"),n=0,r=t.length-1;n<r;n++)this.alinesWidth.push(t[n].length+1)},Gr.prototype.updateAlineWidth=function(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];for(var o=[],a=0,s=r.length;a<s;a++){for(var l=0,c=Wr.opIterator(r[a]);c&&c.hasNext();){var u=c.next();u.chars&&(l+=u.chars)}o.push(l)}(n=this.alinesWidth).splice.apply(n,me([e,t],o))},Gr);function Gr(e,t,n){this.selFocusAtStart=!1,this.alinesWidth=[],this._alltext="",this._alines=[],this.lines=new Tr(n.editor),this.repManager=n,this.attributeManager=new Ur(n.editor,this,t),this.zoneId=e}var qr=Jr;function Jr(){this.alines=[],this.vectorIds=[]}var Yr=(Qr.prototype.getDefault=function(){return this.reps[Kr]},Qr.prototype.getActiveRep=function(){return this.reps[this.activeRep]},Qr.prototype.getVectorReps=function(){return this.vectorReps},Qr.prototype.getRep=function(e){return this.reps[e]},Qr.prototype.setActiveRep=function(e){return!!this.reps[e]&&(this.activeRep=e,!0)},Qr.prototype.addRep=function(e){return this.reps[e]?(console.error("zoneId "),!1):(this.reps[e]=new Zr(e,this.applyChangesetCallback,this),this.reps[e])},Qr.prototype.removeRep=function(e){delete this.reps[e]},Qr.prototype.reset=function(){this.reps={},this.reps[Kr]=new Zr(Kr,this.applyChangesetCallback,this),this.activeRep=Kr},Qr);function Qr(e,t){this.reps={},this.activeRep=Kr,this.vectorReps={},this.editor=e,this.applyChangesetCallback=t,this.apool=new Ne(this.editor),this.reps[Kr]=new Zr(Kr,t,this)}var Xr=Object.freeze({__proto__:null,DEFAULT_REP_ZONE:Kr,Rep:Zr,VectorReps:qr,default:Yr}),$r=["collapse"],ei=(ti.createRender=function(e){var t=new ti;return t.setOptions(e),t.curIndex=0,t.lineLength=e.lineText.length,t.textAndClassFunc=e.textAndClassFunc,t.contextInfo=e.contextInfo||{},t.textAndClassFunc=t.getFilterStack(e.textAndClassFunc),t.attributionIter=Object(F.opIterator)(e.aline),t.goNextOp(),t.nextClasses(),t.renderLineStyle},ti.textAndClassFuncSplitter=function(l,c){var u=0,d=0;if(c)for(;u<c.length&&0===c[u];)u++;function f(e,t,n,r,i,o){var a,s;!c||u>=c.length?(l(e,t,n,"",i),d+=e.length):(a=c[u]-d,(s=e.length)<=a?(l(e,t,n,"",i,o),d+=e.length,a===s&&u++):(0<a&&(l(e.substring(0,a),t,n,"",Object.assign({},i,{isSplit:!0})),d+=a),u++,f(e.substring(a),t,n,r,i,o)))}return f},ti.lineAttributeMarker="lineAttribMarker",ti);function ti(){var p=this;this.getFilterStack=function(e){var t=p.options,n=t.lineText,r=t.browser,i=t.hooks,o=t.aline,a=t.apool,s=e;return i&&i.callAll("aceGetFilterStack",{linestylefilter:p,browser:r,lineText:n,textAndClassFunc:e}).forEach(function(e){s=e(n,s,o,a)}),s},this.setOptions=function(e){p.options=e},this.attribsToClasses=function(e){var o="",a={},s={},l=!1,t=p.options,c=t.apool,u=t.hooks,d=t.collapseStatus,n=t.formatterRenderer,f=p.lineLength,h=[];return Object(F.eachAttribNumber)(e,function(e){var t=c.getAttribKey(e),n=c.getAttribValue(e);t.startsWith(cr)&&n&&h.push(t.slice(cr.length))}),Object(F.eachAttribNumber)(e,function(e){var t,n,r,i=c.getAttribKey(e);h.forEach(function(e){i===e&&(i="")}),i&&(i.startsWith(cr)&&(t=i.substring(cr.length),$r.includes(t)||(i=t)),n=c.getAttribValue(e),(s[i]=n)&&(!l&&0<=zr.indexOf(i)&&(l=!0),a[i]=n,u&&(r={lineTotalLen:f,key:i,value:n,collapseStatus:d},u.callAll("aceAttribsToClasses",r).forEach(function(e){e&&(o+=" "+e)}))))}),n&&n.createRenderData(a),l&&(o+=" "+ti.lineAttributeMarker,s[ti.lineAttributeMarker]=!0),{cls:o.substring(1),attrObj:s}},this.goNextOp=function(){p.nextOp=p.attributionIter.next();var e=p.nextOp&&p.nextOp.opcode&&p.attribsToClasses(p.nextOp.attribs);e?(p.nextOpClasses=e.cls,p.nextAttrObj=e.attrObj):(p.nextOpClasses=void 0,p.nextAttrObj={},p.options.formatterRenderer&&p.options.formatterRenderer.resetNxtAttribute())},this.nextClasses=function(){if(p.curIndex<p.lineLength)for(p.extraClass=p.nextOpClasses,p.curNextAttrObj=p.nextAttrObj,p.options.formatterRenderer&&p.options.formatterRenderer.setCurrentAttribute(),p.leftInAuthor=p.nextOp.chars,p.goNextOp();p.nextOp&&p.nextOp.opcode&&p.nextOpClasses===p.extraClass&&p.options.formatterRenderer&&p.options.formatterRenderer.isSameAttribute();)p.leftInAuthor+=p.nextOp.chars,p.goNextOp()},this.renderLineStyle=function(e,t){for(var n=p.textAndClassFunc;0<e.length;){if(p.leftInAuthor<=0)return void n(e,t,{},"",p.contextInfo);var r=e.length;r>p.leftInAuthor&&(r=p.leftInAuthor);var i=e.substring(0,r);e=e.substring(r),n(i,p.extraClass,p.curNextAttrObj,"",p.contextInfo,p.nextAttrObj),p.extraClass="",p.curIndex+=r,p.leftInAuthor-=r,0===p.leftInAuthor&&p.nextClasses()}n("","",{},"",p.contextInfo)}}var ni=(ri.prototype.put=function(e){var s=this,l=[];return e.forEach(function(e){var t=e.uniqueClass,n=e.mount,r=e.unmount,i=e.onReuse,o=e.fakeTextStyle,a=ri.globalComponentId++;s.pocketItems.push({id:a,mount:n,unmount:r,onReuse:i,host:null,aceLineClassType:t}),s.checkDuplicateClass(),s.updateLineClass("ace-line-pocket-custom-"+t,!0),s.updateFakeTextStyle(o),l.push(a)}),this.updatePocket(),delete this.oldLineNode,l},Object.defineProperty(ri.prototype,"root",{get:function(){return this.lineEntry.lineNode?this.lineEntry.lineNode.querySelector(".ace-line-pocket"):null},enumerable:!0,configurable:!0}),ri.prototype.getItemTypesOfLine=function(){return this.pocketItems.map(function(e){return e.aceLineClassType})},ri.prototype.checkDuplicateClass=function(){var e=new Set(this.pocketItems.map(function(e){return e.aceLineClassType})).size;this.pocketItems.length!==e&&this.editor&&this.editor.log("[Editor]: please don't use duplicate classes in pocket")},ri.prototype.unmountPocket=function(e){var t=e.host,n=e.unmount,r=e.aceLineClassType;this.root&&(r&&this.updateLineClass("ace-line-pocket-custom-"+r,!1),t&&(n&&n(t),this.root.contains&&this.root.contains(t)&&this.root.removeChild(t)))},ri.prototype.updateLineClass=function(e,t){var n=this;this.editor&&this.editor.getObserver().withoutRecordingMutations(function(){n.lineEntry.lineNode&&n.lineEntry.lineNode.classList.toggle(e,t)})},ri.prototype.updateFakeTextStyle=function(n){var r=this;n&&this.editor&&this.editor.getObserver().withoutRecordingMutations(function(){var e,t=".pocket-ignore[data-contentcollector-ignore-space-at]";!r.lineEntry.lineNode||(e=r.lineEntry.lineNode.querySelector(t))&&e.setAttribute("style",n)})},ri.globalComponentId=0,ri);function ri(e,t,n){var E=this;this.lineEntry=e,this.editor=t,this.oldLineNode=n,this.pocketItems=[],this.getPocket=function(e){return e&&e.pocket?e.pocket:null},this.clear=function(){for(;E.pocketItems.length;){var e=E.pocketItems.pop(),t=e.host,n=e.unmount,r=e.aceLineClassType;E.updateLineClass("ace-line-pocket-custom-"+r,!1),t&&(n&&n(t),E.root&&E.root.contains&&E.root.contains(t)&&E.root.removeChild(t))}E.root&&(E.root.innerHTML=""),E.pocketItems=[]},this.remove=function(t){var e=E.pocketItems.findIndex(function(e){return e.id===t});-1!==e&&(E.unmountPocket(E.pocketItems[e]),E.pocketItems.splice(e,1))},this.updatePocket=function(){var t,e,n,r,i,o,a,s;if(E.root&&E.pocketItems.length)if((null===(i=E.oldLineNode)||void 0===i?void 0:i.pocket)instanceof ri&&E.editor){var l=E.oldLineNode,c=E.lineEntry,u=E.editor,d=E.pocketItems,f=l.pocket.pocketItems.map(function(e){return e.aceLineClassType}),h=!1,p=function(t){var e,n;f.includes(t.aceLineClassType)&&-1<u.callAll("aceShouldPocketReuse",{type:t.aceLineClassType,oldLineNode:l,newLineEntry:c}).indexOf(!0)&&(e=l.pocket.pocketItems.findIndex(function(e){return e.aceLineClassType===t.aceLineClassType}),n=null===(o=l.pocket)||void 0===o?void 0:o.pocketItems[e],null!==(a=n)&&void 0!==a&&a.host&&(t.host=n.host,E.root.appendChild(n.host),null!==(s=l.pocket)&&void 0!==s&&s.pocketItems.splice(e,1),t.onReuse&&t.onReuse(c,l),h=!0)),h||E.addPocket(t),h=!1};try{for(var g=ge(d),v=g.next();!v.done;v=g.next())p(b=v.value)}catch(e){t={error:e}}finally{try{v&&!v.done&&(e=g.return)&&e.call(g)}finally{if(t)throw t.error}}}else try{for(var m=ge(E.pocketItems),y=m.next();!y.done;y=m.next()){var b=y.value;E.addPocket(b)}}catch(e){n={error:e}}finally{try{y&&!y.done&&(r=m.return)&&r.call(m)}finally{if(n)throw n.error}}},this.addPocket=function(e){var t,n;E.root&&(t=e.host,n=e.mount,t||(t=document.createElement("span"),e.host=t,E.root.appendChild(t)),n&&n(t),E.root.contains(t)||console.error("Editor: Pocket should contains host"))}}function ii(e){e&&e.forEach(function(e){var t=si(e);t&&t.clear()})}function oi(e){return 0<he()(e).has(".ace-line-pocket button").length}var ai=!0;function si(e){return e&&e.pocket?e.pocket:null}function li(e,t,n,r){var i=e.lineNode;if(i){var o=new ni(e,n,r);if(i.pocket=o,!oi(i))return t&&t.callAll("addPocketToLine",{editor:n,lineEntry:e,linePocket:o}),o}}function ci(e,t){return t.callAll("getPocketTypesOfLine",{lineEntry:e})}var ui=Object.freeze({__proto__:null,clearPocketFromNodes:ii,hasFeature:oi,isPocketEnabled:ai,getPocket:si,addPocketToLine:li,getPocketTypesOfLine:ci,default:ni});function di(e){return JSON.parse(JSON.stringify(e))}var fi,hi,pi,gi,vi,mi,yi,bi,Ei="j-block-container",ki="block-placeholder",Ci="block-autonomous-region",Ii="inline-block-placeholder",Si="block-v-text";(hi=fi=fi||{}).USER_NEWINFO="USER_NEWINFO",hi.USER_LEAVE="USER_LEAVE",hi.CLIENT_VARS="CLIENT_VARS",hi.ENGAGEMENT_CURSOR="ENGAGEMENT_CURSOR",hi.RESPONSE="RESPONSE",hi.ACCEPT_WATCH="ACCEPT_WATCH",hi.ACCEPT_COMMIT="ACCEPT_COMMIT",hi.REJECT_COMMIT="REJECT_COMMIT",hi.NEW_CHANGES="NEW_CHANGES",hi.USER_CHANGES="USER_CHANGES",hi.CHECK_READY="CHECK_READY",hi.SERVER_READY="SERVER_READY",hi.USER_COMMENT="USER_COMMENT",hi.NEW_COMMENT="NEW_COMMENT",hi.MESSAGE_CHANNEL="MESSAGE_CHANNEL",hi.ROOM_MEMBERS="ROOM_MEMBERS",hi.ERROR="ERROR",(gi=pi=pi||{}).ERR_REQUEST_FAIL="1",gi.ERR_INVALID_PARAM="2",gi.ERR_NOT_FOUND="3",gi.ERR_FORBIDDEN="4",gi.ERR_LOGIN_REQUIRE="5",gi.ERR_DATA_EXCEED_LIMIT="6",gi.ERR_OBJECT_DELETED="7",gi.ERR_NOT_IN_ROOM="8",gi.ERR_UNCHANGE="9",gi.ERR_CHANGESET_EXCEED_LIMIT="1001",gi.ERR_NOTE_DELETED="1002",gi.ERR_NOT_IN_SESSION="1003",gi.ERR_NOTE_NOT_EXISTS="1004",gi.ERR_CHAGESET_VALID_FAIL="1005",gi.ERR_500="1006",gi.ERR_MESSAGE_INVALID="1007",gi.ERR_SYNC_ALGO_FAIL="1008",gi.ERR_RCE_LIVE_SYNC="1009",gi.ERR_OLD_VERSION="1010",gi.ERR_USER_LIST_SYNC="1011",gi.ERR_NO_WRITE_PERMISSION="1012",gi.ERR_NO_COMMENT_PERMISSION="1013",gi.ERR_LOCK_FAILED="1015",gi.ERR_GET_EXACT_NOTE="2001",gi.ERROR_RECOVER="ERROR_RECOVER",(mi=vi=vi||{})[mi.SUCCESS=0]="SUCCESS",mi[mi.FAIL=1]="FAIL",mi[mi.VERSION_TOO_LOW=2]="VERSION_TOO_LOW",(bi=yi=yi||{}).REV_INIT="REV_INIT",bi.CLIENT_VARS="CLIENT_VARS",bi.DATA_TABLE="DATA_TABLE",bi.SPREAD_LOADED="SPREAD_LOADED",bi.SEND_USER_CHANGES="SEND_USER_CHANGES",bi.MONITOR_USER_CHANGES="MONITOR_USER_CHANGES",bi.NEW_CHANGES="NEW_CHANGES",bi.APPLY_ACTIONS="APPLY_ACTIONS",bi.APPLY_ACTIONS_LOCAL="APPLY_ACTIONS_LOCAL",bi.AFTER_APPLY_ACTIONS="AFTER_APPLY_ACTIONS",bi.FETCH_MISS_VERSIONS="FETCH_MISS_VERSIONS",bi.SYNC_BASE_REV="SYNC_BASE_REV",bi.ACCEPT_COMMIT="ACCEPT_COMMIT",bi.REJECT_COMMIT="REJECT_COMMIT",bi.LOCAL_CONFLICT="LOCAL_CONFLICT",bi.REFETCH_CLIENT_VARS="REFETCH_CLIENT_VARS",bi.CONFLICT_HANDLE="CONFLICT_HANDLE",bi.SUSPEND_ACTION="SUSPEND_ACTION",bi.RESUME_ACTION="RESUME_ACTION",bi.PRODUCE_ACTIONS="PRODUCE_ACTIONS",bi.ACTIVE_SHEET_CHANGE="ACTIVE_SHEET_CHANGE",bi.PRODUCE_RECOVER_ACTION="PRODUCE_RECOVER_ACTION",bi.SEND_RECOVER="SEND_RECOVER",bi.RECOVER_SUCCESS="RECOVER_SUCCESS",bi.RECOVER_ERROR="RECOVER_ERROR",bi.ACCEPT_RECOVER="ACCEPT_RECOVER",bi.RECEIVE_RECOVER="RECEIVE_RECOVER",bi.CONFIRM_RECOVER="CONFIRM_RECOVER",bi.RECOVER_SPREAD="RECOVER_SPREAD",bi.ERROR="ERROR",bi.OFFLINE_SAVE_ERROR="OFFLINE_SAVE_ERROR",bi.SYNC_STATUS="SYNC_STATUS",bi.CHANNEL_STATE_CHANGE="CHANNEL_STATE_CHANGE",bi.FREEZE_SPREAD="FREEZE_SPREAD",bi.EDIT_STATE_CHANGE="EDIT_STATE_CHANGE",bi.SEND_CURSOR="SEND_CURSOR",bi.SEND_COMMENT_CHANGE="SEND_COMMENT_CHANGE",bi.ACCEPT_COMMENT_CHANGE="ACCEPT_COMMENT_CHANGE",bi.MAX_WIDTH_CHANGE="MAX_WIDTH_CHANGE",bi.PASTE="PASTE",bi.SET_USERS="SET_USERS",bi.USER_NEWINFO="USER_NEWINFO",bi.USER_LEAVE="USER_LEAVE",bi.ENGAGEMENT_CURSOR="ENGAGEMENT_CURSOR",bi.CELL_COORD_CHANGE="CELL_COORD_CHANGE",bi.SPANS_CHANGE="SPANS_CHANGE",bi.SPREAD_APPEND="APPEND_SPREAD";var Ti,Oi,wi='<span data-fake-text="" contenteditable="false" suppressContentEditableWarning="true">&#8203;</span>';function Ri(e){var t=e.htmls;if(e.isPocketWithoutFakeText)return ur;var n=new DOMParser;if(!t)return""+ur+wi;var r=n.parseFromString(t.join(""),"text/html").body,i=r.firstElementChild?r.firstElementChild.getAttribute("style"):null;if(i){var o=n.parseFromString(wi,"text/html").querySelector("[data-fake-text]");if(o)return o.setAttribute("style",i),""+ur+o.outerHTML}return""+ur+wi}function Ai(t){var n=to(),r=!1,e=function(){if(r)return!0;var e=to()-n;return t<e&&(r=!0)},i=function(){return to()-n};return e.elapsed=i,e}function xi(e){return!!e&&0<he()(e).parents(".sheet:not(.sheet-pasting)").length}function Mi(t){var n={};return function(e){return n[e]||(n[e]=t(e)),n[e]}}function Ni(e,t){return e?t?e[0]===t[0]&&e[1]===t[1]:!e:!t}function _i(e){return 1===e.nodeType}function Li(e){return 3===e.nodeType}function Di(e,t,n){void 0===n&&(n=null);for(var r=e.parentElement;r&&r.matches;){if(r.matches(t))return r;if(r.parentElement===n)return;r=r.parentElement}return null}function Bi(e){return 8===e.nodeType}function Pi(e){return"svg"===e.tagName.toLowerCase()}function Fi(e){return"string"==typeof e}function ji(e){return e&&e.getAttribute&&"string"==typeof e.getAttribute("data-faketext")}function zi(e){return"author-"===e.substring(0,7)?e.substring(7).replace(/[a-y0-9]+|-|z.+?z/g,function(e){return"-"===e?".":"z"===e.charAt(0)?String.fromCharCode(Number(e.slice(1,-1))):e}):null}function Hi(e,t){return!e.contains||(t&&3===t.nodeType&&11===parseInt(Ce.version,10)&&(Ce.msie||Ce.modernIE)?t.parentNode&&e.contains(t.parentNode):e.contains(t))}function Ui(e){return Li(e)?e.nodeValue.length:1}function Vi(e){return!!Fn[(Object(W.default)(e,"tagName")||"").toLowerCase()]}function Wi(e,t){return e.className&&e.className.includes(Ei)&&t&&!t.className.includes(Ii)}function Ki(e){var t,n,r,i,o,a,s;if(Li(e))return e.textContent;if(Bi(e))return"";if(Pi(e))return"";if(e.className&&e.className.indexOf&&-1<e.className.indexOf("sheet-"))return" ";if(null!==(s=null===(o=e.classList)||void 0===o?void 0:(a=o).contains)&&void 0!==s&&s.call(a,"gallery"))return" ";if(e.className&&e.className.indexOf&&-1<e.className.indexOf("pocket-ignore")&&e.className.indexOf("ignore-dom"))return"";if(he()(e).parents("[data-new-gallery-text]").length)return he()(e).hasClass("image-container-wrap")?" ":"";if(he()(e).parent(".gallery").length)return"";var l=Zi(e);if(Fi(l))return l;if(e.className&&e.className.indexOf&&(-1<e.className.indexOf(Ei)||-1<e.className.indexOf(ki)||-1<e.className.indexOf(Ci)))return" ";if(Ce.msie){if(e.childNodes&&e.childNodes.length){var c="";try{for(var u=ge(Array.from(e.childNodes)),d=u.next();!d.done;d=u.next())c+=Ki(d.value)}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return c}return e.innerText}var f="";try{for(var h=ge(Array.from(e.childNodes)),p=h.next();!p.done;p=h.next())f+=Ki(p.value)}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}return f}function Zi(e){if(e&&e.getAttribute){var t=e.getAttribute("data-faketext"),n=e.textContent||e.innerText;if(!n&&""!==n)return null;var r=n.length,i=e.getAttribute("data-contentcollector-ignore-space-at"),o=e.className&&e.className.includes("inlineStyleHolder");return"end"===i&&o&&n.charCodeAt(0)!==qn?n:"start"===i&&r?n[r-1].charCodeAt()===qn?n.substr(0,n.length-1):n&&n.substr(1):"end"===i&&r?n[0].charCodeAt()===qn?n.substr(1):n&&n.substr(0,n.length-1):t}return null}function Gi(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n="";e=e||20;for(var r=0;r<e;r++){var i=Math.floor(Math.random()*t.length);n+=t.substring(i,i+1)}return n}function qi(e){return Gi(e||6)}function Ji(e){return!!Yn.exec(e)}function Yi(e){return!!Xn.exec(e)}function Qi(e){return!!Qn.exec(e)}function Xi(e){return!!jn[e]}function $i(e,t){for(var n=0;!t(n);)n+=e;return eo(n,t)}function eo(e,t){if(e<1)return 0;if(t(0))return 0;if(!t(e-1))return e;for(var n=0,r=e-1;1<r-n;){var i=Math.floor((n+r)/2);t(i)?r=i:n=i}return r}function to(){return(new Date).getTime()}function no(){return[]}function ro(){var e,t;try{e=document.selection}catch(e){}if(!e)return!1;try{t=e.createRange()}catch(e){}return!!t}function io(e,t){return null!=e.getAttribute?e.getAttribute(t):null!=e.attribs?e.attribs[t]:null}function oo(e){return e.tagName}function ao(e){return null==e.childNodes?0:e.childNodes.length}function so(e,t){return e[t]}function lo(e,t){return null==e.childNodes.item?e.childNodes[t]:e.childNodes.item(t)}function co(e){var t=e.nodeValue;if(ji(e.parentNode)){var n=e.parentNode.getAttribute("data-contentcollector-ignore-space-at");return"start"===n&&t.length?8203===t[t.length-1].charCodeAt()?t.substr(0,t.length-1):t.substr(1):"end"===n&&t.length?8203===t[0].charCodeAt()?t.substr(1):t.substr(0,e.nodeValue.length-1):t}return t}function uo(e){e.text=e.texts,delete e.texts}function fo(){if(null!=Ti)return Ti;var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var n=e.offsetWidth;t.style.overflow="scroll";var r=e.offsetWidth;return n===r&&(r=t.clientWidth),document.body.removeChild(t),Ti=n-r}function ho(e){var t,n,r;return Oi||(n=96,(t=document.createElement("span")).style.fontSize=n+"pt",t.style.display="none",document.body.appendChild(t),r=window.getComputedStyle(t).fontSize,Oi=r&&-1!==r.indexOf("px")?n/parseFloat(r):.75,document.body.removeChild(t)),Math.round(parseFloat(e)*Oi)+"pt"}var po=document.createElement("span"),go={};function vo(e){if(void 0===e&&(e=""),go[e])return di(go[e]);po.style.font=e;var t=po.style,n={fontFamily:t.fontFamily||"",fontSize:t.fontSize||"",fontStyle:t.fontStyle||"",fontVariant:t.fontVariant||"",fontWeight:t.fontWeight||"",lineHeight:t.lineHeight||""};return di(go[e]=n)}function mo(e){return-1!==["bold","600","700","800","900"].indexOf(e)}function yo(e,t){if(void 0===t&&(t={}),Object(g.default)(CustomEvent))return new CustomEvent(e,t);var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),n}function bo(e){var t=[];for(e=e&&e.parentElement;e;){var n=e.getAttribute("contenteditable");"true"!==n&&""!==n||(t.push(e),e.setAttribute("contenteditable","false")),e=e.parentElement}document.execCommand("selectAll");for(var r=0,i=t.length;r<i;r++)t[r].setAttribute("contenteditable","true")}function Eo(e,t){var n=window.getSelection(),r=n.focusNode,i=n.getRangeAt(0),o=("#text"===r.nodeName?i:r).getBoundingClientRect(),a=o.top,s=e.getBoundingClientRect(),l=a-s.top,c=l+o.height-s.height,u=e.scrollTop;r!==e&&(t?e.scrollTop=l<=u?l:u+c:0<=c&&(e.scrollTop=u+c))}function ko(e,t){var n=null;if(Ce.safari)try{n=e.getRangeAt(t)}catch(e){n=null}else e.getRangeAt&&(n=e.getRangeAt(t));return n||((n=document.createRange()).setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset)),n}function Co(e){var t,n,r,i;e.startContainer!==e.endContainer?(e.deleteContents(),e.collapsed&&0<e.startOffset&&(t=e.startContainer,n=e.startOffset,r=t.childNodes[n-1],i=t.childNodes[n],""===r.innerText&&t.removeChild(r),""===i.innerText&&t.removeChild(i))):e.deleteContents()}function Io(e){for(var t=e;t&&(!_i(t)||0===t.classList.length);)t=t.parentNode;if(!t||!_i(t))return"";for(var n=5,r=[];t&&"innerdocbody"!==t.id&&t.classList&&0<n;)r.push(Array.from(t.classList).join(" ")),t=t.parentNode,--n;return r.filter(function(e){return e}).reverse().join(" > ")}function So(e){return e.replace(/-\d+($| )/g,"$ ").replace(/-[\da-f]{8}-[\da-f]{4}-[\da-f]{4}-[\da-f]{4}-[\da-f]{12}($| )/g,"$ ").replace(/author-\d+/g,"author-id$").replace(/lineguid-[\da-zA-Z]+/g,"lineguid$").replace(/sheet-id-[\da-zA-Z]+/g,"sheet-id$")}function To(e,t,n){void 0===n&&(n=[]);var r,i,o=e;return o=t.enable&&o?(r={WHOLE_DOCUMENT:!!o.match(/<html[^>]*>/),RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1},i=Object.assign({},t.config,r),Q.a.sanitize(e,i)):me([{rule:/(<[^>]+\s+)on\w+=[^\s>/]+/gi,replacement:"$1"},{rule:/<(\/?script[^>]*)>/gi,replacement:"&lt;$1&gt;"},{rule:/(<[^>]+\s+(href|src|background)=["']?)javascript:([^\s>/]+)/gi,replacement:"$1$3"}],n).reduce(function(e,t){var n=t.rule,r=t.replacement;return e.replace(n,r)},o)}function Oo(e){return void 0!==e.setAttribute}var wo="adit-render-inactive";function Ro(e){var t=Array.from(e.childNodes);return 0<t.length&&t.every(function(e){return!(e instanceof HTMLElement)||!e.classList.contains(wo)})}function Ao(e){Array.from(e.childNodes).forEach(function(e){e instanceof HTMLElement&&e.classList.add(wo)})}function xo(e){Array.from(e.childNodes).forEach(function(e){e instanceof HTMLElement&&e.classList.remove(wo)})}function Mo(e){var t=e||getSelection().focusNode;if(!t)return null;var n=t.parentNode,r=t;return 3===t.nodeType&&n&&(r=n),ji(r)?r:null}function No(e){var t,n=e||getSelection().focusNode;if(!n)return null;var r=null===(t=null===n||void 0===n?void 0:n.parentNode)||void 0===t?void 0:t.nextSibling;return r&&ji(r)?r:null}function _o(e){for(var t=e;t;){var n=t.previousSibling,r=t.nextSibling,i=n&&io(n,hr),o=r&&io(r,hr);if(i&&o)return!0;t=t&&t.parentElement}return!1}function Lo(e,t,n){if(t)return io(e,pr)&&io(e,pr).length;var r=Mo(e)||e.firstChild&&Mo(e.firstChild);if(!r)return null;if(io(r,hr)){for(var i=r;i&&io(i,hr);)"RIGHT"===n?i=i.nextSibling:"LEFT"===n&&(i=i.previousSibling);return i&&io(i,pr)&&io(i,pr).length}return io(r,pr)&&io(r,pr).length}function Do(e){return e.firstChild&&Bo(e.firstChild)?e.childNodes[1]:e.firstChild}function Bo(e){return!!(e instanceof HTMLElement&&e.classList.contains("ace-line-pocket"))}function Po(e,t){if(!e)return null;for(var n=e,r=0;n!==t&&null!==n;){r+=n.offsetTop;var i=n.offsetParent;if(!(i instanceof HTMLElement))return console.error(i,"is not HTMLElement"),null;n=i}return r}var Fo=(jo.create=function(e){var t=e.nonEmpty,n=e.doesWrap,r=(e.optBrowser,e.optDocument),i=e.hooks,o=e.formatterRenderer,a=e.editor,s=new jo;return s.setDoc(r),s.initNode(),s.editor=a,s.setOptions({nonEmpty:t,doesWrap:n,lineAttributeMarker:ei.lineAttributeMarker,hooks:i,formatterRenderer:o}),s},jo.processSpaces=function(e,t){e.replace("&nbsp;"," ");var n=[];if(e.replace(/<[^>]*>?| |[^ <]+/g,function(e){return n.push(e),e}),t){for(var r=!0,i=0,o=0;o<n.length;o++)" "===n[o]?(i++,(r&&i%2==1||!r&&i%2==0)&&(n[o]="&nbsp;")):"<"!==n[o].charAt(0)&&(r=!1,i=0);for(o=n.length-1;0<=o;o--){if(" "===n[o]||"&nbsp;"===n[o]){n[o]="&nbsp;";break}if("<"!==n[o].charAt(0))break}}else for(var o=0,a=n.length;o<a;o++)" "===n[o]&&(n[o]="&nbsp;");return n.join("")},jo);function jo(){var L=this;this.setDoc=function(e){L.doc=e},this.setOptions=function(e){L.options&&(L.options=e)},this.initNode=function(){var e=L.doc;L.node=e?e.createElement("div"):{innerHTML:"",className:""}},this.getInnerHTML=function(){return L.curHtml||""},this.notifyAdded=p.default,this.appendSpan=function(e,t,n,r,i,o){void 0===i&&(i={});var a=L.preHtml,s=L.postHtml,l=i.inlineAttributesInEnter,c=i.currentLineIndex,u=i.isSplit,d=i.zoneId,f=L.lineClass,h=t;o=o||{};var p,g={preHtml:a,postHtml:s,spanClass:h,lineClass:f,processedMarker:!1,attrObj:n=n||{},index:c,zoneId:d},v=L.options,m=v.lineAttributeMarker,y=v.hooks,b=v.formatterRenderer;if(m&&0<=h.indexOf(m))return y&&y.callAll("aceDomLineProcessLineAttributes",g),b&&b.processLineAttributes(g),L.preHtml=g.preHtml,L.postHtml=g.postHtml,f=g.lineClass,h=g.spanClass,(g.processedMarker||b&&b.currentIsBlock()&&!b.currentIsEmbed())&&(L.lineClass=f),void(L.lineMarker+=e.length);e||Object(D.default)(l)||!y||(p={inlineAttributesInEnter:l,lineClass:L.lineClass,htmls:L.html},y.callAll("aceCreateLineWithStyle",p),delete i.inlineAttributesInEnter);var E,k,C,I,S,T,O,w,R,x,M,N,_={spanClass:h,lineClass:f,attributes:{},text:L.processPerTextNode(V.a.escapeHTML(e)),rawHtml:null,extraOpenTags:"",extraCloseTags:"",extraOpenHtml:"",extraCloseHtml:"",formatStyle:"",htmls:L.html,attrObj:n,nextAttrObj:o,collapseStatus:L.collapseStatus,index:c,isSplit:u,zoneId:d};L.zone=d,y&&y.callAll("aceCreateDomLine",_),b&&b.createFormatterDomLine(_),h=_.spanClass,_.lineClass!==L.lineClass&&(L.lineClass=_.lineClass),!1===_.editable&&(L.editable=!1),!e&&h||e&&(E=_.extraOpenTags,k=_.extraCloseTags,C=_.attributes,I=_.formatStyle,S=_.text,T=_.rawHtml,O=_.extraOpenHtml,w=_.extraCloseHtml,R=T||""+E+S+k,x=r&&r.length?" "+r:"",N=O+("<span op='true' "+(M=(M=q()(V.a.escapeHTMLAttribute(h||""),x))&&'class="'+M.replace(/"/g,"&quot;")+'"')+" "+(I&&'style="'+I.replace(/"/g,"&quot;")+'"')+" "+Object.keys(C).map(function(e){var t=C[e];return e=e.replace(/[^\w-]/g,""),/^on/i.test(e)?"invalid-key-onxxxx":e+"='"+String(t).replace(/'/g,"&#39;")+"'"}).join(" "))+">"+R+"</span>"+w,L.html.push(N))},this.clearSpans=function(){L.html=[],L.lineMarker=0,L.lineClass="",L.editable=!0},this.writeHTML=function(e){var t,n=L.options.hooks,r="<br/>",i={htmls:L.html,info:L,isPocket:!1,isPocketWithoutFakeText:!1,index:e},o="";n&&(n.callAll("acePreWriteDomLineHTML",i),i.isPocket&&i.htmls.unshift(Ri({htmls:i.htmls,isPocketWithoutFakeText:i.isPocketWithoutFakeText})));var a=L.html.join(""),o=i.isPocket?((t=document.createElement("div")).innerHTML=a,Array.from(t.children).every(function(e){return e.classList.contains("pocket-ignore")})?a+r:a):a||r,s=L.processPerHtmlLine(o),l=L.preHtml,c=L.postHtml;L.options.nonEmpty&&(s=(l||"")+s+(c||"")),L.html=[],L.preHtml="",L.postHtml="",s!==L.curHtml&&(L.curHtml=s,L.node.innerHTML=L.curHtml),null!==L.lineClass&&(L.node.className=L.lineClass),Oo(L.node)?L.node.setAttribute("dir",L.dir):L.node.dir=L.dir,L.editable||(Oo(L.node)?L.node.setAttribute("contenteditable","false"):L.node.editable=!1),n&&n.callAll("acePostWriteDomLineHTML",{node:L.node})},this.processPerHtmlLine=function(e){var t=L.options.doesWrap;return t?jo.processSpaces(e,t):e},this.processPerTextNode=function(e){var t=L.options.doesWrap;return t?e:jo.processSpaces(e,t)},this.processBeforeInsertNode=function(e,t,n){var r=n.currentLineIndex;L.editor&&L.editor.hook.callAll("processBeforeInsertNode",{entry:e,cls:t,currentLineIndex:r})},this.processAfterInsertNode=function(e,t,n){var r=n.currentLineIndex;L.editor&&L.editor.hook.callAll("processAfterInsertNode",{entry:e,cls:t,index:r})},this.createDomLine=function(e){var t=e.nonEmpty,n=e.doesWrap,r=e.optBrowser,i=e.optDocument,o=e.hooks,a=e.formatterRenderer;return jo.create({nonEmpty:t,doesWrap:n,optBrowser:r,optDocument:i,hooks:o,formatterRenderer:a})},this.getSpansForLine=function(e,t,a,n){var r,i,o="",s=t.text;0<s.length&&(i=void 0===n.currentLineIndex?e.lines.indexOfEntry(t):n.currentLineIndex,o=e.alines[i]);var l=function(e,t,n,r,i,o){return a(e,t,n,r,i,o)};ei.createRender({lineText:s,aline:o,apool:e.apool,textAndClassFunc:l,browser:Ce,hooks:L.editor.hooks,formatterRenderer:L.editor.formatterManager,contextInfo:n,collapseStatus:null===(r=t.domInfo)||void 0===r?void 0:r.collapseStatus})(s,"",{},"",n)},this.isCollapsedHeading=function(){return L.collapseStatus.collapseOnlyMe||L.collapseStatus.collapseAll&&!1!==L.collapseStatus.collapseOnlyMe},this.decorateMagicObjects=function(e,t){var n=e.lineNode,r=Array.from(n.querySelectorAll(".ace-line-pocket")).filter(function(e){return Di(e,".ace-line")===n});r.length&&0===r[0].children.length&&li(e,L.editor.hooks,L.editor,t)},this.removePocketHtml=function(e){var t,n,r,i=3;e.nodeType!==i&&(n=e.className.split(" ").filter(function(e){return e.includes("ace-line-pocket-custom-")}),(t=e.classList).remove.apply(t,me(n)),(r=e.querySelector(".ace-line-pocket"))&&(r.innerHTML=""))},this.insertDomLines=function(f,h,e,t,p,g){var v,m=L.getSpansForLine,y=L.processBeforeInsertNode,b=L.processAfterInsertNode,E=L.editor,k=E.repManager.getRep(f),C=E.dom.rootNodeOfZone(f),I=E.changesetHelper;if(!(e.length<1)){var S=[],T=1===(null===p||void 0===p?void 0:p.length)&&1===e.length,O=!1;return(e.forEach(function(a,e){var t,n,r=a.node,i=E.editorBase.uniqueId(r),o=k.lines.indexOfKey(i),s=I.getInlineAttributesInEnter(E.getApool(),k.alines[o]),l="";!v||(n=k.lines.next(v))&&n.key===i&&(t=n),t=t||k.lines.atKey(i);var c,u,d={currentLineIndex:o,inlineAttributesInEnter:s,zoneId:f};m(k,v=t,function(e,t,n,r,i,o){a.appendSpan(e,t,n,r,i,o),l+=" "+t},d),a.prepareForAdd(o),L.editor.handleOldRenderLine({alines:k.alines[o],apool:E.getApool(),hooks:L.options.hooks,zoneId:f,lineNum:o,node:r}),t.lineMarker=a.lineMarker,y(t,l,d),!T||(c=p[0].cloneNode(!0))instanceof HTMLElement&&(c.id=r.id,""===c.style.cssText&&c.removeAttribute("style"),L.removePocketHtml(c),c.outerHTML===r.outerHTML&&(O=!0)),O?((u=p[e]).id=t.key,t.lineNode=u,t.domInfo.node=u,E.dirtyChecker.markNodeClean(u,t)):(g||(h?C.insertBefore(r,h.nextSibling):C.insertBefore(r,C.firstChild)),b(t,l,d),h=r,a.notifyAdded(),E.dirtyChecker.markNodeClean(r,t),S.push(r))}),O)?S:(Object(B.a)(e,function(e,t){var n=e.node,r=E.editorBase.uniqueId(n),i=k.lines.atKey(r),o=p&&p[t];i&&L.decorateMagicObjects(i,o),o&&ii([o])}),S)}},this.lineClass="ace-line",this.lineMarker=0,this.preHtml="",this.postHtml="",this.curHtml=null,this.html=[],this.prepareForAdd=this.writeHTML,this.finishUpdate=this.writeHTML,this.options={},this.editable=!0,this.dir="auto",this.collapseStatus={collapseAll:!1,collapseOnlyMe:""}}var zo="magicdomid-",Ho=(Uo.prototype.renderToDomLine=function(e,t,n,r){for(var i=e.slice(0,-1).split("\n"),o=[],a=0,s=i.length;a<s;a++){var l={text:i[a],attribs:t[a]},c=n.editor?n.editor.changesetHelper.getInlineAttributesInEnter(n,l.attribs):[];o.push(this.renderDomLine(l,n,{currentLineIndex:a,inlineAttributesInEnter:c,zoneId:r}))}return o},Uo.prototype.renderToString=function(e){for(var t=e,n=[],r=0,i=t.length;r<i;r++){var o=t[r].node,a=o.className,s=o.innerHTML,l=o.id,c=o.dir,u=!1===t[r].node.editable?' contenteditable="false" '+(Ce.isEdge?'tabindex="-1"':""):"",d="<div id='"+l+"' class=\""+Object(U.escapeHTML)(a)+'"'+u+" dir='"+c+"'>"+s+"</div>";n.push(d)}return n.join("")},Uo.prototype.renderToFragment=function(e){for(var t=e,n=document.createDocumentFragment(),r=0,i=t.length;r<i;r++){var o=t[r].node,a=o.className,s=o.innerHTML,l=o.id,c=o.editable,u=document.createElement("div");l&&(u.id=l),u.className=a,u.innerHTML=s,!1===c&&u.setAttribute("contenteditable","false"),n.appendChild(u)}return n},Uo.prototype.renderDomLine=function(e,t,o,n){var r,i=e.text,a=e.attribs,s=this.props,l=s.hook,c=s.formatterRenderer,u=this.domLine.createDomLine({nonEmpty:!0,doesWrap:!0,optBrowser:null,optDocument:null,hooks:l,formatterRenderer:c}),d=t.editor?t.editor.changesetHelper.getInlineAttributesInEnter(t,a):[];o.inlineAttributesInEnter=d;var f=function(e,t,n,r,i){return u.appendSpan(e,t,n,r,Object.assign({},o,i))};ei.createRender({lineText:i,aline:a,apool:t,textAndClassFunc:f,browser:Ce,hooks:l,formatterRenderer:c,collapseStatus:u.collapseStatus,contextInfo:o})(i,"",{},"",o),u.prepareForAdd(o.currentLineIndex);var h=u.node,p=o.zoneId,g=void 0===p?"0":p,v=o.currentLineIndex;return null!==(r=t.editor)&&void 0!==r&&r.handleOldRenderLine({alines:a,apool:t,hooks:l,zoneId:g,lineNum:v,node:h}),h.id=n||this.uniqueId(h),u},Uo);function Uo(e){var n=this;this.props=e,this.nextId=1,this.uniqueId=function(e){var t=e.id;return t||(e.id=n.lineIdPre+n.nextId++)};var t=e.domLine,r=e.formatterRenderer,i=e.magicId;this.lineIdPre=zo+(i||1)+"_",this.domLine=t||Fo.create({nonEmpty:!0,doesWrap:!0,optBrowser:Ce,optDocument:document,formatterRenderer:r})}var Vo=(Wo.ROOT_ZONE="0",Wo.equals=function(e,t){return e===t||e&&t&&e.zone===t.zone&&e.line===t.line&&e.col===t.col},Wo.greaterOrEqual=function(e,t){return e.zone!==t.zone||e.line>t.line||e.line===t.line&&e.col>=t.col},Wo.endOfZone=function(e,t){var n=e.getRepManager().getRep(t),r=n.alines,i=n.alinesWidth,o=r.length-1;return new Wo(t,o,i[o]-1)},Wo.endOfLine=function(e,t){var n=e.getRepManager().getRep(t.zone).alinesWidth[t.line]-1;return new Wo(t.zone,t.line,n)},Wo.next=function(e,t){var n=e.getRepManager().getRep(t.zone),r=n.alinesWidth[t.line];return t.col<r-1?t.withCol(t.col+1):t.line<n.alines.length-1?t.withLine(t.line+1).withCol(0):t},Wo.previous=function(e,t){var n=e.getRepManager().getRep(t.zone);return 0!==t.col?t.withCol(t.col-1):0<=t.line?t.withLine(t.line-1).withCol(n.alinesWidth[t.line-1]-1):t},Wo.isValid=function(e,t){var n=e.getRepManager().getRep(t.zone);return n&&0<=t.line&&t.line<n.lines.length()&&0<=t.col&&t.col<n.alinesWidth[t.line]},Wo);function Wo(e,t,n){var i=this;this.clone=function(){return new Wo(i.zone,i.line,i.col)},this.translate=function(e){var t=Object.assign({line:0,col:0},e);return new Wo(i.zone,Math.max(0,i.line+t.line),Math.max(i.col+t.col,0))},this.flatten=function(e){var t=e.getReps()[i.zone].alinesWidth,n=Math.min(i.line,t.length),r=Math.min(i.col,t[n]);return t.slice(0,i.line).reduce(function(e,t){return e+t},0)+r},this.set=function(e){var t=Object.assign({},i.toJSON(),e);return new Wo(t.zone,t.line,t.col)},this.withZone=function(e){return new Wo(e,i.line,i.col)},this.withLine=function(e){return new Wo(i.zone,e,i.col)},this.withCol=function(e){return new Wo(i.zone,i.line,e)},this.toJSON=function(){return{zone:i.zone,line:i.line,col:i.col}},this.toString=function(){return"Position("+i.zone+", "+i.line+", "+i.col+")"},this.col=n,this.line=t,this.zone=e}var Ko=(Object.defineProperty(Zo.prototype,"zone",{get:function(){return this.start.zone},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.prototype,"startLine",{get:function(){return this.start.line},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.prototype,"endLine",{get:function(){return this.end.line},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.prototype,"endCol",{get:function(){return this.end.col},enumerable:!0,configurable:!0}),Object.defineProperty(Zo.prototype,"isCollapsed",{get:function(){return Vo.equals(this.start,this.end)},enumerable:!0,configurable:!0}),Zo.from=function(e,t){return e.start instanceof Vo?new Zo({start:e.start,end:t}):new Zo({start:e,end:t})},Zo);function Zo(e){var t=this;this.toString=function(){return"Range(start: "+t.start+", end: "+t.end+")"};var n=Object(h.a)([e.start,e.end||e.start],["line","col"]);this.start=n[0],this.end=n[1]}var Go,qo=(ce(Jo,Go=Ko),Object.defineProperty(Jo.prototype,"anchor",{get:function(){return this.isReversed?this.end:this.start},enumerable:!0,configurable:!0}),Object.defineProperty(Jo.prototype,"focus",{get:function(){return this.isReversed?this.start:this.end},enumerable:!0,configurable:!0}),Object.defineProperty(Jo.prototype,"anchorLine",{get:function(){return this.anchor.line},enumerable:!0,configurable:!0}),Object.defineProperty(Jo.prototype,"anchorCol",{get:function(){return this.anchor.col},enumerable:!0,configurable:!0}),Object.defineProperty(Jo.prototype,"focusLine",{get:function(){return this.focus.line},enumerable:!0,configurable:!0}),Object.defineProperty(Jo.prototype,"focusCol",{get:function(){return this.focus.col},enumerable:!0,configurable:!0}),Jo.from=function(e,t){return new Jo(null===e?null:e instanceof Vo?{start:e}:e.start&&t?{start:e.start,end:e.end,isReversed:t.isReversed}:e)},Jo);function Jo(e){var t=Go.call(this,e)||this;t.toString=function(){return t.hasSelection?"SelectionRange(start: "+t.start+", end: "+t.end+", isReversed: "+t.isReversed+")":"SelectionRange(null)"};var n=new Ko(e||{start:null,end:null});return t.isReversed=!(n.isCollapsed||!e||!e.isReversed),t.hasSelection=!!e,t}function Yo(e,t){return Vo.equals(e,t)?new qo({start:t,end:t}):Vo.greaterOrEqual(t,e)?new qo({start:e,end:t}):new qo({start:t,end:e,isReversed:!0})}function Qo(e,t){var n=new Vo(t,0,0),r=Vo.endOfZone(e,t);return new Ko({start:n,end:r})}function Xo(e,t){var n=e instanceof qo?e:new qo(e),r=t instanceof qo?t:new qo(t);return e===t||n.hasSelection===r.hasSelection&&n.isReversed===r.isReversed&&Vo.equals(n.start,r.start)&&Vo.equals(n.end,r.end)}function $o(e){for(var t=e.parentElement,n=[],r=document.scrollingElement||document.documentElement,i=t;i&&i!==r;)(i.offsetHeight<i.scrollHeight||i.offsetWidth<i.scrollWidth)&&n.push([i,i.scrollTop,i.scrollLeft]),i=i.parentElement;return n.push([r,r.scrollTop,r.scrollLeft]),n}function ea(e){for(var t=0;t<e.length;t++)e[t][0].scrollTop=e[t][1],e[t][0].scrollLeft=e[t][2];e=[]}function ta(e){var t=$o(e);e.focus({preventScroll:!0}),ea(t)}var na="heading|blockquote|text-indent|align|template-block|template-placeholder|template-wrap|template-abstract|diy-icon",ra=(ia.prototype.destroy=function(){},ia.prototype._childIndex=function(e){for(var t=0,n=e;n&&n.previousSibling;)t++,n=n.previousSibling;return t},ia.prototype.hasIESelection=function(){var e,t,n=document;try{e=n.selection}catch(e){}if(!e)return!1;try{t=e.createRange()}catch(e){}return!!t},ia.prototype.getPointForCharAtLineEntry=function(e,t){(t-=e.lineMarker)<0&&(t=0);var n=e.lineNode;if(0===t)return{node:n,index:0,maxIndex:1};var r=this.getPointForCharAtNode(n,t);return r||{node:n,index:1,maxIndex:1}},ia.prototype.triggerSelectionChanged=function(e){this.editor.hooks.callAll("aceSelectionChanged",e);var t=this.editor.eventEmitter;t&&"function"==typeof t.trigger&&t.trigger("aceSelectionChanged",[e])},ia.prototype.isInlineBlock=function(e){return e&&e.className&&e.className.includes&&e.className.includes("j-block-container")},ia.prototype.getPointForChatAtLeafNode=function(e,t,n){void 0===n&&(n=!1);var r=e.lineNode;if(he()(r).hasClass("single-line"))return{node:Do(r),index:Math.min(t,1),maxIndex:1};var i=this.getPointForCharAtLineEntry(e,t),o=i.node,a=o,s=e.lineMarker;if(Bo(i.node.firstChild)&&1<=i.maxIndex&&(i.index=1),ji(i.node)&&!n&&0<(i.node&&i.node.getAttribute&&i.node.getAttribute("data-faketext").length)&&(1===i.index?(o=i.node.previousSibling||i.node.parentNode,i.index=1,i.maxIndex=1):i.index===i.maxIndex-1&&(i.index=1)),s&&0===i.index){for(;3!==a.nodeType&&null!==Do(a);)a=Do(a);null!=Do(a)&&(o=a)}return i.node=o,i},ia.prototype.getRangeNodeOffset=function(e,t){var n,r,i=e;try{for(var o=ge(Array.from(t)),a=o.next();!a.done;a=o.next()){var s=a.value,l=s.innerText&&s.innerText.length||s.length||0;if(!(s&&s.className&&(-1<s.className.indexOf("pocket-ignore")||-1<s.className.indexOf("j-block-container")))){if(s&&s.className&&-1<s.className.indexOf("image-"))return{index:i,node:s};if("BR"===s.tagName)return{index:0,node:s};if(i<=l)return s.childNodes.length?this.getRangeNodeOffset(i,s.childNodes):{index:i,node:s};if(l<i)if(l)i-=l;else if(s.childNodes)return this.getRangeNodeOffset(i,s.childNodes)}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return null},ia);function ia(e,t,n){var R=this;this.blockRegex=new RegExp(na),this.currentSelection={},this._pointToRangeBound=function(e,t,n){var r=R._copyPoint(e);if(n){if(Li(r.node)&&r.index===r.maxIndex&&!Ce.isIOS){for(var i=r.node;!i.nextSibling&&i!==t&&i.parentNode!==t;)i=i.parentNode;!i.nextSibling||"string"==typeof i.nextSibling.tagName&&"br"===i.nextSibling.tagName.toLowerCase()||i===r.node||i===t||i.parentNode===t||(r.node=i.nextSibling,r.maxIndex=Ui(r.node),r.index=0,r=R._diveDeep(r))}Li(r.node)||(r=R._diveDeep(r))}return Li(r.node)?{container:r.node,offset:r.index}:{container:r.node.parentNode,offset:R._childIndex(r.node)+r.index}},this._diveDeep=function(e){for(var t=R._copyPoint(e);0<t.node.childNodes.length;)if(0===t.index)t.node=Do(t.node),t.maxIndex=Ui(t.node);else{if(t.index!==t.maxIndex)break;t.node=t.node.lastChild,t.maxIndex=Ui(t.node),t.index=t.maxIndex}return t},this._copyPoint=function(e){return{node:e.node,index:e.index,maxIndex:e.maxIndex}},this._pointFromRangeBound=function(e,t){var n=R.editor.getInnerContainer();if(!Hi(document.body,e))return{node:n,index:0,maxIndex:1};var r,i,o=e,a=o.childNodes.length,s=Di(o,"[data-faketext]",n);if(s&&s.className&&-1<s.className.indexOf("ace-table")&&(s=null),Ce.isEdge&&!s&&o!==n&&(s=o.querySelector&&o.querySelector("[data-faketext]")),s){var l=Zi(s).length;return{node:s,index:0===t?t:l,maxIndex:l}}return Li(o)?{node:o,index:t,maxIndex:o.nodeValue.length}:0===a?{node:o,index:0,maxIndex:1}:t!==a?{node:r=o.childNodes.item(t),index:0,maxIndex:i=Ui(r)}:{node:r=o.childNodes.item(a-1),index:i=Ui(r),maxIndex:i}},this.getSelection=function(){return R.internalGetSelectionPoints()},this.setSelection=function(e,t){var n,r=R.editor.getInnerContainer(),i=document;if(L.a.msie){var o,a,s=function(e,t){for(var n=Do(t);n&&!Li(n);)t=n;e.moveToElementText(t)},l=function(){return i.body.createTextRange()},c=function e(t,n){Li(n)?n.previousSibling&&!Li(n.previousSibling)?u(t,n.previousSibling):e(t,n.parentNode):(s(t,n),t.move("character",1)&&t.move("character",-1),t.collapse(!0))},u=function(e,t){Li(t)?(c(e,t),e.move("character",t.nodeValue.length)):(s(e,t),e.collapse(!1))},d=function(e){var t=l(),n=e.node;return Li(n)?(c(t,n),t.move("character",e.index)):(0===e.index?c:u)(t,n),t};if(e)R.hasIESelection()&&(o=R._copyPoint(e.startPoint),(a=R._copyPoint(e.endPoint)).index===a.maxIndex&&a.node.nextSibling&&(a.node=a.node.nextSibling,a.index=0,a.maxIndex=Ui(a.node)),(g=d(o)).setEndPoint("EndToEnd",d(a)),function(e){var t;try{t=i.selection}catch(e){}if(!t)return!1;var n=t.createRange();return n.parentElement().ownerDocument===i&&(0===e.compareEndPoints("StartToStart",n)&&0===e.compareEndPoints("EndToEnd",n))}(g)||g.select());else try{i.selection.empty()}catch(e){R.editor.log(e)}}else{var f,h,p,g,v=window.getSelection();v&&e&&(r.contains(v.anchorNode)||t)&&(n=e.startPoint.node===e.endPoint.node&&e.startPoint.index===e.endPoint.index,f=R._pointToRangeBound(e.startPoint,r,n),h=R._pointToRangeBound(e.endPoint,r,n),!n&&e.focusAtStart&&v.collapse&&v.extend?(v.removeAllRanges(),v.collapse(h.container,h.offset),v.extend(f.container,f.offset)):(p=v.rangeCount&&ko(v,0))&&p.startContainer===f.container&&p.endContainer===h.container&&p.startOffset===f.offset&&p.endOffset===h.offset||((g=document.createRange()).setStart(f.container,f.offset),g.setEnd(h.container,h.offset),v.removeAllRanges(),v.addRange(g)))}},this.hasSelectionCovered=function(e,t){var n=e.selStart[0]<t.selStart[0],r=e.selStart[0]===t.selStart[0],i=(n||r)&&e.selStart[1]<=t.selStart[1],o=e.selEnd[0]>t.selEnd[0],a=e.selEnd[0]===t.selEnd[0],s=(o||a)&&e.selEnd[1]>=t.selEnd[1];return i&&s},this.isBeforeSelection=function(e,t){return e.selEnd[0]>t.selEnd[0]||e.selEnd[0]===t.selEnd[0]&&e.selEnd[1]>=t.selEnd[1]},this.isAfterSelection=function(e,t){return e.selStart[0]>t.selStart[0]||e.selStart[0]===t.selStart[0]&&e.selStart[1]<=t.selStart[1]},this.isSelectionOnTitle=function(){var e=R.editor.getRep();if(!e||!e.selEnd||!e.selStart)return!1;var t=e.lines.atIndex(e.selEnd[0]),n=e.selStart,r=e.selEnd;return 0===n[0]&&(0===r[0]||1===r[0])&&r[1]<=t.lineMarker},this.isMergeable=function(e,t){var n=e.selEnd,r=e.selZone,i=t.selStart,o=t.selZone;return!(!r||!o||r!==o)&&R.flatten(me(n,[r]))===R.flatten(me(i,[o]))},this.merge=function(e,t){return!!R.isMergeable(e,t)&&{selStart:e.selStart,selEnd:t.selEnd,selZone:t.selZone}},this.flatten=function(e){var t=ve(e,3),n=t[0],r=t[1],i=t[2],o=R.editor.getReps()[i].alinesWidth,a=Math.min(n,o.length),s=Math.min(r,o[a]);return o.slice(0,a).reduce(function(e,t){return e+t},0)+s},this.getPointForLineAndChar=function(e){var t=R.editor,n=R.getPointForCharAtLineEntry,r=t.getRep(),i=e[0],o=e[1];return n(r.lines.atIndex(i),o)},this.getPointForCharAtNode=function(e,t,n){void 0===n&&(n=!1);for(var r=e,i=!1;r!=e||!i;)if(i)r.nextSibling?(r=r.nextSibling,i=!1):r=r.parentNode;else{var o=ji(r);if(Li(r)||o&&!n){var a=Zi(r),s=Fi(a),l=(s?a:r.nodeValue).length,c=s&&0<l,u=ji(r)&&r.getAttribute&&"start"===r.getAttribute("data-contentcollector-ignore-space-at"),d=t===l&&c;if(t===l&&!o){var f=r.parentNode;"span"!==f.tagName.toLocaleLowerCase()&&(f=f.parentNode);var h=f.nextSibling;if(h&&h.getAttribute&&"start"===h.getAttribute("data-contentcollector-ignore-space-at"))return{node:h,index:1,maxIndex:1}}if(t<=l&&u)return{node:r,index:1,maxIndex:1};if(t<=l&&!d)return{node:r,index:t,maxIndex:l};t-=l,i=!0}else{var p=Do(r);p?r=p:i=!0}}return null},this.getRealPointAtFakeText=function(e){if(!Li(e.node)&&e.node.getAttribute&&e.node.getAttribute("data-faketext")){var t=R.getPointForCharAtNode(e.node,e.index,!0);if(t)return t}return e},this.updateBrowserSelectionFromRep=function(e){return R.internalUpdateSelectionFromRep(e)},this.repSelectionChange=function(e,t,n,r,i){void 0===e&&(e="0");var o=R.currentSelection.selFocusAtStart,a=R.editor,s=R._getSelectionAfterCheckAtext,l=R.updateBrowserSelectionFromRep,c=a.getRep(e),u=(r=!!r)&&(!t||!n||t[0]!==n[0]||t[1]!==n[1]);if(!i&&Ni(c.selStart,t)&&Ni(c.selEnd,n)&&o===u)return!1;var d=a.callPluginCheckSelection(e,t,n,u),f=d.selStart,h=d.selEnd;if(i&&a.isShouldFixSelection()){var p=s(e,{selStart:f,selEnd:h});if(Ni(c.selStart,p.selStart)&&Ni(c.selEnd,p.selEnd))return!1;var g=new Vo(e,p.selStart[0],p.selStart[1]),v=new Vo(e,p.selEnd[0],p.selEnd[1]),m=new qo({start:g,end:v,isReversed:!1});R.set(m),Ni(p.selStart,f)&&Ni(p.selEnd,h)||l(!1)}else f&&h&&(g=new Vo(e,f[0],f[1]),v=new Vo(e,h[0],h[1]),m=new qo({start:g,end:v,isReversed:!1}),R.set(m));var y=a.callStack.getCurrentStack();return y.repChanged=!0,R.triggerSelectionChanged({rep:c,callstack:y,editorInfo:a,documentAttributeManager:c.attributeManager,attribs:a.getAttributesOnSelection(c.zoneId,R.getRealSelection(c.zoneId,c))}),!0},this.updateCurrentSelection=function(e){var t,n,r,i=e.start,o=e.end,a=R.editor.getReps(),s=e.isReversed&&(!i||!o||!Vo.equals(i,o)),l=R.fixInvalidSelections(i,o),i=l.selectStart;if(o=l.selectEnd,i.zone!==o.zone)if(0===o.line&&0===o.line)var c=a[i.zone],u=c.lines.length(),d=c.lines.atIndex(u-1),o=new Vo(i.zone,u-1,d.text.length);else{for(var f=0,h=R.internalPositionAncestry(i),p=R.internalPositionAncestry(o);f<h.length&&f<p.length&&h[h.length-1-f].zone===p[p.length-1-f].zone;)f++;f--;var g=h[h.length-1-f],v=p[p.length-1-f];o=Vo.greaterOrEqual(v,g)?(i=g,f===p.length-1?v:v.withCol(1)):(i=v,f===h.length-1?g:g.withCol(1))}var m,y=R.editor.callPluginCheckSelection(i.zone,[i.line,i.col],[o.line,o.col],s),b=y.selFocusAtStart,E=R._getSelectionAfterCheckAtext(i.zone,{selStart:y.selStart,selEnd:y.selEnd}),k=E.selStart,C=E.selEnd,I=new Vo(i.zone,k[0],k[1]),S=new Vo(o.zone,C[0],C[1]);if(Xo(R.currentSelection,{start:I,end:S,isReversed:s}))return!1;if(I.zone!==S.zone)throw new Error("zone mismatch");Vo.greaterOrEqual(S,I)||S.line!==I.line||1!==I.col||(m=a[I.zone].lines.atIndex(I.line),R.editor.log("reset selEnd.col to 0, origin "+S),m&&m.domInfo&&R.editor.log("affected line's lineManagerType:",m.domInfo.lineManagerType,"class:",So(Io(m.domInfo.node))),S=new Vo(S.zone,S.line,0),Ue(new Error("oops debug: reset selEnd.col for end < start on same line")));var T=!1;Vo.greaterOrEqual(S,I)||(R.editor.log("error selection: "+I+", "+S),R.editor.log("original selection: "+e.start+", "+e.end),R.editor.log("editable: ",R.editor.isEditable()),R.logCurrentSelection(),I=(t=ve([S,I],2))[0],S=t[1],k=(n=ve([C,k],2))[0],C=n[1],T=!0,Ue("invalid selection(end < start) fixed"));var O=!R.currentSelection.start||R.currentSelection.start.zone!==i.zone;O&&R.currentSelection.start&&(r=R.editor.innerZoneEditorNodes[R.currentSelection.start.zone])&&r.updateIsFocusedInRep(!1),R.currentSelection=new qo({start:I,end:S,isReversed:b}),R.editor.managers.changeSelectionOnLineManagersInRange(I,S),R.editor.callStack.getCurrentStack().repChanged=!0,O&&(r=R.editor.innerZoneEditorNodes[R.currentSelection.start.zone])&&r.updateIsFocusedInRep(!0),R.updateRepSelection();var w=R.editor.getReps()[R.currentSelection.zone];return R.triggerSelectionChanged({rep:w,callstack:R.editor.callStack.getCurrentStack(),editorInfo:R.editor,documentAttributeManager:w.attributeManager,attribs:R.editor.getAttributesOnSelection(w.zoneId,R.editor.isSelectingAll?w:R.getRealSelection(w.zoneId,w))}),Ni(k,[i.line,i.col])&&Ni(C,[o.line,o.col])&&!R.editor.isSelectingAll||R.updateBrowserSelectionFromRep(T),!0},this.isCaret=function(e){var t=R.editor.getRep(),n=e||t;return n.selStart&&n.selEnd&&n.selStart[0]===n.selEnd[0]&&n.selStart[1]===n.selEnd[1]},this.getLineAndCharForPoint=function(e){var t=R.editor;if(!t.dom)return null;var n=t.dom.rootNodeOfZoneContaining(e.node);if(!n)return null;var r=t.dom.zoneOfRootNode(n);if(!r)return null;var i=t.getRep(r);if(!i)return null;if(e.node===n){if(0===e.index)return[0,0];var o=i.lines.length();return[o-1,i.lines.atIndex(o-1).text.length]}var a=e.node;a||console.warn("point.node is null, point is",e);var s=0;Li(a)?s=e.index:0<e.index&&(s=Ki(a).length);for(var l,c=a.parentNode;a.root!==n&&c!==n;)a.parentNode||console.warn("point node is null",e),a.previousSibling?s+=Ki(a=a.previousSibling).length:Fi(l=ji(a=c)&&Zi(c))&&(s=0<s?l.length:0),c=a.parentNode;""===a.id&&console.debug("BAD");var u=i.lines.atKey(a.id),d=Do(a);return(d&&t.isBlockElement(d)||R.blockRegex.test(a.className)||Wi(a,d)||R.isInlineBlock(e.node))&&(s+=u.lineMarker),u?[i.lines.indexOfEntry(u),s,r]:null},this._getSelectionAfterCheckAtext=function(e,t){var n=R.getRealSelection,r=R.editor,i=r.getReps()[e],o=Ce.isMobile||r.isSelectingAll?t:n(e,t),a=i.lines.atIndex(o.selStart[0]),s=o.selStart[0]===o.selEnd[0]?a:i.lines.atIndex(o.selEnd[0]),l=a.text.length,c=s.text.length;return o.selStart[1]=Math.min(o.selStart[1],l),o.selEnd[1]=Math.min(o.selEnd[1],c),o},this.lineAndColumnFromChar=function(e,t){var n=R.editor.getReps()[e];if(!n)return[0,0];for(var r=n.alinesWidth,i=0,o=0,a=0,s=0,l=r.length;s<l;s++){var c=i+r[s];if(i<=t&&t<c)return[o=s,a=t-i];i=c}return[o,a]},this.getRealSelection=function(e,t){var n=R.getRealEndLine,r=R.getRealFirstLine,i=R.editor.getReps()[e],o=t||i;if(!o.selStart||!o.selEnd)return o;var a,s,l,c,u,d=n(e,o),f=r(e,o),h={selStart:o.selStart,selEnd:o.selEnd};return f!==o.selStart[0]&&(h.selStart=[f,0]),d!==o.selEnd[0]&&(u=(a=i.lines.atIndex(d)).width-1,a.domInfo?(l=(s=a.domInfo).lineManagerType,c=s.lineMarker,u=l?c+1:a.width-1,l&&c+1!==a.width-1&&R.editor.log("oops debug: line entry width does not match: ["+d+", "+a.width+"]")):R.editor.log("why u need to get selection of the unrendered place?"),h.selEnd=[d,u]),h.selEnd[0]<h.selStart[0]||h.selEnd[1]<0||h.selStart[1]<0?t:h},this.getRealEndLine=function(e,t){var n=R.getRealLine,r=R.editor.getReps()[e],i=(t||r).selEnd[0],o=r.lines.length()-1;return o<0?0:(i<0?i=n(e,i=0,!0):o<i&&(i=o),i)},this.getRealLine=function(e,t,n){for(var r=R.editor.getReps()[e],i=r.lines.atIndex(t),o=n?1:-1,a=r.lines.length()-1;i&&i.lineNode&&s(i.lineNode)&&i.text.length<=0;){if(0===t&&1===o)return t;if(t===a&&-1===o)return t;t-=o,i=r.lines.atIndex(t)}function s(e){return!!("br"===e.nodeName||e.querySelector("br"))}return t},this.getRealFirstLine=function(e,t){var n=R.editor,r=R.getRealLine,i=n.getReps()[e],o=(t||i).selStart[0],a=i.lines.length()-1;return o<0?o=r(e,o=0,!1):a<o&&(o=r(e,o=a,!1)),o},this.focusCaretOnDom=function(e){var t,n,r=R.editor,i=R.updateBrowserSelectionFromRep,o=R.isCaret,a=r.getRep(),s=r.domToRep(e);s.selStart&&s.selEnd&&!Object(N.default)(a.selStart,s.selStart)&&!Object(N.default)(a.selEnd,s.selEnd)&&(o()||window.getSelection().removeAllRanges(),t=s.selStart[0],n=Object(W.default)(a.lines.atIndex(t),"text","").length,a.selStart=[t,n],i(!(a.selEnd=[t,n])))},this.getFastSelection=function(){var e=R.getSelection,t=R.positionForDomPoint,n=e();if(!n)return null;var r=n.startPoint?t(n.startPoint):null,i=n.endPoint?t(n.endPoint):null;return{selStart:r?[r.line,r.col]:null,selEnd:i?[i.line,i.col]:null,selZone:r?r.zone:"0"}},this.getSelStart=function(){var e=R.currentSelection;return e&&e.start?[e.start.line,e.start.col]:null},this.getSelEnd=function(){var e=R.currentSelection;return e&&e.end?[e.end.line,e.end.col]:null},this.internalGetSelectionPoints=function(){if(R.disableSelection)return null;var e=R.editor,t=R.getUnifiedSelectionRange,n=R.getInternalSelection,r=R.isFocusAtStart,i=window.getSelection();if(i&&"None"!==i.type&&0!==i.rangeCount){var o=t(i),a=e.getInnerContainer();if(Hi(a,o.startContainer)&&Hi(a,o.endContainer)){if((Ce.isMobile||Ce.isEdge)&&(he()(o.startContainer).closest(".ace-line-pocket").length||he()(o.endContainer).closest(".ace-line-pocket").length))return null;var s,l,c={startPoint:n(o.startContainer,o.startOffset),endPoint:n(o.endContainer,o.endOffset),isReversed:r(i)};return c.startPoint.node===c.endPoint.node&&ji(c.startPoint.node)&&(l=Zi(s=c.startPoint.node).length,s&&"string"==typeof s.className&&-1<s.className.indexOf("gallery-drop-hint-container")&&(s=s.firstChild),c={startPoint:{node:s,index:0,maxIndex:l},endPoint:{node:s,index:l,maxIndex:l},isReversed:c.isReversed}),c}return null}return null},this.positionForDomPoint=function(e){var t=R.editor;if(!e)throw new Error("positionForDomPoint got falsy point");var n=t.dom.rootNodeOfZoneContaining(e.node);if(!n){for(var r=e.node;r&&r.parentNode;)r=r.parentNode;var i=new Error("positionForDomPoint got falsy root node; is the node not in ace-editor? node is p.nodeToRedactedString(point.node) +  of  + p.nodeToRedactedString(n)");throw window.collectEvent&&window.collectEvent("dev_editor_selection",{errStack:i.stack}),i}var o=t.dom.zoneOfRootNode(n);if(!o)throw new Error("positionForDomPoint got falsy zone node; is something wrong with the ace-editor node?");var a=t.getPositionForPoint(o,e);if(a)return a;var s=t.getReps()[o];if(e.node===n){if(0===e.index)return new Vo(o,0,0);var l=s.lines.length(),c=s.lines.atIndex(l-1);return new Vo(o,l-1,c.text.length)}var u=e.node,d=0;Li(u)?d=e.index:0<e.index&&(d=Ki(u).length);for(var f,h=u.parentNode;h&&h!==n;)u.parentNode||console.warn("point node is null",e),u.previousSibling?d+=Ki(u=u.previousSibling).length:Fi(f=ji(u=h)&&Zi(h))&&(d=0<d?f.length:0),h=u.parentNode;""===u.id&&console.debug("BAD");var p=s.lines.atKey(u.id),g=Do(u);(g&&t.isBlockElement(g)||R.blockRegex.test(u.className)||p&&p.lineMarker)&&(d+=p.lineMarker);var v=s.lines.indexOfEntry(p);return new Vo(o,v,d)},this.internalUpdateRepFromSelection=function(e,t,n){var r=t,i=n;e&&!t&&(r=R.positionForDomPoint(e.startPoint)),e&&!n&&(i=R.positionForDomPoint(e.endPoint));var o,a,s=R.isCollapsed,l=R.updateCurrentSelection,c=R.editor;r&&(o=c.getReps()[r.zone].lines.length(),r.line>=o&&(a=o-1,r=new Vo(r.zone,a,c.getReps()[r.zone].lines.atIndex(a).text.length)),o=c.getReps()[i.zone].lines.length(),i.line>=o&&(a=o-1,i=new Vo(i.zone,a,c.getReps()[i.zone].lines.atIndex(a).text.length)));var u=!1,d=s();return e&&(u=l({start:r,end:i,isReversed:e&&e.isReversed})),{wasAffected:u,wasCaret:d}},this.isCollapsed=function(){return R.currentSelection.isCollapsed},this.isFocusAtStart=function(e){var t=ko(e,0);return(t.startContainer!==t.endContainer||t.startOffset!==t.endOffset)&&e.anchorNode&&e.anchorNode===t.endContainer&&e.anchorOffset===t.endOffset},this.getInternalSelection=function(e,t){var n=R.editor,r=R.editor.getInnerContainer(),i=e,o=i.childNodes.length,a=Di(i,"[data-faketext]",r);if(a&&a.className&&-1<a.className.indexOf("ace-table")&&(a=null),a){var s=Zi(a).length,l=a.getAttribute&&!a.getAttribute("data-faketext");if(!l||Li(i))return{node:l?i:a,index:0===t?t:s,maxIndex:s};if(t===o)return{node:d=i.childNodes.item(o-1),index:Ui(d),maxIndex:Ui(d)};var c=i.childNodes.item(t);return{node:c,index:0,maxIndex:Ui(c)}}if(Li(i))return{node:i,index:t,maxIndex:i.nodeValue?i.nodeValue.length:0};var u=n.getCurrentLineEntry();if(0===o&&u)return{node:n.getCurrentLineEntry().lineNode,index:Ui(u),maxIndex:Ui(u)};if(0===o)return{node:i,index:0,maxIndex:1};if(t===o){var d=i.childNodes.item(o-1);return"TBODY"===i.tagName&&d.querySelector('div[id^="magicdomid"]')&&u&&(d=u.lineNode),{node:d,index:Ui(d),maxIndex:Ui(d)}}var f=i.childNodes.item(t);return"TR"!==f.tagName&&"TD"!==f.tagName||!f.querySelector('div[id^="magicdomid"]')||(f=f.querySelector('div[id^="magicdomid"]')),{node:f,index:0,maxIndex:Ui(f)}},this.getUnifiedSelectionRange=function(e){if(!e.rangeCount)return null;var t;1!==e.rangeCount&&(t="oops debug: invalid selection with "+e.rangeCount+" rangeCount.",Ue(t));var n=ko(e,0);return he()(n.startContainer).hasClass("tb-resizable-grippy-inner")&&n.setStart(n.endContainer,n.endOffset),n},this.get=function(){return R.currentSelection},this.hasSelection=function(){return R.currentSelection.hasSelection},this.isOnOneLine=function(){return R.getStart().line===R.getEnd().line},this.getStart=function(){return Object(W.default)(R.currentSelection,"start")},this.getEnd=function(){return Object(W.default)(R.currentSelection,"end")},this.getFocus=function(){return Object(W.default)(R.currentSelection,"focus")},this.getAnchor=function(){return Object(W.default)(R.currentSelection,"anchor")},this.getZone=function(){return Object(W.default)(R.currentSelection,"start.zone")},this.getLine=function(){return Object(W.default)(R.currentSelection,"start.line")},this.getColumn=function(){return Object(W.default)(R.currentSelection,"start.col")},this.setWithSelection=function(e,t,n,r){void 0===r&&(r=R.currentSelection.isReversed);var i=new Vo(e,t[0],t[1]),o=new Vo(e,n[0],n[1]),a=new qo({start:i,end:o,isReversed:r});R.editor.callStack.inCallStackIfNecessary("setWithSelection",function(){R.set(a)},{shouldIncorp:!1})},this.set=function(e){var t=qo.from(e);R.updateCurrentSelection(t)&&(R.editor.callStack.getCurrentCallStack().selectionAffected=!0)},this.getSelectionRange=function(e,t,n,r){var i=0<e[1]?e[1]-n.lineMarker:e[1],o=0<t[1]?t[1]-r.lineMarker:t[1],a=n.lineNode,s=r.lineNode,l=a.childNodes,c=s.childNodes,u=R.getRangeNodeOffset(i,l),d=R.getRangeNodeOffset(o,c),f=document.createRange();return f.setStart(u.node,u.index),f.setEnd(d.node,d.index),f},this.getBoundingClientRect=function(){var e=R.editor,t=window.getSelection();if(0===t.rangeCount)return{x:0,y:0,width:0,height:0};var n=ko(t,0),r=n.getBoundingClientRect();if(r.top===r.bottom&&L.a.ios){var i=n.getClientRects();if(0<i.length){var o=i[0];return{x:o.left,y:o.top,width:o.right-o.left,height:o.bottom-o.top}}if(n.startContainer instanceof Element){var a=n.startContainer.getBoundingClientRect();return{x:a.left,y:a.top,width:a.right-a.left,height:a.bottom-a.top}}}var s,l,c,u=R.locationOfSelection(n.startContainer,n.startOffset),d=R.locationOfSelection(n.endContainer,n.endOffset);return u&&d?r={top:Math.min(r.top,Math.min(u.top,d.top)),bottom:Math.max(r.bottom,Math.max(u.bottom,d.bottom)),left:r.left,right:r.right}:(s=e.dom.getAceLineForNode(n.startContainer),l=e.dom.getAceLineForNode(n.endContainer),s&&l&&(u=s.getBoundingClientRect(),d=(d||!l.previousSibling?l:l.previousSibling).getBoundingClientRect(),r={top:Math.min(u.top,d.top),bottom:Math.max(u.bottom,d.bottom),left:r.left,right:r.right},c=e.dom.$(".ace-line:last-child"),(he()(s).is(c)||he()(l).is(c))&&(r.bottom-=c.outerHeight(!0)-c.height()))),{x:r.left,y:r.top,width:r.right-r.left,height:r.bottom-r.top}},this.getNodeForPosition=function(e){return R._getPointForLineAndChar(e).node},this.getPositionForNode=function(e){return R.positionForDomPoint({node:e,index:0,maxIndex:0})},this.getRangeForNode=function(e){var t=R.getPositionForNode(e),n=t.translate({col:+he()(e).text().length});return new Ko({start:t,end:n})},this.focusEditor=function(){R.currentSelection&&R.currentSelection.hasSelection||R.editor.dom.getRoot().focus(),R.internalUpdateSelectionFromRep(!0)},this.focusNode=function(i){var o=R.editor;window.focus(),R.root.focus(),o.callStack.inCallStack("gotonode",function(){var e,t,n=i.nodeType===Node.ELEMENT_NODE?1:i.nodeValue.length,r=this.positionForDomPoint({node:i,index:0,maxIndex:n});r&&(o.selection.set(r),e=o.getReps()[r.zone],t=r.line===e.lines.length()-1?r.line:r.line+1,this.editor.getViewport().scrollNodeVerticallyIntoViewDeprecated(e.lines.atIndex(t).lineNode,"center"))})},this.isEditorFocused=function(){var e=R.root;return!(!e.ownerDocument||!e.ownerDocument.activeElement)&&(!(!R.editor.dom.isRootOfZone(e.ownerDocument.activeElement)&&"A"!==e.ownerDocument.activeElement.tagName&&"TEXTAREA"!==e.ownerDocument.activeElement.tagName)&&R.editor.dom.isNodeInEditor(e.ownerDocument.activeElement))},this.selectAll=function(){R.editor.callStack.inCallStackIfNecessary("select-all",function(){var e=qo.from(Qo(R.editor,Vo.ROOT_ZONE),{isReversed:!0});R.set(e),R.internalUpdateSelectionFromRep(!0)})},this.getInlineMagicObjectAtPosition=function(e){return null},this.internalPositionAncestry=function(e){for(var t=[e],n=e;n.zone!==Vo.ROOT_ZONE;)n=R.editor.managers.positionOfLineManagerContainingZone(e.zone),t.push(n);return t},this.updateRepSelection=function(){var t,e,n=R.editor,r=R.currentSelection,i=r.zone,o=r.start,a=r.end,s=r.isReversed,l=n.getRepManager();try{for(var c=ge(Object.keys(l.reps)),u=c.next();!u.done;u=c.next()){var d=u.value,f=l.reps[d];f.selStart=null,f.selEnd=null,f.selFocusAtStart=!1}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}l.setActiveRep(i);var h=l.getActiveRep();h.selStart=[o.line,o.col],h.selEnd=[a.line,a.col],h.selFocusAtStart=s},this.fixInvalidSelections=function(e,t){var n=e,r=t,i=R.editor.managers.getLineManagerType(e.zone,e.line);return e.line===t.line&&(0===e.col&&0===t.col||1===e.col&&1===t.col)&&"aceTable"===i&&(n=e.withCol(0),r=t.withCol(1)),{selectStart:n,selectEnd:r}},this.pointToRangeBound=function(e,t){var n=R._copyPoint(e);if(t){if(Li(n.node)&&n.index===n.maxIndex&&!Ce.isIOS){for(var r,i=n.node;!i.nextSibling&&!R.editor.dom.isRootOfZone(i)&&!R.editor.dom.isRootOfZone(i.parentNode)&&null!=i.parentNode;)i=i.parentNode;!i.nextSibling||"string"==typeof i.nextSibling.tagName&&"br"===i.nextSibling.tagName.toLowerCase()||i===n.node||R.editor.dom.isRootOfZone(i)||R.editor.dom.isRootOfZone(i.parentNode)||(o=i.nextSibling,n.node=o,n.maxIndex=Ui(o),r=ji(o)&&o.getAttribute&&"start"===o.getAttribute("data-contentcollector-ignore-space-at"),n.index=r?1:0,n=R._diveDeep(n))}Li(n.node)||(n=R._diveDeep(n))}if(R.editor.dom.isRootOfZone(n.node))return{container:n.node,offset:n.index};if(Li(n.node))return{container:n.node,offset:n.index};var o,a=!1;if((o=n.node).className&&o.className.includes&&o.className.includes("single-line")){var s=R.editor,l=s.dom.rootNodeOfZoneContaining(o),c=l&&s.dom.zoneOfRootNode(l),u=c&&s.getReps()[c],d=u&&u.lines.atKey(o.id),f=u&&u.lines.indexOfKey(o.id);if(d&&d.lineMarker&&(a=!0),L.a.msedge&&u&&u.attributeManager.findAttributeOnLine(f||-1,"gallery")){var h=n.index;return d&&d.lineMarker&&(h-=d.lineMarker),{container:o,node:o,offset:h}}}var p=R._childIndex(n.node),g=a?p:p+n.index;return{container:o.parentNode,node:o,offset:g}},this._setSelection=function(e){var t,n,r,i,o,a=window.getSelection();a&&e&&(t=e.startPoint.node===e.endPoint.node&&e.startPoint.index===e.endPoint.index,n=R.pointToRangeBound(e.startPoint,t),r=R.pointToRangeBound(e.endPoint,t),i=a.rangeCount&&ko(a,0),Ce.isMobile?!t&&e.isReversed&&a.collapse&&a.extend?(a.removeAllRanges(),a.collapse(r.container,r.offset),a.extend(n.container,n.offset)):i&&i.startContainer===n.container&&i.endContainer===r.container&&i.startOffset===n.offset&&i.endOffset===r.offset||(o=document.createRange(),n.node&&n.node===r.node&&n.node.className&&n.node.className.includes&&(n.node.className.includes("single-line")||n.node.className.includes(In))?(o.setStart(n.node,0),o.setEnd(n.node,1),a.removeAllRanges(),a.addRange(o)):(o.setStart(n.container,n.offset),o.setEnd(r.container,r.offset)),a.removeAllRanges(),a.addRange(o)):i&&i.startContainer===n.container&&i.endContainer===r.container&&i.startOffset===n.offset&&i.endOffset===r.offset&&R.isFocusAtStart(a)===e.isReversed&&!R.editor.isSelectingAll||(a.collapse&&a.extend?t?a.collapse(n.container,n.offset):e.isReversed?(a.collapse(r.container,r.offset),a.extend(n.container,n.offset)):(a.collapse(n.container,n.offset),a.extend(r.container,r.offset)):((o=document.createRange()).setStart(n.container,n.offset),o.setEnd(r.container,r.offset),a.removeAllRanges(),a.addRange(o))))},this.internalUpdateSelectionFromRep=function(e){var t,n=R.editor,r=R.currentSelection,i=r.start,o=r.end;if(r.hasSelection){if(e||R.isEditorFocused()){n.dom.zoneOfRootNode(document.activeElement)===i.zone||R.focusNodeWithoutScrolling(n.dom.rootNodeOfZone(i.zone));var a={startPoint:R._getPointForLineAndChar(i),endPoint:R._getPointForLineAndChar(o),isReversed:!!R.currentSelection.isReversed},s=i.zone===o.zone&&i.line===o.line;if(s){var l,c,u,d,f,h,p,g,v=n.getReps()[i.zone].attributeManager.findAttributeOnLine(i.line,"gallery"),m=v&&JSON.parse(v),y="Range"===window.getSelection().type;Ce.isMobile&&m&&1===m.items.length&&y?(l=n.getReps()[i.zone].lines.atIndex(i.line).lineNode,a={startPoint:{node:g=he()(l).find(".image-container")[0],index:0,maxIndex:1},endPoint:{node:g,index:1,maxIndex:1},isReversed:!1}):m&&1===m.items.length&&(l=null===(t=n.getReps()[i.zone].lines.atIndex(i.line))||void 0===t?void 0:t.lineNode)&&(a=(c=l.querySelector("[data-new-gallery-text]"))?(u=parseInt(c.dataset.newGalleryText),d=Math.max(i.col,0),f=Math.min(o.col,u),p=h=void 0,p=0===d&&f===u?(h=he()(l).find(".gallery-drop-hint-edge-left")[0],he()(l).find(".gallery-drop-hint-edge-right")[0]):h=he()(l).find(".image-container-wrap [data-zero-space]")[d],{startPoint:{node:h,index:0,maxIndex:1},endPoint:{node:p,index:0,maxIndex:1},isReversed:!1}):{startPoint:{node:g=he()(l).find(".gallery")[0],index:0,maxIndex:1},endPoint:{node:g,index:0,maxIndex:1},isReversed:!1})}else if(s&&i.col+1===o.col&&R.getInlineMagicObjectAtPosition(i)){if(!(g=he()(R.getInlineMagicObjectAtPosition(i).getWrapperNode()).find(".extraneous-space").get(0).childNodes[0]))throw new Error("getting magic extraneous space node (inline magic object) didn't work");a={startPoint:{node:g,index:0,maxIndex:1},endPoint:{node:g,index:1,maxIndex:1},isReversed:!1}}else a={startPoint:R._getPointForLineAndChar(i),endPoint:R._getPointForLineAndChar(o),isReversed:!!R.currentSelection.isReversed};R._setSelection(a)}}else R._setSelection(null)},this.focusNodeWithoutScrolling=function(e){var t=he()(R.editor.dom.getScrollElSelector()),n=t.scrollLeft()||0,r=t.scrollTop()||0;ta(e),t.scrollLeft(n),t.scrollTop(r),L.a.safari&&!L.a.mobile&&setTimeout(function(){t.scrollTop(r)})},this.internalIMEHackOnIOS=function(){return R.pointToRangeBound(R._getPointForLineAndChar(R.getStart()),!1)},this._getPointForLineAndChar=function(e){var t=R.editor.getReps()[e.zone].lines.atIndex(e.line);return R.internalGetPointForLineEntryAndCol(t,e.col)},this.internalGetPointForLineEntryAndCol=function(e,t){var n=e.zone,r=R.editor.getRep(n).lines,i=new Vo(n,r.indexOfEntry(e),t),o=R.editor.getPointForPosition(i);if(o)return o;if(e.domInfo&&e.domInfo.lineManagerType)return{node:e.lineNode,index:Math.min(t,1),maxIndex:1};var a=t-e.lineMarker;a<0&&(a=0);var s=e.lineNode,l=s,c=!1;if(0===a){for(var u=s,d=s.firstElementChild;d;)d=(u=d)instanceof HTMLElement&&""===d.dataset.ignoreSelection?d.nextSibling:d.firstElementChild;var f=u.getAttribute("data-contentcollector-ignore-space-at");return{node:u,index:f?1:0,maxIndex:u.textContent.length||1}}for(;l!=s||!c;)if(c)l.nextSibling?(l=l.nextSibling,c=!1):l=l.parentNode;else{var h=ji(l);if(Li(l)||h){var p=Zi(l),g=Fi(p),v=(g?p:l.nodeValue).length,m=g&&0<v,y=ji(l)&&l.getAttribute&&"start"===l.getAttribute("data-contentcollector-ignore-space-at"),b=a===v&&m;if(a===v&&!h){var E=l.parentNode;"span"!==E.tagName.toLocaleLowerCase()&&(E=E.parentNode);var k=E.nextSibling;if(k&&k instanceof HTMLElement&&"start"===k.getAttribute("data-contentcollector-ignore-space-at"))return{node:k,index:1,maxIndex:1}}if(a<=v&&y)return{node:l,index:1,maxIndex:1};if(a<=v&&!b)return{node:l,index:a,maxIndex:v};a-=v,c=!0}else{var C=Do(l);C?l=C:c=!0}}return{node:s,index:1,maxIndex:1}},this.locationOfSelection=function(e,t){var n=document.createRange();n.setStart(e,t),n.setEnd(e,t);var r=n.getClientRects();if(0===r.length)return e&&e.getBoundingClientRect?e.getBoundingClientRect():null;var i=r[r.length-1];return 0===i.bottom||0===i.top?null:i},this.getCursorRect=function(e,t){void 0===t&&(t="0");var n=R.editor.getRep(),r=e||n;if(!r.selStart)return{top:0,left:0,height:0};var i=n.lines.atIndex(r.selStart[0]);if(!i)return{top:0,left:0,height:0};var o=i.getLineRect(t),a=i.getCharRect(r.selStart[1]-i.lineMarker,!1,t);return o&&a?{top:o.top+a.top,left:o.left+a.left,height:o.height}:{top:0,left:0,height:0}},this.logCurrentSelection=function(){var e,t=R.getSelection();t&&(e={startPoint:ue(ue({},t.startPoint),{node:So(Io(t.startPoint.node))}),endPoint:ue(ue({},t.endPoint),{node:So(Io(t.endPoint.node))})},R.editor.log("current selection: ",JSON.stringify(e)))},this.editor=e,this.root=t,this.disableSelection=!0===n}function oa(e){var t=[];return e.sort(function(e,t){return e-t}).forEach(function(e){t.length&&t[t.length-1][1]+1===e?t[t.length-1][1]=e:t.push([e,e])}),t}function aa(e,t){var n=ve(e,2),r=n[0],i=n[1],o=ve(t,2),a=o[0],s=o[1];return!(i<a||s<r)}function sa(e,t){for(var n=[[]],r=0;r<e.length;r++){var i=e[r];t(i)?n.push([]):n[n.length-1].push(i)}return n}function la(e,t){return{top:(e.top||0)*t,bottom:(e.bottom||0)*t,left:(e.left||0)*t,right:(e.right||0)*t,height:(e.height||0)*t,width:(e.width||0)*t}}function ca(e,t){var n=e.dom.getEntryForNode(t),r=n&&n.zoom||1;return la(t.getBoundingClientRect(),r)}function ua(e){return Li(e.node)&&1===e.index}var da,fa,ha=Ce.isChrome||Ce.isSafari;(fa=da=da||{}).Block="Block",fa.Inline="Inline";var pa="52px",ga="26px";function va(e){return e.blockRender.isSkipAboveRender()?ga:pa}var ma=(ya.prototype.getEditor=function(){return this.editor},ya.prototype.shouldHandleZoneRect=function(){var e=this.editor.getRep(this.zone).lines.indexOfEntry(this),t=this.editor.managers.getChildZonesAtLine(this.zone,e);return 0<t.cols.length&&0<t.rows.length},ya.prototype.registerInstance=function(e){this.instances.includes(e)?console.warn(""+e.instanceName+""):this.instances.find(function(e){return e.displayType===da.Block})?console.warn("BlockinlineBlock"):this.instances.push(e)},ya.prototype.unregisterInstance=function(e){var t=this.instances.indexOf(e);-1!==t&&this.instances.splice(t,1)},ya.prototype.getAllInstances=function(){return this.instances.slice()},ya.prototype.getAllInstancesByName=function(t){return this.instances.filter(function(e){return e.instanceName===t})},ya.prototype.getInstanceByName=function(t){return this.instances.find(function(e){return e.instanceName===t})},ya.prototype.setDomInfo=function(e){var t=e.node,n=e.lineString,r=e.zone;this.lineNode=t,this.lineNode&&(this.lineNode.root=this.root),this.width=n.length+1,this.key||(this.key=this.uniqueId(t)),this.text=n,this.domInfo=e,this.lineMarker=this.domInfo.lineMarker,this.zone=r,this.isRendered=!0},ya.prototype.deleteRect=function(){this.rects={}},ya.prototype.deleteLineRect=function(){var e=this.rects;delete e.line,this.lineMarker&&delete e[this.lineMarker],delete e.lineOfZone},ya.prototype.getLineRect=function(e){void 0===e&&(e=sr);var t=this.rects;if(e!==sr&&!t.lineOfZone||e===sr&&!t.line){var n=this.getCharRect(this.lineMarker,!1,e,!0);return ue({},n)}return ue({},e!==sr?t.lineOfZone:t.line)},ya.prototype.getCharRect=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=sr),void 0===r&&(r=!1);var i=this.editor,o=this,a=o.lineNode,s={top:0,left:0,right:0,height:0,width:0};if(!a)return s;if(!this.editor.docbody.contains(a)&&this.isActive)return s;var l=i.getRep(this.zone),c=o.zoom||1,u=this.rects;(e=Math.max(e,o.lineMarker))>o.lineMarker&&e>=o.text.length&&(t=!0,e=Math.max(o.text.length-1,0));var d,f,h=n!==sr?"zone"+e+":left":e+":left",p=n!==sr?"zone"+e+":right":e+":right",g=t?p:h,v=e===o.lineMarker,m=n!==sr?u.lineOfZone:u.line,y=v&&!m,b=!1;if(u[g]&&!y)return ue({},u[g]);if(!this.isActive&&!r)return s;if(this.isActive&&this.isRendered){var E=this.getSelectionRect(e,y);if(!E)return s;P=E}else{if(this.zone===sr){if(this.editor.enableUnmountNode){var k=this.editor.getRep(this.zone).lines,C=this.editor.preRenderer.getLayoutForLine(this.zone,k.indexOfEntry(this)),I=C.top;return{top:I,height:_=C.height,left:0,bottom:I+_}}P=a.getBoundingClientRect()}else{var S=i.managers.zoneToLineEntry[this.zone];if(!S.lineNode)return s;if(this.editor.enableUnmountNode){var T=(k=this.editor.getRep(sr).lines).indexOfEntry(S),O=this.editor.preRenderer.getLayoutForLine(sr,T).top,w=this.zoneRect,R=w.top,x=w.left;return{top:R+O,height:_=w.height,left:x,bottom:R+_+O}}var M,N,_,L,D,B,P,F=S.lineNode.getBoundingClientRect();P=this.isRendered?(N=(M=this.zoneRect).top,x=M.left,_=M.height,L=M.right,D=M.bottom,B=M.width,{top:N+F.top,left:x+F.left,right:L+F.right,bottom:D+F.bottom,height:_||F.height,width:B||F.width}):F}b=!0}P=la(P,c);var j=(d=n===sr?(f=i.getOuterContainer()).getBoundingClientRect():(f=i.dom.getRootForZone(n),ca(i,f))).left,z=d.top,H=P.top-z,U=P.bottom-z,V=P.height,W={top:H,left:P.left-j,height:V,bottom:U},K={top:H,left:P.right-j,height:V,bottom:U},Z=t?K:W,q=n!==sr?"lineOfZone":"line";if(e===o.lineMarker){var J,Y=ue({},W);if("line"===q&&(T=l.lines.indexOfEntry(o),J=l.attributeManager.getAttributesOnLine(T),"blockquote"===i._getTypeInAttribs(J,"blockquote")&&(Y.top-=Jn)),b)return Y;u[q]=Y}var Q=u[q]||this.getLineRect(n),X=Q.top,$=Q.left,ee=Q.bottom;return W.top=W.top-X,W.left=W.left-$,W.bottom=W.bottom-ee,K.top=K.top-X,K.left=K.left-$,K.bottom=K.bottom-ee,b||(u[h]=W,u[p]=K),r?u[q]:ue({},Z)},Object.defineProperty(ya.prototype,"asyncNodeNum",{get:function(){return this.getAllInstances().reduce(function(e,t){return e+Number(Boolean(t.isAsyncNode))},0)},enumerable:!0,configurable:!0}),Object.defineProperty(ya.prototype,"shouldKeepActive",{get:function(){return this.getAllInstances().some(function(e){return e.shouldKeepActive})},enumerable:!0,configurable:!0}),Object.defineProperty(ya.prototype,"shouldRetain",{get:function(){return this.getAllInstances().some(function(e){return e.shouldRetain})},enumerable:!0,configurable:!0}),ya);function ya(e){var w=this;this.mounted=!1,this.isActive=!1,this.isRendered=!1,this.isRetained=!1,this.lineMarker=0,this.needUpdateZoneRect=!1,this.rects={},this.instances=[],this.zoneRect={top:0,bottom:0,left:0,right:0,height:0,width:0},this.updateZoneRectIfNecessary=function(){var e,i;!w.needUpdateZoneRect||w.zone!==sr||-1<(e=w.editor.getRep(sr).lines.indexOfEntry(w))&&(i=!0,w.editor.managers.getChildZonesAtLine(sr,e).text.forEach(function(e){for(var t=w.editor.getRep(e).lines,n=0;n<t.length();n++){var r=t.atIndex(n);r&&r.isRendered?r&&r.updateZoneRect():i=!1}}),i&&(w.needUpdateZoneRect=!1))},this.updateZoneRect=function(){var e,t,n,r,i,o,a,s,l;w.zone===sr||(e=w.editor.managers.zoneToLineEntry[w.zone])&&e.lineNode&&w.lineNode&&(t=e.lineNode.getBoundingClientRect(),(n=w.getSelectionRect(w.lineMarker))&&(r=n.top,i=n.left,o=n.height,a=n.right,s=n.bottom,l=n.width,w.zoneRect={top:r-t.top,left:i-t.left,right:a-t.right,bottom:s-t.bottom,height:o,width:l}))},this.getSelectionRect=function(e,t){var n=e,r=e+1,i=w.editor,o=w,a=o.lineNode;if(!w.isActive)return a.getBoundingClientRect();if(!w.editor.docbody.contains(a))return null;var s=i.getRep(w.zone),l=i.selection.getPointForChatAtLeafNode(o,n,!0),c=i.selection.getPointForChatAtLeafNode(o,r,!0),u=o.text.length>o.lineMarker,d=he()(a),f=d.hasClass("single-line"),h=0<d.find(".sheet").length,p=0<d.find(".ace-table").length,g=0<d.find(".horizontal-line").length,v=d.hasClass("code-block-ace-line"),l=i.selection.getRealPointAtFakeText(l),c=i.selection.getRealPointAtFakeText(c);if(u&&(f||h||p||g||v))var m=v?l:c,y=(m.node.getBoundingClientRect?m.node:m.node.parentNode).getBoundingClientRect();else if(u){var b=document.createRange();ua(c)?(b.setStart(c.node,0),ha||(b.setEnd(c.node,c.index),(k=b.getBoundingClientRect()).left===k.right&&b.setStart(l.node,l.index))):b.setStart(l.node,l.index),b.setEnd(c.node,c.index),y=b.getBoundingClientRect()}else{var E=o.lineNode,k={top:0,left:0,right:0,height:0,width:0},C=E&&Do(E);if(!C||!C.getBoundingClientRect)return t&&Ue("return rect has no line rect"),null;k=C.getBoundingClientRect();var I=s.lines.indexOfEntry(o),S=s.attributeManager.getAttributesOnLine(I),T=i._getTypeInAttribs(S,"align"),O=k.left;"center"===T&&(O=k.left+Math.ceil(k.width/2)),"right"===T&&(O=k.right),y={top:k.top||0,left:O||0,right:O||0,height:k.height||0,bottom:k.bottom||0,width:k.width||0}}return y},this.setLineMarker=function(e){for(var t=w.editor.changesetHelper.opIterator(e),n=w.editor.getRep().apool;t.hasNext();){var r=t.next();if(!r.getAttribute("lmkr",n))return;w.lineMarker+=r.chars}};var t,n,r,i=e.info,o=e.editor,a=e.context,s=e.zone,l=e.root;this.editor=o,this.uniqueId=e.uniqueId||o.uniqueId,this.domInfo=i,this.zone=s,this.root=l,a&&(t=a.key,n=a.text,r=a.aline,this.key=t,this.text=n,this.width=n.length+1,this.setLineMarker(r),this.lineNode=document.createElement("div"),this.lineNode.id=t,this.lineNode.root=l),i&&this.setDomInfo(i)}var ba=Object(y.default)(function(e){var t=e.getDocBody();if(t){for(var n=he()(t).width(),r=t.lastChild||null;r&&!r.offsetHeight&&!r.offsetTop;)r=r.previousSibling;var i,o,a=r?r.offsetHeight+r.offsetTop:0,s=t.getAttribute("data-last-height"),l=t.getAttribute("data-last-width"),c=Number(s||0),u=Number(l||0);!c&&!u||c===a&&u===n||(e.hook.callAll("editorSizeChange",{prev:{height:c,width:u},next:{height:a,width:n}}),(i=e.eventEmitter)&&"function"==typeof i.trigger&&i.trigger("editorSizeChange",[{prev:{height:c,width:u},next:{height:a,width:n}}]),(o=e.getProps().onResize)&&o({prev:{height:c,width:u},next:{height:a,width:n}})),t["data-last-height"]!==a&&(t.setAttribute("data-last-height",a),t["data-last-height"]=a),t["data-last-width"]!==n&&(t.setAttribute("data-last-width",n),t["data-last-width"]=n)}},50);function Ea(e,i){var t,o=this,n=e.selectionRange,r=e.forceRender,a=void 0===r||r,s=e.renderAsync,l=void 0===s||s,c=e.scrollFn,u=Object(b.default)(n),d=u.selStart,f=u.selEnd,h=u.selZone,p=f[0];sr!==h&&h?(p=i.getLineNumInRootZone(h,f[0]),u.selStart=[p,0],u.selEnd=[p,0],u.selZone=sr):sr!==h&&h||(p=i.getHeadingLineNumIfNecessary(p),e.selectionRange.selStart[0]=d[0]=p,e.selectionRange.selEnd[0]=f[0]=p);var g=!i.enableUnmountNode&&(null===(t=i.blockRender)||void 0===t?void 0:t.enableOptimization()),v=e.shouldRenderAll||g;return new Promise(function(r,t){try{var e,n=function(){var e,t=!0,n=function(){return de(o,void 0,void 0,function(){return pe(this,function(e){switch(e.label){case 0:return[4,Oa({selectionRange:u,scrollFn:c,forceRender:a},i)];case 1:return e.sent(),r(),[2]}})})};null!==(e=i.blockRender)&&void 0!==e&&e.withoutHandleScrolling(n,t)};v?i.blockRender.requestRenderAllForScroll(p,a,l,n):(e={bufferLine:p,forceRender:a,async:l},i.blockRender.requestRender(e,n))}catch(e){t(e)}})}function ka(e){var t,n=e.getRep();n.selStart&&(ba(e),t=(n.selFocusAtStart?n.selStart:n.selEnd)[0],n.lines.atIndex(t)&&Ca(n.lines.atIndex(t).lineNode,e))}function Ca(e,t){Ce.mobile?Ia(e,t):Ta(t)}function Ia(e,t){var n=window.getSelection(),r=t.getRep();r.selStart&&r.selEnd&&n.rangeCount?Aa(t):Ra(e,t)}function Sa(e,t){for(var n=e.offsetTop,r=e.offsetParent;null!==r&&r!==t;)n+=r.offsetTop+r.clientTop,r=r.offsetParent;return n}function Ta(e){var t,n,r,i,o,a,s,l,c,u,d=e.getScrollContainer();d&&(t=e.getRep(),n=e.getOuterContainer(),r=e.getOuterContainer(),i=0,d.contains&&d.contains(r)&&(i=Sa(r,d)),o=e.selection.getCursorRect(t),a=d.scrollTop,s=d.offsetHeight,c=(l=o.top+n.offsetTop+i)-(s-o.height),u=28<o.height?a<=l&&l+o.height<a+s:a<=l&&l+3*o.height<a+s,l<=a&&l+o.height>a?d.scrollTop=l:u||(28<o.height?d.scrollTop=c:d.scrollTop=c+2*o.height))}function Oa(e,t){var n=e.selectionRange,r=e.scrollFn,o=t.getScrollContainer();if(o){var i=n.selStart,a=n.selEnd,s=n.selZone,l=t.getRep(s).lines.atIndex(i[0]);if(l&&l.lineNode){var c=a;i[0]!==a[0]&&(c=i);var u=l.getCharRect(i[1]),d=l.getCharRect(c[1]),f=l.getLineRect().top-u.top+t.blockRender.getOffsetTopToScroller(),h=function(e){var t=o instanceof Window?o.innerHeight:o.offsetHeight,n=e-t/3,r=u.height+d.top-u.top,i=o instanceof Window?o.scrollY:o.scrollTop;i<=e+r&&e<=i+t||(o instanceof Window?o.scrollTo(0,n):o.scrollTop=n)};return(Object(g.default)(r)?r:h)(f)}}}function wa(e){var t=e.screenOffsetTop,n=e.screenHeight,r=e.targetOffsetTop,i=e.targetHeight,o=e.topGap,a=e.bottomGap;n-o-a<i||r<t+o?window.scrollBy(0,r-(t+o)):t+n-a<r+i&&window.scrollBy(0,r+i-(t+n-a))}function Ra(e,t){var n=window._currentViewHeight||window.innerHeight||document.documentElement.clientHeight,r=window.scrollY,i=t.getOuterContainer().offsetTop,o={screenOffsetTop:r,screenHeight:n,targetOffsetTop:e.offsetTop+i,targetHeight:e.offsetHeight,topGap:100,bottomGap:50};t.eventEmitter.emitEvent("beforeScrollToRect",[o]),wa(o)}function Aa(e){var t=window._currentViewHeight||window.innerHeight||document.documentElement.clientHeight,n=window.scrollY,r=he()(e.getOuterContainer()).offset().top,i=e.selection.getCursorRect(),o={screenOffsetTop:n,screenHeight:t,targetOffsetTop:i.top+r,targetHeight:i.height,topGap:100,bottomGap:50};console.log(e),e.eventEmitter.emitEvent("beforeScrollToRect",[o]),wa(o)}function xa(e){e.log("scrollVerticallyToFirstRowInView begin");var t,n=+new Date,r=e.getRep().lines,i=window.scrollY,o=r.search(function(e){var t=e.getLineRect().top;return i<t}),a=r.atIndex(o).lineNode,s=window.getSelection();s&&((t=document.createRange()).setStart(a,0),t.setEnd(a,0),s.removeAllRanges(),s.addRange(t));var l=+new Date;e.log("scrollVerticallyToFirstRowInView : "+(l-n))}var Ma=Object.freeze({__proto__:null,fixView:ba,scrollToSelection:Ea,scrollSelectionIntoView:ka,scrollNodeVerticallyIntoView:Ca,handleVerticallyScrollModeNormal:Ia,getElementRelativeTop:Sa,handleVerticallyScrollModeOverFlowHidden:Ta,scrollToPositionOfSelection:Oa,scrollVerticallyByNodePosition:Ra,scrollVerticallyBySelectionPosition:Aa,scrollVerticallyToFirstRowInView:xa});function Na(){}var _a=new(Na.prototype.verifyConfig=function(e){var t=/((http|https|ftp):\/\/)/;if(!e.space||"string"!=typeof e.space||t.test(e.space))throw new Error("[DomainConfigHelper] space_api");if(!e.lark||"string"!=typeof e.lark||!t.test(e.lark))throw new Error("[DomainConfigHelper] downloadLark");if(!e.domainPool||!Array.isArray(e.domainPool)||e.domainPool.some(function(e){return t.test(e)}))throw new Error("[DomainConfigHelper] domainPool")},Na.prototype.extractConfig=function(e){return{space:Object(W.default)(e,"space_api")[0],lark:Object(W.default)(e,"urlMapper.downloadLark"),domainPool:Object(W.default)(e,"common.domainPool")}},Na.prototype.init=function(e){var t=this.extractConfig(e);this.verifyConfig(t),this.domains=t},Na.prototype.getDomains=function(){if(!this.domains)throw new Error("[DomainConfigHelper] ");return this.domains},Na);function La(){var e=window.getSelection();if(e){var t=e.anchorNode;if(Ce.firefox&&t)try{t.toString()}catch(e){return!0}return!1}}var Da=Object.freeze({__proto__:null,getPocketHtml:Ri,newTimeLimit:Ai,inEmbed:xi,cachedStrFunc:Mi,equalLineAndChars:Ni,isNodeElement:_i,isNodeText:Li,findParentNode:Di,isNodeComment:Bi,isSVG:Pi,isFakeText:Fi,isFakeNode:ji,className2Author:zi,contains:Hi,nodeMaxIndex:Ui,isBlockElement:Vi,isBlockContainer:Wi,nodeText:Ki,getFakeData:Zi,randomString:Gi,genGuid:qi,isWordChar:Ji,isLineChar:Yi,isSpaceChar:Qi,isStyleAttribute:Xi,binarySearchInfinite:$i,binarySearch:eo,now:to,defaultRegisterPlugin:no,hasIESelection:ro,nodeAttr:io,nodeTagName:oo,nodeNumChildren:ao,nodeProp:so,nodeChild:lo,nodeValue:co,formatInitialObj:uo,getScrollBarWidth:fo,px2pt:ho,parseFont:vo,isBold:mo,createCustomEvent:yo,selectAll:bo,handleScroll:Eo,safeGetRangeAt:ko,completelyDelRangeContents:Co,getElementClass:Io,classDesensitize:So,richTextSanitize:To,isHTMLElement:Oo,ADIT_INACTIVE_CLS:wo,isNodeChildrenActive:Ro,deactivateNodeChildren:Ao,activateNodeChildren:xo,getFakeTextNodeFromFocus:Mo,getFakeTextNodeFromNextSibling:No,isAroundByFakeText:_o,getFakeTextLength:Lo,getFirstChildWithoutPocket:Do,isPocket:Bo,getOffsetTop:Po,sequencesToRanges:oa,rangesHasIntersection:aa,splitArray:sa,getMentionInfoFromAttribs:xr,getAttrib:Mr,getAlinesByAttributedText:Nr,getChangesetBetweenRepAndAText:_r,getAllAttribKeysFromAline:Lr,getAttributesArray:Dr,getAttributesMap:Br,getTextAndAttrsOnSelection:Pr,toMainZoneSplices:Fr,domainConfigHelper:_a,checkNodeUnavailableInFirefox:La}),Ba=1e3,Pa=(Fa.prototype.initTracker=function(e,o){var a,s=this,l=this.emptyLineOutput();this.entries=e.map(function(e,t){var n=o(e),r=s.transition(l,n),i=!!l.renderCollapsed!==!!r.renderCollapsed;return r.startOfCollapseSection?a=t:i&&(a=Object(T.default)(a)?t:void 0),{input:n,output:l=r,dirty:!1,headerLineNum:a}})},Fa.prototype.splice=function(e,t,n){Array.prototype.splice.apply(this.entries,me([e,t],n));for(var r,i=Math.max(e-1,0),o=0<i?this.entries[e-1].output:this.emptyLineOutput(),a=i;a<this.entries.length;a++)if((o=this.transition(o,this.entries[a].input)).startOfCollapseSection?r=a:o.renderCollapsed&&Object(T.default)(r)?r=this.getNearestHeaderLineNum(a):o.renderCollapsed||Object(T.default)(r)||(r=void 0),this.outputsEqual(o,this.entries[a].output)){if(e<=a){var s=this.entries[a].headerLineNum;if(o.renderCollapsed&&s!==r){this.entries[a].headerLineNum=r;continue}break}i++}else this.entries[a].output=o,this.entries[a].dirty=!0,this.entries[a].headerLineNum=r;var l=n.length-t;if(0!==l)for(var c=a;c<this.entries.length;c++){var u=this.entries[c];u&&!Object(T.default)(u.headerLineNum)&&r!==u.headerLineNum&&(u.headerLineNum+=l)}var d=a-i,f=n.length-t,h=a-f,p=[],g=[];for(a=0;a<this.dirtyRangeStarts.length;a++)this.dirtyRangeStarts[a]<i?p.push(this.dirtyRangeStarts[a]):(this.dirtyRangeStarts[a]>h||this.dirtyRangeStarts[a]===h&&0===d&&(0===i||!this.entries[i-1].dirty))&&g.push(this.dirtyRangeStarts[a]+f);0!==d&&(this.dirtyRangeStarts=0<p.length&&this.entries[i-1].dirty?me(p,g):me(p,[i],g))},Fa.prototype.markClean=function(e){if(this.entries[e].dirty){this.entries[e].dirty=!1;var t=0<e&&this.entries[e-1].dirty,n=e<this.entries.length-1&&this.entries[e+1].dirty;if(t){if(n){for(var r=void 0,r=0;r+1<this.dirtyRangeStarts.length&&this.dirtyRangeStarts[r+1]<e;)r++;this.dirtyRangeStarts.splice(r+1,0,e+1)}}else{var i=this.dirtyRangeStarts.indexOf(e);n?this.dirtyRangeStarts[i]++:this.dirtyRangeStarts.splice(i,1)}}},Fa.prototype.getAllDirtyLines=function(){var n=this,r=[];return this.dirtyRangeStarts.forEach(function(e){for(var t=e;t<n.entries.length&&n.entries[t].dirty;t++)r.push({lineNum:t,output:n.entries[t].output})}),r},Fa.prototype.hasAnyDirtyLines=function(){return 0<this.dirtyRangeStarts.length},Fa.prototype.get=function(e){return this.entries[e].output},Fa.prototype.defaultLine1Input=function(){return{headingLevel:Ba,hasCollapsedAttrForMe:!1}},Fa.prototype.transition=function(e,t){return e.renderCollapsed&&e.collapsedHeadingLevel<t.headingLevel?{collapsedHeadingLevel:e.collapsedHeadingLevel,startOfCollapseSection:!1,renderCollapsed:!0}:{collapsedHeadingLevel:t.headingLevel,startOfCollapseSection:t.hasCollapsedAttrForMe,renderCollapsed:t.hasCollapsedAttrForMe}},Fa.prototype.outputsEqual=function(e,t){return e&&t&&e.collapsedHeadingLevel===t.collapsedHeadingLevel&&e.renderCollapsed===t.renderCollapsed&&e.startOfCollapseSection===t.startOfCollapseSection},Fa.prototype.emptyLineOutput=function(){return{collapsedHeadingLevel:Ba,startOfCollapseSection:!1,renderCollapsed:!1}},Fa.prototype.getNearestHeaderLineNum=function(e){for(;0<e--;){var t=this.entries[e].headerLineNum;if(!Object(T.default)(t))return t}return 0},Fa);function Fa(){this.entries=[{input:this.defaultLine1Input(),output:this.transition(this.emptyLineOutput(),this.defaultLine1Input()),dirty:!1,headerLineNum:0}],this.dirtyRangeStarts=[]}function ja(e,t){if(null==t&&(t=e||Math.pow(2,32),e=0),"number"!=typeof e)throw new Error("invalid arguments to getRandomInt: "+e+", "+t);return Math.floor(za()*(t-e))+e}function za(){return window.crypto&&window.crypto.getRandomValues?window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967296:Math.random()}function Ha(e){for(var t="",n=0;n<e;n++)t+=ja(10);return t}function Ua(){return Ha(24)}var Va={gallery:{lineLevel:!0,dynamic:!0},aceTable:{lineLevel:!0,dynamic:!0},collectionHeader:{lineLevel:!0,dynamic:!0},collectionBoard:{lineLevel:!0,dynamic:!0},hr:{lineLevel:!0,dynamic:!1},latex:{lineLevel:!1,dynamic:!0},customEmoji:{lineLevel:!1,dynamic:!1}},Wa=["gallery","collectionHeader","aceTable","collectionBoard","newZone"];function Ka(e,t,n,r){if(r.isEnabled){var i=r.getClassById(e);if(null!==i)return r.getDataFromAttributes(i,t)}switch(e){case"aceTable":return Za(t);case"latex":return $a(t);case"collectionHeader":return Qa(t);case"collectionBoard":return Xa(t);default:throw new Error("unknown dynamic-object type: "+e)}}function Za(e){var t=e.aceTable.split(" ");if(2!==t.length)throw new Error("value '"+t+"' of aceTable attribute is invalid");return{rowsZoneId:t[0],colsZoneId:t[1],fullWidth:e.fullWidth}}var Ga=function(e){try{var t=JSON.parse(e);return{url:String(t.url),tags:String(t.tags)}}catch(e){return null}},qa={bgImg:"chbgimg",message:"chmessage",logo:"chlogo",chtitle:"chtitle"},Ja=3,Ya=function(e){var t=[{items:[]}];return e.items.forEach(function(e){t[t.length-1].items.length>=Ja&&t.push({items:[]}),t[t.length-1].items.push(e)}),t};function Qa(e){return JSON.parse(e.collectionHeader)}function Xa(e){return JSON.parse(e.collectionBoard)}function $a(e){return{latex:e.latex||""}}var es=function(e,t){var n=e?"live-sticker":"sticker",r={items:[{type:n,url:t}]};return[["magicObject","gallery"],["gallery",JSON.stringify(r)],[n,t]]};function ts(e,t){return"doc"}function ns(e){return[["magicObject","mention"],["mentioncreated",(new Date).toString()],["mentionspecial",e],["mentiontext",ts()],["usuallyUniqueId",Os()]]}function rs(e,t){return[["magicObject","mention"],["mentionpadid",e],["mentiontext",t],["usuallyUniqueId",Os()]]}function is(e,t){return[["magicObject","mention"],["mentionfolderid",e],["mentiontext",t],["usuallyUniqueId",Os()]]}var os=["img","embed","hr","aceTable","gallery"].slice(0);os.push("list");var as={};function ss(e,t,n){if(!n){var r=Object(F.attribsAttributeValue)(e,"list",t);if(r)return{key:"list",value:r}}var i=Object(F.attribsAttributeValue)(e,"aceTable",t);if(i)return{key:"aceTable",value:i};var o=Object(F.attribsAttributeValue)(e,"zoneId",t);return o?{key:"newZone",value:o}:null}function ls(e,t,n){var r=ss(e,t,!0);if(r&&-1!==Wa.indexOf(r.key))return{key:r.key,value:r.value};if(n.isEnabled){var i=Object(F.attribsAttributeValue)(e,"magicObject",t);if(i&&n.hasContentType(i))return{key:i,value:Object(F.attribsAttributeValue)(e,i,t)}}return null}function cs(e,t){var n=Object(F.attribsAttributeValue)(e,"heading",t);return n?{key:"list",value:n}:null}os.forEach(function(e){as[e]=!0});var us=function(e){return!!as[e]},ds=function(e,t){return!!ss(e,t)};function fs(e,t){return!!ss(e,t,!0)}function hs(e,t){var n=Object(F.opIterator)(e);return n.hasNext()?Ut(n.next(),"list",t):""}function ps(e,t){return!!Object(F.attribsAttributeValue)(e.attribs,"list",t)}function gs(e,t){for(var n=Object(F.opIterator)(e),r=Object(F.smartOpAssembler)();n.hasNext();){var i=n.next();Object(F.attribsAttributeValue)(i.attribs,"list",t)||r.append(i)}return Za.toString()}function vs(e,t,n){if(hs(t,n)){for(var r=Object(F.opIterator)(t),i=Object(F.stringIterator)(e);r.hasNext();){var o=r.next();Ut(o,"list",n)?i.skip(o.chars):i.take(o.chars)}return Za}return e}function ms(e,t,n,r){if(!ys(0,t,n,r))return null;var i=n.alines[t];if(i){var o=Object(F.opIterator)(i);if(o.hasNext())return ss(o.next().attribs,r,!0)}return null}function ys(e,t,n,r){if("*"!==n.lines.atIndex(t).text)return!1;var i=n.alines[t];if(i){var o=Object(F.opIterator)(i);if(o.hasNext())return fs(o.next().attribs,r)}return!1}function bs(e){var t=new RegExp("([a-z]+)([12345678])").exec(e);return t?{type:t[1],indent:Number(t[2])}:null}var Es=function(e){return"bullet"===e||"number"===e||"task"===e||"taskdone"===e};function ks(e){return"hone"===e||"htwo"===e||"hthree"===e}function Cs(e){var t=bs(e);return t&&ks(t.type)}function Is(e,t,n){var r=Object(F.opIterator)(t);if(r.hasNext()){var i=r.next();if(Cs(i.getAttribute("list",n)))return!0;for(var o=i;!(o.chars<=o.lines)&&o.getAttribute("bold",n)&&r.hasNext();)o=r.next();return Qa}return!1}function Ss(e){var t=bs(e);return t&&Ts(t.type)}function Ts(e){return"task"===e||"taskdone"===e}function Os(){return Ua()}var ws=Object.freeze({__proto__:null,MAGIC_OBJECTS:Va,getDynamicObjectData:Ka,getDynamicObjectAceTableData:Za,getCustomEmojiData:Ga,COLLECTION_HEADER_ZONES:qa,MAX_GALLERY_ITEMS_PER_ROW:Ja,splitMultirowGallery:Ya,getDynamicObjectCollectionHeaderData:Qa,getDynamicObjectCollectionBoard:Xa,getDynamicObjectLatexData:$a,getGalleryAttributesForSticker:es,getSpecialTargetDisplayName:ts,getMentionAttributesForSpecialTarget:ns,getMentionAttributesForPad:rs,getMentionAttributesForFolder:is,getLineLevelObjectOrList:ss,getLineManager:ls,getListMagicObject:cs,isMagicKey:us,hasLineLevelObjectOrList:ds,hasLineLevelMagicObject:fs,getLineMarker:hs,isOpLineMarker:ps,stripLineMarker:gs,stripLineMarkerFromText:vs,lineGetLineLevelObject:ms,lineHasLineLevelObject:ys,parseListType:bs,isListyListTypeByParsedType:Es,isHeaderListTypeByParsedType:ks,isHeaderListTypeByFullType:Cs,isHeader:Is,isTaskListTypeByFullType:Ss,isTaskListTypeByParsedType:Ts,generateUniqueId:Os});function Rs(e,t){var n=Object(F.attribsAttributeValue)(e,"clientside-collapse",t);return"true"===n||"false"!==n&&"true"===Object(F.attribsAttributeValue)(e,"collapse",t)}var As="ace-line-collapsed",xs=(Ms.prototype.getCollapsedStatusOfLine=function(e,t){var n=this.editor,r=this.trackers&&this.trackers[Vo.ROOT_ZONE],i=n&&n.getLineNumInRootZone(e,t);if(null==i||null==r)return null;var o=r.entries[i];if(!o)return null;var a=o.output;return{zoneId:e,lineNum:t,renderCollapsed:a.renderCollapsed,startOfCollapseSection:a.startOfCollapseSection,headerLineNum:o.headerLineNum}},Ms.prototype.getCollapsedStatusOfSelection=function(e){var t=this,n=e.selZone,r=e.selStart,i=e.selEnd,o=ve(r,1)[0],a=ve(i,1)[0];return Object(M.a)(o,a+1).map(function(e){return t.getCollapsedStatusOfLine(n,e)})},Ms.prototype.initTracker=function(e,t){var n=this.tracker(e);n&&n.initTracker(t,this.alineToLineInput.bind(this))},Ms.prototype.setEditor=function(e){this.editor=e},Ms.prototype.tracker=function(e){return this.trackers?(this.trackers[e]||(this.trackers[e]=new Pa),this.trackers[e]):null},Ms.prototype.splice=function(e,t,n,r){var i=this,o=this.tracker(e);o&&o.splice(t,n,r.map(function(e){return{input:i.alineToLineInput(e),output:null,dirty:!0}})),o&&o.hasAnyDirtyLines()?this.dirtyZones.set(e,!0):this.dirtyZones.delete(e)},Ms.prototype.getLineOutput=function(e,t){},Ms.prototype.markClean=function(e,t){var n=this.tracker(e);n&&(n.markClean(t),n.hasAnyDirtyLines()||this.dirtyZones.delete(e))},Ms.prototype.doUpdate=function(e){var r=this,t=this,i=t.editor,n=t.trackers;if(i&&n){var o=n[Vo.ROOT_ZONE].getAllDirtyLines();if(!e){if(!(0,i.callStack.getCurrentCallStack)().domClean)throw new Error("CollapsedLines: DOM must be clean for doUpdate()");i.getObserver().withoutRecordingMutations(function(){var e=r.dirtyZones.get(Vo.ROOT_ZONE),t=i.dom.rootNodeOfZone(Vo.ROOT_ZONE),n={isDirtyZone:e,dirtyLines:o,root:t,isCollapsed:!(!o[0]||!o[0].output.renderCollapsed)};i.hooks.callAll("lineTrackerUpdate",n),i.eventEmitter.trigger("lineTrackerUpdate",[n])})}o.forEach(function(e){r.markClean(Vo.ROOT_ZONE,e.lineNum)}),this.dirtyZones=new Map}},Ms.prototype.alineToLineInput=function(e){var t={headingLevel:Ba,hasCollapsedAttrForMe:!1},n=cs(e,this.pool);return n&&this.editor&&this.editor.hooks?{headingLevel:this.editor.hooks.callAll("alineToLineInput",n).pop()||Ba,hasCollapsedAttrForMe:this.pool&&Rs(e,this.pool)}:t},Ms.prototype.destroy=function(){this.editor=null,this.pool=null,this.trackers=null,this.dirtyZones=new Map},Ms);function Ms(e,t){var n=this;this.isLineNodeCollapsed=function(e){if(!n.editor)return!1;var t=n.editor.getRep(sr).lines.atIndex(e);return t&&t.lineNode.classList.contains(As)},this.trackers={},this.dirtyZones=new Map,this.editor=e,this.pool=t}var Ns="asyncNodeWillUpdate",_s="asyncNodeDidUpdate",Ls="asyncNodeWillShowLoadingEvent",Ds="asyncNodeDidShowLoadingEvent",Bs="editorWillPerformChangeset",Ps="editorDidPerformChangeset",Fs=2e3,js="ACE_TABLE",zs="ace-line-collapsed",Hs=(Us.prototype.ensureScreenNoScroll=function(n,r,e){var i=this;this.editor.observer.withoutRecordingMutations(function(){var e=i.computeLineHeightInfo(n);r();var t=i.computeLineHeightInfo(n);i.updatePlaceholderHeightAndForceHide(t),i.updateScrollTop(e,t)})},Us.prototype.updateScrollTop=function(e,t){var n,r=e[e.length-1],i=t[t.length-1],o=r.scrollTop;r.shouldIgnore||(n=i.scrollHeight-r.scrollHeight,this.scrollContainer instanceof Window?window.scrollTo(this.scrollContainer.scrollX,o):this.scrollContainer.scrollTop=o+n)},Us.prototype.isLineEntryValid=function(e){var t=this.editor.getRep(Kr).lines;return e&&t.atKey(e.key)},Us.prototype.parseSpliceArgsFromChangeset=function(e){var u=this;return this.editor.changesetHelper.toLineSplices(e).reduce(function(e,t){var n=ve(t,4),r=n[0],i=n[1],o=n[2],a=n[3];if(a===Kr)return e.push({startIndex:r,deleteCount:i,addCount:o,zoneId:a}),e;var s=u.editor.getRep(Kr).lines,l=u.editor.managers.zoneToLineEntry[a];if(!l)return e;if(!s.containsKey(l.key))return e;var c=s.indexOfEntry(l);return e.some(function(e){var t=e.startIndex,n=e.deleteCount;return t<=c&&c<=t+n})||e.push({startIndex:c,deleteCount:1,addCount:1,zoneId:Kr}),e},[])},Us.prototype.markUpdateRectZoneAndActivate=function(e){var r=this.editor.managers,i=!1;return this.editor.observer.withoutRecordingMutations(function(){e.forEach(function(e){var t,n=r.getLineEntryContainingZone(e.zone)||e;n.shouldHandleZoneRect()&&(!(t=n.lineNode)||Ro(t)||n.isActive||(t.style.height="",t.style.margin="",xo(t)),n.needUpdateZoneRect=!0,i=!0)})}),i},Us.prototype.doUpdateRectZone=function(e){var r=!1,i=this.editor.managers;return this.editor.observer.withoutRecordingMutations(function(){e.forEach(function(e,t){var n=i.getLineEntryContainingZone(e.zone)||e;n.shouldHandleZoneRect()&&(n.updateZoneRectIfNecessary(),r=!0)})}),r},Us.prototype.doUpdateRectZoneAndDeactivate=function(e){var o=!1,a=this.editor.managers,s=this.computeLineHeightInfo(e);return this.editor.observer.withoutRecordingMutations(function(){e.forEach(function(e,t){var n,r=s[t],i=a.getLineEntryContainingZone(e.zone)||e;i.shouldHandleZoneRect()&&(i.updateZoneRectIfNecessary(),(n=i.lineNode)&&r&&Ro(n)&&i.isActive,o=!0)})}),o},Us.prototype.bindEvents=function(){this.editor.on(Ns,this.handleAsyncNodeWillUpdate),this.editor.on(_s,this.handleAsyncNodeDidUpdate),this.editor.on(Bs,this.editorWillPerformChangeset),this.editor.on(Ps,this.editorDidPerformChangeset),this.editor.on("aceEditEvent",this.handleEditEvent)},Us.prototype.unbindEvents=function(){this.editor.off(Ns,this.handleAsyncNodeWillUpdate),this.editor.off(_s,this.handleAsyncNodeDidUpdate),this.editor.off(Bs,this.editorWillPerformChangeset),this.editor.off(Ps,this.editorDidPerformChangeset),this.editor.off("aceEditEvent",this.handleEditEvent)},Us.prototype.destroy=function(){this.unbindEvents()},Us);function Us(e){var u=this;this.editor=e,this.asyncNodeKeyToInfoMap=new Map,this.asyncNodeKeyToNumberMap=new Map,this.asyncNodeKeyToTimerMap=new Map,this.csToHeightContextMap=new Map,this.cacheTopmostLine=null,this.getLineNodeInPreRenderer=function(e){var t=u.editor.getRep(Kr).lines.atIndex(e);return t?t.lineNode:null},this.computeLineHeightInfo=function(e){e=e.map(function(e){return e.zone===Kr?e:u.editor.managers.zoneToLineEntry[e.zone]});var n=u.editor.getRep(Kr).lines,t=e.every(function(e){return n.atKey(e.key)}),r={marginTop:"0px",margin:"0",height:va(u.editor)};if(!t)return[];if(e.length){var i=u.getTopmostElementIndexInViewport(),o=e.some(function(e){return n.indexOfEntry(e)>=i}),a=u.scrollContainer instanceof Window?window.scrollY:u.scrollContainer.scrollTop,s=u.editor.getDocBody().scrollHeight;return e.map(function(e){var t=e.lineNode&&!e.lineNode.className.includes(zs)&&u.editor.blockRender.getLineStatus(e.zone,n.indexOfEntry(e)).isRendered?getComputedStyle(e.lineNode):r;return{marginTop:t.marginTop,margin:t.margin,height:t.height,offsetTop:e.lineNode.offsetTop*(e.zoom||1),entry:e,scrollTop:a,scrollHeight:s,shouldIgnore:o}})}return[u.createEmptyInfo()]},this.updatePlaceholderHeightAndForceHide=function(e){e.map(function(e){return e.entry}).filter(function(e){return 0<e.asyncNodeNum}).forEach(function(e){return u.recordAsyncNodeHeight(e)}),u.editor.observer.withoutRecordingMutations(function(){e.forEach(function(e){var t=u.getRootZoneEntryLineStatus(e.entry);t&&t.isActive||(e.entry.lineNode.style.height=e.height||"",e.entry.lineNode.style.margin=e.margin||"")}),u.setDisplayNone(e.map(function(e){return e.entry}))})},this.getTopmostElementIndexInViewport=function(){if(null!==u.cacheTopmostLine&&u.editor.isPerforming)return u.cacheTopmostLine;for(var e=null,t=u.editor.getRep(Kr).lines,n=u.editor.blockRender.getViewportCenterLine(),e=t.atIndex(n)||null,r=u.scrollContainer instanceof Window?window.scrollY:u.scrollContainer.scrollTop,i=u.editor.lineTracker.collapseLines,o=n,a=u.editor.blockRender.getOffsetTopToScroller();e&&(e.isActive&&e.lineNode.offsetTop*(e.zoom||1)+a>r||i&&i.isLineNodeCollapsed(o));)o--,e=t.prev(e);return u.cacheTopmostLine=Math.max(o,0),u.cacheTopmostLine},this.createEmptyInfo=function(){var e=u.scrollContainer instanceof Window?window.scrollY:u.scrollContainer.scrollTop,t=u.editor.getDocBody().scrollHeight;return{marginTop:"",margin:"",height:"",offsetTop:0,entry:u.editor.createDomLineEntry("","",{zone:Kr}),scrollTop:e,scrollHeight:t,isFakeInfo:!0,shouldIgnore:!1}},this.setDisplayNone=function(e){var t=e.filter(function(e){return e.asyncNodeNum||e.getInstanceByName(js)}),n=e.filter(function(e){return!e.asyncNodeNum&&!e.getInstanceByName(js)});u.editor.observer.withoutRecordingMutations(function(){n.forEach(function(e){e.isActive||u.updateChildDisplayStatus(e,!1)})}),t.forEach(function(e){var t=window.setTimeout(function(){u.asyncNodeKeyToTimerMap.delete(e.key),u.isLineEntryValid(e)&&(u.getRootZoneEntryLineStatus(e).isActive||u.editor.observer.withoutRecordingMutations(function(){u.updateChildDisplayStatus(e,!1)}))},Fs);u.asyncNodeKeyToTimerMap.has(e.key)&&window.clearTimeout(u.asyncNodeKeyToTimerMap.get(e.key)),u.asyncNodeKeyToTimerMap.set(e.key,t)})},this.getRootZoneEntryLineStatus=function(e){var t=u.editor.getRep(Kr).lines.indexOfKey(e.key);return u.editor.blockRender.getLineStatus(Kr,t)},this.updateChildDisplayStatus=function(e,t){},this.ensureEntryHasDisplay=function(e){u.editor.observer.withoutRecordingMutations(function(){u.updateChildDisplayStatus(e,!0),e.lineNode.style.height="",e.lineNode.style.margin=""})},this.recordAsyncNodeHeight=function(e){u.ensureEntryHasDisplay(e),u.asyncNodeKeyToInfoMap.set(e.key,u.computeLineHeightInfo([e]))},this.handleAsyncNodeWillUpdate=function(e){var t,n=e.key,r=e.zoneId,i=r===Kr?u.editor.getRep(r).lines.atKey(n):u.editor.managers.zoneToLineEntry[r];i?(u.recordAsyncNodeHeight(i),u.asyncNodeKeyToNumberMap.has(i.key)?(t=u.asyncNodeKeyToNumberMap.get(i.key),u.asyncNodeKeyToNumberMap.set(i.key,t+1)):u.asyncNodeKeyToNumberMap.set(i.key,i.asyncNodeNum)):console.error("handleAsyncNodeWillUpdate in preRender receives key does not exsist")},this.handleAsyncNodeDidUpdate=function(e){var o=e.key,t=e.zoneId,n=t===Kr?u.editor.getRep(t).lines.atKey(o):u.editor.managers.zoneToLineEntry[t];if(n&&u.asyncNodeKeyToNumberMap.has(n.key)){u.ensureEntryHasDisplay(n);var a=u.checkIfShouldIgnore(n);if(u.asyncNodeKeyToInfoMap.forEach(function(e,t){var n,r,i;t!==o&&(n=e[0],i=(r=u.editor.getDocBody().scrollHeight)-n.scrollHeight,a||(n.scrollTop+=i),n.scrollHeight=r)}),a&&n.isActive)return u.asyncNodeKeyToInfoMap.delete(n.key),u.asyncNodeKeyToNumberMap.delete(n.key),void u.asyncNodeKeyToTimerMap.delete(n.key);var r,i,s=u.asyncNodeKeyToNumberMap.get(n.key);s===n.asyncNodeNum?(u.ensureEntryHasDisplay(n),t!==Kr&&(u.markUpdateRectZoneAndActivate([n]),u.doUpdateRectZone([n])),r=u.asyncNodeKeyToInfoMap.get(n.key),i=u.computeLineHeightInfo([n]),u.updatePlaceholderHeightAndForceHide(i),u.updateScrollTop(r,i),u.asyncNodeKeyToInfoMap.delete(n.key),u.asyncNodeKeyToNumberMap.delete(n.key)):u.asyncNodeKeyToNumberMap.set(n.key,s-1)}},this.checkIfShouldIgnore=function(e){if(!u.isLineEntryValid(e))return!0;var t=u.getTopmostElementIndexInViewport();return u.editor.getRep(Kr).lines.indexOfEntry(e)>=t},this.editorWillPerformChangeset=function(e){var t,c,n,r=e.cs;u.editor.blockRender.getUsageState()&&((t=u.parseSpliceArgsFromChangeset(r)).length<=0||(c=u.getTopmostElementIndexInViewport(),n=t.map(function(e){var t=e.zoneId,n=e.startIndex,r=e.deleteCount,i=r-1<0?0:r-1,o=c<=n+i,a=n+i>=u.editor.blockRender.getCurrentBufferRange()[1],s=u.editor.getRep(t).lines.slice(n,n+r).filter(function(e){return!!e}),l=o?void 0:u.computeLineHeightInfo(s);return o&&n<c&&(u.cacheTopmostLine=null),{heightInfo:l,spliceArgs:e,isViewportAffected:o,bufferEndAffected:a}}),u.csToHeightContextMap.set(r,n)))},this.editorDidPerformChangeset=function(e){var t=e.cs,n=u.csToHeightContextMap.get(t);n&&(u.csToHeightContextMap.delete(t),n.forEach(function(e){var t,n=e.heightInfo,r=e.spliceArgs,i=e.isViewportAffected,o=e.bufferEndAffected,a=r.zoneId,s=r.startIndex,l=r.addCount,c=u.editor.getRep(a).lines.slice(s,s+l).filter(function(e){return!!e});u.markUpdateRectZoneAndActivate(c),u.doUpdateRectZone(c),!i&&n?(t=u.computeLineHeightInfo(c),u.updatePlaceholderHeightAndForceHide(t),u.updateScrollTop(n,t)):i&&!o||(t=u.computeLineHeightInfo(c),u.updatePlaceholderHeightAndForceHide(t))}))},this.handleEditEvent=function(){u.cacheTopmostLine=null},this.editor=e,this.scrollContainer=e.getScrollContainer()||window,this.asyncNodeKeyToNumberMap=new Map,this.bindEvents()}var Vs={instanceName:"hackKeepRetainInstance",shouldRetain:!0,displayType:da.Inline},Ws=(Object.defineProperty(Ks.prototype,"shouldLockViewport",{get:function(){if(Ce.isChrome&&84<=parseInt(String(Ce.version),10)){var e=document.activeElement===this.editor.docbody;return!(this.isSupportOverflowAnchor&&!e)}return!this.isSupportOverflowAnchor},enumerable:!0,configurable:!0}),Ks.prototype.bindEvents=function(){this.editor.on(Bs,this.editorWillPerformChangeset),this.editor.on(Ps,this.editorDidPerformChangeset),this.editor.on($s,this.preRendererAsyncNodeDidUpdate),this.editor.on("aceEditEvent",this.handleEditEvent),this.editor.eventEmitter.on("editorSizeChange",this.handleResize)},Ks.prototype.unbindEvents=function(){this.editor.off(Bs,this.editorWillPerformChangeset),this.editor.off(Ps,this.editorDidPerformChangeset),this.editor.off($s,this.preRendererAsyncNodeDidUpdate),this.editor.off("aceEditEvent",this.handleEditEvent),this.editor.eventEmitter.off("editorSizeChange",this.handleResize)},Ks.prototype.recordViewport=function(){var e,t,n;this.shouldLockViewport&&(e=this.getViewportTopLine(),t=this.preRenderer.getLayoutForLine(Kr,e),n=this.editor.getRep(Kr).lines.atIndex(e),t&&n&&(this.context={viewportInfo:{key:n.key,top:t.top,scrollTop:this.editor.getScrollTop()},callStack:this.editor.getCurrentCallStack()}))},Ks.prototype.updateViewport=function(){var e,t,n,r,i,o,a,s;this.shouldLockViewport&&this.context&&this.context.viewportInfo&&(t=(e=this.context.viewportInfo).key,n=e.top,r=e.scrollTop,i=this.editor.getRep(Kr).lines.indexOfKey(t),!(o=this.preRenderer.getLayoutForLine(Kr,i))||0!==(a=o.top-n)&&(s=r+a,this.updateScrollTop(s))),this.context=null},Ks.prototype.updateScrollTop=function(e,t){var n;void 0===t&&(t=!1),!t&&this.editor.blockRender.isScrolling()||((n=this.editor.getScrollContainer())instanceof Window?window.scrollTo(n.scrollX,e):n.scrollTop=e)},Ks.prototype.addTableLineToContext=function(e){var t;this.context&&((t=this.context.tablesNeedSync||[]).push(e),this.context.tablesNeedSync=t)},Ks.prototype.updateZoneRectInRanges=function(e,t){var n,r,i,o;if(void 0===t&&(t=Kr),0!==e.length){t!==Kr&&(i=e[0][0],e=[[o=this.editor.getLineNumInRootZone(t,i),o]]);try{for(var a=ge(e),s=a.next();!s.done;s=a.next()){var l=ve(s.value,2),c=l[0],u=l[1];if(!(c<0||u<0||u<c))for(var d=c;d<=u;d++){var f=this.editor.getRep(Kr).lines.atIndex(d);f&&f.shouldHandleZoneRect()&&f.updateZoneRectIfNecessary()}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}},Ks.prototype.lockViewportByMainDoc=function(e,t){void 0===t&&(t=!1);var n,r,i,o,a=this.editor.getScrollTop()||0,s=this.getViewportTopLine(),l=this.editor.getRep(Kr).lines.atIndex(s);l&&l.lineNode?(n=l.lineNode.offsetTop,r=l.getAllInstances(),(i=!(l.shouldKeepActive||l.shouldRetain))&&(r.length?r[0].shouldRetain=!0:l.registerInstance(Vs)),e(),i&&(r.length?r[0].shouldRetain=!1:l.unregisterInstance(Vs)),0!==(o=l.lineNode.offsetTop-n)&&this.updateScrollTop(a+o,t)):e()},Ks.prototype.ensureScreenNoScroll=function(e,t){var n=this;void 0===t&&(t=!1),this.editor.observer.withoutRecordingMutations(function(){n.lockViewportByMainDoc(e,t)})},Ks.prototype.getViewportTopLine=function(){var e=this.preRenderer.blockRender.getViewportLines()[Kr]||[];return e.length?Math.min.apply(Math,me(e)):0},Ks.prototype.getViewportBottomLine=function(){var e=this.preRenderer.blockRender.getViewportLines()[Kr]||[];return e.length?Math.max.apply(Math,me(e)):0},Ks.prototype.getViewportRange=function(){return[this.getViewportTopLine(),this.getViewportBottomLine()]},Ks.prototype.destroy=function(){this.unbindEvents()},Ks);function Ks(e,t){var u=this;this.editor=e,this.preRenderer=t,this.context=null,this.isSupportOverflowAnchor=!0,this.handleResize=Object(y.default)(function(e){var t,n=e.prev,r=e.next;Math.abs(n.width-r.width)<10||(t=u.getViewportTopLine(),u.ensureScreenNoScroll(function(){u.preRenderer.syncLines(Kr,0,t),u.editor.getRep(Kr).lines.traverseEntries(0,t,function(e){var t=e.lineNode;t&&(t.style.height="",t.style.margin="",xo(t))})}))},200),this.preRendererAsyncNodeDidUpdate=function(e){var t,n,r,i,o,a=e.lineEntry,s=e.lineNum,l=e.heightChanged,c=e.zoneId;u.shouldLockViewport?c===Kr&&(t=u.preRenderer.getLayoutForLine(c,s),n=u.editor.getScrollTop()||0,r=u.editor.blockRender.getOffsetTopToScroller(),i=t.top+t.height+r<n,o=a.isActive||a.isRetained,i&&0!==l&&(o?u.updateScrollTop(n+l):u.lockViewportByMainDoc(function(){u.preRenderer.blockRender.updatePlaceholder()})),setTimeout(function(){u.lockViewportByMainDoc(function(){var e=u.preRenderer.blockRender,t=e.getViewportCenterLine();e.updateActivation({centerLine:t})})})):0!==l&&setTimeout(function(){var e=u.preRenderer.blockRender,t=e.getViewportCenterLine();e.updateActivation({centerLine:t})})},this.editorWillPerformChangeset=function(e){var t,n,r,i,o,a=e.cs;u.shouldLockViewport&&(t=u.context,n=u.editor.getCurrentCallStack(),t&&t.callStack===n||(u.context={callStack:n},r=u.editor.changesetHelper.toLineSplices(a),i=Fr(u.editor,r),o=u.getViewportTopLine(),i.some(function(e){return e.startIndex+e.deleteCount<=o})&&u.recordViewport()))},this.editorDidPerformChangeset=function(){var e;((null===(e=u.context)||void 0===e?void 0:e.tablesNeedSync)||[]).forEach(function(e){u.preRenderer.syncLines(Kr,e,e)}),u.preRenderer.blockRender.updatePlaceholderIfNecessary()},this.handleEditEvent=function(){u.updateViewport()};var n=this.editor.getScrollContainer()||this.editor.docbody,r=n instanceof Window?this.editor.docbody:n,i=this.editor.getProps(),o=void 0!==i.isSupportOverflowAnchor?!!i.isSupportOverflowAnchor:"auto"===getComputedStyle(r).overflowAnchor;this.isSupportOverflowAnchor=o,this.bindEvents()}var Zs=(Gs.prototype.updateTasks=function(e,t){var n=this,r=this.impl.checkEqual||function(e,t){return e===t},i=e.map(function(e){return{data:e}});t.map(function(t){return n.tasks.find(function(e){return r(e.data,t)})}).filter(function(e){return!!e}).forEach(function(e){e.timer&&(clearTimeout(e.timer),e.timer=void 0,n.isRunning=!1),e.fiber&&(n.editor.fiber.cancelTask(e.fiber),e.fiber=void 0,n.isRunning=!1);var t=n.tasks.indexOf(e);-1!==t&&n.tasks.splice(t,1)}),i.forEach(function(e){n.tasks.push(e)}),this.tasks.length&&this.startTask()},Gs.prototype.startTask=function(){var t,e,n,r=this;0!==this.tasks.length&&(this.isRunning||(t=this.tasks[0])&&(e=function(){r.isRunning=!1,t.fiber=void 0,t.timer=void 0;var e=r.tasks.indexOf(t);-1!==e&&(r.tasks.splice(e,1),r.impl.execTask(t)),r.tasks.length&&r.startTask()},(n=this.impl.useTimeout&&this.impl.useTimeout(t))?t.timer=setTimeout(e,n):t.fiber=this.editor.fiber.scheduleTask(e)))},Gs.prototype.clearTasks=function(){var t=this;this.tasks.forEach(function(e){e.timer&&(clearTimeout(e.timer),e.timer=void 0,t.isRunning=!1),e.fiber&&(t.editor.fiber.cancelTask(e.fiber),e.fiber=void 0,t.isRunning=!1)}),this.tasks=[],this.isRunning=!1},Gs);function Gs(e,t){this.editor=e,this.impl=t,this.isRunning=!1,this.tasks=[]}var qs=(Js.prototype.destroy=function(){this.syncNodeTasks.clearTasks(),this.emptyNodeTasks.clearTasks(),this.unbindEvents()},Js.prototype.initTaskQueue=function(){var o=this;this.syncNodeTasks=new Zs(this.editor,{checkEqual:function(e,t){return e.node===t.node},execTask:function(e){var t=e.data,n=t.node,r=t.root,i=t.lineEntry;r.contains(n)&&i&&i.lineNode&&i.isRendered&&(i.isActive?(i.shouldHandleZoneRect()&&i.updateZoneRectIfNecessary(),o.syncNode(n,i.lineNode)):i.isRetained&&o.ensureLineNodeActive(i,function(){i.shouldHandleZoneRect()&&i.updateZoneRectIfNecessary(),o.syncNode(n,i.lineNode)}))},useTimeout:function(e){var t=e.data.lineEntry;return!t||nl.canRenderInPreRenderer(t)?0:2e3}}),this.emptyNodeTasks=new Zs(this.editor,{checkEqual:function(e,t){return e.node===t.node},execTask:function(e){var t=e.data,n=t.root,r=t.node;n.contains(r)&&o.emptyNode(r)}})},Js.prototype.bindEvents=function(){this.editor.on(Xs,this.handlePreRendererDidChanged)},Js.prototype.unbindEvents=function(){this.editor.off(Xs,this.handlePreRendererDidChanged)},Js.prototype.isNodeNeedSync=function(e,t){if(!t)return!1;var n=e[Ys]&&t.isRendered,r=t.isRetained;return n||r},Js.prototype.ensureLineNodeActive=function(t,n){this.preRenderer.ensureScreenNoScroll([],function(){var e;t&&t.lineNode&&(xo(t.lineNode),t.lineNode.style.height="",e=t.lineNode.offsetHeight,n(),Ao(t.lineNode),t.lineNode.style.height=e+"px")})},Js.prototype.syncNode=function(e,t){e.style.height=t.offsetHeight+"px",e[Ys]=void 0},Js.prototype.emptyNode=function(e){var t=e.offsetHeight;e.style.height=t+"px",e.innerHTML="",e[Qs]=void 0},Js);function Js(e,t){var f=this;this.editor=e,this.preRenderer=t,this.handlePreRendererDidChanged=function(e){var t=e.zoneId,n=f.preRenderer.getRootForZone(t),r=e.newNodes,i=e.oldNodes,o=e.lineEntries;if(n){if(t!==Kr){for(var a=f.preRenderer.getRootForZone(Kr),s=n;s&&s.parentElement!==a;)s=s.parentElement;if(!s)return;r=[s],i=[s],o=[f.editor.managers.zoneToLineEntry[o[0].zone]],n=a}var l=i.map(function(e,t){return{node:e,root:n,lineEntry:o[t]}}),c=r.map(function(e,t){return{node:e,root:n,lineEntry:o[t]}}).filter(function(e){return e.node[Qs]});f.emptyNodeTasks.updateTasks(c,l);var u=i.map(function(e,t){return{node:e,root:n,lineEntry:o[t]}}),d=r.map(function(e,t){return{node:e,root:n,lineEntry:o[t]}}).filter(function(e){var t=e.node,n=e.lineEntry;return f.isNodeNeedSync(t,n)});f.syncNodeTasks.updateTasks(d,u),o.forEach(function(e){e&&e.shouldHandleZoneRect()&&(e.needUpdateZoneRect=!0)})}},this.initTaskQueue(),this.bindEvents()}var Ys="need-sync",Qs="need-empty",Xs="preRendererDidChanged",$s="preRendererAsyncNodeDidUpdate",el={marginBottom:0,marginTop:0,height:0,top:0};function tl(){var t={id:"",dir:"",innerHTML:"",className:"",classList:{add:function(e){t.className.includes(e)||(t.className+=" "+e)}},style:{cssText:"",height:"",margin:""}};return t}var nl=(rl.filterNodeAttributes=function(e){0!==e.childElementCount&&this.attributeNotAllowList.forEach(function(t){e.querySelectorAll("["+t+"]").forEach(function(e){return e.removeAttribute(t)})})},rl.canRenderInPreRenderer=function(e){var t=!(!e||!e.getInstanceByName("ACE_TABLE")),n=!(!e||!e.getInstanceByName("IFRAME_BLOCK"));return!(t||n)},rl.syncContentToNode=function(e,t,n){void 0===n&&(n=!1);var r,i,o=t.lineNode,a=!!t.isRendered,s=!!t.isActive,l=t.shouldRetain;return l||!s?(r=this.canRenderInPreRenderer(t),i=s||t.isRetained,!r&&i?(e.style.height=n?"":o.offsetHeight+"px",e.style.margin="",e.innerHTML="",e[Qs]=!1):(a&&(e.innerHTML=o.innerHTML,e.style.cssText=o.style.cssText,e.style.height="",e.style.margin=""),e[Qs]=!l||!r)):(e.style.height=n?"":o.offsetHeight+"px",e.style.margin="",e.innerHTML="",e[Qs]=!1),e.className=o.className,o.id&&e.classList.add(o.id),e.id="",e.dir=o.dir,!!!e.innerHTML&&(n||!a&&!t.shouldIgnoreSync)?(n?(e.style.cssText=o.style.cssText,e.style.cssText||(e.style.height=va(t.getEditor()))):e.style.height=va(t.getEditor()),e[Ys]=!0):e[Ys]=!1,e},rl.createLines=function(e,r){var i=this;return void 0===r&&(r=!1),e.map(function(e){var t=document.createElement("div"),n=i.syncContentToNode(t,e,r);return xo(n),i.filterNodeAttributes(t),n})},rl.syncLines=function(e,t){for(var n=this,r=e.map(function(e){var t=tl();return n.syncContentToNode(t,e)}),i=0;i<r.length;++i){var o=r[i],a=t[i];this.syncNode(a,o),xo(a),this.filterNodeAttributes(a)}return t},rl.syncNode=function(e,t,n){void 0===n&&(n=!0),e.id=t.id,e.className=t.className,n&&(e.style.cssText=t.style.cssText,e.style.height=t.style.height),e.style.margin=t.style.margin,e.innerHTML!==t.innerHTML&&(e.innerHTML=t.innerHTML),e.setAttribute("dir",t.dir),e[Qs]=t[Qs],e[Ys]=t[Ys]},Object.defineProperty(rl.prototype,"blockRender",{get:function(){return this.editor.blockRender},enumerable:!0,configurable:!0}),rl.prototype.init=function(){this.initRoot(),this.bindEvents(),this.viewportStabilizer=new Ws(this.editor,this),this.emptyNodeProcessor=new qs(this.editor,this)},rl.prototype.destroy=function(){this.root&&this.root.remove(),this.unbindEvents(),this.viewportStabilizer.destroy(),this.emptyNodeProcessor.destroy(),this.updatePlaceholderTimer&&(clearTimeout(this.updatePlaceholderTimer),this.updatePlaceholderTimer=null)},rl.prototype.initRoot=function(){var e=document.createElement("div"),t=this.editor.docbody;t.className&&(e.className=t.className),e.classList.contains("reminder_enabled")||e.classList.add("reminder_enabled"),e.style.cssText="\n      display: block;\n      position: absolute;\n      width: 100%;\n      top: -10000px;\n      left: -10000px;\n      min-height: auto;\n      pointer-events: none;\n    "+(t.style.cssText||""),this.root=e;var n=this.editor.getRep(Kr),r=n.lines.slice(0,n.lines.length());this.spliceLines(0,0,r,Kr)},rl.prototype.bindEvents=function(){this.editor.hooks.plugins.unshift(this),this.editor.on(_s,this.asyncNodeDidUpdate),this.editor.on(Ns,this.asyncNodeWillUpdate),this.editor.on("tableDidRender",this.tableDidRender)},rl.prototype.insertRoot=function(e){var t=e.parentElement;t&&(e.nextSibling?t.insertBefore(this.root,e.nextSibling):t.appendChild(this.root))},rl.prototype.unbindEvents=function(){var e=this.editor.hooks.plugins.indexOf(this);-1!==e&&this.editor.hooks.plugins.splice(e,1),this.editor.off(_s,this.asyncNodeDidUpdate),this.editor.off(Ns,this.asyncNodeWillUpdate),this.editor.off("tableDidRender",this.tableDidRender)},rl.prototype.updateSyncBaseLine=function(){for(var e=-1,t=this.root.firstChild;t&&!t[Ys];)t=t.nextSibling,e++;this.syncBaseLine=e},rl.prototype.syncAsyncNode=function(e){var t,n,r,i=Kr,o=this.getRootForZone(i);!o||(t=this.editor.getRep(i).lines.atIndex(e))&&(n=o.offsetHeight,this.syncLines(Kr,e,e),r=o.offsetHeight-n,this.editor.call($s,{lineEntry:t,zoneId:i,lineNum:e,heightChanged:r}))},rl.prototype.updatePlaceholderAsync=function(){var e=this;this.updatePlaceholderTimer||(this.updatePlaceholderTimer=setTimeout(function(){e.updatePlaceholderTimer=null,e.ensureScreenNoScroll([],function(){e.blockRender.updatePlaceholder()})},100))},rl.prototype.isLineNeedSync=function(e){var t=this.getRootForZone(Kr).childNodes.item(e);return!t||t[Ys]},rl.prototype.syncLines=function(e,t,n){return this.syncRanges([[t,n]],e)},rl.prototype.syncRanges=function(e,t){var n,r;void 0===t&&(t=Kr);var i=this.editor.getRep(t),o=this.getRootForZone(t);if(!o)throw new Error("Try to sync lines in non-exist root");var a,s=i.lines.length(),l=[],c=[];try{for(var u=ge(e),d=u.next();!d.done;d=u.next())var f=d.value,h=Math.max(0,f[0]),p=Math.min(s-1,f[1]),g=i.lines.slice(h,p+1),v=Array.from(o.childNodes).slice(h,p+1),l=l.concat(g),c=c.concat(v)}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}l.length&&c.length&&(a=rl.syncLines(l,c),this.editor.call(Xs,{zoneId:t,oldNodes:c,newNodes:a,lineEntries:l}))},rl.prototype.renderLines=function(e,t,n,r){void 0===r&&(r=Kr);var i=this.getRootForZone(r);if(!i)throw new Error("Try to splice lines in non-exist root, zoneId: "+r);var o=Array.from(i.childNodes).slice(e,e+t),a=n.map(function(e){return e.domInfo}),s=i.childNodes.item(e-1),l=!0;this.editor.domLine.insertDomLines(r,s,a,null,o,l),this.spliceLines(e,t,n,r)},rl.prototype.spliceLines=function(e,t,n,r,i){void 0===r&&(r=Kr),void 0===i&&(i=!1);var o=this.getRootForZone(r);if(!o)throw new Error("Try to splice lines in non-exist root, zoneId: "+r);for(var a,s,l,c=rl.createLines(n,i),u=Array.from(o.childNodes).slice(e,e+t),d=[],f=[];this.enableReuseNode;){var h=c[0],p=u[0];if(!h||!p)break;if(h.childElementCount||p.childElementCount)break;rl.syncNode(p,h,!i),c.shift(),u.shift(),d.push(p),f.push(p)}c.length&&(a=c.reduce(function(e,t){return e.appendChild(t),e},document.createDocumentFragment()),s=e+d.length,(l=o.childNodes.item(s))?o.insertBefore(a,l):o.appendChild(a),d.push.apply(d,me(c))),u.length&&(u.forEach(function(e){return o.removeChild(e)}),f.push.apply(f,me(u))),i&&this.updateSyncBaseLine(),this.editor.call(Xs,{zoneId:r,oldNodes:f,newNodes:d,lineEntries:n})},rl.prototype.checkIfRangeSyncCompleted=function(e,t){return this.syncBaseLine>=e&&this.syncBaseLine>=t},rl.prototype.checkIfSyncCompleted=function(){var e=this.getRootForZone(Kr).childElementCount;return this.checkIfRangeSyncCompleted(0,e-1)},rl.prototype.checkIfLineNeedEmpty=function(e){var t=this.getRootForZone(Kr).childNodes.item(e);return!!t&&!!t[Qs]},rl.prototype.getRootForZone=function(e){return e===Kr?this.root:this.root.querySelector(".zoneId-"+e)},rl.prototype.getLayoutForNode=function(e){var t=this.root.contains(e)?this.root:this.editor.docbody.contains(e)?this.editor.docbody:null;if(!t)return el;var n=getComputedStyle(e);return{marginTop:parseInt(n.marginTop,10)||0,marginBottom:parseInt(n.marginBottom,10)||0,height:e.offsetHeight,top:e.parentNode===t?e.offsetTop:e.getBoundingClientRect().top-t.getBoundingClientRect().top}},rl.prototype.getLayoutForLine=function(e,t){if(e===Kr){var n=this.getRootForZone(e);if(!n)return el;if(!(y=n.childNodes.item(t)))return el;var r=this.editor.getRep(e),i=r.lines.atIndex(t);if(!i||!i.lineNode)return el;if(i.isActive)return this.getLayoutForNode(i.lineNode);if(this.checkIfSyncCompleted())return this.getLayoutForNode(y);if(this.checkIfRangeSyncCompleted(0,t))return this.getLayoutForNode(y);var o=this.blockRender.getLinesStatusDetail(),a=me(o.activeLines[Kr]||[],o.retainedLines[Kr]||[]),s=Math.max.apply(Math,me([-1],a.filter(function(e){return e<t})));if(-1===s)return this.getLayoutForNode(y);var l=n.childNodes.item(s),c=this.getLayoutForNode(l),u=r.lines.atIndex(s).lineNode,d=this.getLayoutForNode(u),f=this.getLayoutForNode(y),h=ue({},f);return h.top=d.top+(f.top-c.top)+(d.height-c.height),h}var p=this.getRootForZone(Kr),g=this.editor.getLineNumInRootZone(e,t),v=this.getRootForZone(e),m=t;if(!p||-1===g)return el;var y,b=this.getLayoutForLine(Kr,g);return b?v?(y=v.childNodes.item(m))?this.getLayoutForNode(y):el:b:el},rl.prototype.getDocumentHeight=function(){var e=this.editor.getRep(Kr).lines.length(),t=this.getLayoutForLine(Kr,e-1);return t?t.top+t.height:this.getLayoutForNode(this.root).height},rl.prototype.ensureScreenNoScroll=function(e,t,n){return void 0===n&&(n=!1),this.viewportStabilizer.ensureScreenNoScroll(t,n)},rl.prototype.getTopmostElementIndexInViewport=function(){return this.viewportStabilizer.getViewportTopLine()},rl.prototype.getLineNodeInPreRenderer=function(e){return this.root.children.item(e)},rl.attributeNotAllowList=["data-grammar-check"],rl);function rl(e){var h=this;this.editor=e,this.updatePlaceholderTimer=null,this.enableReuseNode=!0,this.syncBaseLine=-1,this.asyncNodeDidUpdate=function(e){var t,n,r,i,o=e.zoneId,a=e.key;o===Kr?-1!==(n=(t=h.editor.getRep(o)).lines.indexOfKey(a))&&t.lines.atIndex(n)&&h.syncAsyncNode(n):-1!==(n=(t=h.editor.getRep(o)).lines.indexOfKey(a))&&(r=h.editor.getRep(Kr),-1!==(i=h.editor.getLineNumInRootZone(o,n))&&r.lines.atIndex(i)&&h.syncAsyncNode(i))},this.asyncNodeWillUpdate=function(e){var t,n,r=e.key,i=e.zoneId,o=h.editor.getRep(i).lines.indexOfKey(r);-1!==o&&(i!==Kr&&(o=h.editor.getLineNumInRootZone(i,o)),(t=h.editor.getRep(Kr).lines.atIndex(o))&&(n=h.root.children.item(o),t.isActive&&n&&n[Ys]&&h.syncLines(Kr,o,o)))},this.tableDidRender=function(e){var t=e.lineEntry,n=h.editor.getRep(Kr).lines.indexOfEntry(t);-1!==n&&(h.viewportStabilizer.addTableLineToContext(n),h.syncLines(Kr,n,n),t.needUpdateZoneRect=!0)},this.handleLineTrackerUpdate=function(e){var t,n,r;h.editor.lineTracker.collapseLines&&0!==e.dirtyLines.length&&(t=e.dirtyLines.length,n=e.dirtyLines[0].lineNum+1,(r=e.dirtyLines[t-1].lineNum)<n||h.syncLines(Kr,n,r))},this.aceCopy=function(){var e=h.editor.getRep(Kr).lines,i=Array.from(h.root.childNodes);e.traverseEntries(0,e.length()-1,function(e,t){var n=i[t],r=e.lineNode;n&&n[Ys]&&r&&e.isRendered&&(n.className=r.className,r.id&&n.classList.add(r.id))})},this.aceCut=function(){h.aceCopy()},this.bufferWillChanged=function(e,t){var n,r,i,o,a,s,l,c,u=t.deactivateRanges,d=t.activateRanges,f=[];(u[Kr]||[]).forEach(function(e){f.push(e)}),null!==(n=h.editor.getProps().renderConfig)&&void 0!==n&&n.skipAboveRender?(r=h.blockRender.getLinesStatusDetail().activeLines,i=h.getRootForZone(Kr),o=r[Kr].filter(function(e){var t=i.childNodes.item(e);return!t||!!t[Ys]}),f.push.apply(f,me(oa(o)))):(a=d[Kr]||[],(s=Math.max(0,h.syncBaseLine))<=(l=Math.max.apply(Math,me([0],a.map(function(e){return e[0]}))))&&(c=h.getRootForZone(Kr),sa(Object(M.a)(s,l+1),function(e){var t=c.childNodes.item(e);return!((!t||!!t[Ys])&&h.blockRender.getLineStatus(Kr,e).isRendered)}).filter(function(e){return 0<e.length}).forEach(function(e){var t=Math.min.apply(Math,me(e)),n=Math.max.apply(Math,me(e));f.push([t,n])}))),f=f.sort(function(e,t){return e[0]-t[0]}).reduce(function(e,t){if(0===e.length)return[t];var n=e[e.length-1];return aa(n,t)?(n[0]=Math.min(n[0],t[0]),n[1]=Math.max(n[1],t[1])):e.push(t),e},[]),h.viewportStabilizer.updateZoneRectInRanges(f),h.syncRanges(f,Kr),h.updateSyncBaseLine(),h.updatePlaceholderAsync()};var t=this.editor.getProps();!t.renderConfig||!t.renderConfig.disablePreRendererReuseNode||(this.enableReuseNode=!1)}var il,ol,al=new $.a;(ol=il=il||{})[ol.ImmediatePriority=0]="ImmediatePriority",ol[ol.UserBlockingPriority=1]="UserBlockingPriority",ol[ol.NormalPriority=2]="NormalPriority",ol[ol.LowPriority=3]="LowPriority",ol[ol.IdlePriority=4]="IdlePriority";var sl="onFiberPause",ll="onFiberResume",cl="onFiberTaskDone",ul={period:1/0,taskTime:1/0,startTime:0},dl=(fl.generateTaskId=function(){return"fiber-"+Tn(16)},fl.timeoutForPriority=function(e){switch(e){case il.ImmediatePriority:return-1;case il.UserBlockingPriority:return 250;case il.NormalPriority:return 5e3;case il.LowPriority:return 1e4;case il.IdlePriority:default:return 1/0}},fl.prototype.startSchedule=function(){this.scheduleId||(this.scheduleId=this.scheduler.startSchedule(this.flushTask))},fl.prototype.cancelSchedule=function(){this.scheduleId&&(this.scheduler.cancelSchedule(this.scheduleId),this.scheduleId=null)},fl.prototype.bindEvents=function(){this.config.visibilityChange&&document.addEventListener("visibilitychange",this.handleVisibilityChanged)},fl.prototype.unbindEvents=function(){this.config.visibilityChange&&document.removeEventListener("visibilitychange",this.handleVisibilityChanged),cancelAnimationFrame(this.periodTaskTimer),this.scheduleTaskRaF&&cancelAnimationFrame(this.scheduleTaskRaF),this.scheduleTaskRaF=null},fl.prototype.switchScheduler=function(e){switch(e.scheduler){case"requestIdleCallback":this.scheduler=new gl;break;case"setTimeout":this.scheduler=new ml(e.timeout)}},fl.prototype.scheduleTask=function(e,t){var n=this;void 0===t&&(t=il.IdlePriority);var r=fl.generateTaskId(),i=fl.timeoutForPriority(t),o={id:r,timeout:i,expirationTime:Date.now()+i,priority:t,failedCount:0,callback:e};return this.flushing?this.scheduleTaskRaF=requestAnimationFrame(function(){n.taskQueue.addTask(o),n.startSchedule()}):(this.taskQueue.addTask(o),this.startSchedule()),o.id},fl.prototype.cancelTask=function(t){var e=this.taskQueue.getTask(function(e){return e.id===t});e&&this.taskQueue.removeTask(e),this.taskQueue.hasTask()||this.cancelSchedule()},fl.prototype.clearTasks=function(){this.taskQueue.clear(),this.cancelSchedule()},fl.prototype.pause=function(){this.paused=!0,al.trigger(sl)},fl.prototype.resume=function(){this.paused=!1,this.scheduleId&&this.cancelSchedule(),this.scheduler instanceof gl&&(this.switchScheduler({scheduler:"setTimeout",timeout:100}),this.tryToSwitchBackIdleScheduler()),this.startSchedule(),al.trigger(ll)},fl.prototype.tryToSwitchBackIdleScheduler=function(){var e=this;this.switchBackIdleSchedulerTimer||(this.switchBackIdleSchedulerTimer=bl(function(){e.switchBackIdleSchedulerTimer=0,e.scheduler instanceof gl||e.switchScheduler({scheduler:"requestIdleCallback"})}))},fl.prototype.destroy=function(){this.clearTasks(),this.unbindEvents()},fl);function fl(e){var i=this;void 0===e&&(e={throttle:ul}),this.config=e,this.paused=!1,this.flushing=!1,this.taskQueue=new hl,this.scheduler=new gl,this.periodDeadline=0,this.periodTaskCost=0,this.nextPeriodStartTime=0,this.periodTaskTimer=0,this.periodTaskStartTime=0,this.switchBackIdleSchedulerTimer=0,this.flushTask=function(e){if(i.taskQueue.hasTask()){var n=void 0;try{i.flushing=!0;for(var t=function(){var e=performance.now();n.callback(),i.taskQueue.removeTask(n);var t=performance.now()-e;i.periodTaskTimer||(i.periodTaskTimer=requestAnimationFrame(function(){i.periodTaskCost+=performance.now()-e,i.periodTaskTimer=0}));try{al.trigger(cl,[{task:n,cost:t}])}catch(e){console.warn("call ON_FIBER_TASK_DONE failed",e)}};(n=i.taskQueue.getNextTask())&&(0<e.timeRemaining()||e.didTimeout||n.expirationTime<=Date.now())&&(!i.config.throttle||i.periodTaskStartTime>performance.now()||i.periodDeadline>performance.now()&&i.periodTaskCost<i.config.throttle.taskTime&&i.nextPeriodStartTime<performance.now());)t();var r=performance.now();i.config.throttle&&i.periodDeadline<r&&(i.periodTaskCost>i.config.throttle.period?(i.nextPeriodStartTime=r+i.config.throttle.period,i.periodDeadline=r+2*i.config.throttle.period):i.periodDeadline=r+i.config.throttle.period,i.periodTaskCost=0)}catch(e){console.error(" task ",e,n),n&&(n.failedCount=n.failedCount+1,3<=n.failedCount&&(console.warn(" task "+n.failedCount+" task "),i.taskQueue.removeTask(n)))}finally{i.flushing=!1}}!i.paused&&i.taskQueue.hasTask()?i.scheduleId=i.scheduler.startSchedule(i.flushTask):i.cancelSchedule()},this.handleVisibilityChanged=function(){"visible"===document.visibilityState?i.resume():i.pause()},this.bindEvents(),e.throttle&&(this.periodTaskStartTime=performance.now()+e.throttle.startTime)}var hl=(pl.prototype.getNextTask=function(){return this.taskQueue[0]},pl.prototype.getTask=function(e){return this.taskQueue.find(e)},pl.prototype.hasTask=function(){return 0<this.taskQueue.length},pl.prototype.addTask=function(e){this.taskQueue.push(e),this.taskQueue.sort(function(e,t){return e.expirationTime-t.expirationTime})},pl.prototype.removeTask=function(t){var e=this.taskQueue.findIndex(function(e){return e.id===t.id});-1!==e&&this.taskQueue.splice(e,1)},pl.prototype.clear=function(){this.taskQueue=[]},pl);function pl(){this.taskQueue=[]}var gl=(vl.prototype.startSchedule=function(e){return bl(e)},vl.prototype.cancelSchedule=function(e){El(e)},vl);function vl(){}var ml=(yl.prototype.startSchedule=function(t){return setTimeout(function(){var e=Date.now();t({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})},this.timeout)},yl.prototype.cancelSchedule=function(e){clearTimeout(e)},yl);function yl(e){void 0===e&&(e=0),this.timeout=e}function bl(e,t){if(window.requestIdleCallback)return window.requestIdleCallback(e,t);var n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})})}function El(e){return window.cancelIdleCallback?window.cancelIdleCallback(e):clearTimeout(e)}var kl=(Cl.prototype.destroy=function(){this.unbindEvents()},Cl.prototype.bindEvents=function(){al.on(sl,this.onFiberPause),al.on(ll,this.onFiberResume),al.on(cl,this.onFiberTaskDone)},Cl.prototype.unbindEvents=function(){al.off(sl,this.onFiberPause),al.off(ll,this.onFiberResume),al.off(cl,this.onFiberTaskDone)},Cl.prototype.start=function(){this.context={startTime:performance.now(),duration:0,fiberCost:0},"hidden"===document.visibilityState&&this.onFiberPause()},Cl.prototype.record=function(){var e;this.context&&this.context.startTime&&(e=performance.now()-this.context.startTime,this.context.duration+=e)},Cl.prototype.finish=function(){if(!this.context)return null;this.record();var e={duration:this.context.duration,fiberCost:this.context.fiberCost};return this.context=null,e},Cl);function Cl(){var n=this;this.context=null,this.onFiberPause=function(){n.context&&n.context.startTime&&(n.record(),n.context.startTime=void 0)},this.onFiberResume=function(){n.context&&!n.context.startTime&&(n.context.startTime=performance.now())},this.onFiberTaskDone=function(e){var t=e.cost;n.context&&(n.context.fiberCost+=t)},this.bindEvents()}var Il,Sl,Tl,Ol,wl,Rl,Al,xl,Ml,Nl,_l="PARTIAL_LOADING_STATUS_CHANGE",Ll=200,Dl=100,Bl=1e4,Pl="adit-virtual-scroll-placeholder";(Sl=Il=Il||{}).DONE="DONE",Sl.UPDATE="UPDATE",Sl.ADD="ADD",Sl.REMOVE="REMOVE",(Ol=Tl=Tl||{})[Ol.HIDE=0]="HIDE",Ol[Ol.SHOW=1]="SHOW",(Rl=wl=wl||{})[Rl.CANCELED=0]="CANCELED",Rl[Rl.RUNNING=1]="RUNNING",(xl=Al=Al||{}).isActive="isActive",xl.isRendered="isRendered",(Nl=Ml=Ml||{}).UP="UP",Nl.DOWN="DOWN",Nl.BOTH="BOTH";var Fl=(jl.prototype.isSkipAboveRender=function(){return!!this.config.skipAboveRender},jl.prototype.getCurrentBufferRange=function(){return this.bufferRange.slice()},jl.prototype.requestRenderAllForScroll=function(e,t,n,r){var i={bufferLine:e,forceRender:t,async:n};this.requestRender(i,r)},jl.prototype.updatePlaceholderIfNecessary=function(){this.placeholderNeedUpdate&&this.updatePlaceholder(),this.placeholderNeedUpdate=!1},jl.prototype.isPlaceholderNode=function(e){return e&&e.classList&&e.classList.contains(Pl)},jl.prototype.getPlaceholderAboveNode=function(e){for(var t=e.previousSibling;t&&!this.isPlaceholderNode(t);)t=t.previousSibling;if(t&&this.isPlaceholderNode(t)){var n=this.placeholderInfo.find(function(e){return e.placeholder===t});if(n)return n}return null},jl.prototype.getPlaceholderRange=function(t){if(!this.isPlaceholderNode(t))return null;var e=this.placeholderInfo.find(function(e){return e.placeholder===t});return(null===e||void 0===e?void 0:e.range)||null},jl.prototype.replacePlaceholderWithLineNode=function(e){var n=this,t=e.querySelectorAll("."+Pl),l=this.editor.getRep(sr).lines;t.forEach(function(a){var e,t,s=document.createDocumentFragment();n.placeholderInfo.forEach(function(e){var t,n,r,i=e.placeholder,o=e.range;i.id===a.id&&(n=(t=ve(o,2))[0],r=t[1],l.traverseEntries(n,r,function(e){s.appendChild(e.lineNode.cloneNode(!0))}))}),null!==(e=a.parentNode)&&void 0!==e&&e.insertBefore(s,a),null!==(t=a.parentNode)&&void 0!==t&&t.removeChild(a)})},jl.prototype.getLinesStatusDetail=function(){for(var e,t,n={activeLines:((e={})[sr]=[],e),retainedLines:((t={})[sr]=[],t)},r=this.linesStatus[sr],i=r.length,o=0;o<i;){var a=r[o],s=a.isActive,l=a.isRetained;s&&n.activeLines[sr].push(o),l&&n.retainedLines[sr].push(o),o++}return n},jl.prototype.createLineStatus=function(e,t,n){return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),{isActive:e,isRendered:t,isRetained:n,children:[]}},jl.prototype.withoutHandleScrolling=function(r,i){return void 0===i&&(i=!1),de(this,void 0,void 0,function(){var t,n=this;return pe(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,3,4]),this.disableHandleScrolling=!0,[4,r()];case 1:return e.sent(),[3,4];case 2:return t=e.sent(),console.error("Scroll Function Error: "+t),[3,4];case 3:return this.disableHandleScrolling=!1,i&&(this.throttleHandleScroll.cancel(),this.preRenderer.ensureScreenNoScroll([],function(){n.handleScroll()})),[7];case 4:return[2]}})})},jl.prototype.getUnrenderedLine=function(a){var t,e,s=this,n=function(e){for(var t=s.linesStatus[e]||[],n=a[e]||[],r=n[0]||0,i=n[n.length-1],o=Object(d.default)(i)?i:0;0<=r||o<t.length;){if(0<=r&&!t[r].isRendered&&!s.isLineCollapsed(r))return r;if(o<t.length&&!t[o].isRendered&&!s.isLineCollapsed(o))return o;r--,o++}return-1},r=[sr];try{for(var i=ge(r),o=i.next();!o.done;o=i.next()){var l=o.value,c=n(l);if(-1!==c)return{zoneId:l,lineNum:c}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return null},jl.prototype.renderZone=function(i,e){void 0===e&&(e={});var t,n=this.editor,o=n.editorBase,a=n.repManager,r=e.range,s=e.indexToKey,l=e.activeLines||this.getLinesStatusDetail().activeLines[i]||[],c=n.getRep(i),u=(c.alltext||"\n").slice(0,-1).split("\n"),d=c.alines;u.length!==d.length&&(t=Math.min(u.length,d.length),u=u.slice(0,t),d=d.slice(0,t));var f=r?r[0]:0,h=(r?r[1]:u.length-1)-f+1;return h<=0?[]:me(new Array(h)).map(function(e,t){return f+t}).map(function(e,t){var n=l.includes(e)?{text:u[e],attribs:d[e]}:{text:"",attribs:"|1+1"},r=s?s(e,t):void 0;return o.renderDomLine(n,a.apool,{currentLineIndex:e,zoneId:i},r)})},jl.prototype.getOffsetTopToScroller=function(){if(!this.config.considerOffsetTopToScroller)return 0;var e=this.scroller instanceof Window?document.body:this.scroller;return Po(this.editor.docbody,e)||0},jl);function jl(e){var C=this;this.allRendered=!1,this.linesStatus={},this.fiberTaskId=null,this.requestIdMap=new Map,this.loadingState=0,this.asyncNodeState={},this.callbackState={},this.isUsingBlockRendering=!1,this.bufferChangedNum=0,this.config={open:!1,buffer:1/0},this.scrolling=!1,this.bufferRange=[-1,-1],this.latestActiveLines={},this.isFirstBlock=!0,this.disableHandleScrolling=!1,this.watchdogTimer=null,this.debugMode=!1,this.fiberActions=[],this.buffer=1/0,this.placeholderInfo=[],this.placeholderNeedUpdate=!1,this.fiberRecord=new kl,this.startRender=function(){C.preRenderer.init();var e=C.config.startLine,t=C.editor,n=t.hooks,r=t.getRep,i=t.getDocId,o=r(sr).lines.length();C.linesStatus[sr]=me(new Array(o)).map(function(){return C.createLineStatus()});var a,s=e&&0<=e&&e<o?e:0,l=(new Date).getTime();C.isFirstBlock=!0,C.updateActivation({centerLine:s,forceRender:!0}),C.preRenderer.insertRoot(C.editor.docbody),C.addCollapseClassName(),C.fiberRecord.start(),C.requestAutoRender(),C.isFirstBlock=!1,C.renderEndId=window.requestAnimationFrame(function(){n.callAll("editorRenderEnd",{renderTime:(new Date).getTime()-l,token:i()}),n.callAll("onPaint")}),s&&(a=C.editor.getHeadingLineNumIfNecessary(s),Oa({selectionRange:{selZone:sr,selStart:[a,0],selEnd:[a,0]}},C.editor))},this.cancelCallback=function(e){C.callbackState[e]&&(C.callbackState[e]=wl.CANCELED)},this.renderAll=function(e){var t=C.editor.getRep(sr).lines.length();C.getUnrenderedRanges(sr,0,t-1,!0).forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];C.render(sr,n,r)});var i={};(function n(r){if(!C.linesStatus[r])return console.warn("linesStatus['"+r+"'] is undefined");C.linesStatus[r].forEach(function(e,t){i[r]||(i[r]=[]),i[r].push(t),e.children.length&&e.children.forEach(function(e){return n(e)})})})(sr),C.callForceRender(i,!0,e)},this.getIfRenderInScrolling=function(){return C.ifRenderInScrolling},this.isLineInBuffer=function(e,t){var n;if(e!==sr&&(t=C.editor.getLineNumInRootZone(e,t)),!C.isLineCollapsed(t))return C.getLineStatus(sr,t).isActive;var r=null===(n=C.editor.lineTracker.collapseLines)||void 0===n?void 0:n.getCollapsedStatusOfLine(e,t);return(null===r||void 0===r?void 0:r.headerLineNum)&&C.getLineStatus(sr,null===r||void 0===r?void 0:r.headerLineNum).isActive},this.requestRender=function(e,t){var n=e.start,r=e.end,i=e.extra,o=void 0===i||i,a=e.async,s=void 0===a||a,l=e.showLoading,c=e.source,u=e.bufferLine,d=e.forceRender;if(Object(T.default)(u)&&(Object(T.default)(n)||Object(T.default)(r)))return console.warn(" bufferLine  (start, end) ");var f=r&&o?r+C.config.buffer/2:r,h=C.editor.getRep(sr).lines.length()-1,f=Math.min(h,f||0);l&&C.showLoading(c);var p=C.createRenderId();return s?C.asyncRender(n,f,u,p,l,d,t):(Object(T.default)(u)?C.updateActivation({bufferRange:[n,f],forceRender:d}):C.updateActivation({centerLine:u,forceRender:d}),t&&t()),p},this.updateActivation=function(e){var t,n,r,i,o,a,s,l,c,u,d,f,h,p,g,v,m=e.centerLine,y=e.bufferRange,b=e.forceRender,E=e.usageState,k=e.forceUpdatePlaceholder;if(Object(T.default)(m)&&!y)return console.warn(" centerLine  bufferRange !");C.editor.getInInternationalComposition()&&C.editor.isSelectingAll||C.editor.observer.safeHasDirtyRanges()&&!C.editor.observer.onlyOneLineDirty()&&C.editor.isEditable()||(i=(r=(n=Object(T.default)(m)?C.getLatestActiveLinesForRange(y):C.getLatestActiveLines(m))[sr].sort(function(e,t){return e-t}))[0],o=r[r.length-1],a=C.ensureLinesRendered(sr,C.config.skipAboveRender?i:0,o),n[sr]=Object(I.a)(a.concat(n[sr])),s=C.getShouldRetainLineBefore(i),n[sr]=Object(I.a)(n[sr].concat(s)),c=(l=C.getLinesStatusDetail()).activeLines,u=l.retainedLines,d=c,f=C.getChangeLineRanges(n,d),h=f.activateRanges,p=f.deactivateRanges,g=C.keepSelectionLineActive(n,p),(t={})[sr]=Object(I.a)(u[sr].concat(g[sr])),v=t,C.editor.observer.withoutRecordingMutations(function(){C.doActivationUpdateForZone({activateRanges:h,deactivateRanges:p,oldActiveLines:d,newActiveLines:n,oldRetainedLines:u,newRetainedLines:v,forceUpdatePlaceholder:k})}),C.bufferRange=[r[0],r[r.length-1]],!b&&C.isUsingBlockRendering||C.callForceRender(n,b,E))},this.updatePlaceholder=function(){C.editor.getInInternationalComposition()&&C.editor.isSelectingAll||(C.updatePlaceholderInfo({force:!0}),C.updatePlaceholderRef())},this.getPointForPosition=function(e){var t=e.zone,n=e.line,r=e.col,i=C.editor.getRep(t).lines.atIndex(n);if(!i||i.isActive||i.isRetained)return null;for(var o=r===(null===i||void 0===i?void 0:i.text.length),a=0;a<C.placeholderInfo.length;a++){var s=C.placeholderInfo[a],l=s.range,c=s.placeholder,u=ve(l,2),d=u[0],f=u[1];if(d<=n&&n<=f){var h=C.editor.docbody;return{node:h,index:Array.from(h.childNodes).indexOf(c)+(o&&0<a?1:0),maxIndex:h.childElementCount}}}return console.error("can not find placeholder for inactive line "+n),null},this.getPositionForPoint=function(e,t){for(var n=C.placeholderInfo.length,r=0;r<n;r++){var i=C.placeholderInfo[r],o=i.range,a=i.placeholder,s=ve(o,2),l=s[0],c=s[1];if(a.contains(t.node)){var u=0===l,d=u?l:c,f=C.editor.getRep(e).lines.atIndex(d);return f?new Vo(e,d,u?0:f.text.length):null}}return null},this.getDocChildElementCount=function(){var e=C.getLinesStatusDetail(),t=e.activeLines,n=e.retainedLines,r=C.placeholderInfo.filter(function(e){return e.status===Il.DONE||e.status===Il.UPDATE});return t[sr].length+n[sr].length+r.length},this.getElementInDocumentForLine=function(e,c,u){void 0===u&&(u=!1);var d=C.editor.getRep(e).lines;if(c<0||c>=d.length())return null;var t=d.atIndex(c);if(!t)return null;var n=t.isActive,r=t.isRetained,f=null;return n||r||e!==sr?f=(null===t||void 0===t?void 0:t.lineNode)||null:C.placeholderInfo.forEach(function(e){var t=e.range,n=e.placeholder,r=e.status,i=ve(t,2),o=i[0],a=i[1];if(o<=c&&c<=a&&(r===Il.DONE||r===Il.UPDATE)){if(u)for(var s=c;o<=s;s--){var l=d.atIndex(s);if(null!==l&&void 0!==l&&l.isActive&&l.isRendered){f=l.lineNode;break}}f=f||n}}),f},this.getChangeLineRanges=function(d,f){var t,e,n,r,i=Object.keys(d),o=Object.keys(f),h={},p={},g={},a=function(e){var t,n;if(f[e]){var r=d[e],i=f[e].reduce(function(e,t){return e[t]=!0,e},{}),o={},a=[];try{for(var s=(t=void 0,ge(r)),l=s.next();!l.done;l=s.next()){var c=l.value;i[c]?o[c]=!0:a.push(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.length&&(h[e]=oa(a));var u=f[e].filter(function(e){return!o[e]});u.length&&(p[e]=oa(u)),g[e]=!0}else d[e].length&&(h[e]=oa(d[e]))};try{for(var s=ge(i),l=s.next();!l.done;l=s.next())a(v=l.value)}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}try{for(var c=ge(o),u=c.next();!u.done;u=c.next()){var v=u.value;!g[v]&&f[v].length&&(p[v]=oa(f[v]))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return{activateRanges:h,deactivateRanges:p}},this.getBufferRemained=function(e){var t=e.renderDir,n=e.buffer,r=e.lineNum,i=e.centerOffsetY,o=C.isLineCollapsed(r),a=C.editor.getRep(sr).lines.atIndex(r);if(o||!a||!a.lineNode)switch(t){case Ml.BOTH:return{upwardBufferSize:Math.ceil(n/2),downwardBufferSize:Math.floor(n/2)};case Ml.UP:return{upwardBufferSize:n,downwardBufferSize:0};case Ml.DOWN:return{upwardBufferSize:0,downwardBufferSize:n};default:throw new Error("Direction error!")}C.latestActiveLines[sr]||(C.latestActiveLines[sr]=[]),C.latestActiveLines[sr].push(r);var s=parseInt(va(C.editor)),l=C.preRenderer.getLayoutForLine(sr,r).height||s,c=Math.ceil(l/s);switch(t){case Ml.BOTH:var u=a.lineNode.offsetTop+C.getOffsetTopToScroller(),d=Math.min(Math.max(i-u,0),l),f=l-d,h=Math.floor(d/l*c),p=Math.ceil(f/l*c);return{upwardBufferSize:Math.ceil(n/2)-h,downwardBufferSize:Math.floor(n/2)-p};case Ml.UP:return{upwardBufferSize:n-c,downwardBufferSize:0};case Ml.DOWN:return{upwardBufferSize:0,downwardBufferSize:n-c};default:throw new Error("Direction error!")}},this.getLatestActiveLines=function(e){C.latestActiveLines={};for(var t=C.buffer,n=C.editor.getRep(sr).lines.length(),r=C.getCenterOffsetY(),i=e,o=e,a=C.getBufferRemained({lineNum:i,buffer:t,renderDir:Ml.BOTH,centerOffsetY:r}),s=a.upwardBufferSize,l=a.downwardBufferSize;0<s&&0<i;)s=C.getBufferRemained({lineNum:--i,buffer:s,renderDir:Ml.UP,centerOffsetY:r}).upwardBufferSize;for(;0<l&&o<n-1;)l=C.getBufferRemained({lineNum:++o,buffer:l,renderDir:Ml.DOWN,centerOffsetY:r}).downwardBufferSize;return C.latestActiveLines},this.getLatestActiveLinesForRange=function(e){C.latestActiveLines={};for(var t=ve(e,2),n=t[0],r=t[1],i=n;i<=r;i++)C.getBufferRemained({lineNum:i,buffer:1/0,renderDir:Ml.DOWN,centerOffsetY:0});return C.latestActiveLines},this.callForceRender=function(e,t,n){void 0===n&&(n=C.getUsageState()),C.editor.observer.withoutRecordingMutations(function(){C.editor.hooks.callAll("aceForceRenderAll",{viewportLines:e,forceRender:t,usageState:n})})},this.toggleVirtualScrollMode=function(e){if(C.config.open){var t,n,r;if(Object(T.default)(e))t=!C.isUsingBlockRendering;else{if(C.isUsingBlockRendering===e)return;t=e}t?(C.buffer=C.config.buffer,n=C.getViewportCenterLine(),C.updateActivation({centerLine:n,usageState:t})):(C.buffer=1/0,r=C.editor.getRep(sr).lines.length(),C.renderAll(t),C.updateActivation({bufferRange:[0,r-1],forceRender:!0,usageState:t})),C.isUsingBlockRendering=t}},this.getUsageState=function(){return C.isUsingBlockRendering},this.isScrolling=function(){return C.scrolling},this.updateLinesStatus=function(e,o,a,s,t){var n,r,l,i=void 0===t?{}:t,c=i.isActive,u=void 0!==c&&c,d=i.isRendered,f=void 0===d||d,h=i.isRetained,p=void 0!==h&&h;C.editor.getRep(e)&&(C.linesStatus[e]||C.initZoneLineStatus(e),r=me(new Array(s)).map(function(){return C.createLineStatus(u,f,p)}),(n=C.linesStatus[e]).splice.apply(n,me([o,a],r)),l=s-a,e===sr&&C.placeholderInfo.forEach(function(e){var t,n=ve(e.range,2),r=n[0],i=n[1];o+a-1<r?e.range=[r+l,i+l]:i<o||(C.placeholderNeedUpdate=!0,o<r?e.range=[o+s,Math.max(i+l,o+s)]:(t=void 0,t=o+a<=i?i+l:u?o-1:o+s-1,e.range=[r,Math.max(t,r)]))}))},this.getLinesStatus=function(){return C.linesStatus},this.getLineStatus=function(e,t){var n=C.editor.managers.zoneToLineEntry[e],r=C.linesStatus[e],i={isRendered:!1,isActive:!1,isRetained:!1,children:[]};if(!r)return console.warn("BlockRender.getLineStatus: no zone exists. "+e),i;var o=r[t];return o?ue(ue({},o),{isActive:(n||o).isActive}):(console.warn("BlockRender.getLineStatus: no line exists. "+e+" "+t),i)},this.getActiveLineRanges=function(e){var t=C.getLinesStatusDetail(),n=t.activeLines,r=t.retainedLines;return n[e]?oa(n[e].concat(r[e]||[])):[]},this.getBufferChangedNum=function(){return C.bufferChangedNum},this.resetBufferChangedNum=function(){C.bufferChangedNum=0},this.getCenterOffsetY=function(){return(C.scroller instanceof Window?C.scroller.scrollY+C.scroller.innerHeight/2:C.scroller.scrollTop+C.scroller.offsetHeight/2)||0},this.isInViewport=function(e,t){var n=C.editor.getLineNumInRootZone(e,t);if(!C.getLinesStatusDetail().activeLines[sr].includes(n))return!1;var r=C.editor.getRep(e).lines.atIndex(t);if(!r||!r.lineNode)return!1;var i=C.scroller instanceof Window?C.scroller.scrollY:C.scroller.scrollTop,o=i+(C.scroller instanceof Window?C.scroller.innerHeight:C.scroller.offsetHeight),a=(Po(r.lineNode,C.editor.docbody)||0)+C.getOffsetTopToScroller(),s=r.lineNode.offsetHeight;return!(o<a||a+s<i)},this.getViewportLines=function(){var o=C.scroller instanceof Window?C.scroller.scrollY:C.scroller.scrollTop,e=C.scroller instanceof Window?C.scroller.innerHeight:C.scroller.offsetHeight,a=o+e,r={},s=C.getLinesStatusDetail().activeLines;return Object.keys(s).forEach(function(e){var t=s[e]||[],i=C.editor.getRep(e),n=t.filter(function(e){var t=i.lines.atIndex(e);if(!t||!t.lineNode)return!1;var n=t.lineNode.offsetTop+C.getOffsetTopToScroller(),r=t.lineNode.offsetHeight;return!(a<n||n+r<o)});0<n.length&&(r[e]=n)}),r},this.getViewportCenterLine=function(e,t){void 0===e&&(e=sr),void 0===t&&(t=C.getCenterOffsetY());var n=C.editor.getRep(e).lines.length(),r=0,i=n-1,o=Math.floor(n/2);for(C.debugLog("middle y: ",t);r<o&&o<i;){var a=C.editor.getHeadingLineNumIfNecessary(o);if(i<=r)return a;var s=C.preRenderer.getLayoutForLine(e,a),l=s.height,c=s.top+C.getOffsetTopToScroller();if(C.debugLog("visible line: "+a+", top: "+c),c<=t&&t<=c+l)return a;o=t<c?(i=a,Math.floor((a+r)/2)):(r=o,Math.floor((o+i)/2))}return o},this.render=function(d,f,e){var h,t,p,g,n,v,r,m=C.editor,i=m.hooks,o=m.getDocId,a=m.observer,s=m.getRep(d),l=s.alltext,c=s.lines,u=c.length();e=u<=e?u-1:e,m.dom.rootNodeOfZone(d)instanceof HTMLElement&&(h=l.slice(0,-1).split("\n"),t=(new Date).getTime(),p=[],g=c.slice(f,e+1),n=Object(M.a)(f,e+1),v=C.renderZone(d,{range:[f,e],activeLines:n,indexToKey:function(e,t){var n;return null===(n=g[t])||void 0===n?void 0:n.key}}),C.isFirstBlock&&i.callAll("editorCalcEnd",{calcTime:(new Date).getTime()-t,token:o()}),a.withoutRecordingMutations(function(){for(var e=function(e,t){var n,r=v[e].node,i=r.className,o=r.innerHTML,a=r.id,s=r.editable,l=r.dir,c=g[e],u=c.lineNode;u&&(!1===s&&u.setAttribute("contenteditable","false"),a&&(u.id=a),u.className=i,u.innerHTML=o,l&&u.setAttribute("dir",l),n=e+f,p.push(u),v[e].node=u,c.setDomInfo(ue(ue({},v[e]),{lineString:h[e+f],zone:d})),m.domLine.decorateMagicObjects(c),d===sr&&C.editor.managers.getChildZonesAtLine(d,n).text.forEach(function(e){C.linesStatus[d][n].children.push(e),C.initZoneLineStatus(e)}))},t=0,n=v.length;t<n;t++)e(t)}),C.setLinesStatus(d,f,e,Al.isRendered,!0),C.bindLoadStateEvent(p),r=function(e){return(C.linesStatus[e]||[]).every(function(e){return e.isRendered})}(sr),i.callAll("lineNodesRendered",{type:"CLIENT_VARS",data:{isFirstBlock:C.isFirstBlock,isAllRendered:r,lineEntries:g,renderedLines:n}}),C.markNodesClean(g),r&&C.renderFinished())},this.activateNodes=function(e,o,a){var s=[];return Object.getOwnPropertyNames(e).forEach(function(i){e[i].forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];s=s.concat(C.doActivateNodes(i,n,r,o,a))})}),s},this.doActivateNodes=function(l,e,r,t,n){var i=C.editor.getRep(l).lines,c=[];if(e<0||r>=i.length()||r<e)return c;var o=document.createDocumentFragment(),u=[],d=C.editor.docbody;i.traverseEntries(e,r,function(e,t){var n,r,i=C.linesStatus[l][t],o=i.isActive,a=C.isLineCollapsed(t),s=e.lineNode;!s||o||a?o&&console.warn("line "+t+" is already active"):(n=!1,e.isRetained&&d.contains(s)&&!C.isLineCollapsed(t)&&(s.style.height="",s.style.margin="",xo(s),n=i.isRetained,i.isRetained=!1,e.isRetained=!1),u.push({lineNode:s,isRetained:n}),e.isActive=e.mounted=!0,i.isActive=!0,r=C.setZoneEntryMountedStatus(l,t,!0),c.push({lineEntry:e,lineNum:t,childZoneLineEntries:r,zone:l}))});var a,s=null;return C.placeholderInfo.forEach(function(e){var t=e.range,n=e.placeholder;t[0]===r+1&&d.contains(n)&&(s=n)}),s||-1!==(a=C.findDownwardNearestActiveLine(l,r,t,n))&&(s=C.editor.getRep(l).lines.atIndex(a).lineNode),u.forEach(function(e){var t=e.lineNode;e.isRetained?o.childNodes.length&&C.editor.docbody.insertBefore(o,t):o.appendChild(t)}),C.editor.docbody.insertBefore(o,s),c},this.findDownwardNearestActiveLine=function(e,t,n,r){if(!n[e])return-1;for(var i=n[e].concat(r[e]).sort(function(e,t){return e-t}),o=0;o<i.length;o++){var a=i[o];if(t<a)return a}return-1},this.getLineNodeStyle=function(s,e,t){var n=C.editor.getRep(s).lines,l=[];return e<0||t>=n.length()||t<e?[]:(n.traverseEntries(e,t,function(e,t){var n,r,i,o=C.linesStatus[s][t].isActive,a=e.lineNode;a&&o?(r=(n=getComputedStyle(a)).height,i=n.margin,l.push({lineNum:t,height:r,margin:i,lineEntry:e,childZoneLineEntries:[],zone:s})):o||console.warn("line "+t+" is already inactive")}),l)},this.getDeactivateNodeStyle=function(e){var t=Object.getOwnPropertyNames(e),o=[];return t.forEach(function(i){e[i].forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];o=o.concat(C.getLineNodeStyle(i,n,r))})}),o},this.deactivateNodes=function(e){var t,n,r,i={};try{for(var o=ge(e),a=o.next();!a.done;a=o.next()){var s,l,c=a.value,u=c.lineEntry,d=c.zone,f=c.lineNum,h=c.height,p=u.lineNode;p&&(s=C.linesStatus[d][f],u.shouldRetain?(p.style.height=h||"",Ao(p),s.isRetained=!0,u.isRetained=!0):null!==(r=p.parentNode)&&void 0!==r&&r.removeChild(p),u.isActive=u.mounted=!1,s.isActive=!1,l=C.setZoneEntryMountedStatus(d,f,!1),c.childZoneLineEntries=l)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return e.filter(function(e){return!i[e.lineNum]})},this.setZoneEntryMountedStatus=function(e,t,a){if(e!==sr)return[];var s=[];return C.editor.managers.getChildZonesAtLine(e,t).text.forEach(function(e){var t=C.editor.getRep(e);if(t)for(var n=t.lines,r=0;r<n.length();r++){var i,o=n.atIndex(r);o&&(i=o.isRendered,o.mounted=i&&a,o.isActive=i&&a,C.initZoneLineStatus(e),C.linesStatus[e][r].isActive=i&&a,s.push(o))}}),s},this.setLinesStatus=function(e,t,n,r,i){for(var o=t;o<=n;o++)C.linesStatus[e][o][r]=i},this.getUnrenderedRanges=function(e,t,n,r){var i;void 0===r&&(r=!1);var o=[],a=n;if(r&&e===sr){var s=null===(i=C.editor.lineTracker.collapseLines)||void 0===i?void 0:i.getCollapsedStatusOfLine(e,a);if(null!==s&&void 0!==s&&s.startOfCollapseSection)for(var l=C.editor.getRep(e).lines;a+1<l.length()&&C.isLineCollapsed(a+1);)a++}for(var c=t;c<=a;c++){var u=C.linesStatus[e][c];u&&(u.isRendered||!r&&C.isLineCollapsed(c)||o.push(c))}return oa(o)},this.getSystemSelection=function(){if(!C.editor.docbody.childElementCount)return null;var e=C.editor.selection.internalGetSelectionPoints();if(e&&e.endPoint&&e.startPoint){var t=C.editor.selection.positionForDomPoint(e.startPoint),n=C.editor.selection.positionForDomPoint(e.endPoint);return{start:t.line,end:n.line,zoneId:t.zone}}return null},this.isSystemSelectionLine=function(e,t,n){if(!n)return!1;var r=n.start,i=n.end,o=n.zoneId;return o===e?r<=t&&t<=i:e===sr&&t===C.editor.getLineNumInRootZone(o,t)},this.isSelectionLine=function(e,t){var n=C.editor.getRep(),r=n.selStart,i=n.selEnd,o=n.zoneId;if(!r||!i)return!1;var a=r[0],s=i[0];return o===e?a<=t&&t<=s:e===sr&&t===C.editor.getLineNumInRootZone(o,t)},this.ensureLinesRendered=function(i,e,t,n){void 0===n&&(n=!1);var r=C.getUnrenderedRanges(i,e,t,n);r.forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];C.render(i,n,r)});var o=r.reduce(function(e,t){return e.concat(Object(M.a)(t[0],t[1]+1))},[]);return r.length&&C.isScrolling&&(C.ifRenderInScrolling=!0),o},this.doActivationUpdateForZone=function(e){var t,n,r=e.activateRanges,i=e.deactivateRanges,o=e.oldActiveLines,a=e.newActiveLines,s=e.oldRetainedLines,l=e.newRetainedLines,c=e.forceUpdatePlaceholder;C.updatePlaceholderInfo({force:c,newActiveLines:a,retainedLines:l});var u=C.getViewportLines(),d=C.getDeactivateNodeStyle(i);C.editor.hooks.callAll("bufferWillChanged",{deactivateRanges:i,activateRanges:r});var f=C.activateNodes(r,o,s),h=C.deactivateNodes(d);C.updatePlaceholderRef(),f.forEach(function(e){var t=e.lineEntry,n=e.childZoneLineEntries;C.callEnterBuffer(t),n.forEach(function(e){C.callEnterBuffer(e)})}),h.forEach(function(e){var t=e.lineEntry,n=e.childZoneLineEntries;C.callLeaveBuffer(t),n.forEach(function(e){C.callLeaveBuffer(e)})}),(f.length||h.length)&&C.editor.hooks.callAll("bufferChanged",{enteredLines:f,leftLines:h,viewportLines:null!==(n=u[sr])&&void 0!==n&&n.length?u:((t={})[sr]=f.map(function(e){return e.lineNum}),t)});var p=C.getSystemSelection();C.editor.isSelectingAll&&p&&!Ce.ios&&C.editor.selection.selectAll()},this.getShouldRetainLineBefore=function(e){var t=C.editor.getRep(sr).lines;if(0===e)return[];for(var n=e-1,r=t.atIndex(n),i=[];0<=n&&r&&r.shouldRetain&&!r.isRetained;)i.push(n),n--,r=t.atIndex(n);return i},this.keepSelectionLineActive=function(s,e){var t,n=Object.getOwnPropertyNames(e),l=((t={})[sr]=[],t),c=C.getSystemSelection();return n.forEach(function(i){var o=[],a=C.editor.getRep(i).lines;e[i].forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];a.traverseEntries(n,r,function(e,t){e.shouldKeepActive||C.isSelectionLine(i,t)||C.isSystemSelectionLine(i,t,c)?(s[i]||(s[i]=[]),s[i].push(t)):(o.push(t),e.shouldRetain&&l[sr].push(t))})}),e[i]=oa(o)}),l},this.updatePlaceholderInfo=function(e){void 0===e&&(e={});var i=e.force,t=e.retainedLines,n=e.newActiveLines,r=C.getInactiveLineRanges(n,t),o=0,a=[];r.forEach(function(e){var t=C.placeholderInfo[o];if(t){var n,r=t.range;return e[0]===r[0]&&e[1]===r[1]?(i&&(n=C.getPlaceholderStyle(e),Object(N.default)(n,t.style)||(t.style=n,t.status=Il.UPDATE)),a.push(t),void o++):aa(e,r)?(t.range=e,t.status=Il.UPDATE,t.style=C.getPlaceholderStyle(e),a.push(t),void o++):void a.push(C.createPlaceholder(e,C.getPlaceholderStyle(e)))}a.push(C.createPlaceholder(e,C.getPlaceholderStyle(e)))});for(var s=o;s<C.placeholderInfo.length;s++){var l=C.placeholderInfo[s];l.status=Il.REMOVE,a.push(l)}C.placeholderInfo=a},this.updatePlaceholderRef=function(){var d=C.editor.docbody,f=C.editor.getRep(sr).lines,h=f.length();C.editor.observer.withoutRecordingMutations(function(){C.placeholderInfo.forEach(function(e,t){switch(e.status){case Il.REMOVE:d.contains(e.placeholder)?d.removeChild(e.placeholder):console.error("docbody doesn't contain placeholder: "+e);break;case Il.ADD:case Il.UPDATE:var n=e.range,r=e.style,i=e.placeholder,o=ve(n,2),a=o[0],s=o[1],l=null;if(s+1<h){var c=f.atIndex(s+1);if(!c||!c.lineNode)throw new Error("attempt to iterate lineEntry & lineNode which doesn't exist at index: "+s);l=c.lineNode}i.style.height=r.height,i.style.marginTop=r.marginTop,i.style.marginBottom=r.marginBottom;var u=C.editor.getHeadingLineNumIfNecessary;if(C.isLineCollapsed(a)&&C.isLineCollapsed(s)&&u(a)===u(s)?i.style.display="none":i.style.display="",i.id="placeholder-id-"+a+"-"+s,e.status=Il.DONE,l&&i.nextSibling===l||!l&&i===d.lastChild)return;l&&!d.contains(l)&&(console.log("refChild",l),console.log("range",n),console.log("placeholder",i)),d.insertBefore(i,l)}}),C.placeholderInfo=C.placeholderInfo.filter(function(e){return e.status!==Il.REMOVE})})},this.getPlaceholderStyle=function(e){var t=ve(e,2),n=t[0],r=t[1],i=C.isLineCollapsed(n),o=C.editor.getHeadingLineNumIfNecessary(n),a=C.editor.getHeadingLineNumIfNecessary(r);i&&o!==a&&(n=C.getDownwardHeadingLine(n,r)||o);var s=C.preRenderer.getLayoutForLine(sr,n),l=C.preRenderer.getLayoutForLine(sr,a);return{height:l.top+l.height-s.top+"px",marginTop:s.marginTop+"px",marginBottom:l.marginBottom+"px"}},this.getDownwardHeadingLine=function(e,t){var n=C.editor.lineTracker.collapseLines;if(!n)return null;for(var r=n.getCollapsedStatusOfLine(sr,e).headerLineNum,i=e+1;i<=t;i++)if(r!==n.getCollapsedStatusOfLine(sr,i).headerLineNum)return i;return null},this.createPlaceholder=function(e,t){var n=document.createElement("div"),r=ve(e,2),i=r[0],o=r[1];return n.appendChild(document.createElement("br")),n.id="placeholder-id-"+i+"-"+o,n.className=Pl+" data-ignore-mutation dom-pass-empty-check",{placeholder:n,range:e,status:Il.ADD,style:t}},this.getInactiveLineRanges=function(e,t){var n;e&&t||(t=(n=C.getLinesStatusDetail()).retainedLines,e=n.activeLines);var r=oa(Object(I.a)(e[sr].concat(t[sr]))),a=C.editor.getRep(sr).lines.length(),s=r.length,l=0;return r.reduce(function(e,t,n){var r=ve(t,2),i=r[0],o=r[1];return 0===n&&(l=o+1),0===n&&0!==i&&e.push([0,i-1]),0!==n&&(e.push([l,i-1]),l=o+1),n===s-1&&o!==a-1&&e.push([l,a-1]),e},[])},this.callEnterBuffer=function(e){e.getAllInstances().forEach(function(e){e.enterBuffer&&e.enterBuffer()})},this.callLeaveBuffer=function(e){e.getAllInstances().forEach(function(e){e.leaveBuffer&&e.leaveBuffer()})},this.getLatestBufferRange=function(e){for(var t=C.config.buffer,n=C.editor.getRep(sr).lines,r=n.length(),i=e-1,o=e+1,a=Math.floor(t/2),s=Math.ceil(t/2)-1;0<a||0<s;){if(0<=i&&0<a){if(!n.atIndex(i))return console.warn("Entry doesn't exist in line "+i),C.bufferRange;a-=C.getLineVirtualNum(i),i--}if(i<0&&0<a&&(o<r&&(s+=a),a=0),0<s&&o<r){if(!n.atIndex(o))return console.warn("Entry doesn't exist in line "+o),C.bufferRange;s-=C.getLineVirtualNum(o),o++}0<s&&r-1<o&&(0<=i&&(a+=s),s=0)}return[i+1,o-1]},this.getLineVirtualNum=function(e){var t=1,n=C.editor.lineTracker.collapseLines;if(!n)return t;var r=n.getCollapsedStatusOfLine(sr,e);if(r){var i=r.renderCollapsed;if(!r.startOfCollapseSection&&i)return 0}return t},this.enableOptimization=function(){return!1},this.isLineCollapsed=function(e){var t=C.editor.lineTracker.collapseLines,n=t&&t.getCollapsedStatusOfLine(sr,e);return n&&n.renderCollapsed&&!n.startOfCollapseSection},this.handleScroll=function(){var t,e,n,r,i;C.handleScrollTimestamp=(new Date).getTime(),C.disableHandleScrolling||(C.scrolling||(C.ifRenderInScrolling=!1),C.scrolling=!0,t=C.getViewportCenterLine(),e=C.scroller instanceof Window?C.scroller.scrollY:C.scroller.scrollTop,n=C.getLatestActiveLines(t)[sr].sort(function(e,t){return e-t}),r=e<C.lastScrollTop&&n.filter(function(e){return!C.getLineStatus(sr,e).isActive}).some(function(e){return C.preRenderer.isLineNeedSync(e)}),i=C.config.skipAboveRender,r&&i?(C.editor.call("renderAboveBegin"),C.preRenderer.ensureScreenNoScroll([],function(){var e=n[0];C.ensureLinesRendered(sr,Math.max(0,e-i.renderCount),e),C.preRenderer.syncLines(sr,Math.max(0,e-i.renderCount),e),C.updateActivation({centerLine:t}),C.editor.call("renderAboveFinish")},!0)):C.updateActivation({centerLine:t}),C.lastScrollTop=e,C.timer&&clearTimeout(C.timer),C.timer=window.setTimeout(function(){var e,t;C.timer=null,C.scrolling=!1,C.disableHandleScrolling||(C.editor.observer.withoutRecordingMutations(function(){var e=C.getViewportLines();C.editor.hooks.callAll("aceScrollEndInViewport",{viewportLines:e})}),e=C.getViewportCenterLine(),C.updateActivation({centerLine:e}),t=C.getSystemSelection(),C.editor.isSelectingAll&&t&&Ce.ios&&C.editor.selection.selectAll(),C.requestAutoRender())},Math.max(Ll,Dl)))},this.throttleHandleScroll=Object(f.default)(this.handleScroll,Dl),this.addCollapseClassName=function(){C.editor.observer.withoutRecordingMutations(function(){var e=C.editor.getRep().lines,t=e.length();e.traverseEntries(0,t-1,function(e,t){C.isLineCollapsed(t)&&(e.lineNode.className=As)})})},this.asyncRender=function(e,n,r,i,o,a,s){Object(g.default)(s)&&i&&(C.callbackState[i]=wl.RUNNING);var l=requestAnimationFrame(function(){C.requestIdMap.delete(l),Object(T.default)(r)?C.updateActivation({bufferRange:[e,n],forceRender:a}):C.updateActivation({centerLine:r,forceRender:a}),C.updatePlaceholder();var t=C.editor.getReps();if(Object.keys(t).forEach(function(e){t[e].lines.clearRects()}),Object(g.default)(s)&&i&&C.callbackState[i]){try{s(!0)}catch(e){console.error("Async Render Callback Error: "+e)}delete C.callbackState[i]}o&&C.hideLoading()});C.requestIdMap.set(l,!0)},this.requestAutoRender=function(){C.config.autoRender?C.fiberTaskId||(C.fiberTaskId=C.editor.fiber.scheduleTask(function(){var e,t;if(C.fiberTaskId=null,C.scrolling)C.requestAutoRender();else{C.fiberActions.length||(t=C.editor.hook.callAll("aceFiberAction"),(e=C.fiberActions).push.apply(e,me(t.filter(function(e){return e instanceof Function}))));var n,r=C.getViewportLines(),i=C.getUnrenderedLine(r);if(i){var o=i.zoneId,a=i.lineNum;return C.render(o,a,a),void C.requestAutoRender()}C.fiberActions.length&&((n=C.fiberActions.shift())&&n(),C.requestAutoRender());var s=C.fiberRecord.finish();s&&C.editor.call("onFiberRecord",s)}})):C.fiberTaskId=null},this.handleMobileEnterEditMode=function(){C.fiberTaskId&&C.editor.fiber.cancelTask(C.fiberTaskId),C.fiberTaskId=null},this.handleMobileQuitEditMode=function(){C.fiberTaskId||C.allRendered||C.requestAutoRender()},this.markNodesClean=function(e){Object(B.a)(e,function(e){C.editor.dirtyChecker.markNodeClean(e.lineNode,e)})},this.handleBlockDidRender=function(e){var t,n;try{for(var r=ge(Object.keys(C.asyncNodeState)),i=r.next();!i.done;i=r.next())for(var o=i.value,a=C.asyncNodeState[o],s=a.blockList,l=a.nodes,c=0,u=s.length;c<u;c++)if(e===s[c])return s.splice(c,1),void C.callAsyncNodesLoaded(o,l)}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},this.bindLoadStateEvent=function(e){var t=C.createRenderId();C.asyncNodeState[t]={nodes:e,imageNumber:0,blockList:[]};var o=C.asyncNodeState[t],n=function(){o.imageNumber--,C.callAsyncNodesLoaded(t,e)},r=he()(e),i=r.find(".image-uploaded img");i.length&&i.each(function(e,t){i.eq(e).closest(".ace-table").length||(o.imageNumber++,t.onload=n,t.onerror=n)});var a=r.find(".block-placeholder");a.length&&a.each(function(e,t){var n,r,i;a.eq(e).closest(".ace-table").length||(n=/block-id-(\S*)/,(i=(r=t.className.match(n))&&r[1])&&o.blockList.push(i))}),C.callAsyncNodesLoaded(t,e)},this.callAsyncNodesLoaded=function(e,t){var n=C.asyncNodeState[e];n&&0===n.imageNumber&&0===n.blockList.length&&(delete C.asyncNodeState[e],C.editor.hooks.callAll("blockRenderAsyncNodesLoaded",{type:"CLIENT_VARS",data:{nodes:t,rep:C.editor.getReps()[sr]}}))},this.createRenderId=function(){return On(20)},this.handleSelectionChanged=function(e){var t,n,r,i,o,a=C.editor.getRep(sr).lines,s=a.length()-1,l=a.atIndex(0),c=a.atIndex(s);c&&l&&(t=[0,l.lineMarker],n=[s,c.text.length],i=(r=e.rep).selStart,o=r.selEnd,Object(N.default)(i,o)||!Object(N.default)([0,0],i)&&!Object(N.default)(t,i)||!Object(N.default)(n,o)?C.editor.isSelectingAll=!1:C.editor.isSelectingAll=!0)},this.bindEvent=function(){C.editor.eventEmitter.on("blockDidMount",C.handleBlockDidRender),C.editor.eventEmitter.on("blockFailMount",C.handleBlockDidRender),C.editor.eventEmitter.on("blockRenderTimeout",C.handleBlockDidRender),C.editor.eventEmitter.on("aceSelectionChanged",C.handleSelectionChanged),C.editor.eventEmitter.on("lineTrackerUpdate",C.handleCollapseChanged),C.isUsingBlockRendering&&(C.editor.on("enterMobileEditMode",C.handleMobileEnterEditMode),C.editor.on("quitMobileEditMode",C.handleMobileQuitEditMode),C.scroller.addEventListener("scroll",C.throttleHandleScroll),C.watchdogTimer=window.setTimeout(C.checkViewportVisibility,Bl))},this.unbindEvent=function(){C.editor.eventEmitter.off("blockDidMount",C.handleBlockDidRender),C.editor.eventEmitter.off("blockFailMount",C.handleBlockDidRender),C.editor.eventEmitter.off("blockRenderTimeout",C.handleBlockDidRender),C.editor.eventEmitter.off("aceSelectionChanged",C.handleSelectionChanged),C.editor.eventEmitter.off("lineTrackerUpdate",C.handleCollapseChanged),C.isUsingBlockRendering&&(C.editor.off("enterMobileEditMode",C.handleMobileEnterEditMode),C.editor.off("quitMobileEditMode",C.handleMobileQuitEditMode),C.scroller.removeEventListener("scroll",C.throttleHandleScroll)),C.watchdogTimer&&(clearTimeout(C.watchdogTimer),C.watchdogTimer=null)},this.showLoading=function(e){Ce.isMobile&&!C.loadingState&&(C.loadingState=Tl.SHOW,window.lark.biz.util.showPartialLoading(),C.editor.call(_l,{show:!0,source:e}))},this.hideLoading=function(){Ce.isMobile&&C.loadingState&&(C.loadingState=Tl.HIDE,window.lark.biz.util.hidePartialLoading(),C.editor.call(_l))},this.handleCollapseChanged=function(e){var t,n,r;C.editor.lineTracker.collapseLines&&0!==e.dirtyLines.length&&(C.preRenderer.handleLineTrackerUpdate(e),t=e.dirtyLines.length,n=e.dirtyLines[0].lineNum+1,e.dirtyLines[t-1].lineNum<n||(C.updatePlaceholderIfNecessary(),r=C.getViewportCenterLine(),C.updateActivation({centerLine:r})))},this.renderFinished=function(){C.allRendered=!0},this.updateConfig=function(e){var t,n;e&&e.open?(C.config=e,C.isUsingBlockRendering=!0,t=Math.floor(window.screen.height/C.docLineHeight),e.buffer?C.config.buffer=Math.max(e.buffer,t):C.config.buffer=t,C.buffer=C.config.buffer,C.config.autoRender&&((n=C.config.autoRender).renderNumber=n.renderNumber||200,n.intervalTime=n.intervalTime||0,n.increase=n.increase||!1)):e&&e.startLine&&(C.config.startLine=e.startLine)},this.checkViewportVisibility=function(){var e,t,n,r=C.getRealCenterNode();r&&!C.isScrolling()&&(he()(r).find("."+wo).length||he()(r).closest("."+wo).length||C.placeholderInfo.find(function(e){return e.placeholder.contains(r)}))&&((e=C.editor.domToRep(r))||(console.log("DomRep is null, center node id",r.id),console.log("placeholder range",C.getPlaceholderRange(r))),C.debugMode=!0,t=(null===e||void 0===e?void 0:e.selStart[0])||0,n=C.getViewportCenterLine(),console.log("Real viewport center line: ",t),console.log("Real center line activation: ",C.linesStatus[sr][t].isActive),console.log("Current viewport center line: ",n),console.log("Current center line activation: ",C.linesStatus[sr][n].isActive),console.log("Current buffer range: ",C.bufferRange),console.log("Latest buffer range: ",C.getLatestBufferRange(n)),console.log("root node offsetHeight",C.editor.docbody.offsetHeight),console.log("preRenderer offsetHeight",C.preRenderer.root.offsetHeight),console.log("last handleScroll timestamp",C.handleScrollTimestamp),Ue("Doc viewport is invisible!"),C.debugMode=!1),C.editor.updateActivationTimer||C.isScrolling()||C.editor.getInInternationalComposition()||!C.placeholderInfo.every(function(e){return e.status===Il.DONE})||!C.checkElementPosition()?C.watchdogTimer=window.setTimeout(C.checkViewportVisibility,Bl):Ue("[]!")},this.checkElementPosition=function(){var f=C.editor.getRep(sr).lines,h=!1;return C.placeholderInfo.forEach(function(e){var t,n,r,i,o,a,s=e.range,l=e.placeholder,c=ve(s,2),u=c[0],d=c[1];0<=u-1&&((o=f.atIndex(u-1))&&o.lineNode?o.lineNode!==l.previousElementSibling&&(console.log("previousSibling wrong position!!!"),console.log("placeholder range",s),console.log("placeholder id",l.id),console.log("real previousSibling class",o.lineNode.className),console.log("current previousSibling class",null===(t=l.previousElementSibling)||void 0===t?void 0:t.className),a=f.indexOfKey(null===(n=l.previousElementSibling)||void 0===n?void 0:n.id),console.log("current previousSibling line",a),h=!0):console.log("entry , ",u-1)),d+1<f.length()&&((o=f.atIndex(d+1))&&o.lineNode?o.lineNode!==l.nextElementSibling&&(console.log("nextSibling wrong position!!!"),console.log("placeholder range",s),console.log("placeholder id",l.id),console.log("real nextSibling class",o.lineNode.className),console.log("current nextSibling class",null===(r=l.nextElementSibling)||void 0===r?void 0:r.className),a=f.indexOfKey(null===(i=l.nextElementSibling)||void 0===i?void 0:i.id),console.log("current nextSibling line",a),h=!0):console.log("entry , ",d+1))}),h},this.getRealCenterNode=function(){var t,e,n=window.innerWidth/2,r=window.innerHeight/2,i=document.elementFromPoint(n,r);if(C.editor.docbody.contains(i)){if(C.editor.docbody!==i)return i;var o=Array.from(i.childNodes),a=C.getCenterOffsetY();try{for(var s=ge(o),l=s.next();!l.done;l=s.next()){var c=l.value;if(c instanceof HTMLElement&&!c.classList.contains(As)&&c.offsetTop+C.getOffsetTopToScroller()>=a)return c}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.debugLog=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];C.debugMode&&console.log.apply(console,me(e))},this.reset=function(){C.unbindEvent(),C.timer&&(clearTimeout(C.timer),C.timer=null),C.fiberTaskId&&(C.editor.fiber.cancelTask(C.fiberTaskId),C.fiberTaskId=null),C.requestIdMap.size&&(C.requestIdMap.forEach(function(e,t){cancelAnimationFrame(t)}),C.requestIdMap.clear()),C.requestCbId&&(clearTimeout(C.requestCbId),C.requestCbId=null),C.renderEndId&&cancelAnimationFrame(C.renderEndId),C.preRenderer.destroy()},this.initZoneLineStatus=function(e){var t=C.editor.getRep(e);!C.linesStatus[e]&&t&&(C.linesStatus[e]=me(new Array(t.alines.length)).map(function(){return C.createLineStatus(!1,!1)}))};var t=e.editor,n=e.config;this.editor=t;var r=he()(t.docbody);this.docLineHeight=parseFloat(r.css("line-height"))||26,this.scroller=this.editor.getScrollContainer()||window,this.lastScrollTop=this.scroller instanceof Window?this.scroller.scrollY:this.scroller.scrollTop,this.updateConfig(n),this.bindEvent(),this.preRenderer=new nl(this.editor)}var zl=(Hl.prototype.checkIgnore=function(t){return this.ignoreHTMLAttributes.some(function(e){return!!he()(t).closest("["+e+"]").length})},Hl.prototype.destroy=function(){this.mutationObserver.disconnect(),this.handleDirtyRanges.cancel()},Hl);function Hl(e){var _=this;this.dirtyRangesByZone={},this.removedNodes=[],this.addedNodes=[],this.modifiedNodes=[],this.didPostProcess=!1,this.currentlyNotRecordingMutations=!1,this.ignoreHTMLAttributes=["data-ignore-mutation"],this.shouldIgnoreAssert=!1,this.assert=function(e,t,n){if(void 0===n&&(n=!1),!e){var r=new Error("assertDirtyRangesCheckOut failed: "+t);throw n&&_.editor.call("error",{from:"etherpad",message:t,e:r}),r}},this.assertDirtyRangesLength=function(e,t,n){var r,i,o,a=n.reduce(function(e,t){return e+t.nodes.length-t.numDeleted},0),s=t.childElementCount,l=e===sr?_.editor.blockRender.getDocChildElementCount():_.editor.getRep(e).lines.length(),c=l===s-a;c||(_.editor.log("zoneId",e),_.editor.log("lineLength",l),_.editor.log("rootlength",s),_.editor.log("delta",a),n.forEach(function(e,t){_.editor.log("range "+t+", delete "+e.numDeleted+", add "+e.nodes.length)}),i=(r=_.editor.blockRender.getLinesStatusDetail()).activeLines,o=r.retainedLines,_.editor.log("activeLines",i[sr]),_.editor.log("retainedLines",o[sr]),_.editor.log("this.dirtyrange string",_.getDirtyInfoAsString())),_.assert(c,"length of dom does not match",!0)},this.assertDirtyRangesCheckOut=function(e,t){for(var n,r,i,o,a,s,l=0;l<t.length;l++){var c=t[l];if(_.assert(0<c.numDeleted||0<c.nodes.length,"dirty range is no-op"),_.assert(0<=c.start,"start must be >= 0"),_.assert(c.start+c.numDeleted<=e.lines.length(),"end too big"),0<l){var u=t[l-1];if(!(u.start+u.numDeleted<c.start)){var d=!1;try{for(var f=(n=void 0,ge(Object.keys(_.dirtyRangesByZone))),h=f.next();!h.done;h=f.next()){var p=h.value,g=_.dirtyRangesByZone[p];try{for(var v=(i=void 0,ge(g)),m=v.next();!m.done;m=v.next()){var y=m.value;try{for(var b=(a=void 0,ge(y.nodes)),E=b.next();!E.done;E=b.next()){var k=E.value;if(k&&k.id&&!document.getElementById(k.id)){d=!0;break}}}catch(e){a={error:e}}finally{try{E&&!E.done&&(s=b.return)&&s.call(b)}finally{if(a)throw a.error}}}}catch(e){i={error:e}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}d&&_.editor.log("some dirty node has been removed from dom tree")}_.assert(u.start+u.numDeleted<c.start,"ranges overlap")}}},this.getDirtyRangesByZone=function(){return _.msBrowser&&_.msiePostProcess(),_.dirtyRangesByZone},this.isNodeDirty=function(e){var t,n,r,i;if(_.editor.enableUnmountNode&&_.editor.blockRender.isPlaceholderNode(e))return!0;if(_.msBrowser&&!_.didPostProcess)return-1!==_.removedNodes.indexOf(e)||-1!==_.addedNodes.indexOf(e)||-1!==_.modifiedNodes.indexOf(e);try{for(var o=ge(Object.keys(_.dirtyRangesByZone)),a=o.next();!a.done;a=o.next()){var s=a.value,l=_.dirtyRangesByZone[s];try{for(var c=(r=void 0,ge(l)),u=c.next();!u.done;u=c.next())if(-1!==u.value.nodes.indexOf(e))return!0}catch(e){r={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!1},this.withoutRecordingMutations=function(e){if(_.currentlyNotRecordingMutations)return e();var t=void 0;try{_.currentlyNotRecordingMutations=!0,_.mutationObserver.takeRecords().forEach(function(e){_.editor.dom.isCurrentContext(_.editor.dom.getRootNodeForDom(e.target))&&_.handleCheckObserver(e)}),t=e()}finally{_.currentlyNotRecordingMutations=!1,_.mutationObserver.takeRecords().forEach(function(e){})}return t},this.checkObserverNode=function(e){var t=_.editor.dom.getTopLevelNode(e);t&&(t._magicdom_dirtiness&&t._magicdom_dirtiness.isManagedLine||(t._magicdom_isdirty||t._magicdom_dirtiness)&&_.handleMutation(_.editor.dom.zoneOfTopLevelNode(t),null,t,1,[t]))},this.isCurrentlyRecordingMutations=function(){return!_.currentlyNotRecordingMutations},this.handleObserverCallback=function(e){var n;_.currentlyNotRecordingMutations||!_.editor.isEditable()?e&&e.forEach(function(e){}):(e&&e.forEach(function(e){_.editor.dom.isCurrentContext(_.editor.dom.getRootNodeForDom(e.target))&&_.handleCheckObserver(e)}),(_.msBrowser||_.hasAnyDirtyRanges())&&(_.handleDirtyRanges(),_.shouldIgnoreAssert||e&&e.some(function(e){return Array.from(e.removedNodes||[]).some(function(e){return _.editor.docbody.contains(e)})})||_.msBrowser||(n=_.getDirtyRangesByZone(),Object.keys(n).forEach(function(e){var t=_.editor.dom.rootNodeOfZone(e);_.assertDirtyRangesLength(e,t,n[e])})),_.editor.isSelectingAll&&_.editor.inCallStackIfNecessary("selectAllIncorp",function(){_.editor.fastIncorp()})),_.callback&&_.callback(e))},this.handleCheckObserver=function(e){var t,n,r;_.checkIgnore(e.target)||("attributes"===(t=e.type)&&e.target.getAttribute(e.attributeName)===e.oldValue||(_.msBrowser?_.msieHandleMutationRecord(e):"characterData"===t||"attributes"===t?_.checkObserverNode(e.target):"childList"===t&&(e.target.zoneId?(n=e.target.zoneId.value,r=Array.from(e.removedNodes).reduce(function(e,t){if(_.editor.blockRender instanceof Fl){var n=_.editor.blockRender.getPlaceholderRange(t);if(n)return _.shouldIgnoreAssert=!0,e+(n[1]-n[0]+1)}return e+1},0),_.handleMutation(n,e.previousSibling,null,r,Array.prototype.slice.call(e.addedNodes))):_.checkObserverNode(e.target))))},this.safeHasDirtyRanges=function(){return _.msBrowser?_.addedNodes.length||_.removedNodes.length||_.modifiedNodes.length:_.hasAnyDirtyRanges()},this.hasAnyDirtyRanges=function(){for(var e in _.msBrowser&&_.msiePostProcess(),_.dirtyRangesByZone)if(0<_.dirtyRangesByZone[e].length)return!0;return!1},this.onlyOneLineDirty=function(){var e=Object.keys(_.dirtyRangesByZone);return!(1<e.length||e[0]!==sr)&&_.dirtyRangesByZone[sr].every(function(e){return 1===e.nodes.length&&1===e.numDeleted})},this.getDirtyInfoAsString=function(){var t,e,n={},r="";try{try{for(var i=ge(Object.keys(_.dirtyRangesByZone)),o=i.next();!o.done;o=i.next()){var a=o.value;n[a]={};for(var s=_.dirtyRangesByZone[a].length,l=0;l<s;++l){n[a][l]={};for(var c=_.dirtyRangesByZone[a][l],u=0;u<c.nodes.length;++u)n[a][l][u]=_.dirtyRangesByZone[a][l].nodes[u].id}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}r=JSON.stringify(n)}catch(e){_.editor.log("get dirtyInfo failed")}return r},this.handleMutation=function(e,t,n,r,i){_.editor.call(gr,Dn.native);var o=_.dirtyRangesByZone[e]||[],a=_.handleMutationIndexOfStart(o,e,t,n),s=_.handleMutationIndexOfEnd(o,e,a,r),l=_.handleMutationDoDirtyRangesSplice(a,s,o,r,i);_.dirtyRangesByZone[e]=l,i.forEach(function(e){e._magicdom_isdirty=!0})},this.handleMutationIndexOfStart=function(e,t,n,r){var i,o;if(r)if(r._magicdom_isdirty){for(var a=0;a<e.length;a++){for(var s=0;s<e[a].nodes.length;s++)if(e[a].nodes[s]===r){i={clean:!1,indexOfRange:a,indexInRange:s};break}if(i)break}if(!i)throw new Error("handleMutation: firstNodeDeleted is dirty but not in any of the dirty ranges")}else{for(var l=_.editor.getReps()[t].lines.indexOfKey(r.id),c=0,a=0;a<e.length;a++){if(e[a].start>l){i={clean:!0,indexOfRange:a,indexInRange:l-c};break}c=e[a].start+e[a].numDeleted}i=i||{clean:!0,indexOfRange:e.length,indexInRange:l-c}}else if(n)if(n._magicdom_isdirty){for(a=0;a<e.length;a++){for(var u=0;u<e[a].nodes.length;u++)if(e[a].nodes[u]===n){i=u===e[a].nodes.length-1?{clean:!0,indexOfRange:a+1,indexInRange:0}:{clean:!1,indexOfRange:a,indexInRange:u+1};break}if(i)break}if(!i)throw new Error("handleMutation: previousSibling is dirty but not in any of the dirty ranges")}else{-1!==(l=_.editor.getReps()[t].lines.indexOfKey(n.id))||(o=_.editor.getPositionForPoint(t,{node:n,index:0,maxIndex:1}))&&(l=o.line);for(c=0,a=0;a<e.length;a++){if(e[a].start>l){i=l===e[a].start-1?{clean:!1,indexOfRange:a,indexInRange:0}:{clean:!0,indexOfRange:a,indexInRange:l-c+1};break}c=e[a].start+e[a].numDeleted}i=i||{clean:!0,indexOfRange:e.length,indexInRange:l-c+1}}else i=0<e.length&&0===e[0].start?{clean:!1,indexOfRange:0,indexInRange:0}:{clean:!0,indexOfRange:0,indexInRange:0};return i.clean||0!==e[i.indexOfRange].nodes.length||(i={clean:!0,indexOfRange:i.indexOfRange+1,indexInRange:0}),i},this.flush=function(){_.dirtyRangesByZone={},_.removedNodes=[],_.addedNodes=[],_.modifiedNodes=[],_.didPostProcess=!1,_.shouldIgnoreAssert=!1},this.handleMutationIndexOfEnd=function(e,t,n,r){for(var i={clean:n.clean,indexOfRange:n.indexOfRange,indexInRange:n.indexInRange},o=r;0<o;){var a=o;if(i.clean){var s,l=i.indexOfRange;(s=(l===e.length?_.editor.getReps()[t].lines.length():e[l].start)-(0===l?0:e[l-1].start+e[l-1].numDeleted)-i.indexInRange)<=o?(e.length===l?i.indexInRange+=o:i=0===e[l].nodes.length?{clean:!0,indexOfRange:l+1,indexInRange:0}:{clean:!1,indexOfRange:l,indexInRange:0},o-=s):(i.indexInRange+=o,o=0)}else{if((s=e[i.indexOfRange].nodes.length-i.indexInRange)<0)throw new Error("leftInRange < 0 (dirty case)");s<=o?(i={clean:!0,indexOfRange:i.indexOfRange+1,indexInRange:0},o-=s):(i.indexInRange+=o,o=0)}if(a<=o)throw new Error("leftToDelete did not decrease")}return i},this.handleMutationDoDirtyRangesSplice=function(e,t,n,r,i){var o=[];if(e.clean&&0<e.indexInRange&&t.clean&&e.indexOfRange===t.indexOfRange)var a=0===e.indexOfRange?0:n[e.indexOfRange-1].start+n[e.indexOfRange-1].numDeleted,s=e.indexInRange+a,o=n.slice(0,e.indexOfRange).concat([{start:s,numDeleted:r,nodes:i}]).concat(n.slice(e.indexOfRange));else{for(var l=void 0,c=void 0,u=void 0,d=void 0,f=void 0,f=e.clean?0===e.indexInRange&&0<e.indexOfRange?(l=n[u=e.indexOfRange-1].nodes,n[u].start):(l=[],(0===(u=e.indexOfRange)?0:n[u-1].start+n[u-1].numDeleted)+e.indexInRange):(l=n[u=e.indexOfRange].nodes.slice(0,e.indexInRange),n[u].start),c=t.clean?(d=t.indexOfRange-1,[]):n[d=t.indexOfRange].nodes.slice(t.indexInRange),h=r+l.length+c.length,p=u;p<=d;p++)h+=n[p].numDeleted-n[p].nodes.length;var g=l.concat(i).concat(c);o=n.slice(0,u).concat(0===h&&0===g.length?[]:[{start:f,numDeleted:h,nodes:g}]).concat(n.slice(d+1))}return o},this.setObserverCallback=function(e){_.callback=e},this.observeNode=function(e){_.mutationObserver.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!0})},this.msieHandleMutationRecord=function(e){var t,n,r,i;try{for(var o=ge(e.addedNodes),a=o.next();!a.done;a=o.next()){var s=a.value;_.addedNodes.push(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}try{for(var l=ge(e.removedNodes),c=l.next();!c.done;c=l.next()){s=c.value;_.removedNodes.push(s)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}var u=_.editor.dom.getTopLevelNode(e.target);u&&(u._magicdom_dirtiness&&u._magicdom_dirtiness.isManagedLine||_.modifiedNodes.push(u))},this.msiePostProcess=function(){var t,e,n,r,i,o,a,s,T,O,w=_.editor.getReps();if(!_.didPostProcess){_.didPostProcess=!0;try{for(var l=ge(_.modifiedNodes),c=l.next();!c.done;c=l.next()){var u=c.value;_.addedNodes.push(u),_.removedNodes.push(u)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}var d={},R={};try{for(var f=ge(_.addedNodes),h=f.next();!h.done;h=f.next()){var p,g,v=u=h.value,m=v.parentNode;m&&_.editor.dom.isRootOfZone(m)&&((S=m.zoneId.value)in R||(R[S]=[],d[S]=!0),g=Array.prototype.indexOf.call(m.childNodes,v),!_.editor.enableUnmountNode||(p=_.editor.blockRender.getPlaceholderAboveNode(v))&&(g=Array.prototype.indexOf.call(m.childNodes,v)-Array.prototype.indexOf.call(m.childNodes,p.placeholder)+p.range[1]),R[S].push({index:g,node:v}))}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}var x={};try{for(var y=ge(_.removedNodes),b=y.next();!b.done;b=y.next()){var E,k,C=u=b.value;C._magicdom_dirtiness&&((E=C._magicdom_dirtiness.zone)in x||(x[E]=[],d[E]=!0),k=w[E].lines.indexOfKey(C.id),x[E].push({index:k,node:C}))}}catch(e){i={error:e}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}var I=function(e){var t=_.editor.dom.rootNodeOfZone(e),n=R[e]||[],r=x[e]||[],i=function(e,t){return e.index-t.index};n.sort(i),r.sort(i);for(var o=_.msieDedup(n),a=_.msieDedup(r),s=[],l=0,c=0,u=0;l<o.length||c<a.length;){var d=o[l],f=a[c],h=void 0,p=null;!d||f&&f.index<=d.index-u?(p={start:f.index,numDeleted:1,nodes:[]},h=f.node,c++):(p={start:d.index-u,numDeleted:0,nodes:[d.node]},h=d.node,l++);var g=p.start+u,v=0===s.length?0:s[s.length-1].start+s[s.length-1].numDeleted+u;if(_.editor.enableUnmountNode)for(var m=h.previousSibling,y=g-1;v<=y&&m;y--){if(m.id){if(!(k=w[e].lines.atIndex(y-u))||!k.isActive)break;if((null===(T=k.domInfo)||void 0===T?void 0:T.node)!==m)throw new Error("apparent clean node doesn't match up when searching below");break}p.start--,p.nodes=[m].concat(p.nodes),m=m.previousSibling}else for(y=g-1;v<=y;y--){var b=t.childNodes[y];if(b.id){if(b!==w[e].lines.atIndex(y-u).domInfo.node)throw new Error("apparent clean node doesn't match up when searching below");break}p.start--,p.nodes=[b].concat(p.nodes)}if(c===a.length||a[c].index>p.start+p.numDeleted){var E=p.start+p.nodes.length+u;if(_.editor.enableUnmountNode)for(var k,C=l<o.length?o[l].index:w[e].lines.length(),m=h.nextSibling,y=E;y<C&&m;y++){if(m.id){if(!(k=w[e].lines.atIndex(p.start+p.numDeleted))||!k.isActive)break;if((null===(O=k.domInfo)||void 0===O?void 0:O.node)!==m)throw new Error("apparent clean node doesn't match up when searching above");break}p.nodes.push(m),m=m.nextSibling}else for(C=l<o.length?o[l].index:t.childNodes.length,y=E;y<C;y++){var I=t.childNodes[y];if(I.id){if(I!==w[e].lines.atIndex(p.start+p.numDeleted).domInfo.node)throw new Error("apparent clean node doesn't match up when searching above");break}p.nodes.push(I)}}u+=p.nodes.length-p.numDeleted,s.push(p)}var S=[];s.forEach(function(e){var t;0===S.length?S.push(e):(t=S[S.length-1],e.start<=t.start+t.numDeleted?(t.numDeleted+=e.numDeleted,e.nodes.forEach(function(e){t.nodes.push(e)})):S.push(e))}),_.dirtyRangesByZone[e]=S};try{for(var S,M=ge(Object.keys(d)),N=M.next();!N.done;N=M.next())I(S=N.value)}catch(e){a={error:e}}finally{try{N&&!N.done&&(s=M.return)&&s.call(M)}finally{if(a)throw a.error}}}},this.msieDedup=function(e){for(var t=[],n=0;n<e.length;n++)0<n&&e[n-1].index===e[n].index||t.push({index:e[n].index,node:e[n].node});return t},this.mutationObserver=new MutationObserver(this.handleObserverCallback),this.editor=e.editorInfo,this.handleDirtyRanges=Object(y.default)(this.editor.idleWorkTimer.idleActionFn,500),this.msBrowser=Ce.msie||Ce.msedge}var Ul=(Vl.prototype.incorpDisposalInfo=function(e){var t,n,r=[],i={},o={},a=Object(_.a)(e);try{for(var s=ge(Array.from(a)),l=s.next();!l.done;l=s.next()){var c=l.value,u=this.editor.repManager.getRep(c.zone);if(u)for(var d=c.start;d<c.end;d++){var f,h=u.lines.atIndex(d);h.domInfo&&h.domInfo.lineManagerType&&(Oo(h.domInfo.node)&&r.push(h.domInfo.node.lineManager),(f=this.editor.managers.getChildZonesAtLine(c.zone,d)).text.forEach(function(e){var t;i[e]||(i[e]=!0,(t=this.editor.repManager.reps[e])&&a.push({start:0,end:t.lines.length(),zone:e}))}),f.rows.forEach(function(e){o[e]="row"}),f.cols.forEach(function(e){o[e]="col"}))}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return{lineManagers:Object(I.a)(r),deletedZones:i,vectorZonesToClear:o}},Vl.prototype.getDirtyDetailInfo=function(t,e){var n=this,r=n.editor,i=n.observer,o=[],a=r.dom.rootNodeOfZone(t);if(!a.firstChild){if(1===e.length&&0===e[0].start&&0===e[0].nodes.length)throw new Error("wut - the dirty ranges don't make sense");a.innerHTML="<div>\x3c!-- --\x3e</div>",e[0].nodes=[a.firstChild]}return i.assertDirtyRangesCheckOut(r.repManager.reps[t],e),e.forEach(function(e){o.push({zone:t,start:e.start,end:e.start+e.numDeleted,numNewNodes:e.nodes.length})}),o},Vl.prototype.getAssoc=function(e,t){return e["_magicdom_"+t]},Vl.prototype.markNodeDirty=function(e){he()(e).addClass("dirtynode")},Vl.prototype.setAssoc=function(e,t,n){e["_magicdom_"+t]=n},Vl);function Vl(e){var b=this;this.editor=e,this.observedChanges={cleanNodesNearChanges:{}},this.getObserver=function(){return b.observer},this.observeChangesAroundSelection=function(){var e,t,n,r=b.editor,i=b.topLevel,o=r.getCurrentCallStack,a=r.selection.getSelection,s=o();s.observedSelection||(s.observedSelection=!0,(e=a())&&(t=i(e.startPoint.node),n=i(e.endPoint.node),t&&b.observeChangesAroundNode(t),n&&t!==n&&b.observeChangesAroundNode(n)))},this.topLevel=function(e){var t=b.editor.getDocBody();if(!e||e===t)return null;for(;e&&e.parentNode!==t;)e=e.parentNode;return e},this.shouldIgnore=function(e){var t=e.children,n=t&&t[0];return-1<(n&&Array.prototype.slice.call(n.classList||[""])||[""]).indexOf("ignore-dom")},this.isNodeDirty=function(e){if(!b.editor.dom.isRootOfZone(e.parentNode))return!0;var t=b.getAssoc(e,"dirtiness");return!t||(e.id!==t.nodeId||(!(t.isManagedLine||!b.observer.isNodeDirty(e))||(e.className&&e.className.indexOf(Ei),!1)))},this.observeChangesAroundNode=function(e){var t,n,r,i,o,a,s,l,c=b.isNodeDirty,u=b.observedChanges,d=b.editor,f=d.editorBase.uniqueId,h=d.getRep();if(c(e)){for(var p=e.previousSibling;p&&c(p);)p=p.previousSibling;if(p)t=p;else{for(var g=e.nextSibling;g&&c(g);)g=g.nextSibling;g&&(t=g)}if(!t)return;y=!0}else var v=(t=e).previousSibling,m=t.nextSibling,y=v&&c(v)||m&&c(m);y?u.cleanNodesNearChanges["$"+f(t)]=!0:(n=f(t),v=t.previousSibling,m=t.nextSibling,r=v&&f(v)||null,i=m&&f(m)||null,o=h.lines.prev(h.lines.atKey(n)),a=h.lines.next(h.lines.atKey(n)),s=o&&o.key||null,l=a&&a.key||null,r===s&&i===l||(u.cleanNodesNearChanges["$"+f(t)]=!0))},this.observeSuspiciousNodes=function(){},this.getCleanNodeByKey=function(e){for(var t=b.isNodeDirty,n=document,r=n.getElementById(e);r&&t(r);)r.id="",r=n.getElementById(e);return r},this.isConsecutive=function(e){var t,n,r=b.editor.getDocBody(),i=b.isConsecutiveCache,o=b.cleanNodeForIndex;return void 0===i[e]&&(i[e]=(t=o(e-1),n=o(e),!(!t||!n)&&(!0===t&&!0===n?!r.firstChild:(!0!==t||!n.previousSibling)&&((!0!==n||!t.nextSibling)&&(!0===t||!0===n||t.nextSibling===n))))),i[e]},this.getDirtyRanges=function(){var t,e,n=b.detectChangesAroundLine,r=b.editor,i=b.splitRange,o=b.isConsecutive,a=b.observedChanges,s=r.getRep();b.cleanNodeForIndexCache={};var l=s.lines.length();b.isConsecutiveCache={},b.correctedLines={};var c=b.cleanRanges=[[-1,l+1]];if(0===l)o(0)||i(0,0);else{n(0,1),n(l-1,1);try{for(var u=ge(Object.keys(a.cleanNodesNearChanges)),d=u.next();!d.done;d=u.next()){var f=d.value.substring(1);s.lines.containsKey(f)&&n(s.lines.indexOfKey(f),2)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}}for(var h=[],p=0;p<c.length-1;p++)h.push([c[p][1],c[p+1][0]]);return h},this.isClean=function(e){return!!(0,b.cleanNodeForIndex)(e)},this.cleanNodeForIndex=function(e){var t,n=b.cleanNodeForIndexCache,r=b.editor,i=b.getCleanNodeByKey,o=r.getRep(),a=o.lines.length();return void 0===n[e]&&(t=void 0,t=e<0||a<=e||(i(o.lines.atIndex(e).key)||!1),n[e]=t),n[e]},this.removeLineFromRange=function(e,t){var n=b.cleanRanges,r=n[e][0],i=n[e][1];r+1===i?n.splice(e,1):t===r?n[e][0]++:t===i-1?n[e][1]--:n.splice(e,1,[r,t],[t+1,i]),b.cleanRanges=n},this.rangeForLine=function(n){var e=b.cleanRanges,r=-1;return Object(B.a)(e,function(e,t){if(!(n>=e[1]))return!(n<e[0])&&void(r=t)}),r},this.splitRange=function(e,t){var n=b.cleanRanges,r=n[e][0],i=n[e][1];b.cleanRanges.splice(e,1,[r,t],[t,i])},this.correctlyAssignLine=function(e){var t=b.rangeForLine,n=b.correctedLines,r=b.isClean,i=b.removeLineFromRange,o=b.isConsecutive,a=b.splitRange,s=b.cleanRanges;if(n[e])return!0;n[e]=!0;var l=t(e),c=r(e);if(l<0)return c&&b.editor.log("somehow lost clean line"),!0;if(c){var u=s[l][0],d=s[l][1],f=!1;return u<e&&r(e-1)&&!o(e)&&(a(l,e),f=!0),e+1<d&&r(e+1)&&!o(e+1)&&(a(l,e+1),f=!0),!f}return i(l,e),!1},this.detectChangesAroundLine=function(e,t){for(var n=b.correctlyAssignLine,r=b.editor.getRep().lines.length(),i=0,o=e;i<t&&0<=o;)n(o)?i++:i=0,o--;for(i=0,o=e;i<t&&o<r;)n(o)?i++:i=0,o++},this.markNodeClean=function(e,t){var n;(t=t||b.editor.dom.getEntryForNode(e))?(e.className&&-1<e.className.indexOf("single-line")&&(t.domInfo.lineManagerType="single-line"),(n={}).nodeId=b.editor.editorBase.uniqueId(e),n.isManagedLine=!!(t&&t.domInfo&&t.domInfo.lineManagerType),n.zone=t.zone,b.setAssoc(e,"dirtiness",n),b.setAssoc(e,"isdirty",!1)):b.editor.log("lineEntry is emptry")},this.clearObservedChanges=function(){b.observedChanges={cleanNodesNearChanges:{}}},this.clear=function(){b.clearObservedChanges()},this.editor=e,this.observer=new zl({root:e.getDocBody(),editorInfo:e}),e.observer=this.observer,e.getObserver=this.getObserver}var Wl=["author","lineguid","blockquote","insertorder","lmkr","list","origin-start","start","heading","strikethrough","bold","underline","italic","inline-code","fake","text-indent","mention-id","sheet-id","sheet-token","mention","backcolor","horizontal-line","align","lang","at-holder","colWidth","image-uploaded","link_background","aceTable","gallery"],Kl=["url-","mention-link_","mention-tempId_","mention-token_","mention-type_","mention-id_","mention-chatId_","comment-id-","at-uuid_","comment-resolved-"];function Zl(e){return Object.values(e.numToAttrib).map(function(e){var t=ve(e,1)[0];if(!me(Wl,Kl).some(function(e){return t.includes(e)}))return"**";var n=new RegExp("("+Kl.join("|")+")(.*)","gi");return t.replace(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e[1]+e[2].replace(/\w/g,"*")})})}var Gl={applyChangesToBase:1,doToggleCheckBox:1,dropImageEvent:1,dropImage:1,applyDrop:1,performImageStyle:1,"set-collapse":1,tableMergeCell:1},ql=30,Jl={IGNORE_TYPE:["idleWorkTimer"],COMPOSE_TYPE:["handleKeyEvent"]},Yl=(Ql.logRotate=function(e){return e&&e.length>ql?e.slice(e.length-ql):e},Ql.prototype.reset=function(){this.currentCallStack=null,this.callStackLogs=[]},Ql.prototype.dispose=function(){this.disposed=!0},Ql.prototype.isScrollableEditEvent=function(e){return!Gl[e]},Ql.prototype.getLogs=function(){var o=this;try{var e=Object(I.a)(this.callStackLogs.map(function(e){return e.logInfo?e.logInfo.zoneId:"0"})).reduce(function(e,t){var n=o.editor.getRep(t),r=n.alltext,i=n.alines;return e[n.zoneId]={text:Ze(r),alines:i},e},{});return{list:this.callStackLogs,apool:Zl(this.editor.getApool()),repsInfo:e}}catch(e){return{}}},Ql.prototype.storeCallStack=function(e,t){try{if(Jl.IGNORE_TYPE.includes(e.type))return;var n=this.callStackLogs[this.callStackLogs.length-1];if(Jl.COMPOSE_TYPE.includes(e.type)&&n&&n.type===e.type)return n.logInfo.times=n.logInfo.times||1,void n.logInfo.times++;var r=this.editor.getRep();this.callStackLogs.push(ue(ue({},e),{editEvent:ue(ue({},Object(W.default)(e,"editEvent",[])),{backset:Ke(Object(W.default)(e,"editEvent.backset","")||""),currentChangeset:Ke(Object(W.default)(e,"editEvent.currentChangeset","")||"")}),logInfo:ue(ue({},Object(m.default)(t,"shouldIncorp")),{zoneId:r.zoneId})})),this.callStackLogs=Ql.logRotate(this.callStackLogs)}catch(e){}},Ql);function Ql(e){var y=this;this.editor=e,this.disposed=!1,this.callStackLogs=[],this.currentCallStack=null,this.getCurrentCallStack=function(){return y.currentCallStack},this.getCurrentStack=function(){return y.getCurrentCallStack()},this.inCallStackIfNecessary=function(e,t,n){var r=y.currentCallStack,i=y.inCallStack;r?(n&&n.shouldIncorp&&y.editor.fastIncorp(),t()):i(e,t,n)},this.makeNewEvent=function(e,t,n){var r=y.currentCallStack,i=r.editEvent.eventType;y.editor.log("make new event is "+e+", preEventType is "+i),r.startNewEvent(e,void 0,n),t(),r.startNewEvent(i,void 0,n)},this.makeNondoableEvent=function(e,t){y.inCallStackIfNecessary(e,function(){y.makeNewEvent("nonundoable",function(){t(y.editor)})})},this.inCallStack=function(e,n,t){var r=y.disposed,a=y.editor,i=y.isScrollableEditEvent,o="idleWorkTimer"===e,s="handleKeyEvent"===e&&y.editor.getInInternationalComposition();o||s||y.editor.log("in call stack",e);var l=y.currentCallStack,c=a.selection.updateBrowserSelectionFromRep,u=(0,a.getRep)();if(!r){l&&console.error("Can't enter callstack "+e+", already in "+l.type);var d,f=(t=Object.assign({shouldIncorp:!0},t))&&t.shouldIncorp?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.fastIncorp(),n.apply.apply(n,me([y],e))}:n,l=y.currentCallStack={type:e,docTextChanged:!1,selectionAffected:!1,userChangedSelection:!1,domClean:!1,isUserChange:!1,preventScrolling:!1,repChanged:!1,editEvent:g(e,t),startNewEvent:m},h=!1;try{d=f(),y.editor.hook.callAll("aceEditEvent",{callstack:l,editorInfo:a,rep:u,documentAttributeManager:u.attributeManager}),y.editor.call("aceEditEvent",{callstack:l,editorInfo:a,rep:u,documentAttributeManager:u.attributeManager}),h=!0}finally{var p=Object(b.default)(l);y.storeCallStack(p,t),y.currentCallStack=null,h&&(v(p.editEvent,function(e){try{e.clearIsForceMergeOnCallStackEnd&&(delete e.isForceMerge,delete e.mergeEvent,delete e.mergeTarget,e.eventType+=(new Date).getTime().toString())}catch(e){console.error(e)}}),p.domClean&&"setup"!==p.type&&(p.selectionAffected&&c(),(p.docTextChanged||p.userChangedSelection)&&i(p.type)&&!p.preventScrolling&&ka(a)))}return d}function g(e,t){return Object.assign({eventType:e,backset:null},t)}function v(e,t){var n,r,i=a.undoModule;if(u.selStart&&u.selEnd&&(n=u.lines.offsetOfIndex(u.selStart[0])+u.selStart[1],r=u.lines.offsetOfIndex(u.selEnd[0])+u.selEnd[1],e.selStart=n,e.selEnd=r,e.selFocusAtStart=u.selFocusAtStart,e.selZone=u.zoneId),i.enabled){var o=!1;try{"setup"===e.eventType||"importText"===e.eventType||"setBaseText"===e.eventType?i.clearHistory():"nonundoable"===e.eventType?e.changeset&&i.reportExternalChange(e.changeset):i.reportEvent(e,t),o=!0}finally{o||(i.enabled=!1)}}}function m(e,t,n){var r=l.editEvent;return n&&n.mergeTarget===r.eventType&&(n.isForceMerge=!0,n.clearIsForceMergeOnCallStackEnd=!0,r.clearIsForceMergeOnCallStackEnd=!0),t||v(r),l.editEvent=g(e,n),r}},Object(B.a)(e.hooks.callAll("aceRegisterNonScrollableEditEvents"),function(e){Gl[e]=1})}var Xl=($l.prototype.destory=function(){},$l.prototype.getScrollXY=function(){var e=window,t=document;if("number"==typeof e.pageYOffset)return{x:e.pageXOffset,y:e.pageYOffset};var n=t.documentElement;return n&&"number"==typeof n.scrollTop?{x:n.scrollLeft,y:n.scrollTop}:{x:0,y:0}},$l.prototype.setScrollX=function(e){var t=this.getScrollY;scrollTo(e,t())},$l.prototype.getLineEntryTopBottom=function(e,t){var n=e.lineNode,r=n.offsetTop,i=n.offsetHeight,o=t||{};return o.top=r,o.bottom=r+i,o},$l);function $l(e){var s=this;this.editor=e,this.getViewPortTopBottom=function(){var e=(0,s.getScrollY)();return{top:e,bottom:e+document.documentElement.clientHeight}},this.getScrollX=function(){return(0,s.getScrollXY)().x},this.getScrollY=function(){return(0,s.getScrollXY)().y},this.setScrollY=function(e){var t=s.getScrollX;scrollTo(t(),e)},this.setScrollXY=function(e,t){scrollTo(e,t)},this.getVisibleLineRange=function(){var e=s.getViewPortTopBottom,t=s.getLineEntryTopBottom,n=s.editor.getRep(),r=e(),i={},o=n.lines.search(function(e){return t(e,i).bottom>r.top}),a=n.lines.search(function(e){return t(e,i).top>=r.bottom});return a<o&&(a=o),[o,a]}}var ec=(tc.prototype.id=function(){return this._id},tc);function tc(e){this._id=e}var nc=(rc.prototype.do=function(e){this.undoStack.push(e),this.redoStack=[]},rc.prototype.undo=function(){var e=this.undoStack.pop();if(e)return this.redoStack.push(e),e},rc.prototype.redo=function(){var e=this.redoStack.pop();if(e)return this.undoStack.push(e),e},rc.prototype.reset=function(){this.redoStack=[],this.undoStack=[]},rc.prototype.clearById=function(t){this.redoStack=this.redoStack.filter(function(e){return e.id()!==t}),this.undoStack=this.undoStack.filter(function(e){return e.id()!==t})},rc);function rc(){this.undoStack=[],this.redoStack=[]}var ic=(oc.init=function(){return new oc},oc.prototype.register=function(e){this.blocks.set(e.blockId,e)},oc.prototype.remove=function(e){var t=e.blockId;this.blocks.delete(t),this.stack.clearById(t)},oc.prototype.undo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r,i,o=this.stack.undo();o&&(n=o.id(),!this.blocks.has(n)||(r=this.blocks.get(n))&&(r.onUndo.apply(r,me(e)),r.preventScrollIntoView&&r.preventScrollIntoView.apply(r,me(e))||(i=this.blocks.get(ir),n!==ir&&i&&i.onBlockActive.apply(i,me(e)))))},oc.prototype.redo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n,r,i,o=this.stack.redo();o&&(n=o.id(),!this.blocks.has(n)||(r=this.blocks.get(n))&&(r.onRedo.apply(r,me(e)),r.preventScrollIntoView&&r.preventScrollIntoView.apply(r,me(e))||(i=this.blocks.get(ir),n!==ir&&i&&i.onBlockActive.apply(i,me(e)))))},oc.prototype.do=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];"string"==typeof t&&(t=new ec(t)),this.blocks.forEach(function(e){e.onDo(t)}),this.stack.do(t)},oc.prototype.clearHistory=function(){this.stack.reset()},oc);function oc(){this.blocks=new Map,this.stack=new nc}var ac=ic.init(),sc=Object.freeze({__proto__:null,BlockRef:ec,BlockUndoDispatcher:ic,default:ac}),lc="undoableEvent",cc="externalChange",uc=(dc.create=function(e){var t=new dc;return t.setUndoModule(e.undoModule),t},dc);function dc(){var h=this;this.setUndoModule=function(e){h.undoModule=e},this.clearStack=function(){h.stackElements.length=0,h.stackElements.push({elementType:lc,eventType:"bottom"}),h.numUndoableEvents=1},this.pushEvent=function(e){var t=ue(ue({},e),{elementType:lc});h.stackElements.push(t),h.numUndoableEvents++},this.pushExternalChange=function(e){var t=h.stackElements,n=h.undoModule,r=h.undoModule.editor.changesetHelper,i=t[t.length-1];i.elementType===cc?i.changeset=r.compose(i.changeset,e,n.apool):t.push({elementType:cc,changeset:e})},this._exposeEvent=function(e){for(var t,n,r,i,o,a=h.stackElements,s=h.undoModule,l=h.undoModule.editor.changesetHelper,c=s.apool,u=a.length-1-e,d=a.length-1,f=a[d];u<d||f.elementType===cc;)f.elementType===cc?(t=a[d-1],n=f.changeset,r=t.backset,"backset"in t&&t.backset&&(t.backset=l.follow(n,t.backset,!1,c),f.changeset=l.follow(r,f.changeset,!0,c)),"number"==typeof t.selStart&&(i=l._characterRangeFollow(n,t.selZone,t.selStart,t.selEnd),t.selStart=i[0],t.selEnd=i[1],t.selStart===t.selEnd&&(t.selFocusAtStart=!1)),a[d-1]=f,a[d]=t,o=a[d-2],2<=d&&o.elementType===cc&&(f.changeset=l.compose(o.changeset,f.changeset,c),a.splice(d-2,1),d--)):d--,f=a[d]},this.getNthFromTop=function(e){var t=h._exposeEvent,n=h.stackElements;return t(e),n[n.length-1-e]},this.numEvents=function(){return h.numUndoableEvents},this.popEvent=function(){return h._exposeEvent(0),h.numUndoableEvents--,h.stackElements.pop()},this.clearRedoStack=function(e){var r,i,t,n,o,a,s,l;0!==e&&(r=h.undoModule.apool,i=h.undoModule.editor.changesetHelper,t=h.stackElements.length-e-1,h._exposeEvent(h.stackElements.length-2),t=h.stackElements.length-e-1,n=h.stackElements.splice(t+1),o=h.stackElements.length&&h.stackElements[h.stackElements.length-1],a=n.length&&n[n.length-1],o&&a&&"number"==typeof a.selStart&&(o.selZone=a.selZone,o.selStart=a.selStart,o.selFocusAtStart=a.selFocusAtStart,o.selEnd=a.selEnd),s=n.reverse().reduce(function(e,t,n){return 0===n?t.backset:i.compose(e,t.backset,r)},""),h.numUndoableEvents=h.stackElements.reduce(function(e,t){return t.elementType===lc&&e++,e},0),i.isIdentity(s)||("backset"in(l=h.stackElements[t])?l.backset=i.compose(s,l.backset,r):l.backset=s))},this.stackElements=[],this.numUndoableEvents=0,this.clearStack()}var fc=(hc.prototype.setEditorInfo=function(e){this.editor=e},hc.prototype.setUndoDispatcher=function(e){var i=this;this.undoDispatcher=e,this.undoDispatcher.clearHistory();var t={blockId:ir,onUndo:function(){i.editor.callStack.inCallStackIfNecessary("undo",function(){i._performUndo()})},onRedo:function(){i.editor.callStack.inCallStackIfNecessary("redo",function(){i._performRedo()})},onDo:function(e){i.stack.clearRedoStack(i.undoPtr),i.undoPtr=0,e.id()===ir?i.canMerge=!0:i.canMerge=!1},onBlockActive:function(){var e,t=i.editor.getRep(),n=t.selStart[0],r=t.lines.atIndex(n);r&&(e=r.lineNode,window.requestAnimationFrame(function(){!pc(e)&&e&&e.scrollIntoView()}))}};this.undoDispatcher.register(t)},hc);function hc(e){var h=this;this.setEnabled=function(e){h.enabled=e},this.setApool=function(e){h.apool=e},this.setEventFunc=function(e){h.eventFunc=e},this.clearHistory=function(){h.stack.clearStack(),h.undoDispatcher.clearHistory(),h.undoPtr=0},this._charOccurrences=function(e,t){for(var n=0,r=0;0<=n&&n<e.length;)0<=(n=e.indexOf(t,n))&&(r++,n++);return r},this._opcodeOccurrences=function(e,t){var n,r,i=0,o=h.editor.changesetHelper.unpack(e);try{for(var a=ge(Object.keys(o)),s=a.next();!s.done;s=a.next()){var l=s.value;i+=h._charOccurrences(o[l].ops,t)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i},this._mergeChangesets=function(e,t,n){if(!e)return t;if(!t)return e;var r=h.editor.changesetHelper;if(n)return r.compose(e,t,h.apool);var i=h._opcodeOccurrences,o=i(e,"+"),a=i(t,"+"),s=i(e,"-"),l=i(t,"-");if(1===o&&1===a&&0===s&&0===l){var c=i(d=r.compose(e,t,h.apool),"+"),u=i(d,"-");if(1===c&&0===u)return d}else if(0===o&&0===a&&1===s&&1===l){var d,c=i(d=r.compose(e,t,h.apool),"+"),u=i(d,"-");if(0===c&&1===u)return d}return null},this.reportEvent=function(e,t){var n,r,i,o=h.stack,a=h._mergeChangesets,s=o.getNthFromTop(0),l=h.editor.changesetHelper;function c(){"number"==typeof e.selStart&&(s.selStart=e.selStart,s.selEnd=e.selEnd,s.selFocusAtStart=e.selFocusAtStart,s.selZone=e.selZone)}!e.backset||l.isIdentity(e.backset)?c():(n=!1,(s.eventType===e.eventType||e.isForceMerge)&&"bottom"!==s.eventType&&h.canMerge&&(r=void 0!==s.mergeEvent&&s.mergeEvent===e.mergeEvent,(i=a(e.backset,s.backset||"",r))&&(s.backset=i,c(),n=!0)),n||(h.undoDispatcher.do(new ec(ir)),o.pushEvent(e),h.editor.call("pushUndoEvent")),t&&t(o.stackElements[o.stackElements.length-1]),h.undoPtr=0)},this.reportExternalChange=function(e){var t=h.editor.changesetHelper;e&&!t.isIdentity(e)&&h.stack.pushExternalChange(e)},this._getSelectionInfo=function(e){return"number"!=typeof e.selStart?null:{selZone:e.selZone,selStart:e.selStart,selEnd:e.selEnd,selFocusAtStart:e.selFocusAtStart}},this._performUndo=function(){var e=h.stack,t=h.fixBackset,n=h._getSelectionInfo,r=h.editor.changesetHelper,i=e.numEvents();if(h.undoPtr<i-1){for(var o=e.getNthFromTop(h.undoPtr).backset,a=h.apool,s=h.undoPtr,l=h.undoPtr;l<i-1;l++){var c=e.getNthFromTop(l),u=e.getNthFromTop(l+1);if(!(c&&u&&u.backset&&t(c.backset||"")))break;o=r.compose(o,u.backset,a),s=l+1}var d=e.getNthFromTop(s+1);s>h.undoPtr&&(o=t(o||"",!0));try{var f=h.eventFunc("undo",o,n(d),!0);f.addNumber=s-h.undoPtr+2,h.undoPtr=f.addNumber+h.undoPtr,e.pushEvent(f)}catch(e){h.editor.log("e.reason",e.message),h.editor.log("perform undo call error stack: ",e.stack),Ue(e.message)}}else h.eventFunc("undo")},this.performUndo=function(){h.undoDispatcher.undo()},this.performRedo=function(){h.undoDispatcher.redo()},this._performRedo=function(){var e,t,n,r=h.stack,i=h._getSelectionInfo;2<=h.undoPtr?(e=r.getNthFromTop(0),t=r.getNthFromTop(1),n=e.backset,h.eventFunc("redo",n,i(t),!1),r.popEvent(),"addNumber"in e&&e.addNumber?h.undoPtr-=e.addNumber:h.undoPtr-=2):h.eventFunc("redo")},this.fixBackset=function(e,t){for(var n=h.apool,r=!1,i=/\*(\w+)/g,o=e.indexOf("$"),a=e.slice(0,o),s=e.slice(o+1),l=i.exec(a),c=!1;l;){var u=parseInt(l[1],36),d=n.numToAttrib[u]||[];(-1<d[0].indexOf("image-placeholder")||-1<d[0].indexOf("image-previewer"))&&(r=!0,e=e.replace(l[0],"")),-1!==d[0].indexOf("drive-loading")&&(c=r=!0,e=e.replace(l[0],"")),l=i.exec(a)}return s.match(/^ *$/)||c||(r=!1),t?e:r},this.reset=function(){h.clearHistory(),delete h.editor,delete h.apool,delete h.eventFunc,delete h.undoDispatcher},this.undoPtr=0,this.enabled=!0,this.setEnabled(e.enabled),this.setApool(e.apool),this.setEventFunc(e.eventFunc),this.setEditorInfo(e.editor),this.setUndoDispatcher(e.undoDispatcher||new ic),this.stack=uc.create({undoModule:this}),this.canMerge=!0}function pc(e){var t=e.getBoundingClientRect().left,n=e.getBoundingClientRect().top,r=Math.max(document.documentElement.clientWidth,window.innerWidth||0),i=Math.max(document.documentElement.clientHeight,window.innerHeight||0),o=e.clientWidth,a=e.clientHeight;return n<i&&0<n+a&&t<r&&0<t+o}var gc=vc;function vc(e){var i=this;this.editor=e,this.commandMap={},this.registerCommand=function(e,t,n){i.commandMap[e]={callback:i.wrapCallbackWithCallStack(e,t,n||{}),options:n}},this.registerAceCommand=function(e,t,n){i.registerCommand(e,t,n)},this.getAllRegistedCommands=function(){return i.commandMap},this.wrapCallbackWithCallStack=function(a,s,l){return function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=t.inCallStackIfNecessary,o=t.fastIncorp;i(a,function(){o(!0),t.callStack.makeNewEvent("triggerCommand",function(){s.apply(void 0,me([e,t,l],n)),t.activeCaret()},n[0])})}},this.triggerCommand=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=i.commandMap[e];i.editor.isEnabled()&&r&&r.callback.apply(r,me([e,i.editor],t))}}var mc=(yc.prototype.initZone=function(n){var e,r=this;this.cache[n]||(e=this.editor.getRep(n).alines.map(function(e,t){return r.getCacheOnLineInit(n,t)}),this.cache[n]=e)},yc.prototype.editorAlinesDidSplice=function(e,t){var n,r=this,i=t.zoneId,o=t.start,a=t.deleteCount,s=t.currentState;this.cache[i]?(n=s.alinesSplice.map(function(e,t){var n=o+t;return r.getCacheOnLineInit(i,n)}),this.splice(i,o,a,n)):this.initZone(i)},yc.prototype.splice=function(e,t,n,r){var i;this.cache[e]||this.initZone(e),(i=this.cache[e]).splice.apply(i,me([t,n],r))},yc.prototype.remove=function(e,t){this.splice(e,t,1,[null])},yc.prototype.add=function(e,t,n){this.splice(e,t,1,[n])},yc.prototype.has=function(e,t){return!!this.get(e,t)},yc.prototype.get=function(e,t){var n=this.cache[e];return n&&n[t]},yc.prototype.getAndRemove=function(e,t){var n=this.get(e,t);return n&&this.remove(e,t),n},yc.prototype.getLines=function(e){return this.cache[e]||[]},yc.prototype.size=function(e){var n=this;return void 0===e&&(e=""),(e?[e]:Object.keys(this.cache)).reduce(function(e,t){return e+n.cache[t].filter(function(e){return null!==e}).length},0)},yc.prototype.clear=function(){this.cache={}},yc.prototype.destroy=function(){this.clear()},yc);function yc(e){this.editor=e,this.cache={},this.editor.hooks.addPlugin(this),this.initZone(sr)}var bc,Ec=(ce(kc,bc=mc),kc.prototype.getCacheOnLineInit=function(){return null},kc);function kc(){return null!==bc&&bc.apply(this,arguments)||this}var Cc,Ic=(ce(Sc,Cc=mc),Sc.prototype.getCacheOnLineInit=function(e,t){var n=this.editor.repManager.reps[e].attributeManager.getAttributesOnLine(t).reduce(function(e,t){var n=ve(t,2),r=n[0],i=n[1];return"list"===r&&(e.listType=i),"ol-id"===r&&(e.listId=i),e},{});return n.listType?n:null},Sc);function Sc(e){var t=Cc.call(this,e)||this;return Object.keys(e.repManager.reps).forEach(function(e){t.initZone(e)}),t}var Tc,Oc,wc,Rc,Ac,xc,Mc,Nc,_c="PARTIAL_LOADING_STATUS_CHANGE",Lc=200,Dc=200,Bc=100,Pc=10,Fc=1e4;(Oc=Tc=Tc||{})[Oc.HIDE=0]="HIDE",Oc[Oc.SHOW=1]="SHOW",(Rc=wc=wc||{})[Rc.CANCELED=0]="CANCELED",Rc[Rc.RUNNING=1]="RUNNING",(xc=Ac=Ac||{}).isActive="isActive",xc.isRendered="isRendered",(Nc=Mc=Mc||{}).UP="UP",Nc.DOWN="DOWN",Nc.BOTH="BOTH";var jc=(zc.prototype.getCurrentBufferRange=function(){return this.bufferRange.slice()},zc.prototype.isSkipAboveRender=function(){return!1},zc.prototype.requestRenderAllForScroll=function(e,t,n,r){var i,o,a,s,l,c,u=this;this.enableOptimization()?(i=this.editor.getRep(sr).lines.length(),o=Math.min(i-1,e+1),this.getUnrenderedRanges(sr,0,o).forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];u.render(sr,n,r)}),a={bufferLine:e}):(a={bufferLine:e,forceRender:t,async:n},l=(s=ve(this.editor.blockRender.getCurrentBufferRange(),2))[0],c=s[1],e<l?a={start:e,end:c}:c<e&&(a={start:l,end:e})),this.requestRender(a,r)},zc.prototype.createLineStatus=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),{isActive:e,isRendered:t,hasComputed:!1,children:[]}},zc.prototype.withoutHandleScrolling=function(r,i){return void 0===i&&(i=!1),de(this,void 0,void 0,function(){var t,n=this;return pe(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,3,4]),this.disableHandleScrolling=!0,[4,r()];case 1:return e.sent(),[3,4];case 2:return t=e.sent(),console.error("Scroll Function Error: "+t),[3,4];case 3:return this.enableOptimization()||window.setTimeout(function(){n.computeNodeAndHide()},16),this.disableHandleScrolling=!1,i&&this.handleScroll(),[7];case 4:return[2]}})})},zc.prototype.getUnrenderedLine=function(o){var t,e,a=this,n=function(e){var t=a.linesStatus[e]||[],n=o[e]||[],r=n[n.length-1],i=Object(d.default)(r)?r:1/0;return t.findIndex(function(e,t){return!e.isRendered&&i<t&&!a.isLineCollapsed(t)})},r=[sr];try{for(var i=ge(r),s=i.next();!s.done;s=i.next()){var l=s.value,c=n(l);if(-1!==c)return{zoneId:l,lineNum:c}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return null},zc.prototype.getUncachedLine=function(l){var t,e,c=this,n=function(s){return c.editor.getRep(s).alines.findIndex(function(e,t){var n=(c.linesStatus[s]||[])[t],r=n&&n.isRendered,i=!1;i=l[s]?t<(l[s][0]||-1):(c.editor.managers.zoneToLineEntry[s]?c.editor.getLineNumInRootZone(s,t):-1)<((l[sr]||[])[0]||-1);var o=!c.domLineCache.has(s,t),a=s===sr&&c.isLineCollapsed(t);return!r&&i&&o&&!a})},r=Object.keys(this.editor.getReps());try{for(var i=ge(r),o=i.next();!o.done;o=i.next()){var a=o.value,s=n(a);if(-1!==s)return{zoneId:a,lineNum:s}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return null},zc.prototype.enableOptimization=function(){return this.config.open&&this.config.fiber},zc.prototype.renderZone=function(o,e){var a=this;void 0===e&&(e={});var t,n=this.editor,s=n.editorBase,l=n.repManager,r=e.range,c=e.indexToKey,u=e.activeLines||this.currentActiveLines&&this.currentActiveLines[o]||[],i=n.getRep(o),d=(i.alltext||"\n").slice(0,-1).split("\n"),f=i.alines;d.length!==f.length&&(t=Math.min(d.length,f.length),d=d.slice(0,t),f=f.slice(0,t));var h=r?r[0]:0,p=(r?r[1]:d.length-1)-h+1;return p<=0?[]:me(new Array(p)).map(function(e,t){return h+t}).map(function(e,t){var n=a.domLineCache.getAndRemove(o,e);if(n)return n;var r=u.includes(e)||!a.enableOptimization()?{text:d[e],attribs:f[e]}:{text:"",attribs:"|1+1"},i=c?c(e,t):void 0;return s.renderDomLine(r,l.apool,{currentLineIndex:e,zoneId:o},i)})},zc.prototype.getOffsetTopToScroller=function(){if(!this.config.considerOffsetTopToScroller)return 0;var e=this.scroller instanceof Window?document.body:this.scroller;return Po(this.editor.docbody,e)||0},zc);function zc(e){var x=this;this.allRendered=!1,this.linesStatus={},this.fiberTaskId=null,this.requestIdMap=new Map,this.loadingState=0,this.asyncNodeState={},this.callbackState={},this.isUsingBlockRendering=!1,this.bufferChangedNum=0,this.config={open:!1,buffer:1/0},this.scrolling=!1,this.bufferRange=[-1,-1],this.currentActiveLines={},this.latestActiveLines={},this.shouldCheckAll=!1,this.isFirstBlock=!0,this.disableHandleScrolling=!1,this.watchdogTimer=null,this.debugMode=!1,this.fiberActions=[],this.buffer=1/0,this.fiberRecord=new kl,this.renderStartTime=0,this.startRender=function(){var e=x.config.startLine,t=x.editor,n=t.hooks,r=t.getRep,i=t.getDocId,o=r(sr).lines.length();x.linesStatus[sr]=me(new Array(o)).map(function(){return x.createLineStatus()});var a,s,l,c=e&&0<=e&&e<o?e:0,u=(new Date).getTime();x.isFirstBlock=!0,x.renderStartTime=performance.now(),x.updateActivation({centerLine:c,forceRender:!0}),x.renderPlaceholder(),x.enableOptimization()?x.editor.fiber.switchScheduler({scheduler:"requestIdleCallback"}):(s=(a=x.config.autoRender)?a.intervalTime:0,x.editor.fiber.switchScheduler({scheduler:"setTimeout",timeout:s})),x.fiberRecord.start(),x.requestAutoRender(),x.isFirstBlock=!1,x.renderEndId=window.requestAnimationFrame(function(){n.callAll("editorRenderEnd",{renderTime:(new Date).getTime()-u,token:i()}),n.callAll("onPaint")}),c&&(l=x.getHeadingLineNumIfNecessary(c),Oa({selectionRange:{selZone:sr,selStart:[l,0],selEnd:[l,0]}},x.editor))},this.cancelCallback=function(e){x.callbackState[e]&&(x.callbackState[e]=wc.CANCELED)},this.renderAll=function(e){var t=x.editor.getRep(sr).lines.length();x.getUnrenderedRanges(sr,0,t-1).forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];x.render(sr,n,r,!0)});var i={};(function n(r){if(!x.linesStatus[r])return console.warn("linesStatus['"+r+"'] is undefined");x.linesStatus[r].forEach(function(e,t){i[r]||(i[r]=[]),i[r].push(t),x.editor.managers.getChildZonesAtLine(r,t).text.forEach(function(e){return n(e)})})})(sr),x.callForceRender(i,!0,e)},this.getIfRenderInScrolling=function(){return x.ifRenderInScrolling},this.isLineInBuffer=function(e,t){var n;if(e!==sr&&(t=x.editor.getLineNumInRootZone(e,t)),!x.isLineCollapsed(t))return x.getLineStatus(sr,t).isActive;var r=null===(n=x.editor.lineTracker.collapseLines)||void 0===n?void 0:n.getCollapsedStatusOfLine(e,t);return(null===r||void 0===r?void 0:r.headerLineNum)&&x.getLineStatus(sr,null===r||void 0===r?void 0:r.headerLineNum).isActive},this.requestRender=function(e,t){var n=e.start,r=e.end,i=e.extra,o=void 0===i||i,a=e.async,s=void 0===a||a,l=e.showLoading,c=e.source,u=e.bufferLine,d=e.forceRender;if(Object(T.default)(u)&&(Object(T.default)(n)||Object(T.default)(r)))return console.warn(" bufferLine  (start, end) ");var f=r&&o?r+x.config.buffer/2:r,h=x.editor.getRep(sr).lines.length()-1,f=Math.min(h,f||0);l&&x.showLoading(c);var p=x.createRenderId();return s?x.asyncRender(n,f,u,p,l,d,t):(Object(T.default)(u)?x.updateActivation({bufferRange:[n,f],forceRender:d}):x.updateActivation({centerLine:u,forceRender:d}),t&&t()),p},this.updateActivation=function(e){var t=e.centerLine,n=e.bufferRange,r=e.forceRender,i=e.usageState;if(Object(T.default)(t)&&!n)return console.warn(" centerLine  bufferRange !");var o,a=Object(T.default)(t)?x.getLatestActiveLinesForRange(n):x.getLatestActiveLines(t),s=x.getChangeLineRanges(a,x.currentActiveLines),l=s.activateRanges,c=s.deactivateRanges,u=(x.currentActiveLines=a)[sr].sort(function(e,t){return e-t});x.bufferRange=[u[0],u[u.length-1]],x.doActivationUpdateForZone({activateRanges:l,deactivateRanges:c}),!r&&x.enableOptimization()||(o=x.currentActiveLines,x.callForceRender(o,r,i))},this.getChangeLineRanges=function(d,f){var t,e,n,r,i=Object.keys(d),o=Object.keys(f),h={},p={},g={},a=function(e){var t,n;if(f[e]){var r=d[e],i=f[e].reduce(function(e,t){return e[t]=!0,e},{}),o={},a=[];try{for(var s=(t=void 0,ge(r)),l=s.next();!l.done;l=s.next()){var c=l.value;i[c]?o[c]=!0:a.push(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.length&&(h[e]=oa(a));var u=f[e].filter(function(e){return!o[e]});u.length&&(p[e]=oa(u)),g[e]=!0}else d[e].length&&(h[e]=oa(d[e]))};try{for(var s=ge(i),l=s.next();!l.done;l=s.next())a(v=l.value)}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}try{for(var c=ge(o),u=c.next();!u.done;u=c.next()){var v=u.value;!g[v]&&f[v].length&&(p[v]=oa(f[v]))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return{activateRanges:h,deactivateRanges:p}},this.getBufferRemained=function(e){var t=e.renderDir,n=e.buffer,r=e.lineNum,i=e.centerOffsetY,o=x.isLineCollapsed(r),a=x.editor.getRep(sr).lines.atIndex(r);if(o||!a||!a.lineNode)switch(t){case Mc.BOTH:return{upwardBufferSize:Math.ceil(n/2),downwardBufferSize:Math.floor(n/2)};case Mc.UP:return{upwardBufferSize:n,downwardBufferSize:0};case Mc.DOWN:return{upwardBufferSize:0,downwardBufferSize:n};default:throw new Error("Direction error!")}x.latestActiveLines[sr]||(x.latestActiveLines[sr]=[]),x.latestActiveLines[sr].push(r);var s=parseInt(va(x.editor)),l=a.lineNode.offsetHeight||s,c=Math.ceil(l/s);switch(t){case Mc.BOTH:var u=a.lineNode.offsetTop+x.getOffsetTopToScroller(),d=Math.min(Math.max(i-u,0),l),f=l-d,h=Math.floor(d/l*c),p=Math.ceil(f/l*c);return{upwardBufferSize:Math.ceil(n/2)-h,downwardBufferSize:Math.floor(n/2)-p};case Mc.UP:return{upwardBufferSize:n-c,downwardBufferSize:0};case Mc.DOWN:return{upwardBufferSize:0,downwardBufferSize:n-c};default:throw new Error("Direction error!")}},this.getLinesStatusDetail=function(){var e,t,n;return{activeLines:((e={})[sr]=x.currentActiveLines,e),retainedLines:((t={})[sr]=[],t),needUpdateLines:((n={})[sr]=[],n)}},this.getLatestActiveLines=function(e){x.latestActiveLines={};for(var t=x.buffer,n=x.editor.getRep(sr).lines.length(),r=x.getCenterOffsetY(),i=e,o=e,a=x.getBufferRemained({lineNum:i,buffer:t,renderDir:Mc.BOTH,centerOffsetY:r}),s=a.upwardBufferSize,l=a.downwardBufferSize;0<s&&0<i;)s=x.getBufferRemained({lineNum:--i,buffer:s,renderDir:Mc.UP,centerOffsetY:r}).upwardBufferSize;for(;0<l&&o<n-1;)l=x.getBufferRemained({lineNum:++o,buffer:l,renderDir:Mc.DOWN,centerOffsetY:r}).downwardBufferSize;return x.latestActiveLines},this.getLatestActiveLinesForRange=function(e){x.latestActiveLines={};for(var t=ve(e,2),n=t[0],r=t[1],i=n;i<=r;i++)x.getBufferRemained({lineNum:i,buffer:1/0,renderDir:Mc.DOWN,centerOffsetY:0});return x.latestActiveLines},this.callForceRender=function(e,t,n){void 0===n&&(n=x.getUsageState()),x.editor.observer.withoutRecordingMutations(function(){x.editor.hooks.callAll("aceForceRenderAll",{viewportLines:e,forceRender:t,usageState:n})})},this.updateActiveLines=function(e,n,t,r,i){var o,a,s,l,c;e===sr&&(o=t-r,x.currentActiveLines[e]||(x.currentActiveLines[e]=[]),0<=o?(a=Object(M.a)(n,n+o),s=i?[]:Object(M.a)(n,n+r),x.currentActiveLines[e]=x.currentActiveLines[e].map(function(e){if(n+o<=e){var t=e-o;return s.includes(t)?null:t}return a.includes(e)?null:e}).filter(function(e){return null!==e})):(l=Math.abs(o),c=i?Object(M.a)(n+1,n+l+1):[],x.currentActiveLines[e]=x.currentActiveLines[e].map(function(e){return n<e?e+l:e}).concat(c)))},this.toggleVirtualScrollMode=function(e){if(x.config.open){var t,n,r;if(Object(T.default)(e))t=!x.isUsingBlockRendering;else{if(x.isUsingBlockRendering===e)return;t=e}t?(x.buffer=x.config.buffer,n=x.getViewportCenterLine(),x.updateActivation({centerLine:n,usageState:t})):(x.buffer=1/0,r=x.editor.getRep(sr).lines.length(),x.renderAll(t),x.updateActivation({bufferRange:[0,r-1],forceRender:!0,usageState:t})),x.isUsingBlockRendering=t}},this.getUsageState=function(){return x.isUsingBlockRendering},this.isScrolling=function(){return x.scrolling},this.updateLinesStatus=function(e,t,n,r,i){var o,a,s=void 0===i?{}:i,l=s.isActive,c=void 0!==l&&l,u=s.isRendered,d=void 0===u||u;x.editor.getRep(e)&&(x.linesStatus[e]||x.initZoneLineStatus(e),a=me(new Array(r)).map(function(){return x.createLineStatus(c,d)}),(o=x.linesStatus[e]).splice.apply(o,me([t,n],a)))},this.getLinesStatus=function(){return x.linesStatus},this.getLineStatus=function(e,t){var n=x.editor.managers.zoneToLineEntry[e],r=x.linesStatus[e],i={isRendered:!1,isActive:!1,hasComputed:!1};if(!r)return console.warn("BlockRender.getLineStatus: no zone exists. "+e),i;var o=r[t];return o?ue(ue({},o),{isActive:(n||o).isActive}):(console.warn("BlockRender.getLineStatus: no line exists. "+e+" "+t),i)},this.getActiveLineRanges=function(e){return x.currentActiveLines[e]?oa(x.currentActiveLines[e]):[]},this.getBufferChangedNum=function(){return x.bufferChangedNum},this.resetBufferChangedNum=function(){x.bufferChangedNum=0},this.getCenterOffsetY=function(){return(x.scroller instanceof Window?x.scroller.scrollY+x.scroller.innerHeight/2:x.scroller.scrollTop+x.scroller.offsetHeight/2)||0},this.isInViewport=function(e,t){var n=x.editor.getLineNumInRootZone(e,t);if(!x.currentActiveLines[sr].includes(n))return!1;var r=x.editor.getRep(e).lines.atIndex(t);if(!r||!r.lineNode)return!1;var i=x.scroller instanceof Window?x.scroller.scrollY:x.scroller.scrollTop,o=i+(x.scroller instanceof Window?x.scroller.innerHeight:x.scroller.offsetHeight),a=(Po(r.lineNode,x.editor.docbody)||0)+x.getOffsetTopToScroller(),s=a+r.lineNode.offsetHeight;return i<a&&a<o||i<s&&s<o},this.getViewportLines=function(){var o=x.scroller instanceof Window?x.scroller.scrollY:x.scroller.scrollTop,e=x.scroller instanceof Window?x.scroller.innerHeight:x.scroller.offsetHeight,a=o+e,r={},s=x.currentActiveLines;return Object.keys(s).forEach(function(e){var t=s[e]||[],i=x.editor.getRep(e),n=t.filter(function(e){var t=i.lines.atIndex(e);if(!t||!t.lineNode)return!1;var n=t.lineNode.offsetTop+x.getOffsetTopToScroller(),r=n+t.lineNode.offsetHeight;return o<n&&n<a||o<r&&r<a});0<n.length&&(r[e]=n)}),r},this.getDocChildElementCount=function(){return x.linesStatus[sr].length},this.getViewportCenterLine=function(e,t){void 0===e&&(e=sr),void 0===t&&(t=x.getCenterOffsetY());var n=x.editor.getRep(e).lines,r=n.length(),i=0,o=r-1,a=Math.floor(r/2);for(x.debugLog("middle y: ",t);i<a&&a<o;){var s=x.getHeadingLineNumIfNecessary(a);if(o<=i)return s;var l=n.atIndex(s),c=l.lineNode,u=c.offsetTop*(l.zoom||1)+x.getOffsetTopToScroller(),d=c.offsetHeight*(l.zoom||1);if(x.debugLog("visible line top: ",u),u<=t&&t<=u+d)return s;a=t<u?(o=s,Math.floor((s+i)/2)):(i=a,Math.floor((a+o)/2))}return a},this.render=function(f,h,e,p,t){var g=x.editor,n=g.hooks,r=g.getDocId,i=g.observer,o=g.getRep(f),a=o.alltext,s=o.lines,l=s.length();e=l<=e?l-1:e;var v,c,m,y,u,b,d,E,k=g.dom.rootNodeOfZone(f);k instanceof HTMLElement&&(v=a.slice(0,-1).split("\n"),c=(new Date).getTime(),m=[],y=s.slice(h,e+1),u=Object(M.a)(h,e+1),b=x.renderZone(f,{range:[h,e],activeLines:u,indexToKey:function(e,t){var n;return null===(n=y[t])||void 0===n?void 0:n.key}}),x.isFirstBlock&&n.callAll("editorCalcEnd",{calcTime:(new Date).getTime()-c,token:r()}),i.withoutRecordingMutations(function(){for(var e=document.createDocumentFragment(),t=0,n=b.length;t<n;t++){var r,i=b[t].node,o=i.className,a=i.innerHTML,s=i.id,l=i.editable,c=i.dir,u=y[t],d=u.lineNode;d&&(x.isFirstBlock||k.removeChild(d),!1===l&&d.setAttribute("contenteditable","false"),s&&(d.id=s),d.className=o,d.innerHTML=a,c&&d.setAttribute("dir",c),r=t+h,p||x.isLineCollapsed(r)?Ao(d):(d.style.height="",d.style.margin=""),m.push(d),b[t].node=d,u.setDomInfo(ue(ue({},b[t]),{lineString:v[t+h],zone:f})),g.domLine.decorateMagicObjects(u),e.appendChild(d))}k.insertBefore(e,k.children.item(h))}),x.setLinesStatus(f,h,e,Ac.isRendered,!0),x.bindLoadStateEvent(m),d=function(e){return(x.linesStatus[e]||[]).every(function(e){return e.isRendered})},E=x.enableOptimization()?d(sr):x.linesStatus[sr].every(function(e){return e.isRendered}),n.callAll("lineNodesRendered",{type:"CLIENT_VARS",data:{isFirstBlock:x.isFirstBlock,isAllRendered:E,lineEntries:y,renderedLines:u}}),x.markNodesClean(y),E&&x.renderFinished(),x.editor.isSelectingAll&&x.editor.selection.selectAll())},this.nonFirstScreenRender=function(e,t,n){var r;if(void 0===n&&(n=!0),!(x.allRendered||x.linesStatus[sr].slice(e,t+1).every(function(e){return e.isRendered})||t<e)){for(var i=x.editor.getRep(sr).lines,o=[],a=e,s=i.atIndex(a)||null;a<=t&&s;a++,s=i.next(s))o.push(s);n?x.preRenderer.ensureScreenNoScroll(o,function(){x.render(sr,e,t,!n)}):x.render(sr,e,t,!n),x.callForceRender(((r={})[sr]=Object(M.a)(e,t+1),r))}},this.activateNodes=function(e){var o=[];return Object.getOwnPropertyNames(e).forEach(function(i){e[i].forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];o=o.concat(x.doActivateNodes(i,n,r))})}),o},this.doActivateNodes=function(d,f,h){var e=x.editor.observer,p=x.editor.getRep(d).lines,g=[];return f<0||h>=p.length()||h<f||e.withoutRecordingMutations(function(){var e=x.currentActiveLines[d],t=e[e.length-1],n=x.getUnrenderedRanges(d,Math.min(f,t),h);n.forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];x.render(d,n,r,!1,!0)}),n.length&&x.isScrolling&&(x.ifRenderInScrolling=!0);for(var r=f,i=p.atIndex(r)||null;r<=h;r++,i=p.next(i)){if(!i)throw new Error("attempt to iterate lineEntry which doesn't exist at index: "+r);if(!i.lineNode)throw new Error("lineNode is missing on activateNodes");var o,a=x.linesStatus[d][r].isActive,s=x.isLineCollapsed(r),l=i.lineNode,c=i.shouldKeepActive,u=x.isSelectionLine(d,r);!l||a||s?!a||c||u||console.warn("line "+r+" is already active"):(l.style.height="",l.style.margin="",xo(l),i.isActive=i.mounted=!0,x.linesStatus[d][r].isActive=!0,o=x.setZoneEntryMountedStatus(d,r,!0),g.push({lineEntry:i,lineNum:r,childZoneLineEntries:o,zone:d}))}}),g},this.getLineNodeStyle=function(e,t,n,r){var i,o=x.editor.getRep(e).lines,a=[];if(t<0||n>=o.length()||n<t)return[];for(var s=t,l=o.atIndex(s)||null;s<=n;s++,l=o.next(l)){if(!l||!l.lineNode)throw new Error("attempt to iterate lineEntry & lineNode which doesn't exist at index: "+s);l.updateZoneRectIfNecessary();var c,u,d=x.linesStatus[e][s].isActive,f=l.lineNode,h=l.shouldKeepActive;f&&d&&!h?(c=void 0,u="",r?c=va(x.editor):(c=(i=getComputedStyle(f)).height,u=i.margin),a.push({lineNum:s,height:c,margin:u,lineEntry:l,childZoneLineEntries:[],zone:e})):d||h||x.isLineCollapsed(s)||console.warn("line "+s+" is already inactive")}return a},this.deactivateNodes=function(e,o){var t=Object.getOwnPropertyNames(e),f=[];t.forEach(function(i){e[i].forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];f=f.concat(x.getLineNodeStyle(i,n,r,o))})});var n=x.editor.observer,h=x.isFocusOnEditor(),p={};return n.withoutRecordingMutations(function(){var t,e;try{for(var n=ge(f),r=n.next();!r.done;r=n.next()){var i,o=r.value,a=o.lineEntry,s=o.zone,l=o.lineNum,c=o.height,u=o.margin,d=a.lineNode;h&&x.isSelectionLine(s,l)?(x.currentActiveLines[s]||(x.currentActiveLines[s]=[]),x.currentActiveLines[s].push(l),p[l]=!0):d&&(d.style.height=c||"",d.style.margin=u||"",Ao(d),a.isActive=a.mounted=!1,x.linesStatus[s][l].isActive=!1,x.linesStatus[s][l].hasComputed=!0,i=x.setZoneEntryMountedStatus(s,l,!1),o.childZoneLineEntries=i)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}}),f.filter(function(e){return!p[e.lineNum]})},this.setZoneEntryMountedStatus=function(e,t,o){if(e!==sr)return[];var a=[];return x.editor.managers.getChildZonesAtLine(e,t).text.forEach(function(e){var t=x.editor.getRep(e);if(t)for(var n=t.lines,r=0;r<n.length();r++){var i=n.atIndex(r);i&&(i.mounted=o,i.isActive=o,x.linesStatus[e]&&(x.linesStatus[e][r].isActive=o),a.push(i))}}),a},this.setLinesStatus=function(e,t,n,r,i){for(var o=t;o<=n;o++)x.linesStatus[e][o][r]=i},this.getUnrenderedRanges=function(e,t,n){for(var r=[],i=t;i<=n;i++){var o=x.linesStatus[e][i];o&&(o.isRendered||r.push(i))}return oa(r)},this.isSelectionLine=function(e,t){var n=x.editor.getRep(),r=n.selStart,i=n.selEnd,o=n.zoneId;return!(!r||!i)&&(o===e?t>=r[0]&&t<=i[0]:e===sr&&t===x.editor.getLineNumInRootZone(o,t))},this.doActivationUpdateForZone=function(e){var t,n,r=e.activateRanges,i=e.deactivateRanges,o=e.setDefaultLineHeight;x.editor.hooks.callAll("bufferWillChanged",{deactivateRanges:i,activateRanges:r});var a=x.getViewportLines(),s=x.deactivateNodes(i,o),l=x.activateNodes(r);l.forEach(function(e){var t=e.lineEntry,n=e.childZoneLineEntries;x.callEnterBuffer(t),n.forEach(function(e){x.callEnterBuffer(e)})}),s.forEach(function(e){var t=e.lineEntry,n=e.childZoneLineEntries;x.callLeaveBuffer(t),n.forEach(function(e){x.callLeaveBuffer(e)})}),(l.length||s.length)&&x.editor.hooks.callAll("bufferChanged",{enteredLines:l,leftLines:s,viewportLines:null!==(n=a[sr])&&void 0!==n&&n.length?a:((t={})[sr]=l.map(function(e){return e.lineNum}),t)})},this.callEnterBuffer=function(e){e.getAllInstances().forEach(function(e){e.enterBuffer&&e.enterBuffer()})},this.callLeaveBuffer=function(e){e.getAllInstances().forEach(function(e){e.leaveBuffer&&e.leaveBuffer()})},this.getLatestBufferRange=function(e){for(var t=x.config.buffer,n=x.editor.getRep(sr).lines,r=n.length(),i=e-1,o=e+1,a=Math.floor(t/2),s=Math.ceil(t/2)-1;0<a||0<s;){if(0<=i&&0<a){if(!n.atIndex(i))return console.warn("Entry doesn't exist in line "+i),x.bufferRange;a-=x.getLineVirtualNum(i),i--}if(i<0&&0<a&&(o<r&&(s+=a),a=0),0<s&&o<r){if(!n.atIndex(o))return console.warn("Entry doesn't exist in line "+o),x.bufferRange;s-=x.getLineVirtualNum(o),o++}0<s&&r-1<o&&(0<=i&&(a+=s),s=0)}return[i+1,o-1]},this.getLineVirtualNum=function(e){var t=1,n=x.editor.lineTracker.collapseLines;if(!n)return t;var r=n.getCollapsedStatusOfLine(sr,e);if(r){var i=r.renderCollapsed;if(!r.startOfCollapseSection&&i)return 0}return t},this.computeNodeAndHide=function(){var e=x.getCurrentBufferRange(),t=x.getLinesStatus()[sr].slice(0,e[0]).map(function(e,t){var n=x.linesStatus[sr][t],r=n&&n.isActive;return e.hasComputed||x.isLineCollapsed(t)||r?null:x.editor.getRep(sr).lines.atIndex(t)}).filter(Boolean);t.length&&(x.preRenderer.ensureScreenNoScroll(t,function(){t.forEach(function(e){e.lineNode&&(xo(e.lineNode),e.lineNode.style.height="",e.lineNode.style.margin="")})}),x.editor.observer.withoutRecordingMutations(function(){t.forEach(function(e){return Ao(e.lineNode)})}))},this.getHeadingLineNumIfNecessary=function(e){var t=x.editor.lineTracker.collapseLines,n=t&&t.getCollapsedStatusOfLine(sr,e);return x.debugLog("lineNum: ",e),n&&x.isLineNodeCollapsed(e)?(x.debugLog("headerLineNum: ",n.headerLineNum),n.headerLineNum||e):e},this.isLineNodeCollapsed=function(e){var t=x.editor.lineTracker.collapseLines;return t&&t.isLineNodeCollapsed(e)},this.isLineCollapsed=function(e){var t=x.editor.lineTracker.collapseLines,n=t&&t.getCollapsedStatusOfLine(sr,e);return n&&n.renderCollapsed&&!n.startOfCollapseSection},this.handleScroll=function(){var e;x.disableHandleScrolling||(x.scrolling||(x.ifRenderInScrolling=!1),x.scrolling=!0,e=x.getViewportCenterLine(),x.updateActivation({centerLine:e}),x.timer&&clearTimeout(x.timer),x.timer=window.setTimeout(function(){var e;x.timer=null,x.scrolling=!1,x.disableHandleScrolling||(x.editor.observer.withoutRecordingMutations(function(){var e=x.getViewportLines();x.editor.hooks.callAll("aceScrollEndInViewport",{viewportLines:e})}),e=x.getViewportCenterLine(),x.updateActivation({centerLine:e}),x.requestAutoRender())},Math.max(Dc,Bc)))},this.throttleHandleScroll=Object(f.default)(this.handleScroll,Bc),this.renderPlaceholder=function(){x.editor.observer.withoutRecordingMutations(function(){for(var e=x.editor.getRep().lines,t=e.length(),n=document.createDocumentFragment(),r=0;r<t;r++){var i=e.atIndex(r);i&&i.lineNode&&(x.isLineCollapsed(r)&&(i.lineNode.className=As),n.appendChild(i.lineNode))}x.editor.docbody.appendChild(n)})},this.asyncRender=function(e,t,n,r,i,o,a){Object(g.default)(a)&&r&&(x.callbackState[r]=wc.RUNNING);var s=requestAnimationFrame(function(){if(x.requestIdMap.delete(s),Object(T.default)(n)?x.updateActivation({bufferRange:[e,t],forceRender:o}):x.updateActivation({centerLine:n,forceRender:o}),Object(g.default)(a)&&r&&x.callbackState[r]){try{a(!0)}catch(e){console.error("Async Render Callback Error: "+e)}delete x.callbackState[r]}i&&x.hideLoading()});x.requestIdMap.set(s,!0)},this.requestAutoRender=function(){var R=x.config.autoRender;R?x.fiberTaskId||(x.fiberTaskId=x.editor.fiber.scheduleTask(function(){var e,t;if(x.fiberTaskId=null,x.scrolling)x.requestAutoRender();else if(x.fiberActions.length||(t=x.editor.hook.callAll("aceFiberAction"),(e=x.fiberActions).push.apply(e,me(t.filter(function(e){return e instanceof Function})))),x.enableOptimization()){var n=x.getViewportLines(),r=x.getUnrenderedLine(n);if(r){var i=r.zoneId,o=r.lineNum;return x.render(i,o,o,!0,!0),void x.requestAutoRender()}var a,s,l=x.getUncachedLine(n);if(l){var i=l.zoneId,o=l.lineNum,c=x.editor.getRep(i).lines.atIndex(o),u=ve(x.renderZone(i,{range:[o,o],activeLines:[o],indexToKey:function(){return null===c||void 0===c?void 0:c.key}}),1)[0];return x.domLineCache.add(i,o,u),void x.requestAutoRender()}x.fiberActions.length&&((a=x.fiberActions.shift())&&a(),x.requestAutoRender()),(s=x.fiberRecord.finish())&&x.editor.call("onFiberRecord",s)}else{if(x.allRendered)return x.fiberTaskId=null,void((s=x.fiberRecord.finish())&&x.editor.call("onFiberRecord",s));var d=R.increase,f=R.renderNumber,h=x.editor.getRep(sr).lines,p=x.getUnrenderedRange(),g=p.start,v=p.numToStart,m=p.end,y=p.numToEnd,b=x.linesStatus[sr].filter(function(e){return e.isRendered}).length,E=h.length(),k=0<v,C=0<y,I=k&&!C||!k&&C,S=g-v+1,T=g,O=m,w=m+y-1,w=d?(S=Math.max(S,g-b*(I?2:1),0),Math.min(w,m+b*(I?2:1),E-1)):(S=Math.max(S,g-f,0),Math.min(w,m+f,E-1));k&&x.nonFirstScreenRender(S,T),C&&x.nonFirstScreenRender(O,w,!1),x.requestAutoRender()}})):x.fiberTaskId=null},this.getUnrenderedRange=function(){for(var e=x.getViewportCenterLine(),t=x.editor.getRep(sr).lines.length(),n={start:0,numToStart:0,end:t-1,numToEnd:0},r=e,i=!1;0<r;){var o=x.linesStatus[sr][--r].isRendered;if(i||o||(n.start=r,i=!0),i&&!o)n.numToStart++;else if(i)break}for(r=e,i=!1;r<t-1;){o=x.linesStatus[sr][++r].isRendered;if(i||o||(n.end=r,i=!0),i&&!o)n.numToEnd++;else if(i)break}return n},this.handleMobileEnterEditMode=function(){x.fiberTaskId&&x.editor.fiber.cancelTask(x.fiberTaskId),x.fiberTaskId=null},this.handleMobileQuitEditMode=function(){x.fiberTaskId||x.allRendered||x.requestAutoRender()},this.markNodesClean=function(e){Object(B.a)(e,function(e){x.editor.dirtyChecker.markNodeClean(e.lineNode,e)})},this.handleBlockDidRender=function(e){var t,n;try{for(var r=ge(Object.keys(x.asyncNodeState)),i=r.next();!i.done;i=r.next())for(var o=i.value,a=x.asyncNodeState[o],s=a.blockList,l=a.nodes,c=0,u=s.length;c<u;c++)if(e===s[c])return s.splice(c,1),void x.callAsyncNodesLoaded(o,l)}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},this.bindLoadStateEvent=function(e){var t=x.createRenderId();x.asyncNodeState[t]={nodes:e,imageNumber:0,blockList:[]};var o=x.asyncNodeState[t],n=function(){o.imageNumber--,x.callAsyncNodesLoaded(t,e)},r=he()(e),i=r.find(".image-uploaded img");i.length&&i.each(function(e,t){i.eq(e).closest(".ace-table").length||(o.imageNumber++,t.onload=n,t.onerror=n)});var a=r.find(".block-placeholder");a.length&&a.each(function(e,t){var n,r,i;a.eq(e).closest(".ace-table").length||(n=/block-id-(\S*)/,(i=(r=t.className.match(n))&&r[1])&&o.blockList.push(i))}),x.callAsyncNodesLoaded(t,e)},this.callAsyncNodesLoaded=function(e,t){var n=x.asyncNodeState[e];n&&0===n.imageNumber&&0===n.blockList.length&&(delete x.asyncNodeState[e],x.editor.hooks.callAll("blockRenderAsyncNodesLoaded",{type:"CLIENT_VARS",data:{nodes:t,rep:x.editor.getReps()[sr]}}))},this.createRenderId=function(){return On(20)},this.isFocusOnEditor=function(){return document.hasFocus()&&x.editor.docbody.contains(document.activeElement)},this.handleSelectionChanged=function(e){var t,n,r,i,o,a,s,l,c,u;x.shouldCheckAll&&(t=x.getViewportCenterLine(),x.shouldCheckAll=!1,x.updateActivation({centerLine:t})),x.editor.isSelectingAll&&(r=(n=x.editor.getRep(sr).lines).length()-1,i=n.atIndex(0),(o=n.atIndex(r))&&i&&(a=[0,i.lineMarker],s=[r,o.text.length],c=(l=e.rep).selStart,u=l.selEnd,(Object(N.default)([0,0],c)||Object(N.default)(a,c))&&Object(N.default)(s,u)||(x.editor.isSelectingAll=!1)))},this.handleResize=function(e){var t,n,r,i=e.prev,o=e.next;Math.abs(i.width-o.width)<Pc||(t=x.editor.getRep(sr).lines,n=x.bufferRange[0],r=t.slice(0,n+1).filter(function(e){return!!e}),x.editor.observer.withoutRecordingMutations(function(){x.preRenderer.ensureScreenNoScroll(r,function(){r.forEach(function(e){var t=e.lineNode;t&&(t.style.height="",t.style.margin="",xo(t))})})}))},this.debouncedHandleResize=Object(y.default)(this.handleResize,Lc),this.handleVisibilityChanged=function(){var e="visible"===document.visibilityState;e&&!x.watchdogTimer?x.watchdogTimer=window.setTimeout(x.checkViewportVisibility,Fc):!e&&x.watchdogTimer&&(clearTimeout(x.watchdogTimer),x.watchdogTimer=null)},this.bindEvent=function(){x.editor.eventEmitter.on("blockDidMount",x.handleBlockDidRender),x.editor.eventEmitter.on("blockFailMount",x.handleBlockDidRender),x.editor.eventEmitter.on("blockRenderTimeout",x.handleBlockDidRender),x.editor.eventEmitter.on("aceSelectionChanged",x.handleSelectionChanged),x.editor.eventEmitter.on("lineTrackerUpdate",x.handleCollapseChanged),x.isUsingBlockRendering&&(x.editor.on("enterMobileEditMode",x.handleMobileEnterEditMode),x.editor.on("quitMobileEditMode",x.handleMobileQuitEditMode),x.scroller.addEventListener("scroll",x.throttleHandleScroll),x.editor.eventEmitter.on("editorSizeChange",x.debouncedHandleResize),x.watchdogTimer=window.setTimeout(x.checkViewportVisibility,Fc),document.addEventListener("visibilitychange",x.handleVisibilityChanged),x.handleVisibilityChanged())},this.unbindEvent=function(){x.editor.eventEmitter.off("blockDidMount",x.handleBlockDidRender),x.editor.eventEmitter.off("blockFailMount",x.handleBlockDidRender),x.editor.eventEmitter.off("blockRenderTimeout",x.handleBlockDidRender),x.editor.eventEmitter.off("aceSelectionChanged",x.handleSelectionChanged),x.editor.eventEmitter.off("lineTrackerUpdate",x.handleCollapseChanged),x.isUsingBlockRendering&&(x.editor.off("enterMobileEditMode",x.handleMobileEnterEditMode),x.editor.off("quitMobileEditMode",x.handleMobileQuitEditMode),x.scroller.removeEventListener("scroll",x.throttleHandleScroll),x.editor.eventEmitter.off("editorSizeChange",x.debouncedHandleResize),document.removeEventListener("visibilitychange",x.handleVisibilityChanged)),x.watchdogTimer&&(clearTimeout(x.watchdogTimer),x.watchdogTimer=null)},this.showLoading=function(e){Ce.isMobile&&!x.loadingState&&(x.loadingState=Tc.SHOW,window.lark.biz.util.showPartialLoading(),x.editor.call(_c,{show:!0,source:e}))},this.hideLoading=function(){Ce.isMobile&&x.loadingState&&(x.loadingState=Tc.HIDE,window.lark.biz.util.hidePartialLoading(),x.editor.call(_c))},this.handleCollapseChanged=function(e){var t;if(x.editor.lineTracker.collapseLines&&0!==e.dirtyLines.length){var n=e.dirtyLines.length,r=e.dirtyLines[0].lineNum+1,i=e.dirtyLines[n-1].lineNum;if(!(i<r))if(e.isCollapsed){var o=i-r+1;x.updateActiveLines(sr,r,o,o,!1),x.doActivationUpdateForZone({activateRanges:{},deactivateRanges:((t={})[sr]=[[r,i]],t),setDefaultLineHeight:!0})}else{for(var a=x.editor.getRep(sr).lines,s=[],l=r,c=a.atIndex(l)||null;l<=i&&c;l++,c=a.next(c))s.push(c);x.preRenderer.ensureScreenNoScroll(s,function(){s.forEach(function(e){var t=e.lineNode;t&&(t.style.height="",t.style.margin="",xo(t))}),x.preRenderer.markUpdateRectZoneAndActivate(s),x.preRenderer.doUpdateRectZone(s)})}}},this.renderFinished=function(){x.allRendered=!0},this.updateConfig=function(e){var t,n;e&&e.open?(x.config=e,x.isUsingBlockRendering=!0,t=Math.floor(window.screen.height/x.docLineHeight),e.buffer?x.config.buffer=Math.max(e.buffer,t):x.config.buffer=t,x.buffer=x.config.buffer,x.config.autoRender&&((n=x.config.autoRender).renderNumber=n.renderNumber||200,n.intervalTime=n.intervalTime||0,n.increase=n.increase||!1)):e&&e.startLine&&(x.config.startLine=e.startLine)},this.checkViewportVisibility=function(){var e,t,n,r=x.getRealCenterNode();r&&(he()(r).find("."+wo).length||he()(r).closest("."+wo).length)&&((e=x.editor.domToRep(r))||console.log("DomRep is null, ",r),x.debugMode=!0,t=(null===e||void 0===e?void 0:e.selStart[0])||0,n=x.getViewportCenterLine(),console.log("Real viewport center line: ",t),console.log("Real center line activation: ",x.linesStatus[sr][t].isActive),console.log("Current viewport center line: ",n),console.log("Current center line activation: ",x.linesStatus[sr][n].isActive),console.log("Current buffer range: ",x.bufferRange),console.log("Latest buffer range: ",x.getLatestBufferRange(n)),Ue("Doc viewport is invisible!"),x.debugMode=!1),x.watchdogTimer=window.setTimeout(x.checkViewportVisibility,Fc)},this.getRealCenterNode=function(){var t,e,n=window.innerWidth/2,r=window.innerHeight/2,i=document.elementFromPoint(n,r);if(x.editor.docbody.contains(i)){if(x.editor.docbody!==i)return i;var o=Array.from(i.childNodes),a=x.getCenterOffsetY();try{for(var s=ge(o),l=s.next();!l.done;l=s.next()){var c=l.value;if(c instanceof HTMLElement&&!c.classList.contains(As)&&c.offsetTop+x.getOffsetTopToScroller()>=a)return c}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.debugLog=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];x.debugMode&&console.log.apply(console,me(e))},this.reset=function(){x.unbindEvent(),x.timer&&(clearTimeout(x.timer),x.timer=null),x.fiberTaskId&&(x.editor.fiber.cancelTask(x.fiberTaskId),x.fiberTaskId=null),x.requestIdMap.size&&(x.requestIdMap.forEach(function(e,t){cancelAnimationFrame(t)}),x.requestIdMap.clear()),x.requestCbId&&(clearTimeout(x.requestCbId),x.requestCbId=null),x.renderEndId&&cancelAnimationFrame(x.renderEndId),x.domLineCache.clear(),x.fiberRecord.destroy(),x.preRenderer.destroy()},this.initZoneLineStatus=function(e){var t=x.editor.getRep(e);!x.linesStatus[e]&&t&&(x.linesStatus[e]=me(new Array(t.alines.length)).map(function(){return x.createLineStatus(!1,!1)}))};var t=e.editor,n=e.config;this.editor=t,this.domLineCache=new Ec(t);var r=he()(t.docbody);this.docLineHeight=parseFloat(r.css("line-height")),this.scroller=this.editor.getScrollContainer()||window,this.updateConfig(n),this.bindEvent(),this.preRenderer=new Hs(this.editor)}var Hc="client_performance_doc_do_idle_action",Uc=(Vc.prototype.cancelMonitorEditorSizeChange=function(){this.editorResizeTimer&&clearTimeout(this.editorResizeTimer)},Vc);function Vc(e,t,n){var d=this;void 0===t&&(t=!0),this.editor=e,this.enable=t,this.time=1e3,this.forbid=!1,this.editorResizeTimer=null,this.resizeWindowAnimationTimer=null,this.resizeAnimationTimer=null,this.scheduledTimeout=null,this.scheduledTime=null,this.monitorEditorSizeChange=function(){d.detectEditorResize(),d.editorResizeTimer=window.setTimeout(d.monitorEditorSizeChange,100)},this.detectWindowResizeImmediately=function(){var e,t,n,r=d.editor;r&&r.getInnerContainer()&&(e=d.editor.getRect(),d.editor.setRect(),t=d.editor.getRect(),!e||!t||Object(N.default)(e,t)||(n=r.eventEmitter)&&"function"==typeof n.trigger&&(n.trigger("editorRectChange",[{prev:e,next:t}]),r.call("editorRectChange",[{prev:e,next:t}])))},this.detectWindowResize=function(){d.resizeWindowAnimationTimer&&clearTimeout(d.resizeWindowAnimationTimer),d.resizeWindowAnimationTimer=window.setTimeout(function(){d.detectWindowResizeImmediately()},0)},this.detectEditorResizeImmediately=function(){var e=d.editor,t=e.getInnerContainer();if(t){for(var n=he()(t).width(),r=t.lastChild||null;r&&!r.offsetHeight&&!r.offsetTop;)r=r.previousSibling;var i,o,a=r?r.offsetHeight+r.offsetTop:0,s=t.getAttribute("data-last-height"),l=t.getAttribute("data-last-width"),c=Number(s||0),u=Number(l||0);d.editor.setRect(),!c&&!u||c===a&&u===n||(e.hooks.callAll("editorSizeChange",{prev:{height:c,width:u},next:{height:a,width:n}}),(i=e.eventEmitter)&&"function"==typeof i.trigger&&i.trigger("editorSizeChange",[{prev:{height:c,width:u},next:{height:a,width:n}}]),(o=e.getProps().onResize)&&o({prev:{height:c,width:u},next:{height:a,width:n}})),t["data-last-height"]!==a&&(t.setAttribute("data-last-height",String(a)),t["data-last-height"]=a),t["data-last-width"]!==n&&(t.setAttribute("data-last-width",String(n)),t["data-last-width"]=n)}},this.detectEditorResize=function(){d.resizeAnimationTimer&&clearTimeout(d.resizeAnimationTimer),d.resizeAnimationTimer=window.setTimeout(function(){d.detectEditorResizeImmediately()},0)},this.unschedule=function(){var e=d.scheduledTimeout;e&&(clearTimeout(e),d.scheduledTimeout=null)},this.reschedule=function(e){d.unschedule();var t=(d.scheduledTime=e)-to();t<0&&(t=0),d.scheduledTimeout&&clearTimeout(d.scheduledTimeout),d.scheduledTimeout=window.setTimeout(d.doIdleAction,t)},this.atLeast=function(e,t){void 0===t&&(t=!1);var n=to()+e,r=d.scheduledTimeout,i=d.scheduledTime;0!==e||d.enable||!t?(!r||i<n)&&d.reschedule(n):d.doIdleAction()},this.atMost=function(e,t){void 0===t&&(t=!1);var n=to()+e,r=d.scheduledTimeout,i=d.scheduledTime;0!==e||d.enable||!t?(!r||n<i)&&d.reschedule(n):d.doIdleAction()},this.never=function(){d.unschedule(),d.resizeAnimationTimer&&window.clearTimeout(d.resizeAnimationTimer),d.scheduledTimeout&&clearTimeout(d.scheduledTimeout),d.cancelMonitorEditorSizeChange()},this.idleActionFn=function(){var e=d.editor;e.inCallStackIfNecessary("idleWorkTimer",function(){e.fastIncorp()})},this.doIdleAction=function(){if(d.forbid)return d.unschedule();var r=d.editor,i={minimumUsedTime:20};if(r.profile&&r.profile.start(Hc),d.unschedule(),r.getInInternationalComposition())return d.atLeast(500),void(r.profile&&r.profile.end(Hc,i));r.inCallStackIfNecessary("idleWorkTimer",function(){var e,t=Ai(250),n=!1;try{if(r.fastIncorp(),t())return void(r.profile&&r.profile.end(Hc,i));n=!0}finally{d.enable&&(n?d.atMost(d.time):((e=Math.round(t.elapsed()/2))<100&&(e=100),d.atMost(e)))}r.profile&&r.profile.end(Hc,i)},{shouldIncorp:!1})},this._setIdleActionOption=function(e){var t=e.forbid,n=e.time,r=!1;return"boolean"==typeof t&&(d.forbid=t,r=!0),n&&"number"==typeof n&&1e3<=n&&(d.time=n,r=!0),r},this.setIdleActionOption=function(e){d._setIdleActionOption(e)&&d.doIdleAction()},this._setIdleActionOption(n)}var Wc={check:["checkbox","list"],done:["checkbox","list"],bullet:["list"],code:["list","codeblock"],number:["list"],indent:["list"]},Kc=Object(u.a)(function(e){return e.map(function(e){return e?"string"==typeof e.className?e.className.toLowerCase():e.constructor&&e.constructor.formatKey&&e.constructor.formatKey.toLowerCase()||"":""})});function Zc(e,t){if(!Object(O.a)(e)||!Object(c.a)(t))return!1;var n=e.replace(/\d/g,""),r=Wc[n];if(!r)return!1;var i=Kc(t);return r.every(function(e){return i.includes(e.toLowerCase())})}function Gc(e){return!!/^code/.exec(e)}var qc={ROWS_ZONE_ID:"rs",COLS_ZONE_ID:"cs",ROW_ID:"r1",COL_ID:"c1",CELL_ID:"x"};function Jc(e){for(var t="abcdefghijklmnopqrstuvwyz0123456789",n="",r=0;r<e;r++)n+=t[ja(t.length)];return n}function Yc(){return qc.ROWS_ZONE_ID+Jc(32)}function Qc(){return qc.COLS_ZONE_ID+Jc(32)}function Xc(){return qc.ROW_ID+Jc(32)}function $c(){return qc.COL_ID+Jc(32)}function eu(e,t){if("string"!=typeof e||"string"!=typeof t)throw new Error("got non-string rowId or colId: "+e+" "+t);if(-1!==e.indexOf(",")||-1!==t.indexOf(","))throw new Error("got rowId or colId: "+e+" "+t);return qc.CELL_ID+e+qc.CELL_ID+t}function tu(e){var t=e.split("x");return{rowId:t[1],colId:t[2]}}function nu(e,n,r){void 0===r&&(r=!1);var i=[];return e.forEach(function(t){n.forEach(function(e){r?i.push(eu(e,t)):i.push(eu(t,e))})}),i}function ru(e){return qc.CELL_ID===e.charAt(0)}function iu(e){return 0===e.indexOf(qc.ROWS_ZONE_ID)}function ou(e){return 0===e.indexOf(qc.COLS_ZONE_ID)}function au(e,t){return"aceTable-"+e+" "+t}function su(e,t){var n=tu(e),r=n.rowId,i=n.colId,o=Object.keys(t),a="",s="";return o.forEach(function(e){t[e].vectorIds.includes(r)&&(a=e),t[e].vectorIds.includes(i)&&(s=e)}),a&&s?"aceTable,"+a+" "+s:""}function lu(e){var t=/(^|\s*)aceTable-([a-zA-Z0-9]+)\s([a-zA-Z0-9]+)(\s|$)/.exec(e);return t?{rowId:t[2],colId:t[3]}:null}function cu(e){var t=/^([a-zA-Z0-9]+)\s([a-zA-Z0-9]+)$/.exec(e);return t?{rowId:t[1],colId:t[2]}:null}function uu(e){var t=/([a-zA-Z0-9]+)\s([a-zA-Z0-9]+)/.exec(e);return t?{rowId:t[1],colId:t[2]}:null}function du(e,t){var n=t.rowId,r=t.colId,i=[],o=e[n]&&e[n].vectorIds,a=e[r]&&e[r].vectorIds;return o&&a&&o.forEach(function(t){a.forEach(function(e){i.push(eu(t,e))})}),i}function fu(e,t,n){var r=uu(t);if(r)return du(n,r).includes(e)}function hu(e,t){var n=lu(t);if(!n)return null;var r=n.rowId,i=n.colId,o=[],a=e[r]&&e[r].vectorIds,s=e[i]&&e[i].vectorIds;return a&&s&&a.forEach(function(t){var n=[];s.forEach(function(e){n.push(eu(t,e))}),o.push(n)}),o}function pu(e,t,n,r){if(!e.length||!e[0])return"";if(1===e.length&&!(e[0].mergeCellID&&e[0].rowspan&&e[0].colspan))return"disabled";var i,o=yu(t,n,r);if(!o)return!1===o?"disabled":o;for(var a=new Set,s=e.length,l=0;l<s;l++){var c=e[l];if(!c||!c.mergeCellID)return i="unmerge";i="merged",a.add(c.mergeCellID)}return 1<a.size&&(i="unmerge"),i}function gu(a,s,e){var l=[];return e.forEach(function(e){var t,n,r,i,o=tu(e);o&&(t=o.rowId,n=o.colId,r=a.indexOf(t),i=s.indexOf(n),l.push([r,i]))}),l}function vu(e,t,n,i){"string"==typeof n&&(n=[n]);var o=new Set,r=gu(e,t,n);return r.length?(r.forEach(function(e){var t=ve(me(e),2),n=t[0],r=t[1];-1!==n&&-1!==r&&o.add(i[n][r])}),Array.from(o)):null}function mu(e,t,n,r){var i=vu(t,n,e,r),o=!1;if(i&&i.length){var a=i[0].mergeCellID,s=i[0].colspan,l=i[0].rowspan;if(a&&(void 0!==s||void 0!==l)){if(0===Number(s)||0===Number(l))return o=!0;o=!1}}return o}function yu(e,t,n){var o=new Map;gu(e,t,n).forEach(function(e){var t,n=ve(me(e),2),r=n[0],i=n[1];o.has(r)?((t=o.get(r)).push(i),o.set(r,t)):o.set(r,[i])});var r=Array.from(o.keys()).sort(function(e,t){return e-t}),a=Array.from(o.values());if(!r.length)return"";var s=!1,l=!1;return 1===r.length?(l=!0,a.forEach(function(e){for(var t=e.sort(function(e,t){return e-t}),n=t.length,r=0;r<n;r++)if(0!==n[r]){if(0<r&&t[r-1]+1!==t[r]){s=!1;break}s=!0}})):a.forEach(function(e,t){for(var n=e.sort(function(e,t){return e-t}),r=n.length,i=0;i<r;i++)if(0!==r[i]){if(0<i&&n[i-1]+1!==n[i]){s=!1;break}s=!0}0!==t&&(l=Object(N.default)(a[t-1],e))}),!(!l||!s)}var bu=Object.freeze({__proto__:null,ID_PREFIX:qc,generateId:Jc,newUniqueRowsZoneId:Yc,newUniqueColsZoneId:Qc,newUniqueRowId:Xc,newUniqueColId:$c,getCellIdFromRowAndCol:eu,getRowAndColIdFromCellId:tu,crossProduct:nu,isCellId:ru,isRowsZoneId:iu,isColsZoneId:ou,getTableIdFromRowAndCol:au,getTableAttributeFromRowAndCol:su,getRowAndColIdFromClass:lu,getRowAndColIdFromAttributeValue:cu,getRowAndColIdFromTableValue:uu,getSortedTableCellIdsByTableIdFromVectorReps:du,isCellIdBelongToTableId:fu,getMatrixOfCellIdsByTableId:hu,getMergeStatus:pu,getSelectionFromCellId:gu,getCellAttribsFromSelectedCellID:vu,isCellMerged:mu,isContinuous:yu}),Eu={M_SEPARATOR:",",SEPARATOR:"|"},ku=(Cu.prototype.enterRow=function(){this.inRow=!0},Cu.prototype.exitRow=function(){this.inRow=!1,this.rowIndex++,this.colIndex=0},Cu.prototype.enterCell=function(){this.collector._pushNewLines(),this.inCell=!0},Cu.prototype.collectFontAttribs=function(e){var t=e.style,n=t.getPropertyValue("font-size");new RegExp(/\D/).test(n)||(n+="px");var r,i,o,a=n,s=t.getPropertyValue("font-family"),l=t.getPropertyValue("font-weight");a&&(r="fontSize-"+Jc(8),this.colFontSizeIndex[this.colIndex]=this.colFontSizeIndex[this.colIndex]||[],this.colFontSizeIndex[this.colIndex].push([r,a]),this.rowFontSizeIndex[this.rowIndex]=this.rowFontSizeIndex[this.rowIndex]||[],this.rowFontSizeIndex[this.rowIndex].push([r,a])),s&&(i="fontFamily-"+Jc(8),this.colFontFamilyIndex[this.colIndex]=this.colFontFamilyIndex[this.colIndex]||[],this.colFontFamilyIndex[this.colIndex].push([i,s]),this.rowFontFamilyIndex[this.rowIndex]=this.rowFontFamilyIndex[this.rowIndex]||[],this.rowFontFamilyIndex[this.rowIndex].push([i,s])),l&&(o="fontWeight-"+Jc(8),this.colFontWeightIndex[this.colIndex]=this.colFontWeightIndex[this.colIndex]||[],this.colFontWeightIndex[this.colIndex].push([o,l]),this.rowFontWeightIndex[this.rowIndex]=this.rowFontFamilyIndex[this.rowIndex]||[],this.rowFontWeightIndex[this.rowIndex].push([o,l]))},Cu.prototype.collectBorderAttribs=function(e){var t,n=e.style,r=n.getPropertyValue("border-top"),i=n.getPropertyValue("border-bottom"),o=n.getPropertyValue("border-left"),a=n.getPropertyValue("border-right"),s={};r&&(s.top=r),i&&(s.bottom=i),o&&(s.left=o),a&&(s.right=a),Object.keys(s).length&&(t="border-"+Jc(8),this.colBorderAttribs[this.colIndex]=this.colBorderAttribs[this.colIndex]||[],this.colBorderAttribs[this.colIndex].push([t,JSON.stringify(s)]),this.rowBorderAttribs[this.rowIndex]=this.rowBorderAttribs[this.rowIndex]||[],this.rowBorderAttribs[this.rowIndex].push([t,JSON.stringify(s)]))},Cu.prototype.exitCell=function(e,t){var n=this.tableConfig,r=n.isCustomBackgroundColor,i=n.isCustomBorder,o=n.isCustomFont;i&&this.collectBorderAttribs(e),r&&this.collectBackgroundColorAttribs(e,t),o&&this.collectFontAttribs(e),this.collectMergeCellAttribs(e);var a=this.collector._popLines();this.rowIndex in this.cellData||(this.cellData[this.rowIndex]=[]),this.cellData[this.rowIndex][this.colIndex]=a,this.inCell=!1;var s=this.colIndex;this.colIndex++,this.handleDummyCell(e,s)},Cu.prototype.handleDummyCell=function(e,t){var n=e.getAttribute("colspan"),r=e.getAttribute("rowspan"),n=n&&Number(n),r=r&&Number(r);0!==n&&null!==n||(n=1);for(var i=1;i<n;i++)this.cellData[this.rowIndex][this.colIndex]=new Mu(this.editor),this.colIndex++;for(var o=1;o<r;o++)for(var a=0;a<n;a++){var s=this.rowIndex+o+","+(t+a);this.dummyCellsMap[s]=!0}},Cu.prototype.collectMergeCellAttribs=function(e){for(var t,n=e.getAttribute("colspan"),r=e.getAttribute("rowspan"),n=n&&Number(n),r=r&&Number(r);(t=this.dummyCellsMap[this.rowIndex+","+this.colIndex])&&(this.rowIndex in this.cellData||(this.cellData[this.rowIndex]=[]),this.cellData[this.rowIndex][this.colIndex]=new Mu(this.editor),delete this.dummyCellsMap[this.rowIndex+","+this.colIndex],this.colIndex++,this.colWidths.length===this.colIndex&&(this.colIndex=0,this.rowIndex++)),t;);if((n||r)&&0!==n&&0!==r){var i=Jc(8);this.colMergeCellIndex.push([this.colIndex,i]),this.rowMergeCellIndex.push([this.rowIndex,i]);for(var o=1;o<n;o++)this.colMergeCellIndex.push([this.colIndex+o,i]);for(var a=1;a<r;a++)this.rowMergeCellIndex.push([this.rowIndex+a,i])}},Cu.prototype.collectBackgroundColorAttribs=function(e,t){var n="",r="";t&&t.split(";").forEach(function(e){var t=/(^| )background-color:\s*(.*)/.exec(e);t&&t[2]&&(r=Jc(8),n=t[2])}),n&&(this.colBackgroundColorIndex[this.colIndex]=this.colBackgroundColorIndex[this.colIndex]||[],this.colBackgroundColorIndex[this.colIndex].push([r,n]),this.rowBackgroundColorIndex[this.rowIndex]=this.rowBackgroundColorIndex[this.rowIndex]||[],this.rowBackgroundColorIndex[this.rowIndex].push([r,n]))},Cu.prototype.isInRow=function(){return this.inRow},Cu.prototype.isInCell=function(){return this.inCell},Cu.prototype.collect=function(e,t){this.collector.collectContent(e,t)},Cu.prototype.getColBackgroundAttribs=function(e,t,n){for(var r=t[n],i=this.colBackgroundColorIndex[n],o={},a=0;a<e.length;++a)for(var s=eu(e[a],r),l=this.rowBackgroundColorIndex[a],c=Object(k.a)(i,l,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["backgroundColor",JSON.stringify(o)]},Cu.prototype.getRowBackgroundAttribs=function(e,t,n){for(var r=e[n],i=this.rowBackgroundColorIndex[n],o={},a=0;a<t.length;++a)for(var s=eu(r,t[a]),l=this.colBackgroundColorIndex[a],c=Object(k.a)(i,l,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["backgroundColor",JSON.stringify(o)]},Cu.prototype.getColWidthAttrib=function(e){return this.colWidths[e]?["colWidth",this.colWidths[e]]:[]},Cu.prototype.getColSpanAttribs=function(i){var o=[],a="";return this.colMergeCellIndex.forEach(function(e){var t=ve(me(e),2),n=t[0],r=t[1];i===n&&(a+=o.length?""+Eu.M_SEPARATOR+r:r,o=["mergeCellID",a])}),o},Cu.prototype.getRowSpanAttribs=function(i){var o=[],a="";return this.rowMergeCellIndex.forEach(function(e){var t=ve(me(e),2),n=t[0],r=t[1];i===n&&(a+=o.length?""+Eu.M_SEPARATOR+r:r,o=["mergeCellID",a])}),o},Cu.prototype.getRowBorderAttribs=function(e,t,n){for(var r=e[n],i=this.rowBorderAttribs[n],o={},a=0;a<t.length;++a)for(var s=eu(r,t[a]),l=this.colBorderAttribs[a],c=Object(k.a)(i,l,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=JSON.parse(d)}return["border",JSON.stringify(o)]},Cu.prototype.getRowFontWeightAttribs=function(e,t,n){for(var r=e[n],i=this.rowFontWeightIndex[n],o={},a=0;a<t.length;++a)for(var s=eu(r,t[a]),l=this.colFontWeightIndex[a],c=Object(k.a)(i,l,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["fontWeight",JSON.stringify(o)]},Cu.prototype.getRowFontSizeAttribs=function(e,t,n){for(var r=e[n],i=this.rowFontSizeIndex[n],o={},a=0;a<t.length;++a)for(var s=eu(r,t[a]),l=this.colFontSizeIndex[a],c=Object(k.a)(i,l,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["fontSize",JSON.stringify(o)]},Cu.prototype.getRowFontFamilyAttribs=function(e,t,n){for(var r=e[n],i=this.rowFontFamilyIndex[n],o={},a=0;a<t.length;++a)for(var s=eu(r,t[a]),l=this.colFontFamilyIndex[a],c=Object(k.a)(i,l,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["fontFamily",JSON.stringify(o)]},Cu.prototype.getColFontWeightAttribs=function(e,t,n){for(var r=t[n],i=this.colFontWeightIndex[n],o={},a=0;a<e.length;++a)for(var s=eu(e[a],r),l=this.rowFontWeightIndex[a],c=Object(k.a)(l,i,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["fontWeight",JSON.stringify(o)]},Cu.prototype.getColFontSizeAttribs=function(e,t,n){for(var r=t[n],i=this.colFontSizeIndex[n],o={},a=0;a<e.length;++a)for(var s=eu(e[a],r),l=this.rowFontSizeIndex[a],c=Object(k.a)(l,i,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["fontSize",JSON.stringify(o)]},Cu.prototype.getColFontFamilyAttribs=function(e,t,n){for(var r=t[n],i=this.colFontFamilyIndex[n],o={},a=0;a<e.length;++a)for(var s=eu(e[a],r),l=this.rowFontFamilyIndex[a],c=Object(k.a)(l,i,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=d}return["fontFamily",JSON.stringify(o)]},Cu.prototype.getColBorderAttribs=function(e,t,n){for(var r=t[n],i=this.colBorderAttribs[n],o={},a=0;a<e.length;++a)for(var s=eu(e[a],r),l=this.rowBorderAttribs[a],c=Object(k.a)(l,i,function(e,t){return e[0]===t[0]&&e[1]===t[1]}),u=0;u<c.length;++u){var d=c[u][1];o[""+s]=JSON.parse(d)}return["border",JSON.stringify(o)]},Cu.prototype.nonEmpty=function(){return!!this.attrib},Cu.prototype.getAttrib=function(){return this.attrib},Cu);function Cu(e,t,n){var r,m=this;this.editor=e,this.collector=t,this.rowIndex=0,this.colIndex=0,this.inRow=!1,this.inCell=!1,this.cellData=[],this.attrib=null,this.colWidths=[],this.colMergeCellIndex=[],this.rowMergeCellIndex=[],this.colBackgroundColorIndex=[],this.rowBackgroundColorIndex=[],this.colFontFamilyIndex=[],this.rowFontFamilyIndex=[],this.colFontWeightIndex=[],this.rowFontWeightIndex=[],this.colFontSizeIndex=[],this.rowFontSizeIndex=[],this.colBorderAttribs=[],this.rowBorderAttribs=[],this.dummyCellsMap={},this.tableConfig={},this.exit=function(){var r=-1,i=-1,e=Object.keys(m.dummyCellsMap);if(e.length)for(var t=0;t<e.length;t++){var n=ve(e[t].split(",").map(function(e){return+e}),2),o=n[0],a=n[1];o in m.cellData||(m.cellData[o]=[]),m.cellData[o][a]=new Mu(m.editor)}m.cellData.forEach(function(e,n){e.forEach(function(e,t){r=Math.max(r,n),i=Math.max(i,t)})});var l=m.editor.changesetHelper;if(!(r<0||i<0)){for(var s=r+1,c=i+1,u=Yc(),d=Qc(),f=[],h=[],p=0;p<s;p++)f.push(Xc());for(p=0;p<c;p++)h.push($c());m.collector.additionalZatext_.rows[u]=f,m.collector.additionalZatext_.cols[d]=h,m.collector.additionalZatext_.attribs[u]=m.rowAttribs(f,h),m.collector.additionalZatext_.attribs[d]=m.colAttribs(f,h),f.forEach(function(a,s){h.forEach(function(e,t){if(m.cellData[s]&&m.cellData[s][t]){var n=eu(a,e),r=m.cellData[s][t];r.flush();for(var i=r.attribLines(),o=r.textLines();o&&""===o[o.length-1];)i=i.slice(0,i.length-1),o=o.slice(0,o.length-1);0===o.length&&(o=[""],i=[""]),m.collector.additionalZatext_.text[n]=o.map(function(e){return e+"\n"}).join(""),m.collector.additionalZatext_.attribs[n]=l.joinAttributionLinesAddingNewlines(i)}})}),m.attrib=[["magicObject","aceTable"],["aceTable",u+" "+d],["width_fixed",!0]]}},this.rowAttribs=function(e,t){for(var n=e.length,r=m.editor.changesetHelper,i=r.smartOpAssembler(),o=m.tableConfig,a=o.isCustomBackgroundColor,s=o.isCustomBorder,l=o.isCustomFont,c=0;c<n;c++){var u,d,f,h,p,g=[m.getRowSpanAttribs(c)];s&&(u=m.getRowBorderAttribs(e,t,c),g.push(u)),a&&(d=m.getRowBackgroundAttribs(e,t,c),g.push(d)),l&&(f=m.getRowFontWeightAttribs(e,t,c),h=m.getRowFontSizeAttribs(e,t,c),p=m.getRowFontFamilyAttribs(e,t,c),g.push(f,h,p));var v=r.makeAttribsString("+",g,m.collector.apool);i.append({opcode:"+",chars:1,lines:0,attribs:v})}return i.toString()},this.colAttribs=function(e,t){for(var n=t.length,r=m.editor.changesetHelper,i=r.smartOpAssembler(),o=m.tableConfig,a=o.isCustomBackgroundColor,s=o.isCustomBorder,l=o.isCustomFont,c=0;c<n;c++){var u,d,f,h,p,g=[m.getColSpanAttribs(c),m.getColWidthAttrib(c)];s&&(u=m.getColBorderAttribs(e,t,c),g.push(u)),a&&(d=m.getColBackgroundAttribs(e,t,c),g.push(d)),l&&(f=m.getColFontWeightAttribs(e,t,c),h=m.getColFontSizeAttribs(e,t,c),p=m.getColFontFamilyAttribs(e,t,c),g.push(f,h,p));var v=r.makeAttribsString("+",g,m.collector.apool);i.append({opcode:"+",chars:1,lines:0,attribs:v})}return i.toString()},he()(n).find("colgroup col").each(function(e,t){var n=Number(he()(t).attr("span"))||1,r=he()(t).attr("width"),i="100";for(r&&!isNaN(parseFloat(r))&&(i=parseFloat(r).toString()),m.colWidths.push(i);1<n;)m.colWidths.push(i),n--}),0!==this.colWidths.length||(r=n.getAttribute("data-ace-table-col-widths"))&&(this.colWidths=r.split(";")),this.tableConfig=Object(W.default)(e,["plugins","table","options"],{})}var Iu={div:1,p:1,pre:1,li:1,code:1,blockquote:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,h7:1,h8:1};function Su(e){return e.normalize?e.normalize("NFC"):e}function Tu(e){var t,n=io(e,"class")||"";return n&&(t=/lineguid-(\S+)/.exec(n))?t[1]:qi()}function Ou(e){var t=io(e,"class"),n=io(e,"style");return!!(t&&-1<t.indexOf("list-code"))||!(!n||!/\bdisplay:\s*block\b/i.test(n))}function wu(e){return"code"===(oo(e)||"").toLowerCase()?Ou(e):!Li(e)&&!!Iu[(oo(e)||"").toLowerCase()]&&!/\bdisplay:\s*inline\b/.test(io(e,"style"))}function Ru(e,t,n){var r=e&&e.className||"",i=(oo(e)||"").toLowerCase(),o="li"===i,a="blockquote"===i||r.includes("blockquote"),s="table"===i,l=n&&r.includes("list-code")&&(!t.list||!t.list.includes("code"));return o||a||s||l}function Au(e){var t=e.replace(/(\n | \n)/g," ").replace(/[\n\r ]/g," ").replace(/\xa0/g," ").replace(/\t/g,"        ");return t.normalize?t.normalize("NFC"):Su(t)}function xu(e,t){return so(e,"_magicdom_"+t)}var Mu=Nu;function Nu(e){var n=this;this.editor=e,this.textArray=[],this.attribsArray=[],this.attribsBuilder=null,this.length=function(){return n.textArray.length},this.atColumnZero=function(){return""===n.textArray[n.textArray.length-1]},this.startNew=function(){n.ignoreStartNewLine=!1,n.isTentativeNewline=!1;var e=n.editor.changesetHelper;n.textArray.push(""),n.flush(),n.attribsBuilder=e.smartOpAssembler()},this.textOfLine=function(e){return n.textArray[e]},this.appendText=function(e,t){0<e.length&&(n.ignoreStartNewLine=!1,n.isTentativeNewline&&n.startNew(),n.isTentativeNewline=!1,n.textArray[n.textArray.length-1]+=e,n.op.attribs=t,n.op.chars=e.length,n.attribsBuilder.append(n.op))},this.markIgnoreStartNewLine=function(){n.ignoreStartNewLine=!0},this.getIsPostionMarkedToIgnoreNewLine=function(){return n.ignoreStartNewLine},this.setTentativeNewline=function(e){n.isTentativeNewline=!0,e&&(n.isTentativeNewlineUncancelable=!0)},this.cancelTentativeNewLine=function(){n.isTentativeNewlineUncancelable||(n.isTentativeNewline=!1)},this.textLines=function(){return n.textArray.slice()},this.attribLines=function(){return n.attribsArray},this.flush=function(){n.attribsBuilder&&(n.attribsArray.push(n.attribsBuilder.toString()),n.attribsBuilder=null)},this.isEmptyLine=function(e){return 0===n.textOfLine(e).length};var t=this.editor.changesetHelper;this.op=t.newOp("+"),this.startNew()}var _u=(Lu.prototype._ensureColumnZero=function(e){this.lines.atColumnZero()||this.startNewLine(this.state)},Lu.prototype._pushNewLines=function(){var e=new Mu(this.editor);return this.lines=e,this.linesStack.push(e),e},Lu.prototype._popLines=function(){var e=this.linesStack.pop();return this.lines=this.linesStack[this.linesStack.length-1],e},Lu.prototype._isEmpty=function(e,t){var n=this._reachPoint,r=e?e.className:void 0;if(/dom-pass-empty-check/.test(r))return!1;var i,o=ao(e);return 0===o&&"TD"!==e.nodeName||!(1!==o||!xu(e,"shouldBeEmpty")||"&nbsp;"!==e.innerHTML||xu(e,"unpasted"))&&(t&&(n(i=lo(e,0),0,t),n(i,1,t)),!0)},Lu.prototype._pointHere=function(e,t){var n=this.lines.length()-1,r=this.lines.textOfLine(n).length;return 0===r&&this.hasLineAttributes(t)&&(r+=1),[n,r+=e]},Lu.prototype._reachBlockPoint=function(e,t,n){1<this.linesStack.length||Li(e)||this._reachPoint(e,t,n)},Lu.prototype.hasLineAttributes=function(e){return!Object(D.default)(e.lineAttributes)||!Object(D.default)(e.oneLineAttributes)},Lu.prototype._reachPoint=function(e,t,n){this.linesStack.length<1||(this.startPoint&&e===this.startPoint.node&&this.startPoint.index===t&&(this.selStart=this._pointHere(0,n)),this.endPoint&&e===this.endPoint.node&&this.endPoint.index===t&&(this.selEnd=this._pointHere(0,n)))},Lu.prototype._reachAllPoints=function(e,t){var n,r;if(!(1<this.linesStack.length||(this.startPoint&&this.startPoint.node===t&&(this.selStart=this._pointHere(0,e)),this.endPoint&&this.endPoint.node===t&&(this.selEnd=this._pointHere(0,e)),Li(t))))try{for(var i=ge(Array.from(t.childNodes)),o=i.next();!o.done;o=i.next()){var a=o.value;this._reachAllPoints(e,a)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},Lu.prototype.incrementFlag=function(e,t){this.state.flags[t]=(this.state.flags[t]||0)+1},Lu.prototype.decrementFlag=function(e,t){this.state.flags[t]--},Lu.prototype.updateAttribs=function(e,t,n,r){var i,o=e.attribs,a=e.attribsValues;void 0!==o[t]?(i=a[t],r?i.push(n):(i.pop(),i[i.length-1]&&(n=i[i.length-1])),r||0!==i.length?o[t]!==n&&(o[t]=n):(delete o[t],delete a[t])):(o[t]=n,a[t]=[n])},Lu.prototype.incrementAttrib=function(e,t,n){void 0===n&&(n=!0),this.updateAttribs(e,t,n,!0),this._recalcAttribString(e)},Lu.prototype.decrementAttrib=function(e,t){var n=e.attribs[t];this.updateAttribs(e,t,n,!1),this._recalcAttribString(e)},Lu.prototype.startList=function(e,t){this._startList(e,t)},Lu.prototype._setListId=function(e,t){e.lineAttributes["ol-id"]=t[1],this._recalcAttribString(e)},Lu.prototype._startList=function(e,t){t&&(e.lineAttributes.start=t),this._recalcAttribString(e)},Lu.prototype.enterList=function(e,t){this._enterList(e,t)},Lu.prototype.recalcAttribString=function(e){this._recalcAttribString(e)},Lu.prototype._setListOriginStart=function(e,t){t&&(e.lineAttributes["origin-start"]=t),this._recalcAttribString(e)},Lu.prototype._enterList=function(e,t){var n=e.lineAttributes.list;return"none"!==t&&(e.listNesting=(e.listNesting||0)+1),"none"!==t&&t?e.lineAttributes.list=t:e.lineAttributes["text-indent"]||delete e.lineAttributes.list,this._recalcAttribString(e),n},Lu.prototype._exitList=function(e,t){e.lineAttributes.list&&e.listNesting--,t&&"none"!==t?e.lineAttributes.list=t:(delete e.lineAttributes.list,delete e.lineAttributes.start),delete e.lineAttributes["origin-start"],delete e.lineAttributes.lang,this._recalcAttribString(e)},Lu.prototype._enterAuthor=function(e,t){var n=e.author;return e.authorLevel=(e.authorLevel||0)+1,e.author=t,this._recalcAttribString(e),n},Lu.prototype._exitAuthor=function(e,t){e.authorLevel--,e.author=t,this._recalcAttribString(e)},Lu.prototype._recalcAttribString=function(e){var t,n,r,i,o=[];for(t in e.attribs)e.attribs[t]&&("string"==typeof e.attribs[t]?o.push([t,e.attribs[t]]):(n="::",1<(r=t.split(n)).length?o.push([r[0],r[1]]):o.push([t,"true"])));0<e.authorLevel&&(i=["author",e.author],0<=this.apool.putAttrib(i,!0)&&o.push(i)),e.table&&e.table.getAttrib()&&e.table.getAttrib().forEach(function(e){o.push(e)}),e.sheetPlaceholder&&o.push(e.sheetPlaceholder),e.dataMetaBlockProps&&o.push(e.dataMetaBlockProps),e.sheetId&&o.push(e.sheetId),e.sheetToken&&o.push(e.sheetToken),e.hrline&&o.push(e.hrline),e.imageUploaded&&o.push(e.imageUploaded);var a=this.editor.changesetHelper;e.lineguid&&o.push(["lineguid",e.lineguid]),e.attribString=a.makeAttribsString("+",o,this.apool)},Lu.prototype._produceLineAttributesMarker=function(e){var n=[["lmkr","1"],["insertorder","first"]];Object(B.a)(e.lineAttributes,function(e,t){return n.push([t,e])}),Object(B.a)(e.oneLineAttributes,function(e,t){return n.push([t,e])}),e.oneLineAttributes={};var t=this.editor.changesetHelper;this.lines.appendText("*",t.makeAttribsString("+",n,this.apool))},Lu.prototype.fixLineNumber=function(e,t,n){if(!(e[0]<0)){var r=e[0],i=e[1];if(n<r)r+=t.length-1;else if(r===n){for(var o=0;i>t[o].length;)i-=t[o].length,o++;r+=o}e[0]=r,e[1]=i}},Lu.prototype.startNewLine=function(e){e&&(e.lineguid=qi(),this._recalcAttribString(e),0===this.lines.textOfLine(this.lines.length()-1).length&&this.hasLineAttributes(e)&&this._produceLineAttributesMarker(e)),this.lines.startNew()},Lu.prototype.notifySelection=function(e){e&&(this.selection=e,this.startPoint=this.selection.startPoint,this.endPoint=this.selection.endPoint)},Lu.prototype.doAttrib=function(e,t,n){void 0===n&&(n=!0),e.localAttribs=e.localAttribs||[],e.localAttribs.push(t),this.incrementAttrib(e,t,n)},Lu.prototype.initState=function(){return{flags:{},localAttribs:null,attribs:{},attribString:"",lineAttributes:{},oneLineAttributes:{},attribsValues:{}}},Lu.prototype.getStateWithoutListAttributes=function(e){var t,n;if(!e||!e.lineAttributes)return e;var r=["list","ul-id","ol-id","start","origin-start"],i={},o=Object.keys(e.lineAttributes);try{for(var a=ge(o),s=a.next();!s.done;s=a.next()){var l=s.value;r.includes(l)||(i[l]=e.lineAttributes[l])}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return ue(ue({},e),{lineAttributes:i})},Lu.prototype.processBeforeAppendText=function(e){var t=e;return this.filterRegExps.forEach(function(e){t=t.replace(e,"")}),t},Lu.prototype.collectContent=function(e,t){var n,r,i,o,a=this;t||(t=this.initState(),(this.state=t).lineguid=Tu(e),this._recalcAttribString(t));var s=t.localAttribs;t.localAttribs=null;var l,c,u,d=wu(e),f=this._isEmpty(e,t),h=e&&e.className||"",p=/ignore-dom|ignore-collect/.test(h),g=this.lines.getIsPostionMarkedToIgnoreNewLine(),v=d&&Ru(e,t.lineAttributes,g);d&&(v?this._ensureColumnZero(t):"true"===io(e,"data-ace-ignore-block-newlines")?(this.lines.markIgnoreStartNewLine(),t.listNesting=0,c=(l=he()(e).find(">:not(meta)")).get(0),u=".blockquote,blockquote,li,table",l.length&&he()(c).find(u).addBack(u).length&&((s||[]).forEach(function(e){return a.decrementAttrib(t,e)}),s=null,this.state.lineAttributes={})):this.lines.getIsPostionMarkedToIgnoreNewLine()||this._ensureColumnZero(t));var m=!1,y=!1;if(this._reachBlockPoint(e,0,t),Li(e)){var b=co(e),E=io(e.parentNode,"name"),k=this.hooks.callAll("collectContentLineText",{cc:this,state:t,tname:E,node:e,text:b,styl:null,cls:null}),C="",I=0;for(0===(b=(b="object"===fe()(k)&&0===k.length?co(e):k[0])||"").length&&(this.startPoint&&e===this.startPoint.node&&(this.selStart=this._pointHere(0,t)),this.endPoint&&e===this.endPoint.node&&(this.selEnd=this._pointHere(0,t)));0<b.length;){var S,T=0;t.flags.preMode?(T=(S=b.split("\n",1)[0]).length+1,C=b.substring(T),b=S):C="",this.startPoint&&e===this.startPoint.node&&this.startPoint.index-I<=b.length&&(this.selStart=this._pointHere(this.startPoint.index-I,t)),this.endPoint&&e===this.endPoint.node&&this.endPoint.index-I<=b.length&&(this.selEnd=this._pointHere(this.endPoint.index-I,t));var O=b;(!t.flags.preMode&&/^[\r\n]*$/.test(b)||t.inTableLine&&t.table&&!t.table.isInCell())&&(O="");var w=0===this.lines.textOfLine(this.lines.length()-1).length;if(w&&(O=O.replace(/^\n*/,"")),""===O&&""===C)break;w&&this.hasLineAttributes(t)&&this._produceLineAttributesMarker(t),O=this.processBeforeAppendText(O),this.lines.appendText(Au(O),t.attribString),I+=T,b=C,e.previousSibling&&e.previousSibling.tagName&&"img"===e.previousSibling.tagName.toLowerCase()?(this.startNewLine(t),t.imageUploaded=null,this._recalcAttribString(t)):C&&this.startNewLine(t)}}else{var R=io(e,"style"),x=io(e,"class");if("table"===(E=(oo(e)||"").toLowerCase())&&(m=t.inTableLine=!0),"img"===E?this.hooks.callAll("collectContentImage",{cc:this,state:t,tname:E,styl:R,cls:x,node:e}):delete t.lineAttributes.img,"br"===E){this.breakLine=!0;var M=io(e,"value"),N=this.hooks.callAll("collectContentLineBreak",{cc:this,state:t,node:e,tname:E,tvalue:M,styl:null,cls:null});("object"===fe()(N)&&0===N.length||N[0])&&this.startNewLine(t)}else if("script"!==E&&"style"!==E&&!f){var _=io(e,"style"),L=io(e,"class"),D="pre"===E;(D=D||!(!_||!/\bwhite-space:\s*pre\b/i.exec(_)))&&this.incrementFlag(t,"preMode");var B,P,F,j=null,z=null,H=function(e){j=e},U=void 0;if(this.collectStyles){this.formatterRenderer&&(U=this.formatterRenderer.callCollectHook(e,t,this)),this.hooks.callAll("collectContentPre",{cc:this,state:t,tname:E,styl:_,cls:L,node:e,setOldListTypeOrNull:H}),"span"===E&&L&&(-1<L.indexOf("horizontal-line")&&(t.hrline=["horizontal-line",1],this._recalcAttribString(t),this.lines.appendText(Au(" "),t.attribString)),-1<L.indexOf("sheet-placeholder-")&&(B=/sheet-placeholder-(\S*)/.exec(L),t.sheetPlaceholder=["sheet-placeholder",B[1]],this._recalcAttribString(t)),-1<L.indexOf("sheet-id-")&&-1<L.indexOf("sheet-token-")&&(P=/sheet-id-(\S*)/.exec(L),F=/sheet-token-(\S*)/.exec(L),t.sheetId=["sheet-id",P[1]],t.sheetToken=["sheet-token",F[1]],this._recalcAttribString(t),"history"===this.mode&&this.lines.appendText(Au(" "),t.attribString))),"div"===E&&io(e,"class")&&e&&he()(e).parents(".gallery").length&&(y=!0),("b"===E||"strong"===E||_&&/\bfont-weight:\s*bold\b/i.test(_))&&this.doAttrib(t,"bold"),("i"===E||"em"===E||_&&/\bfont-style:\s*italic\b/i.test(_))&&this.doAttrib(t,"italic"),("u"===E||"ins"===E||_&&/\btext-decoration(-line)?:[^;]*underline\b/i.test(_))&&this.doAttrib(t,"underline"),("s"===E||"del"===E||"strike"===E||_&&/\btext-decoration(-line)?:[^;]*line-through\b/i.test(_))&&this.doAttrib(t,"strikethrough"),"code"!==E||Ou(e)||this.doAttrib(t,"inline-code");var V=void 0;if("ul"===E||"ol"===E||"code"===E&&Ou(e)){var W=L&&/(?:^| )list-([a-z]+[0-9]+)\b/.exec(L),K=!1,V=e.attribs?e.attribs.class:null;W&&W[1]&&"none"===(V=Zc(W[1],this.hooks.plugins)?W[1]:"none")&&(K=!0);var Z=L&&/(?:^| )ol-id(\S+)/.exec(L);!K&&Z&&this._setListId(t,Z);var q=parseInt(e.start||e.getAttribute("start"));if(!K&&q&&this._startList(t,q),!K&&e.dataset&&e.dataset.originStart&&this._setListOriginStart(t,parseInt(e.dataset.originStart,10)||1),!W&&!V)for(var J in e.children)if(e.children[J]&&"ul"===e.children[J].name&&(V=e.children[J].attribs.class))break;W&&W[1]||(V="code"===E?"code":"ul"===E?V&&V.match("indent")||e.attribs&&e.attribs.class&&e.attribs.class.match("indent")?"indent":"bullet":"number",V+=String(Math.min(this.editor.maxListLevel,(t.listNesting||0)+1))),j=this._enterList(t,V)||"none"}if(this.className2Author&&L){var Y=L.match(/\S+/g);if(Y&&0<Y.length)try{for(var Q=ge(Y),X=Q.next();!X.done;X=Q.next()){var $=X.value,ee=this.className2Author($);if(ee){z=this._enterAuthor(t,ee)||"none";break}}}catch(e){n={error:e}}finally{try{X&&!X.done&&(r=Q.return)&&r.call(Q)}finally{if(n)throw n.error}}}}var te=!1,ne=!1,re=!1;if(!p){"table"!==E?t.table&&!t.table.isInCell()&&("tr"===E?(t.table.enterRow(),ne=!0):"td"!==E&&"th"!==E||(t.table.enterCell(),re=!0)):t.table||this.tagsIgnoreToParse.table||(t.table=new ku(this.editor,this,e),te=!0,e.previousSibling&&"META"!==e.previousSibling.tagName&&!this.lines.isEmptyLine(this.lines.length()-1)&&this.startNewLine(t));for(var ie,oe=ao(e),J=0;J<oe;J++){var ae,$=lo(e,J);t.table&&t.table.isInCell()||t.zone&&t.zone.inZone()?((ae=this.initState()).lineguid=qi(),this._recalcAttribString(ae),this.collectContent($,ae)):this.collectContent($,t)}te?(t.table.exit(),ie=t.lineAttributes,t.lineAttributes={},this._recalcAttribString(t),t.table.nonEmpty()&&(this._ensureColumnZero(t),this.lastLineWithTable=this.lines.length()-1,this.lines.appendText("*",t.attribString),this.startNewLine(t)),t.table=null,t.lineAttributes=ie,this._recalcAttribString(t),this._reachAllPoints(t,e)):ne?t.table.exitRow():re&&t.table.exitCell(e,_)}if(this.collectStyles&&(U&&U(),this.hooks.callAll("collectContentPost",{cc:this,state:t,tname:E,styl:_,cls:L,node:e})),D&&this.decrementFlag(t,"preMode"),t.localAttribs)try{for(var se=ge(t.localAttribs),le=se.next();!le.done;le=se.next()){var ce=le.value;this.decrementAttrib(t,ce)}}catch(e){i={error:e}}finally{try{le&&!le.done&&(o=se.return)&&o.call(se)}finally{if(i)throw i.error}}j&&this._exitList(t,j),z&&this._exitAuthor(t,z);var ue,de=!1;for(ue in t)("hrline"===ue||"imageUploaded"===ue||-1<ue.indexOf("sheet"))&&(de=!(t[ue]=null));de&&this._recalcAttribString(t)}}this._reachBlockPoint(e,1,t),m?t.inTableLine=!1:!d||t.inTableLine||y||p||("true"===io(e,"data-ace-ignore-block-newlines")?(this.lines.isTentativeNewlineUncancelable||(t.lineguid=this.lastLineguid,this._recalcAttribString(t)),this.lines.cancelTentativeNewLine()):this.lines.atColumnZero()||(this.lines.setTentativeNewline(v),this.lastLineguid=t.lineguid,t.lineguid=qi(),this._recalcAttribString(t))),t.localAttribs=s},Lu);function Lu(e){this.state={},this.selStart=[-1,-1],this.selEnd=[-1,-1],this.additionalZatext_={text:{},attribs:{},rows:{},cols:{}},this.notifyNextNode=function(e){e&&(!wu(e)||this._isEmpty(e))||this._ensureColumnZero(null)},this.getSelectionStart=function(){return this.selStart},this.getSelectionEnd=function(){return this.selEnd},this.getLines=function(){return this.lines.textLines()},this.finish=function(){this._ensureColumnZero(),this.lines.flush();var e=this.lines.attribLines(),t=this.getLines();return t.length--,e.length--,0===t.length&&(t.push(""),e.push("")),{selStart:this.getSelectionStart(),selEnd:this.getSelectionEnd(),linesWrapped:0,numLinesAfter:0,lines:t,lineAttribs:e,additionalZatext:this.additionalZatext_}};var t=e.collectStyles,n=e.abrowser,r=e.apool,i=e.domInterface,o=e.className2Author,a=e.mode,s=e.hooks,l=e.tagsIgnoreToParse,c=e.forPaste,u=e.editor,d=e.formatterRenderer;this.editor=u,this.abrowser=n||{},this.collectStyles=t,this.apool=r,this.hooks=s,this.domInterface=i,this.className2Author=o,this.mode=a,this.selection=void 0,this.startPoint=void 0,this.endPoint=void 0,this.lines=new Mu(this.editor),this.linesStack=[this.lines],this.forPaste=!!c,this.tagsIgnoreToParse=l||{},this.formatterRenderer=d,this.filterRegExps=[/[\b]/g],this.lastLineguid=qi()}function Du(e){return new _u(e)}var Bu,Pu=Object.freeze({__proto__:null,Lines:Mu,ContentCollector:_u,sanitizeUnicode:Su,makeContentCollector:Du}),Fu=(ce(ju,Bu=xs),ju.prototype.initTracker=function(e,t){var n=this.tracker(e);n&&n.initTracker(t,this.hasLineGuid)},ju.prototype.setEditor=function(e){this.editor=e},ju.prototype.getTracker=function(e){return void 0===e&&(e="0"),this.tracker(e)},ju.prototype.tracker=function(e){return this.trackers?(this.trackers[e]||(this.trackers[e]=new Hu),this.trackers[e]):null},ju.prototype.splice=function(e,t,n,r){var i=this,o=this.tracker(e);o&&o.splice(t,n,r.map(function(e){var t=i.hasLineGuid(e);return{key:"lineguid",value:t,hasLineGuid:!!t}})),o&&o.hasAnyDirtyLines()?this.dirtyZones.set(e,!0):this.dirtyZones.delete(e)},ju.prototype.doUpdate=function(e){var t=this;if(this.editor&&this.trackers){if(!e){if(this.editor.dirtyChecker.observer.safeHasDirtyRanges())throw new Error("DOM must be clean for doUpdate()");this.trackers[Vo.ROOT_ZONE].getAllDirtyLines().forEach(function(e){t.trackers&&t.trackers[Vo.ROOT_ZONE].markClean(e.lineNum)})}this.dirtyZones=new Map}},ju.prototype.markClean=function(e,t){var n=this.tracker(e);n&&(n.markClean(t),n.hasAnyDirtyLines()||this.dirtyZones.delete(e))},ju.prototype.destroy=function(){this.editor=null,this.pool=null,this.trackers=null,this.dirtyZones=new Map},ju);function ju(){var n=null!==Bu&&Bu.apply(this,arguments)||this;return n.hasLineGuid=function(e){var t=n.pool;return t?Object(F.attribsAttributeValue)(e,"lineguid",t):""},n}var zu,Hu=(ce(Uu,zu=Pa),Uu.prototype.initTracker=function(e,n){this.entries=e.map(function(e){var t=n(e);return{key:"lineguid",value:t,hasLineGuid:!!t}}),this.existedLineGuidID=this.entries.map(function(e){return e.value})},Uu.prototype.splice=function(e,t,n){this.dirtyRangeStarts=[],Array.prototype.splice.apply(this.entries,me([e,t],n));var r=new Array(n.length).fill("");Array.prototype.splice.apply(this.existedLineGuidID,n.length?me([e,t],r):[e,t]);for(var i=e+n.length,o=e;o<i;o++){var a=this.entries[o].value;(!this.entries[o].hasLineGuid||a&&this.existedLineGuidID.includes(a))&&this.dirtyRangeStarts.push(o),this.existedLineGuidID[o]=a}},Uu.prototype.markClean=function(e){var t;this.entries[e].hasLineGuid||(this.entries[e].hasLineGuid=!0,t=this.dirtyRangeStarts.indexOf(e),this.dirtyRangeStarts.splice(t,1))},Uu.prototype.getAllDirtyLines=function(){var n=this,r=[];return this.dirtyRangeStarts.forEach(function(e){for(var t=e;t<n.entries.length&&!n.entries[t].hasLineGuid;t++)r.push({lineNum:t,hasLineGuid:n.entries[t]})}),r},Uu.prototype.hasAnyDirtyLines=function(){return 0<this.dirtyRangeStarts.length},Uu.prototype.get=function(e){return this.entries[e]},Uu);function Uu(){var e=zu.call(this)||this;return e.dirtyRangeStarts=[],e.existedLineGuidID=[],e.entries=[{key:"lineguid",value:"",hasLineGuid:!1}],e}var Vu=(Wu.prototype.initTracker=function(e,t){this.collapseLines&&this.collapseLines.initTracker(e,t),this.lineGuidLines&&this.lineGuidLines.initTracker(e,t)},Wu.prototype.setEditor=function(e){this.collapseLines&&this.collapseLines.setEditor(e),this.lineGuidLines&&this.lineGuidLines.setEditor(e)},Wu.prototype.splice=function(e,t,n,r){this.collapseLines&&this.collapseLines.splice(e,t,n,r),this.lineGuidLines&&this.lineGuidLines.splice(e,t,n,r)},Wu.prototype.markClean=function(e,t){this.collapseLines&&this.collapseLines.markClean(e,t),this.lineGuidLines&&this.lineGuidLines.markClean(e,t)},Wu.prototype.doUpdate=function(e){this.collapseLines&&this.collapseLines.doUpdate(e),this.lineGuidLines&&this.lineGuidLines.doUpdate(e)},Wu.prototype.destroy=function(){this.collapseLines&&this.collapseLines.destroy(),this.lineGuidLines&&this.lineGuidLines.destroy()},Wu);function Wu(e,t,n){this.collapseLines=n?new xs(e,t):null,this.lineGuidLines=new Fu(e,t)}var Ku,Zu,Gu=Ce.isMac;(Zu=Ku=Ku||{})[Zu.BackSpace=8]="BackSpace",Zu[Zu.Tab=9]="Tab",Zu[Zu.Clear=12]="Clear",Zu[Zu.Enter=13]="Enter",Zu[Zu.Shift=16]="Shift",Zu[Zu.Ctrl=17]="Ctrl",Zu[Zu.Alt=18]="Alt",Zu[Zu.Esc=27]="Esc",Zu[Zu.Space=32]="Space",Zu[Zu.PageUp=33]="PageUp",Zu[Zu.PageDown=34]="PageDown",Zu[Zu.End=35]="End",Zu[Zu.Home=36]="Home",Zu[Zu.Left=37]="Left",Zu[Zu.Up=38]="Up",Zu[Zu.Right=39]="Right",Zu[Zu.Down=40]="Down",Zu[Zu.Delete=46]="Delete",Zu[Zu.Digit0=48]="Digit0",Zu[Zu.Digit9=57]="Digit9",Zu[Zu.A=65]="A",Zu[Zu.B=66]="B",Zu[Zu.C=67]="C",Zu[Zu.D=68]="D",Zu[Zu.E=69]="E",Zu[Zu.F=70]="F",Zu[Zu.G=71]="G",Zu[Zu.H=72]="H",Zu[Zu.I=73]="I",Zu[Zu.J=74]="J",Zu[Zu.K=75]="K",Zu[Zu.L=76]="L",Zu[Zu.M=77]="M",Zu[Zu.N=78]="N",Zu[Zu.O=79]="O",Zu[Zu.P=80]="P",Zu[Zu.Q=81]="Q",Zu[Zu.R=82]="R",Zu[Zu.S=83]="S",Zu[Zu.T=84]="T",Zu[Zu.U=85]="U",Zu[Zu.V=86]="V",Zu[Zu.W=87]="W",Zu[Zu.X=88]="X",Zu[Zu.Y=89]="Y",Zu[Zu.Z=90]="Z",Zu[Zu.Meta=91]="Meta",Zu[Zu.RightMeta=92]="RightMeta",Zu[Zu.Numpad0=96]="Numpad0",Zu[Zu.Numpad9=105]="Numpad9",Zu[Zu.F11=122]="F11",Zu[Zu["/"]=191]="/",Zu[Zu["\\"]=220]="\\",Zu[Zu.Ime=229]="Ime";var qu=[Ku.Up,Ku.Down,Ku.Left,Ku.Right],Ju=[Ku.C,Ku.V,Ku.X],Yu=[Ku.B,Ku.F];function Qu(e){return Xu(e)&&-1!==Ju.indexOf(e.keyCode)}function Xu(e){return Gu||Ce.safari?e.metaKey&&!e.altKey:e.ctrlKey&&!e.altKey}var $u=[[0,8204],[8206,55295],[57344,65023],[65040,65535],[126976,127461],[127488,127994],[128e3,131071],[131072,196607],[196608,262143],[983040,1048575],[1048576,1114111]];function ed(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1),this.allowTextPresentation=!1,this.fullyQualified=!1,this.allowTextPresentation=e,this.fullyQualified=t}var td,nd,rd=new(ed.prototype.getRegexPattern=function(){return this.sequence()},ed.prototype.unicodeRange=function(e,t){var n,r,i=[],i=Array.isArray(e)?e:"number"==typeof t?[[e,t]]:[[e]],o=z()();try{for(var a=ge(i),s=a.next();!s.done;s=a.next()){var l=s.value;1===l.length?o.add(l[0]):o.addRange(l[0],l[1])}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o.toString()},ed.prototype.sequence=function(){return"("+this.zwjSequence()+"|"+this.tagSequence()+"|"+this.coreSequence()+")"},ed.prototype.coreSequence=function(){return"("+this.modifierSequence()+"|"+this.combiningSequence()+"|"+this.flagSequence()+")"},ed.prototype.zwjSequence=function(){return"("+this.zwjElement()+"("+this.zwj()+this.zwjElement()+")+)"},ed.prototype.tagSequence=function(){return"("+this.tagBase()+this.tagSpec()+this.tagTerm()+")"},ed.prototype.combiningSequence=function(){return"("+this.keycapSequence()+"|"+this.presentationSequence()+"|"+this.modifier()+")"},ed.prototype.modifierSequence=function(){return"("+this.modifierBase()+this.modifier()+")"},ed.prototype.flagSequence=function(){return"(("+this.regionalIndicator()+"){2})"},ed.prototype.presentationSequence=function(){return"("+this.character()+this.presentationSelector()+")"},ed.prototype.keycapSequence=function(){return"([\\d#*]"+this.presentationSelector()+this.unicodeRange(8419)+")"},ed.prototype.zwjElement=function(){return"("+this.presentationSequence()+"("+this.modifier()+")?)"},ed.prototype.character=function(){return"("+this.unicodeRange($u)+")"},ed.prototype.zwj=function(){return this.unicodeRange(8205)},ed.prototype.tagBase=function(){return"("+this.modifierSequence()+"|"+this.presentationSequence()+")"},ed.prototype.presentationSelector=function(){var e=[];return this.allowTextPresentation&&e.push(this.unicodeRange(65038)),e.push(this.unicodeRange(65039)),(this.fullyQualified?e:e.map(function(e){return e+"?"})).join("")},ed.prototype.tagSpec=function(){return"("+this.unicodeRange(917536,917630)+")+"},ed.prototype.tagTerm=function(){return this.unicodeRange(917631)},ed.prototype.modifierBase=function(){return this.character()},ed.prototype.modifier=function(){return this.unicodeRange(127995,127999)},ed.prototype.regionalIndicator=function(){return this.unicodeRange(127462,127487)},ed),id=function(e){var t=void 0===e?{}:e,n=t.start,r=void 0!==n&&n,i=t.end,o=void 0!==i&&i,a=null;if(r&&td)return td.lastIndex=0,td;if(o&&nd)return nd.lastIndex=0,nd;try{a=new RegExp((r?"^":"")+rd.getRegexPattern()+(o?"$":""),"g"),r?td=a:nd=a}catch(e){a=null}return a},od=function(e){var t=id({start:!0});if(!t)return 1;if(e.length<2)return Math.max(e.length,1);t.lastIndex=0;var n=t.exec(e);return n&&n[0]?n[0].length:1},ad=function(e){var t=id({end:!0});if(!t)return 1;if(e.length<2)return Math.max(e.length,1);t.lastIndex=0;var n=t.exec(e);return n?e.length-n.index:1},sd=function(e){return ad(e)},ld=function(e){return 56320<=e&&e<=57343},cd=ud;function ud(e){var a=this;this.overallContentEditable=!1,this.zoneIdReg=new RegExp("[^a-z0-9]"),this.isDisposed=!1,this.bindEvent=function(){a.$el.on("focus",a.handleFocus),a.$el.on("blur",a.handleBlur),a.$el.on("mouseenter",a.handleMouseEnter),a.$el.on("mouseleave",a.handleMouseLeave),a.$el.on("keydown",a.handleKeyDown),a.editor.on("ace-table-editable-change",a.handleEditableChange),a.editor.on("mobile-ace-table-status-change",a.handleMobileTableStatus),a.editor.on("selectionchange",a.handleSelectionChange),a.editor.getObserver().observeNode(a.node),a.isDisposed=!1},this.handleSelectionChange=function(e){var t=e.previous,n=e.current,r=t.start.zoneId,i=n.start.zoneId;r!==i&&r===a.zoneId&&a.updateIsFocusedInRep(!1),i!==a.zoneId||a.isFocusedInRep||a.updateIsFocusedInRep(!0)},this.handleMobileTableStatus=function(e){var t,n=e.isFocus,r=e.zoneId;(a.isEditorContentEditable=n)&&r===a.zoneId?(a.updateContentEditableness(),ta(a.node),t=a.editor.getAttributesOnSelection(r,a.editor.getRep()[r]).attribsKey,a.editor.call("toolBarStatusChange",t)):n||(a.updateContentEditableness(),a.node.blur())},this.handleFocus=function(){a.isFocused=!0,a.updateContentEditableness(),a.editor.call("inner-zone-focus",{zoneId:a.zoneId})},this.handleBlur=function(){a.isFocused=!1,a.updateContentEditableness(),a.editor.call("inner-zone-blur",{zoneId:a.zoneId})},this.handleMouseEnter=function(){a.isMouseOver=!0,a.updateContentEditableness()},this.handleMouseLeave=function(){a.isMouseOver=!1,a.updateContentEditableness()},this.handleKeyDown=function(e){var t,n,r,i=a.editor,o=i.getRep();o.selStart&&o.selEnd&&i.selection.isCaret()&&(n=(t=o.lines.atIndex(o.selStart[0]))&&t.text.length===t.lineMarker,r=o.selStart[0]===o.lines.length()-1,n&&r&&e.keyCode===Ku.Delete&&e.preventDefault())},this.handleEditableChange=function(e){a.updateEditorContentEditable(e)},this.dispose=function(){a.$el.off(),a.editor.off("ace-table-editable-change",a.handleEditableChange),a.editor.off("mobile-ace-table-status-change",a.handleMobileTableStatus),a.editor.off("selectionchange",a.handleSelectionChange),a.isDisposed=!0},this.updateEditorContentEditable=function(e){a.isEditorContentEditable=e,a.updateContentEditableness()},this.updateContentEditableness=function(){var e=a.editor.getProps().innerZoneConfig;e&&e.stopUpdateInnerZoneEditableStatus||(a.editor.isContentEditable()?a.editor.getObserver().withoutRecordingMutations(function(){var e=!(!a.isEditorContentEditable||!(a.isMouseOver||a.isFocused||a.isFocusedInRep));e!==a.overallContentEditable&&(a.node.setAttribute("contentEditable",e?"true":"false"),a.overallContentEditable=e)}):null===a.overallContentEditable&&(a.node.setAttribute("contentEditable","false"),a.overallContentEditable=!1))},this.updateIsFocusedInRep=function(e){a.isFocusedInRep=e,a.updateContentEditableness()},this.updateNode=function(e){a.node=e},this.mountVNode=function(e){a.node=e,a.$el=he()(e),a.node.zoneId={value:a.zoneId}},this.getNode=function(){return a.node};var t,n=e.editor,r=e.zoneId,i=e.editable,o=e.$preRenderNode,s=e.browser;if(this.zoneId=r,this.editor=n,this.isEditorContentEditable=i,this.isMouseOver=!1,this.isFocused=!1,this.isFocusedInRep=!1,this.zoneIdReg.test(this.zoneId))throw new Error("bad zone id (regex): "+this.zoneId);s?(t=o||fd(this.zoneId),this.$el=t,this.node=this.$el.get(0),this.node.zoneId={value:this.zoneId},this.node.setAttribute("contenteditable",this.isEditorContentEditable.toString())):this.node=dd(r)}function dd(e){var t={class:"ace-editor selenium-inner-zone-ace-editor syntax notranslate zoneId-"+e,"data-zone-id":e,"data-gramm":"false",innerHTML:"",type:"vNode"};return Object.defineProperty(t,"outerHTML",{get:function(){return'<div class="'+String(t.class).replace(/"/g,"&quot;")+'" data-zone-id="'+String(t["data-zone-id"]).replace(/"/g,"&quot;")+'" data-gramm="'+String(t["data-gramm"]).replace(/"/g,"&quot;")+'">'+t.innerHTML+"</div>"},set:function(e){console.log("vNode does not support setter",e)}}),t}function fd(e){var t=document.createElement("div");return t.setAttribute("class","ace-editor selenium-inner-zone-ace-editor syntax notranslate zoneId-"+e),t.setAttribute("data-zone-id",e),t.setAttribute("data-gramm","false"),he()(t)}var hd=8203,Dom=function(){function Dom(e){var o=this;this.editorSelector=".innerdocbody",this.editorEl=he()(this.editorSelector)[0],this.viewportNode=null,this.rootZoneId="0",this.addRootOfZone=function(e,t){o.editor.log("1")},this.rootNodeOfZone=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!0);var r=o.editor;if(e===o.rootZoneId)return o.root;var i=r.innerZoneEditorNodes[e];return i?i.isDisposed&&i.bindEvent():(r.innerZoneEditorNodes[e]=new cd({zoneId:e,editor:r,editable:o.editor.isEditable(),browser:n}),t&&r.initZone(e)),o.editor.innerZoneEditorNodes[e].getNode()},this.getTopLevelNode=function(e){var t=e;if(!t||!t.parentNode||t===o.root)return null;for(;t.parentNode&&!o.isRootOfZone(t.parentNode);)if(!(t=t.parentNode).parentNode)return null;return t},this.isRootOfZone=function(e){if(e===o.root)return!0;if(!e||!e.zoneId)return!1;var t=o.editor.innerZoneEditorNodes[e.zoneId.value];return t&&t.getNode()===e},this.rootNodeOfZoneContaining=function(e){if(!e||e===o.root)return null;for(var t,n=e;!o.isRootOfZone(n);){n instanceof SVGElement&&((t=n.closest("svg"))&&(n=t));var r=n.parentNode;if(!(r instanceof HTMLElement)){if(n.root)if(o.editor.getRep(n.root.zoneId.value).lines.atKey(n.id))return n.root;return null}n=r}return n},this.zoneOfRootNode=function(e){return o.isRootOfZone(e)?e.zoneId.value:null},this.zoneOfTopLevelNode=function(e){var t=o.rootNodeOfZoneContaining(e);return t?o.zoneOfRootNode(t):null},this.zoneOfdom=function(e){if(o.isRootOfZone(e))return e.zoneId.value;var t=o.rootNodeOfZoneContaining(e);return t&&o.isRootOfZone(t)?t.zoneId.value:null},this.cloneNodes=function(e,t,n){for(var r=n.importNode(e,!0),i=r,o=null,a=[],o=t;o&&o!==e;o=o.parentNode){var s=o.parentNode;s&&(c=Array.prototype.indexOf.call(s.childNodes,o),a.push(c))}if(!o)throw new Error("startContainer is not  child of node");for(var l=a.length-1;0<=l;l--)var c=a[l],i=i.childNodes[c];return{outerClone:r,innerClone:i}},this.$=function(e){return he()(e||"",o.root)},this.isRootZoneId=function(e){return e===Vo.ROOT_ZONE},this.getSelectorWithId=function(e,t){return o.rootSelector+" #"+e+(t?" "+t:"")},this.getAceLineById=function(e){return document.getElementById(e)},this.getEditorEl=function(){return o.editorEl},this.getRoot=function(){return o.root},this.getRootForZone=function(e){return o.root.parentElement.getElementsByClassName("zoneId-"+e)[0]||null},this.getRootSelector=function(){return o.rootSelector},this.getScrollElSelector=function(){return o.editor.getScrollContainer()},this.getScrollContainer=function(){return o.editor.getScrollContainer()},this.getScrollPosition=function(){var e=o.getScrollContainer();return e?he()(e).scrollTop():0},this.getLineHeight=function(){return 26},this.getViewportNode=function(){return o.viewportNode||o.root},this.getAceLineForNode=function(e){if(e&&e.id&&e.id.includes("magicdomid-"))return e;if(!e||!e.parentNode||e===o.root)return null;for(e=e.parentNode;e&&!o.isRootOfZone(e.parentNode)&&(!e.id||!e.id.includes("magicdomid-"));)e=e.parentNode;return e},this.getEntryForNode=function(e){var t=o.getAceLineForNode(e);if(!t)return null;var n=o.zoneOfdom(t);return n?o.editor.getRep(n).lines.atKey(t.id):null},this.getParentZoneAceLine=function(e){if(!e||e===o.root)return null;for(var t=e;t.parentNode!==o.root;){if(!t.parentNode)return null;t=t.parentNode}return t},this.isNodeInEditor=function(e){return 0<he()(e).closest(o.editorSelector).length},this.isNodeLineManaged=function(e){return e&&0<he()(e).closest("[data-line-manager]").length},this.internalIsNodeDirty=function(e){if(!o.isRootOfZone(e.parentNode))return!0;var t=e._magicdom_dirtiness;return!t||e.id!==t.nodeId||!t.isManagedLine&&!!o.editor.getObserver().isNodeDirty(e)},this.getPadding=function(){return(he()(o.root).outerWidth()-he()(o.root).width())/2},this.setScrollPosition=function(e,t){var n,r=o.getScrollContainer();r&&(n=he()(r),t?n.animate({scrollTop:e},"fast"):n.scrollTop(e))},this.getRootNodeForDom=function(e){var t=e.className;return t&&t.indexOf&&-1!==t.indexOf("innerdocbody")?e:e.closest?e.closest(".innerdocbody"):he()(e).closest(".innerdocbody").get(0)},this.isCurrentContext=function(e){if(e===o.root)return!0;for(var t in o.editor.innerZoneEditorNodes)if(o.editor.innerZoneEditorNodes[t]===e)return!0;return!1},this.editor=e.editor,this.root=e.root,this.editorSelector=this.editor.docbody,this.editorEl=he()(this.editorSelector)[0]}return Dom.isNodeText=function(e){return 3===e.nodeType},Dom.nodeTagName=function(e){return e.tagName},Dom.nodeValue=function(e){var t=e.nodeValue,n=e.parentNode;if(Dom.isFakeNode(n)){var r=n.getAttribute("data-contentcollector-ignore-space-at");return"start"===r&&t.length?8203===t[t.length-1].charCodeAt(0)?t.substr(0,t.length-1):t.substr(1):"end"===r&&t.length?8203===t[0].charCodeAt(0)?t.substr(1):t.substr(0,t.length-1):t}return t},Dom.nodeNumChildren=function(e){return null==e.childNodes?0:e.childNodes.length},Dom.nodeChild=function(e,t){return null==e.childNodes.item?e.childNodes[t]:e.childNodes.item(t)},Dom.nodeProp=function(e,t){return e[t]},Dom.nodeAttr=function(e,t){return null!=e.getAttribute?e.getAttribute(t):null!=e.attribs?e.attribs[t]:null},Dom.optNodeInnerHTML=function(e){return e.innerHTML},Dom.isNodeComment=function(e){return 8===e.nodeType},Dom.isFakeText=function(e){return"string"==typeof e},Dom.isFakeNode=function(e){return e&&e.getAttribute&&"string"==typeof e.getAttribute("data-faketext")},Dom.getFakeData=function(e){if(e&&e.getAttribute){var t=e.getAttribute("data-faketext"),n=e.innerText,r=n.length,i=e.getAttribute("data-contentcollector-ignore-space-at");return"start"===i&&r?8203===n.charCodeAt(r-1)?n.substr(0,n.length-1):n&&n.substr(1):"end"===i&&r?8203===n.charCodeAt(0)?n.substr(1):n&&n.substr(0,n.length-1):t}return null},Dom.nodeText=function(e){var t,n;if(Ce.msie)return e.innerText;if(Dom.isNodeText(e))return e.textContent;if(Dom.isNodeComment(e))return"";var r=Dom.getFakeData(e);if(Dom.isFakeText(r))return r;if(e.className&&-1!==e.className.indexOf(Si))return" ";var i="";try{for(var o=ge(Array.from(e.childNodes)),a=o.next();!a.done;a=o.next()){var s=a.value;i+=Dom.nodeText(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},Dom.getAssoc=function(e,t){return e["_magicdom_"+t]},Dom.setAssoc=function(e,t,n){e["_magicdom_"+t]=n},Dom.contains=function(e,t){return!!t&&(!e.contains||(t&&3===t.nodeType&&Ce.modernIE&&11===parseInt(Ce.version)?e.contains(t.parentNode):e.contains(t)))},Dom.nodeMaxIndex=function(e){return Dom.isNodeText(e)?e.nodeValue.length:1},Dom.topLevel=function(e,t){if(!e||e===t)return null;for(;e&&e.parentNode!==t;)e=e.parentNode;return e},Dom}(),pd={collectionHeader:{zoneExtractionFn:function(e){return Object(s.a)(e.innerZones)},zoneTypes:{chmessage:{features:["bulleted","numbered","placeholder"],placeholder:"collectionMessage"},chtitle:{features:["plaintext","placeholder"],placeholder:"chtitle"}}},collectionBoard:{zoneExtractionFn:function(e){return Object(l.a)(Object(K.default)(e.itemsData,function(e){return Object(s.a)(e.innerZones)}))},zoneTypes:{bcaption:{features:["placeholder"],placeholder:"DDDDDDDDD.caption"},bcustomtitle:{className:"collection-embed-title",features:["plaintext","no-indent"]}}}};function gd(e){return"a fucking place holder"}var vd=Object.keys(pd),md=Object(l.a)(Object(K.default)(Object(s.a)(pd),"zoneTypes").map(function(e){return Object.keys(e)}));if(Object(I.a)(md).length!==md.length)throw new Error("Zone types need to be globally unique");var yd=function(){var t,e,n={},r=function(t){Object.keys(pd[t].zoneTypes).forEach(function(e){n[e]=t})};try{for(var i=ge(Object.keys(pd)),o=i.next();!o.done;o=i.next())r(o.value)}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return n}();function bd(e,t){return!!pd[e]||t.isEnabled&&t.hasDefinedZoneTypes(e)}function Ed(e,t,n){if(!bd(t,n))return[];if(n.isEnabled&&n.hasContentType(t)){var r=new(n.getClassById(t))(e);return n.getZoneIds(r)}return pd[t].zoneExtractionFn(e)}function kd(e,t){var n=e.magicObject;if(!bd(n,t))return[];if(t.isEnabled&&t.hasContentType(n)){var r=t.createFromAttributes(e);return t.getZoneIds(r)}return Ed(Ka(n,e,{},t),n,t)}function Cd(e){if(ru(e))return"aceTableCell";var t=e.match(/[a-zA-Z]+/);return t?t[0]:null}function Id(e){var t=Cd(e);return{lineManagerType:yd[t],zoneType:t}}function Sd(e){var t=Id(e),n=t.lineManagerType,r=t.zoneType;return n&&pd[n].zoneTypes[r].className||""}function Td(e,t){var n=Id(e),r=n.lineManagerType,i=n.zoneType;return-1===("aceTableCell"===i&&["placeholder","plaintext"].indexOf(t))||!!r&&-1!==pd[r].zoneTypes[i].features.indexOf(t)}function Od(e){return e+Ua()}var wd=Object.freeze({__proto__:null,getZonePlaceholder:gd,ineManagerTypesWithZones:vd,allZoneTypes:md,lineManagerTypeCanHaveZones:bd,getZonesReferencedByLineManagerData:Ed,getZonesReferencedByAttributes:kd,getZoneType:Cd,getZoneAndLineManagerTypes:Id,getNonRootZoneClassName:Sd,doesNonRootZoneHaveFeature:Td,createZoneId:Od}),Rd=(Ad.prototype.destroy=function(){this.contentTypeRegistry=null,this.zoneToLineEntry={},this.zoneWithMatchAttr.clear(),this.currentInlineSelectedLineManager=null,this.currentlySelectedLineManagers=[]},Ad.prototype.dispose=function(){this.getAllLineManagers().forEach(function(e){if(e)try{this.editorInfo.log("should unmount react component")}catch(e){console.error(e)}})},Ad.prototype.registerZoneForLine=function(e,t){this.zoneToLineEntry[e]=t},Ad.prototype.unregisterZoneForLine=function(e,t){this.zoneToLineEntry[e]===t&&delete this.zoneToLineEntry[e]},Ad.prototype.getCurrentlySelectedLineManagers=function(){return this.currentlySelectedLineManagers.slice(0)},Ad.prototype.hasCurrentlySelectedLineManagers=function(){return!!this.currentlySelectedLineManagers.length},Ad.prototype.unregisterZone=function(e){delete this.zoneToLineEntry[e]},Ad.prototype.isZoneRegistered=function(e){return e in this.zoneToLineEntry},Ad.prototype.getRegisteredZones=function(e){return Object.keys(this.zoneToLineEntry)},Ad.prototype.getLineManager=function(e,t,n){if(!e)throw new Error("getLineManager got bad zoneId");var r=this.reps[e].lines.atIndex(t),i=r.domInfo;return!i||!i.lineManagerType||n&&i.lineManagerType!==n?null:this.lineManagerForLine(r)},Ad.prototype.lineManagerForLine=function(e,t){return!e||!e.domInfo||t&&t!==e.domInfo.lineManagerType?null:e.domInfo.node.lineManager},Ad.prototype.getAllLineManagers=function(r){var t,e,i=this,o=[];try{for(var n=ge(Object.keys(this.reps)),a=n.next();!a.done;a=n.next()){var s=a.value;this.reps[s].lines.forEach(function(e){var t,n=e.domInfo;!n||!n.lineManagerType||r&&r!==n.lineManagerType||(t=i.lineManagerForLine(e))&&o.push(t)})}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return o},Ad.prototype.preloadLineManager=function(e,t){this.getLineManager(e,t)},Ad.prototype.getLineManagerType=function(e,t){if(!e)throw new Error("getLineManager got bad zoneId");var n=this.reps[e].lines.atIndex(t);if(!n)return null;var r=n.domInfo;return r&&r.lineManagerType?r.lineManagerType:null},Ad.prototype.getLineManagerTypeContainingZone=function(e){var t=this.getLineEntryContainingZone(e);if(!t)return null;var n=t.domInfo;return n&&n.lineManagerType?n.lineManagerType:null},Ad.prototype.getLineEntryContainingZone=function(e){return e in this.zoneToLineEntry?this.zoneToLineEntry[e]:null},Ad.prototype.getLineManagerWithSpecialSelection=function(e){var t=this.editorInfo.getRep(),n=t.selStart,r=t.selEnd,i=t.zoneId;if(!n||!r||!i||i===Vo.ROOT_ZONE)return null;var o=this.getLineManagerForNonRootZoneId(i,e);return o&&o.hasSelectedZonesForSpecialSelection()?o:null},Ad.prototype.getChildZonesOfLineManager=function(e){var t=this.editorInfo.changesetHelper;if(e.getInstanceByName("ACE_TABLE")){var n=e.domInfo.lineManagerData,r=[n.rowsZoneId,n.colsZoneId],i=this.editorInfo.getVectorsRep(n.rowsZoneId,!0),o=this.editorInfo.getVectorsRep(n.colsZoneId,!1);return i.vectorIds.forEach(function(t){o.vectorIds.forEach(function(e){r.push(eu(t,e))})}),r}return bd(e.domInfo.lineManagerType,this.contentTypeRegistry)?kd(t.attribsToDict(e.domInfo.aline,e.domInfo.apool),this.contentTypeRegistry):[]},Ad.prototype.getAllChildZones=function(){var e=this.editorInfo.getRep("0"),t=e.lines.length()-1,n=e.lines.atIndex(t).width,r=new Vo("0",0,0),i=new Vo("0",t,n);return this.getChildZonesInRangeRecursive(r,i)},Ad.prototype.getChildZonesInRange=function(e,t){var n={text:[],rows:[],cols:[]};return this._getChildZonesInRange(e,t,n),n},Ad.prototype.getChildZonesInRangeRecursive=function(e,t){var n={text:[],rows:[],cols:[]};this._getChildZonesInRange(e,t,n);for(var r=0;r<n.text.length;){var i=n.text[r];this._getChildZonesInRange(new Vo(i,0,0),Vo.endOfZone(this.editorInfo,i),n),r++}return n},Ad.prototype._getChildZonesInRange=function(e,t,s){for(var l=this,n=e.zone,c=this.reps[n].alines,r=0===e.col?e.line:e.line+1,i=0===t.col?t.line:t.line+1,u=this.editorInfo.getRepManager().apool,d=this.editorInfo.changesetHelper,o=function(e){var t,n,r,i,o,a=ls(c[e],u,f.contentTypeRegistry);a&&("aceTable"===(t=a.key)?(r=(n=a.value.split(" "))[0],i=n[1],s.rows.push(r),s.cols.push(i),f.editorInfo.getVectorsRep(r,!0).vectorIds.forEach(function(n){l.editorInfo.getVectorsRep(i,!1).vectorIds.forEach(function(e){var t=eu(n,e);l.editorInfo.getRep(t)&&s.text.push(t)})})):"newZone"===t?(o=a.value,s.text.push(o)):bd(t,f.contentTypeRegistry)&&kd(d.attribsToDict(c[e],u),f.contentTypeRegistry).forEach(function(e){l.editorInfo.getRepManager().reps[e]&&s.text.push(e)}))},f=this,a=r;a<i;a++)o(a)},Ad.prototype.getChildZonesAtLine=function(e,t){var n=new Vo(e,t,0),r=new Vo(e,t+1,0);return this.getChildZonesInRange(n,r)},Ad.prototype.getLineManagerForNonRootZoneId=function(e,t){var n=this.getLineEntryContainingZone(e);return this.lineManagerForLine(n,t)},Ad.prototype.getRowsZoneIdForCellId=function(e){var t=this.getLineEntryContainingZone(e);return t&&t.domInfo&&t.domInfo.lineManagerData?t.domInfo.lineManagerData.rowsZoneId:null},Ad.prototype.setInlineSelectedLineManager=function(e){this.currentInlineSelectedLineManager!==e&&this.currentInlineSelectedLineManager&&this.currentInlineSelectedLineManager.unselectAll&&this.currentInlineSelectedLineManager.unselectAll(),this.currentInlineSelectedLineManager=e},Ad.prototype.changeSelectionOnLineManagersInRange=function(e,t){var n,r=this,i=e&&e.zone,o=t&&t.zone,a=[];if(this.currentlySelectedLineManagers=[],i!==Vo.ROOT_ZONE&&(n=this.getLineEntryContainingZone(i))&&a.push(n),o!==Vo.ROOT_ZONE){var s=this.getLineEntryContainingZone(o);if(!n||!s||n.key===s.key)return;s&&a.push(s)}i===Vo.ROOT_ZONE&&o===Vo.ROOT_ZONE&&this.getChildZonesInRange(e,t).rows.forEach(function(e){var t=r.getLineEntryContainingZone(e);t&&a.push(t)}),a.forEach(function(e){var t=r.lineManagerForLine(e);r.currentlySelectedLineManagers.push(t)})},Ad.prototype.positionOfLineManagerContainingZone=function(e){if(e===Vo.ROOT_ZONE)throw new Error("Cannot get parent of position in root zone");var t=this.getLineEntryContainingZone(e);if(!t)throw new Error("Line entry of zone "+e+" doesn't exist");var n=this.editorInfo.dom.zoneOfTopLevelNode(t.domInfo.node),r=this.editorInfo.getReps()[n].lines.indexOfKey(t.key);return new Vo(n,r,0)},Ad.prototype.registerZoneWithMatchAttr=function(e,n,r){var t="k="+n+"-v="+r,i=function(e,t){return e===n&&t===r};this.zoneWithMatchAttr.set(t,{zoneIds:e,lineMatcher:i})},Ad.prototype.unregisterZoneWithMatchAttr=function(r){this.zoneWithMatchAttr.forEach(function(e){var t=e.zoneIds,n=t.indexOf(r);-1<n&&delete t[n]})},Ad.prototype.getRegisteredZonesWithMatchAttr=function(e,t){var n="k="+e+"-v="+t;return this.zoneWithMatchAttr.get(n)},Ad.prototype.getLineNoContainingZone=function(r){var i;this.zoneWithMatchAttr.forEach(function(e){var t=e.zoneIds,n=e.lineMatcher;-1<t.indexOf(r)&&(i=n)});var e=this.editorInfo.getMatchedAttributePositionOnSelection(null,i);return e&&e.length?e.pop().docPosition.selStart[0]:-1},Ad.prototype.getAncestorZones=function(e){for(var t,n,r=[],i=null===(t=this.zoneToLineEntry[e])||void 0===t?void 0:t.zone;i;)r.push(i),i=null===(n=this.zoneToLineEntry[i])||void 0===n?void 0:n.zone;return r},Ad.prototype.getClosestCommonAncestorZone=function(e,t){var n=me([e],this.getAncestorZones(e)),r=me([t],this.getAncestorZones(t));return Object(a.a)(n,r)[0]},Ad);function Ad(e,t){this.editorInfo=e,this.contentTypeRegistry=t,this.zoneToLineEntry={},this.zoneWithMatchAttr=new Map,this.currentInlineSelectedLineManager=null,this.currentlySelectedLineManagers=[],this.editorInfo=e,this.reps=e.getRepManager().reps}var xd={};function Md(e,t){window.lark.biz.clipboard.setContent({text:e,html:t})}function Nd(e,t){var n=ve(e.selStart,2),r=n[0],i=n[1],o=ve(e.selEnd,2),a=o[0],s=o[1],l=ve(t.selStart,2),c=l[0],u=l[1],d=ve(t.selEnd,2),f=d[0],h=d[1];return!(a<c||a===c&&s<=u||f<r||f===r&&h<=i)}function _d(i,t,e){var n=i.selStart,r=i.selEnd;if(!n||!r)return[];for(var o=[],a=n[0];a<=r[0];a++){var s=i.lines.atIndex(a);if(!s||!s.lineNode)break;var l=s.lineNode,c=he()(l).hasClass(e)?he()(l):he()(l).find("."+e);o.push.apply(o,me(Array.from(c).map(function(e){return t(e)}).filter(function(e){return e})))}var u=[],d=n,f=function(e){var t=ve(e,2),n=t[0],r=t[1];return i.lines.atIndex(n).text.length===r?[n+1,0]:[n,r]};o.filter(function(e){return Nd(e,{selStart:n,selEnd:r})}).forEach(function(e){var t=ve(e.selStart,2),n=t[0],r=t[1],i=e.selEnd;d[0]<n||d[0]===n&&d[1]<r?(u.push({selStart:d,selEnd:[n,r]}),d=f(i)):d[0]===n&&d[1]===r&&(d=f(i))});var h=ve(r,2),p=h[0],g=h[1];return(d[0]<p||d[0]===p&&d[1]<g)&&u.push({selStart:d,selEnd:r}),u}xd.setData=function(e,t){var n=t.text,r=t.html;(n||r)&&(Ce.modernIE?e.setData("text",r):Ce.isIOSBelow12()||Ce.isBytedanceApp&&Ce.isIPad?Md(n,r):(e.setData("text/html",r),e.setData("text/plain",n)))},xd.getData=function(e,t){return void 0===t&&(t="text/html"),Ce.modernIE?e.getData("text"):e.getData(t)},xd.setDataWithoutEvent=function(i){function o(e){e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation();var t=i.html,n=i.text;document.createElement("div").innerHTML=t;var r=e.clipboardData||window.clipboardData;Ce.modernIE?r.setData("text",t):(r.setData("text/html",t),r.setData("text/plain",n)),i.customCopyDatas&&xd.setCustomData(r,i.customCopyDatas),document.removeEventListener("copy",o)}var e=document.createElement("textarea");document.body.appendChild(e),document.addEventListener("copy",o),e.style.opacity="0",e.value=" ",Ce.isMobile&&(e.readOnly=!0);var t=window.scrollX,n=window.scrollY;e.focus({preventScroll:!0}),e.select(),Ce.isAndroid&&window.scrollTo(t,n),Ce.isLark&&Ce.isIOS?window.lark.biz.navigation.handleCopyMenuClick():document.execCommand("copy"),document.body.removeChild(e)},xd.setCustomData=function(t,e){t&&t.setData&&e.forEach(function(e){t.setData(e.key,e.data)})};var Ld=Object.freeze({__proto__:null,splitSelectionWithClassName:_d});function Dd(e,t,n,r){var i=e.lines.offsetOfIndex(n[0]),o=e.lines.offsetOfIndex(r[0]);r[0]>n[0]?(t.remove(o-i-n[1],r[0]-n[0]),t.remove(r[1])):t.remove(r[1]-n[1])}function Bd(e,t,n,r,i,o){var a=e.lines.offsetOfIndex(n[0]),s=e.lines.offsetOfIndex(r[0]);r[0]>n[0]?(t.keep(s-a-n[1],r[0]-n[0],i,o),t.keep(r[1],0,i,o)):t.keep(r[1]-n[1],0,i,o)}function Pd(e,t,n){var r=e.lines.offsetOfIndex(n[0]);t.keep(r,n[0]),t.keep(n[1])}function Fd(e,t){var n,r=Object(F.builder)(e.lines.totalWidth()),i=e.lines.indexOfOffset(t.selStartChar),o=e.lines.indexOfOffset(t.selEndChar),a=[i,0],s=[o,0];return o===e.lines.length()&&(a[0]=a[0]-1,n=e.lines.atIndex(a[0]),a[1]=n.width-1,s=[--o,e.lines.atIndex(o).width-1]),Bd(e,r,[0,0],a),Dd(e,r,a,s),r.toString()}function jd(e,t,n,r){var i=e.lines.atIndex(t),o=e.repManager.apool,a=Object(F.builder)(e.lines.totalWidth());return Bd(e,a,[0,0],[t,i.width-1]),a.insert("\n",[],o),a.insert("*",me(r,[["insertorder","first"],["lmkr","1"]]),o),a.insert(n),a.toString()}function zd(e,t,n){var r=Object(F.builder)(e.lines.totalWidth()),i=e.lines.atIndex(n);if(!i)return"";var o=[n,0],a=[n,i.width-1],s=e.repManager.apool;Bd(e,r,[0,0],o),Dd(e,r,o,a);for(var l=Object(F.smartOpAssembler)(),c=Object(F.unpack)(r.toString())[e.zoneId],u=Object(F.opIterator)(c.ops);u.hasNext();){var d=u.next();l.append(ue({},d))}var f=t.alines[0],h=Wd(f,Vd(f,t.repManager.apool,s));Object(F.appendATextToAssembler)({text:t.alltext.slice(0,-1),attribs:h},l);var p=t.lines.atIndex(0).width-e.lines.atIndex(n).width+e.alltext.length;return Object(F.pack)(e.alltext.length,p,l.toString(),t.alltext.slice(0,-1))}function Hd(e,t,n){var r=e.lines.atIndex(n),i=e.repManager.apool,o=Object(F.builder)(e.lines.totalWidth());Bd(e,o,[0,0],[n,r.width-1]),o.insert("\n",[],i);for(var a=Object(F.unpack)(o.toString())[e.zoneId],s=Object(F.smartOpAssembler)(),l=Object(F.opIterator)(a.ops);l.hasNext();){var c=l.next();s.append(ue({},c))}var u=t.length;t.forEach(function(e,t){var n;Object(F.appendATextToAssembler)({text:e.text.slice(0,-1),attribs:e.attribs},s),t<u-1&&(n=Ud(),s.append(n))});var d=e.alltext.length,f=t.map(function(e){return e.text}).join(""),h=d+f.length;return Object(F.pack)(e.alltext.length,h,s.toString(),"\n"+f.slice(0,-1))}function Ud(){var e=Object(F.newOp)("+");return e.chars=1,e.lines=1,e.attribs="",e}function Vd(e,o,a){for(var t=Object(F.opIterator)(e),s={};t.hasNext();){var n=t.next();Object(F.eachAttribNumber)(n.attribs,function(e){var t=ve(o.numToAttrib[e],2),n=t[0],r=t[1],i=a.attribToNum[n+","+r];void 0===i&&(i=a.putAttrib([n,r])),s[e]=i})}return s}function Wd(e,r){for(var i=Object(F.smartOpAssembler)(),o=Object(F.opIterator)(e),t=function(){var e=o.next(),t=Je(e),n="";Object(F.eachAttribNumber)(e.attribs,function(e){void 0!==r[e]?n+="*"+Object(F.numToString)(r[e]):n+="*"+Object(F.numToString)(e)}),t.attribs=n,i.append(ue({},t))};o.hasNext();)t();return i.toString()}function Kd(e,t,n){for(var r=Object(F.opIterator)(t),i=e.numToAttrib,o=[];r.hasNext();){var a=r.next();if(Object(F.eachAttribNumber)(a.attribs,function(e){i[e][0]===n&&(o=[e,i[e][1]])}),o.length)return o}return o}var Zd,Gd,qd,Jd,Yd=Object.freeze({__proto__:null,buildRemoveRange:Dd,buildKeepRange:Bd,buildKeepToStartOfRange:Pd,removeLines:Fd,insertLine:jd,replaceLine:zd,insertAlinesToChangeset:Hd,generateChangeAttribKeysFromAline:Vd,replaceAttribs:Wd,getAttributeOnAline:Kd}),Qd=Yd,Xd=[{attr:"mention-type_0",value:"true"},{attr:"mention-type_1",value:"true"},{attr:"mention-type_3",value:"true"},{attr:"mention-type_8",value:"true"}];function $d(o,a,s,l,c,e,t){var n=s.alines,r=s.alltext,u=s.apool,i=s.lines,d=rf(r),f=[],h=o.isEditable(),p=[];if(c=c||af(l,{matchCase:e,matchRegex:t})){for(var g=s.attributeManager.getAttributesPoints(Xd),v=0,m=i.length();v<m;v++){for(var y=n[v],b=d[v],E=Object(F.opIterator)(y),k=[],C="",I=0,S=function(){var r,i,e,t=E.next(),n=b.substring(I,I+t.chars);I+=t.chars,"*"===n.charAt(0)||" "===n.charAt(0)?(r={},i=[],Object(F.eachAttribNumber)(t.attribs,function(e){var t=u.getAttribKey(e),n=u.getAttribValue(e);i.push(t+","+n),n&&(r[t]=n)}),r.lmkr?k.push({offset:I-t.chars,length:-1}):(e={attribs:t.attribs,attributeMap:r,attributeList:i,text:n,searchStringList:[],searchKey:l,matcher:c,zoneId:a,selStart:[v,I-t.chars],selEnd:[v,I]},o.hooks.callAll("searchStringRange",e),Object(T.default)(e.isSearchable)?C+=n:(C&&f.push({finalText:C,mods:k,row:v}),p=p.concat(ef(s,a,f,c,h,g)),e.searchStringList.length&&(p=p.concat(e.searchStringList)),k.length=0,k.push({offset:I-t.chars,length:-1}),C=""))):C+=n};E.hasNext();)S();f.push({finalText:C,mods:k,row:v})}return f.length&&(p=p.concat(ef(s,a,f,c,h,g))),p}}function ef(e,t,n,r,i,o){var a="";n.forEach(function(e){a+=e.finalText});var s=tf(e,t,n,r,a,i,o);return n.length=0,s}function tf(e,l,c,u,d,f,h){for(var p=[],g=u.exec(d),t=function(){if(!g[0].length)return"break";for(var e=0,t=0;c[e].finalText.length+t<=g.index;)t+=c[e].finalText.length,e++;for(var n=e,r=g.index-t,i=r+g[0].length;c[n].finalText.length<i;)i-=c[n].finalText.length,n++;c[e].mods.forEach(function(e){var t=e.offset,n=e.length;r+=t-n}),c[n].mods.forEach(function(e){var t=e.offset,n=e.length;i+=t-n});var o=f,a=[c[e].row,r],s=[c[n].row,i];h.forEach(function(e){Nd({selStart:a,selEnd:s},e)&&(o=!1)}),p.push({zoneId:l,selStart:a,selEnd:s,isReplaceable:o}),g=u.exec(d)};null!==g;)if("break"===t())break;return p}function nf(d,e,f){var o,t,h,r,p=d.repManager,n=d.performDocumentApplyChangeset,i=d.callStack,a=d.getCurrentCallStack,s=d.fastIncorp,l=d.updateLineGuid,c=d.isRepInOfLine,u=(0,d.getRep)();function g(e){var t=e.zoneId,n=e.lines,r=o.get(t);if(r)return r;var i={loc:[0,0],builder:Object(F.builder)(n.totalWidth(),"Z",t)};return o.set(t,i),i}Array.isArray(e)&&e.length&&(o=new Map,t=c(u.selStart,u.selEnd,u),h=!1,e.forEach(function(e){var t,n,r,i,o=e.zoneId,a=e.selStart,s=e.selEnd,l=e.context,c=e.attributes,u=void 0===c?[]:c;e.isReplaceable&&(l?d.hooks.callAll("replaceSearchString",e):(r=(n=g(t=p.reps[o])).builder,i=n.loc,Qd.buildKeepRange(t,r,i,a),Qd.buildRemoveRange(t,r,a,s),r.insert(f,u,t.apool),i[0]=s[0],i[1]=s[1],h=h||-1<f.indexOf("\n")))}),r={},o.forEach(function(e,t){var n=e.builder;r[t]=n.toString()}),i.inCallStackIfNecessary("replaceSearchString",function(){a().preventScrolling=!0,s(),n(Object(F.formatCsFromObj)(r))}),h&&t&&u.selStart&&l(u.selStart[0]))}function rf(e){return e.split("\n").map(function(e){return e+"\n"})}function of(e){return e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function af(e,t){if(e&&e.length)try{return t.matchRegex?sf(e,t.matchCase?"g":"ig"):sf(of(e),t.matchCase?"g":"ig")}catch(e){if(!(e instanceof SyntaxError))throw e}}function sf(e,t){return new RegExp(e,t)}(Gd=Zd=Zd||{}).BLOCK="BLOCK",Gd.INLINE="INLINE",(Jd=qd=qd||{}).Object="Object",Jd.String="String",Jd.Boolean="Boolean",Jd.Array="Array",Jd.Number="Number";var lf=(cf.collect=function(e,t){return{attributes:[]}},cf.isFormatAcceptable=function(e,t){return!0},cf.getCssStyle=function(e){return null},cf.FormatType=Zd,cf.FormatValueType=qd,cf);function cf(){}function uf(e){var t="",n="";return e&&e.filter(function(e){return e}).forEach(function(e){t+="<"+e+">",n="</"+e+">"+n}),[t,n]}function df(e,t){return e&&t?e+" "+t:e||t||""}var ff=["br","hr","col","img","wbr","area","base","link","meta","track","param","embed","input","keygen","source"];function hf(d,f){void 0===f&&(f=0);var h="",p="",g="",v="",m="";return d&&d.forEach(function(e,t){var n,r,i,o,a=e.tagName,s=e.domAttributes,l=e.childNodes,c=e.className,u=e.style;if(f&&!a)return console.warn("Child node must have a tagName!");a?(r=(n=ve(pf(a,c,u,s),2))[0],i=n[1],v+=r,m+=i):(h+=gf(c),p+=gf(u,";"),g+=gf(s)),l&&(o=hf(l,f+1),v+=o.openTags,m+=o.closeTags,h+=o.wrapperClass,p+=o.wrapperStyle,g+=o.wrapperAttributes),t!==d.length-1&&(v+=m,m="")}),{openTags:v,closeTags:m,wrapperClass:h,wrapperStyle:p,wrapperAttributes:g}}function pf(e,t,n,r){e=String(e).replace(/[^\w-]/g,"");var i=t?'class="'+gf(t).replace(/"/g,"&quot;")+'"':"",o=n?'style="'+gf(n,";").replace(/"/g,"&quot;")+'"':"",a=gf(r),s=ff.includes(e);return["<"+e+" "+a+" "+o+" "+i+" "+(s?"/":"")+">",s?"":"</"+e+">"]}function gf(e,t){return void 0===t&&(t=" "),e?e.join(t)+t:""}var vf=(mf.prototype.callCollectHook=function(e,o,t){var n,r,i,a,s=[];try{for(var l=ge(this.formatters),c=l.next();!c.done;c=l.next()){var u=c.value,d=this.getConstructorAsType(u,lf),f=d.collect(e,{flags:o.flags}).attributes;try{for(var h=(i=void 0,ge(f)),p=h.next();!p.done;p=h.next()){var g=ve(p.value,2),v=g[0],m=g[1];d.formatType===Zd.INLINE?t.doAttrib(o,v,m):(o.lineAttributes[v]=m,s.push(v))}}catch(e){i={error:e}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return function(){var t,e;try{for(var n=ge(s),r=n.next();!r.done;r=n.next()){var i=r.value;delete o.lineAttributes[i]}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}}},mf.prototype.createRenderData=function(a){var s=this;this.resetNxtAttribute();var e,t=[];for(e in a)a.hasOwnProperty(e)&&this.formatterMap[e]&&t.push(ue({value:a[e]},this.formatterMap[e]));t.sort(function(e,t){return e.index-t.index}).forEach(function(e){var t,n=e.plugin,r=e.value,i=s.getConstructorAsType(n,lf),o=s.convertValue(i.formatValueType,r,!1);n&&s.isFormatterConstructor(i)?(s.nxtFormatAttribute.formatClass+=i.setClass(o).join(" "),s.nxtFormatAttribute.formatClass=s.nxtFormatAttribute.formatClass&&s.nxtFormatAttribute.formatClass+" ",s.nxtFormatAttribute.formatStyle+=i.setStyle(o).join("; "),s.nxtFormatAttribute.formatStyle=s.nxtFormatAttribute.formatStyle&&s.nxtFormatAttribute.formatStyle+"; ",(t=s.nxtFormatAttribute.formatTags).push.apply(t,me(i.setTags(o)))):n&&s.isTreeFormatterConstructor(i)?s.nxtFormatAttribute.formatNodes.push(i.setValue(o,a)):n&&s.isEmbedFormatterConstructor(i)&&(s.nxtFormatAttribute.formatNodes.push(i.setValue(o,a)),s.nxtFormatAttribute.formatLineClass=i.setLineClass(o)),!s.nxtFormatAttribute.isEmbed&&s.isEmbedFormatterConstructor(i)&&(s.nxtFormatAttribute.isEmbed=!0),s.nxtFormatAttribute.formatType!==Zd.BLOCK&&(s.nxtFormatAttribute.formatType=i.formatType)})},mf.prototype.createFormatterDomLine=function(e){var t,n=this.getFinalAttribute(),r=n.finalOpenTags,i=n.finalCloseTags,o=n.finalFormatClass,a=n.finalFormatStyle,s=(this.currentIsBlock(),this.currentIsEmbed());s?(e.text="",t=this.curFormatAttribute.formatLineClass,Object(c.a)(t)&&t.length&&(e.lineClass+=" "+t.join(" "))):o.length&&(e.spanClass+=" "+o),e.extraOpenTags+=r,e.extraCloseTags+=i,e.formatStyle=a,e.isSplit||this.resetCurAttribute()},mf.prototype.processLineAttributes=function(e){var t=this.getFinalAttribute(),n=t.finalOpenTags,r=t.finalCloseTags,i=t.finalFormatClass,o=this.currentIsBlock(),a=this.currentIsEmbed();o&&!a&&(e.preHtml+=n,e.postHtml+=r,e.lineClass+=" "+i)},mf.prototype.setCurrentAttribute=function(){this.curFormatAttribute=this.nxtFormatAttribute},mf.prototype.isSameAttribute=function(){return this.curFormatAttribute.formatClass===this.nxtFormatAttribute.formatClass&&this.curFormatAttribute.formatStyle===this.nxtFormatAttribute.formatStyle&&this.curFormatAttribute.formatType===this.nxtFormatAttribute.formatType&&this.curFormatAttribute.formatTags.toString()===this.nxtFormatAttribute.formatTags.toString()&&Object(N.default)(this.curFormatAttribute.formatNodes,this.nxtFormatAttribute.formatNodes)},mf.prototype.currentIsBlock=function(){return this.curFormatAttribute.formatType===Zd.BLOCK},mf.prototype.currentIsEmbed=function(){return this.curFormatAttribute.isEmbed},mf.prototype.resetNxtAttribute=function(){this.nxtFormatAttribute={formatType:null,formatClass:"",formatStyle:"",formatTags:[],formatNodes:[],formatLineClass:[],isEmbed:!1}},mf.prototype.resetCurAttribute=function(){this.curFormatAttribute={formatType:null,formatClass:"",formatStyle:"",formatTags:[],formatNodes:[],formatLineClass:[],isEmbed:!1}},mf.prototype.convertValue=function(e,t,n){if(void 0===n&&(n=!0),void 0===t)return t;try{switch(e){case qd.Array:case qd.Object:if(n&&(Object(c.a)(t)||Object(i.a)(t)))return JSON.stringify(t);if(!n&&Object(O.a)(t))return JSON.parse(t);break;case qd.Boolean:return(n&&Object(o.a)(t)?String:Boolean)(t);case qd.Number:return(n&&Object(d.default)(t)?String:Number)(t);case qd.String:return String(t);default:return t}}catch(e){console.warn("Convert value error: "+e)}return t},mf.prototype.isFormatterConstructor=function(e){return"isFormatter"in e},mf.prototype.isTreeFormatterConstructor=function(e){return"isTreeFormatter"in e},mf.prototype.isEmbedFormatterConstructor=function(e){return"isEmbedFormatter"in e},mf.prototype.getConstructorAsType=function(e,t){return e.constructor},mf.prototype.addFormatter=function(e,t){var n=this.getConstructorAsType(e,lf),r=n.formatKey,i=n.formatType;r||console.warn("A Formatter Constructor must have a formatKey! ",e),Zd.BLOCK!==i&&Zd.INLINE!==i&&console.warn('FormatType must be "BLOCK" or "INLINE"! ',e),this.formatters.push(e),this.formatterMap[r]={plugin:e,index:t}},mf.prototype.getFinalAttribute=function(){var e=ve(uf(this.curFormatAttribute.formatTags),2),t=e[0],n=e[1],r=hf(this.curFormatAttribute.formatNodes);return{finalFormatStyle:df(this.curFormatAttribute.formatStyle,r.wrapperStyle),finalFormatClass:df(this.curFormatAttribute.formatClass,r.wrapperClass),finalOpenTags:df(t,r.openTags),finalCloseTags:df(n,r.closeTags)}},mf);function mf(e){this.formatterMap={},this.formatters=[],this.nxtFormatAttribute={formatType:null,formatClass:"",formatStyle:"",formatTags:[],formatNodes:[],formatLineClass:[],isEmbed:!1},this.curFormatAttribute={formatType:null,formatClass:"",formatStyle:"",formatTags:[],formatNodes:[],formatLineClass:[],isEmbed:!1};for(var t=e.formatters,n=0,r=t.length;n<r;n++){var i=t[n];i.constructor.formatKey&&this.addFormatter(i,n)}}function yf(e,t){var n=t||e,r=n.selStart,i=n.selEnd;if(!r||!i)return"\n \n";var o=e.lines.atIndex(i[0]);if(!o)return"\n \n";var a=o.text,s=o.lineMarker,l=(a||"").length,c=e.lines.length(),u=i[1]<l,d=" ";0===r[0]&&(d="\n"+d),r[1]>s&&(d="\n "),!u&&i[0]+1!==c||(d+="\n");var f=o.lineNode;return-1<(f&&f.className||"").indexOf("tp-sub")&&(d="\n \n"),d}var bf,Ef=(ce(kf,bf=lf),kf.setValue=function(e,t){return{}},kf.setLineClass=function(e){return[]},kf.prototype.formatAttributes=function(e,t,n){return[]},kf.prototype.getFormatAttributes=function(e){return e},kf.isEmbedFormatter=!0,kf.isInsertNewLine=!1,kf);function kf(){return null!==bf&&bf.apply(this,arguments)||this}var Cf,If=(ce(Sf,Cf=vf),Sf.prototype.getFormatterList=function(){return this.formatters},Sf.prototype.isFormatterToggleable=function(e){return!!this.formatterMap[e]&&this.getConstructorAsType(this.formatterMap[e].plugin,lf).toggleable},Sf.prototype.addCaretAttribs=function(e,t,n){var r=n.selStart,i=n.selEnd,o=n.zoneId+":"+r+":"+i;(this.caretFormatAttribs[o]=this.caretFormatAttribs[o]||{})[e]=String(t||"")},Sf.prototype.getCaretAttribs=function(e){var t=e.selStart,n=e.selEnd,r=e.zoneId+":"+t+":"+n;return Object.entries(this.caretFormatAttribs[r]||{})},Sf.prototype.resetCaretAttribs=function(){this.caretFormatAttribs={}},Sf.prototype.formatInline=function(n,r,i,o){var a=this,s=this.editor.getRep(r.zoneId);this.editor.inCallStackIfNecessary("formatInlineAttributesOnRange",function(){var e,t;a.isTreeFormatterConstructor(a.getConstructorAsType(n,lf))?o.forEach(function(e){var t=e.selStart,n=e.selEnd,r=e.attribs;s.attributeManager.setAttributesOnRange(t,n,a.convertAttribs(r))}):(e=r.selStart,t=r.selEnd,s.attributeManager.setAttributesOnRange(e,t,a.convertAttribs(i)))},{shouldIncorp:!0})},Sf.prototype.executeCommand=function(e,t){document.execCommand("styleWithCSS"),document.queryCommandState(e)!==Boolean(t)&&document.execCommand(e,!1,t)},Sf.prototype.formatBlock=function(l,c,u,d){var f=this,h=this.editor.getRep(c.zoneId);this.editor.inCallStackIfNecessary("formatBlockAttributesOnRange",function(){var e=c.selStart,t=c.selEnd,n=Object(M.a)(e[0],t[0]+1),r=ve(u[0],2),i=r[0],o=r[1],a=f.getConstructorAsType(l,lf),s=a.formatValueType;o&&!f.isTreeFormatterConstructor(a)?h.attributeManager.setAttributeOnMultiLines(n,i,f.convertValue(s,o)):f.isTreeFormatterConstructor(a)?d.forEach(function(e){var o=e.lineNum;e.attribs.forEach(function(e){var t,n=ve(e,2),r=n[0],i=n[1];i?(t=r===a.formatKey?f.convertValue(s,i):i,h.attributeManager.setAttributeOnLine(o,r,t)):h.attributeManager.removeAttributeOnLine(o,r,i)})}):h.attributeManager.removeAttributeOnMultiLines(n,i,f.convertValue(s,o))},{shouldIncorp:!0})},Sf.prototype.formatEmbed=function(e,o,a,t){var s=this,l=this.editor.getRep(o.zoneId),c=l.lines,u=l.zoneId,d=o.selStart,f=o.selEnd,n=this.getConstructorAsType(e,Ef),h=n.formatKey,p=n.isInsertNewLine,g=t||n.formatType;this.editor.inCallStackIfNecessary("formatEmbedAttributesOnRange",function(){var e,t,n,r,i=Mr(h,a);i&&i[1]?(e=" ",g===Zd.BLOCK&&(e=yf(l,o),(t=d[0])&&((r=(n=c.atIndex(t).lineNode)?n.className:null)&&-1<r.indexOf("list")&&(e="\n"+e),e&&p&&"\n"!==e[e.length-1]&&(e+="\n"))),s.editor.performDocumentReplaceRangeWithAttributes(u,d,f,Ln(e),s.convertAttribs(a))):i&&l.attributeManager.getAttributesAndPoints([[h,""]],d[0],f[0]).forEach(function(e){var t,n,r,i,o=e.selStart,a=e.selEnd;Nd({selStart:o,selEnd:a},{selStart:d,selEnd:f})&&(g===Zd.BLOCK?(t=o[0],n=l.lines.atIndex(t),r=0<=t-1?t-1:0,i=l.lines.atIndex(r),n&&i&&s.editor.performDocumentReplaceRange(l.zoneId,[r,i.text.length],[t,n.text.length],"")):s.editor.performDocumentReplaceRange(l.zoneId,o,a,""))})},{shouldIncorp:!0})},Sf.prototype.convertAttribs=function(e,a){var s=this;return void 0===a&&(a=!0),e.map(function(e){var t=ve(e,2),n=t[0],r=t[1],i=s.formatterMap[n];if(!i)return[n,r];var o=s.getConstructorAsType(i.plugin,lf).formatValueType;return[n,s.convertValue(o,r,a)]})},Sf);function Sf(e){var t=Cf.call(this,{formatters:e.formatters})||this;return t.caretFormatAttribs={},t.editor=e.editor,t}var Tf=(Of.create=function(e){var t=e.plugins,n=e.bubbleExceptions,r=new Of;return r.setPlugins(t),r.setBubbleExceptions(n),r},Of.prototype.destroy=function(){this.getPluginsWith.cache.clear&&this.getPluginsWith.cache.clear(),this.plugins=[]},Of);function Of(){var a=this;this.setPlugins=function(e){a.plugins=e},this.setBubbleExceptions=function(e){void 0===e&&(e=!0),a.bubbleExceptions=e},this.addPlugin=function(e){a.plugins.push(e),a.getPluginsWith.cache.clear&&a.getPluginsWith.cache.clear()},this.run=function(t,n,e,r){var i=t[n];if(a.bubbleExceptions)return i.call(t,n,e,r);try{return i.call(t,n,e,r)}catch(e){console.error("hooks error plugin name "+t.className+", hook name "+n),console.log("hooks call error: ",e.stack),Ue("hooks call error: "+e.message)}},this.getPluginsWith=Object(u.a)(function(t){return a.plugins.filter(function(e){return!!e[t]})}),this.callAll=function(r,i){void 0===i&&(i={});var e=a.getPluginsWith(r),o=!1;return i.preventOtherHooks=function(){o=!0},e.reduce(function(e,t){if(o)return e;var n=a.run(t,r,i);return Object(T.default)(n)||(e=e.concat(n)),e},[])}}function wf(s,e,t){var n=this;void 0===t&&(t=!1);var r=[],i=e.filter(function(e){return e.async&&r.push(e),!e.async}),l=Tf.create({plugins:i,bubbleExceptions:t});return r.forEach(function(a){return de(n,void 0,void 0,function(){var t,n,r,i,o;return pe(this,function(e){switch(e.label){case 0:return[4,a.plugin];case 1:return(t=e.sent())&&t.default?(n=t.default,r=new n(s),(i=r.className)&&(o=i.slice(0,1).toLowerCase()+i.slice(1),s.plugins[o]=r),l.addPlugin(r),[2]):[2]}})})}),l}var Rf="0",Af=(xf.prototype.getTranslationData=function(e,t){var n=this;void 0===t&&(t=Rf);var r=this.editor.vectorReps,i={translationData:{},context:{vectorReps:{},numToAttribs:{}}},o=this.editor.getRep(t),a=o.alines,s=o.alltext,l=o.apool,c=Object.keys(r);t===Rf&&c.length&&(i.context.vectorReps=Object(b.default)(r),c.forEach(function(e){r[e].alines.forEach(function(e){n.editor.changesetHelper.eachAttribNumber(e,function(e){var t=l.getAttribKey(e),n=l.getAttribValue(e);i.context.numToAttribs[e]=[t,n]})})}));var u=ve(e,2),d=u[0],f=u[1],h=s.split("\n"),p=a.length;if(f<d)return i;d<0&&(d=0),p<=f&&(f=p-1);for(var g=d;g<=f;g++){var v=a[g],m=h[g],y=this.getTranslationText(t,v,m,l,g);Object(w.a)(i.translationData,y)}return i},xf.prototype.setTranslationData=function(e,t){var n,r,i,u=this,o=e.translationData,a=e.context,s=a.vectorReps,l=a.numToAttribs,d=this.editor.repManager.apool,f=[],h=this.editor.changesetHelper;this.vectorRepReady&&!t||(n=Object.keys(s),r=Object.keys(l),n.length&&r.length&&(i=r.map(function(e){var t=d.putAttrib(l[e]),n=h.numToString(Number(e)),r=h.numToString(t);return function(e){return e.replace(new RegExp("(\\*"+n+")(?=[\\D\\W])","g"),"*"+r)}}),n.forEach(function(e){var t=s[e].alines;s[e].alines=t.map(function(e){var t=e;return t&&i.forEach(function(e){t=e(t)}),t})})),this.editor.vectorReps=s,this.vectorRepReady=!0),this.editor.inCallStackIfNecessary("setTranslationData",function(){var n,e;Object.keys(o).forEach(function(e){u.editor.initiateRepForZoneIfNecessary(e);var a,s=o[e],l=u.editor.getRep(e).lines,c=h.builder(l.totalWidth(),"Z",e),t=Object.keys(s).sort(function(e,t){return Number(e)-Number(t)});0!==t.length&&(a=0,t.forEach(function(e){var t,n,r=Number(e);if(r>=l.numNodes||r<0)throw Error("[Translator]: Line num is not exist");r===a?a++:(t=l.offsetOfIndex(a),n=l.offsetOfIndex(r)-t,c.keep(n,r-a),a=r+1);var i=u.filterLineEmptyValue(s[e]),o=l.offsetOfIndex(r+1)-l.offsetOfIndex(r);r!==l.numNodes-1?(c.remove(o,1),i.forEach(function(e){var t=e.text,n=e.attribs;c.insert(t,n,d)}),c.insert("\n",[],d)):(c.remove(o-1,0),i.forEach(function(e){var t=e.text,n=e.attribs;c.insert(t,n,d)}))}),f.push(c.toString()))}),u.editor.fastIncorp(),u.editor.getCurrentCallStack().preventScrolling=!0,0!==f.length&&(n={},f.forEach(function(e){var t=u.editor.changesetHelper.unpack(e);Object.assign(n,t)}),e=u.editor.changesetHelper._pack(n),u.editor.applyChangesetToDocument(e))})},xf.prototype.spliceTranslationData=function(h,p,g,v){var m=this;void 0===v&&(v=[]),this.editor.inCallStackIfNecessary("spliceTranslationData",function(){var e=m.editor.getRep(h);e||m.editor.initiateRepForZoneIfNecessary(h);var t,n,r,i=e.lines,o=e.apool,a=m.editor.changesetHelper.builder(i.totalWidth(),"Z",h),s=p+g,l=s<i.length()?s:i.length()-1,c=i.atIndex(l),u=i.offsetOfIndex(p);l<p&&c?(t=i.offsetOfIndex(l),a.keep(t,l),a.keep(c.width-1),a.insert("\n",[],o)):(a.keep(u,p),0<g&&(n=i.offsetOfIndex(s-1),a.remove(n-u,g-1),r=i.offsetOfIndex(s),a.remove(r-n-1,0)));var d=0,f=v.length;v.forEach(function(e){m.filterLineEmptyValue(e).forEach(function(e){var t=e.text,n=e.attribs;a.insert(t,n,o)}),0<g&&d===f-1||a.insert("\n",[],o),d++}),m.editor.fastIncorp(),m.editor.getCurrentCallStack().preventScrolling=!0,m.editor.applyChangesetToDocument(a.toString())})},xf.prototype.filterLineEmptyValue=function(e){return e.reduce(function(e,t){if(!e.length)return[t];var n=e[e.length-1],r=n.attribs,i=(i=t.attribs).filter(function(e){return!!ve(e,2)[1]});return n&&Object(N.default)(r,i)?n.text+=t.text:e.push(t),e},[])},xf.prototype.getTranslationText=function(e,t,i,o,n){for(var r,a,s=this,l=this.editor.changesetHelper.opIterator(t),c=0,u=[],d=((r={})[e]=((a={})[n]=[],a),r),f=function(){var e=l.next(),t=e.attribs,n=e.chars,r={text:i.slice(c,c+n),attribs:[]};c+=n,h.editor.changesetHelper.eachAttribNumber(t,function(e){var t=o.getAttribKey(e),n=o.getAttribValue(e);n?r.attribs.push([t,n]):console.warn("Editor translate error attribs: ['"+t+"', '"+n+"]'")}),u.push(r)},h=this;l.hasNext()&&c<i.length;)f();d[e][n]=u;var p,g,v,m,y=this.editor.getRep(e).attributeManager.getAllAttributesOnLine(n),b=y.find(function(e){return"aceTable"===ve(e,1)[0]}),E=y.find(function(e){return"zoneId"===ve(e,1)[0]}),k=function(e){var t,n,r=s.editor.getRep(e);r&&(t=r.alines,n=s.getTranslationData([0,t.length-1],e),Object(w.a)(d,n.translationData))};return b?(g=(p=ve(b[1].split(" "),2))[0],v=p[1],du(this.editor.vectorReps,{rowId:g,colId:v}).forEach(function(e){k(e)})):E&&(m=E[1],k(m)),d},xf.prototype.translationDataToClientVars=function(e){var t,n,r,i,o=e.translationData,a=e.context,s={initialAttributedTexts:{attribs:{},cols:{},rows:{},text:{}},apool:new Ne(this.editor)},l={},c={};try{for(var u=ge(Object.keys(o)),d=u.next();!d.done;d=u.next()){var f=d.value,h=o[f],p=Object.keys(h).sort(function(e,t){return Number(e)-Number(t)});l[f]=[],c[f]=[];var g=function(e){var r=v.editor.changesetHelper.builder(0,"Z",f);h[e].reduce(function(e,t){if(!e.length)return[t];var n=e[e.length-1],r=n.attribs,i=(i=t.attribs).filter(function(e){return!!ve(e,2)[1]});return n&&Object(N.default)(r,i)?n.text+=t.text:e.push(t),e},[]).forEach(function(e){var t=e.text,n=e.attribs;r.insert(t,n,s.apool)});var t=r.toUnpacked();l[f].push(t.charBank),c[f].push(t.ops)},v=this;try{for(var m=(r=void 0,ge(p)),y=m.next();!y.done;y=m.next())g(y.value)}catch(e){r={error:e}}finally{try{y&&!y.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}l[f].push(""),l[f]=l[f].join("\n"),c[f].push(""),c[f]=c[f].join("|1+1")}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}Object(w.a)(s.initialAttributedTexts,{attribs:c,text:l});var b,E=a.vectorReps,k=a.numToAttribs,C=s.apool,I=Object.keys(E),S=Object.keys(k),T={},O={};return I.length&&(S.forEach(function(e){var t=C.putAttrib(k[e]);O[e]=t,T[t]=k[e]}),a.numToAttribs=T,b=I.reduce(function(e,t){var n,r=E[t],i=r.alines,o=r.vectorIds,a=i.map(function(e){return Wd(e,O)});return E[t].alines=a,iu(t)&&(e.rows[t]=o),ou(t)&&(e.cols[t]=o),Object(w.a)(s.initialAttributedTexts.attribs,((n={})[t]=a.join(""),n)),e},{cols:{},rows:{}}),Object(w.a)(s.initialAttributedTexts,b)),s},xf);function xf(e){this.editor=e,this.vectorRepReady=!1}var Mf=tu,Nf=window,_f={insertorder:!0,author:!0},Lf="inInternationalComposition",Df="    ",Bf="doc-resize-placeholder",Pf="juice-ignore-node-class",Ff={firstLineJumpOnTab:!0,editorDidUpdate:function(){},inEmbed:function(){return!1}},jf="defualtAuthor",zf={apool:{nextNum:1,numToAttrib:{0:["author",jf]}},initialAttributedText:{attribs:"*0|1+1",text:"\n"},initialAttributedTexts:{rows:{},cols:{},attribs:{0:"*0|1+1"},text:{0:"\n"}}},Hf=["destory","destroy","reset","clear","getApool","callStackLogs"],Uf="client_performance_doc_do_return_key",Vf="client_performance_doc_do_delete_key",Wf=0,Kf=(Object.defineProperty(Zf.prototype,"preRenderer",{get:function(){return this.blockRender.preRenderer},enumerable:!0,configurable:!0}),Object.defineProperty(Zf.prototype,"enableUnmountNode",{get:function(){var e,t;return!(null===(e=this.props.renderConfig)||void 0===e||!e.open||null===(t=this.props.renderConfig)||void 0===t||!t.unmount)},enumerable:!0,configurable:!0}),Zf.getDefaultClientVars=function(){return zf},Zf.prototype.setDocAttribute=function(e,t){void 0!==this.props.spellCheck&&e.setAttribute("spellCheck",this.props.spellCheck),void 0!==this.props.autoCorrect&&e.setAttribute("autoCorrect",this.props.autoCorrect?"on":"off"),t&&e.setAttribute("contentEditable","true"),he()(e).addClass("innerdocbody adit-container notranslate")},Zf.prototype.initDomLineEntries=function(e,i,o,a){var t=this;this.getObserver().observeNode(e);var s=i.alltext.split("\n"),l=[],c=e.childNodes,u=this.managers.zoneToLineEntry[o].isActive;this.dirtyChecker.observer.withoutRecordingMutations(function(){for(var e=0,t=s.length-1;e<t;e++){var n,r=i.lines.atIndex(e);r&&((n=c[e]).id=r.key,a[e].node=n,r.setDomInfo(ue(ue({},a[e]),{lineString:s[e],zone:o})),u&&(r.isActive=r.mounted=u),l.push(r))}}),l.forEach(function(e){t.domLine.decorateMagicObjects(e)})},Zf.prototype.getAttributesOnLine=function(e,t){return this.getRep(e).attributeManager.getAttributesOnLine(t)},Zf.prototype.processMatchedAttributeOnSelection=function(e,t,u,n){var r,i,d=this.getRep(e),o=t||d,a=this.selection.getRealFirstLine(d.zoneId,o),s=this.selection.getRealEndLine(d.zoneId,o);function l(e){var t,n;if(!e)return"";var r=e.split("*"),i=[];try{for(var o=ge(r),a=o.next();!a.done;a=o.next()){var s,l=a.value,c=parseInt(l,36);c==c&&((s=d.apool.numToAttrib[c])&&-1<s[0].indexOf(u)&&i.push(s))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return 0<i.length?i:""}for(var c=a;c<=s;c++){var f=this.changesetHelper.opIterator(d.alines[c]),h=0,p=0;d.attributeManager.lineHasMarker(c)&&(p=1);var g=d.lines.atIndex(c),v=g.text.length;for(c===a&&(p=a===o.selStart[0]?o.selStart[1]:p),c===s&&(v=s===o.selEnd[0]?o.selEnd[1]:v),g.domInfo&&Oo(g.domInfo.node)&&g.domInfo.node.querySelector("img")&&(v=g.text.length);f.hasNext();){var m=f.next(),y=h,b=y+m.chars,E=l(m.attribs)||[];try{for(var k=(r=void 0,ge(E)),C=k.next();!C.done;C=k.next()){var I=C.value,S=I[0],T=I[1];S&&(b<=p||v<=y||n([c,y],[c,b],S,T,d))}}catch(e){r={error:e}}finally{try{C&&!C.done&&(i=k.return)&&i.call(k)}finally{if(r)throw r.error}}h=b}}},Zf.prototype.getAttributeOnSelection=function(e,t,n){return this.getRep().attributeManager.getAttributeOnSelection(e,t,n)},Zf.prototype.isIgnoreThisAttributeOnLine=function(e,t,n){var r=this.getRep(e).lines.atIndex(t)||{};return he()(r.lineNode).hasClass("ignore-attr-"+n)},Zf.prototype.setAttributesOnLine=function(e,t,n){this.getReps()[e].attributeManager.setAttributesOnLine(t,n)},Zf.prototype.removeAttributeOnDom=function(e,t,n,r){var i=this.getRep(e),o=this.domToRep(t);o&&i.attributeManager.setAttributesOnRange([o.selStart[0],o.selStart[1]],[o.selEnd[0],o.selEnd[1]],[[n,""]],r)},Zf.prototype.performDocumentReplaceVectorRange=function(e,t,n,r,i){var o=this,a=this.getVectorsRep(t,e);if(!(0<=n&&n<=r&&r<=a.vectorIds.length))throw new Error("performDocumentReplaceVectorRange: bad range "+n+", "+r+", "+a.vectorIds.length);for(var s,l,c,u,d=[],f=0;f<i;f++)d.push((e?Xc:$c)());n<r&&(s=this.managers.getLineEntryContainingZone(t),l=a.vectorIds.slice(n,r),c=s.domInfo.lineManagerData,u=e?c.colsZoneId:c.rowsZoneId,nu(l,this.getVectorsRep(u,!e).vectorIds,!e).forEach(function(e){var t,n,r=o.getReps();e in r&&(t=r[e].lines.length()-1,o.performDocumentReplaceRange(e,[0,0],[t,r[e].lines.atIndex(t).text.length],""),o.selection.getStart()&&o.selection.getStart().zone===e&&(n=o.managers.positionOfLineManagerContainingZone(e),o.selection.set(n)))}));var h=this.changesetHelper.smartOpAssembler();h.append({opcode:"=",attribs:"",lines:0,chars:n}),h.append({opcode:"-",attribs:"",lines:0,chars:r-n}),h.append({opcode:"+",attribs:"",lines:0,chars:i});var p={};p[t]={itemType:e?"R":"C",oldLen:a.vectorIds.length,newLen:a.vectorIds.length-(r-n)+i,ops:h.toString(),charBank:d};var g=this.changesetHelper._pack(p);this.initiateRepForZoneIfNecessary(t),this.performDocumentApplyChangeset(g)},Zf.prototype.performDocumentDeleteLine=function(e,t){this.repManager.setActiveRep(e);var n=this.getRep(e);0<=t&&t<n.lines.length()&&this.performDocumentReplaceRange(e,[t,0],[t,n.lines.atIndex(t).text.length],"")},Zf.prototype.domSplice=function(e,t,n,r,i,o){void 0===o&&(o=!1);var a=this.dom.rootNodeOfZone(e);this.domLine.insertDomLines(e,t,n.map(function(e){return e.domInfo}),null,r.map(function(e){return e.lineNode})),this.hooks.callAll("linesWillReplace",{oldLineEntries:r,newLineEntries:n,isRemote:!!o,startLine:i,zoneId:e});var s=this.hooks.callAll("aceSelectionAffectedShouldNotChange").includes(!0);return r.forEach(function(e){var t=a.querySelector("#"+e.key);t&&t.parentElement&&t.parentElement.removeChild(t)}),s},Zf.prototype.getSelectionWithoutZone=function(e){var t=ve(e,2);return[t[0],t[1]]},Zf.prototype.doArrowKeyAroundFakeText=function(e,t){var n,r,i=window.getSelection().focusNode;if(i){var o=Mo()||Ce.isSafari&&No(),a=_o(i),s=i.firstChild&&Mo(i.firstChild);if(o||a||s){var l=e.ctrlKey,c=e.shiftKey,u=this.selection.get(),d=u.focus,f=u.anchor,h=u.isCollapsed,p=this.getSelectedRep(),g=p.lines,v=g.atIndex(d.line),m=g.atIndex(d.line+1),y=!h&&!c;if(t===Ku.Right||Ce.isMac&&l&&t===Ku.F){if(Xu(e)){var b=v.text.length,E=d.line,k=new Vo(d.zone,E,b);return this.selection.set(Yo(e.shiftKey?f:k,k)),!0}if(d.col===v.text.length){if(!m)return!1;b=y?Math.max(d.col,f.col):m.lineMarker,E=y?Math.max(d.line,f.line):d.line+1;return k=new Vo(d.zone,E,b),this.selection.set(Yo(c?f:k,k)),!0}var C=Lo(i,a,"RIGHT")||od(v.text.slice(d.col)),b=y?Math.max(d.col,f.col):d.col+C,E=y?Math.max(d.line,f.line):d.line;if(k=new Vo(d.zone,E,b),b>v.text.length){if(k.line+1>=g.length())return!1;k=k.withLine(k.line+1).withCol(0)}return this.selection.set(Yo(c?f:k,k)),!0}if(t===Ku.Left||Ce.isMac&&l&&t===Ku.B){if(Xu(e)){b=v.lineMarker,E=d.line;return k=new Vo(d.zone,E,b),this.selection.set(Yo(e.shiftKey?f:k,k)),!0}if(d.col===v.lineMarker){var I=d.line-1;if(I<0)return!1;var S=g.atIndex(I),b=y?Math.min(d.col,f.col):S.text.length,E=y?Math.min(d.line,f.line):I;k=new Vo(d.zone,E,b),this.selection.set(Yo(e.shiftKey?f:k,k));var T,O,w=he()(e.target).parents(".zone-scroll-container");return w.length&&(T=(null===(r=null===(n=p.lines.atIndex(E))||void 0===n?void 0:n.lineNode)||void 0===r?void 0:r.offsetWidth)||0,(O=w.width()||0)<T&&w.scrollLeft(T-O)),!0}C=Lo(i,a,"LEFT")||sd(v.text.slice(0,d.col)),b=y?Math.min(d.col,f.col):d.col-C,E=y?Math.min(d.line,f.line):d.line;if(k=new Vo(d.zone,E,b),b<0){if(k.line-1<0)return!1;k=k.withLine(k.line-1).withCol(0)}return this.selection.set(Yo(e.shiftKey?f:k,k)),!0}return!1}}},Zf.prototype.mergeChangesets=function(e){var t,n,r=this.getRep(),i=e.shift();try{for(var o=ge(e),a=o.next();!a.done;a=o.next())var s=a.value,l=this.changesetHelper.follow(i,s,!1,r.apool),i=this.changesetHelper.compose(i,l,r.apool)}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},Zf.prototype.spliceGalleryItemsAtLine=function(r,i,o,a,e,s){var l=this,c=this.getRep(r),t=c.lines.atIndex(i),n=this.getMatchedAttributePositionOnSelection({selZone:r,selStart:[i,0],selEnd:[i,t.text.length]},function(e){return"gallery"===e}).reduce(function(e,t){var n=t.attrValue,r=JSON.parse(n);return r&&r.items&&0<r.items.length&&(e=me(e,r.items)),e},[]);return!!n&&(n.splice(o,a,e),(n=n.filter(function(e){return null!=e})).forEach(function(e,t){var n;l.call("resetUuid",e),a&&t===o-1&&s?(l.call("galleryImageChoosed","image-upload-image-"+e.uuid),l.inCallStackIfNecessary("reChooseImage",function(){l.performSelectionChange(r,[i,0],[i,1])}),l.selection.updateBrowserSelectionFromRep(),l.inCallStackIfNecessary("reChooseImage",function(){l.performSelectionChange(r,[i,0],[i,0])}),l.selection.updateBrowserSelectionFromRep()):a&&0===o&&i&&(n=c.lines.atIndex(i-1).text.length,l.inCallStackIfNecessary("deleteImage",function(){l.performSelectionChange(r,[i-1,n],[i-1,n])}),l.selection.updateBrowserSelectionFromRep())}),n.length?this.performDocumentReplaceRangeWithAttributes(r,[i,0],[i,t.text.length]," ",[["gallery",JSON.stringify({items:n})]]):r!==sr&&0===i&&1<c.lines.length()?this.performDocumentReplaceRange(c.zoneId,[0,0],[1,0],""):this.performDelete(i),!0)},Zf.prototype.searchString=function(e,t,n,r,i){var o=this.getReps()[e];if(o)return $d(this,e,o,t,n,r,i)},Zf.prototype.replaceString=function(e,t){nf(this,e,t)},Zf.prototype.scrollToSelection=function(e,t){return void 0===t&&(t={}),Ea({selectionRange:e,scrollFn:t.scrollFn,shouldRenderAll:t.shouldRenderAll},this)},Zf.prototype.handleDeleteKeyOnLineEnd=function(){var e=this;if(!this.isCaret())return!1;var t=this.getRep(),n=t.selEnd[1]===t.alinesWidth[t.selEnd[0]]-1,r=t.lines.length()>t.selEnd[0]+1;if(!n||!r)return!1;var i=t.lines.atIndex(t.selEnd[0]+1);return!!i&&(this.inCallStackIfNecessary("handleDeleteKeyOnLineEnd",function(){e.performDocumentReplaceRange(t.zoneId,t.selEnd,[t.selEnd[0]+1,i.lineMarker],""),e.selection.setWithSelection(t.zoneId,t.selEnd,t.selEnd,!0),e.selection.updateBrowserSelectionFromRep(!0)}),!0)},Zf.prototype.getLineRectByIndex=function(e,t){return void 0===t&&(t="0"),this.getReps()[t].lines.atIndex(e).getLineRect(t)},Zf.prototype.composeRepsToChangeset=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=e.lines.length()-1,i=e.lines.atIndex(r),o=t.length?t.reduce(function(e,t){return{text:e.text+t.alltext,attribs:e.attribs+t.alines.join("")}},{text:"",attribs:""}):null,a=this.changesetHelper.builder(e.lines.totalWidth(),"Z",e.zoneId);return this.changesetHelper.buildKeepToStartOfRange(e,a,[r,i?i.text.length:0]),a.insert("\n"),o&&a.insertAText(o),a.toString()},Zf);function Zf(e){var re=this;this.props=e,this.version="[AIV]{version}[/AIV]",this.maxListLevel=16,this.events={},this.zoneToTableMap={},this.zoneToTableIndexMap={},this.plugins={},this.currentMagicObjectId=1,this.vectorReps={},this.isEnable=!0,this.innerZoneEditorNodes={},this.isPerforming=!1,this.isError=!1,this.updateActivationTimer=null,this.incorpInfo=[],this.contentEditableLock=!1,this.contentEditableTemp=!1,this.isUndoHandleEnabled=!0,this.pasteSource="",this.pasteTimes=0,this.shouldFixSelection=!0,this.currentComposedChangeset="",this.contentTypeRegistry={id:"full",isEnabled:!1,length:1},this._blockElems={div:1,p:1,pre:1,li:1,ol:1,ul:1,code:1},this.initResizeStrategy=function(){var e=re.resizeStrategy;if(re.idleWorkTimer.detectEditorResizeImmediately(),re.idleWorkTimer.detectWindowResizeImmediately(),window.addEventListener("resize",re.idleWorkTimer.detectWindowResize),"iframe"===e){var t=re.getDocBody().parentElement,n=document.createElement("iframe");return n.classList.add(Bf),n.classList.add(Pf),t.appendChild(n),re.resizeNode=n,void(re.resizeFrameId=window.requestAnimationFrame(function(){var e=n.contentWindow;e?e.addEventListener("resize",re.idleWorkTimer.detectEditorResize):console.error("iframe.contentWindow not found, iframe init fail, Editor may occurs bug when resize")}))}"default"===e&&re.idleWorkTimer.monitorEditorSizeChange()},this.setRect=function(){re.rect=re.getDocBody().getBoundingClientRect()},this.getRect=function(){return re.rect},this.initialRep=function(e,t){var n=re.repManager.reps[e],r=re.changesetTracker.getBaseZatext(),i=r.text[e],o=r.attribs[e];if(void 0===i){var a=["|1+1"];return re.lineTracker.initTracker(e,a),n.alltext="\n",n.alines=a,n}var s=Nr({text:i,attribs:o},t,re.changesetHelper);return re.lineTracker.initTracker(e,s),n.alltext=i,n.alines=s,n},this.registerEventEmitter=function(){re.eventEmitter=re.props.bus||al},this.registerPlugin=function(e){var t=[];if(e){t=t.concat(e(re)),re.plugins||(re.plugins={});for(var n=0,r=t.length;n<r;n++){var i,o=t[n],a=o.className;a&&(i=a.slice(0,1).toLowerCase()+a.slice(1),re.plugins[i]=o)}}return t},this.once=function(e,t){t.isOnce=!0,re.on(e,t)},this.on=function(e,t){var n=re.events[e];n?n.push(t):re.events[e]=[t]},this.off=function(e,t){re.removeEventListener(e,t)},this.call=function(e,t){var n,r,i,o=re.events[e];if(o){for(var a=0;a<o.length;a++)o[a]&&(o[a].call(re,t),o[a]&&o[a].isOnce&&(o[a]=null));re.events[e]=re.events[e].filter(Boolean)}"error"===e&&(re.eventEmitter&&"function"==typeof re.eventEmitter.trigger&&re.eventEmitter.trigger("error",[{error:t.e}]),!0!==re.isError&&(re.isError=!0,r=null===(n=null===t||void 0===t?void 0:t.e)||void 0===n?void 0:n.stack,i={callStackLogs:re.callStack.callStackLogs,editorInfo:re.getDebugInfo(),errorStack:new Error("editor oops").stack,originErrorStack:r},Nf.collectEvent&&Nf.collectEvent("dev_editor_oops",i),Ue(t.message,{extras:i})))},this.fatal=function(e,t,n,r){re.call("error",{err:e,e:e,from:t,message:n,code:r})},this.pluginFatal=function(e,t,n,r){void 0===r&&(r={}),re.eventEmitter.trigger("EtherpadPlugin:Error",[ue(ue({},r),{err:e,from:"etherpad",message:t,type:"changeset",code:n,editor:null})])},this.getDebugInfo=function(){var r=re,t={};Object.keys(r).forEach(function(e){"boolean"==typeof r[e]&&(t[e]=r[e])});var i={};Object.keys(r.plugins).forEach(function(t){i[t]={};var n=r.plugins[t];Object.keys(n).forEach(function(e){"boolean"==typeof n[e]&&(i[t][e]=n[e])})});var e=r.getRep(),n=e?{zoneId:e.zoneId,alinesWidth:e.alinesWidth,selStart:e.selStart,selEnd:e.selEnd}:{},o=r.plugins.client,a=o?{uuid:o.messageSended?o.messageSended.uuid_v4:null,rev:o.rev,state:o.state}:{};return{editorInfo:t,repInfo:n,pluginsInfo:i,collabInfo:a}},this.removeEventListener=function(e,t){var n=re.events[e];if(n)for(var r=0,i=n.length;r<i;r++)t===n[r]&&n.splice(r,1)},this.initBrowserEnv=function(){Ce.isChrome&&he()(re.docbody).addClass("chrome"),Ce.firefox&&he()(re.docbody).addClass("mozilla"),Ce.safari&&he()(re.docbody).addClass("safari"),Ce.msie&&he()(re.docbody).addClass("msie"),Ce.windows&&he()(re.docbody).addClass("window"),re.docbody.dataset.gramm="false"},this.mouseDownListenerForMac=function(i){var e=function e(){document.removeEventListener("selectionchange",e);var t=re.selection.internalGetSelectionPoints();if(t)try{var n=re.selection.positionForDomPoint(t.startPoint),r=re.selection.positionForDomPoint(t.endPoint);n.zone===r.zone&&n.line!==r.line&&(re.selection.setWithSelection(n.zone,[n.line,n.col],[n.line,n.col]),re.selection.updateBrowserSelectionFromRep(!0))}catch(e){console.log("mouseDownListenerForMac error",i)}};i.button===Pn&&(document.addEventListener("selectionchange",e),setTimeout(function(){document.removeEventListener("selectionchange",e)},200))},this.mouseDownListenerForIE=function(t){var e=["image-container-wrap","block-placeholder","mention-chat","card-border","spreadsheet-canvas"],n=0<e.filter(function(e){return"string"==typeof t.target.className&&t.target.className.includes(e)}).length,r=e.map(function(e){return"."+e}).join(", "),i=void 0!==he()(t.target).closest(r)[0];t.target.querySelector(".image-container")&&(n||i)&&"TEXTAREA"!==t.target.tagName&&t.preventDefault()},this.fixSelection=function(){re.log("editor selectionchange"),La()||re.idleWorkTimer.idleActionFn()},this.bindEditorEvent=function(t){Ce.msie&&re.getDocBody().addEventListener("mousedown",re.mouseDownListenerForIE),Ce.isMac&&(Ce.isChrome||Ce.safari)&&re.getDocBody().addEventListener("mousedown",re.mouseDownListenerForMac),re.props.pure||(nr.forEach(function(e){he()(t).on(e,re.handleEvent)}),document.addEventListener("selectionchange",re.handleSelectionChange))},this.unBindEvent=function(t){var e,n;nr.forEach(function(e){he()(t).off(e,re.handleEvent)}),Ce.msie&&re.getDocBody().removeEventListener("mousedown",re.mouseDownListenerForIE),Ce.isMac&&(Ce.isChrome||Ce.safari)&&re.getDocBody().removeEventListener("mousedown",re.mouseDownListenerForMac),re.handleSelectionChange.cancel(),document.removeEventListener("selectionchange",re.handleSelectionChange),window.removeEventListener("resize",re.idleWorkTimer.detectWindowResize),re.resizeFrameId&&window.cancelAnimationFrame(re.resizeFrameId),null!==(n=null===(e=re.resizeNode)||void 0===e?void 0:e.contentWindow)&&void 0!==n&&n.removeEventListener("resize",re.idleWorkTimer.detectEditorResize)},this.destoryPlugins=function(){try{re.hook.callAll("reset",{editorInfo:re}),re.hook.callAll("destory",{editorInfo:re}),re.hook.callAll("destroy",{editorInfo:re})}catch(e){console.error("editor hook destroy error",e)}},this.destoryLisenteners=function(){re.events=[]},this.dispatchCompositionEvent=function(e){re.handleCompositionEvent(new CompositionEvent(e)),re.log("dispatchCompositionEvent",e)},this.correctCompositionIfNecessary=function(e){var t=["input","keyup","keydown","keypress","compositionstart","compositionend"],n=e.type,r=e.originalEvent;!0===re.getInInternationalComposition()&&(t.includes(n)?r&&!1===r.isComposing&&(re.dispatchCompositionEvent("compositionend"),re.log("dispatchCompositionEvent because eventType is "+n+" and isComposing is false")):(re.dispatchCompositionEvent("compositionend"),re.log("dispatchCompositionEvent because eventType is "+n)))},this.triggerEvent=function(e){return re.handleEvent(e)},this.handleEvent=function(e){var t=e.type;re.correctCompositionIfNecessary(e);var n,r=re.props[er[t]];r&&!1===r(e)||((n=re[tr[t]])&&n(e),e.originalEvent&&"historyUndo"===e.originalEvent.inputType?(e.preventDefault(),re.inCallStackIfNecessary("historyUndo",function(){re.doUndoRedo("undo"),re.selection.updateBrowserSelectionFromRep()},{shouldIncorp:!0})):e.originalEvent&&"historyRedo"===e.originalEvent.inputType&&(e.preventDefault(),re.inCallStackIfNecessary("historyRedo",function(){re.doUndoRedo("redo"),re.selection.updateBrowserSelectionFromRep()},{shouldIncorp:!0})))},this.compatibleToAce=function(){var t,e;try{for(var n=ge(Object.keys(re)),r=n.next();!r.done;r=n.next()){var i=r.value,o=i.indexOf("ace_")&&i.indexOf("component")<0;re.hasOwnProperty(i)&&"function"==typeof re[i]&&o&&(re["ace_"+i]=re[i])}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},this.initTracker=function(){var e=re.props,t=re.repManager,n=re.dirtyChecker.observer,r=re.setupRepExceptAlinesForRootZone,i=e.clientVars,o=i.apool,a=i.initialAttributedTexts;return t.apool=new Ne(re).fromJsonable(o),re.undoModule.enabled&&(re.undoModule.apool=t.apool),re.changesetTracker=new Cr({editor:re,apool:t.apool}),n.withoutRecordingMutations(function(){r(a),re.changesetTracker.setBaseAttributedText(a)}),re.changesetTracker},this.setupRepExceptAlinesForRootZone=function(e){var t,n,r,i,o=e.rows||{};try{for(var a=ge(Object.keys(o)),s=a.next();!s.done;s=a.next()){var l=s.value;re.vectorReps[l]={vectorIds:Object(_.a)(o[l]),forRow:!0,alines:[e.attribs[l]]}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}var c=e.cols||{};try{for(var u=ge(Object.keys(c)),d=u.next();!d.done;d=u.next()){var f=d.value;re.vectorReps[f]={vectorIds:Object(_.a)(c[f]),forRow:!1,alines:[e.attribs[f]]}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}},this.clear=function(){re.replaceAllText("")},this.reset=function(){re.inCallStackIfNecessary("editorReset",function(){re.fastIncorp(!0)}),re.dirtyChecker.observer.flush(),re.replaceAllText(""),!0===re.getInInternationalComposition()&&(re[Lf]=!1),re.repManager.apool=new Ne(re),re.undoModule.setApool(re.repManager.apool),re.changesetTracker.setApool(re.repManager.apool),re.undoModule.clearHistory()},this.replaceAllText=function(r){null==r&&(r=""),re.inCallStackIfNecessary("replaceText",function(){re.fastIncorp(!0);var e=re.getRep(),t=e.lines.length()-1,n=e.lines.atIndex(t).width-1;re.performDocumentReplaceRange(e.zoneId,[0,0],[t,n],r)},{shouldIncorp:!0})},this.changesetUnpackedVectorsZoneClear=function(e,t){var n=re.getVectorsRep(t,e).vectorIds.length,r=re.changesetHelper.smartOpAssembler();return r.append({opcode:"-",attribs:"",lines:0,chars:n}),{itemType:e?"R":"C",oldLen:n,newLen:0,ops:r.toString(),charBank:[]}},this.replaceAllByAttributeText=function(n,r){re.inCallStackIfNecessary("replaceAttributeText",function(){re.replaceAllText("");var e=re.getRep(sr),t=_r(e,n,re.changesetHelper);e.apool.fromJsonable(r),re.performDocumentApplyChangeset(t)})},this.cancel=function(){},this.initMainDoc=function(){var n=re.editorBase,e=re.blockRender,t=re.getReps();re.initialRep(sr,re.repManager.apool);var r=t[sr],i=r.lines,o=r.alltext,a=r.alines,s=r.zoneId;i.splice(0,0,o.slice(0,-1).split("\n").map(function(e,t){return new ma({editor:re,zone:s,root:re.docbody,context:{text:e,key:n.lineIdPre+n.nextId++,aline:a[t]}})})),re.hook.callAll("onAlinesInited"),e.startRender(),re.hook.callAll("editorUseBlockRender")},this.initZoneRep=function(n){var e=re.getReps()[n];if(e)return e;re.repManager.addRep(n);var t=re.initialRep(n,re.repManager.apool),r=t.alines,i=re.editorBase,o=t.alltext.split("\n").slice(0,-1).map(function(e,t){return new ma({editor:re,zone:n,context:{text:e,aline:r[t],key:i.lineIdPre+i.nextId++}})});return t.lines.splice(0,0,o),re.blockRender.initZoneLineStatus(t.zoneId),t},this.initZoneForTable=function(t){var e,n=re.initZoneRep(t),r=re.getLineNumInRootZone(t,0),i=re.blockRender.getLineStatus(sr,r).isActive;n.lines.length()||(e=n.alltext.split("\n").slice(0,-1).map(function(e){return re.createDomLineEntry(e,t,{isRendered:!0,isActive:i,mounted:!0})}),n.lines.splice(0,0,e));var o=n.alines,a=Math.min(n.lines.length(),o.length);n.lines.traverseEntries(0,n.lines.length()-1,function(e){e.isRendered=!0,e.isActive=i}),re.blockRender.updateLinesStatus(t,0,a,a,{isRendered:!0,isActive:i});var s=re.dom.rootNodeOfZone(t,!1,!1);if(s.innerHTML)return s;var l=re.blockRender.renderZone(t,{activeLines:Object(M.a)(0,a)}),c=re.editorBase.renderToString(l);return re.dirtyChecker.observer.withoutRecordingMutations(function(){n.domEntries=l,s.innerHTML=c}),s},this.initZone=function(t,e){void 0===e&&(e=!1);var n=re.getReps()[t];if(n&&(n.lines.length()||n.domEntries))return re.dom.rootNodeOfZone(t);var r,i=re.editorBase,o=re.initZoneRep(t),a=o.alines.length,s=re.dom.rootNodeOfZone(t,!1,e);o.lines.length()||(r=o.alltext.split("\n").slice(0,-1).map(function(e){return re.createDomLineEntry(e,t)}),o.lines.splice(0,0,r));var l=re.blockRender.renderZone(t,{activeLines:Object(M.a)(0,a)}),c=re.getLineNumInRootZone(t,0),u=re.blockRender.getLineStatus(sr,c).isActive;o.lines.traverseEntries(0,o.lines.length()-1,function(e){e.isRendered=!0,e.isActive=u}),re.blockRender.updateLinesStatus(t,0,a,a,{isRendered:!0,isActive:u});var d=i.renderToString(l);return re.dirtyChecker.observer.withoutRecordingMutations(function(){o.domEntries=l,s.innerHTML=d}),s},this.initZoneDomLineEntry=function(e){var t,n,r=re.getReps()[e];r.lineEntryInitialized||(r.lineEntryInitialized=!0,t=re.dom.rootNodeOfZone(e,!1),n=r.domEntries,r.domEntries||(n=re.editorBase.renderToDomLine(e,r.alines,re.repManager.apool,e)),re.initDomLineEntries(t,r,e,n),r.domEntries=null,Object(B.a)(t.childNodes,function(e,t){re.dirtyChecker.markNodeClean(e,r.lines.atIndex(t))}))},this.filterTableRowIds=function(){var i=re.changesetTracker.getBaseZatext(),o=re.getApool(),a="aceTable",s=[];return re.changesetHelper.eachAttribNumber(i.attribs[0],function(e){var t,n,r=o.numToAttrib[e];r[0]===a&&(t=r[1].split(" ")[0],n=i.rows[t],s=s.concat(n))}),s},this.initContent=function(){var e=re.props,t=e.editable;re.initMainDoc();var n=re.changesetTracker.getBaseZatext(),r=re.filterTableRowIds();Object.keys(n.text).filter(function(e){var t=Mf(e).rowId;return r.includes(t)}).forEach(function(e){e!==sr&&re.initZoneRep(e)}),re.withoutBlockingRender(function(){re.callStack.inCallStackIfNecessary("initContent",function(){re.selection.setWithSelection(sr,[0,0],[0,0],!1)},{shouldIncorp:!1}),re.listCache=new Ic(re),re.hook.callAll("clientVars",{type:"CLIENT_VARS",data:ue(ue({},e.clientVars),{collab_client_vars:e.clientVars})}),re.hook.callAll("onMount",{editor:re}),re.props.onMount&&re.props.onMount({editor:re}),re.setEditable(t),re.blockRender.getLinesStatus()[sr].forEach(function(e,t){var n;e.isRendered&&(n=re.getRep(sr).lines.atIndex(t),re.dirtyChecker.markNodeClean(n.lineNode,n))}),re.dirtyChecker.observer.observeNode(re.getDocBody()),re.props.pure||re.idleWorkTimer.atMost(300),re.mounted=!0})},this.withoutBlockingRender=function(e){e()},this.getCurrentLineEntry=function(){var e=re.selection.currentSelection,t=e.start,n=e.zone;return n?re.getRep(n).lines.atIndex(t.line):null},this.getObserver=function(){return re.dirtyChecker.observer},this.getRep=function(e){return e?re.repManager.getRep(e):re.repManager.getActiveRep()},this.getReps=function(){return re.repManager.reps},this.getVectorReps=function(){return re.vectorReps},this.getRepManager=function(){return re.repManager},this.getApool=function(){return re.getRep().apool},this.getSelectedRep=function(){var e=re.selection.getZone();return re.selection.hasSelection()?re.getRep(e):null},this.getHooks=function(){return re.hooks},this.getScrollContainer=function(){return re.props.scroller?he()(re.getDocBody()).closest(re.props.scroller).get(0):document.contains(re.getDocBody())?window:null},this.getProps=function(){return re.props},this.getHtml=function(){var n="",e=re.getRep(sr).lines;return e.traverseEntries(0,e.length()-1,function(e){var t;n+=null===(t=e.lineNode)||void 0===t?void 0:t.outerHTML}),n},this.getVectorsRep=function(e,t){if(null!=e){if(e in re.vectorReps||(re.vectorReps[e]={vectorIds:[],forRow:t,alines:[""]}),re.vectorReps[e].forRow!==t)throw new Error("zoneId "+e+" in rep as forRow="+re.vectorReps[e].forRow+" but getVectorsRep called with forRow="+t);return re.vectorReps[e]}},this.getLineNumInRootZone=function(t,e){if(t===Vo.ROOT_ZONE)return e;for(var n=10,r=0,i=re.managers.zoneToLineEntry[t];i&&i.zone!==sr&&r++<n;)i=re.managers.zoneToLineEntry[i.zone];var o,a=re.getRep(i&&i.zone||sr);try{o=a.lines.indexOfEntry(i)}catch(e){re.log("catch error when getLineNumInRootZone, zone:",t),o=-1}return o},this.getLineTop=function(e,t){var n=ve(t,2),r=n[0],i=n[1],o=re.getRep(e);if(re.lineTracker.collapseLines){var a=re.lineTracker.collapseLines.getCollapsedStatusOfLine(e,r);if(!a)return null;var s=a.renderCollapsed,l=a.startOfCollapseSection;if(!s||s&&l){var c=o.lines.atIndex(r);return c?c.getLineRect().top+c.getCharRect(i).top:null}for(var u,d=re.getRep(Vo.ROOT_ZONE),f=re.getLineNumInRootZone(e,r)-1;0<f;){var h=re.lineTracker.collapseLines.getCollapsedStatusOfLine(Vo.ROOT_ZONE,f);if(!h)break;var p=h.renderCollapsed,g=h.startOfCollapseSection;if(!p||p&&g)break;f--}return(u=d.lines.atIndex(f))?u.getLineRect().top+u.getCharRect(f).top:null}return(u=o.lines.atIndex(r))?u.getLineRect().top+u.getCharRect(i).top:null},this.getColorPalette=function(){return re.props.clientVars.colorPalette||[]},this.getDocBody=function(){return re.docbody},this.getInnerHeight=function(){return re.getInnerContainer()?re.getInnerContainer().offsetHeight:0},this.getInnerWidth=function(){var e=re.getInnerContainer();return e?e.offsetWidth:0},this.getInnerContainer=function(){return re.getDocBody()},this.getContainerBox=function(){return document.getElementById("editorcontainerbox")},this.getOuterContainer=function(){return re.getDocBody()&&re.getDocBody().parentNode},this.getScrollTop=function(){return he()(re.getScrollContainer()).scrollTop()},this.getAuthor=function(){var e=re.clientVars;return e&&e.userId&&"0"!==e.userId?e.userId:re.props.author||jf},this.getInnerText=function(){return re.docbody?re.docbody.innerText||re.docbody.textContent:""},this.getStats=function(){var n=0,r=0;re.managers.getAllChildZones().text.forEach(function(e){var t=re.getReps()[e].alltext;r+=_n(t,!1),n+=_n(t,!0)});var e=re.getRep("0").alltext;return r+=_n(e,!1),{charCount:n+=_n(e,!0),wordCount:r}},this.getPluginStats=function(o,e){var t,n,r,a={},s=null,l=function(e){var t,n=ve(e,2),r=n[0],i=n[1];o[r]&&((t=(0,o[r])(i,re)).childReps&&t.childReps.forEach(function(e){s(e)}),t.pluginCounts.forEach(function(e){var t=ve(e,2),n=t[0],r=t[1];a[n]=(a[n]||0)+r}))},s=function(e,t){for(var n=ve(t=t||[0,e.alines.length-1],2),r=n[0],i=n[1],o=r;o<=i;o++)e.attributeManager.getAllAttributesOnLine(o).forEach(l)};return e&&e.selStart&&e.selEnd?(t=e.selStart,n=e.selEnd,r=[t[0],n[0]]):e=re.getRep(sr),s(e,r),a},this.getLineListType=function(e,t){var n=re.listCache.get(e,t);return n?n.listType:""},this.getLineListInfo=function(e,t){var n=re.listCache.get(e,t);return n?{listType:n.listType,listId:n.listId}:null},this.isOtherIncorpedAttribute=function(e){return!!_f[e]},this.isFocus=function(){return document.hasFocus()&&document.activeElement===re.getDocBody()},this.isEnabled=function(){return re.isEnable},this.isEmpty=function(){return Object.values(re.getReps()).every(function(e){return"\n"===e.alltext})},this.isShouldFixSelection=function(){return re.shouldFixSelection},this.blur=function(){var e=re.selection.currentSelection,t=e&&e.zone||sr;re.dom.rootNodeOfZone(t).blur()},this.setEditable=function(e,t){re.setPluginMode(e,t),re.setContentEditable(e)},this.setCopyable=function(e){re.copyable=e},this.disable=function(){he()("#editbar").addClass("disabledtoolbar").removeClass("enabledtoolbar")},this.enable=function(){he()("#editbar").addClass("enabledtoolbar").removeClass("disabledtoolbar")},this.setPluginMode=function(e,t){if(re.editorStatusLocked)re.editableArgTemp={designMode:e,args:t};else{re.editable=e;var n=re.hook;try{re.editable?n.callAll("pluginReadWrite",t):n.callAll("pluginReadOnly",t)}catch(e){re.log(e)}}},this.setEditStatus=function(e,t){re.setEditable(e,t)},this.setEditStatusLock=function(e,t){var n,r,i;!(re.editorStatusLocked=e)&&t&&re.editableArgTemp&&(r=(n=re.editableArgTemp).designMode,i=n.args,re.setEditStatus(r,i)),e&&(re.editableArgTemp={designMode:re.getEditStatus(),args:{}})},this.setUndoHandleEnabled=function(e){re.isUndoHandleEnabled=e},this.getEditStatus=function(){return re.editable},this.setSel=function(e,t,n){re.selection.setWithSelection(re.getRep().zoneId,e,t),n&&"\n"!==re.getRep().alltext&&re.selection.updateBrowserSelectionFromRep()},this.isSelectionOnTitle=function(){var e=re.getRep(),t=e.lines.atIndex(e.selEnd[0]);return 0===e.selStart[0]&&(0===e.selEnd[0]||1===e.selEnd[0]&&e.selEnd[1]<=t.lineMarker)},this.editorDidUpdate=function(){re.togglePlaceHolder(),re.props.editorDidUpdate&&re.props.editorDidUpdate()},this.togglePlaceHolder=function(){var e,t=re.props.placeholder,n=re.getDocBody();t&&n&&(e=re.getInnerText(),(Ce.isIE?""===e:"\n"===e||re.isDocBodyEmpty())?n.setAttribute("data-placeholder",t):n.setAttribute("data-placeholder",""))},this.isDocBodyEmpty=function(){return!!re.docbody&&(1===re.docbody.childElementCount&&(1===re.docbody.children[0].childElementCount&&"BR"===re.docbody.children[0].children[0].nodeName.toUpperCase()))},this.focus=function(e,t){var n=re.selection.currentSelection,r=n&&n.zone||sr,i=re.dom.rootNodeOfZone(r);t?ta(i):he()(i).focus(),e&&(he()(re.docbody).parent().hasClass("adit-outer-container")?he()(re.getScrollContainer()):he()(".etherpad-container-wrapper")).scrollTop(e)},this.advancedDomToRep=function(e){var t,n,r,i=re.domToRep(e);return i&&(t=i.selStart[2],n=i.selStart[0],r=re.getRep(t),re.getAttributeOnLine(t,n,"gallery")&&(i.selEnd[1]=r.alinesWidth[n]-1)),i},this.domToRep=function(e){if(e){var t={node:e,index:0,maxIndex:0};if(e.lineManager&&e.lineManager.getLineAndChar){var n=e.lineManager.getLineAndChar(e);if(n)return n}var r=re.selection.getLineAndCharForPoint(t);if(r)return{selStart:r,selEnd:[r[0],r[1]+Ki(e).length,r[2]]}}return null},this.activeCaret=function(){for(var e,t=!1,n=window.getSelection().anchorNode,r=n,i=re.getDocBody(),o=/image-upload-image/.test(n&&n.id||"");n&&"body"!==(n.tagName||"").toLowerCase();){if(n===i){t=!0;break}n=n.parentNode}t&&(o?re.anchorNodeClickTimeout=window.setTimeout(function(){r.firstChild.click()},0):he()(r).parents(".single-line").length?he()(r).click():(e=re.dom.isRootOfZone(r)?r:re.dom.rootNodeOfZoneContaining(r))&&document.activeElement!==e&&e&&(e.setActive?e.setActive():ta(e)))},this.callWithAce=function(e,t,n,r){var i,o=re.inCallStack,a=re.fastIncorp,s=function(){return e(re)};return void 0!==n&&(i=s,s=function(){a(),i()}),void 0!==t?o(t,s,r):s()},this.applyChangesetToDocument=function(e){var t=re.getCurrentCallStack,n=re.performDocumentApplyChangeset,r=t(),i=r.editEvent.eventType;r.startNewEvent("nonundoable"),n(e,!0),r.startNewEvent(i)},this.getDocId=function(){return re.props.token},this.getEditorUniqueId=function(){return re.editorUniqueId},this.getAttributeOnLine=function(e,t,n){return re.getRep(e).attributeManager.getAttributeOnLine(t,n)},this.getAttributesFromChangeset=function(e){var t,n,r=re.getRep().apool,i=re.changesetHelper.unpack(e),o={};try{for(var a=ge(Object.keys(i)),s=a.next();!s.done;s=a.next()){var l=s.value,c=i[l].ops,u=re.changesetHelper.opIterator(c);o[l]=re.changesetHelper.parseAttributesFromOpIter(u,r)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o},this.analyzeChange=function(e,t,n,r,i,o){var a=re.isOtherIncorpedAttribute,s=re.getRep();function l(e){return!a(s.apool.getAttribKey(e))}var c=function(e){for(var t=[],n=[],r=re.changesetHelper.opIterator(e);r.hasNext();){var i=r.next();t.push(i.chars),n.push(i.attribs)}return[t,n]};function u(e,t){var n=e[0],r=e[1],i=t?n.length-1:0,o=0;return function(){for(;o>=n[i];)t?i--:i++,o=0;var e=r[i];return o++,e}}function d(e,t){var n=e.charCodeAt(t);return 0<t&&ld(n)&&--t,e.codePointAt(t)||e.charCodeAt(t)}function f(e,t){return e===t||Object(N.default)(e.split("*").filter(function(e){return e}).sort(),t.split("*").filter(function(e){return e}).sort())}for(var h=e.length,p=t.length,g=Math.min(h,p),v=c(re.changesetHelper.filterAttribNumbers(n,l)),m=c(re.changesetHelper.filterAttribNumbers(r,l)),y=0,b=u(v,!1),E=u(m,!1);y<g;){var k=65535<(T=d(e,y))?2:1;if(T!==(O=d(t,y))||!f(b(),E()))break;y+=k}for(var C=0,I=u(v,!0),S=u(m,!0);C<g;){var T=d(e,h-1-C),O=d(t,p-1-C),w=65535<T?2:1;if(0===C)I(),S(),C++;else{if(T!==O||!f(I(),S()))break;C+=w}}var R,x,M="number"==typeof o?p-o:-1;return h<y+C&&(x=C,y=h-(C=(R=h-y)<=M&&M<=x?M:R)),p<y+C&&(x=C,y=p-(C=(R=p-y)<=M&&M<=x?M:R)),[y,C]},this.setDidComposedChangesetTimeout=function(e){var t=e.changeset,n=e.apool,r=e.isRemote;re.didComposedChangesetTimeout?(re.currentComposedChangeset=re.changesetHelper.compose(re.currentComposedChangeset,t,n),clearTimeout(re.didComposedChangesetTimeout)):re.currentComposedChangeset=t,re.didComposedChangesetTimeout=window.setTimeout(function(){re.didComposedChangesetTimeout=0,re.hooks.callAll("didComposedChangeset",{changeset:re.currentComposedChangeset,apool:n,isRemote:r})},0)},this.removeAllPockets=function(){Object.keys(re.repManager.reps).forEach(function(e){var t,n,r,i=re.repManager.reps[e];if(i&&i.lines)for(var o=i.lines.atIndex(0);o;)null!==(n=null===(t=o.lineNode)||void 0===t?void 0:t.pocket)&&void 0!==n&&n.clear(),null===(r=o.lineNode)||void 0===r||r.pocket,o=i.lines.next(o)})},this.destory=function(){re.destroy()},this.destroy=function(){re.idleWorkTimer.never(),re.mounted=!1,re.blockRender.reset(),re.fiber.destroy();try{re.changesetTracker.destoryTracker(),re.unBindEvent(re.docbody),re.destoryLisenteners(),re.destoryPlugins(),re.hooks.destroy(),re.dirtyChecker.observer.destroy(),re.plugins={},re.events={},re.selection.destroy(),re.undoModule.reset(),re.removeAllPockets(),re.repManager.reset(),re.dirtyChecker.clear(),re.lineTracker.destroy(),re.viewPort.destory(),re.managers.destroy(),re.callStack.reset(),re.togglePlaceholderTimeout&&clearTimeout(re.togglePlaceholderTimeout),re.scrollByPositionTimeout&&clearTimeout(re.scrollByPositionTimeout),re.anchorNodeClickTimeout&&clearTimeout(re.anchorNodeClickTimeout),re.fastIncorpTimout&&clearTimeout(re.fastIncorpTimout),re.editorDidUpdateTimeout&&clearTimeout(re.editorDidUpdateTimeout),re.fixViewTimeout&&clearTimeout(re.fixViewTimeout),re.getBoundAsyncTimeout&&clearTimeout(re.getBoundAsyncTimeout),re.handleKeyEventTimeout&&clearTimeout(re.handleKeyEventTimeout),re.paintFrameId&&cancelAnimationFrame(re.paintFrameId),re.updateActivationTimer&&clearTimeout(re.updateActivationTimer),delete re.doc,delete re.docbody,delete re.node,delete re.dom,delete re.root,re.listCache&&re.listCache.destroy()}catch(e){re.log(e)}},this.addMagicInlineObjectIds=function(e){return re.changesetHelper.csMapPack(e,function(e,t){return t.ops=re.addMagicInlineObjectIdsToOps(t.ops,re.repManager.apool),t})},this.addMagicInlineObjectIdsToOps=function(e,t){for(var n=re.changesetHelper.smartOpAssembler(),r=re.changesetHelper.opIterator(e);r.hasNext();){var i=r.next(),o=re.changesetHelper.attribsToDict(i.attribs,t);if("-"!==i.opcode&&o.magicObject){if(0<i.lines)throw new Error("inlineMagicObject on newline");for(var a=0;a<i.chars;a++){var s=""+re.currentMagicObjectId++,l=re.changesetHelper.composeAttributes(i.attribs,re.changesetHelper.makeAttribsString(i.opcode,[["clientside-magicObjectId",s]],t),!1,t);n.append({lines:0,chars:1,opcode:i.opcode,attribs:l})}}else n.append(i)}return n.toString()},this.doCreateDomLine=function(e){var t=!0;return re.domLine.createDomLine({nonEmpty:e,doesWrap:t,optBrowser:Ce,optDocument:document,hooks:re.hook,formatterRenderer:re.formatterManager})},this.doRepApplyChangeset=function(e,t,n,r){var f=re.repManager,h=re,i=f.apool;re.changesetHelper.checkRep(e,i),re.changesetHelper.checkCSAppliesToRep(e,f.reps,re.vectorReps,n);var p=!!r;re.hooks.callAll("willChangesetApply",{changeset:e,author:"",editor:re,isRemote:p});var o=re.changesetTracker;if(!o)throw new Error("changesetTracker hasn't been created yet but someone is trying to apply a change. This is bad and will cause ace to get out of sync with changesettracker");var a,s=re.getCurrentCallStack(),l=h.addMagicInlineObjectIds(e),c=s.editEvent;c.currentChangeset=l,"nonundoable"===c.eventType?c.changeset?c.changeset=re.changesetHelper.compose(c.changeset,l,i):c.changeset=l:(a=re.changesetHelper.inverseOnRep(l,f.reps,h.vectorReps,i),c.backset?c.backset=re.changesetHelper.compose(a,c.backset,i):c.backset=a);var g=re.changesetHelper;g.mutateAttributionLines(e,function(u,e){if("Z"!==e)return h.getVectorsRep(u,"R"===e).alines;h.initiateRepForZoneIfNecessary(u);var d=f.getRep(u).alines;return{splice:function(e){var t=ve(e),n=t[0],r=t[1],i=t.slice(2),o=d.slice(n,n+r),a=i;1<r&&(a=a.map(function(e){for(var n=g.opIterator(e),r=Object(F.smartOpAssembler)(),i=null,t=function(){var e=n.next(),t="";Object(F.eachAttribNumber)(e.attribs,function(e){"lineguid"===f.apool.getAttribKey(e)?(null==i&&(i=Object(F.numToString)(e)),t+="*"+i):t+="*"+Object(F.numToString)(e)}),e.attribs=t,r.append(e)};n.hasNext();)t();return r.toString()})),d.splice.apply(d,me([n,r],a));var s={},l={},c=h.getApool();h.changesetHelper.eachAttribNumber(o.join(""),function(e){s[e]=c.numToAttrib[e]}),h.changesetHelper.eachAttribNumber(i.join(""),function(e){l[e]=c.numToAttrib[e]}),h.hook.callAll("editorAlinesDidSplice",{start:n,deleteCount:r,prevState:{alinesSplice:o,alinesAttribs:o.map(function(e){return Object.values(h.changesetHelper.getAlineAttributes(c,e))}),numToAttrib:s},currentState:{alinesSplice:i,alinesAttribs:i.map(function(e){return Object.values(h.changesetHelper.getAlineAttributes(c,e))}),numToAttrib:l},zoneId:u,editor:h,isRemote:p})},get:function(e){return d[e]},length:function(){return d.length},slice:function(e,t){return d.slice(e,t)}}},i),o&&o.isTracking()&&(e=re.changesetHelper.filterAttribNumbers(e,function(e){return 0!==ve(me(i.getAttrib(e)),1)[0].indexOf(lr)}),o.composeUserChangeset(e,r)),re.setDidComposedChangesetTimeout({changeset:e,isRemote:r,apool:o.apool}),re.editorDidUpdateTimeout=window.setTimeout(function(){re.editorDidUpdate()})},this.makVectorsZonesChangeset=function(e,t,n,r){var i={};return i[t]={itemType:e?"R":"C",oldLen:0,newLen:n.length,ops:r,charBank:n},re.changesetHelper._pack(i)},this.doIncorpVectorsZoneInsert=function(e,t,n,r){var i=re.makVectorsZonesChangeset(e,t,n,r),o=re.getVectorsRep(t,e);re.doRepApplyChangeset(i),o.vectorIds=n.slice(0)},this.getChangesetFromDelta=function(e,t,n,r,i,o){for(var a=re.analyzeChange,s=re.getRep(o),l=s.lines,c={},u=e;u<e+t;u++){var d=l.atIndex(u),f=Object(W.default)(d,"lineNode.lineManager.getInnerZonesCs");o===sr&&f&&(c=ue(ue({},c),f()))}var h,p,g=l.offsetOfIndex(e),v=l.offsetOfIndex(e+t),m=l.offsetOfIndex(e);null!==i&&void 0!==i&&i.selStart&&(h=l.offsetOfIndex(i.selStart[0])+i.selStart[1]-m),null!==i&&void 0!==i&&i.selEnd&&(p=l.offsetOfIndex(i.selEnd[0])+i.selEnd[1]-m);var y=Object(K.default)(n,function(e){return e.text+"\n"}).join(""),b=s.alltext.substring(g,v),E=s.alines.slice(e,e+t).join(""),k=r.join("|1+1")+"|1+1",C=a(b,y,E,k,h,p),I=C[0],S=C[1],T=b.substring(I,b.length-S),O=y.substring(I,y.length-S),w=g+I,R=v-S,x=!1;"\n"===T.charAt(T.length-1)&&"\n"===O.charAt(O.length-1)&&(T=T.slice(0,-1),O=O.slice(0,-1),R--,S++),0===T.length&&w===s.alltext.length&&0<O.length&&(w--,R--,O="\n"+O.slice(0,-1),x=!0),R===s.alltext.length&&0<T.length&&0===O.length&&"\n"===s.alltext.charAt(w-1)&&(w--,R--);var M=function(e,t){for(var n=re.changesetHelper.opIterator(e),r=0,i=I,o=y.length-S-(x?1:0);n.hasNext();){var a=n.next(),s=r+a.chars;s<=i||o<=r||t(Math.max(i,r),Math.min(o,s),a.attribs),r=s}};if(0===T.length&&0===O.length)return{zonesChangesets:c};var N,_,L,D,B,P,F,j,z=s.alltext.length,H=s.lines.indexOfOffset(w),U=s.lines.offsetOfIndex(H),V=function(e){var t=re.changesetHelper.builder(z,"Z",e);return t.keep(U,H),t.keep(w-U),t};return{cs:O===T?(N=Mi(function(e){return re.changesetHelper.mapAttribNumbers(e,function(e){var t=s.apool.getAttribKey(e);return!!Xi(t)&&s.apool.putAttrib([t,""])})}),_=V(o),x&&_.keep(1,1),M(E,function(e,t,n){_.keepText(y.substring(e,t),N(n))}),L=_.toString(),D=V(o),x&&D.keep(1,1),M(k,function(e,t,n){D.keepText(y.substring(e,t),n)}),c[o]=D.toUnpacked(),B=re.changesetHelper._pack(c),re.changesetHelper.compose(L,B,s.apool)):(P=V(o),F=s.lines.indexOfOffset(R),j=s.lines.offsetOfIndex(F),w<j?(P.remove(j-w,F-H),P.remove(R-j)):P.remove(R-w),x&&P.insert("\n",""),M(k,function(e,t,n){P.insert(y.substring(e,t),n)}),c[o]=P.toUnpacked(),re.changesetHelper._pack(c)),zonesChangesets:c}},this.doRepLineSplice=function(e,t,n,r){var i=re.getCurrentCallStack();Object(B.a)(r,function(e){e.width=e.text.length+1});var o=re.getRep(e),a=o.lines.offsetOfIndex(t),s=o.lines.offsetOfIndex(t+n);if(i.repChanged=!0,n!==r.length)i.docTextChanged=!0;else for(var l=o.lines.atIndex(t),c=0;c<n;c++){if(!l||r[c].text!==l.text){i.docTextChanged=!0;break}l=o.lines.next(l)}o.lines.splice(t,n,r),i.docTextChanged=!0,i.repChanged=!0;var u=Object(K.default)(r,function(e){return e.text+"\n"}).join(""),d=o.alltext;o.alltext=d.substring(0,a)+u+d.substring(s,d.length)},this.createDomLineEntry=function(e,t,n){void 0===n&&(n={});var r=re.doCreateDomLine(0<e.length);r.lineString=e,t&&(r.zone=t);var i=new ma({editor:re,zone:t,info:r,root:t===sr?re.docbody:void 0,uniqueId:n.uniqueId});return i.mounted=Boolean(n.mounted),i.isActive=Boolean(n.isActive),i},this.getTextAndAttrsOnSelection=function(e){return Pr(re,e)},this.getAttributesOnSelection=function(e,t,n){var r=re.getRep(e),i=t||r;return r.attributeManager.getAttributesOnSelection(i.selStart,i.selEnd,r,n)},this.toggleAttributeOnSelection=function(t,e,n,r,i){void 0===n&&(n="true"),void 0===r&&(r="IGNORE_");var o=i===lr?lr+"-"+t:t,a={bold:!0,italic:!0,underline:!0,strikethrough:!0},f=re.getRep(),s=e||f;if(s.selStart&&s.selEnd){if(re.selection.isCaret(s)&&document.execCommand&&a[o]){he()("[data-key="+o+"]").find("button").toggleClass("active");var l=f.attributeManager.checkAttributeOnPosition(s.selStart[0],s.selStart[1],o,n);return document.execCommand(o,!1,n),l}var h=!0,c=re.changesetHelper.makeAttribsString("+",[[o,n]],f.apool),u=new RegExp(c.replace(/\*/g,"\\*")+"(\\*|$)"),d=_d(s,re.domToRep,r+o.replace(/-/g,"_").toUpperCase());return d.forEach(function(e){if(h){var t=e.selStart[0];f.lines.isEndOfLine(e.selStart[0],e.selStart[1])&&(t=e.selStart[0]+1,e.selStart=[t,f.lines.atIndex(t).lineMarker]);for(var n=e.selEnd[0],r=t;r<=n;r++){var i=re.changesetHelper.opIterator(f.alines[r]),o=0,a=f.lines.atIndex(r),s=a.lineMarker,l=a.text.length;for(r===t&&e.selStart[1]>s&&(s=e.selStart[1]),r===n&&e.selEnd[1]<l&&(l=e.selEnd[1]);i.hasNext();){var c=i.next(),u=o,d=u+c.chars;if(!p(c.attribs)&&!(d<=s||l<=u)){h=!1;break}o=d}if(!h)break}}}),d.forEach(function(e){f.attributeManager.setAttributesOnRange(e.selStart,e.selEnd,[[t,h?"":n]],i)}),h}function p(e){return u.test(e)}},this.isRangesHaveAttributeApplied=function(e,t,n,r,i){return void 0===n&&(n="true"),e.every(function(e){return re.allHasAttributeOnSelection(e.zoneId,t,n,e,r,i)})},this.getMatchedAttributeOnSelection=function(o,e,t,a){var s=[];return re.processMatchedAttributeOnSelection(o,e,t,function(e,t,n,r,i){!Object(T.default)(a)&&a!==r||s.push({selZone:o,selStart:e,selEnd:t,attributeName:n,attributeValue:r})}),s},this.removeMatchedAttributeOnSelection=function(e,t,n){re.processMatchedAttributeOnSelection(e,t,n,function(e,t,n,r,i){i.attributeManager.setAttributesOnRange(e,t,[[n,""]])})},this.findMatchedAttributePositionOnSelectionRecurrsive=function(d,e,o,f,h){var p=f.matchedAttrs,g=f.matchedZoneContainerAttrs,v=h.shouldMerge,m=sr;e&&e.selZone&&(m=e.selZone);var a=re.getRep(m);if(a)for(var y=e.selStart[0],b=e.selStart[1],E=e.selEnd[0],k=e.selEnd[1],C=0,t=function(e,t){var n=a.alines[e];if(e<y||E<e)return C+=a.alinesWidth[e],"continue";if(n.match(o))for(var c=e,u=0,r=re.changesetHelper.opIterator(n),i=function(){var s=r.next(),l=u+s.chars;if(C+=s.chars,e===y){if(l<=b)return u=l,"continue";u<b&&(u=b)}if(e===E){if(k<=u)return"continue";k<l&&(l=k)}re.changesetHelper.eachAttribNumber(s.attribs,function(a){p.forEach(function(e){if(a===e.attrNum){for(var t={selStart:[c,u],selEnd:[c,l],selZone:m,chars:C},n=d.length-1,r=d[n],i=!1;r;)var o=r.docPosition,r=o.chars+s.chars===C?r.attrNum===a&&v?(o.selEnd=[c,l],i=!0,null):d[--n]:null;i||d.push({attrNum:e.attrNum,attrKey:e.attrKey,attrValue:e.attrValue,docPosition:t})}});var e=g.find(function(e){return e.attrNum===a});e&&e.zoneIds.forEach(function(e){re.findMatchedAttributePositionOnSelectionRecurrsive(d,{selStart:[0,0],selEnd:[1/0,1/0],selZone:e},o,f,h)})}),u=l};r.hasNext();)i();else C+=a.alinesWidth[e]},n=0,r=a.alines.length;n<r;n++)t(n)},this.getMatchedAttributePositionOnSelection=function(e,t,n){void 0===n&&(n={shouldMerge:!0});var a=re.getApool();e=e||{selStart:[0,0],selEnd:[1/0,1/0],selZone:sr};var r=[],s=[],l=[],c=[];if(Object.keys(a.numToAttrib).forEach(function(e){var n=Number(e),r=a.getAttribKey(n),i=a.getAttribValue(n),o=!1;t(r,i)&&(s.push({attrNum:n,attrKey:r,attrValue:i}),o=!0),re.managers.zoneWithMatchAttr.forEach(function(e){var t=e.zoneIds;(0,e.lineMatcher)(r,i)&&(l.push({attrNum:n,attrKey:r,attrValue:i,zoneIds:t}),o=!0)}),o&&c.push(Object(F.numToString)(n))}),0===s.length)return r;var i=new RegExp("\\*("+c.join("|")+")[+\\*|]");return re.findMatchedAttributePositionOnSelectionRecurrsive(r,e,i,{matchedAttrs:s,matchedZoneContainerAttrs:l},n),r},this.allHasAttributeOnSelection=function(e,t,i,n,o,a){for(var s=re.changesetHelper,l=re.getRep(e),r=n||l,c=!0,u=function(){var e=[[t,i||"true"]];Array.isArray(o)&&(e=e.concat(o)),Array.isArray(a)&&(e=e.concat(a));var n="";e&&e.forEach(function(e){var t;e[1]||!1===e[1]?(t=s.makeAttribsString("+",[e],l.apool),n+=t.replace(/\*/g,"\\*")+"(\\*|$)|"):n+=e[0]+"|"}),n=n.substr(0,n.length-1);var r=new RegExp(n);return function(e){var t=s.parseAttributesFromOpAttribs(e,l.apool);return r.test(e)||t.some(function(e){return r.test(e[0])})}}(),d=re.selection.getRealFirstLine(l.zoneId,r),f=re.selection.getRealEndLine(l.zoneId,r),h=d;h<=f;h++){var p=s.opIterator(l.alines[h]),g=0;if(!re.isIgnoreThisAttributeOnLine(e,h,t)){var v=0;r.attributeManager.lineHasMarker(h)&&(v=1);for(var m=r.lines.atIndex(h).text.length;p.hasNext();){var y=p.next(),b=g,E=b+y.chars;if(r.attributeManager.isLineAttribs(t)){if(c=!1,u(y.attribs)){c=!0;break}}else if(!u(y.attribs)&&v<E&&b<m){c=!1;break}g=E}if(!c)break}}return c},this.removeAttributeOnLine=function(e,t,n){re.getRep(e).attributeManager.removeAttributeOnLine(t,n)},this.incorpUserChanges=function(e){try{re.incorpInfo.push("start"),re.dirtyChecker.observer.withoutRecordingMutations(function(){re._incorpUserChanges(e)})}catch(e){throw re.call("error",{from:"etherpad",message:e.message,e:e}),e}},this._incorpUserChanges=function(e){var t,n,r,i,o,a,s=window.getSelection(),l=s&&s.focusNode,c=re.getCurrentCallStack();if(re.props.inEmbed&&re.props.inEmbed(re,l)){var u=c&&c.type;if(re.incorpInfo.push("inEmbed"),!u)return!1;if(re.incorpInfo.push("type:"+u),c.domClean=!0,"focus-sheet"!==u&&"applyChangesToBase"!==u)return!1;var d=re.dirtyChecker.observer.hasAnyDirtyRanges();if(re.incorpInfo.push("hasDirtyInfo:"+d),!d)return!1}var f,h,p,g,v=re.dirtyChecker.observer,m=re.dirtyChecker;if(re.incorpInfo.push("clean:"+c.domClean),c.domClean)return!1;c.isUserChange=!0;var y,b=re.getRep(),E={};if(re.isEditable()){var k=void 0,C=void 0,I=[],S=v.getDirtyRangesByZone(),T=function(t){var n;re.enableUnmountNode&&re.isSelectingAll&&(n=re.getRep(t),S[t].forEach(function(e){e.start=0,e.numDeleted=n.lines.length(),e.nodes=[re.blockRender.getElementInDocumentForLine(t,0)]})),I=I.concat(m.getDirtyDetailInfo(t,S[t]))};try{for(var O=ge(Object.keys(S)),w=O.next();!w.done;w=O.next())T(w.value)}catch(e){t={error:e}}finally{try{w&&!w.done&&(n=O.return)&&n.call(O)}finally{if(t)throw t.error}}var R=m.incorpDisposalInfo(S),x=0<(I=I.filter(function(e){return!(e.zone in R.deletedZones)})).length,M=[];I.forEach(function(e){return M.push([e.start,e.end])}),f=re.selection.internalGetSelectionPoints();for(var N=0,_=0,L=[],D={};N<I.length;){0!==N&&I[N].zone!==I[N-1].zone&&(_=0);var B,P=I[N],F=P.zone,j=re.dom.rootNodeOfZone(F),b=re.getReps()[F],k=P.start,C=P.end,z=(z=0===k&&j.firstChild||(re.enableUnmountNode?null===(r=re.blockRender.getElementInDocumentForLine(F,k-1))||void 0===r?void 0:r.nextSibling:(null===(i=b.lines.atIndex(k-1))||void 0===i?void 0:i.lineNode).nextSibling))&&re.dirtyChecker.observer.isNodeDirty(z)&&z,H=null;if(H=(H=re.enableUnmountNode?(re.isSelectingAll?H=z:C===b.lines.length()&&(H=j.lastChild),H||(null===(o=re.blockRender.getElementInDocumentForLine(F,C))||void 0===o?void 0:o.previousSibling)):C===b.lines.length()&&j.lastChild||(null===(a=b.lines.atIndex(C))||void 0===a?void 0:a.lineNode).previousSibling)&&re.dirtyChecker.observer.isNodeDirty(H)&&H,z&&H){var U=Du({collectStyles:!0,abrowser:Ce,apool:re.repManager.apool,className2Author:zi,hooks:re.hooks,tagsIgnoreToParse:re.tagsIgnoreToParse,editor:re,formatterRenderer:re.formatterManager});U.notifySelection(f);for(var V=z;V&&(!V.previousSibling||V.previousSibling!==H);V=V.nextSibling)U.collectContent(V),D[P.zone]||(D[P.zone]=[]),D[P.zone].push(V);U.notifyNextNode(H.nextSibling);var W,K=U.getLines();(K.length<=1||""!==K[K.length-1])&&H.nextSibling&&(C++,W=H.nextSibling,U.collectContent(W),U.notifyNextNode(W.nextSibling));var Z=U.finish(),q=(K=Z.lines).length,J=re.fixInvalidCCSelection(Z.selStart,Z.selEnd,Z.lines),Y=J.selStart,Q=J.selEnd;0<=Y[0]&&(h=[Y[0]+k+_,Y[1]]),0<=Q[0]&&(p=[Q[0]+k+_,Q[1]]);var X={};h&&(X.selStart=h),p&&(X.selEnd=p),void 0===E.firstDirtyLineNum&&(E.firstDirtyLineNum=k,E.newDomLen=q);var $=re.getChangesetFromCCData({ccData:Z,startLine:k,deleteCount:C-k,zoneId:P.zone,hint:X});$&&L.push({zoneId:P.zone,changeset:$}),_+=q-(C-k)}else k<C&&(re.log("case dirty Range is clean, and end big then start"),re.log("netNumLinesChangeSoFar",_),re.log("dirtyZones.length",I.length),(B=re.getChangesetFromCCData({ccData:{lines:[],lineAttribs:[]},startLine:k,deleteCount:C-k,zoneId:P.zone}))&&L.push({zoneId:P.zone,changeset:B}));N++,h&&h.push(P.zone),p&&p.push(P.zone)}v.flush(),g=0<L.length;var ee=re.mergeMultiZoneChangesets(L);ee&&re.performDocumentApplyChangeset(ee),Object.keys(D).forEach(function(e){var r=re.getRep(e);D[e].forEach(function(e){var t,n=r.lines.atKey(e.id);e.id&&n&&e===n.lineNode||null!==(t=e.parentNode)&&void 0!==t&&t.removeChild(e),e===(null===n||void 0===n?void 0:n.lineNode)&&re.dirtyChecker.markNodeClean(e,n)})})}else f=re.selection.internalGetSelectionPoints();h&&p?(re.selection.setWithSelection(h[2],[h[0],h[1]],[p[0],p[1]]),((y=window.getSelection())&&y.focusNode)!==l&&re.selection.updateBrowserSelectionFromRep()):f&&(Dom.contains(re.docbody,f.startPoint&&f.startPoint.node)&&Dom.contains(re.docbody,f.endPoint&&f.endPoint.node)||(f=re.selection.internalGetSelectionPoints(),Ue("incorp dev: selection not in docbody")),re.selection.internalUpdateRepFromSelection(f,h?new Vo(h[2],h[0],h[1]):null,p?new Vo(p[2],p[0],p[1]):null)),f&&(g||re.selection.isCaret())&&(c.selectionAffected=!0),c.domClean=!0,x&&!c.editEvent.currentChangeset&&re.call(yr),re.fixViewTimeout=window.setTimeout(function(){ba(re)},0);var te=E.firstDirtyLineNum,ne=E.newDomLen;return void 0!==te&&0<=te&&re.doFixNewInsertNodeListError(te,ne),g},this.fixInvalidCCSelection=function(e,t,n){var r=n.length,i=e.slice(),o=t.slice();return 0===r||(i[0]>r-1&&(i[0]=r-1,i[1]=n[r-1].length),o[0]>r-1&&(o[0]=r-1,o[1]=n[r-1].length)),{selStart:i,selEnd:o}},this.isClientSideAttribs=function(e){var t=!1;return re.changesetHelper.filterAttribNumbers(e,function(e){0===re.repManager.apool.getAttrib(e)[0].indexOf(lr)&&(t=!0)}),t},this.getAllAttributesOnLine=function(e,t){return re.getRep(e).attributeManager.getAllAttributesOnLine(t)},this.setAttributeOnLine=function(e,t,n,r,i){var o=re.getRep(e);-1<re.getLineListType(o.zoneId,t).indexOf("code")&&["lang","code"].indexOf(n)<0&&re.setLineListType(o.zoneId,t,""),re.isIgnoreThisAttributeOnLine(o.zoneId,t,n)||o.attributeManager.setAttributeOnLine(t,n,r,i)},this.getAttributesOnPosition=function(e,t,n){return re.getRep(e).attributeManager.getAttributesOnPosition(t,n)},this.setAttributesOnLineExcludeAttrs=function(e,t,n,r,i){void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=!1);var o=re.getAllAttributesOnLine(e,t);if(0===r.length||0===o.length)return re.setAttributesOnLine(e,t,n),!0;var a=i?N.default:function(e,t){return e[0]===t[0]};return!(0<Object(k.a)(r,o,a).length)&&(re.setAttributesOnLine(e,t,n),!0)},this.setLineListType=function(e,t,n,r,i){var o,a,s,l,c="list",u=re.repManager.reps[e],d=[],f=re.setAttributesOnLineExcludeAttrs,h=re.renumberList;""===n?(s=!1,l=u.attributeManager.findAttributeOnLine(t,"ol-id"),re.formatterManager&&re.formatterManager.formatterMap.list?(o=re.formatterManager.formatterMap.list.plugin.constructor.relativeAttrKeys,u.attributeManager.removeAttributesOnLine(t,o.concat(c))):(a=[c,"start","origin-start","lang","ol-id","todo_uuid"],u.attributeManager.removeAttributesOnLine(t,a))):(d.push([c,n]),-1<n.indexOf("number")&&(l=r||re.getClosetListNumberId(e,n,u)||An())&&d.push(["ol-id",l]),i&&d.push.apply(d,me(i)),f(e,t,d,[["horizontal-line","true"],["sheet-id",""],["aceTable",""],["zoneType",""]])),h(e,t,l,s)},this.setLineListTypeWithStart=function(e,t,n,r,i,o){var a,s="list",l=re.repManager.reps[e],c=o||re.getClosetListNumberId(e,n,l);r?(n?i?l.attributeManager.setAttributesOnLine(t,[[s,n],["start",r],["origin-start",r],["ol-id",c]]):l.attributeManager.setAttributesOnLine(t,[[s,n],["start",r],["ol-id",c]]):(c=l.attributeManager.findAttributeOnLine(t,"ol-id"),a=!1,re.setLineListType(e,t,"")),re.renumberList(e,t,c,a)):re.setLineListType(e,t,n,c)},this.setMultiLinesListType=function(n,r,e,t){var i,o,a,s,l;r.length&&(i="list",o=re.repManager.reps[n],a=re.renumberList,l=new Map,r.forEach(function(e){var t=o.attributeManager.findAttributeOnLine(e,"ol-id");!l.has(t)&&t&&l.set(t,!0)}),""===e?re.formatterManager&&re.formatterManager.formatterMap.list?re.formatterManager.formatterMap.list.plugin.constructor.relativeAttrKeys.concat("list").forEach(function(e){o.attributeManager.removeAttributeOnMultiLines(r,e)}):(o.attributeManager.removeAttributeOnMultiLines(r,i),o.attributeManager.removeAttributeOnMultiLines(r,"start"),o.attributeManager.removeAttributeOnMultiLines(r,"origin-start"),o.attributeManager.removeAttributeOnMultiLines(r,"lang"),o.attributeManager.removeAttributeOnMultiLines(r,"ol-id")):(r=r.filter(function(e){return re.canSetAttributesOnLineExcludeAttrs(n,e,[["horizontal-line","true"],["sheet-id",""],["aceTable",""]])}),-1<e.indexOf("number")?(s=t||re.getClosetListNumberId(n,e,o)||An(),o.attributeManager.setAttributeOnMultiLines(r,"ol-id",s)):o.attributeManager.removeAttributeOnMultiLines(r,"ol-id"),o.attributeManager.setAttributeOnMultiLines(r,i,e)),l.forEach(function(e,t){a(n,r[0],t)}),a(n,r[0],s))},this.canSetAttributesOnLineExcludeAttrs=function(e,t,n,r){void 0===n&&(n=[]),void 0===r&&(r=!1);var i=re.getAllAttributesOnLine(e,t),o=r?N.default:function(e,t){return e[0]===t[0]};return!(0<Object(k.a)(n,i,o).length)},this.doFixNewInsertNodeListError=function(e,t){for(var n=re.getLineListType,r=re.renumberList,i=(0,re.getRep)(),o="",a="",s=0;s<t;++s){var l,c=e+s,u=n(i.zoneId,c),d=-1<u.indexOf("number"),f=-1<u.indexOf("code"),h=d&&i.attributeManager.findAttributeOnLine(c,"ol-id");d&&h!==o&&((l=""===h?o:"")?r(i.zoneId,c,l,!0):r(i.zoneId,c));var p=-1<a.indexOf("code");f&&!p&&r(i.zoneId,c),a=u,o=h}},this.unNumberType=function(e){return"indent"===e||"bullet"===e||"check"===e||"done"===e},this.findLastListLine=function(e,t){for(var n=re.getLineListType,r=re.repManager.reps[e],i=t,o="";0<=i-1;){if(!(o=n(e,i-1)))return null;if("bullet"===(o=/([a-z]+)([0-9]+)/.exec(o))[1]||"number"===o[1]||"check"===o[1]||"done"===o[1])return{line:--i,type:"done"===o[1]?{0:"check"+o[2],1:"check",2:o[2]}:o,start:"number"===o[1]?parseInt(r.attributeManager.getAttributeOnLine(i,"start"),10)||1:null};i--}return null},this.compatibleList=function(e,t,n,r,i){var o=/([a-z]+)([0-9]+)/,a=re.getLineListType,s=re.unNumberType,l=re.repManager.reps[e],c=a(e,t);if(!c)return null;var u=o.exec(c);return"code"===n?s(u[1])||n!==u[1]?null:("up"===r?i.unshift(t):"down"===r&&i.push(t),!0):"oldNumber"!==n||"number"!==u[1]||l.attributeManager.findAttributeOnLine(t,"ol-id")?null:("up"===r?i.unshift(t):"down"===r&&i.push(t),!0)},this.getContentEndSelection=function(){var e=re.getRep(),t=[e.alines.length-1,e.alinesWidth[e.alines.length-1]];return{selStart:t,selEnd:t}},this.clickDocBody=function(e,t){var n;t&&e.target===t&&(t.focus(),n=re.getContentEndSelection(),re.inCallStackIfNecessary("focusEnd",function(){re.performSelectionChange("0",n.selStart,n.selEnd),re.updateBrowserSelectionFromRep(!0)}))},this.findClosetList=function(e,t,n){for(var r=t,i="up",o=re.repManager,a=re.getLineListType,s=o.reps[e].lines.length(),l=[],c=a(e,t);0<=r-1&&re.compatibleList(e,r-1,n,i,l);)r--;for(r=t,c&&n&&l.push(r),i="down";r+1<=s&&re.compatibleList(e,r+1,n,i,l);)r++;return l},this.renumberList=function(n,r,e,t){var i=/([a-z]+)([0-9]+)/;Nf.collectEvent&&Nf.collectEvent("dev_renumber_list",{zone:n,lineNum:r,listNumberId:e,isAdd:t});var o=re.repManager,a=re.getLineListType,s=re.unNumberType,l=re.performDocumentApplyChangeset,c=o.reps[n],u=[],d=!1===t,f="",h=a(n,r),p=!!e;if(!h&&!p)return null;var g=i.exec(h);if(!g&&p&&(g=i.exec("number1")),s(g[1])&&!d)return null;var v=c.attributeManager.findAttributeOnLine(r,"ol-id"),m=e||v,y=[];"code"===g[1]?f="code":"number"!==g[1]||d||(f="oldNumber"),""!==f&&(y=re.findClosetList(n,r,f)),0!==y.length&&"oldNumber"===f&&(y=y.map(function(e){if(e===r)return v===m?null:e;var t=re.listCache.get(n,e);return t&&t.listId===m?null:e}).filter(function(e){return null!==e}).sort(function(e,t){return e-t}),c.attributeManager.setAttributeOnMultiLines(y,"ol-id",m)),t&&c.attributeManager.setAttributeOnLine(r,"ol-id",m),m&&re.listCache.getLines(n).forEach(function(e,t){e&&-1<e.listType.indexOf("number")&&e.listId===m&&u.push(t)});var b=[];0!==u.length?b=u:0!==y.length&&(b=y);var E=null,k="";return b.length&&(k=re.buildRenumberListChangeset(c,b,g,!!E)),k&&!re.changesetHelper.isIdentity(k)&&l(k),null},this.buildRenumberListChangeset=function(h,e,p,t){var g=-1,v=re.changesetHelper.builder(h.lines.totalWidth(),"Z",h.zoneId),m=[0,0],y=0;return function e(t,n,r){for(var i,o,a,s=t[y],l=g,c=re.getLineListType(h.zoneId,s);c;){c=/([a-z]+)([0-9]+)/.exec(c),a=Number(c[2]);var u=h.attributeManager.getAttributeOnLine(s,"text-indent"),d=h.attributeManager.getAttributeOnLine(s,"start");if(isNaN(a)||re.unNumberType(c[1])){if("code"===p[1]||a<n)return s;y++}else if(a===n){l===g&&(i=h.attributeManager.getAttributeOnLine(s,"origin-start"),o=h.attributeManager.getAttributeOnLine(s,"start"),l=r?o:i||1);var f=[["start",l]];if(l!==i&&i&&f.push(["origin-start",""]),Number(l)!==Number(d)&&(u&&f.push(["text-indent",""]),re.changesetHelper.buildKeepRange(h,v,m,m=[s,0]),re.changesetHelper.buildKeepRange(h,v,m,m=[s,1],f,h.apool)),l=+l+1,s=t[++y],y===t.length)return t[y]}else{if(a<n)return s;s=e(t,n+1,r)}c=re.getLineListType(h.zoneId,t[y])}return s}(e,1,t),v.toString()},this.replaceVectorRange=function(e,t,n,r,i){re.inCallStackIfNecessary("replaceVectorRange",function(){re.performDocumentReplaceVectorRange(e,t,n,r,i)})},this.performDocumentReplaceRangeWithAttributes=function(e,t,n,r,i,o){void 0===i&&(i=[]),void 0===o&&(o=!1);var a=re.repManager,s=re.managers,l=re.changesetUnpackedVectorsZoneClear,c=re.isRepInOfLine,u=re.performDocumentApplyChangeset,d=re.getRep(e);void 0===t&&(t=d.selStart),void 0===n&&(n=d.selEnd);var f={},h=d.zoneId,p=new Vo(h,t[0],t[1]),g=new Vo(h,n[0],n[1]),v=-1<r.indexOf("\n"),m=c(t,n,d),y=s.getChildZonesInRangeRecursive(p,g);y.text.forEach(function(e){var t,n;re.selection.get().hasSelection&&e===re.selection.getStart().zone&&re.selection.set(p),"\n"!==a.reps[e].alltext&&(t=re.changesetHelper.builder(a.reps[e].lines.totalWidth()),n=Vo.endOfZone(re,e),re.changesetHelper.buildRemoveRange(a.reps[e],t,[0,0],[n.line,n.col]),f[e]=t.toUnpacked())}),y.rows.forEach(function(e){f[e]=l(!0,e)}),y.cols.forEach(function(e){f[e]=l(!1,e)});var b,E,k,C=re.changesetHelper.builder(d.lines.totalWidth(),"Z",d.zoneId);re.changesetHelper.buildKeepToStartOfRange(d,C,t),re.changesetHelper.buildRemoveRange(d,C,t,n),r instanceof Array?r.forEach(function(e){"\n"===e?C.insert(e,[],a.apool):C.insert(e,i,a.apool)}):"string"==typeof r&&((b=r.endsWith("\n")?r.split("\n").slice(0,-1):r.split("\n")).forEach(function(e,t){var n;0===t?(n=v?e+"\n":e,C.insert(n,i,a.apool)):t!==b.length-1||r.endsWith("\n")?(C.insert(e,i.concat([["lineguid",qi()]]),a.apool),C.insert("\n",i,a.apool)):C.insert(e,i.concat([["lineguid",qi()]]),a.apool)}),v&&m&&t&&n&&(E=re.selection.flatten(me(n,[e])),0<(k=d.lines.offsetOfIndex(n[0]+1))-E-1&&C.keep(k-E-1,0,[["lineguid",qi()]],a.apool))),f[h]=C.toUnpacked(),u(re.changesetHelper._pack(f),o)},this.performSelectionChange=function(e,t,n,r){var i=new Vo(e,t[0],t[1]),o=new Vo(e,n[0],n[1]),a=new qo({start:i,end:o,isReversed:r});re.selection.set(a)},this.performDocumentReplaceCharRange=function(e,t,n,r){var i,o=re.repManager,a=re.performDocumentReplaceRange;t===n&&0===r.length||(n===(i=o.reps[e]).alltext.length&&(t===n?(t--,n--,r="\n"+r.substring(0,r.length-1)):0===r.length?(t--,n--):(n--,r=r.substring(0,r.length-1))),a(i.zoneId,re.selection.lineAndColumnFromChar(i.zoneId,t),re.selection.lineAndColumnFromChar(i.zoneId,n),r))},this.performDocumentApplyAttributesToRange=function(e,t,n,r){return re.getRep().attributeManager.setAttributesOnRange(e,t,n,r)},this.performDocumentReplaceSelection=function(e,t){var n=re.repManager,r=re.performDocumentReplaceRange,i=n.reps[e];i.selStart&&i.selEnd&&r(i.zoneId,i.selStart,i.selEnd,t)},this.performDocumentReplaceRange=function(e,t,n,r,i){(0,re.performDocumentReplaceRangeWithAttributes)(e,t,n,r,[],i)},this.performDocumentReplaceMultiRangeWithAttributes=function(e,t){if(!Array.isArray(t)||!t.length)return!1;var n,r=re.repManager,i=re.performDocumentApplyChangeset,o=r.reps[e],a=re.changesetHelper.builder(o.lines.totalWidth(),"Z",o.zoneId),s=re.isRepInOfLine(o.selStart,o.selEnd,o),l=[0,0],c=!1;t.forEach(function(e){re.changesetHelper.buildKeepRange(o,a,l,e.start),re.changesetHelper.buildRemoveRange(o,a,e.start,l=e.end),a.insert(e.newText,e.attributes,r.apool),c=c||-1<e.newText.indexOf("\n")}),i(a.toString()),c&&s&&o.selStart&&(n=o.selStart[0],re.updateLineGuid(n))},this.performDocumentApplyChangeset=function(e,t,n,r,i,o){re.dirtyChecker.observer.withoutRecordingMutations(function(){re._performDocumentApplyChangeset(e,t,n,r,i,o)})},this._performDocumentApplyChangeset=function(e,i,t,n,c,r){!1!==re.isPerforming&&console.log("editor debug: _performDocumentApplyChangeset in _performDocumentApplyChangeset"),re.isPerforming=!0;try{var o={cs:e,isRemote:c,editor:re};re.call("editorWillPerformChangeset",{cs:e,isRemote:c}),re.hooks.callAll("editorWillPerformChangeset",o),e=o.cs}catch(e){console.error("editorWillPerformChangeset failed",e)}var a,s,u,l=re.doRepApplyChangeset,d=re.repManager,f=re.domAndRepSplice,h=re.domAndRepVectorsSplice,p=re.getAttributesOnSelection,g=re.getCurrentCallStack,v=re,m=re.changesetHelper.formatCs(e),y=re.plugins.sync&&re.plugins.sync.getMemberId()===t||!t;void 0!==c&&c===y&&(re.log("getMemberId:",re.plugins.sync&&re.plugins.sync.getMemberId()),re.log("memberId:",t),console.log("editor debug: wrong isSelfMessage")),v.dirtyChecker.observer.safeHasDirtyRanges()&&(re.log("composition status",re.getInInternationalComposition()),a=re.dirtyChecker.observer.getDirtyInfoAsString(),re.log("dirtyranges",a),"{}"!==a?(s=new Error,re.log(s.stack),console.log("editor debug: dirtyRanges not empty performDocumentApplyChangeset with dirty dom")):console.log("editor debug: performDocumentApplyChangeset with dirty dom")),re.call(mr,{cs:e,applyingNonUserchanges:c}),l(e,i,n,c);var b,E=null,k=[],C=[];re.changesetHelper.mutateTextLines(e,function(s,l){(c&&s===re.getRep().zoneId&&0!==m[s].newLen||s===re.getRep().zoneId)&&(b=s),b=b||s;var e,t,n,r=d.reps[s];return u=r||u,r&&r.selStart&&r.selEnd&&b===s&&(e=r.lines.offsetOfIndex(r.selStart[0])+r.selStart[1],t=r.lines.offsetOfIndex(r.selEnd[0])+r.selEnd[1],n=re.changesetHelper.characterRangeFollow(m[s],e,t,i),E=[n[0],n[1],r.selFocusAtStart]),"Z"===l?{splice:function(e){var t=e[0],n=e[1];e=Array.prototype.slice.call(e,2),f(s,t,n,Object(K.default)(e,function(e){return e.slice(0,-1)}),k,!!c)},get:function(e){var t=d.reps[s];return e>=t.lines.getNumNodes()?t.alltext.split("\n")[e]+"\n":t.lines.atIndex(e).text+"\n"},length:function(){return d.reps[s].lines.length()}}:{splice:function(e){var t=e[0],n=e[1];e=Array.prototype.slice.call(e,2);var r=h(s,"R"===l,t,n,Object(_.a)(e),!!c),i=r.deletedZones,o=r.insertedZones;k=k.concat(i),C=C.concat(o);var a=Object(ee.a)(C,function(e){return e});k=k.filter(function(e){return!(e in a)})},get:function(e){return v.getVectorsRep(s,"R"===l).vectorIds[e]},length:function(){return v.getVectorsRep(s,"R"===l).vectorIds.length}}},d.apool);var I=g();if(I.isCollabChangedSelection=i,E){var S=re.selection.lineAndColumnFromChar(b,E[0]),T=re.selection.lineAndColumnFromChar(b,E[1]),O=new Vo(b,S[0],S[1]),w=new Vo(b,T[0],T[1]),R=new qo({start:O,end:w,isReversed:re.selection.get().isReversed});try{re.selection.set(R)}catch(e){re.log("selection",R&&R.toString()),re.log(e.stack),re.selection.setWithSelection(b,[0,0],[0,0]),Ue("[EDITOR:SETSELECTION] setSelection error",e.message)}}k.forEach(function(e){re.managers.unregisterZone(e)});var x=re.selection.currentSelection.start?re.selection.getZone():"0";re.hooks.callAll("changesetApply",{changeset:e,author:"",memberId:t,callstack:I,editor:re,attribs:p(x,re.selection.getRealSelection(x,u)),isRemote:c,extra:r}),/Z:[a-z0-9]+(>)0\$/.test(I.editEvent.currentChangeset)||re.editorDidUpdate();try{re.call("editorDidPerformChangeset",{cs:e})}catch(e){console.error("editorDidPerformChangeset failed",e)}re.updateActivationTimer||(re.updateActivationTimer=setTimeout(function(){re.updateActivationTimer=null,re.enableUnmountNode?re.preRenderer.ensureScreenNoScroll([],function(){re.blockRender.updateActivation({centerLine:re.blockRender.getViewportCenterLine(),forceRender:!0,forceUpdatePlaceholder:!0})}):re.blockRender.updateActivation({centerLine:re.blockRender.getViewportCenterLine(),forceRender:!0,forceUpdatePlaceholder:!0})})),re.isPerforming=!1},this.domAndRepSplice=function(t,e,n,r,i,o){var a=re.enableUnmountNode,s=re.repManager.reps[t],l=t===sr,c=l?e:re.getLineNumInRootZone(t,e),u=l?n:1,d=!!l||-1!==c&&re.blockRender.getLineStatus(sr,c).isRendered,f=re.blockRender.getActiveLineRanges(sr),h=s.selStart,p=s.selEnd;h&&p&&f.push([h[0],p[0]]);var g,v,m,y,b,E=d&&f.some(function(e){var t=ve(e,2),n=t[0];return!(t[1]<c||c+u<n)}),k=l||re.innerZoneEditorNodes[t],C=r.map(function(e){return re.createDomLineEntry(e,t,{isActive:E,mounted:E,isRendered:!0})}),I=Object(M.a)(e,e+n).map(function(e){return s.lines.atIndex(e)}),S=r.length;if(re.blockRender.updateLinesStatus(t,e,n,S,{isActive:E,isRendered:!0}),a||re.blockRender.updateActiveLines(t,e,n,S,E),a){var T,O=re.blockRender.getElementInDocumentForLine(t,e-1,!0),w=re.preRenderer;if(re.doRepLineSplice(t,e,n,C),l)E?(v=re.domSplice(t,O,C,I,e,o),w.spliceLines(e,n,C,t,!o)):(w.renderLines(e,n,C,t),re.hooks.callAll("linesWillReplace",{oldLineEntries:I,newLineEntries:C,isRemote:!!o,startLine:e,zoneId:t}),T=re.dom.rootNodeOfZone(t),I.forEach(function(e){var t=T.querySelector("#"+e.key);t&&t.parentElement&&t.parentElement.removeChild(t)}));else{var R=re.getRep(sr).lines.atIndex(c);if(E||-1===c)re.innerZoneEditorNodes[t]&&(v=re.domSplice(t,O,C,I,e,o),-1!==c&&w.spliceLines(c,1,[R],sr,!o));else{if(!R.domInfo)return;if(!re.innerZoneEditorNodes[t])return;w.getRootForZone(t)?(v=re.domSplice(t,O,C,I,e,o),w.spliceLines(e,n,C,t)):(v=re.domSplice(t,O,C,I,e,o),w.spliceLines(c,1,[R],sr))}}}else re.doRepLineSplice(t,e,n,C),(l||re.innerZoneEditorNodes[t])&&(g=re.dom.rootNodeOfZone(t),O=0===e?null:g.childNodes[e-1],v=re.domSplice(t,O,C,I,e,o));k&&E&&C.forEach(function(e){e.getAllInstances().forEach(function(e){e.enterBuffer&&e.enterBuffer()})}),k&&(m=re.getCurrentCallStack(),y=re.selection.getStart(),b=re.selection.getEnd(),(y&&y.line>=e&&y.line<=e+n||b&&b.line>=e&&b.line<=e+n)&&!v&&(m.selectionAffected=!0))},this.domAndRepVectorsSplice=function(e,t,n,r,i,o){var a,s,l,c,u,d=re.getVectorsRep,f=re.managers,h=re.repManager,p=d(e,t),g=f.getLineEntryContainingZone(e),v={},m=[],y=[];return g&&g.domInfo&&(Oo(g.domInfo.node)&&(s=g.domInfo.node.lineManager),l=g.domInfo.lineManagerData,y=nu(i,c=d(t?l.colsZoneId:l.rowsZoneId,!t).vectorIds,!t),m=nu(p.vectorIds.slice(n,n+r),c,!t),y.forEach(function(e){f.registerZoneForLine(e,g),v[e]=!0})),p.vectorIds=p.vectorIds.slice(0),(a=p.vectorIds).splice.apply(a,me([n,r],i)),g&&(s.setRep(l.rowsZoneId,l.colsZoneId,d(l.rowsZoneId,!0).vectorIds,d(l.colsZoneId,!1).vectorIds,re.changesetHelper.getAttributesPerCharacter(d(l.rowsZoneId,!0).alines[0],h.apool),re.changesetHelper.getAttributesPerCharacter(d(l.colsZoneId,!1).alines[0],h.apool),l.fullWidth),!re.enableUnmountNode||-1!==(u=re.getRep(sr).lines.indexOfEntry(g))&&re.preRenderer.spliceLines(u,1,[g],sr,!o)),{deletedZones:m=m.filter(function(e){return!(e in v)}),insertedZones:y}},this.getClientVars=function(){return re.clientVars},this.getBound=function(){return re.docbody.getBoundingClientRect()},this.getBoundAsync=function(e){re.getBoundAsyncTimeout=window.setTimeout(function(){e&&re.docbody&&e(re.docbody.getBoundingClientRect())},0)},this.isEditable=function(){return re.editable},this.isBlockElement=function(e){return!!re._blockElems[(Object(W.default)(e,"tagName")||"").toLowerCase()]},this.isContentEditable=function(){return re.getDocBody()&&"true"===re.getDocBody().getAttribute("contenteditable")},this.setContentEditableLock=function(e){re.contentEditableLock=!!e,e||re.dirtyChecker.observer.withoutRecordingMutations(function(){re.setContentEditable(re.contentEditableTemp)})},this.setContentEditable=function(e,t){re.contentEditableLock?re.contentEditableTemp=e:re.dirtyChecker.observer.withoutRecordingMutations(function(){re.isContentEditable()!==e&&re.getDocBody().setAttribute("contenteditable",e),e&&re.props.autoFocus&&re.focus(),re.hook.callAll("aceChangeContentediable")})},this.fastIncorp=function(e){void 0===e&&(e=!1),!re[Lf]||e?(re.incorpInfo=[],re.incorpUserChanges()):re.log("return in composition flag")},this.handleCompositionEvent=function(e){var t=re.fastIncorp,n=re.inCallStackIfNecessary,r=re.hook,i=e.type;he()(e.target).hasClass("ignore-collect")||(e.stopPropagation(),"compositionstart"===i?(re.log("composition start"),re[Lf]=!0,r.callAll("aceAfterCompositionStart")):"compositionend"===i&&(r.callAll("aceBeforeCompositionEnd"),re[Lf]=!1,n("handleCompositionEvent"+Math.floor(1e3*Math.random()),function(){t()},{shouldIncorp:!1}),window.setTimeout(function(){re.plugins.client&&re.plugins.client.handleUserChanges(!1,!0)},0),r.callAll("aceAfterCompositionEnd",{evt:e})),r.callAll("aceCompositionEvent",{evt:e,editor:re,rep:re.getRep()}),re.togglePlaceholderTimeout&&clearTimeout(re.togglePlaceholderTimeout),re.togglePlaceholderTimeout=window.setTimeout(function(){re.togglePlaceHolder()}))},this.getInInternationalComposition=function(){return re[Lf]},this._getTypeInAttribs=function(e,t,n){for(var r=e.length,i=0;i<r;++i)if(e[i][0]===t)return n||e[i][1];return""},this.caretLine=function(){return re.getRep().selStart[0]},this.caretColumn=function(){return re.getRep().selStart[1]},this.caretDocChar=function(){var e=re.caretColumn,t=re.caretLine;return(0,re.getRep)().lines.offsetOfIndex(t())+e()},this.setDocId=function(e){re.props.token=e},this.setIfNecessary=function(e,t,n){return!!e&&(String(e[t]).toLowerCase()!==n&&(e[t]=n,!0))},this.doDeleteKey=function(e){re.profile&&re.profile.start(Vf);var t,n,r,i,o=re.caretLine,a=re.caretColumn,s=re.performDocumentReplaceSelection,l=re.hook,c=re.getRep,u=re.renumberList,d=e||{},f=c(),h=o();re.call("doDeleteKey",d),l.callAll("aceDoDeleteKey",{editor:re,evt:d,rep:f,caretLine:o}),""===f.attributeManager.findAttributeOnLine(h,"lineguid")&&(t=qi(),i=(r=(n=f.lines.atIndex(h)).text).length-(n.lineMarker?sd(r):0),f.attributeManager.setAttributesOnRange([h,0],[h,i],[["lineguid",t]]),re.selection.updateBrowserSelectionFromRep(!0));var p=o(),g=a(),v=re.deleteNumberList(re);if(!re.selection.isCaret())return d.preventDefault(),s(f.zoneId,""),l.callAll("editorAfterDoDeleteKey",{editor:re,theLine:p,evt:d}),-1!==p&&v.forEach(function(e){"number"==typeof e&&null===u(f.zoneId,p+1)?u(f.zoneId,p):u(f.zoneId,p,e,!1)}),void(re.profile&&re.profile.end(Vf));var m=f.lines.atIndex(p),y=m.lineMarker,b=p-1,E=0<p&&f.lines.atIndex(b),k={editor:re,evt:d,lineMarker:y,lineEntry:m,theLine:p,col:g,prevLineEntry:E},C=l.callAll("editorDoDeleteKey",k);if(Object(te.a)(C,!0))return d.preventDefault(),l.callAll("editorAfterDoDeleteKey",{editor:re,theLine:p,evt:d}),-1!==p&&v.forEach(function(e){"number"==typeof e&&null===u(f.zoneId,p+1)?u(f.zoneId,p):u(f.zoneId,p,e,!1)}),void(re.profile&&re.profile.end(Vf));var I=0<m.lineMarker;a()<=m.lineMarker?(d.preventDefault(),re.firstRowDelete(f.zoneId,I,E,p,m)):re.normalDelete(m,d),-1!==p&&v.forEach(function(e){u(f.zoneId,p,e,!1)}),re.profile&&re.profile.end(Vf)},this.doCtrlKForMac=function(e){var t,n=re.getRep(),r=n.selEnd,i=n.zoneId,o=n.lines.atIndex(r[0]).lineNode;o&&!re.isSingleLine(o)&&(re.isCaret()?(t=n.alinesWidth[r[0]]-1,r[1]===t?re.handleDeleteKeyOnLineEnd():re.inCallStackIfNecessary("handleCtrlKDeleteToLineEnd",function(){re.performDocumentReplaceRange(i,r,[r[0],t],"")})):re.doDeleteKey(e))},this.firstRowDelete=function(e,t,n,r,i){var o=re.performDocumentReplaceRange;Eo(re.getDocBody(),!0),t&&n?o(e,[r-1,n.text.length],[r,i.lineMarker],""):0<r&&o(e,[r-1,n.text.length],[r,0],"")},this.handleAlignText=function(e,t,n,r){var i=re.getRep();"right"===e[1]?i.attributeManager.setAttributeOnLine(t,"align","center"):"center"===e[1]?i.attributeManager.removeAttributeOnLine(t,"align"):re.performDocumentReplaceRange(i.zoneId,[t-1,n.text.length],[t,r.lineMarker],"")},this.hasOtherAttribsOnLine=function(e,n){return e.find(function(e){var t=e[0];return"author"!==t&&"lmkr"!==t&&"insertorder"!==t&&t!==n})},this.normalDelete=function(e,t){var n=re.caretDocChar,r=t.metaKey,i=t.ctrlKey,o=t.altKey,a=t.which,s=n(),l=re.getRep(),c=re.performDocumentReplaceCharRange;if(0<s){var u,d,f,h,p=window.getSelection(),g=re.selection.isCaret()&&p.focusNode&&p.focusNode.nodeType===Node.TEXT_NODE&&p.focusNode.textContent&&p.focusNode.textContent.charCodeAt(0)===hd,v=1===l.alines.length,m=-1!==e.lineNode.className.indexOf("ace-line-pocket"),y=e.text.length,b=1===e.lineMarker?2===y:1===y;if(r||i||o){var E=s-1;if(!Ce.isMac||!i||"h"!==String.fromCharCode(a).toLowerCase())if(r||i)for(;E>e.lineMarker&&!Yi(l.alltext.charAt(E-1));)E--;else if(t.altKey)for(;E>e.lineMarker&&Ji(l.alltext.charAt(E-1));)E--;t.preventDefault(),c(l.zoneId,E,s,"")}else(g||v||m&&b)&&(t.preventDefault(),u=l.lines.offsetOfEntry(e),d=e.lineMarker,f=e.text.substr(d,s-u-d),h=sd(f),c(l.zoneId,s-h,s,""))}},this.updateLineGuid=function(e,t){var n=re.getRep();t=t||qi();var r=n.lines.atIndex(e),i=r.text.length;n.attributeManager.setAttributesOnRange([e,r.lineMarker],[e,i],[["lineguid",t]])},this.isRepInOfLine=function(e,t,n){if(!e||!t)return!1;var r=ve(e,2),i=r[0],o=r[1],a=ve(t,2),s=a[0],l=a[1];if(i!==s)return!1;var c=0,u=n.lines.atIndex(i).text.length;return!(!(c<=o&&l<=u)||c===o&&l===u||c===o&&c===l||u===o&&u===l)},this.getShiftEnterIndenClosetNumberId=function(e,t){if(!(t<1)){var n=e.findAttributeOnLine(t-1,"list");return n.includes("number")?e.findAttributeOnLine(t-1,"ol-id"):n.includes("indent")?re.getShiftEnterIndenClosetNumberId(e,t-1):void 0}},this.getOlIdForNewList=function(e){var t=e.selEnd,n=e.attributeManager,r=t[0]+1;return"1"===n.findAttributeOnLine(r,"start")?n.findAttributeOnLine(t[0]+1,"ol-id"):void 0},this.getClosetListNumberId=function(e,t,n,r,i){if(-1!==t.indexOf("number")){var o=n.selStart,a=n.selEnd,s=n.attributeManager,l=o[0],c=a[0];return l<1&&l===c&&0===e?"":r?s.findAttributeOnLine(l,"ol-id"):i&&i.editOneAfterOlList?re.getOlIdForNewList(n):(1<l?s.findAttributeOnLine(l-1,"ol-id"):"")||s.findAttributeOnLine(c+1,"ol-id")}},this.handleDoReturnKeyList=function(e,t,n){var r,i,o,a,s,l=re.findLastListLine,c=re.setLineListType,u=re.performDocumentReplaceSelection,d=re.getLineListType,f=re.renumberList,h=re.setLineListTypeWithStart,p=re.performNewLineWithLineMarkerAttributes,g=re.selection.currentSelection,v=re.getRep(g.zone),m=v.lines.atIndex(e).text,y=/([a-z]+)([0-9]+)/.exec(t),b=y[1],E=Number(y[2]),k=("indent"===b?re.getShiftEnterIndenClosetNumberId(v.attributeManager,v.selStart[0]):re.getClosetListNumberId(g.zone,b,v,!0))||An();if("indent"!==b||n||(o=l(v.zoneId,e)),"*"===m)1<E?c(v.zoneId,e,b+(E-1),k):"code"===b?0===e?(p(v,[["list",b+E]]),f(v.zoneId,e+1)):(a=v.lines.atIndex(e-1),s=d(v.zoneId,e-1),"*"===a.text&&-1<s.indexOf("code")?(c(v.zoneId,e-1,""),c(v.zoneId,e,""),f(v.zoneId,e+1)):(u(v.zoneId,"\n"),c(v.zoneId,e+1,b+E))):(c(v.zoneId,e,""),f(v.zoneId,e+1));else if(e+1<=v.lines.length()){var C=v.lines.atIndex(e).lineMarker||1,I=v.selStart[1]===C,S=re.getAttributesOnSelection().attribs;if("indent"!==b&&n)p(v,[["list","indent"+E]]),f(v.zoneId,e+1,"indent"+E);else if("indent"===b&&!n&&o)u(v.zoneId,"\n"),"number"===o.type[1]?h(v.zoneId,e+1,o.type[1]+o.type[2],o.start+1,void 0,k):c(v.zoneId,e+1,o.type[1]+o.type[2],k);else{if(re.selection.isCaret()&&"done"===b&&I)return u(v.zoneId,"\n"),c(v.zoneId,e,"check"+E),void c(v.zoneId,e+1,"done"+E);var T=void 0;if(re.formatterManager&&re.formatterManager.formatterMap.list){var O=re.formatterManager.formatterMap.list.plugin,w=new Map;try{for(var R=ge(S),x=R.next();!x.done;x=R.next()){var M=ve(x.value,2),N=M[0],_=M[1];O.prefixAttributes.includes(N)?w.has(N)||w.set(N,_):O.prefixAttributes.includes("list-"+N)&&w.set("list-"+N,_)}}catch(e){r={error:e}}finally{try{x&&!x.done&&(i=R.return)&&i.call(R)}finally{if(r)throw r.error}}T=Array.from(w)}var L=("done"===b?"check":b)+E,D=[["list",L]],B=void 0;-1<L.indexOf("number")&&(B=k||re.getClosetListNumberId(v.zoneId,L,v)||An())&&D.push(["ol-id",k]),(-1<L.indexOf("check")||-1<L.indexOf("done"))&&D.push(["todo_uuid",wn()]),T&&D.push.apply(D,me(T)),p(v,D),f(v.zoneId,e+1,B)}}},this.performNewLineWithLineMarkerAttributes=function(e,t){var n=e.selStart,r=e.selEnd,i=e.zoneId,o=[["insertorder","first"],["lmkr","1"]];n&&r&&re.performDocumentReplaceMultiRangeWithAttributes(e.zoneId,[{start:me(n,[i]),end:me(r,[i]),newText:"\n",attributes:[]},{start:me(r,[i]),end:me(r,[i]),newText:"*",attributes:o.concat(t)}])},this.doSelectAllKey=function(e){void 0===e&&(e=sr);var t=re.getRep(e).lines,n=t.length()-1,r=[0,0],i=[n,t.atIndex(n).text.length];re.isSelectingAll=!0,re.selection.setWithSelection(e,r,i,!0),re.selection.internalUpdateSelectionFromRep(!0)},this.jumpToTopOrBottom=function(t,n,r){return de(re,void 0,void 0,function(){return pe(this,function(e){switch(e.label){case 0:return[4,this.scrollToSelection({selZone:sr,selStart:t,selEnd:t})];case 1:return e.sent(),this.selection.setWithSelection(sr,n,r,!0),this.selection.internalUpdateSelectionFromRep(!0),[2]}})})},this.doReturnKey=function(e){var t=re.getLineListType,n=re._getTypeInAttribs,r=re.getAttributesOnSelection,i=re.hasOtherAttribsOnLine,o=re.performDocumentReplaceRange,a=re.setAttributeOnSelection,s=re.handleDoReturnKeyList,l=re.performDocumentReplaceSelection;re.hooks.callAll("doReturnKey",{}),re.eventEmitter&&"function"==typeof re.eventEmitter.emit&&re.eventEmitter.emit("doReturnKey");var c=re.getRep();if(c.selStart&&c.selEnd){re.profile&&re.profile.start(Uf);var u=e.shiftKey,d=c.selStart[0],f=c.selStart[1],h=c.lines.atIndex(d),p=d+1,g=c.attributeManager.getAttributesOnLine(d),v=n(g,"list"),m=n(g,"heading"),y=n(g,"blockquote","blockquote"),b=n(g,"align"),E=c.lines.isEndOfLine(c.selEnd[0],c.selEnd[1]),k=h.text.length===h.lineMarker,C=[];re.hooks.callAll("doReturnKeyPre",{attribs:C,hasNoContent:k,headingType:m,blockquoteType:y,alignType:b,listType:v});var I,S,T,O=re.selection.isCaret()&&0===d;O&&(I=r(c.zoneId),S=c.selStart,T=h.text.length,Object(B.a)(I.attribs,function(e){var t,n=ve(e,2),r=n[0],i=n[1];!r||r.indexOf("comment")<=-1||(t=c.attributeManager.getAttributePoints(r,i,0,1),Object(P.a)(t,function(e){var t=re.selection.hasSelectionCovered(c,e),n=re.selection.isAfterSelection(c,e);return!(t||n)})&&a(c.zoneId,r,"",{selStart:S,selEnd:[S[0],T]}))}));var w,R,x,M,N=m&&!E,_=y&&!k,L=b&&!k;if(Gc(v)&&(w=d-1,R=t(c.zoneId,w),M=(x=c.lines.atIndex(w)).text.length===x.lineMarker,_=!(k&&Gc(R)&&M)),m||y||b){var D=!1;if(m&&N&&(C.push(["heading",m]),f===h.lineMarker&&(i(g,"heading")?c.attributeManager.removeAttributeOnLine(d,"heading"):o(c.zoneId,[d,0],[d,h.lineMarker],""))),y)if(_)C.push(["blockquote","blockquote"]);else if(!v)return o(c.zoneId,[c.selStart[0],0],c.selEnd,""),void(re.profile&&re.profile.end(Uf));L&&C.push(["align",b]),v&&(D=!0,s(d,v,u)),D?C.length&&(v&&h.lineMarker===h.width||c.attributeManager.setAttributesOnLine(p,C)):C.length?v&&h.lineMarker===h.width||re.performDocumentReplaceRangeWithAttributes(c.zoneId,c.selStart,c.selEnd,["\n","*"],me([["insertorder","first"],["lmkr","1"]],C)):l(c.zoneId,"\n")}else v?s(d,v,u):l(c.zoneId,"\n");O&&k&&m&&c.attributeManager.removeAttributeOnLine(0,"heading"),re.profile&&re.profile.end(Uf)}},this.setAttributeOnSelection=function(e,t,n,r,i){var o=re.getRep(e),a=r||o;a.selStart&&a.selEnd&&o.attributeManager.setAttributesOnRange(a.selStart,a.selEnd,[[t,n]],i)},this.getZoneSelectionInMainZone=function(e){var t=re.getReps()[0],n=re.zoneToTableMap[e];if(n){var r=re.tableToLineMap[n];if(t.lines.containsKey(r.key)){var i=t.lines.indexOfEntry(r);if(!(i<0))return{selStart:[i,r.lineMarker,"0"],selEnd:[i,r.lineMarker+1,"0"]}}}},this.getRepsOnBatchDom=function(e,i){var o=[];function a(e,t){var n=e.selStart,r=e.selEnd,i=t.selStart,o=t.selEnd;return n[2]===i[2]&&(Math.abs(n[0]-o[0])<=1||Math.abs(r[0]-i[0])<=1)}return Object(B.a)(e,function(e){var t,n,r=re.domToRep(e);r&&(r=ue(ue({},r),{selZone:r.selStart[2]}),t=re.getRep(r.selZone),e.querySelector("hr, br, table")&&(r.selEnd=[r.selEnd[0]+1,0,r.selEnd[2]]),e.querySelector("img")&&(r.selEnd=[r.selEnd[0],t.lines.atIndex(r.selEnd[0]).text.length,r.selEnd[2]]),(n=o[o.length-1])&&(i||a(r,n))?o[o.length-1]=re.mergeSelection(r,n):o.push(r))}),o},this.getRepsOnBatchDomWithoutGallery=function(e,a){var s=[];function l(e,t){var n=e.selStart,r=e.selEnd,i=t.selStart,o=t.selEnd;return n[2]===i[2]&&(Math.abs(n[0]-o[0])<=1||Math.abs(r[0]-i[0])<=1)}return Object(B.a)(e,function(e){var t=re.domToRep(e),n=t.selStart[2];t.selZone=n;var r=re.getRep(n);e.querySelector("hr, br, table")&&(t.selEnd=[t.selEnd[0]+1,0,t.selEnd[2]]);var i,o=e.querySelector("img");he()(o).parents(".gallery").length||(o&&(t.selEnd=[t.selEnd[0],r.lines.atIndex(t.selEnd[0]).text.length,t.selEnd[2]]),(i=s[s.length-1])&&(a||l(t,i))?s[s.length-1]=re.mergeSelection(t,i):s.push(t))}),s},this.mergeSelection=function(e,t,n){var r,i,o=e.selZone,a=t.selZone,s=e.mergeMeta||[],l=t.mergeMeta||[],c=s.concat(l);n&&o!==a&&(s.length||c.push(e),l.length||c.push(t),"0"!==o&&((e=re.getZoneSelectionInMainZone(o)).selZone=e.selStart[2]),"0"!==a&&((t=re.getZoneSelectionInMainZone(a)).selZone=t.selStart[2]));var u=Math.min(e.selStart[0],e.selEnd[0],t.selStart[0],t.selEnd[0]),d=Math.max(e.selStart[0],e.selEnd[0],t.selStart[0],t.selEnd[0]);return Object(B.a)([e.selStart,e.selEnd,t.selStart,t.selEnd],function(e){e[0]===u&&(r=Object(T.default)(r)?e[1]:Math.min(e[1],r)),e[0]===d&&(i=Object(T.default)(i)?e[1]:Math.max(e[1],i))}),{selStart:[u,r,e.selZone],selEnd:[d,i,e.selZone],selZone:e.selZone,mergeMeta:c}},this.handleRedoUndo=function(e,t,n,r){var i=re.getCurrentCallStack,o=re.performDocumentApplyChangeset,a=re.performSelectionChange,s=re.selection.lineAndColumnFromChar,l=re.hook,c=i(),u=c.editEvent.eventType;return c.startNewEvent(e),t&&o(t,void 0,void 0,r),n&&a(n.selZone,s(n.selZone,n.selStart),s(n.selZone,n.selEnd),n.selFocusAtStart),l.callAll("performUndoRedo",{which:e,backset:t}),c.startNewEvent(u,!0)},this.doUndoRedo=function(e){var t,n=re.undoModule,r=re.isUndoHandleEnabled;n.enabled&&r&&((t="redo"===e?"performRedo":"undo"===e?"performUndo":void 0)&&n[t]())},this.handleCodeTab=function(e,t,n){var r,i,o=re.getRep(e),a=re.performDocumentReplaceRange;n?(r=/^\*(\s*)/.exec(o.lines.atIndex(t).text)[1].length)&&(i=4<=r?4:r,a(o.zoneId,[t,1],[t,i+1],"")):a(o.zoneId,[t,1],[t,1],Df)},this.handleListTab=function(e,t,n){var r="indent",i=0;(e=e&&/([a-z]+)([0-9]+)/.exec(e))&&(r=e[1],i=Number(e[2]));var o=Math.max(0,Math.min(re.maxListLevel,i+(n?-1:1)));if(i!==o)return[t,0<o?r+o:""]},this.doTabKey=function(e){var t=re.getRep().zoneId;re.doIndentOutdent(t,e)||re.performDocumentReplaceSelection(t,Df)},this.doIndentOutdent=function(e,t,n,r){var i=re.getLineListType,o=re.handleCodeTab,a=re.getRep(e),s=t.shiftKey;if(n=n||a.selStart,r=r||a.selEnd,!(n&&r||n[0]===r[0]&&n[1]===r[1]&&1<r[1])&&!0!==s)return!1;var l=n[0],c=Math.max(l,r[0]-(0===r[1]?1:0));if(e!==sr)return re.handleMultLineTab(e,l,c,s)&&t.stopImmediatePropagation(),!0;var u,d=n[1]===a.lines.atIndex(l).lineMarker,f=l===c,h=a.attributeManager.getAttributeOnLine(l,"text-indent");if(f&&-1<(u=i(e,l)).indexOf("code"))return o(e,l,s),!0;var p=!!a.attributeManager.getAttributeOnLine(l,"aceTable");return!d||!f||h||s||u||p?d&&f&&h&&s?a.attributeManager.removeAttributeOnLine(l,"text-indent"):re.handleMultLineTab(e,l,c,s):a.attributeManager.setAttributeOnLine(l,"text-indent","true"),!0},this.handleMultLineTab=function(r,e,t,n){for(var i=[],o=re.getRep(r),a=e;a<=t;a++){var s,l,c=re.getLineListType(r,a);if(r!==sr&&""===c)return!1;-1<c.indexOf("code")?re.handleCodeTab(r,a,n):(s=void 0,-1<c.indexOf("number")&&((s=o.attributeManager.findAttributeOnLine(a,"ol-id"))||(s=re.getClosetListNumberId(r,c,o)||An(),re.renumberList(r,a,"",s))),(l=re.handleListTab(c,a,n))&&(s&&l.push(s),i.push(l)))}return Object(B.a)(i,function(e){var t=e[0],n=o.lines.atIndex(t).lineNode;n&&-1<n.className.indexOf("IGNORE_LIST")||re.setLineListType(r,e[0],e[1],e[2])}),!0},this.handleKeyEvent=function(C){var e,t,n,I,S,T,O,w,R,x,M,N,_,L,D,B,P,F,r,j,z,H,U,V,i,o,a,s,W,l,c,u,d,K,Z;re.props.inEmbed&&re.props.inEmbed(re,C.target)||(e=re.isEditable,t=re.inCallStackIfNecessary,n=re.viewPort,I=n.getViewPortTopBottom,S=n.setScrollY,T=re.fastIncorp,O=re.doDeleteKey,w=re.doReturnKey,R=re.doSelectAllKey,x=re.idleWorkTimer,M=re.performSelectionChange,N=re.doTabKey,_=re.doIndentOutdent,L=re.isOnLineManager,D=re.getCurrentCallStack,B=re.doCtrlKForMac,P=C.keyCode,F=C.type,r=C.charCode,j=C.which,z=C.altKey,H=C.metaKey,U=C.shiftKey,V=C.ctrlKey,((i=C.target)===(o=re.getDocBody())||o.contains(i))&&e()&&(a="keydown"===F,s="keypress"===F,!r&&(a||"keyup"===F)&&(16===P||17===P||18===P||20===P||224===P||91===P||93===P)||13===P&&Ce.opera&&"keypress"===F||(W=!1,l=Ce.msedge,c=Ce.msie,u=Ce.safari,d=Ce.chrome,(Z=K=l||c||u||d?a:s)&&86===P&&C.metaKey?re.pasteTriggerFromKey=!0:re.pasteTriggerFromKey=!1,re.handleSpecialKeys(C)||t("handleKeyEvent",function(){var e,t,n,r,i,o,a,s,l=(0,re.getClientVars)().padShortcutEnabled,c=D(),u=re.getRep(),d=re.hook.callAll("aceKeyEvent",{callstack:c,editor:re,editorInfo:re,rep:u,documentAttributeManager:u.attributeManager,evt:C,isTypeForCmdKey:Z,isTypeForSpecialKey:K,padShortcutEnabled:l})||[],f=re.eventEmitter;if(f&&"function"==typeof f.trigger&&f.trigger("aceKeyEvent",[{callstack:c,editor:re,editorInfo:re,rep:u,documentAttributeManager:u.attributeManager,evt:C,isTypeForCmdKey:Z,isTypeForSpecialKey:K,padShortcutEnabled:l}]),d&&(W=-1<d.indexOf(!0)),!W&&z&&P===Ku.C&&"keydown"===F&&l.altC&&C.preventDefault(),!W&&P===Ku.Delete&&"keydown"===F&&re.handleDeleteKeyOnLineEnd()&&(W=!0,C.preventDefault()),re.getInInternationalComposition()||W||!K||P!==Ku.BackSpace&&(P!==Ku.Delete||re.isCaret())||!l.delete||(T(),O(C),W=!0),Ce.isMac&&!re.getInInternationalComposition()&&!W&&K&&P===Ku.K&&V&&(T(),B(C),C.preventDefault(),W=!0),!re.getInInternationalComposition()&&!W&&K&&P===Ku.Delete&&re.isCaret()&&u.selEnd[0]===u.lines.length()-1&&u.selEnd[1]===u.lines.atIndex(u.selEnd[0]).text.length&&(C.preventDefault(),W=!0),!re.getInInternationalComposition()&&!W&&K&&P===Ku.Enter&&l.return&&(T(),C.preventDefault(),w(C),W=!0),!re.getInInternationalComposition()&&!W&&K&&P===Ku.A&&H&&(T(),C.preventDefault(),R(),W=!0),re.getInInternationalComposition()||W||!K||!H||P!==Ku.Up&&P!==Ku.Down||(T(),C.preventDefault(),W=!0,e=P===Ku.Up,n=(t=re.getRep(sr)).alinesWidth,r=t.selStart,i=t.selEnd,o=n.length-1,a=e?[0,0]:[o,n[o]-1],U?e?re.jumpToTopOrBottom(a,a,i):re.jumpToTopOrBottom(a,r,a):re.jumpToTopOrBottom(a,a,a)),!W&&K&&P===Ku.Esc&&l.esc&&(T(),C.preventDefault(),W=!0),W||!K||P!==Ku.Tab||C.metaKey||C.ctrlKey||!l.tab||(T(),re.props.firstLineJumpOnTab&&u&&u.zoneId===sr&&u.selStart&&0<u.selStart.length&&0===u.selStart[0]&&1<u.lines.length()?(s=[1,u.lines.atIndex(1).lineMarker],u.selEnd&&0<u.selEnd.length&&0!==u.selEnd[0]?_(u.zoneId,C,s,u.selEnd):M(u.zoneId,s,s)):N(C),C.preventDefault(),W=!0),!W&&Z&&"h"===String.fromCharCode(j).toLowerCase()&&C.ctrlKey&&l.cmdH&&(T(),C.preventDefault(),O(C),W=!0),36===C.which&&!0===C.ctrlKey&&l.ctrlHome&&S(0),!C.shiftKey||40!==C.which&&37!==C.which&&39!==C.which&&38!==C.which||C.shiftKey&&(re.shouldFixSelection=!1,T(),"keyup"===F&&(re.shouldFixSelection=!0)),38!==C.which&&40!==C.which||(c.userChangedSelection=!0),(37===C.which||38===C.which||39===C.which||40===C.which)&&Ce.chrome){var h=I(),p=document.getSelection().focusNode,g=p.parentNode.offsetTop||p.offsetTop,v=he()(p.parentNode).parent("div").height();try{v=he()(p).height()}catch(e){}var m,y,b=g+v;g&&(m=void 0,y=g<h.top||b>=h.bottom,g!==h.top||37!==C.which&&38!==C.which||S(g),y&&(37!==C.which&&38!==C.which||(m=g),39!==C.which&&40!==C.which||(m=h.top+v),m&&S(m)))}!W&&K&&!(z||H||U)&&L()&&(re.fastIncorp(),L()&&C.preventDefault());var E={rep:u,evt:C,isTypeForCmdKey:Z,isTypeForSpecialKey:K,specialHandled:W,editorInfo:re,editor:re,documentAttributeManager:u.attributeManager},k=re.hook;switch(F){case"keydown":re.togglePlaceholderTimeout&&clearTimeout(re.togglePlaceholderTimeout),re.togglePlaceholderTimeout=setTimeout(re.togglePlaceHolder),x.atLeast(500),k.callAll("editorKeyDown",E);break;case"keypress":x.atLeast(500),k.callAll("editorKeyPress",E);break;case"keyup":re.getInInternationalComposition()||(x.atLeast(0),x.atMost(0)),k.callAll("editorKeyUp",E)}},{shouldIncorp:!1}))))},this.handleSpecialKeys=function(e){var t=e.type,n=e.keyCode;if("keydown"===t&&(qu.includes(n)||Yu.includes(n))){var r=!1;return re.inCallStackIfNecessary("doArrowKeyAroundFakeText",function(){(r=re.doArrowKeyAroundFakeText(e,n))&&e.preventDefault()},{shouldIncorp:!0}),r}},this.getSelectedHTML=function(){var e="";if(re.isSelectingAll)e=re.getHtml();else{var t=ko(window.getSelection(),0),n=t.cloneContents(),r=t.commonAncestorContainer;if(r instanceof Text){var i=n.childNodes[0];if(1===n.childNodes.length&&i instanceof Text&&i.textContent===r.textContent)for(var o=t.commonAncestorContainer;o&&o!==re.docbody;){if("A"===o.tagName||"a"===o.tagName){var a=o.cloneNode();a.append(n),n=a;break}o=o.parentElement}}var s=document.createElement("div");s.appendChild(n),re.blockRender instanceof Fl&&re.blockRender.replacePlaceholderWithLineNode(s),e=s.innerHTML}var l={html:e,editorInfo:re,rep:re.getRep()};return re.hooks.callAll("aceGetSelectedHTML",l)[0]||e},this.handleBlurEvent=function(e){var t=re.getRep(),n=re.getCurrentCallStack(),r={editorInfo:re,rep:t,e:e,callstack:n};re.hooks.callAll("aceBlur",r)},this.handleCopy=function(e){if(!re.copyable)return re.call(ar.COPY_WITHOUT_PERMISSION),void e.preventDefault();var t,n,r,i,o,a,s,l,c,u,d,f,h,p,g,v=re.getRep(),m=re.getCurrentCallStack(),y={rep:v,e:e,html:""};re.hooks.callAll("shouldPreventCopy",y).includes(!0)||(Ce.android&&re.isEditable()&&re.selection.updateBrowserSelectionFromRep(!0),re.blockRender instanceof Fl&&(n=(t=re.getRep()).selStart,r=t.selEnd,i=t.zoneId,re.blockRender.ensureLinesRendered(i,n[0],r[0],!0)),o=window.getSelection(),a=!1,Ce.mobile&&o.focusNode===document.body&&0<o.rangeCount&&(o.removeAllRanges(),s=new Range,l=re.getDocBody(),s.selectNode(l),o.addRange(s),a=!0),c=y.html||re.getSelectedHTML(),(u=re.hooks.callAll("aceBeforeCopy")).length&&u[0]&&(c=u[0]),d={html:c,editorInfo:re,rep:v,e:e,callstack:m,handled:!1,range:[],customCopyDatas:[]},f=re.hooks.callAll("aceCopy",d),re.eventEmitter&&"function"==typeof re.eventEmitter.emit&&re.eventEmitter.trigger("aceCopy",[d]),re.resetCopySource("copy"),!f||(h=f[f.length-1]||d.handled&&d)&&(e.preventDefault(),e.stopImmediatePropagation(),p=e.clipboardData||e.originalEvent.clipboardData||Nf.clipboardData,g=Ce.windows?(h.text||"").replace(/\n/g,"\r\n"):h.text||he()(h.html).text(),xd.setData(p,{text:g,html:re.addUniqueIdIntoHTML(h.html)}),xd.setCustomData(p,h.customCopyDatas)),a&&0<o.rangeCount&&o.removeAllRanges())},this.handleCut=function(c){if(!re.copyable)return re.call(ar.COPY_WITHOUT_PERMISSION),void c.preventDefault();re.inCallStackIfNecessary("handlecut",function(){re.fastIncorp();var e,t,n,r,i,o,a,s,l=re.getRep();re.isEditable()&&(e={rep:l,e:c,html:""},re.hooks.callAll("shouldPreventCopy",e).includes(!0)||(n={html:t=e.html||re.getSelectedHTML(),editorInfo:re,rep:l,e:c,callstack:re.getCurrentCallStack(),handled:!1,range:[],customCopyDatas:[]},r=re.hooks.callAll("aceCut",n),re.eventEmitter&&"function"==typeof re.eventEmitter.emit&&re.eventEmitter.trigger("aceCut",[n]),r&&((i=r[r.length-1]||n.handled&&n)?(c.preventDefault(),c.stopImmediatePropagation(),o=c.clipboardData||c.originalEvent.clipboardData||Nf.clipboardData,xd.setData(o,{text:i.text,html:re.addUniqueIdIntoHTML(i.html)}),xd.setCustomData(o,i.customCopyDatas)):(Ce.isSafari&&(c.preventDefault(),c.stopImmediatePropagation(),o=c.originalEvent.clipboardData||Nf.clipboardData,xd.setData(o,{text:t,html:re.addUniqueIdIntoHTML(t)})),Ce.modernIE?(c.preventDefault(),c.stopImmediatePropagation(),o=Nf.clipboardData,xd.setData(o,{html:re.addUniqueIdIntoHTML(t)})):document.execCommand("copy"))),re.resetCopySource("cut"),s=a="",re.managers.getLineManagerWithSpecialSelection()||(a=re.getLineListType(l.zoneId,l.selStart[0]),l.selEnd[0]!==l.lines.length()-1&&(s=re.getLineListType(l.zoneId,l.selEnd[0]+1))),re.hooks.callAll("aceCutRangeReplaceSeletion",{rep:l,range:n.range}),a||s?re.cutList(l):re.hooks.callAll("aceCutReplaceSelection",{rep:l,e:c}).indexOf(!0)<0&&re.performDocumentReplaceSelection(l.zoneId,"")))})},this.resetCopySource=function(e){["copy","cut"].indexOf(e)<0||(re.pasteSource=e,re.pasteTimes=0)},this.addUniqueIdIntoHTML=function(e){if(!e)return e;var t=he()((new DOMParser).parseFromString(e,"text/html").body);return t.children().first().attr("data-editor-unique-id",re.editorUniqueId),t.html()},this.cutList=function(t){var e=re.performDocumentReplaceRange,n=re.renumberList,r=re.caretLine,i=t.selStart[0],o=t.selEnd[0],a=t.lines.atIndex(i),s=t.selStart,l=t.selEnd;t.lines.isEndOfLine(o,t.selEnd[1])&&t.lines.isStartOfLine(i,t.selStart[1])&&(s=[i,a.lineMarker]);var c=re.deleteNumberList(re,[s,l]);e(t.zoneId,s,l,"");var u=r();-1!==u&&c.forEach(function(e){"number"==typeof e&&null===n(t.zoneId,u+1)?n(t.zoneId,u):n(t.zoneId,u,e,!1)})},this.deleteNumberList=function(e,t,n,r){void 0===n&&(n=[]);var i=e.getRep(),o=ve(t||[i.selStart,i.selEnd],2),a=o[0],s=o[1],l=a[0],c=s[0],u=i.lines.atIndex(l);if(re.selection.isCaret()&&re.caretColumn()===u.lineMarker){var d=1<i.selStart[0]?e.getLineListType(i.zoneId,i.selStart[0]-1):"",f=i.selStart[0]<i.lines.length()?e.getLineListType(i.zoneId,i.selStart[0]+1):"";if(-1<d.indexOf("code")&&-1<f.indexOf("code"))return n.push(Number(i.selStart[0])),n}for(var h=l;h<=c;h++){var p,g,v=e.getLineListType(i.zoneId,h);-1===v.indexOf("code")?-1!==v.indexOf("number")&&((p=i.attributeManager.findAttributeOnLine(h,"ol-id"))&&!n.includes(p)?n.push(p):p||(g=An(),e.renumberList(i.zoneId,h,g,!0),n.push(g))):n.push(Number(h))}return n},this.handleDrop=function(e){re.docbody.dispatchEvent(new CompositionEvent("compositionend"))},this.maybePasteTableData=function(e,t){var n=(e.originalEvent&&e.originalEvent.clipboardData?e.originalEvent:Nf).clipboardData;if(!n||!Ce.modernIE&&!/text\/html/.test(JSON.stringify(n.types)))return!1;var r=re.selection.get(),i=r.hasSelection,o=r.start;if(i&&ru(o.zone)){var a=re.getPastedTableData(t.pasteDataWrapper);if(a){var s=!1;if(re.inCallStackIfNecessary("pasteCellsOntoTable",function(){var e,t=re.selection.getStart();t&&ru(t.zone)&&((e=re.managers.getLineEntryContainingZone(t.zone))&&e.domInfo&&Oo(e.domInfo.node)&&(e.domInfo.node.lineManager.pasteCellsOntoTable(a.line,a.attribs,a.additionalZatext),s=!0))}),s)return e.stopPropagation(),e.preventDefault(),!0}}return!1},this.replaceDuplicateUniqueIds=function(e){var t,n,r=e.querySelectorAll("[data-usually-unique-id]");if(0!==r.length){var i=re.dom.getRoot().querySelectorAll("[data-usually-unique-id]"),o={};try{for(var a=ge(Array.from(i)),s=a.next();!s.done;s=a.next()){var l=s.value;o[l.getAttribute("data-usually-unique-id")]=!0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}r.forEach(function(e){var t=e.getAttribute("data-usually-unique-id");t in o?e.setAttribute("data-usually-unique-id",Os()):o[t]=!0})}},this.getPastedTableData=function(e){var t,n;if("undefined"==typeof DOMParser)return null;var r=e.cloneNode(!0),i=r.querySelectorAll("td");try{for(var o=ge(Array.from(i)),a=o.next();!a.done;a=o.next()){var s=a.value;""===s.innerHTML&&s.appendChild(document.createElement("br"))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}for(;1<r.childNodes.length;)("TABLE"!==r.childNodes[0].nodeName?r.childNodes[0]:r.childNodes[1]).remove();re.replaceDuplicateUniqueIds(r);var l=Du({collectStyles:!0,abrowser:Ce,apool:re.repManager.apool,className2Author:zi,hooks:re.hooks,forPaste:!0,editor:re,formatterRenderer:re.formatterManager});l.collectContent(r);var c=l.finish();return"*"===c.lines[0]&&re.changesetHelper.attribsAttributeValue(c.lineAttribs[0],"aceTable",re.getApool())?{line:c.lines[0],attribs:c.lineAttribs[0],additionalZatext:c.additionalZatext}:null},this.handlePaste=function(e){if(re.isEditable()&&(re.inCallStackIfNecessary("handlePaste",function(){re.fastIncorp()},{shouldIncorp:!1}),!re.isFocusOnBlock())){var t=(e.originalEvent&&e.originalEvent.clipboardData?e.originalEvent:Nf).clipboardData,n=re.pasteTriggerFromKey,r=re.hook,i=re.getRep(),o=i.attributeManager,a=re.getCurrentCallStack();e.preventDefault();var s=To(xd.getData(t,"text/html"),re.domPurifyConfig),l=xd.getData(t,"text/plain"),c=/<!--StartFragment-->([\s\S]*)<!--EndFragment-->/;Ce.isWindows&&c.test(s)&&(s=c.exec(s)[1]);var u=document.createElement("div");u.innerHTML=s;var d={editorInfo:re,rep:i,documentAttributeManager:o,e:e,callstack:a,pasteTriggerFromKey:n,text:l,pasteDataWrapper:u,purifiedHtml:s},f="";if(Array.prototype.forEach.call(u.children,function(e){var t=e.getAttribute("data-editor-unique-id");t&&(f=t)}),f===re.editorUniqueId?(d.source=re.pasteSource,d.times=++re.pasteTimes):(d.source=null,d.times=0),r.callAll("acePaste",d),re.eventEmitter&&"function"==typeof re.eventEmitter.emit&&re.eventEmitter.trigger("acePaste",[d]),r.callAll("aceAfterPaste",d),Ce.isIOSBelow12())e.stopImmediatePropagation(),window.lark.biz.clipboard.getContent({callback:function(e){var t=e["public.html"];t&&(re.pasteTriggerFromKey=!1,r.callAll("beforePasteInsert",ue(ue({},d),{insertHtml:t})),re.handlePasteHTML(ue(ue({},d),{html:t}))),re.fastIncorpTimout=setTimeout(function(){re.callStack.inCallStackIfNecessary("idleWorkTimer",function(){re.fastIncorp(),r.callAll("afterPasteInsert",ue({},d))})})}});else{var h=re.maybeImagePaste(e);if(!h&&re.maybePasteTableData(e,d))return e.stopPropagation(),void e.preventDefault();h||re.maybeRichPaste(e,d)||re.maybePlainTextPaste(e,d),re.fastIncorpTimout=setTimeout(function(){re.callStack.inCallStackIfNecessary("idleWorkTimer",function(){re.fastIncorp(),r.callAll("afterPasteInsert",ue({},d))})})}}},this.maybeImagePaste=function(e){var t=e.originalEvent.clipboardData;if(!t)return!1;var n=t.types,r=t.items,i=void 0===r?[]:r,o=JSON.stringify(n),a=1===n.length&&"Files"===n[0],s=2===n.length&&/("text\/plain","Files"|"Files","text\/plain")/.test(o),l=2===n.length&&/"text\/html","Files"|"Files","text\/html"/.test(o),c=Ce.isSafari&&/"Files","text\/uri-list"/.test(o);if(a||s||l||c){var u=Array.prototype.slice.call(i).filter(function(e){return"file"===e.kind}),d=u.filter(function(e){return 0===e.type.indexOf("image/")});return d.length===u.length&&0<d.map(function(e){return e.getAsFile()}).filter(function(e){return!!e}).length}return!1},this.maybeRichPaste=function(e,t){var n=e.originalEvent.clipboardData;return!!n&&(!(!/text\/html/.test(JSON.stringify(n.types))&&""===t.pasteDataWrapper.innerHTML)&&(e.stopImmediatePropagation(),t.pasteDataWrapper.innerHTML&&(re.pasteTriggerFromKey=!1,re.hook.callAll("beforePasteInsert",ue({},t)),re.handlePasteHTML(t)),!0))},this.maybePlainTextPaste=function(e,t){var n=e.originalEvent.clipboardData;if(!n)return!1;if(!/text\/plain/.test(JSON.stringify(n.types)))return!1;e.stopImmediatePropagation();var r=document.createElement("span");return r.textContent=t.text,t.pasteDataWrapper.appendChild(r),re.handlePasteHTML(t,!0),!0},this.handlePasteHTML=function(v,m){void 0===m&&(m=!1);var y=v.pasteDataWrapper,b=window.getSelection(),e="pasteHtml"+Math.floor(1e3*Math.random());re.inCallStackIfNecessary(e,function(){var e=re.getRep();re.hook.callAll("beforePaste",v);var t=e.zoneId,n=e.selStart;re.performDocumentReplaceSelection(t,""),re.selection.setWithSelection(t,n,n,!0),re.selection.updateBrowserSelectionFromRep(!0);var r,i,o,a,s,l,c,u,d,f,h,p=ko(window.getSelection(),0),g=e.selStart[0];null!==b&&void 0!==b&&b.rangeCount&&(r=p.startContainer,i=p.startOffset,a=(o=re.getPasteInfo(y,r,i,m)).node,s=o.selectPoint,(l=re.getCCDataFromNode(a,{startPoint:s,endPoint:s}))&&(u={rep:e,lines:c=l.lines,lineAttribs:l.lineAttribs},re.hook.callAll("aceAfterCollectPasteContent",u),d=ue(ue({},l),{lines:u.lines,lineAttribs:u.lineAttribs}),f=re.getChangesetFromCCData({ccData:d,startLine:g,deleteCount:1,zoneId:t}),h=[g+l.selStart[0],l.selStart[1]],f&&(re.performDocumentApplyChangeset(f),re.selection.setWithSelection(t,h,h),re.updateBrowserSelectionFromRep(!0),re.doFixNewInsertNodeListError(g,c.length)))),re.hook.callAll("afterPaste",v)},{shouldIncorp:!0,mergeEvent:e})},this.getPasteInfo=function(e,t,n,r){re.dom.isRootOfZone(t)&&(t=0===n?t.childNodes[0]:t.childNodes[n-1],n=0===n?0:t.childNodes[n-1].childNodes.length);var i=re.dom.getAceLineForNode(t),o=e.cloneNode(!0).childNodes,a=re.dom.cloneNodes(i,t,document),s=a.outerClone,l=a.innerClone;return{node:s,selectPoint:{node:re.insertNodesAt(Array.prototype.slice.call(o),t,l,n,r).node,index:1,maxIndex:1}}},this.getCCDataFromNode=function(e,t){var n=Du({collectStyles:!0,abrowser:Ce,apool:re.getRep().apool,className2Author:zi,hooks:re.hooks,formatterRenderer:re.formatterManager,forPaste:!0,tagsIgnoreToParse:re.tagsIgnoreToParse,editor:re});t&&n.notifySelection(t),n.collectContent(e);var r=n.finish();return r.lines.length<1?null:r},this.getChangesetFromCCData=function(e){var t,n=e.ccData,r=e.startLine,i=e.deleteCount,o=e.zoneId,a=e.hint,s=[],l=n.lines,c=n.lineAttribs,u=null===(t=n.additionalZatext)||void 0===t?void 0:t.attribs;u&&Object.keys(u).length&&s.push(n.additionalZatext);var T=[];s.forEach(function(e){var t,n,r,i,o,a,s,l;re.fixInvalidZatext(e);try{for(var c=ge(Object.keys(e.text)),u=c.next();!u.done;u=c.next()){var d=u.value,f=e.text[d].substr(0,e.text[d].length-1).split("\n"),h=[];try{for(var p=(r=void 0,ge(f)),g=p.next();!g.done;g=p.next()){var v=g.value,m=re.createDomLineEntry(v,d,{mounted:!0,isActive:!0});h.push(m)}}catch(e){r={error:e}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}for(var y=re.changesetHelper.splitAttributionLines(e.attribs[d],e.text[d]),b=0;b<y.length;++b)y[b]=re.changesetHelper.subattribution(y[b],0,f[b].length);re.initiateRepForZoneIfNecessary(d);var E=re.getChangesetFromDelta(0,1,h,y,null,d).cs;E&&T.push({zoneId:d,changeset:E})}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}try{for(var k=ge(Object.keys(e.rows)),C=k.next();!C.done;C=k.next()){d=C.value;re.doIncorpVectorsZoneInsert(!0,d,e.rows[d],e.attribs[d])}}catch(e){o={error:e}}finally{try{C&&!C.done&&(a=k.return)&&a.call(k)}finally{if(o)throw o.error}}try{for(var I=ge(Object.keys(e.cols)),S=I.next();!S.done;S=I.next()){d=S.value;re.doIncorpVectorsZoneInsert(!1,d,e.cols[d],e.attribs[d])}}catch(e){s={error:e}}finally{try{S&&!S.done&&(l=I.return)&&l.call(I)}finally{if(s)throw s.error}}});var d=l.map(function(e){return re.createDomLineEntry(e,o,{mounted:!0,isActive:!0})}),f=re.getChangesetFromDelta(r,i,d,c,a,o).cs;return f&&T.push({zoneId:o,changeset:f}),T.length?re.mergeMultiZoneChangesets(T):null},this.fixInvalidZatext=function(e){var t,n,r,i,o,a,s=e.rows,l=void 0===s?{}:s,c=e.cols,u=void 0===c?{}:c;try{for(var d=ge(Object.keys(l)),f=d.next();!f.done;f=d.next()){var h=l[f.value]||[];try{for(var p=(r=void 0,ge(Object.keys(u))),g=p.next();!g.done;g=p.next()){var v=nu(h,u[g.value]||[]);try{for(var m=(o=void 0,ge(v)),y=m.next();!y.done;y=m.next()){var b=y.value;e.text[b]||(e.text[b]="\n")}}catch(e){o={error:e}}finally{try{y&&!y.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}}}catch(e){r={error:e}}finally{try{g&&!g.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}},this.mergeMultiZoneChangesets=function(e){var r=e.reduce(function(e,t){var n=t.zoneId,r=t.changeset;return e[n]?e[n]=re.mergeChangesets([e[n],r]):e[n]=r,e},{});return Object.keys(r).reduce(function(e,t){var n=r[t];return e=e?re.mergeChangesets([e,n]):n},"")},this.insertNodesAt=function(e,t,n,r,i){var o,a,s,l=n,c=r,u=t,d=1===t.nodeType?getComputedStyle(t).display:null;if("block"!==d&&"list-item"!==d)for(;l&&l.parentNode&&"list-item"!==(d=getComputedStyle(u.parentNode).display)&&"block"!==d;)c=Array.prototype.indexOf.call(l.parentNode.childNodes,l),l=l.parentNode,u=u.parentNode;1===l.nodeType&&((o=document.createRange()).setStart(l,c),o.setEnd(n,r),s=(a=o.extractContents()).childNodes.length,l.insertBefore(a,l.childNodes[c]),n=l,r=s+c);var f=document.createElement("div");f.setAttribute("data-ace-pasted","true"),f.setAttribute("data-ace-ignore-block-newlines","true"),i&&(f.style.whiteSpace="pre"),e.forEach(function(e){f.appendChild(e)});var h=document.createRange();return h.setStart(n,r),h.setEnd(n,r),h.insertNode(f),{node:f}},this.getTextNode=function(e){if(!e)return null;var t=e.childNodes,n=e.previousSibling;if(!t&&!n)return null;if(!t&&n)return re.getTextNode(n);var r=t[t.length-1];return r&&Li(r)?e:re.getTextNode(r)},this.handleClickEvent=function(e){var t=re.inCallStackIfNecessary,n=re.idleWorkTimer;t("click",function(){n.atMost(200)}),re.hook.callAll("aceClickEvent",{event:e});var r=e.ctrlKey,i=e.button,o=e.target;if(!r&&2!==i&&3!==i){var a=he()(o).attr("href")?he()(o):he()(o).parents("a");if(a.length&&a.attr("href")){try{var s=a.parents(".mention");if(s.hasClass("mention-type_0")||s.hasClass("mention-type_6"))return e.preventDefault(),!1;if(a.hasClass("no-ace-listen"))return;var l=a.get(0).href;!l||/^javascript:void\(0\);?$/.test(l.trim())||e.originalEvent.defaultPrevented||(Ce.isMobileSDK?window.location.href=l:window.open(l,"_blank").focus())}catch(e){}e.preventDefault()}}},this.getBlockElement=function(){for(var e=window.getSelection().focusNode,t=e instanceof Element?e:e&&e.parentElement;t&&t!==re.docbody;){if(t.matches(".ace-line>."+ki))return t;t=t.parentElement}return null},this.isFocusOnBlock=function(){var e=re.getRep();return!(!e.selStart||e.selStart[0]!==e.selEnd[0])&&!!re.getBlockElement()},this.isFocusOnSheet=function(){var e=re.getRep();if(!e.selStart||e.selStart[0]!==e.selEnd[0])return!1;var t=re.getBlockElement();return!!t&&t.matches(".sheet")},this.scrollVerticallyBySelectionPosition=function(){Aa(re)},this.initiateRepForZoneIfNecessary=function(t){var n=re.createDomLineEntry,r=re.doRepLineSplice;re.inCallStackIfNecessary("initiateRep",function(){var e;t in re.repManager.reps||(re.repManager.addRep(t),e=n("",t),re.repManager.reps[t].alines=["|1+1"],r(t,0,0,[e]),re.dirtyChecker.observer.withoutRecordingMutations(function(){re.domLine.insertDomLines(t,null,[e.domInfo],null)}))})},this.callPluginCheckSelection=function(e,t,n,r){var i,o,a,s=re.getRep(e),l={selStart:t,selEnd:n,selFocusAtStart:r,zoneId:e};return re.hooks.callAll("beforeAceSelectionChange",{documentAttributeManager:s.attributeManager,newRep:l}),Ni(l.selStart,t)&&Ni(l.selEnd,n)||(i=s.selStart,o=s.selEnd,a=s.selFocusAtStart,s.selStart=l.selStart,s.selEnd=l.selEnd,s.selFocusAtStart=l.selFocusAtStart,s.selStart=i,s.selEnd=o,s.selFocusAtStart=a),l},this.isImageLine=function(e,t){var n=re.getRep(e);if(t<0||t>n.lines.length()-1)return!1;var r=Object(W.default)(n.lines.atIndex(t),"lineNode.innerHTML");return!!(r&&-1<r.indexOf("image-uploaded"))},this.isSheetLine=function(e,t){var n=re.getRep(e);if(t<0||t>n.lines.length()-1)return!1;var r=Object(W.default)(n.lines.atIndex(t),"lineNode.innerHTML");return!!(r&&-1<r.indexOf("sheet-id-"))},this.isFocusOnTable=function(){return"0"!==re.getRep().zoneId},this.performDelete=function(e){var t,n=re.getRep(),r=n.lines.atIndex(e),i=0<=e-1?e-1:0,o=n.lines.atIndex(i);r&&(t=r.text.length,e?re.performDocumentReplaceRange(n.zoneId,[i,o.text.length],[e,t],""):re.performDocumentReplaceRange(n.zoneId,[e,0],[e,t],""))},this.isOnLineManager=function(){var e=re.getRep();if(!e.selStart)return!1;var t=e.lines.atIndex(e.selStart[0]);return!(!t.domInfo||!t.domInfo.lineManagerType)},this.isSingleLine=function(e){return he()(e).hasClass("single-line")},this.setDataToClipboard=function(e){var t,n=e.data,r=e.type;n&&n.html&&(t=ue(ue({},n),{type:r}),re.hook.callAll("beforeSetDataToClipboard",t),re.resetCopySource(r),xd.setDataWithoutEvent(Object.assign({},n,{html:re.addUniqueIdIntoHTML(t.html)})))},this.htmlToClientVars=function(e){var n=1,t=function(e){var t=e.id;return t||(e.id=re.editorBase.lineIdPre+n++)},r=[],i=document.createElement("pre");i.innerHTML=To(e,re.domPurifyConfig);var o=new Ne(re),a=Du({collectStyles:!0,abrowser:Ce,apool:o,className2Author:zi,hooks:re.hooks,tagsIgnoreToParse:re.tagsIgnoreToParse,editor:re,formatterRenderer:re.formatterManager});a.collectContent(i);for(var s=a.finish(),l=[],c=s.lines,u=s.lineAttribs,d=0;d<c.length;d++){var f=c[d];l.push(f+"\n");var h=re.createDomLineEntry(f,sr,{uniqueId:t});r[d]=h.domInfo}var p=u.join("|1+1")+"|1+1";return 0===l.length&&l.push("\n"),{initialAttributedText:{text:l.join(""),attribs:p},initialAttributedTexts:{cols:s.additionalZatext.cols,rows:s.additionalZatext.rows,text:Object.assign({},s.additionalZatext.text,{0:l.join("")}),attribs:Object.assign({},s.additionalZatext.attribs,{0:p})},apool:{numToAttrib:o.numToAttrib,nextNum:o.nextNum}}},this.setIdleActionOption=function(e){re.idleWorkTimer.setIdleActionOption(e)},this.getCurrentCallStack=function(){return re.callStack.getCurrentCallStack()},this.getCurrentStack=function(){return re.callStack.getCurrentCallStack()},this.inCallStack=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=re.callStack).inCallStack.apply(e,me(t))},this.inCallStackIfNecessary=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=re.callStack).inCallStackIfNecessary.apply(e,me(t))},this.makeNewEvent=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=re.callStack).makeNewEvent.apply(e,me(t))},this.isCaret=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=re.selection).isCaret.apply(e,me(t))},this.updateBrowserSelectionFromRep=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=re.selection).updateBrowserSelectionFromRep.apply(e,me(t))},this.getEditorProps=function(){return re.props},this._replaceAllText=function(f){var h=re.changesetUnpackedVectorsZoneClear,e=re.inCallStackIfNecessary,p=re.performDocumentApplyChangeset,g={};e("replaceText",function(){var e,t,n,r,i=re.getReps();for(e in i)e!==sr&&(t=i[e],n=re.changesetHelper.builder(t.lines.totalWidth()),r=Vo.endOfZone(re,e),re.changesetHelper.buildRemoveRange(t,n,[0,0],[r.line,r.col]),g[e]=n.toUnpacked());var o=Vo.endOfZone(re,sr),a=new Vo(sr,0,0),s=new Vo(sr,o.line,o.col),l=re.managers.getChildZonesInRangeRecursive(a,s);l.rows.forEach(function(e){g[e]=h(!0,e)}),l.cols.forEach(function(e){g[e]=h(!1,e)});var c=i[sr],u=re.changesetHelper.builder(c.lines.totalWidth(),"Z","0");re.changesetHelper.buildRemoveRange(c,u,[0,0],[s.line,s.col]),u.insert(f,[],re.repManager.apool),g[sr]=u.toUnpacked();var d=re.changesetHelper._pack(g);p(d)})},this.setClientVars=function(e){re.clientVars=Object(v.a)({padShortcutEnabled:or},e),re.inCallStackIfNecessary("importText",function(){var e=re.clientVars,t=e.initialAttributedText,n=e.apool;re.replaceAllByAttributeText(t,n)})},this.getScrollPos=function(){if(Ce.mobile)return window.scrollY;var e=re.getScrollContainer();return e?e.scrollTop:0},this.getShortCut=function(){return re.getRep()},this.setEnable=function(e){re.isEnable=e},this.setSelStart=function(e){re.getRep().selStart=e},this.setSelEnd=function(e){re.getRep().selEnd=e},this.applyToggleAttributeOnRanges=function(e,o,a){var t,n;void 0===a&&(a="true");var s=re.isRangesHaveAttributeApplied(e,o,a),r=function(e){var t=[e.start.line,e.start.col],n=[e.end.line,e.end.col],r=s?[[o,""]]:[[o,a]],i=re.getRep(e.start.zone);re.inCallStackIfNecessary("setAttributesOnRange",function(){i.attributeManager.setAttributesOnRange(t,n,r)},{shouldIncorp:!0})};try{for(var i=ge(e),l=i.next();!l.done;l=i.next())r(l.value)}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},this.removeDom=function(e){var t=re.domToRep(e),n=re.dom.zoneOfRootNode(re.dom.rootNodeOfZoneContaining(e));t&&re.performDocumentReplaceRange(n,t.selStart,t.selEnd,"")},this.isImagePlaceHolderLine=function(e){var t=re.getRep();if(e<0||e>t.lines.length()-1)return!1;var n=Object(W.default)(t.lines.atIndex(e),"lineNode.innerHTML");return n&&-1<n.indexOf("image-placeholder")},this.isImagePreviewerLine=function(e){var t=re.getRep();if(e<0||e>t.lines.length()-1)return!1;var n=Object(W.default)(t.lines.atIndex(e),"lineNode.innerHTML");return!!(n&&-1<n.indexOf("image-previewer"))},this.setClassPresence=function(e,t,n){re.dirtyChecker.observer.withoutRecordingMutations(function(){n?he()(e).addClass(t):he()(e).removeClass(t)})},this.setDesignMode=function(e){try{return re.setIfNecessary(re.getDocBody(),"contenteditable",e?"true":"false"),!e&&re.getInInternationalComposition()&&re.inCallStackIfNecessary("readMode",function(){re.fastIncorp(!0)}),!0}catch(e){return!1}},this.setAttributeOnBatchDom=function(e,t,n){var r=re.getRepsOnBatchDom(e);Object(B.a)(r,function(e){re.getRep(e.selZone).attributeManager.setAttributesOnRange(re.getSelectionWithoutZone(e.selStart),re.getSelectionWithoutZone(e.selEnd),t,n)})},this.setAttributeOnBatchDomWithoutGallery=function(e,t,n,r){var i=re.getRepsOnBatchDomWithoutGallery(e,n);Object(B.a)(i,function(e){re.getRep(e.selStart[2]).attributeManager.setAttributesOnRange(re.getSelectionWithoutZone(e.selStart),re.getSelectionWithoutZone(e.selEnd),t,r)})},this.hasCommentAttr=function(e){return/^comment-(id|resolved|deleted)-[0-9]+$/.test(e)},this.getChoosedImage=function(){var t;return[document.querySelector("#galleryTempStyle"),document.querySelector("#imageTempStyle")].forEach(function(e){e&&(t=e.dataset.id)}),document.getElementById(t)},this.checkIsLinesReplace=function(e,t){var n=re.getRep(e.zone),r=n.selStart,i=n.selEnd;if(r&&r[0]&&i&&i[0]&&!(re.selection.isCaret(n)||re.selection.isOnOneLine()&&re.isSingleLine(n.lines.atIndex(r[0]).domInfo.node))){for(var o=[],a=r[0];a<=i[0];a++){var s,l=n.lines.atIndex(a);!(l.domInfo&&l.domInfo.node&&Oo(l.domInfo.node))||a!==r[0]&&a!==i[0]||(s=Object(W.default)(l,"domInfo.node._magicdom_dirtiness")?Object(W.default)(l,"domInfo.node._magicdom_dirtiness.knownHTML"):"")&&(l.domInfo.node=l.domInfo.node.cloneNode(!0),l.domInfo.node.innerHTML=s),o.push(l)}re.hooks.callAll("linesWillReplace",{oldLineEntries:o,newLineEntries:t,isRemote:!1})}},this.doRepTextSplice=function(e,t,n,r){var i=e.alltext.split("\n");i.splice.apply(i,me([t,n],r)),e.alltext=i.join("\n")},this.getPointForPosition=function(e){return re.enableUnmountNode&&e.zone===sr?re.blockRender.getPointForPosition(e):null},this.getPositionForPoint=function(e,t){return re.enableUnmountNode&&e===sr?re.blockRender.getPositionForPoint(e,t):null},this.getHeadingLineNumIfNecessary=function(e){var t=re.lineTracker.collapseLines,n=null===t||void 0===t?void 0:t.getCollapsedStatusOfLine(sr,e);return n&&n.renderCollapsed&&n.headerLineNum||e},this.handleOldRenderLine=function(e){var t,n,r=e.alines,i=e.apool,o=e.hooks,a=e.zoneId,s=e.lineNum,l=e.node,c={zoneId:a,attributes:re.changesetHelper.getAttributesPerCharacter(r,i),lineNum:s};!o||0<(t=o.callAll("oldRenderLine",c)).length&&(0<(n=t.filter(function(e){return"string"==typeof e})).length&&(l.innerHTML=n.join("")))},e.clientVars||(e.clientVars=zf),e.scroller||console.warn("scroller");var t=e.registerPlugin,n=e.element,r=e.editable,i=e.copyable,o=e.log,a=e.profile,s=e.domPurifyConfig,l=e.fiberConfig,c=e.clientVars;this.props=e,this.profile=a,this.tagsIgnoreToParse=e.tagsIgnoreToParse,this.docbody=e.element,this.docbody.zoneId={value:"0"},this.editable=r,this.copyable=i,this.log=o||console.log.bind(console)||console.log,this.domPurifyConfig=s||{enable:!1},this.hasCollapse=e.hasCollapse||!1,this.compatibleToAce(),this.fiber=new dl(ue({visibilityChange:!0},l)),this.commands=new gc(this),Object(v.a)(this,Object(m.default)(this.commands,Hf)),this.dom=new Dom({root:this.docbody,editor:this}),this.registerEventEmitter(),this.initBrowserEnv(),this.changesetHelper=new wr(this),this.repManager=new Yr(this,this.performDocumentApplyChangeset);var u=this.registerPlugin(t);this.hooks=this.hook=wf(this,u);var d=this.editable;this.domLine=Fo.create({nonEmpty:!0,doesWrap:!0,optBrowser:Ce,optDocument:document,hooks:this.hook,formatterRenderer:this.formatterManager,editor:this}),Object(v.a)(this,this.domLine),this.editable=d,this.formatterManager=new If({editor:this,formatters:u});var f,h=this.editorBase=new Ho({hook:this.hook,domLine:this.domLine,magicId:++Wf,formatterRenderer:this.formatterManager});this.managers=new Rd(this,this.contentTypeRegistry),e.defaultHtml&&e.clientVars===zf&&(f=this.htmlToClientVars(e.defaultHtml),h.nextId=1,c=e.clientVars=f),this.props.maxListLevel&&(this.maxListLevel=this.props.maxListLevel);var p=h.lineIdPre,g=h.uniqueId;e=Object(ne.a)(e,function(e){return void 0!==e}),this.props=ue(ue({},Ff),e),this.clientVars=Object(v.a)({padShortcutEnabled:or},c),this.lineIdPre=p,this.uniqueId=g,this.isEnable=!0,this.selection=new ra(this,this.docbody,this.props.ut),this.callStack=new Yl(this),this.idleWorkTimer=new Uc(this,!1,{time:this.props.idleWorkTime,forbid:this.props.idleWorkForbid}),this.dirtyChecker=new Ul(this),this.viewPort=new Xl(this),this.resizeStrategy=this.props.resizeStrategy,this.undoModule=new fc({enabled:!0,apool:this.repManager.apool,eventFunc:this.handleRedoUndo,editor:this}),this.editorUniqueId=qi(),this.changesetTracker=this.initTracker(),this.translator=new Af(this),this.handleSelectionChange=Object(y.default)(this.fixSelection,300),Object(B.a)(this.hook.callAll("aceRegisterBlockElements"),function(e){re._blockElems[e]=1}),Object(v.a)(this,Object(m.default)(this.selection,Hf)),Object(v.a)(this,Object(m.default)(this.callStack,Hf)),Object(v.a)(this,Object(m.default)(this.dirtyChecker,Hf)),Object(v.a)(this,Object(m.default)(this.viewPort,Hf)),Object(v.a)(this,Object(m.default)(this.changesetTracker,Hf)),this.blockRender=new(this.enableUnmountNode?Fl:jc)({editor:this,config:this.props.renderConfig}),this.compatibleToAce(),this.initResizeStrategy(),this.lineTracker=new Vu(this,this.repManager.apool,this.hasCollapse),this.setDocAttribute(n,r),this.setRect(),this.initContent(),this.withoutBlockingRender(function(){re.bindEditorEvent(n),re.getBoundAsync(function(e){e.width,e.height;re.togglePlaceHolder()})})}function Gf(e){void 0===e&&(e="");var t=new RegExp(Cn).test(e);return/^https?:|^mailto:|^ftp:/.test(e)?e:t?"mailto:"+e:(e.startsWith("http")||(e="http://"+e),e)}var qf={MENTION:"mention",HYPERLINK:"url",TEXT:"text"},Jf=/url-/,Yf="mention-link",Qf="mention-type",Xf="mention-token",$f="mention-notify",eh="mention-icon";function th(e){var f="",h=new Ne,p=[],g="";return h.putAttrib(["author","test"]),Object(B.a)(e,function(e){var t=e.text,n=e.type,r=e.mentionType,i=e.link,o=e.token,a=e.icon,s=e.mentionNotify,l=t.split("\n");f+=e.text,null===s&&(s=!0);for(var c=0,u=l.length;c<u;c++){var d=sh(l[c].length);if(d)switch(n){case qf.MENTION:e.attributes?e.attributes.forEach(function(e){g+="*"+Object(F.numToString)(h.putAttrib(e))}):(g+="*"+Object(F.numToString)(h.putAttrib(["mention",!0])),g+="*"+Object(F.numToString)(h.putAttrib([Xf,o])),g+="*"+Object(F.numToString)(h.putAttrib([Qf,String(r)])),g+="*"+Object(F.numToString)(h.putAttrib([Yf,i])),g+="*"+Object(F.numToString)(h.putAttrib([$f,s])),a&&(g+="*"+Object(F.numToString)(h.putAttrib([eh,a])))),g+="+"+d;break;case qf.HYPERLINK:g+="*"+Object(F.numToString)(h.putAttrib(["url-"+Gi(10),Gf(i||t)])),g+="+"+d+"*0";break;case qf.TEXT:default:g+="+"+d+"*0"}1<u&&c<u-1&&(g+="|1+1",p.push(g),g="")}}),"*0"!==g&&p.push(g+"|1+1"),{apool:h,initialAttributedText:{attribs:p.join(""),text:f+"\n"}}}function nh(e,t){void 0===t&&(t={});for(var n=e.apool,r=e.alines,i=t.linkReg,o=e.alltext,a=qf.MENTION,s=qf.HYPERLINK,l=qf.TEXT,c=[],u=0,d="",o=o.slice(0,-1),f=Object(F.opIterator)(r.join(""));f.hasNext();){var h=f.next(),p=h.chars,g=h.attribs,v=g.split("*"),m=o.slice(u,u+p);u+=p;var y=oh(m,v,n,i);switch(y){case a:var b=xr(v,n),E=b[Qf],k=b[Xf],C=b[Yf],I=b[$f],S=b[eh],T=null===(T=I)||"true"===T;c.push({text:m,type:y,mentionType:parseInt(E),mentionNotify:T,token:k,link:C,icon:S,attribs:g}),d="";break;case s:var O=rh(d,m,i);O.length?c=c.concat(O):(d.length&&c.push({text:d,type:l,attribs:g}),c.push({text:m,type:y,link:Gf(ih(v,n)),attribs:g})),d="";break;case l:m&&c.push({text:m,type:l,attribs:g})}}return c}function rh(e,t,n){void 0===n&&(n=kn);var r,s=qf.HYPERLINK,l=qf.TEXT,c=e+t,i=c.length;n.lastIndex=0;for(var o=[];r=n.exec(c);){var a=r[0],u=r.index;o.push({startIndex:u,endIndex:u+a.length,text:a})}var d,f=[];return o.length&&(o.unshift({startIndex:0,endIndex:0}),(d=Object(oe.a)(o.slice(1),function(e,t){var n=e.endIndex,r=t.startIndex,i=t.endIndex,o=c.slice(n,r);o&&f.push({text:o,type:l});var a=c.slice(r,i);return f.push({text:a,type:s,link:Gf(a)}),t},o[0])).endIndex<i&&f.push({text:c.slice(d.endIndex,i),type:l})),f}function ih(e,t){var n="";return ah(e,t,function(e){return!!Jf.test(e[0])&&(n=e[1],!0)}),n}function oh(t,e,n,r){void 0===r&&(r=kn);var i=qf.MENTION,o=qf.TEXT,a=qf.HYPERLINK,s=null;return ah(e,n,function(e){return!!new RegExp(i+"-token").test(e[0])&&(s=i,!0)}),null===s&&ah(e,n,function(e){return!(!Jf.test(e[0])&&!r.test(t))&&(s=a,!0)}),s||o}function ah(e,t,n){for(var r=t.numToAttrib,i=0,o=e.length;i<o;i++)if(n(r[parseInt(e[i],36)]||[],i))break}function sh(e){return(e||"").toString(36)}var lh,ch=function(e){var t=e.commentEditor.editor.getRep(),n=t.lines.length()-1,r=t.lines.atIndex(n),i=r&&r.text.length;e.commentEditor.editor.setSel([n,i],[n,i],!0)},uh=function e(t){if(t.nodeType===Node.TEXT_NODE)return t.textContent;var n=getComputedStyle(t);if(n&&"none"===n.display)return"";for(var r="",i=0;i<t.childNodes.length;i++)r+=e(t.childNodes[i]);return r},dh=(ce(fh,lh=re.Component),fh.prototype.componentDidMount=function(){var e=this.options,t=e.clientVars,n=e.editable,r=void 0===n||n,i=e.copyable,o=void 0===i||i;try{this.editor=new Kf(ue(ue({},this.props),{clientVars:t,editable:r,copyable:o,element:this.docbody}))}catch(e){console.log(e.stack),Ue("[EditorReact] new Editor error")}},fh.prototype.componentDidUpdate=function(e){var t=this.props,n=t.editable,r=t.copyable;n!==e.editable&&this.editor.setEditable(n),r!==e.copyable&&this.editor.setCopyable(r)},fh.prototype.componentWillUnmount=function(){this.editor&&this.editor.destory()},fh.prototype.getEditorText=function(){var t,e,n="",r=Array.from(this.docbody.childNodes);try{for(var i=ge(r),o=i.next();!o.done;o=i.next()){var a=o.value;n+=uh(a)+"\n"}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return"\n"===n[n.length-1]&&(n=n.slice(0,-1)),n.replace(/\u200B/g,"")},fh.prototype.getSegmentArray=function(e){var t=this;return void 0===e&&(e={}),this.editor.callStack.inCallStackIfNecessary("getSegment",function(){t.editor.fastIncorp()}),nh(this.editor.getRep(),e)},fh.prototype.replaceEditorValue=function(e){var t,n,r;Array.isArray(e)?(n=(t=th(e)).initialAttributedText,r=t.apool,this.editor.replaceAllByAttributeText(n,r)):this.editor.replaceAllText(e)},fh.prototype.setSelectionToLastCharacter=function(){var e=this.editor.getRep(),t=e.lines.length()-1,n=e.lines.atIndex(t),r=n&&n.text.length;this.editor.setSel([t,r],[t,r],!0)},fh.prototype.render=function(){var t=this,e=Object(m.default)(this.props,["registerPlugin","clientVars","editorDidUpdate","onResize","editable","copyable","inEmbed","renderConfig","fiberConfig","hasCollapse","domPurifyConfig","profile","idleWorkTimer","scroller","onMount","tagsIgnoreToParse","resizeStrategy","log","bus"]);return ie.a.createElement("div",ue({style:this.props.style,ref:function(e){return t.docbody=e}},e))},fh);function fh(e){var t=lh.call(this,e)||this;return t.options=e,t}var hh,ph=1,gh=1005,vh=1015,mh=1016,yh=1014,bh=1012,Eh=9999,kh=1e5,Ch=1008,Ih=1012,Sh=1013,Th=1017,Oh=1020,wh=1021,Rh=1023,Ah=1024,xh=1025,Mh=[vh,Eh,kh,wh],Nh=[ph,gh,yh,bh,mh,Ch,Ih,Sh,Th,Oh,Rh,Ah,xh],_h=Object.freeze({__proto__:null,FAILD:ph,INVALID_CHANGESET:gh,WAIT_FOR_REDIS_LOCK:vh,CHECK_FAILD:mh,EDIT_FAILED:yh,CAN_NOT_EDIT:bh,UNKONW_ERROR:Eh,NET_WORK_ERROR:kh,ALGO_ERROR:Ch,NO_EDITOR_PERMISSION:Ih,NO_COMMENT_PERMISSION:Sh,OUT_OF_LIMIT:Th,OUT_OF_BLOCK_LIMIT:Oh,DB_STORE_CONFLICT:wh,XSS_LEAK:Rh,NOT_SUPPORT_BLOCK:Ah,CS_OUT_OF_LIMIT:xh,noPopUp:Mh,removeLocals:Nh}),Lh="h1",Dh="h2",Bh="h3",Ph="bold",Fh="italic",jh="underline",zh="strikethrough",Hh="alignleft",Uh="aligncenter",Vh="alignright",Wh="insertorderedlist",Kh="insertunorderedlist",Zh="blockquote",Gh="insertseparator",qh="link",Jh="checkbox",Yh="insertimage",Qh="undo",Xh="redo",$h="sheet",ep="backcolor",tp=((hh={})[Lh]={windows:{altKey:!0,ctrlKey:!0,keyCode:49},mac:{altKey:!0,metaKey:!0,keyCode:49}},hh[ep]={windows:{keyCode:72,ctrlKey:!0,altKey:!0},mac:{keyCode:72,metaKey:!0,altKey:!0}},hh[Dh]={windows:{altKey:!0,ctrlKey:!0,keyCode:50},mac:{altKey:!0,metaKey:!0,keyCode:50}},hh[Bh]={windows:{altKey:!0,ctrlKey:!0,keyCode:51},mac:{altKey:!0,metaKey:!0,keyCode:51}},hh[Ph]={windows:{key:"b",ctrlKey:!0},mac:{metaKey:!0,key:"b"}},hh[Fh]={windows:{key:"i",ctrlKey:!0},mac:{key:"i",metaKey:!0}},hh[jh]={windows:{key:"u",ctrlKey:!0},mac:{key:"u",metaKey:!0}},hh[zh]={windows:{key:"x",ctrlKey:!0,shiftKey:!0},mac:{key:"x",metaKey:!0,shiftKey:!0}},hh[Hh]={titleEnable:!0,mentionEnable:!0,windows:{key:"l",ctrlKey:!0,shiftKey:!0},mac:{key:"l",metaKey:!0,shiftKey:!0}},hh[Uh]={titleEnable:!0,mentionEnable:!0,windows:{key:"e",ctrlKey:!0,shiftKey:!0},mac:{key:"e",metaKey:!0,shiftKey:!0}},hh[Vh]={titleEnable:!0,mentionEnable:!0,windows:{key:"r",ctrlKey:!0,shiftKey:!0},mac:{key:"r",metaKey:!0,shiftKey:!0}},hh[Wh]=[{imageEnable:!1,windows:{key:"7",ctrlKey:!0,shiftKey:!0},mac:{key:"7",metaKey:!0,shiftKey:!0}},{imageEnable:!1,windows:{key:"&",ctrlKey:!0,shiftKey:!0},mac:{key:"&",metaKey:!0,shiftKey:!0}}],hh[Kh]=[{imageEnable:!1,windows:{key:"8",ctrlKey:!0,shiftKey:!0},mac:{key:"8",metaKey:!0,shiftKey:!0}},{imageEnable:!1,windows:{key:"*",ctrlKey:!0,shiftKey:!0},mac:{key:"*",metaKey:!0,shiftKey:!0}}],hh[Zh]={windows:{keyCode:190,shiftKey:!0,ctrlKey:!0},mac:{keyCode:190,shiftKey:!0,metaKey:!0}},hh[Gh]={windows:{ctrlKey:!0,which:"s",altKey:!0},mac:{metaKey:!0,which:"s",altKey:!0}},hh[qh]={titleEnable:!0,windows:{ctrlKey:!0,key:"k"},mac:{metaKey:!0,key:"k"}},hh[Jh]={imageEnable:!1,windows:{ctrlKey:!0,which:"t",altKey:!0},mac:{metaKey:!0,which:"t",altKey:!0}},hh[Yh]={listEnable:!1,windows:{ctrlKey:!0,which:"u",shiftKey:!0},mac:{metaKey:!0,which:"u",shiftKey:!0}},hh[Qh]={windows:{ctrlKey:!0,which:"z"},mac:{metaKey:!0,which:"z"}},hh[Xh]=[{windows:{ctrlKey:!0,which:"z",shiftKey:!0},mac:{metaKey:!0,which:"z",shiftKey:!0}},{windows:{ctrlKey:!0,which:"y"}}],hh[$h]={windows:{},mac:{},imageEnable:!1},hh);function np(o){var t,e,a="",s=0,l="",n=function(i){L.a.mac?a="mac":L.a.windows?a="windows":L.a.linux&&(a="linux");var e=tp[i],t=e;Object(c.a)(e)||(t=[e]),t.forEach(function(e){var t=(t=e[a])||e.windows,n=Object(se.a)(t),r=Object(ae.a)(o,n);void 0!==r.which&&(r.which=String.fromCharCode(r.which).toLowerCase()),r.key&&(r.key=r.key.toLowerCase()),JSON.stringify(t)===JSON.stringify(r)&&n.length>s&&(l=i,s=n.length)})};try{for(var r=ge(Object.keys(tp)),i=r.next();!i.done;i=r.next())n(i.value)}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return l}var rp=Object.freeze({__proto__:null,H1:Lh,H2:Dh,H3:Bh,BOLD:Ph,ITALIC:Fh,UNDERLINE:jh,STRIKETHROUGH:zh,ALIGNLEFT:Hh,ALIGNCENTER:Uh,ALIGNRIGHT:Vh,INSERTORDEREDLIST:Wh,INSERTUNORDEREDLIST:Kh,BLOCKQUOTE:Zh,INSERTSEPARATOR:Gh,LINK:qh,CHECKBOX:Jh,INSERT_IMAGE:Yh,UNDO:Qh,REDO:Xh,SHEET:$h,BACKCOLOR:ep,KEY_MAPS:tp,getHotKeyName:np});function ip(e,t,n){var r=e.getReps(),i=r[0].alines,o=r[0].apool.attribToNum,a="aceTable,",s="gallery,",l=sp(o,t),c=ap(o,[a,s]);return op(e,t,l,lp(i,Object(v.a)(l,c),n),n)}function op(y,b,E,k,C){var t,e,I="comment-id-",S="aceTable,",T="gallery,",O=[],n=function(s){var e=k[s];if(-1<e.indexOf(b)){var t={lineNum:Number(s)};if(!C)return{value:t};O.push(t)}for(var n=0,r=e.length;n<r;n++){var i=e[n];if(i.includes(S))for(var o=y.getVectorReps(),l=cp(y.getReps(),o,i),a=function(e,t){var n=l[e],r=n.alines,i=n.cellId;if(!r)return"continue";var o=lp(r,E,C);if(Object(D.default)(o))return"continue";var a=op(y,b,E,o,C);return C&&!a.length||!C&&-1===a.lineNum?"continue":C?void a.forEach(function(e){e.cellId=i;var t={lineNum:Number(s),table:e};O.push(t)}):(a.cellId=i,{value:{lineNum:Number(s),table:a}})},c=0,u=l.length;c<u;c++){var d=a(c,u);if("object"===fe()(d))return d}if(i.includes(T)&&b.includes(I))try{for(var f=JSON.parse(i.substring(8)).items,c=0,h=f.length;c<h;c++)for(var p=f[c].comments,g=0,v=p.length;g<v;g++){var m=p[g];if(b.includes(m)){t={lineNum:Number(s),gallery:{itemIndex:c,commentIndex:g}};if(!C)return{value:t};O.push(t)}}}catch(e){y.log(e)}}};try{for(var r=ge(Object.keys(k)),i=r.next();!i.done;i=r.next()){var o=n(i.value);if("object"===fe()(o))return o.value}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return C?O:{lineNum:-1}}function ap(t,e){var n={};return e.forEach(function(e){Object(v.a)(n,sp(t,e))}),n}function sp(e,t){var n,r={};for(n in e)n.includes(t)&&(r[n]=e[n]);return r}function lp(e,t,c){var n,r,u={},d={};try{for(var i=ge(Object.keys(t)),o=i.next();!o.done;o=i.next()){var a=o.value,s=pp(t[a]);u[a]=gp(s)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return e.forEach(function(e,n){var t,r,i=[];try{for(var o=ge(Object.keys(u)),a=o.next();!a.done;a=o.next()){var s=a.value,l=u[s].exec(e);l&&(i.push({key:s,index:l.index}),c||delete u[s])}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}i.length&&(i.sort(function(e,t){return e.index-t.index}),d[n]=[],i.forEach(function(e){var t=e.key;d[n].push(t)}))}),d}function cp(e,t,n){var r=fp(n);return r?up(e,dp(t,r)):[]}function up(t,e){var n=[];return e.forEach(function(e){n.push({alines:t[e]&&t[e].alines,cellId:e})}),n}function dp(e,t){var n=t.rowId,r=t.colId,i=[],o=e[n]&&e[n].vectorIds,a=e[r]&&e[r].vectorIds;return o&&a&&o.forEach(function(t){a.forEach(function(e){i.push(eu(t,e))})}),i}function fp(e){var t=/(^|\s*)aceTable,([a-zA-Z0-9]+)\s([a-zA-Z0-9]+)(\s|$)/.exec(e);return t?{rowId:t[2],colId:t[3]}:null}function hp(e){return Object(s.a)(e)}function pp(e){return"*"+e.toString(36)}function gp(e){return new RegExp("\\"+e+"([+|*])")}var vp,mp=Object.freeze({__proto__:null,getLineNumberByAttrFromEditor:ip,getMutiAttrsByKeysFromNTA:ap,getAttrsByKeyFromNTA:sp,getLineToAttrsByATNFromAlines:lp,getCellAlinesByAttrFromRepsAndVector:cp,getAlinesByCellIdsFromReps:up,getSortedTableCellIdsByTableIdFromVectorReps:dp,getRowAndColIdFromTableAttr:fp,makeNumberObjectToArray:hp,makeAttrString:pp,makeAttrRegExp:gp}),yp=(ce(bp,vp=lf),bp.setTags=function(e){return[]},bp.setClass=function(e){return[]},bp.setStyle=function(e){return[]},bp.isFormatter=!0,bp);function bp(){return null!==vp&&vp.apply(this,arguments)||this}var Ep,kp=(ce(Cp,Ep=lf),Cp.setValue=function(e,t){return{}},Cp.prototype.formatAttributes=function(e,t,n){return[]},Cp.prototype.getFormatAttributes=function(e){return e},Cp.isTreeFormatter=!0,Cp.relativeAttrKeys=[],Cp);function Cp(){return null!==Ep&&Ep.apply(this,arguments)||this}var Ip=Object.freeze({__proto__:null})},GSgQ:function(e,t,n){"use strict";n.r(t),n.d(t,"TransformType",function(){return h});var h,r,i=n("cDf5"),p=n.n(i),o=n("XIp8"),d=n("Muja"),a=n("xk4V"),s=n.n(a),v=n("+om4"),g=function(e,t){for(var n,r="data",i=((n={})[r]=e,n),o=0;o<t.length;){if(i=i[r],r=t[o],void 0===i)throw new Error("bad path");o+=1}return{elem:i,key:r}},l=function(e){if(e instanceof Array)return e;if("number"==typeof e)return[e];if("string"==typeof e)return e.split(".");throw new Error("Invalid type of path: "+p()(e))},c=function(e,t,n,r){var i,o=Array.prototype.slice.call(t),a=[];return 1<n.length&&"function"!=typeof o[o.length-1]&&o.push(function(){}),o.length<(r||n.length)?o.unshift(a):(i=l(o[0]))&&(o[0]=a.concat(i)),n.apply(e,o)};function w(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function f(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}function m(e,i,I,S){var T=function(e,t,n,r){i(n,e,t,"left"),i(r,t,e,"right")},O=e.transformX=function(e,t){var n,r,i,o,a,s;I(e),I(t);var l=[];try{for(var c=w(t),u=c.next();!u.done;u=c.next()){for(var d=u.value,f=[],h=0;h<e.length;){var p=[];if(T(e[h],d,f,p),h++,1!==p.length){if(0===p.length){for(var g=h;g<e.length;g++)S(f,e[g]);d=null;break}var v=O(e.slice(h),p);try{for(var m=(i=void 0,w(v[0])),y=m.next();!y.done;y=m.next()){var b=y.value;S(f,b)}}catch(e){i={error:e}}finally{try{y&&!y.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}try{for(var E=(a=void 0,w(v[1])),k=E.next();!k.done;k=E.next()){var C=k.value;S(l,C)}}catch(e){a={error:e}}finally{try{k&&!k.done&&(s=E.return)&&s.call(E)}finally{if(a)throw a.error}}d=null;break}d=p[0]}null!=d&&S(l,d),e=f}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return[e,l]};e.transform=function(e,t,n){if("left"!==n&&"right"!==n)throw new Error("type must be 'left' or 'right'");return 0===t.length?e:1===e.length&&1===t.length?i([],e[0],t[0],n):"left"===n?O(e,t)[0]:O(t,e)[1]}}(r=h=h||{}).LEFT="left",r.RIGHT="right";var y={name:"text0",uri:"http://sharejs.org/types/textv0",create:function(e){if(null!=e&&"string"!=typeof e)throw new Error("Initial data must be a string");return e||""}},b=function(e,t,n){return e.slice(0,t)+n+e.slice(t)},E=function(e){if("number"!=typeof e.p)throw new Error("component missing position field");if("string"==typeof e.i==("string"==typeof e.d))throw new Error("component needs an i or d field");if(e.p<0)throw new Error("position cannot be negative")},k=function(e){for(var t=0;t<e.length;t++)E(e[t])};y.apply=function(e,t){var n;k(t);for(var r=0;r<t.length;r++){var i=t[r];if(null!=i.i)e=b(e,i.p,i.i);else{if(n=e.slice(i.p,i.p+i.d.length),i.d!==n)throw new Error("Delete component '"+i.d+"' does not match deleted text '"+n+"'");e=e.slice(0,i.p)+e.slice(i.p+i.d.length)}}return e};var C=y._append=function(e,t){var n;""!==t.i&&""!==t.d&&(0===e.length?e.push(t):null!=(n=e[e.length-1]).i&&null!=t.i&&n.p<=t.p&&t.p<=n.p+n.i.length?e[e.length-1]={i:b(n.i,t.p-n.p,t.i),p:n.p}:null!=n.d&&null!=t.d&&t.p<=n.p&&n.p<=t.p+t.d.length?e[e.length-1]={d:b(t.d,n.p-t.p,n.d),p:t.p}:e.push(t))};y.compose=function(e,t){k(e),k(t);for(var n=e.slice(),r=0;r<t.length;r++)C(n,t[r]);return n},y.normalize=function(e){var t=[];null==e.i&&null==e.p||(e=[e]);for(var n=0;n<e.length;n++){var r=e[n];null==r.p&&(r.p=0),C(t,r)}return t};var I=function(e,t,n){return null!=t.i?t.p<e||t.p===e&&n?e+t.i.length:e:e<=t.p?e:e<=t.p+t.d.length?t.p:e-t.d.length};y.transformCursor=function(e,t,n){for(var r="right"===n,i=0;i<t.length;i++)e=I(e,t[i],r);return e};var S=y._tc=function(e,t,n,r){if(E(t),E(n),null!=t.i)C(e,{i:t.i,p:I(t.p,n,"right"===r)});else if(null!=n.i){var i=t.d;t.p<n.p&&(C(e,{d:i.slice(0,n.p-t.p),p:t.p}),i=i.slice(n.p-t.p)),""!==i&&C(e,{d:i,p:t.p+n.i.length})}else if(t.p>=n.p+n.d.length)C(e,{d:t.d,p:t.p-n.d.length});else if(t.p+t.d.length<=n.p)C(e,t);else{var o={d:"",p:t.p};t.p<n.p&&(o.d=t.d.slice(0,n.p-t.p)),t.p+t.d.length>n.p+n.d.length&&(o.d+=t.d.slice(n.p+n.d.length-t.p));var a=Math.max(t.p,n.p),s=Math.min(t.p+t.d.length,n.p+n.d.length);if(t.d.slice(a-t.p,s-t.p)!==n.d.slice(a-n.p,s-n.p))throw new Error("Delete ops delete different text in the same region of the document");""!==o.d&&(o.p=I(o.p,n),C(e,o))}return e},T=function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}};y.invert=function(e){e=e.slice().reverse();for(var t=0;t<e.length;t++)e[t]=T(e[t]);return e},m(y,S,k,C);var O=function(e){return"[object Array]"===Object.prototype.toString.call(e)},R=function(e){return!!e&&e.constructor===Object},x=function(e){return JSON.parse(JSON.stringify(e))},M={name:"json0",uri:"http://sharejs.org/types/JSONv0"},N={};function _(e){e.subType=e.subType||{},e.subType.t="text0";var t={p:e.p.pop()};e.action&&null!=e.action.si&&(t.i=e.action.si),e.action&&null!=e.action.sd&&(t.d=e.action.sd),e.subType.o=[t]}function L(e){e.p.push(e.subType.o[0].p),null!=e.subType.o[0].i&&(e.action.si=e.subType.o[0].i),null!=e.subType.o[0].d&&(e.action.sd=e.subType.o[0].d),delete e.subType.t,delete e.subType.o,delete e.subType}M.registerSubtype=function(e){N[e.name]=e},M.create=function(e){return void 0===e?null:x(e)},M.invertComponent=function(e,t){var n,r={p:e.p,action:{}};return e.subType&&e.subType.t&&N[e.subType.t]&&(r.subType=r.subType||{},r.subType.t=e.subType.t,n=t&&t[e.p],r.subType.o=N[e.subType.t].invert(e.subType.o,n)),e.action&&void 0!==e.action.si&&(r.action.sd=e.action.si),e.action&&void 0!==e.action.sd&&(r.action.si=e.action.sd),e.action&&void 0!==e.action.oi&&(r.action.od=e.action.oi),e.action&&void 0!==e.action.od&&(r.action.oi=e.action.od),e.action&&void 0!==e.action.li&&(r.action.ld=e.action.li),e.action&&void 0!==e.action.ld&&(r.action.li=e.action.ld),e.action&&void 0!==e.action.na&&(r.action.na=-e.action.na),e.action&&void 0!==e.action.lm&&(r.action.lm=e.p[e.p.length-1],r.p=e.p.slice(0,e.p.length-1).concat([e.action.lm])),r},M.invert=function(e,t){for(var n=e.slice().reverse(),r=[],i=0;i<n.length;i++)r.push(M.invertComponent(n[i],t));return r},M.checkValidOp=function(e){for(var t=0;t<e.length;t++)if(!O(e[t].p))throw new Error("Missing path")},M.checkList=function(e){if(!O(e))throw new Error("Referenced element not a list")},M.checkObj=function(e){if(!R(e))throw new Error("Referenced element not an object (it was "+JSON.stringify(e)+")")},M.apply=function(e,t){M.checkValidOp(t),t=x(t);for(var n={data:e},r=0;r<t.length;r++){var i=t[r];!i.action||null==i.action.si&&null==i.action.sd||_(i);for(var o,a=null,s=n,l="data",c=0;c<i.p.length;c++){var u=i.p[c],a=s,s=s[l],l=u;if(null==a)throw new Error("Path invalid")}if(i.subType&&i.subType.t&&void 0!==i.subType.o&&N[i.subType.t])s[l]=N[i.subType.t].apply(s[l],i.subType.o);else if(i.action&&void 0!==i.action.na){if("number"!=typeof s[l])throw new Error("Referenced element not a number");s[l]+=i.action.na}else if(i.action&&void 0!==i.action.li&&void 0!==i.action.ld){if(M.checkList(s),!Object(d.default)(s[l],i.action.ld))throw new Error("element does not match c.ld");s[l]=i.action.li}else if(i.action&&void 0!==i.action.li)M.checkList(s),s.splice(l,0,i.action.li);else if(i.action&&void 0!==i.action.ld){if(M.checkList(s),!Object(d.default)(s[l],i.action.ld))throw new Error("element does not match c.ld");s.splice(l,1)}else if(i.action&&void 0!==i.action.lm)M.checkList(s),i.action.lm!=l&&(o=s[l],s.splice(l,1),s.splice(i.action.lm,0,o));else if(i.action&&void 0!==i.action.oi)M.checkObj(s),s[l]=i.action.oi;else{if(!i.action||void 0===i.action.od)throw new Error("invalid / missing instruction in op");M.checkObj(s),delete s[l]}}return n.data},M.shatter=function(e){for(var t=[],n=0;n<e.length;n++)t.push([e[n]]);return t},M.incrementalApply=function(e,t,n){for(var r=0;r<t.length;r++){var i=[t[r]];n(i,e=M.apply(e,i))}return e};var D=M.pathMatches=function(e,t,n){if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r]&&(!n||r!==e.length-1))return!1;return!0};M.append=function(e,t){if(t=x(t),0!==e.length){var n=e[e.length-1];if(!t.action||!n.action||null==t.action.si&&null==t.action.sd||null==n.action.si&&null==n.action.sd||(_(t),_(n)),D(t.p,n.p))if(t.subType&&t.subType.t&&n.subType&&n.subType.t&&t.subType.t===n.subType.t&&N[t.subType.t]){if(n.subType.o=N[t.subType.t].compose(n.subType.o,t.subType.o),t.action&&(null!=t.action.si||null!=t.action.sd)){for(var r=t.p,i=0;i<n.subType.o.length-1;i++)t.subType.o=[n.subType.o.pop()],t.p=r.slice(),L(t),e.push(t);L(n)}}else n.action&&null!=n.action.na&&null!=t.action.na?e[e.length-1]={p:n.p,action:{na:n.action.na+t.action.na}}:n.action&&t.action&&void 0!==n.action.li&&void 0===t.action.li&&t.action.ld===n.action.li?void 0!==n.action.ld?delete n.action.li:e.pop():n.action&&t.action&&void 0!==n.action.od&&void 0===n.action.oi&&void 0!==t.action.oi&&void 0===t.action.od?n.action.oi=t.action.oi:n.action&&t.action&&void 0!==n.action.oi&&void 0!==t.action.od?t.action&&void 0!==t.action.oi?n.action.oi=t.action.oi:n.action&&void 0!==n.action.od?delete n.action.oi:e.pop():t.action&&void 0!==t.action.lm&&t.p[t.p.length-1]===t.action.lm||e.push(t);else!t.action||!n.action||null==t.action.si&&null==t.action.sd||null==n.action.si&&null==n.action.sd||(L(t),L(n)),e.push(t)}else e.push(t)},M.compose=function(e,t){M.checkValidOp(e),M.checkValidOp(t);for(var n=x(e),r=0;r<t.length;r++)M.append(n,t[r]);return n},M.normalize=function(e){var t=[];e=O(e)?e:[e];for(var n=0;n<e.length;n++){var r=e[n];null==r.p&&(r.p=[]),M.append(t,r)}return t},M.commonLengthForOps=function(e,t){var n=e.p.length,r=t.p.length;if((e.action&&null!=e.action.na||e.subType&&e.subType.t)&&n++,(t.action&&null!=t.action.na||t.subType&&t.subType.t)&&r++,0===n)return-1;if(0===r)return null;n--,r--;for(var i=0;i<n;i++){var o=e.p[i];if(r<=i||o!==t.p[i])return null}return n},M.canOpAffectPath=function(e,t){return null!=M.commonLengthForOps({p:t},e)},M.transformComponent=function(e,t,n,r){t=x(t);var i=M.commonLengthForOps(n,t),o=M.commonLengthForOps(t,n),a=t.p.length,s=n.p.length;if((t.action&&null!=t.action.na||t.subType&&t.subType.t)&&a++,(n.action&&null!=n.action.na||n.subType&&n.subType.t)&&s++,null!=o&&a<s&&t.p[o]==n.p[o]&&(t.action&&void 0!==t.action.ld?((c=x(n)).p=c.p.slice(a),t.action.ld=M.apply(x(t.action.ld),[c])):t.action&&void 0!==t.action.od&&((c=x(n)).p=c.p.slice(a),t.action.od=M.apply(x(t.action.od),[c]))),null!=i){var l=a==s,c=n;if(!t.action||!n.action||null==t.action.si&&null==t.action.sd||null==n.action.si&&null==n.action.sd||(_(t),_(c=x(n))),c.subType&&c.subType.t&&N[c.subType.t]){if(t.subType&&t.subType.t&&t.subType.t===c.subType.t){var u=N[t.subType.t].transform(t.subType.o,c.subType.o,r);if(!t.action||null==t.action.si&&null==t.action.sd)(!O(u)||0<u.length)&&(t.subType=t.subType||{},t.subType.o=u,M.append(e,t));else for(var d=t.p,f=0;f<u.length;f++)t.subType=t.subType||{},t.subType.o=[u[f]],t.p=d.slice(),L(t),M.append(e,t);return e}}else if(!n.action||void 0===n.action.na)if(n.action&&void 0!==n.action.li&&void 0!==n.action.ld){if(n.p[i]===t.p[i]){if(!l)return e;if(t.action&&void 0!==t.action.ld){if(!t.action||void 0===t.action.li||"left"!==r)return e;t.action.ld=x(n.action.li)}}}else if(n.action&&void 0!==n.action.li)t.action&&void 0!==t.action.li&&void 0===t.action.ld&&l&&t.p[i]===n.p[i]?"right"===r&&t.p[i]++:n.p[i]<=t.p[i]&&t.p[i]++,t.action&&void 0!==t.action.lm&&l&&n.p[i]<=t.action.lm&&t.action.lm++;else if(n.action&&void 0!==n.action.ld){if(t.action&&void 0!==t.action.lm&&l){if(n.p[i]===t.p[i])return e;var d=n.p[i],h=t.p[i];(d<(p=t.action.lm)||d===p&&h<p)&&t.action.lm--}if(n.p[i]<t.p[i])t.p[i]--;else if(n.p[i]===t.p[i]){if(s<a)return e;if(t.action&&void 0!==t.action.ld){if(void 0===t.action.li)return e;delete t.action.ld}}}else if(n.action&&void 0!==n.action.lm)if(t.action&&void 0!==t.action.lm&&a===s){var h=t.p[i],p=t.action.lm,g=n.p[i],v=n.action.lm;if(g!==v)if(h===g){if("left"!==r)return e;t.p[i]=v,h===p&&(t.action.lm=v)}else g<h&&t.p[i]--,v<h?t.p[i]++:h===v&&v<g&&(t.p[i]++,h===p&&t.action.lm++),(g<p||p===g&&h<p)&&t.action.lm--,v<p?t.action.lm++:p===v&&(g<v&&h<p||v<g&&p<h?"right"===r&&t.action.lm++:h<p?t.action.lm++:p===g&&t.action.lm--)}else t.action&&void 0!==t.action.li&&void 0===t.action.ld&&l?(h=n.p[i],p=n.action.lm,h<(d=t.p[i])&&t.p[i]--,p<d&&t.p[i]++):(h=n.p[i],p=n.action.lm,(d=t.p[i])===h?t.p[i]=p:(h<d&&t.p[i]--,(p<d||d===p&&p<h)&&t.p[i]++));else if(n.action&&void 0!==n.action.oi&&void 0!==n.action.od){if(t.p[i]===n.p[i]){if(!t.action||void 0===t.action.oi||!l)return e;if("right"===r)return e;t.action.od=n.action.oi}}else if(n.action&&void 0!==n.action.oi){if(t.action&&void 0!==t.action.oi&&t.p[i]===n.p[i]){if("left"!==r)return e;M.append(e,{p:t.p,action:{od:n.action.oi}})}}else if(n.action&&void 0!==n.action.od&&t.p[i]==n.p[i]){if(!l)return e;if(!t.action||void 0===t.action.oi)return e;delete t.action.od}}return M.append(e,t),e},m(M,M.transformComponent,M.checkValidOp,M.append),M.registerSubtype(y);var B="easysync";function P(){this.name=B,this.compose=v.composeOps}function F(e){for(var t=Object(v.opIterator)(e),n=[];t.hasNext();){var r=t.next();if("+"!==r.opcode)throw new Error("transformAttribsToAlines opcode must be +");var i,o=r.attribs+"|1+1";1<r.lines?(i=new Array(r.lines).fill(o),n.push.apply(n,f(i))):n.push(o)}return n}var j=new(P.prototype.transform=function(e,t,n){var r,i,o=e[v.ZONE_CHANGESETS],a=t[v.ZONE_CHANGESETS],s=Object(v.toString)(o),l=(new v.AttributePool).fromJsonable(e.apool),c=(new v.AttributePool).fromJsonable(t.apool),u=Object(v.moveOpsToNewPool)(s,l,c),d={},f=Object(v.toObject)(u);for(i in a)a.hasOwnProperty(i)&&(d[i]=Object(v.follow)(a[i],f[i]||"",n!==h.LEFT,c));for(i in o)a[i]||(d[i]=Object(v.follow)("",f[i]||"",n!==h.LEFT,c));return(r={})[v.ZONE_CHANGESETS]=d,r.apool=c.toJsonable(),r},P.prototype.invert=function(e,t){var n,s={},r=t.initialAttributedTexts,i=t.apool,l=r.attribs,c=r.text,u=(new v.AttributePool).fromJsonableNoCloning(i),d=(new v.AttributePool).fromJsonable(e.apool),f=e[v.ZONE_CHANGESETS],o=function(e){var t,n,r,i,o,a;f.hasOwnProperty(e)&&(t=l[e]||"|1+1",n=(c[e]||"\n").split("\n"),r=F(t),i=Object(v.moveOpsToNewPool)(f[e],d,u),o=Object(v.unpack)(i),a={get:function(e){return n[e]+"\n"}},s[e]=Object(v.doInverse)(o[e],a,r,u))};for(n in f)o(n);var a,h=new v.AttributePool,p=Object(v._pack)(s),g=Object(v.moveOpsToNewPool)(p,u,h);return(a={})[v.ZONE_CHANGESETS]=Object(v.toObject)(g),a.apool=h.toJsonable(),a},P.prototype.apply=function(e,t){var n,r=(new v.AttributePool).fromJsonableNoCloning(t.apool),i=(new v.AttributePool).fromJsonableNoCloning(e.apool),o=Object(v.moveOpsToNewPool)(Object(v.toString)(t.zone_changesets),r,i),a=Object(v.applyToZatext)(o,e.initialAttributedTexts,i),s=new v.AttributePool;for(n in a.attribs)a.attribs.hasOwnProperty(n)&&(a.attribs[n]=Object(v.moveOpsToNewPool)(a.attribs[n],i,s));return e.apool=s.toJsonable(),e.initialAttributedTexts=a,e},P),z=M.apply,H=M.compose,U=M.transform,V=M.invert;(0,M.registerSubtype)(j);var W=(K.registerSubtype=function(e){M.registerSubtype(e)},K.transform=function(e,t,n){return void 0===n&&(n=h.LEFT),U(e,t,n)},K.compose=function(e,t){return H(e,t)},K.invert=function(e,t){return V(e,t)},K.prototype.apply=function(e){var t=z(this.snapshot,e);this.set([],t)},K.prototype.get=function(e){var n=this;return e?c(this,arguments,function(e){var t=g(n.snapshot,e);return t.elem[t.key]}):this.snapshot},K.prototype.move=function(e,t){var l=this;return c(this,arguments,function(e,t){var n=g(l.snapshot,e),r=n.elem,i=n.key,o=[];if(r.constructor!==Array)throw new Error("bad path");var a=e;a[a.length-1]=parseInt(a[a.length-1],10),o.push({p:a,action:{lm:t}});var s=r.splice(i,1)[0];return r.splice(t,0,s),o})},K.prototype.set=function(e,t){var s=this;return c(this,arguments,function(e,t){var n=g(s.snapshot,e),r=n.elem,i=n.key,o=[];if(r.constructor===Array){var a=e;a[a.length-1]=parseInt(a[a.length-1],10),o.push({p:a,action:{li:t}}),void 0!==r[i]&&o.unshift({p:e,action:{ld:r[i]}}),r[i]=t}else{if("object"!==p()(r))throw new Error("bad path");o.push({p:e,action:{oi:t}}),void 0!==r[i]&&o.unshift({p:e,action:{od:r[i]}}),r[i]=t}return 0===e.length&&(s.snapshot=t),o})},K.prototype.getSnapshot=function(){return this.snapshot},K.prototype.remove=function(e,t){var h=this;return c(this,arguments,function(e,t){if(null==t||"function"==typeof t){var n=[];if(void 0===(o=(i=g(h.snapshot,e)).elem)[a=i.key])throw new Error("no element at that path");if(o.constructor===Array){var r=e;r[r.length-1]=parseInt(r[r.length-1],10),n.push({p:r,action:{ld:o[a]}}),o.splice(a,1)}else{if("object"!==p()(o))throw new Error("bad path");n.push({p:e,action:{od:o[a]}}),delete o[a]}return n}var i,o,a,s=parseInt(e.pop(),10);if("string"==typeof(o=(i=g(h.snapshot,e)).elem)[a=i.key]){var l=s,c=t,u={p:e.concat(s),action:{sd:i.elem[i.key].slice(l,l+c)}};return o[a]=o[a].substring(0,s)+o[a].substring(l+c),[u]}if(o[a].constructor!==Array)throw new Error("element at path does not support range");for(var d=[],f=s;f<s+t;f++)d.push({p:e.concat(s),action:{ld:o[a][f]}}),o[a].splice(f,1);return d})},K.prototype.replaceString=function(e,t,n,r){var u=this;return c(this,arguments,function(e,t,n,r){var i=g(u.snapshot,e),o=i.key,a=i.elem,s=a[o],l=[];if("string"!=typeof s)throw new Error("bad path: element the path ref is not string");if(t<0||t>s.length||n<0||t+n>s.length)throw new Error("bad path: start or end overflow");var c=s.substring(t,t+n);return c&&l.push({p:e.concat(t),action:{sd:c}}),r&&"string"==typeof r?l.push({p:e.concat(t),action:{si:r}}):r="",a[o]=s.substring(0,t)+r+s.substring(t+n),l})},K);function K(e,t,n){if(this.parent=null,this.children=null,this.id="",this.key="",this.snapshot="",!t)throw new Error("Node value cannot be empty");this.set([],t),this.id=s()(),this.parent=e,this.snapshot=Object(o.default)(t),this.children=n}t.default=W},H6oK:function(e,t,n){"use strict";n.r(t),n.d(t,"ALL_BLOCK_CONTENT_RENDERED",function(){return Ht}),n.d(t,"ArrowKeysEnum",function(){return Qi}),n.d(t,"BLOCK_CONTAINER",function(){return V}),n.d(t,"BLOCK_CONTENT_CHANGE",function(){return Ta}),n.d(t,"BLOCK_CONTENT_RENDERED",function(){return zt}),n.d(t,"BLOCK_DATA_META_BLOCK_PROPS",function(){return Q}),n.d(t,"BLOCK_EDITBAR_WRAPPER",function(){return ie}),n.d(t,"BLOCK_ERROR",function(){return se}),n.d(t,"BLOCK_EXTERNAL",function(){return ne}),n.d(t,"BLOCK_FAKETEXT",function(){return ve}),n.d(t,"BLOCK_IGNORE_CLASSES",function(){return Lt}),n.d(t,"BLOCK_LOADING",function(){return ae}),n.d(t,"BLOCK_LOADING_MODE",function(){return Ut}),n.d(t,"BLOCK_LOADING_SPIN",function(){return Vt}),n.d(t,"BLOCK_MENU_WRAPPER",function(){return oe}),n.d(t,"BLOCK_PASTE_PLACEHOLDER",function(){return J}),n.d(t,"BLOCK_PLACEHOLDER",function(){return K}),n.d(t,"BLOCK_REGION",function(){return Z}),n.d(t,"BLOCK_REGION_CLOSE_TAG",function(){return ye}),n.d(t,"BLOCK_REGION_OPEN_TAG",function(){return me}),n.d(t,"BLOCK_TOOLBAR_HTML_TEMPLATE",function(){return ke}),n.d(t,"BLOCK_TOOLBAR_WRAPPER",function(){return re}),n.d(t,"BLOCK_V_TEXT",function(){return Y}),n.d(t,"Bind",function(){return Ki}),n.d(t,"Block",function(){return ai}),n.d(t,"BlockCore",function(){return fa}),n.d(t,"BlockDisplayMode",function(){return Be}),n.d(t,"BlockManager",function(){return ia}),n.d(t,"BlockPlugin",function(){return xa}),n.d(t,"BlockRenderTracker",function(){return Go}),n.d(t,"BlockType",function(){return Le}),n.d(t,"BlockWatcherModule",function(){return Co}),n.d(t,"BooleanNumber",function(){return nt}),n.d(t,"CLIENT_BLOCK_DATA_META_BLOCK_PROPS",function(){return X}),n.d(t,"COMMENT_HIGHLIGHT",function(){return qe}),n.d(t,"COPY_LOADING_BLOCK",function(){return Wt}),n.d(t,"ChangeSetType",function(){return it}),n.d(t,"Channel",function(){return lt}),n.d(t,"CommentEventType",function(){return et}),n.d(t,"Commentable",function(){return $o}),n.d(t,"CommentableBlock",function(){return ta}),n.d(t,"CommonCommandKey",function(){return Re}),n.d(t,"CopyPasteKeysEnum",function(){return Xi}),n.d(t,"Creator",function(){return za}),n.d(t,"CursorType",function(){return Et}),n.d(t,"DATA_BLOCK_TYPE",function(){return Kt}),n.d(t,"DATA_META_BLOCK_PROPS",function(){return te}),n.d(t,"DEFAULT_PERMISSIONS",function(){return Ct}),n.d(t,"DEFAULT_VIEW_TYPES",function(){return It}),n.d(t,"DEP_LOADING_BLOCK_DID_DELETE",function(){return Pt}),n.d(t,"DEP_LOADING_BLOCK_DID_ERROR",function(){return Ft}),n.d(t,"DEP_LOADING_BLOCK_WILL_CREATE",function(){return Bt}),n.d(t,"Debounce",function(){return Zi}),n.d(t,"DependencyLoadingModule",function(){return Vo}),n.d(t,"Direction",function(){return Ye}),n.d(t,"EngineType",function(){return pt}),n.d(t,"Errors",function(){return R}),n.d(t,"FAKE_TOKEN",function(){return Te}),n.d(t,"FullScreenModule",function(){return ro}),n.d(t,"HalfFullScreenModule",function(){return vo}),n.d(t,"IGNORE_BACKGROUND_COLOR_CLASS",function(){return Mt}),n.d(t,"IGNORE_BOLD_CLASS",function(){return Ot}),n.d(t,"IGNORE_HEADING_CLASS",function(){return _t}),n.d(t,"IGNORE_HYPERLINK_CLASS",function(){return St}),n.d(t,"IGNORE_INLINE_CODE_CLASS",function(){return Rt}),n.d(t,"IGNORE_ITALIC_CLASS",function(){return wt}),n.d(t,"IGNORE_LINE_BACKGROUND_CLASS",function(){return Tt}),n.d(t,"IGNORE_LIST_CLASS",function(){return Nt}),n.d(t,"IGNORE_STRIKE_THROUGH_CLASS",function(){return xt}),n.d(t,"IGNORE_UNDERLINE_CLASS",function(){return At}),n.d(t,"INITIAL_BLOCK_MOUNTED",function(){return jt}),n.d(t,"INLINE_BLOCK",function(){return Zt}),n.d(t,"INLINE_BLOCK_CLOSE_HTML",function(){return de}),n.d(t,"INLINE_BLOCK_FAKETEXT_END",function(){return le}),n.d(t,"INLINE_BLOCK_FAKETEXT_START",function(){return ce}),n.d(t,"INLINE_BLOCK_OPEN_HTML",function(){return ue}),n.d(t,"INLINE_BLOCK_PLACEHOLDER",function(){return q}),n.d(t,"INLINE_BLOCK_REGION_OPEN_TAG",function(){return be}),n.d(t,"InactiveOptimizeModule",function(){return yo}),n.d(t,"KeyCode",function(){return qi}),n.d(t,"LoadingModule",function(){return Ko}),n.d(t,"META_BLOCK_PROPS",function(){return ee}),n.d(t,"MOBILE_OVER_SIZE_GAP",function(){return Se}),n.d(t,"MessageChannel",function(){return yt}),n.d(t,"MessageTypes",function(){return vt}),n.d(t,"MobileBlockSizeMode",function(){return xe}),n.d(t,"MobileModule",function(){return Oo}),n.d(t,"NetworkState",function(){return ut}),n.d(t,"NotifyStatus",function(){return Fe}),n.d(t,"OLD_INLINE_BLOCK_CLOSE_HTML",function(){return ge}),n.d(t,"OLD_INLINE_BLOCK_FAKETEXT_END",function(){return fe}),n.d(t,"OLD_INLINE_BLOCK_FAKETEXT_START",function(){return he}),n.d(t,"OLD_INLINE_BLOCK_OPEN_HTML",function(){return pe}),n.d(t,"OpStateVersion",function(){return Ce}),n.d(t,"PermissionModule",function(){return to}),n.d(t,"PluginEventType",function(){return Ze}),n.d(t,"PresentationMode",function(){return at}),n.d(t,"RenderSource",function(){return Ue}),n.d(t,"RenderStage",function(){return ze}),n.d(t,"SelectionState",function(){return Xe}),n.d(t,"SheetAdapter",function(){return Fa}),n.d(t,"SlideAdapter",function(){return La}),n.d(t,"StatusCode",function(){return ft}),n.d(t,"TEXT_BLOCK_JSON",function(){return Dt}),n.d(t,"TeaModule",function(){return Eo}),n.d(t,"ToolbarModule",function(){return Ho}),n.d(t,"Trigger",function(){return Ne}),n.d(t,"UUIDv4",function(){return ln}),n.d(t,"UpdateType",function(){return We}),n.d(t,"ViewTypes",function(){return Oe}),n.d(t,"blockIdReg",function(){return On}),n.d(t,"blockTokenReg",function(){return Rn}),n.d(t,"blockTypeReg",function(){return wn}),n.d(t,"camelCaseToKebab",function(){return kr}),n.d(t,"clearBlockToken",function(){return qr}),n.d(t,"clearBlockTokenByHTMLElement",function(){return Jr}),n.d(t,"collectBlockDataSet",function(){return yr}),n.d(t,"collectIds",function(){return br}),n.d(t,"collectIdsFromAttribs",function(){return Ar}),n.d(t,"copyToClip",function(){return Fr}),n.d(t,"ensureBlockPrevNextLine",function(){return Cr}),n.d(t,"extractBlockIdFromAttributeStr",function(){return _n}),n.d(t,"extractBlockIdsFromSerializedHTML",function(){return An}),n.d(t,"extractBlockInfoFromAttributeStr",function(){return Mn}),n.d(t,"extractBlockTokenFromAttributeStr",function(){return Nn}),n.d(t,"extractBlockTypeFromAttributeStr",function(){return xn}),n.d(t,"generateBlockDataSet",function(){return or}),n.d(t,"generateBlockHTML",function(){return $n}),n.d(t,"generateFakePoint",function(){return mr}),n.d(t,"getAllDisableModulesConfig",function(){return Jo}),n.d(t,"getBlockAttribKey",function(){return Pn}),n.d(t,"getBlockAttribValue",function(){return Fn}),n.d(t,"getBlockCreator",function(){return sr}),n.d(t,"getBlockDataSet",function(){return qn}),n.d(t,"getBlockDatasetByToken",function(){return ur}),n.d(t,"getBlockMountPoint",function(){return cr}),n.d(t,"getBlockNode",function(){return Lr}),n.d(t,"getBlockOrder",function(){return lr}),n.d(t,"getBlockPropsFromAttributeArr",function(){return Un}),n.d(t,"getBlockPropsFromAttributesMap",function(){return Hn}),n.d(t,"getBlockStatsHandler",function(){return gr}),n.d(t,"getCurrentPermission",function(){return Hr}),n.d(t,"getCurrentPermissionInfo",function(){return jr}),n.d(t,"getEditMode",function(){return zr}),n.d(t,"getFirstBlockDataSetOnLine",function(){return nr}),n.d(t,"getInactiveConfig",function(){return Kr}),n.d(t,"getMemberId",function(){return Pr}),n.d(t,"getPlaceholder",function(){return vr}),n.d(t,"getRealTouch",function(){return Sn}),n.d(t,"getUrlHost",function(){return kn}),n.d(t,"hasBlock",function(){return Dr}),n.d(t,"hasClass",function(){return Er}),n.d(t,"includesBlockAttrib",function(){return zn}),n.d(t,"isAccelKey",function(){return eo}),n.d(t,"isBlockAttrib",function(){return jn}),n.d(t,"isBlockAttributes",function(){return Dn}),n.d(t,"isBlockElement",function(){return tr}),n.d(t,"isBlockNode",function(){return Ln}),n.d(t,"isBlockReactionNode",function(){return Zn}),n.d(t,"isBlockSelected",function(){return wr}),n.d(t,"isBlockSheetNode",function(){return Kn}),n.d(t,"isBlockTypeNode",function(){return Wn}),n.d(t,"isCaretOnBlock",function(){return ir}),n.d(t,"isClickOnBitableComponent",function(){return Sr}),n.d(t,"isClickOnSheetComponent",function(){return Ir}),n.d(t,"isClickOutBlock",function(){return Vn}),n.d(t,"isCommonCommandKey",function(){return qt}),n.d(t,"isCopyCutPasteKey",function(){return $i}),n.d(t,"isEditbarConfigurable",function(){return Gt}),n.d(t,"isGenerator",function(){return _r}),n.d(t,"isHalfFullScreenFeatureEnabled",function(){return Vr}),n.d(t,"isInlineBlock",function(){return fr}),n.d(t,"isInsertingBlock",function(){return hr}),n.d(t,"isLineEntryBlockContainer",function(){return Mr}),n.d(t,"isRange",function(){return Ur}),n.d(t,"isSelOnBlock",function(){return rr}),n.d(t,"isTranslateMode",function(){return Wr}),n.d(t,"isWikiUrl",function(){return Cn}),n.d(t,"kebabToCamel",function(){return Nr}),n.d(t,"nextTick",function(){return Gn}),n.d(t,"parseEscapedInitData",function(){return ar}),n.d(t,"parseJsonSafely",function(){return Bn}),n.d(t,"pastePlaceholderReg",function(){return Ee}),n.d(t,"processSheetToken",function(){return pr}),n.d(t,"ravenResizeError",function(){return Tr}),n.d(t,"replaceDataAttrs",function(){return dr}),n.d(t,"searchString",function(){return Yr}),n.d(t,"setBlockDataSet",function(){return Jn}),n.d(t,"setupBlockServices",function(){return ra}),n.d(t,"t",function(){return Gr}),n.d(t,"teaLog",function(){return Zr}),n.d(t,"touchToClick",function(){return Tn}),n.d(t,"trace",function(){return xr}),n.d(t,"transformSingleQuoteToHtml",function(){return Xn}),n.d(t,"validateBlockDataSet",function(){return Rr}),n.d(t,"verifyCopiedHTML",function(){return Or});var r=n("cDf5"),l=n.n(r),i=n("Bw5p"),o=n("ifKl"),c=n("Wy5O"),h=n("fujP"),v=n("LrWZ"),a=n("/1FC"),u=n("pHS2"),E=n("Muja"),s=n("hbEN"),d=n("+Umg"),f=n("xpYl"),p=n("+Xah"),S=n("vJtL"),g=n("gSGL"),m=n("IzLi"),y=n("3Hq1"),b=n("QEec"),k=n("MXQz"),C=n("oaNE"),I=n("m8R6"),T=n("7EGn"),W=n("y2sV"),O=n("4O8T"),w=n.n(O);n.d(t,"EventEmitter",function(){return w.a});var R,x,M=n("PyL4"),N=n.n(M),_=n("EVdn"),L=n.n(_),D=n("wMS7"),B=n.n(D),P=n("puQj"),F=n("FJEn"),j=n("QLaP"),z=n.n(j),H=n("q1tI"),U=n.n(H),V="j-block-container",K="block-placeholder",Z="block-autonomous-region",q="inline-block-placeholder",J="block-paste-placeholder",Y="block-v-text",Q="dataMetaBlockProps",X="clientside-dataMetaBlockProps",ee="meta-block-props",te="data-meta-block-props",ne="block-external",re="block-toolbar-wraper",ie="block-editbar-wraper",oe="block-menu-wraper",ae="block-loading",se="block-error",le='<span data-faketext="" data-contentcollector-ignore-space-at="end" data-zero-space="true">&#8203;</span>',ce='<span data-faketext="" data-contentcollector-ignore-space-at="start" data-zero-space="true">&#8203;</span>',ue=['<span class="'+V+'" '+W.m+'=" " data-faketext=" " contenteditable="false">'].join(""),de=["</span>"].join(""),fe='<span data-faketext="" data-contentcollector-ignore-space-at="end">&#8203;</span>',he='<span data-faketext="" data-contentcollector-ignore-space-at="start">&#8203;</span>',pe=[fe,'<span class="'+V+'">'].join(""),ge=["</span>",he].join(""),ve='<span class="block-faketext dom-pass-empty-check ignore-collect" data-faketext=" ">&#65279;</span>',me='<span class="'+Z+' dom-pass-empty-check ignore-collect" tabindex="-1" contenteditable="false">',ye="</span>",be='<span class="'+Z+' dom-pass-empty-check ignore-collect" tabindex="-1" contenteditable="false" data-faketext=" ">',Ee=new RegExp('<span class="'+J+'">[\\s\\S]*?<\\/span>',"gi"),ke='<div class="'+re+'" contentEditable="false">\n  <div class="'+ie+'"></div>\n  <div class="'+oe+'"></div>\n</div>';(x=R=R||{}).ERR_REQUEST_FAIL="1",x.ERR_INVALID_PARAM="2",x.ERR_NOT_FOUND="3",x.ERR_FORBIDDEN="4",x.ERR_LOGIN_REQUIRE="5",x.ERR_DATA_EXCEED_LIMIT="6",x.ERR_OBJECT_DELETED="7",x.ERR_NOT_IN_ROOM="8",x.ERR_UNCHANGE="9",x.ERR_CHANGESET_EXCEED_LIMIT="1001",x.ERR_NOTE_DELETED="1002",x.ERR_NOT_IN_SESSION="1003",x.ERR_NOTE_NOT_EXISTS="1004",x.ERR_CHAGESET_VALID_FAIL="1005",x.ERR_500="1006",x.ERR_MESSAGE_INVALID="1007",x.ERR_SYNC_ALGO_FAIL="1008",x.ERR_RCE_LIVE_SYNC="1009",x.ERR_OLD_VERSION="1010",x.ERR_USER_LIST_SYNC="1011",x.ERR_NO_WRITE_PERMISSION="1012",x.ERR_NO_COMMENT_PERMISSION="1013",x.ERR_LOCK_FAILED="1015",x.ERR_GET_EXACT_NOTE="2001",x.ERROR_RECOVER="ERROR_RECOVER";var Ce,Ie,Se=10,Te="faketoken";(Ie=Ce=Ce||{})[Ie.SUCCESS=0]="SUCCESS",Ie[Ie.FAIL=1]="FAIL",Ie[Ie.VERSION_TOO_LOW=2]="VERSION_TOO_LOW";var Oe,we,Re,Ae,xe,Me,Ne,_e,Le,De,Be,Pe,Fe,je,ze,He,Ue,Ve,We,Ke,Ze,Ge,qe,Je,Ye,Qe,Xe,$e,et,tt,nt,rt,it,ot,at,st,lt,ct,ut,dt,ft,ht,pt,gt,vt,mt,yt,bt,Et,kt,Ct={readable:!0,editable:!0,commentable:!0,shareable:!0,printable:!0,exportable:!0,copyable:!0},It={},St="IGNORE_HYPERLINK",Tt="IGNORE_LINE_BACKGROUND",Ot="IGNORE_BOLD",wt="IGNORE_ITALIC",Rt="IGNORE_INLINE_CODE",At="IGNORE_UNDERLINE",xt="IGNORE_STRIKE_THROUGH",Mt="IGNORE_BACKGROUND_COLOR",Nt="IGNORE_LIST",_t="IGNORE_HEADING",Lt=[St,Tt,Ot,wt,Rt,At,xt,Mt,Nt,_t].join(" "),Dt="text/blockJson",Bt="DEP_LOADING_BLOCK_WILL_CREATE",Pt="DEP_LOADING_BLOCK_DID_DELETE",Ft="DEP_LOADING_BLOCK_DID_ERROR",jt="initialBlocksMounted",zt="blockContentRendered",Ht="allBlockContentRendered",Ut="block-mode",Vt="block-spin",Wt="copy-loading-block",Kt="data-block-type",Zt="inline-block";function Gt(e){return"editbarCommands"in e}function qt(e){return e in Re}(we=Oe=Oe||{}).INLINE="inline",we.CARD="card",we.PREVIEW="preview",(Ae=Re=Re||{}).cut="cut",Ae.delete="delete",Ae.copy="copy",Ae.comment="comment",Ae.separator="separator",(Me=xe=xe||{}).NORMAL_SIZE="NORMAL_SIZE",Me.OVER_SIZE="OVER_SIZE",Me.OVER_SIZE_LEFT="OVER_SIZE_LEFT",Me.OVER_SIZE_RIGHT="OVER_SIZE_RIGHT",(_e=Ne=Ne||{})[_e.hover=0]="hover",(De=Le=Le||{}).IFRAME_BLOCK="IFRAME_BLOCK",De.REACTION_BLOCK="REACTION_BLOCK",De.SHEET_BLOCK="SHEET_BLOCK",De.BITABLE_BLOCK="BITABLE_BLOCK",De.POLL_BLOCK="POLL_BLOCK",De.REMINDER_BLOCK="REMINDER_BLOCK",De.PLACEHOLDER_BLOCK="PLACEHOLDER_BLOCK",De.JIRA_ISSUE_BLOCK="JIRA_ISSUE_BLOCK",De.JIRA_FILTER_BLOCK="JIRA_FILTER_BLOCK",De.MINDNOTE_BLOCK="MINDNOTE_BLOCK",De.MENTION_BLOCK="mentionBlock",De.JEST_BLOCK="JEST_BLOCK",De.AT_USER_BLOCK="AT_USER_BLOCK",De.FILE_CARD_BLOCK="FILE_CARD_BLOCK",De.HTML_BLOCK="HTML_BLOCK",De.CHAT_CARD_BLOCK="CHAT_CARD_BLOCK",De.READ_PROCESS_BLOCK="READ_PROCESS_BLOCK",De.APPLICATION_CONTROL_BLOCK="APPLICATION_CONTROL_BLOCK",De.DIAGRAM_BLOCK="DIAGRAM_BLOCK",De.EQUATION_BLOCK="EQUATION_BLOCK",De.ISV_BLOCK="ISV_BLOCK",De.LINK_BLOCK="LINK_BLOCK",De.OKR_BLOCK="OKR_BLOCK",(Pe=Be=Be||{}).BLOCK="block",Pe.INLINE="inline",(je=Fe=Fe||{})[je.start=0]="start",je[je.end=1]="end",(He=ze=ze||{}).initial="initial",He.update="update",(Ve=Ue=Ue||{}).create="create",Ve.doc="doc",Ve.collab="collab",(Ke=We=We||{}).context="context",Ke.attribute="attribute",Ke.dataset="dataset",Ke.record="record",(Ge=Ze=Ze||{}).BEFORE_INIT_BLOCKS_ONLY="beforeInitBlocksOnly",Ge.BEFORE_CREATE_BLOCK="beforeCreateBlock",Ge.BEFORE_UPDATE_BLOCK_DATA="beforeUpdateBlockData",Ge.DELETE_BLOCK_DATA="deleteBlockData",Ge.MOUNT="mount",(Je=qe=qe||{})[Je.NONE=0]="NONE",Je[Je.HAS_COMMENT=1]="HAS_COMMENT",Je[Je.FOCUS=2]="FOCUS",(Qe=Ye=Ye||{}).NONE="NONE",Qe.RIGHT="RIGHT",Qe.LEFT="LEFT",($e=Xe=Xe||{}).NONE="NONE",$e.FOCUS_ON_BLOCK="FOCUS_ON_BLOCK",$e.COVER_ON_BLOCK="COVER_ON_BLOCK",(tt=et=et||{}).START_LOADING="commentStartLoading",tt.LOADED="commentLoaded",tt.LOADED_ERROR="commentLoadedError",tt.UPDATED="commentUpdated",tt.ACCTIVE_CHANGE="commentActiveChange",tt.MOUNT="commentMount",(rt=nt=nt||{})[rt.TRUE=1]="TRUE",rt[rt.FALSE=0]="FALSE",(ot=it=it||{}).DOC="DOC",ot.SHEET="SHEET",(st=at=at||{})[st.NONE=0]="NONE",st[st.PAGED=1]="PAGED",st[st.NON_PAGED=2]="NON_PAGED",(ct=lt=lt||{}).http="http",ct.socket="socket",(dt=ut=ut||{}).online="online",dt.offline="offline",(ht=ft=ft||{})[ht.SUCCESS=0]="SUCCESS",ht[ht.FAILED=1]="FAILED",ht[ht.INVALID_PARAM=2]="INVALID_PARAM",ht[ht.NOT_FOUND=3]="NOT_FOUND",ht[ht.FORBIDDEN=4]="FORBIDDEN",ht[ht.LOGIN_REQUIRED=5]="LOGIN_REQUIRED",ht[ht.LIMIT_EXCEED=6]="LIMIT_EXCEED",ht[ht.CHANGESET_LIMIT_EXCEED=1001]="CHANGESET_LIMIT_EXCEED",ht[ht.OBJECT_DELETED=1002]="OBJECT_DELETED",ht[ht.NOT_IN_SESSION=1003]="NOT_IN_SESSION",ht[ht.CHAGESET_INVALID=1005]="CHAGESET_INVALID",ht[ht.INTERNAL_ERROR=1006]="INTERNAL_ERROR",ht[ht.INVALID_MESSAGE=1007]="INVALID_MESSAGE",ht[ht.SYNC_FAILED=1008]="SYNC_FAILED",ht[ht.VERSION_TOO_OLD=1010]="VERSION_TOO_OLD",ht[ht.WRITE_PERMISSION_DENIED=1012]="WRITE_PERMISSION_DENIED",ht[ht.COMMENT_PERMISSION_DENIED=1013]="COMMENT_PERMISSION_DENIED",ht[ht.SERVICE_ERROR=1015]="SERVICE_ERROR",ht[ht.DATABASE_CONFLICT=1021]="DATABASE_CONFLICT",ht[ht.SERVER_BUSY=9998]="SERVER_BUSY",(gt=pt=pt||{}).JSON="JSON",gt.MESSAGE_BOX="MESSAGE_BOX",(mt=vt=vt||{}).USER_NEWINFO="USER_NEWINFO",mt.USER_LEAVE="USER_LEAVE",mt.CLIENT_VARS="CLIENT_VARS",mt.GET_VERSION="GET_VERSION",mt.ENGAGEMENT_CURSOR="ENGAGEMENT_CURSOR",mt.ACCEPT_ENGAGEMENT_CURSOR="ACCEPT_ENGAGEMENT_CURSOR",mt.ACCEPT_WATCH="ACCEPT_WATCH",mt.ACCEPT_COMMIT="ACCEPT_COMMIT",mt.NEW_CHANGES="NEW_CHANGES",mt.GET_MESSAGE="GET_MESSAGE",mt.USER_CHANGES="USER_CHANGES",mt.MESSAGE_CHANNEL="MESSAGE_CHANNEL",mt.ROOM_MEMBERS="ROOM_MEMBERS",mt.ERROR="ERROR",mt.REJECT_COMMIT="REJECT_COMMIT",mt.NEW_COMMENT="NEW_COMMENT",mt.RESPONSE="RESPONSE",(bt=yt=yt||{}).ENGINE_CHANNEL="engine_channel",bt.MEMBER_CHANNEL="member_channel",(kt=Et=Et||{}).Content="content",kt.Note="note",kt.Topic="topic",kt.Title="title",kt.Image="image",kt.None="none";var Jt=function(e,t){return(Jt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function Yt(e,t){function n(){this.constructor=e}Jt(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var Qt=function(){return(Qt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Xt(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function $t(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l()(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a}function en(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l()(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function tn(e,a,n,s){function l(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n=n||Promise)(function(t,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function i(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){e.done?t(e.value):l(e.value).then(r,i)}o((s=s.apply(e,a||[])).next())})}function nn(e,n){var r,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function s(t){return function(e){return l([t,e])}}function l(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function rn(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function on(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function an(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(on(arguments[t]));return e}function sn(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,t=i[Symbol.asyncIterator];return t?t.call(i):(i="function"==typeof rn?rn(i):i[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=i[r]&&function(n){return new Promise(function(e,t){o(e,t,(n=i[r](n)).done,n.value)})}}function o(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}}function ln(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}var cn,un,dn=window.sessionStorage.getItem("__ENTER_FROM__"),fn=window.User&&window.User.userAgent||navigator.userAgent||"",hn=Object.assign({},Object(P.detect)(fn),{isFeishu:!1,isLark:!1,isLarkPcTab:!1,isLarkWindow:!1,isDocs:!1,isDocsSDK:!1,isAndroidSDK:!1,isIOSSDK:!1,isMobileSDK:!1,isFeed:!1,isIphoneX:!1,isIPad:!1,isMobile:!1,isMac:!1,isSafari:!1,isIE:!1,isSougou:!1,isIOS:!1,isAndroid:!1,isQQ:!1,isX5:!1,is360:!1,is360Fast:!1,isUc:!1,isBaiDu:!1,isLB:!1,oldIE:!1,modernIE:!1,kernel:"",isLarkTab:!1,isOldLarkTab:!1,isEdge:!1,isFF:!1,isChrome:!1,isWebKit:!1,isBytedanceApp:!1,isIPhoneSeries:function(){return!1},isIOSBelow12:function(){return!1},isPrimaryChrome:!1,isOpera:!1,is2345:!1,isMaxthon:!1,isTheWorld:!1,isVC:!1});hn.isFeishu=/feishu/i.test(fn),hn.isLark=hn.isFeishu||/lark/i.test(fn),hn.isLarkPcTab=hn.isLark&&/TYPE\/PC_TAB/i.test(fn),hn.isLarkWindow=hn.isLark&&"lark.window"===dn,hn.isDocs=/Docs/i.test(fn),hn.isDocsSDK=hn.isLark&&hn.isDocs,hn.isAndroidSDK=/DocEditorSDk/i.test(fn),hn.isIOSSDK=/DocsSDK/i.test(fn),hn.isMobileSDK=hn.isAndroidSDK||hn.isIOSSDK,hn.isFeed=/Feed/i.test(fn)||/lark=1/.test(location.search)||/sourceType=feed/.test(location.search),hn.isVC=/VC=true/.test(location.search),hn.isIphoneX=vn()||!1,hn.isIPad=/iPad/i.test(fn),hn.mobile=P.mobile||/Mobile/i.test(fn),hn.isMobile=hn.mobile,hn.isMac=hn.mac,hn.isSafari=hn.safari,hn.isIE=hn.msie||hn.msedge,hn.isSougou=/MetaSr/i.test(fn),hn.isIOS=!!fn.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),hn.isAndroid=-1<fn.indexOf("Android")||-1<fn.indexOf("Adr"),hn.isQQ=/QQBrowser/i.test(fn),hn.isX5=/MQQBrowser/i.test(fn),hn.is360=/360SE/i.test(fn),hn.is360Fast=/360EE/i.test(fn),hn.isUc=/UBrowser/i.test(fn),hn.isBaiDu=/BIDUBrowser/i.test(fn),hn.is2345=/2345Explorer/i.test(fn),hn.isMaxthon=/Maxthon/i.test(fn),hn.isTheWorld=/TheWorld/i.test(fn),hn.isLB=/LBBROWSER/i.test(fn),hn.isEdge=/Edge/i.test(fn),hn.isFF=/Firefox/i.test(fn),hn.isOpera=/OPR/i.test(fn),hn.isWebKit=/AppleWebKit/i.test(fn),hn.isChrome="chrome"===hn.name.toLocaleLowerCase(),hn.isPrimaryChrome=hn.isChrome&&!hn.isOpera&&!hn.isLB&&!hn.isUc&&!hn.isBaiDu&&!hn.is360&&!hn.is360Fast&&!hn.isQQ&&!hn.isSougou&&!hn.isEdge&&!hn.is2345&&!hn.isTheWorld&&!hn.isMaxthon,hn.msie&&(cn=parseInt(String(hn.version),10),hn.oldIE=cn<11,hn.modernIE=11<=cn),hn.isSougou&&(hn.name="sougou",un=/SE (\w*.\w*)\s/.exec(fn),hn.version=un&&un[1]||hn.version),hn.isQQ&&(hn.name="qq",un=fn.replace(/^.*QQBrowser\/([\d.]+).*$/,"$1"),hn.version=String(parseFloat(un))),hn.is360&&(hn.name="360"),hn.is360Fast&&(hn.name="360fast"),hn.isLB&&(hn.name="liebao"),hn.isUc&&(hn.name="uc"),hn.isBaiDu&&(hn.name="baidu");var pn=["msie","webkit","blink","gecko","msedge","tablet","mobile"];hn.kernel=pn.find(function(e){return hn[e]}),hn.isLarkTab=/from\/(old_)?lark_tab/i.test(fn),hn.isOldLarkTab=/from\/old_lark_tab/i.test(fn);var gn=hn.isLark||hn.isDocs;function vn(){return mn("X")}function mn(e){var t=new RegExp("(iPhone\\s"+e+")");return!!navigator.userAgent.match(t)}function yn(){var e=navigator.userAgent;return 0<e.indexOf("iPhone")||0<e.indexOf("iPad")||0<e.indexOf("iPhone")}function bn(){if(yn()){var e=navigator.userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);return e?{major:+e[1],minor:+e[2]}:null}return null}function En(){var e=bn();return!!e&&e.major<12}function kn(e){var t=document.createElement("a");return t.href=e,[t.protocol,t.hostname].join("//")}function Cn(){return window.location.pathname.startsWith("/wiki/")}hn.isBytedanceApp=gn,hn.isIPhoneSeries=mn,hn.isIOSBelow12=En;var In=30,Sn=function(e,t){return void 0===t&&(t=0),(e instanceof TouchEvent?e:e.originalEvent||e.nativeEvent).changedTouches[t]},Tn=function(e){var o=e.onClick,a=e.onLongPress,t=e.touchDuration,s=void 0===t?300:t,n=e.touchDelta,l=void 0===n?In:n;if(!o||"function"!=typeof o)throw Error('"onClick" should be function');if(a&&"function"!=typeof a)throw Error('"onLongPress" should be function');if("number"!=typeof s)throw Error('"touchDuration" should be number');var c,u=0,d=0,f=0,h=0,p=0,g=0,v=0;return function(t){var e=t.type,n=t.timeStamp,r=Sn(t),i={touchstart:function(){u=h=r.clientX,d=p=r.clientY,f=n,a&&(g=v=0,c=window.setTimeout(function(){l<=g||l<=v||a(t)},s))},touchmove:function(){g+=Math.abs(r.clientX-h),v+=Math.abs(r.clientY-p),h=r.clientX,p=r.clientY},touchend:function(){clearTimeout(c);var e=n;Math.abs(r.clientX-u)>=l||Math.abs(r.clientY-d)>=l||(!f||s<=e-f)||(o&&o(t),u=d=0,f=0)}}[e];i&&i()}},On=/(blockId.+?:.+?)([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/g,wn=/blockType.+?:.+?(\w+)/,Rn=/token.+?:.+?(\w+)/;function An(e){for(var t=new Set,n=null;(n=On.exec(e))&&"string"==typeof n[2]&&t.add(n[2]),null!==n;);return t}function xn(e){var t=e.match(wn);return t&&t[1]||""}function Mn(e,t){for(var n=new RegExp(t+".+?:.+?([\\w\\-]+)"),r=0,i="",o="",a=e.length,s=0;s<a;s+=1){var l,c=e.charAt(s);if("{"===c&&(r+=1),"}"===c&&--r,1===r?i+=c:i=(i&&(o=(l=i.match(n))&&l[1]||""),""),o)break}return o}function Nn(e){return Mn(e,"token")}function _n(e){return Mn(e,"blockId")}var Ln=function(e){var t=L()(e);return t&&(t.hasClass(K)||t.hasClass(V))},Dn=function(e){return!(!e[Q]&&!e[X])};function Bn(e){try{return JSON.parse(e)}catch(e){xr("[BLOCK_ERROR]: "+e.message)}}var Pn=function(e){return e?X:Q},Fn=function(e){return e[Q]||e[X]},jn=function(e){return e===Q||e===X},zn=function(e){return e.includes(Q)||e.includes(X)},Hn=function(e){var t=Fn(e);return t?Bn(t):null},Un=function(e){return jn(e[0])?Bn(e[1]):null},Vn=function(e){return e.currentTarget===e.target},Wn=function(e,t){var n=L()(t),r=n.hasClass(K)?n:n.find("."+K).first();if(!r)return!1;var i=r.data(ee);return!!i&&i.blockType===e},Kn=function(e){return Wn(Le.SHEET_BLOCK,e)},Zn=function(e){return Wn(Le.REACTION_BLOCK,e)},Gn=function(){return new Promise(function(e){(window.requestAnimationFrame||setTimeout)(function(){return e()})})},qn=function(e){var t,n;n="string"==typeof e?(t=B.a.sanitize(e),L()("<div>").html(t).children):L()(e);var r="data-"+ee,i=n.parent(".innerdocbody").get(0),o=n.hasClass(V)?n.find("["+r+"]"):n.closest("["+r+"]",i);if(!o.length)return null;var a=o.attr(r);return a?Bn(a):null},Jn=function(e,t){var n,r=L()(e),i="data-"+ee;r.hasClass(K)?r.attr(i,JSON.stringify(t)):(n=r.find("."+K)).length&&n.attr(i,JSON.stringify(t))},Yn=/'/g,Qn="&#39;";function Xn(e){return e.replace(Yn,Qn)}var $n=function(e,t){var n=fr(e)?"span":"div";return B.a.sanitize(["<"+n+' class="'+V+'">','<span data-meta-block-props="'+N.a.escapeHTMLAttribute(JSON.stringify(e))+'">','<span class="'+Z+' dom-pass-empty-check ignore-collect">',t?'<span class="'+J+'">'+t+"</span>":"","</span>","</span>","</"+n+">"].join(""))},er={div:1,p:1,pre:1,li:1,ol:1,ul:1,code:1,h1:1,h2:1,h3:1},tr=function(e){return!!er[(Object(T.default)(e,"tagName")||"").toLowerCase()]},nr=function(e){var t=e.selStart;if(!t)return null;var n=e.attributeManager.getAttributeOnLine(t[0],Q)||e.attributeManager.getAttributeOnLine(t[0],X);return n&&Bn(n)||null},rr=function(e){var t=e.selStart,n=e.selEnd,r=e.lines,i=t;if(!i||!n)return!1;if(i[0]===n[0]){var o=Math.abs(n[1]-i[1]),a=r.atIndex(i[0]);if(!a)return!1;var s=a.text.length;if(1<=o&&o<=s&&a.lineNode&&a.lineNode.className.includes(V))return!0}return!1},ir=function(e,t){var n=e.selStart,r=e.selEnd,i=n;if(!i||!r)return!1;if(i[0]!==r[0]||r[1]!==i[1])return!1;var o=e.attributeManager.getAttributeOnLine(i[0],Q)||e.attributeManager.getAttributeOnLine(i[0],X),a=e.lines.atIndex(i[0])||{},s=o&&Bn(o)||{};return!fr(s)&&(t?t===s.blockId&&a.mounted:!!o&&a.mounted)},or=function(e){var t,n=e.blockType,r=e.initData,i=e.props,o=e.creator,a=e.depLoading;It[n]&&i&&!i.viewType&&(t=It[n],(i.viewType=t)===Oe.INLINE?i.displayMode=Be.INLINE:i.displayMode=Be.BLOCK);var s=Qt(Qt({},o&&o.defaultProps),i),l=r||o&&o.defaultRecord||{},c=a?{depLoading:a}:{};return Qt({blockId:ln(),blockType:n,props:s,initData:escape(JSON.stringify(l))},c)},ar=function(e){return Bn(unescape(e))},sr=function(e,t){var n=t.plugins.blockPlugin;return n?n.getBlockManager().getBlockCreator(e):null},lr=function(e,t){var n,r,i=L()(e).prevAll("."+V),o=0;try{for(var a=rn(Array.from(i)),s=a.next();!s.done;s=a.next()){var l=s.value,c=qn(l);c&&c.blockType===t&&o++}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},cr=function(e){return e.querySelector("."+Y)},ur=function(e){var t,n;if(e===Te)return null;var r="data-"+ee,i=Array.from(L()("#innerdocbody ."+K)),o=new RegExp('^token":"'+e+'"');try{for(var a=rn(i),s=a.next();!s.done;s=a.next()){var l=s.value,c=L()(l).attr(r);if(c)for(var u=0,d=0;u<c.length;){if("{"===c[u])d++;else if("}"===c[u])d--;else if("t"===c[u]&&1===d&&o.test(c.substring(u)))return Bn(c);u++}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return null};function dr(e,t){var n,r,i,o;try{for(var a=rn(Array.from(t.attributes)),s=a.next();!s.done;s=a.next()){var l=s.value;/^data-/.test(l.nodeName)&&t.removeAttribute(l.nodeName)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}try{for(var c=rn(Array.from(e.attributes)),u=c.next();!u.done;u=c.next()){l=u.value;/^data-/.test(l.nodeName)&&t.setAttribute(l.nodeName,l.nodeValue||"")}}catch(e){i={error:e}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}function fr(e){return e.props&&e.props.displayMode===Be.INLINE}function hr(e){return!e.token}function pr(e){var t,n=null,r=null;return"string"==typeof e&&(n=(t=on(e.split(/_/,2),2))[0],r=t[1]),{token:n,sheetId:r}}function gr(){return{dataMetaBlockProps:function(e){var t=Hn({dataMetaBlockProps:e});return{pluginCounts:t?[[t.blockType,1]]:[]}}}}function vr(e){return"string"==typeof e&&(e=B.a.sanitize(e)),L()(e).find("."+Z).toArray()}var mr=function(){var e=document.createElement("div");return e.setAttribute("contenteditable","true"),e.style.display="none",e};function yr(e){var n=[];return e&&e.forEach(function(e){vr(e.lineNode).forEach(function(e){var t=qn(e);t&&n.push(t)})}),n}function br(e){return yr(e).map(function(e){return e.blockId})}function Er(e,t){return!!e.className&&!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function kr(e){if(e)return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Cr(e){L()(e).find("div."+V).each(function(e,t){var n,r=L()(t),i="";r.prev()&&(n=r.prev().get(0),i=tr(n)?"":"<div></div>");var o,a="";r.next()&&(o=r.next().get(0),a=tr(o)?"":"<div></div>");var s=""+i+r.prop("outerHTML")+a;r.replaceWith(s)})}function Ir(e){for(var t=e,n=["block-editbar","sheet-dropdown","sheet-toolbar","sheet-dropdown-menu","sheet-dropdown__menu-dragbar","color-picker__more","gcsj-func-help","calc-func-list","sheet-context-menu","sheet-history","embed-sheet-history","translate-sheet","condition-format-list"];t;){var r=t.classList&&t.classList.contains("modal"),i=t.getAttribute("data-sheet-component");if(r||i||0<n.filter(function(e){return t.classList&&t.classList.contains(e)}).length)return!0;t=t.parentElement}return!1}function Sr(e){for(var t=e,n=["embeded-bitable-container","J-bitable-field-container","J-bitable-container"];t;){if(0<n.filter(function(e){return t.classList.contains(e)}).length)return!0;t=t.parentElement}return!1}function Tr(e,t,n){xr("[BLOCK_ERROR]:  try to resize "+n+" but get width = "+t+" from "+e)}function Or(e){var t,n;if(!e)return!1;var r=L()("<div></div>");r.html(e);var i=r.find("."+V);try{for(var o=rn(Array.from(i)),a=o.next();!a.done;a=o.next()){var s=a.value,l=qn(s);if(l&&l.token)return xr("[BLOCK_ERROR]: Copied block has token "+l.token+" after replacement."),!1}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0}function wr(){var e=window.getSelection(),t=L()(e.anchorNode).parent(),n=t.find("."+V),r=t.closest("."+V);return 0<n.length||0<r.length}function Rr(e){if(!e||"object"!==l()(e))return!1;var t=["blockId","blockType","props"],n=Object.keys(e);return t.every(function(e){return n.includes(e)})}var Ar=function(r){var i=[];return Object.keys(r).forEach(function(e){var t,n=r[e];!jn(n[0])||(t=Bn(n[1])).blockId&&i.push(t.blockId)}),i};function xr(e){var t="string"==typeof e?new Error(e):e;window.Slardar&&window.Slardar("Sentry",function(e){e.captureException(t)})}function Mr(e){return e.lineNode&&e.lineNode.className.includes(V)}function Nr(e){return e&&e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})}function _r(e){return"function"==typeof e.next&&"function"==typeof e.throw}function Lr(e){if(hn.firefox&&e)try{e.toString()}catch(e){return}return e&&L()(e).closest("."+K+",."+V)[0]}function Dr(e){var n=!1;return e.forEach(function(e){e.forEach(function(e){var t;!1===n&&null!==(t=null===e||void 0===e?void 0:e.attributes)&&void 0!==t&&t[Q]&&(n=!0)})}),n}var Br={Helpers:{browser:F.browser},EventEmitter:new w.a};function Pr(){return Br.IO?Br.IO.getInstance({}).memberId+"":""}var Fr=function(o){function e(e){e.preventDefault(),e.stopImmediatePropagation&&e.stopImmediatePropagation();var t=o.html,n=o.text,r=Br.Helpers.browser;document.createElement("div").innerHTML=t;var i=e.clipboardData||window.clipboardData;r.modernIE?i.setData("text",t):(i.setData("text/html",t),i.setData("text/plain",n))}var t=document.createElement("textarea");document.body.appendChild(t),document.addEventListener("copy",e),t.style.opacity="0",t.value=" ",t.focus({preventScroll:!0}),t.select(),document.execCommand("copy"),document.removeEventListener("copy",e),document.body.removeChild(t)},jr=function(){if(!Br.Redux)return null;var e=Br.Redux,t=e.store,n=e.selectors,r=t.getState();return n.selectCurrentSuitePermissionInfo(r)},zr=function(){if(!Br.Redux)return null;var e=Br.Redux,t=e.store,n=e.selectors,r=t.getState();return n.selectCanEditInvolvingEditMode(r)},Hr=function(){var e=Br.Redux,t=Br.Helpers,n=Br.Utils;if(!(e&&t&&n))return Ct;var r=e.store,i=e.selectors,o=t.getUserPermissions,a=n.getPageToken;if(!(r&&i&&o&&a))return Ct;var s=i.selectCurrentSuiteOtherPermissions,l=i.selectCanEditInvolvingEditMode,c=r.getState(),u=a();if(!c.entities.permissions.get(u))return{};var d=o(c.entities.permissions.get(u).toJS().permissions),f=l(c);d.editable&&!f&&(d.editable=!1);var h=s(c);return Qt(Qt({},d),h)},Ur=function(e){return Br.Helpers.browser.isIE?e&&0<e.toString().length:e&&"Range"===e.type},Vr=function(){return!Br.Helpers.browser.mobile&&!!Br.Utils},Wr=function(){if(!Br.Redux)return null;var e=Br.Redux.store.getState();return!!e&&e.appState.translate.status.translated},Kr=function(){var e={startFreezeTime:-1,startPauseTime:-1};return Br.Utils?Br.Utils.getMinaConfig("block_scheduler_config",e):e},Zr=function(e,t){Br.LogService?Br.LogService.collectSuiteEvent(e,t):console.log(e,t)};function Gr(e){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];if(!Br)return"";var n=Br.translations;if(!n)return"";var r=n[e]||"";return r||console.error("Translation '"+e+" missing.'"),0===i.length?r:r.replace(/\$\{([0-9])\}/g,function(e,t){var n=parseInt(t,10),r=null!=i[n-1]?i[n-1]:"";return String(r)})}function qr(e,t,n,r){if(void 0===n&&(n="copy"),void 0===r&&(r=!1),!t)return t;var i=document.createElement("div");return i.innerHTML=t,Jr(e,i,n,r)}function Jr(e,t,n,r){var i,o;function a(e){var t;!e||(t=e.childNodes[0])&&(t.className=t.className.replace(/sheet-token-\w*|sheet-id-\w*/g,""))}void 0===n&&(n="copy"),void 0===r&&(r=!1);var s=L()(t),l=Array.from(s.find("."+V));try{for(var c=rn(l),u=c.next();!u.done;u=c.next()){var d=u.value;a(d);var f=qn(d);f&&f.token&&(xr("[BLOCK_ERROR]: "+("copy"===n?"Copied":"Pasted")+" block has token "+f.token+"."),r?L()(d).replaceWith("<span>"+Gr("block.failed_to_paste_block")+"</span>"):Jn(d,Object(I.default)(f,["token"]))),f&&f.blockType&&!e.isBlockCreatorRegistered(f.blockType)&&L()(d).replaceWith("<span>"+Gr("block.failed_to_paste_unsupport_block")+"</span>")}}catch(e){i={error:e}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}return s.html()}function Yr(e,t){if(!e||!t)return[];for(var n=[],r=e.indexOf(t);0<=r;){var i=r+t.length;n.push({start:r,end:i,key:ln()}),r=e.indexOf(t,i)}return n}var Qr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function Xr(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var $r=function(e){e.styles;var t=Xr(e,["styles"]);return U.a.createElement("svg",Qr({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),U.a.createElement("path",{d:"M9.6 11h10c.22 0 .4.168.4.375v.75c0 .207-.18.375-.4.375h-10c-.22 0-.4-.168-.4-.375v-.75c0-.207.18-.375.4-.375zm-5.171 0H6.57c.237 0 .429.168.429.375v.75c0 .207-.192.375-.429.375H4.43c-.237 0-.429-.168-.429-.375v-.75c0-.207.192-.375.429-.375z"}))},ei=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function ti(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var ni=function(e){e.styles;var t=ti(e,["styles"]);return U.a.createElement("svg",ei({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),U.a.createElement("path",{d:"M5.363 17.5h13.276c.193 0 .35.169.35.375v.75c0 .206-.157.375-.35.375H5.363c-.193 0-.35-.169-.35-.375v-.75c0-.206.157-.375.35-.375zM5.35 5h13.3c.192 0 .35.169.35.375v.75c0 .206-.158.375-.35.375H5.35c-.193 0-.35-.169-.35-.375v-.75C5 5.169 5.157 5 5.35 5zm.15 4h13a.5.5 0 0 1 .5.5v5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-5a.5.5 0 0 1 .5-.5zm1.1 1.6v2.8h10.8v-2.8H6.6z"}))},ri=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function ii(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var oi=function(e){e.styles;var t=ii(e,["styles"]);return U.a.createElement("svg",ri({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),U.a.createElement("path",{d:"M5.35 17.489h13.3c.193 0 .35.168.35.375v.75c0 .207-.157.375-.35.375H5.35c-.193 0-.35-.168-.35-.375v-.75c0-.207.157-.375.35-.375zM5.5 5h13a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5zm1 1.5v7h11v-7h-11z"}))},ai=(si.prototype.unmount=function(e){this.onMountCallbackList.length=0,this.onErrorCallbackList.length=0},si.prototype.isReadyForCopy=function(){return this.isContentLoaded||this.renderLocally||!this.isAsync},si.prototype.getToken=function(){return this.blockToken},si.prototype.invariantList=function(e,t){var n,r;try{for(var i=rn(e),o=i.next();!o.done;o=i.next()){var a=o.value;z()(this[a],t+" "+a)}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},si.prototype.registerOnMountCallback=function(e){this.onMountCallbackList.push(e)},si.prototype.registerOnErrorCallback=function(e){this.onErrorCallbackList.push(e)},si.prototype.getToolbarButtonFor=function(t,n){var e,r,i=this;switch(t){case Oe.INLINE:e=$r,r=Gr("block.editbar.inline_view");break;case Oe.CARD:e=ni,r=Gr("block.editbar.card_view");break;case Oe.PREVIEW:e=oi,r=Gr("block.editbar.preview_view")}return{key:t+"_view",Icon:function(){return U.a.createElement(e)},handler:function(){var e={viewType:t,displayMode:t===Oe.INLINE?Be.INLINE:Be.BLOCK};i.setProps(e),n&&n(t)},tooltip:r}},si.prototype.delete=function(e){this.plugin&&"function"==typeof this.plugin.deleteBlock&&this.plugin.deleteBlock({block:this},e)},si.prototype.updateDataSet=function(e){this.blockId===e.blockId?(this.props=e.props||{},this.blockType=e.blockType,this.blockToken=e.token):console.error("block: can not replace blockId from "+this.blockId+" to "+e.blockId)},si.prototype.replaceCommandPlaceholder=function(){var t,e;if(Gt(this)){var n=this.editbarCommands,r=this.context.getCommandByKey;if(r)try{for(var i=rn(Object.entries(n)),o=i.next();!o.done;o=i.next()){var a=on(o.value,2),s=a[0],l=a[1];qt(l)&&(n[s]=r(l))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}}},si.prototype.onRedo=function(){},si.prototype.onUndo=function(){},si.prototype.onDo=function(){},si.prototype.do=function(){var e=this.context.undoDispatcher;e&&e.do(this.blockId)},si.prototype.isLoading=function(){return this.loading},si.prototype.nextRender=function(l){return tn(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return nn(this,function(e){switch(e.label){case 0:return t=l.stage,n=l.token,r=l.source,i=l.engineType,o=l.updatedData,a=l.priority,s=r===Ue.create,t!==ze.update||this.isRendered||this.isCancelRender?this.renderLocally||this.props&&this.props.displayMode===Be.INLINE?[4,this.scheduler.add({block:this,stage:t,updatedData:o,priority:a})]:[3,2]:[2];case 1:return e.sent(),s&&this.hooks.callAll("blockDidCreate",this),[2];case 2:return n||this.blockToken?t!==ze.initial?[3,4]:(n&&i&&"none"!==i&&(this.blockToken=n),this.destroyed?[2]:[4,this.scheduler.add({block:this,stage:ze.initial,priority:a})]):[2];case 3:return e.sent(),s&&this.hooks.callAll("blockDidCreate",this),[3,6];case 4:return[4,this.scheduler.add({block:this,stage:t,updatedData:o,priority:a})];case 5:e.sent(),e.label=6;case 6:return[2]}})})},si.prototype.collectText=function(){return"[BLOCK]"},si.prototype.setContext=function(e,t){var n=0===Object.keys(this.context).length,r=this.context||{};this.context=Qt(Qt({},r),e),!n&&t&&this.nextRender({stage:ze.update,source:Ue.doc,updatedData:{type:We.context,data:e}})},si.prototype.setAttributes=function(e){var t,n,r=!1,i=new Set(["selected","selectState","viewType"]),o=this.attributes;try{for(var a=rn(Object.keys(e)),s=a.next();!s.done;s=a.next()){var l=s.value,c=e[l];o[l]!==c&&i.has(l)&&(r=!0)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}this.attributes=Qt(Qt({},o),e),r&&this.nextRender({stage:ze.update,source:Ue.doc,updatedData:{type:We.attribute,data:e}})},si.prototype.getAttributes=function(){return this.attributes},si.prototype._setParams=function(e){this.plugin=e.plugin||this.plugin,this.hooks=e.hooks||this.hooks,this.scheduler=e.scheduler||this.scheduler,this.event=e.event||this.event},si.prototype.getPlugin=function(){return this.plugin},si.prototype.placeholderJsx=function(e,t){if(this.props&&this.props.displayMode===Be.INLINE)return U.a.createElement("div",{className:"inline-mode"},U.a.createElement("span",{className:"block-inline-placeholder"}),U.a.createElement("span",{className:"block-inline-placeholder-expand"}));var n=hn.mobile?"100%":e||this.defaultStyle.width+"px",r=hn.mobile?"100%":t||this.defaultStyle.height+"px";return U.a.createElement("div",{className:Ut,style:{width:n,height:r}},U.a.createElement("div",{className:Vt},U.a.createElement("span",{className:"rectangle-1"},U.a.createElement("span",null)),U.a.createElement("span",{className:"circle"}),U.a.createElement("span",{className:"rectangle-2"},U.a.createElement("span",null))))},si.prototype.placeholderHtml=function(e,t){if(this.props&&this.props.displayMode===Be.INLINE)return'<div class="inline-mode"><span class="block-inline-placeholder"></span><span class="block-inline-placeholder-expand"></span></div>';var n=hn.mobile?"100%":e||this.defaultStyle.width+"px",r=hn.mobile?"100%":t||this.defaultStyle.height+"px";return'<div class="'+Ut+'" style="width: '+n+"; height: "+r+';"><div class="'+Vt+'"><span class="rectangle-1"><span></span></span><span class="circle"></span><span class="rectangle-2"><span></span></span></div></div>'},si.prototype.notifyContentReady=function(){var e;null!==(e=this.context.event)&&void 0!==e&&e.trigger(zt,[this.blockId]),this.isContentLoaded=!0,this.readyForCopyCallback&&this.readyForCopyCallback(this)},si.prototype.registerReadyForCopyCallback=function(e){this.readyForCopyCallback=e},si);function si(e,t){var n=this;this.renderLocally=!1,this.isAsync=!0,this.contentAsyncRender=!1,this.context={},this.defaultStyle={width:730,height:160},this.loading=!0,this.isRendered=!1,this.isCancelRender=!1,this.destroyed=!1,this.supportsHalfFullScreen=!1,this.hasCommentCrossing=!1,this.leftOffset=0,this.rectLeft=0,this.mobileSizeMode=xe.NORMAL_SIZE,this.onMountCallbackList=[],this.onErrorCallbackList=[],this.isContentLoaded=!1,this.isHalfFullScreen=function(){return n.supportsHalfFullScreen},this.setProps=function(e){var t=n.mountPoint.parentElement.parentElement;t&&(e?(Object(C.a)(n.props,e),n.context.updateBlockProps&&(n.context.updateBlockProps(n.props,t),n.scheduler.add({block:n,stage:ze.update,updatedData:{type:We.dataset,data:{props:e}}}))):xr("[BLOCK_ERROR]: blockId: "+n.blockId+" setProps with props: "+e))},this.resetProps=function(e){var t=n.mountPoint.parentElement;t&&(e?(n.props.data=e.data,n.context.updateBlockProps&&(n.context.updateBlockProps(n.props,t),n.scheduler.add({block:n,stage:ze.update,updatedData:{type:We.dataset,data:{props:{data:e.data}}}}))):xr("[BLOCK_ERROR]: blockId: "+n.blockId+" resetProps with props: "+e))},this.mountPoint=e,this.blockId=t.blockId,this.props=t.props||{},this.blockType=t.blockType,this.blockToken=t.token,this.attributes={order:1,selected:!1,selectState:Xe.NONE},this.invariantList(["blockId","blockType","mountPoint"],"Failed to create block."),this.resolve&&(this.resolve=Object(k.a)(this.resolve.bind(this)))}function li(n,e){return Object(b.a)(e,function(e,t){n[t]=e}),n}function ci(e,t){return li(e.bind(t),e)}var ui=(di.prototype.set=function(e,t){for(var n=this._weakMap,r=0,i=e.length-1;r<i;r++){var o=e[r],a=n.get(o);a||(a=new Map,n.set(o,a)),n=a}n.set(e[e.length-1],t)},di.prototype.get=function(e){for(var t=this._weakMap,n=0,r=e.length;n<r&&(t=t.get(e[n]),!Object(y.default)(t));n++);return t},di.prototype.has=function(e){return!Object(y.default)(this.get(e))},di);function di(){this._weakMap=new WeakMap}function fi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 2<=e.length&&Object(m.a)(e[0])&&Object(g.a)(e[1])&&Object(S.default)(e[0].constructor)&&e[0].constructor.prototype===e[0]}function hi(e,t){return e===t}function pi(e){return void 0===e&&(e=""),"lodash-decorators -> "+e}function gi(e,t,n,r){if(void 0===r&&(r=!0),Object(S.default)(e))return e;if(Object(g.a)(e)){if(t&&Object(S.default)(t[e]))return t[e];if(n&&Object(S.default)(n[e]))return n[e]}if(r)throw new ReferenceError(pi("Can not resolve method "+e+" on any target Objects"))}var vi=(Object.defineProperty(mi.prototype,"bound",{get:function(){return null!=this.options.bound&&this.options.bound},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"setter",{get:function(){return null!=this.options.setter&&this.options.setter},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"getter",{get:function(){return null!=this.options.getter&&this.options.getter},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"property",{get:function(){return null!=this.options.property&&this.options.property},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"method",{get:function(){return null==this.options.method||this.options.method},enumerable:!0,configurable:!0}),Object.defineProperty(mi.prototype,"optionalParams",{get:function(){return null!=this.options.optionalParams&&this.options.optionalParams},enumerable:!0,configurable:!0}),mi);function mi(e,t,n){void 0===n&&(n={}),this.execute=e,this.applicator=t,this.options=n}function yi(){}var bi=new(yi.prototype.createDecorator=function(l){var c=this,u=l.applicator,r=l.optionalParams;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var s=e,n=function(e,t,n){var r=c._resolveDescriptor(e,t,n),i=r.value,o=r.get,a=r.set;return Ei.has([e,t])||(Object(S.default)(i)?r.value=li(u.apply({config:l,target:e,value:i,args:s}),i):Object(S.default)(o)&&l.getter?r.get=li(u.apply({config:l,target:e,value:o,args:s}),o):Object(S.default)(a)&&l.setter&&(r.set=li(u.apply({config:l,target:e,value:a,args:s}),a))),r};return r&&fi.apply(void 0,an(e))?(s=[],n(e[0],e[1],e[2])):n}},yi.prototype.createInstanceDecorator=function(E){var k=this,C=E.applicator,I=E.bound,r=E.optionalParams;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var b=e,n=function(r,i,e){var t=k._resolveDescriptor(r,i,e),o=t.value,a=t.writable,s=t.enumerable,l=t.configurable,c=t.get,u=t.set,n=!Ei.has([r,i]),d=Ei.get([r,i])||{fns:[],properties:[]},f=n&&Object(S.default)(c),h=n&&Object(S.default)(u),p=n&&Object(S.default)(o),g=n&&!f&&!h&&!p,v=f?c:p?o:void 0;if(d.properties.push(i),d.fns.push(function(e,t,n){return k._isApplicable(n,E)?(I&&(e=ci(e,t)),li(C.apply({args:b,target:r,instance:t,value:e,config:E}),e)):e}),Ei.set([r,i],d),!n)return t;d.isSetter=h,d.isGetter=f,d.isMethod=p,d.isProperty=g;var m=function(e,n,r){return d.fns.reduce(function(e,t){return t(e,r,n)},e)},y=function(e){var t,n=c||void 0,r=u||void 0;f||h?(f&&(n=m(c,{value:c,getter:!0},e)),h&&(r=m(u,{value:u,setter:!0},e)),Object.defineProperty(e,i,{enumerable:s,configurable:l,get:n,set:r})):(p||g)&&(t=m(o,p?{value:o,method:!0}:{value:o,property:!0},e),Object.defineProperty(e,i,{writable:a,enumerable:s,configurable:l,value:t}))};return(p||g)&&(delete t.value,delete t.writable),t.get=function(){if(hi(this,r))return v;y(this);var e=Object.getOwnPropertyDescriptor(this,i);return e.get?e.get.call(this):e.value},t.set=function(e){y(this);var t=Object.getOwnPropertyDescriptor(this,i);t.set?t.set.call(this,e):(g||p)&&(this[i]=e)},t};return r&&fi.apply(void 0,an(e))?(b=[],n(e[0],e[1],e[2])):n}},yi.prototype._isApplicable=function(e,t){return!(e.getter&&!t.getter||e.setter&&!t.setter||e.method&&!t.method||e.property&&!t.property)},yi.prototype._resolveDescriptor=function(e,t,n){return n||Object.getOwnPropertyDescriptor(e,t)||{}},yi),Ei=new ui,ki=Ci;function Ci(){}var Ii,Si=(Yt(Ti,Ii=ki),Ti.prototype.apply=function(e){var t=e.value,n=e.config.execute,r=e.args,i=e.instance;return i?n.apply(void 0,an([t,i],r)):t},Ti);function Ti(){return null!==Ii&&Ii.apply(this,arguments)||this}var Oi;Yt(wi,Oi=ki),Object.defineProperty(wi.prototype,"post",{get:function(){return!0===this._config.post},enumerable:!0,configurable:!0}),wi.prototype.apply=function(e){var i=e.config.execute,t=e.value,o=void 0===t?p.a:t,a=e.args,s=e.target,l=this;return function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=an(a.map(function(e){return gi(e,t,s)}));return l.post?r.push(o):r.unshift(o),i.apply(void 0,an(r)).apply(this,e)}};function wi(e){void 0===e&&(e={});var t=Oi.call(this)||this;return t._config=e,t}var Ri;Yt(Ai,Ri=ki),Ai.prototype.apply=function(e){var n=e.args,r=e.config.execute,i=e.value;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.apply(void 0,an([i.bind(this)],e,n))}};function Ai(){return null!==Ri&&Ri.apply(this,arguments)||this}var xi;Yt(Mi,xi=ki),Mi.prototype.apply=function(e){var t=e.value,n=e.instance,r=e.config.execute,i=e.args,o=e.target,a=gi(!Object(S.default)(i[0])&&Object(m.a)(i[0])?i[0].resolver:i[0],n,o,!1);a&&n&&(a=a.bind(n));var s,l,c,u=a?r(t,a):r(t);return Object(m.a)(i[0])&&(l=(s=i[0]).cache,c=s.type,l?u.cache=l:Object(S.default)(c)&&(u.cache=new c)),u};function Mi(){return null!==xi&&xi.apply(this,arguments)||this}var Ni;Yt(_i,Ni=ki),_i.prototype.apply=function(e){var n=e.args,r=e.target,i=e.config.execute;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.apply(void 0,an([gi(n[0],this,r)],n.slice(1))).apply(this,e)}};function _i(){return null!==Ni&&Ni.apply(this,arguments)||this}var Li;Yt(Di,Li=ki),Di.prototype.apply=function(e){var t=e.config.execute,n=e.value,r=e.args;return f.a.apply(void 0,an([t,n],r))};function Di(){return null!==Li&&Li.apply(this,arguments)||this}var Bi;Yt(Pi,Bi=ki),Pi.prototype.apply=function(e){var i=e.args,o=e.target,a=e.value,s=e.config.execute;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=a,r=0;return Object(S.default)(n)||(n=gi(i[0],this,o),r=1),s.apply(void 0,an([n],i.slice(r))).apply(this,e)}};function Pi(){return null!==Bi&&Bi.apply(this,arguments)||this}var Fi;Yt(ji,Fi=ki),ji.prototype.apply=function(e){var t=e.config.execute,n=e.args,r=e.value;return t.apply(void 0,an(n,[r]))};function ji(){return null!==Fi&&Fi.apply(this,arguments)||this}var zi,Hi=(Yt(Ui,zi=ki),Ui.prototype.apply=function(e){var t=e.value,n=e.config.execute,r=e.args;return n.apply(void 0,an([t],r))},Ui);function Ui(){return null!==zi&&zi.apply(this,arguments)||this}var Vi;Yt(Wi,Vi=ki),Wi.prototype.apply=function(e){var n=e.args,r=e.config.execute,i=e.target,o=e.value;return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(gi(n[0],this,i),o).apply(this,e)}};function Wi(){return null!==Vi&&Vi.apply(this,arguments)||this}var Ki=bi.createInstanceDecorator(new vi(d.a,new Si,{optionalParams:!0})),Zi=bi.createInstanceDecorator(new vi(s.default,new Hi,{setter:!0}));function Gi(e,t){return Zi(e,t)}var qi,Ji,Yi=P.mac;(Ji=qi=qi||{})[Ji.BackSpace=8]="BackSpace",Ji[Ji.Tab=9]="Tab",Ji[Ji.Clear=12]="Clear",Ji[Ji.Enter=13]="Enter",Ji[Ji.Shift=16]="Shift",Ji[Ji.Ctrl=17]="Ctrl",Ji[Ji.Alt=18]="Alt",Ji[Ji.Esc=27]="Esc",Ji[Ji.Space=32]="Space",Ji[Ji.PageUp=33]="PageUp",Ji[Ji.PageDown=34]="PageDown",Ji[Ji.End=35]="End",Ji[Ji.Home=36]="Home",Ji[Ji.Left=37]="Left",Ji[Ji.Up=38]="Up",Ji[Ji.Right=39]="Right",Ji[Ji.Down=40]="Down",Ji[Ji.Delete=46]="Delete",Ji[Ji.Digit0=48]="Digit0",Ji[Ji.Digit9=57]="Digit9",Ji[Ji.A=65]="A",Ji[Ji.B=66]="B",Ji[Ji.C=67]="C",Ji[Ji.D=68]="D",Ji[Ji.E=69]="E",Ji[Ji.F=70]="F",Ji[Ji.G=71]="G",Ji[Ji.H=72]="H",Ji[Ji.I=73]="I",Ji[Ji.J=74]="J",Ji[Ji.K=75]="K",Ji[Ji.L=76]="L",Ji[Ji.M=77]="M",Ji[Ji.N=78]="N",Ji[Ji.O=79]="O",Ji[Ji.P=80]="P",Ji[Ji.Q=81]="Q",Ji[Ji.R=82]="R",Ji[Ji.S=83]="S",Ji[Ji.T=84]="T",Ji[Ji.U=85]="U",Ji[Ji.V=86]="V",Ji[Ji.W=87]="W",Ji[Ji.X=88]="X",Ji[Ji.Y=89]="Y",Ji[Ji.Z=90]="Z",Ji[Ji.Meta=91]="Meta",Ji[Ji.RightMeta=92]="RightMeta",Ji[Ji.Caret=94]="Caret",Ji[Ji.Numpad0=96]="Numpad0",Ji[Ji.Numpad9=105]="Numpad9",Ji[Ji.NumpadDot=110]="NumpadDot",Ji[Ji.F11=122]="F11",Ji[Ji.Semicolon=186]="Semicolon",Ji[Ji.Plus=187]="Plus",Ji[Ji.Minus=189]="Minus",Ji[Ji.Dot=190]="Dot",Ji[Ji.Grave=192]="Grave",Ji[Ji.Bracket=219]="Bracket",Ji[Ji.Quot=222]="Quot",Ji[Ji.Asterisk=106]="Asterisk",Ji[Ji.Slash=111]="Slash",Ji[Ji["/"]=191]="/",Ji[Ji["\\"]=220]="\\",Ji[Ji.Ime=229]="Ime";var Qi=[qi.Up,qi.Down,qi.Left,qi.Right],Xi=[qi.C,qi.V,qi.X];function $i(e){return eo(e)&&-1!==Xi.indexOf(e.keyCode)}function eo(e){return Yi||P.safari?e.metaKey&&!e.altKey:e.ctrlKey&&!e.altKey}var to=(no.prototype.unmount=function(){this.unsubscribe&&this.unsubscribe(),this.manageEvent()},no.prototype.generateBlockContext=function(e){return{permissions:this.permissions}},no.prototype.updateBlockPermission=function(e){this.adapter.updateBlockContext({permissions:e},!0),this.adapter.event.trigger("permissionUpdate",[e])},no);function no(e){var r=this;this.adapter=e,this.className="permission",this.permissionInfo=null,this.permissions=null,this.editMode=null,this.unsubscribe=null,this.updatePermission=function(){r.permissions=Hr()},this.handleStoreChange=function(){var e,t,n;Br.Redux&&(e=jr(),t=zr(),r.permissionInfo===e&&r.editMode===t||(r.permissionInfo=e,r.editMode=t,n=Hr(),Object(E.default)(r.permissions,n)||(r.permissions=n,r.manageEvent(r.permissions),r.updateBlockPermission(r.permissions),r.adapter.event.trigger("permissionsChange",[r.permissions]))))},this.manageEvent=function(e){var t=L()(r.adapter.editor.getDocBody());t.undelegate("."+K,"focus",r.adapter.handleFocusOnBlock),t.undelegate("."+K,"blur",r.adapter.handleBlurOnBlock),e&&e.commentable&&(t.delegate("."+K,"focus",r.adapter.handleFocusOnBlock),t.delegate("."+K,"blur",r.adapter.handleBlurOnBlock))},Br.Redux&&(this.permissions=Hr(),this.permissionInfo=jr(),this.editMode=zr(),this.unsubscribe=Br.Redux.store.subscribe(this.handleStoreChange)),this.adapter.event.on("tableDidRender",this.updatePermission),this.adapter.event.on("onMount",this.updatePermission)}var ro=(Object.defineProperty(io.prototype,"presentationMode",{get:function(){return this.fullscreenOptions?this.fullscreenOptions.mode:at.NONE},enumerable:!0,configurable:!0}),io.prototype.generateBlockContext=function(e){return{presentationMode:this.presentationMode}},io.prototype.isFullScreen=function(){var t,e,n=this.adapter.getBlockInfos(),r=!1;try{for(var i=rn(n.keys()),o=i.next();!o.done;o=i.next()){var a=o.value,s=n.get(a);if(s)if(s.instance.getAttributes().isFullscreen){r=!0;break}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return r},io);function io(e){var r=this;this.adapter=e,this.className="fullscreen",this.fullscreenOptions=null,this.getFullScreenSize=function(){return r.fullscreenOptions&&r.fullscreenOptions.size()},this.handleFullScreenEntered=function(e){r.setFullscreenOptions(e)},this.handleFullScreenModeChanged=function(e){r.setFullscreenOptions(e)},this.handleFullScreenExited=function(){r.resetFullscreenOptions()},this.setFullscreenOptions=function(e){r.fullscreenOptions=e,r.adapter.updateBlockContext({presentationMode:r.presentationMode},!0)},this.resetFullscreenOptions=function(){r.fullscreenOptions=null,r.adapter.updateBlockContext({presentationMode:r.presentationMode},!0)},this.adapter.editor.on("fullscreenEntered",this.handleFullScreenEntered),this.adapter.editor.on("fullscreenModeChanged",this.handleFullScreenModeChanged),this.adapter.editor.on("fullscreenExited",this.handleFullScreenExited);var n=this.adapter.handleOutsideClick;this.adapter.handleOutsideClick=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.isFullScreen()||n.call.apply(n,an([r.adapter],e))};var i=this.adapter.resizeBlocks;this.adapter.resizeBlocks=function(e){var t=r.getFullScreenSize(),n=t?t.width:e;i.call(r.adapter,n)}}var oo="docAdapterIdForHalfFullController",ao=20,so=40,lo=10,co=30,uo=360,fo=310,ho=1600,po=900,go=32,vo=(Object.defineProperty(mo.prototype,"presentationMode",{get:function(){return this.adapter.modules.fullscreen?this.adapter.modules.fullscreen.presentationMode:{}},enumerable:!0,configurable:!0}),mo.prototype.blockWillUpdate=function(e){var t;this.halfFullScreenFeatureEnabled&&e.isHalfFullScreen()&&(t=this.adapter.getDocbodyRect(),this.resizeHalfFullScreenBlock(e,t))},mo.prototype.blockDidMount=function(e){var t;this.halfFullScreenFeatureEnabled&&e.isHalfFullScreen()&&(t=this.adapter.getDocbodyRect(),this.resizeHalfFullScreenBlock(e,t))},mo.prototype.doRegisterHalfFullController=function(e,t){var n,r=$(e).parent().closest("."+K)[0];r&&($(r).addClass("partially-full-screen"),(n=this.adapter.editor.dom.getEntryForNode(t))&&(n.fullWidthNode=r,n.isFullWidth=!0))},mo.prototype.checkEditorOverlayWikiSidebar=function(){if(!Cn())return!1;var e=$(".wiki-sidebar-wrap .sidebar-container")[0];if(!e)return!1;var t=e.getBoundingClientRect(),n=this.getEditorScrollRect();return!!n&&t.right>n.left},mo.prototype.getEditorScrollRect=function(){var e=this.adapter.editor.getScrollContainer();if(!e)return null;if(e instanceof Window){var t=window.innerWidth,n=window.innerHeight;return{left:0,top:0,width:t,height:n,right:t,bottom:n}}return e.getBoundingClientRect()},mo.prototype.unmount=function(){var e=Br.EventEmitter;this.adapter.editor.off("editorRectChange",this.emitterEditorRectChange),this.emitterEditorRectChange.cancel(),this.emitterEditorSizeChange.cancel(),this.handleWikiTrasitionEnd.cancel(),e.off("navWidthChange",this.handleNavWidthChange),e.off("editorSizeChange",this.emitterEditorSizeChange),e.off("changeSidebarState",this.onChangeSidebarState),hn.isMobile||Br.Events&&Br.Events.halfFullController&&(Br.Events.halfFullController.offhalfFullStartToChange(this.handleHalfFullStartToChange),Br.Events.halfFullController.unRegister(this.halfFullId))},mo.prototype.updateCommentCrossing=function(d,f,h){var p=this;return function(e){var t,n,r,i,o,a,s,l,c,u;e.instance.isHalfFullScreen()&&(t=!1,n=e.instance.mountPoint.parentElement,(r=p.adapter.editor.domToRep(n))&&(i=r.selStart[0],(o=p.adapter.editor.getReps()[0].lines.atIndex(i))&&o.isActive&&(a=o.getLineRect("0").top,(c=(s=e.instance.mountPoint).offsetHeight)||(c=(l=$(s).parents(".ace-line")[0])&&l.clientHeight||0),u=a+c,p.adapter.pure?f&&p.resizeHalfFullScreenBlock(e.instance,h):(d&&d.forEach(function(e){a>=e[0]&&a<=e[1]&&(t=!0),u>=e[0]&&u<=e[1]&&(t=!0),a<=e[0]&&u>=e[1]&&(t=!0)}),e.instance.hasCommentCrossing!==t?(e.instance.hasCommentCrossing=t,p.resizeHalfFullScreenBlock(e.instance,h)):f&&p.resizeHalfFullScreenBlock(e.instance,h)))))}},mo.prototype.generateBlockContext=function(e){return{triggerInternalSizeChange:this.handleInternalSizeChange}},mo);function mo(e){var f=this;this.adapter=e,this.className="halffullscreen",this.navWidth=0,this.wikiNavWidth=0,this.isOverlayWikiSidebar=!1,this.halfFullId=oo+"-"+ln(),this.resizeHalfFullScreenBlock=function(e,t){var n,r,i,o,a,s,l,c,u,d;f.halfFullScreenFeatureEnabled&&e.mountPoint.parentElement&&e.isRendered&&((n=f.getEditorScrollRect())&&(r=n.width,i=uo,d=t.left-co-f.navWidth-n.left,r<ho&&(i=fo),o=$(e.mountPoint).parent().closest("."+K),a=e.internalWidth||t.innerWidth,e.internalWidth=a,s=e.hasCommentCrossing?i:0,l=co+ao+s,u=Math.min(a+d,r-l-f.navWidth),(!f.isOverlayWikiSidebar&&t.left-n.left<=go||f.isOverlayWikiSidebar&&r<po||f.presentationMode!==at.NONE||!hn.isVC&&!hn.isLarkWindow&&hn.isLark||hn.isFeed)&&(c=!hn.isVC&&hn.isLark||hn.isFeed?lo:so,u=(f.adapter.editor.getInnerWidth()||t.width)-ao-c,d=0),o.css("left","-"+d+"px").css("width",u+"px"),e.containerWidth=u,e.resize(void 0,void 0,u,d)))},this.handleProcessPlaceholder=function(e){var t=e.newSpan,n=e.entry,r=e.blockDataSet;f.registerHalfFullController(t,n.lineNode,r)},this.registerHalfFullController=function(e,t,n){var r=f.adapter.getBlockInfo(n.blockId);!hn.mobile&&r&&r.instance&&r.instance.isHalfFullScreen()&&f.doRegisterHalfFullController(e,t)},this.initNavWidth=function(){var e,t,n;Cn()&&f.isOverlayWikiSidebar&&(e=$(".wiki-container"),(n=(t=$(".wiki-sidebar-wrap .sidebar-container")).width())&&(f.wikiNavWidth=n),e.height()===t.height()&&n&&(f.navWidth=n))},this.handleInternalSizeChange=function(e,t,n){var r,i,o,a;f.halfFullScreenFeatureEnabled&&(r=f.adapter.getDocbodyRect(),e.block.internalWidth!==n&&(e.block.internalWidth=n,f.resizeHalfFullScreenBlock(e.block,r)),i=r.left,e.block.leftOffset===t&&e.block.rectLeft===i||(e.block.rectLeft=i,e.block.leftOffset=t,o=Br.EventEmitter,a=e.block.rectLeft-30,o.trigger("updateBlockEditbar",[{leftOffset:t-a,commands:e.block.editbarCommands,callerBlockId:e.block.blockId}]),o.trigger("blockPositionUpdate")),f.adapter.editor.call("verticalPositionUpdate"))},this.handleHalfFullStartToChange=function(e,t){var n,r=Br.Events.halfFullController;f.halfFullScreenFeatureEnabled&&(n=f.getCommentPanelPositionData(t),f.handleCommentsPassingWidthUpdate(n)),r.halfFullIsChanged(f.halfFullId,e)},this.getCommentPanelPositionData=function(e){return e.map(function(e){return[e.top,e.top+e.height]})},this.handleWikiTrasitionEnd=Object(s.default)(function(){f.emitterEditorRectChange()},100),this.onChangeSidebarState=function(e){var t=e.state,n=e.width;n&&"move"===t?f.isOverlayWikiSidebar&&(f.navWidth=n,f.wikiNavWidth=n):"retract"===t?(f.isOverlayWikiSidebar=f.checkEditorOverlayWikiSidebar(),f.navWidth=0):"expand"===t&&(f.isOverlayWikiSidebar=f.checkEditorOverlayWikiSidebar(),f.isOverlayWikiSidebar&&(f.navWidth=f.wikiNavWidth)),f.handleWikiTrasitionEnd()},this.handleNavWidthChange=function(e){f.navWidth!==e&&(f.navWidth=e,f.emitterEditorRectChange())},this.emitterEditorRectChange=Object(s.default)(function(){f.handleResizeHalffullScreen(!0)},300),this.emitterEditorSizeChange=Object(s.default)(function(){f.handleResizeHalffullScreen(!1)},100),this.handleResizeHalffullScreen=function(e){var t,n,r,i;f.halfFullScreenFeatureEnabled&&(f.adapter.editor.call("verticalPositionUpdate"),(n=void 0===(t=(Br.Events||{}).halfFullController)?null:t)&&(r=n.getCommentPositionData(),i=f.getCommentPanelPositionData(r),f.handleCommentsPassingWidthUpdate(i,e)))},this.handleCommentsPassingWidthUpdate=function(e,t){void 0===t&&(t=!1);var n=f.adapter.getBlockInfos(),r=f.adapter.getDocbodyRect(t);n.forEach(f.updateCommentCrossing(e,t,r))},this.handleCheckHalfFullScreenStatus=function(e){var t,n,r,i=(Br.Events||{}).halfFullController,o=void 0===i?null:i;o&&(t=o.getCommentPositionData(),n=f.getCommentPanelPositionData(t),r=f.adapter.getDocbodyRect(),e.forEach(function(e){return f.updateCommentCrossing(n,!1,r)(e)}))},this.registerHalfFullControllerWhenReuseDom=function(e){var t,n=e.entry,r=e.blockDataSet;!r||(t=f.adapter.getBlockInfo(r.blockId))&&t.span&&n&&n.lineNode&&f.registerHalfFullController(t.span,n.lineNode,r)},this.isOverlayWikiSidebar=this.checkEditorOverlayWikiSidebar(),this.initNavWidth(),this.halfFullScreenFeatureEnabled=Vr();var t=Br.EventEmitter;this.adapter.editor.on("editorRectChange",this.emitterEditorRectChange),t.on("editorSizeChange",this.emitterEditorSizeChange),t.on("changeSidebarState",this.onChangeSidebarState),t.on("navWidthChange",this.handleNavWidthChange),this.adapter.event.on("processPlaceholder",this.handleProcessPlaceholder),this.adapter.event.on("reuseDomForBlock",this.registerHalfFullControllerWhenReuseDom),this.adapter.event.on("checkHalfFullScreenStatus",this.handleCheckHalfFullScreenStatus),hn.isMobile||Br.Events&&Br.Events.halfFullController&&!this.adapter.pure&&(Br.Events.halfFullController.onhalfFullStartToChange(this.handleHalfFullStartToChange),Br.Events.halfFullController.register(this.halfFullId));var r=this.adapter._resizeBlock;this.adapter._resizeBlock=function(e,t){var n;e.isLoading()||(!hn.isMobile&&Vr()&&e.isHalfFullScreen()?(n=f.adapter.getDocbodyRect(),f.resizeHalfFullScreenBlock(e,n)):r.call(f.adapter,e,t))}}var yo=(bo.prototype.unmount=function(){window.clearTimeout(this.pauseTimer),window.clearTimeout(this.freezeTimer),document.removeEventListener("visibilitychange",this.onVisibilityChange)},bo.prototype.onVisible=function(){window.clearTimeout(this.pauseTimer),window.clearTimeout(this.freezeTimer);var e=Date.now();-1!==this.startFreezeTime&&this.invisibleTime&&e-this.invisibleTime>this.startFreezeTime&&this.unfreezeBlocks(),-1!==this.startPauseTime&&this.invisibleTime&&e-this.invisibleTime>this.startPauseTime&&this.adapter.scheduler.resume(),this.invisibleTime=null},bo.prototype.onInvisible=function(){var e=this;this.invisibleTime=Date.now(),-1!==this.startPauseTime&&(this.pauseTimer=window.setTimeout(function(){return e.pauseScheduler()},this.startPauseTime)),-1!==this.startFreezeTime&&(this.freezeTimer=window.setTimeout(function(){return e.freezeBlocks()},this.startFreezeTime))},bo.prototype.pauseScheduler=function(){this.adapter.scheduler.pause(),this.isMainEditor&&Zr("scheduler_pause_task_count",{count:this.adapter.scheduler.getTaskCount(),pause_waiting_time:this.startPauseTime})},bo.prototype.unfreezeBlocks=function(){var t=0,n=Array.from(this.adapter.blockInfos.values());this.freezeBlockList.filter(function(e){return n.includes(e)}).forEach(function(e){e.instance.unfreeze&&(e.instance.unfreeze(),t++)}),this.isMainEditor&&Zr("scheduler_unfreeze_block_count",{count:t,unfreeze_waiting_time:Date.now()-this.invisibleTime}),this.freezeBlockList.length=0},bo.prototype.freezeBlocks=function(){var t=0;this.freezeBlockList=this.getFreezableBlockList(),this.freezeBlockList.forEach(function(e){e.instance.freeze&&(e.instance.freeze(),t++)}),this.isMainEditor&&Zr("scheduler_freeze_block_count",{count:t,freeze_waiting_time:this.startPauseTime})},bo.prototype.getFreezableBlockList=function(){var r=this;return Array.from(this.adapter.blockInfos.values()).filter(function(e){var t=e.instance.props.viewType===Oe.INLINE,n=r.adapter.isBlockVisible(e.instance.blockId);return!t&&!n})},bo);function bo(e,t){var n=this;void 0===t&&(t={}),this.adapter=e,this.className="inactiveOptimize",this.startFreezeTime=18e5,this.startPauseTime=6e4,this.invisibleTime=null,this.freezeBlockList=[],this.isMainEditor=this.adapter.isForMainEditor(),this.onVisibilityChange=function(){document.hidden?n.onInvisible():n.onVisible()},this.startFreezeTime=t.startFreezeTime,this.startPauseTime=t.startPauseTime,document.addEventListener("visibilitychange",this.onVisibilityChange)}var Eo=(ko.prototype.setScrollPerformance=function(e,t){this.scrollPerformace.has(e)?this.scrollPerformace.set(e,Qt(Qt({},this.scrollPerformace.get(e)),t)):this.scrollPerformace.set(e,t)},ko.prototype.handleAlinesInited=function(){var t,e,n=Array.from(this.adapter.blockInfos.values()).map(function(e){return e.instance}),r=Object(u.a)(n,"blockType"),i={};try{for(var o=rn(Object.entries(r)),a=o.next();!a.done;a=o.next()){var s=on(a.value,2),l=s[0],c=s[1];i[l+"_COUNT"]=c.length}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}this.logCount(i)},ko.prototype.getTime=function(){return performance.now()},ko.prototype.setMetrics=function(e,t){this.blockPerformance.has(e)?this.blockPerformance.set(e,Qt(Qt({},this.blockPerformance.get(e)),t)):this.blockPerformance.set(e,t)},ko.prototype.logTime=function(e){if(this.isMainEditor){var t=this.blockPerformance.get(e);if(t&&(t.after_mount_time||t.fail_mount_time)){this.logger.log("block_performance_v2",Qt({block_id:e.blockId,block_type:e.blockType,mount_cost:(t.after_mount_time||t.fail_mount_time)-t.before_mount_time},t));try{this.logScrollPerformance(e,t)}catch(e){xr("[BLOCK_ERROR]: tea log scrollPerformance exception: "+e.massage)}}}},ko.prototype.logScrollPerformance=function(e,t){var n,r,i,o,a,s,l,c,u=this.scrollPerformace.get(e);u&&(n=u.scrollInToView,r=u.firstScreen,i=u.renderInTable,o=u.queueTriggerBegin,a=u.queueTriggerEnd,l=(s=n||r||i)?(t.after_mount_time||t.fail_mount_time)-s:0,c=o&&a?a-o:0,this.logger.log("block_scroll_performance",Qt({block_id:e.blockId,block_type:e.blockType,mount_cost:l,queueFiber:c},u)))},ko.prototype.logCount=function(e){this.isMainEditor&&this.logger.log("block_statistics_v2",e)},ko.prototype.blockDidInit=function(e){this.setMetrics(e,{init_time:this.getTime()})},ko.prototype.blockWillMount=function(e){this.setMetrics(e,{before_mount_time:this.getTime()})},ko.prototype.blockDidMount=function(e){this.setMetrics(e,{after_mount_time:this.getTime()}),this.logTime(e)},ko.prototype.blockFailMount=function(e){this.setMetrics(e,{fail_mount_time:this.getTime()}),this.logTime(e)},ko.prototype.blockDidCreate=function(e){this.setMetrics(e,{after_create_time:this.getTime()}),this.logTime(e)},ko);function ko(e,t){var r=this;this.adapter=e,this.logger=t,this.className="tea",this.isMainEditor=this.adapter.isForMainEditor(),this.blockPerformance=new WeakMap,this.scrollPerformace=new WeakMap,this.handleWaitStart=function(e){r.setScrollPerformance(e,{waitStart:r.getTime()})},this.handleRenderInTable=function(e){r.setScrollPerformance(e,{renderInTable:r.getTime()})},this.handlefirstScreen=function(e){var t={firstScreen:r.getTime()};r.setScrollPerformance(e,t)},this.handleQueueTriggerBegin=function(e){r.setScrollPerformance(e,{queueTriggerBegin:r.getTime()})},this.handleQueueTriggerEnd=function(e){r.setScrollPerformance(e,{queueTriggerEnd:r.getTime()})},this.handleCancelBlockNotInViewport=function(e){var t=r.scrollPerformace.get(e),n=t&&t.cancelTimes?t.cancelTimes+1:1;r.setScrollPerformance(e,{cancelTimes:n})},this.handleScrollInView=function(e){var t={scrollInToView:r.getTime()};r.setScrollPerformance(e,t)},this.adapter.event.on("onAlinesInited",this.handleAlinesInited.bind(this)),this.adapter.event.on("scrollinview",this.handleScrollInView),this.adapter.event.on("cancelBlockNotInViewport",this.handleCancelBlockNotInViewport),this.adapter.event.on("queueTriggerBegin",this.handleQueueTriggerBegin),this.adapter.event.on("queueTriggerEnd",this.handleQueueTriggerEnd),this.adapter.event.on("renderInTable",this.handleRenderInTable),this.adapter.event.on("firstScreen",this.handlefirstScreen),this.adapter.event.on("waitStart",this.handleWaitStart)}var Co=(Io.prototype.unmount=function(){this.blockContextMap.clear()},Io.prototype.blockDidMount=function(e){e.contentAsyncRender||this.markBlockRendered(e),this.debounceNotifyAllBlockContentRendered()},Io.prototype.blockFailMount=function(e){this.markBlockRenderFailed(e),this.debounceNotifyAllBlockContentRendered()},Io.prototype.blockRenderTimeout=function(e){this.markBlockRenderTimeout(e),this.debounceNotifyAllBlockContentRendered()},Io);function Io(e){var i=this;this.adapter=e,this.className="blockWatcher",this.blockContextMap=new Map,this.isAllBlockContentRendered=function(){return Array.from(i.adapter.blockInfos).every(function(e){var t=on(e,2),n=t[0];t[1];return i.isBlockContentRendered(n)})},this.handleBlockContentRendered=function(e){var t=i.adapter.getBlockById(e);t&&(i.markBlockRendered(t),i.debounceNotifyAllBlockContentRendered()),i.adapter.editor.call(zt,e)},this.isBlockContentRendered=function(e){var t=i.blockContextMap.get(e);return t&&(t.contentRendered||t.failed||t.timeout)},this.debounceNotifyAllBlockContentRendered=Object(s.default)(function(){i.isAllBlockContentRendered()&&i.adapter.editor.call(Ht)},100),this.markBlockRenderStatus=function(e,t){var n=i.blockContextMap.get(e.blockId),r=Qt(Qt({},n),t);i.blockContextMap.set(e.blockId,r)},this.markBlockRenderTimeout=function(e){i.markBlockRenderStatus(e,{timeout:!0})},this.markBlockRenderFailed=function(e){i.markBlockRenderStatus(e,{failed:!0})},this.markBlockRendered=function(e){i.markBlockRenderStatus(e,{contentRendered:!0})},this.adapter.event.on(zt,this.handleBlockContentRendered),setTimeout(function(){i.adapter.isAllBlockContentRendered=i.isAllBlockContentRendered},0)}var So,To=[Le.REMINDER_BLOCK,Le.BITABLE_BLOCK,Le.SHEET_BLOCK,Le.JIRA_FILTER_BLOCK,Le.AT_USER_BLOCK],Oo=(wo.prototype.unmount=function(){Br.EventEmitter&&(document.removeEventListener("selectionchange",this.handleSelectionChange),Br.EventEmitter.off("MOBILE:COMMON:ENTER_EDIT",this.enterEditing),Br.EventEmitter.off("MOBILE:COMMON:EXIT_EDIT",this.exitEditing),Br.EventEmitter.off("clickFromContextMenu",this.handleClickFromContextMenu),L()(document).off("touchstart touchmove touchend",this.handleTap),window.removeEventListener("blur",this.handleOnBlur),F.browser.isIPad&&(L()(document).off("mousedown",this.handleMouseDown),L()(document).off("mouseup",this.handleMouseUp)))},wo.prototype.handleSelectionChange=function(){this.isLongTaping&&this.adapter.handleSelectionChange()},wo.prototype.blockDidMount=function(e){var t=e.mountPoint.closest("."+Z);!To.includes(e.blockType)&&t&&(t.className+=" disable-select")},wo.prototype.getBlockFromEvent=function(e){var t=this.adapter.getEditor(),n=e.target,r=L()(n).closest("."+K);if(r[0]&&t.domToRep(r[0])){var i=qn(r[0]);if(i){var o=this.adapter.getBlockInfo(i.blockId);if(o)return o.instance}}},wo.prototype.focusBlock=function(e){try{var t=this.adapter.getEditor();e.setAttributes({selected:!0,selectState:Xe.FOCUS_ON_BLOCK});var n=this.getRepFromBlock(e);if(!n)return;t.selection.setWithSelection(n.selStart[2],n.selStart,n.selEnd);var r=window.getSelection();r.removeAllRanges();var i,o,a=document.createRange();e.props.viewType===Oe.INLINE?(i=e.mountPoint.closest("."+V),a.setStart(i.previousSibling,0),a.setEnd(i.nextSibling,1)):(o=e.mountPoint.closest("."+Z).previousSibling.firstChild,a.setStart(o,0),a.setEnd(o,0)),r.addRange(a)}catch(e){console.error(e)}},wo.prototype.showBlockMenu=function(e){var t,n,r,i,o,a,s=e.mountPoint.closest("."+K);s&&(n=(t=s.getBoundingClientRect()).left,r=t.top,i=t.right,o=t.bottom,a=window.scrollY,this.currentBlock=e,this.showMenu({top:r+a,left:n,right:i,bottom:o+a}))},wo.prototype.getRepFromBlock=function(e){return this.adapter.getEditor().domToRep(e.mountPoint.closest("."+K))},wo.prototype.removeAllSelected=function(){var t,e;try{for(var n=rn(this.adapter.getBlockInfos().entries()),r=n.next();!r.done;r=n.next()){var i=on(r.value,2)[1];i.instance.getAttributes().selected&&i.instance.setAttributes({selected:!1,selectState:Xe.NONE})}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},$t([Ki(),Gi(60),en("design:type",Function),en("design:paramtypes",[]),en("design:returntype",void 0)],wo.prototype,"handleSelectionChange",null),wo);function wo(e){var a=this;this.adapter=e,this.className="mobile",this.editing=!1,this.prevent=!1,this.isLongTaping=!1,this.isMouseDown=!1,this.lastTouchTime=0,this.toggleEditing=function(){return a.editing=!a.editing},this.enterEditing=function(){return a.editing=!0},this.exitEditing=function(){return a.editing=!1},this.showMenu=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Br.EventEmitter.trigger("MOBILE:CONTEXT_MENU:showDocContextMenu",e)},this.hideMenu=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Br.EventEmitter.trigger("MOBILE:CONTEXT_MENU:closeContextMenu",e)},this.handleOnBlur=function(){var e,t,n;a.editing&&document.activeElement&&"IFRAME"===document.activeElement.nodeName&&(!(e=document.activeElement.closest("."+K))||(t=qn(e))&&(n=a.adapter.getBlockInfo(t.blockId).instance,a.focusBlock(n),a.showBlockMenu(n)))},this.handleClickFromContextMenu=function(e){var t,n=e.id;a.currentBlock&&F.browser.isAndroid&&(t=a.currentBlock,"COPY"===n?a.adapter.copyBlock({block:t}):"CUT"===n?a.adapter.cutBlock({block:t}):"DELETE"===n&&a.adapter.deleteBlock({block:t}))},this.handleLongTap=function(e){var t,n,r=window.getSelection();r&&"Range"===r.type||(a.isLongTaping=!0,(t=a.getBlockFromEvent(e))&&!To.includes(t.blockType)?(a.lastClickBlock=t,a.getRepFromBlock(t)?(a.prevent=!0,n=t.onLongTap?t.onLongTap(e):{},a.removeAllSelected(),n&&!n.preventFocus&&(e.preventDefault(),e.stopImmediatePropagation(),a.focusBlock(t),n.preventShowMenu||(a.showBlockMenu(t),window.lark.biz.util.triggerShake({grade:"medium",time:20,strength:100})))):a.removeAllSelected()):a.removeAllSelected())},this.handleMouseDown=function(){a.editing&&200<Date.now()-a.lastTouchTime&&(a.isMouseDown=!0)},this.handleMouseUp=function(e){a.isMouseDown&&(a.handleSingleClick(e,!1),a.isMouseDown=!1)},this.handleSingleClick=function(e,t){void 0===t&&(t=!0),t&&(a.lastTouchTime=Date.now());var n=window.getSelection();if(!n||"Range"!==n.type){var r=a.getBlockFromEvent(e);if(!r)return a.currentBlock&&(a.currentBlock=void 0,a.hideMenu({})),a.lastClickBlock=void 0,void a.removeAllSelected();if(To.includes(r.blockType))a.removeAllSelected();else if(a.getRepFromBlock(r)){if(a.lastClickBlock===r){var i=r.onDoubleTap?r.onDoubleTap(e):{};return a.removeAllSelected(),a.editing&&i&&!i.preventFocus&&(r.setAttributes({selected:!0,selectState:Xe.FOCUS_ON_BLOCK}),a.focusBlock(r),e.preventDefault(),e.stopImmediatePropagation()),a.lastClickBlock=void 0,void(So&&window.clearTimeout(So))}a.lastClickBlock=r,So=window.setTimeout(function(){return a.lastClickBlock=void 0},500);var o=r.onTap?r.onTap(e):{};a.removeAllSelected(),a.editing&&o&&!o.preventFocus&&(e.preventDefault(),e.stopImmediatePropagation(),a.focusBlock(r),o.preventShowMenu||a.showBlockMenu(r))}else a.removeAllSelected()}},this.handleTap=Tn({onClick:this.handleSingleClick,onLongPress:this.handleLongTap,touchDuration:450}),this.preventDefault=function(e){a.prevent&&(e.preventDefault(),a.prevent=!1),a.isLongTaping=!1},Br.EventEmitter&&(Br.EventEmitter.on("MOBILE:COMMON:ENTER_EDIT",this.enterEditing),Br.EventEmitter.on("MOBILE:COMMON:EXIT_EDIT",this.exitEditing),Br.EventEmitter.on("clickFromContextMenu",this.handleClickFromContextMenu),L()(document).on("touchstart touchmove touchend",this.handleTap),L()(document).on("touchend",this.preventDefault),F.browser.isIPad&&(L()(document).on("mousedown",this.handleMouseDown),L()(document).on("mouseup",this.handleMouseUp)),window.addEventListener("blur",this.handleOnBlur),document.addEventListener("selectionchange",this.handleSelectionChange))}var Ro=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function Ao(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var xo=function(e){e.styles;var t=Ao(e,["styles"]);return U.a.createElement("svg",Ro({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),U.a.createElement("path",{d:"M14.359 17.015l-1.8 1.757a.8.8 0 0 1-1.118 0l-1.8-1.757H5.8a.8.8 0 0 1-.8-.8V5.8a.8.8 0 0 1 .8-.8h12.4a.8.8 0 0 1 .8.8v10.415a.8.8 0 0 1-.8.8h-3.841zM12 17.22l1.748-1.706H17.5V6.5h-11v9.015h3.752L12 17.22zM8.4 10h7.2c.22 0 .4.18.4.4v.7a.4.4 0 0 1-.4.4H8.4a.4.4 0 0 1-.4-.4v-.7c0-.22.18-.4.4-.4z"}))},Mo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function No(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var _o=function(e){e.styles;var t=No(e,["styles"]);return U.a.createElement("svg",Mo({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),U.a.createElement("path",{d:"M9 6v-.7a.8.8 0 0 1 .8-.8h4.4a.8.8 0 0 1 .8.8V6h4.487c.179 0 .243.019.308.053a.363.363 0 0 1 .152.152c.034.065.053.13.053.308v.474c0 .179-.019.243-.053.308a.363.363 0 0 1-.152.152c-.065.034-.13.053-.308.053H18v11.2a.8.8 0 0 1-.8.8H6.8a.8.8 0 0 1-.8-.8V7.5H4.513c-.179 0-.243-.019-.308-.053a.363.363 0 0 1-.152-.152C4.02 7.23 4 7.165 4 6.987v-.474c0-.179.019-.243.053-.308a.363.363 0 0 1 .152-.152C4.27 6.02 4.335 6 4.513 6H9zm7.5 1.5h-9V18h9V7.5zm-6.6 2h.7c.22 0 .4.18.4.4v5.7a.4.4 0 0 1-.4.4h-.7a.4.4 0 0 1-.4-.4V9.9c0-.22.18-.4.4-.4zm3.5 0h.7c.22 0 .4.18.4.4v5.7a.4.4 0 0 1-.4.4h-.7a.4.4 0 0 1-.4-.4V9.9c0-.22.18-.4.4-.4z"}))},Lo=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function Do(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var Bo=function(e){e.styles;var t=Do(e,["styles"]);return U.a.createElement("svg",Lo({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),U.a.createElement("path",{d:"M7.5 8.5v9.093h7V8.5h-7zm8.5-.833V18.5c0 .327-.279.593-.622.593H6.622c-.343 0-.622-.266-.622-.593V7.593C6 7.265 6.279 7 6.622 7h8.711c.369 0 .667.298.667.667zm2.912-3.58A.3.3 0 0 1 19 4.3v7.4a.3.3 0 0 1-.3.3h-.9a.3.3 0 0 1-.3-.3V5.5h-6.2a.3.3 0 0 1-.3-.3v-.9a.3.3 0 0 1 .3-.3h7.4a.3.3 0 0 1 .212.088z"}))},Po=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function Fo(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var jo=function(e){e.styles;var t=Fo(e,["styles"]);return U.a.createElement("svg",Po({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),U.a.createElement("path",{d:"M12.967 12.06l1.81 1.79a2.812 2.812 0 0 1 1.423-.384c1.546 0 2.8 1.239 2.8 2.767C19 17.761 17.746 19 16.2 19c-1.546 0-2.8-1.239-2.8-2.767 0-.513.141-.994.388-1.406l-1.81-1.789-1.783 1.761c.257.418.405.91.405 1.434C10.6 17.761 9.346 19 7.8 19 6.254 19 5 17.761 5 16.233c0-1.528 1.254-2.767 2.8-2.767.507 0 .983.133 1.394.367l1.793-1.773-5.04-4.98a.343.343 0 0 1 0-.49l.495-.489a.353.353 0 0 1 .495 0l5.04 4.98 5.04-4.98a.353.353 0 0 1 .495 0l.495.49a.343.343 0 0 1 0 .489l-5.04 4.98zm3.233 5.556c.773 0 1.4-.619 1.4-1.383s-.627-1.384-1.4-1.384c-.773 0-1.4.62-1.4 1.384 0 .764.627 1.383 1.4 1.383zm-8.4 0c.773 0 1.4-.619 1.4-1.383s-.627-1.384-1.4-1.384c-.773 0-1.4.62-1.4 1.384 0 .764.627 1.383 1.4 1.383z"}))},zo={separator:{Icon:function(){return U.a.createElement("div",{className:"block-editbar--separater"})}},cut:{Icon:function(){return U.a.createElement("div",null,U.a.createElement(jo,null),U.a.createElement("span",null,Gr("common.cut")))},requiredPermissions:{readable:!1,editable:!0,commentable:!1,shareable:!1,printable:!1,exportable:!1,copyable:!0}},copy:{Icon:function(){return U.a.createElement("div",null,U.a.createElement(Bo,null),U.a.createElement("span",null,Gr("common.copy")))},abled:function(e){return e&&e.copyable}},delete:{Icon:function(){return U.a.createElement("div",null,U.a.createElement(_o,null),U.a.createElement("span",null,Gr("common.delete")))},requiredPermissions:{readable:!1,editable:!0,commentable:!1,shareable:!1,copyable:!1,printable:!1,exportable:!1}},comment:{Icon:function(){return U.a.createElement(xo,null)},tooltip:Gr("block.editbar_comment"),requiredPermissions:{readable:!1,editable:!0,commentable:!1,shareable:!1,copyable:!1,printable:!1,exportable:!1}}},Ho=(Object.defineProperty(Uo.prototype,"permissions",{get:function(){var e=this.adapter.modules.permission;return e?e.permissions:{}},enumerable:!0,configurable:!0}),Object.defineProperty(Uo.prototype,"presentationMode",{get:function(){var e=this.adapter.modules.fullscreen;return e?e.presentationMode:{}},enumerable:!0,configurable:!0}),Uo.prototype.unmount=function(){var e=L()(this.getEditBarMountNode()),t=L()(this.editor.getDocBody());e.undelegate(".block-editbar--hoverable","mouseenter",this.handleEditbarMouseEnter),e.undelegate(".block-editbar--hoverable","mouseleave",this.handleEditbarMouseLeave),e.undelegate(".block-menu--hoverable","mouseenter",this.handleEditbarMouseEnter),e.undelegate(".block-menu--hoverable","mouseleave",this.handleEditbarMouseLeave),hn.isMobile||t.undelegate("."+oe,"click",this.handleBlockToolbarClick)},Uo.prototype.getCurrentEditbarBlockId=function(){return L()(".block-editbar-wraper").attr("data-blockid")},Uo.prototype.cancelHideEditbar=function(){this.editbarTimer&&(clearTimeout(this.editbarTimer),this.editbarTimer=null)},Uo.prototype.generateBlockContext=function(e){return{getCommandByKey:this.getCommandByKey,updateEditbar:this.updateEditbar}},Uo.prototype.blockDidInit=function(e){var t=e.mountPoint;this.registerEditbar(e,L()(t))},Uo.prototype.blockDidUpdate=function(e){this.addBlockHoverable(e)},Uo.prototype.addBlockHoverable=function(e){var t=e.mountPoint.parentElement;!Gt(e)||e.editbarTrigger!==Ne.hover||hn.isMobile||null!==t&&void 0!==t&&t.classList.contains("block-hoverable")||null===t||void 0===t||!t.classList.contains(Z)||null!==t&&void 0!==t&&t.classList.add("block-hoverable")},Uo.prototype.hideBlockEditbar=function(){Br.EventEmitter.trigger("hideBlockEditbar"),this.isBlockEditbarVisible=!1},Uo.prototype.hideBlockMenu=function(){Br.EventEmitter.trigger("hideBlockMenu"),this.isBlockMenuVisible=!1},Uo.prototype.hideLinePopover=function(){Br.EventEmitter.trigger("editorbar:hideLinePopover")},Uo.prototype.getEditbarCommands=function(e,t){var n=this,r=t.props&&t.props.viewType,i=function(e){return e.key!==Re.comment||e.key===Re.comment&&(n.permissions.commentable||n.adapter.isTemplate)},o=function(e){return!e.key.includes("_view")||n.isEditable()},a=function(e){var t=!r||!e.readOnlyVisibility||e.readOnlyVisibility&&e.readOnlyVisibility.includes(r);return!!n.isEditable()||t},s=e&&e.filter(function(e){return i(e)&&o(e)&&a(e)});if(!s)return[];for(var l=s.length-1;0<=l;l--)s[l].key===Re.separator&&(l!==s.length-1&&0!==l&&s[l-1].key!==Re.separator||s.splice(l,1));return s},Uo.prototype.getPositionInfo=function(e){var t,n,r,i,o,a,s,l=this.editor.getOuterContainer().getBoundingClientRect(),c=e.mountPoint.firstElementChild.getBoundingClientRect(),u=c.left-l.left+.5*c.width,d=0,f=-50,h=-100;e.getEditbarOffset&&(r=(n=e.getEditbarOffset(l,c)).x,i=n.xRight,o=n.y,a=n.transformXPercent,s=n.transformYPercent,"number"!=typeof r&&"number"!=typeof i&&console.error("Block EditbarOffset is invalid, either 'x' or 'xRight' should be a number"),u=r||0,t=i,d=o,f=a,h=s);var p=this.editor.getScrollTop();return{originY:c.top-l.top,offsetX:u,offsetXRight:t,offsetY:d,transformX:f,transformY:h,scrollTop:p}},Uo.prototype.getMenuCommands=function(){var n=this;return[Re.cut,Re.copy,Re.delete].map(this.getCommandByKey).filter(function(e){var t=e.requiredPermissions;return!t||Object.keys(t).every(function(e){return!t[e]||t[e]&&n.permissions[e]})})},Uo.prototype.isEditable=function(){return this.editor.isEditable()},Uo.prototype.registerEditbar=function(e,t){var n;Gt(e)&&(e.replaceCommandPlaceholder(),(n=this.getEditBarMountNode())?L()("#mainBox ."+re)[0]||L()(n).append(ke):L()(t).append(ke),this.addBlockHoverable(e))},Uo.injectClasses=[],Uo);function Uo(e){var p=this;this.adapter=e,this.className="toolbar",this.isBlockEditbarVisible=!1,this.isBlockMenuVisible=!1,this.editbarTimer=null,this.deferMouseEnterEvent=null,this.onScrollEndInViewport=function(){p.deferMouseEnterEvent&&(p.handleBlockMouseEnterDebounced(p.deferMouseEnterEvent),p.deferMouseEnterEvent=null)},this.handleBlockMouseEnter=function(e){p.handleBlockMouseEnterDebounced(Qt({},e)),p.cancelHideEditbar()},this.showBlockEditbar=function(e,t){var n,r,i=Br.EventEmitter;p.adapter.isOnline&&p.presentationMode===at.NONE&&document.documentElement.contains(e.mountPoint)&&e.mountPoint.firstElementChild&&(n=p.getEditbarCommands(e.editbarCommands,e),r=p.getPositionInfo(e),n&&(p.editor.call("showBlockEditbar",{positionInfo:r,commands:n,rep:t,context:{block:e}}),p.isBlockEditbarVisible=!0),i.trigger("showBlockMenu",[{positionInfo:r,commands:p.getMenuCommands(),context:{block:e}}]),p.isBlockMenuVisible=!0,p.hideLinePopover())},this.updateBlockToolbar=function(){var e=Br.EventEmitter;L()(".block-menu").length&&e.trigger("updateBlockMenu",[{commands:p.getMenuCommands()}]);var t,n,r,i=L()(".block-editbar");i.length&&(t=i.parent().data().blockid,!(n=p.adapter.getBlockInfo(t))||Gt(r=n.instance)&&p.updateEditbar(r.editbarCommands,r))},this.handleMouseLeaveOnBlock=function(){p.deferMouseEnterEvent=null,L()(".block-editbar--hoverable").length?p.deferHideEditbar():p.handleBlockMouseEnterDebounced.cancel()},this.handleOutsideClick=function(e){var t,n=L()(".block-menu");n.length&&n[0].contains(e.target)?p.hideBlockEditbar():(t=L()(".block-editbar")).length&&t[0].contains(e.target)?p.hideBlockMenu():p.hideBlockToolbar()},this.handleOffline=function(){p.hideBlockToolbar()},this.hideBlockToolbar=function(){p.isBlockEditbarVisible&&p.hideBlockEditbar(),p.isBlockMenuVisible&&p.hideBlockMenu()},this.handleBlockDelete=function(e){p.getCurrentEditbarBlockId()===e.blockId&&p.hideBlockToolbar()},this.onSelectionChanged=function(){var e,t,n;!hn.isMobile&&p.isBlockEditbarVisible&&(!(e=p.getCurrentEditbarBlockId())||(t=p.adapter.getBlockById(e))&&(n=p.editor.getRep(),ir(n)||rr(n)||t.editbarTrigger===Ne.hover||p.hideBlockToolbar()))},this.onChangesetApply=function(e){var t=e.callstack;t&&t.isCollabChangedSelection||p.hideBlockToolbar()},this.handleBlockToolbarClick=function(e){var t=L()(e.currentTarget).closest(".ace-line")[0],n=p.editor.domToRep(t);n&&(p.editor.selection.setWithSelection(n.selStart[2],n.selStart,n.selStart,!0),p.editor.selection.internalUpdateSelectionFromRep(!0))},this.handleBlockMouseEnterDebounced=Object(s.default)(function(e){var t,n,r,i,o,a,s,l,c,u,d,f,h;p.editor.blockRender.isScrolling()?p.deferMouseEnterEvent=e:(t=L()(e.currentTarget).closest("."+K)[0])&&(r=(n=qn(t)).blockId,(i=p.adapter.getBlockInfo(r))&&(o=i.instance,a=t.parentNode,s=p.editor.getRep(),!p.editor.selection.isCaret(s)&&!rr(s)||(l=p.editor.domToRep(a))&&(c=l.selStart[0],u=l.selStart[2]||"0",(d=p.editor.getRep(u).lines.atIndex(c))&&(n&&fr(n)?(f=l.selStart,h=l.selEnd,p.showBlockEditbar(o,{selStart:f,selEnd:h,zoneId:f[2]})):p.showBlockEditbar(o,{selStart:[c,0],selEnd:[c,d.text.length],zoneId:l.selStart[2]})))))},200),this.handleEditbarMouseEnter=function(){p.cancelHideEditbar()},this.handleEditbarMouseLeave=function(){p.deferHideEditbar()},this.deferHideEditbar=function(){p.editbarTimer=window.setTimeout(function(){p.hideBlockToolbar(),p.editor.call("updateLinePopover")},300)},this.getEditBarMountNode=function(){return p.editor.getOuterContainer().parentElement},this.updateEditbar=function(e,t){var n;L()(".block-editbar-wraper").attr("data-blockId")===t.blockId&&(n=p.adapter.getLeftMarginWidth(),Br.EventEmitter.trigger("updateBlockEditbar",[{commands:p.getEditbarCommands(e,t),leftOffset:t.leftOffset-n}]))},this.getCommandByKey=function(e){return{key:e,Icon:zo[e].Icon,handler:p.getCommandHandler(e),requiredPermissions:zo[e].requiredPermissions,tooltip:zo[e].tooltip,disabled:zo[e].abled&&!zo[e].abled(p.permissions),disabledHandler:p.getCommandDisabledHandler(e)}},this.getCommandHandler=function(e){switch(e){case"copy":return function(e,t){return p.handleCopyBlock(t)};case"delete":return function(e,t){return p.handleDeleteBlock(t)};case"cut":return function(e,t){return p.handleCutBlock(t)};case"comment":return p.commentBlock;default:return function(){}}},this.commentBlock=function(e,t){p.editor.call("commentButtonClick",{event:e,selection:t}),p.hideBlockToolbar()},this.getCommandDisabledHandler=function(e){return"copy"!==e?function(){}:function(){return p.handleCopyWithoutPermission()}},this.handleCopyWithoutPermission=function(){var e=Br.Redux,t=e.store,n=e.actions.copyTextWithoutPermission;t.dispatch(n())},this.handleCopyBlock=function(e){var t=e.block,n=t.blockId,r=t.blockType;p.adapter.copyBlock(e),p.event.trigger("copyBlockFromMenu",[{blockId:n,blockType:r}])},this.handleDeleteBlock=function(e){var t=e.block,n=t.blockId,r=t.blockType;p.adapter.deleteBlock(e),p.event.trigger("deleteBlockFromMenu",[{blockId:n,blockType:r}])},this.handleCutBlock=function(e){var t=e.block,n=t.blockId,r=t.blockType;p.adapter.cutBlock(e),p.event.trigger("cutBlockFromMenu",[{blockId:n,blockType:r}])},this.editor=e.editor,this.event=e.event,this.event.on("blockMouseEnter",this.handleBlockMouseEnter),this.event.on("blockClick",this.showBlockEditbar),this.event.on("permissionUpdate",this.updateBlockToolbar),this.event.on("blockMouseLeave",this.handleMouseLeaveOnBlock),this.event.on("outsideClick",this.handleOutsideClick),this.event.on("offline",this.handleOffline),this.event.on("blockComment",function(){return p.hideBlockToolbar}),this.event.on("blockDeleted",function(){return p.handleBlockDelete}),this.event.on("selectionChanged",this.onSelectionChanged),this.event.on("changesetApply",this.onChangesetApply),this.event.on("scrollEndInViewport",this.onScrollEndInViewport);var t=L()(this.getEditBarMountNode()),n=L()(this.editor.getDocBody());t.delegate(".block-editbar--hoverable","mouseenter",this.handleEditbarMouseEnter),t.delegate(".block-editbar--hoverable","mouseleave",this.handleEditbarMouseLeave),t.delegate(".block-menu--hoverable","mouseenter",this.handleEditbarMouseEnter),t.delegate(".block-menu--hoverable","mouseleave",this.handleEditbarMouseLeave),hn.isMobile||n.delegate("."+oe,"click",this.handleBlockToolbarClick)}var Vo=(Wo.prototype.blockDidInit=function(a){return tn(this,void 0,void 0,function(){var t,n,r,i,o;return nn(this,function(e){switch(e.label){case 0:if(!(t=this.adapter.getBlockAttribute(a.blockId)))return[2,this.adapter.traceBlockErrorWithLineInfo(a,"blockDidInit without blockAttrib")];if(n=Bn(t),r=this.adapter.blockManager.getBlockCreator(a.blockType),!(n&&n.depLoading&&r&&r.loadDep&&r.makeLoadedDataSet))return[3,5];e.label=1;case 1:return e.trys.push([1,4,,5]),[4,r.loadDep()];case 2:return e.sent(),i=r.makeLoadedDataSet(n),[4,this.updateDataSet(a,i)];case 3:return e.sent(),[3,5];case 4:return o=e.sent(),this.handleLoadError(a,o),[3,5];case 5:return[2]}})})},Wo.prototype.updateDataSet=function(n,r){return tn(this,void 0,void 0,function(){var t;return nn(this,function(e){switch(e.label){case 0:if(!r)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.replaceBlock(n,r)];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),this.handleLoadError(n,t),[3,4];case 4:return[3,6];case 5:this.deleteBlock(n),e.label=6;case 6:return[2]}})})},Wo.prototype.deleteBlock=function(e){var t=e.blockId;this.adapter.deleteBlock({block:e},!0,!0),this.adapter.editor.call(Pt,t)},Wo.prototype.replaceBlock=function(t,n){return tn(this,void 0,void 0,function(){return nn(this,function(e){switch(e.label){case 0:return[4,this.adapter.replaceBlock(t,n,!0)];case 1:return e.sent(),this.adapter.editor.call(Pt,t.blockId),[2]}})})},Wo.prototype.handleLoadError=function(e,t){var n=e.blockId;this.deleteBlock(e),this.adapter.editor.call(Ft,[n,t])},Wo);function Wo(e){this.adapter=e,this.className="dependencyLoading"}var Ko=(Zo.prototype.getBlockDataSet=function(e){return Bn(this.core.getBlockAttribute(e.blockId))||{}},Zo.prototype.isSyncRender=function(e){return this.core.isSyncRender(this.getBlockDataSet(e))||e.renderLocally},Zo.prototype.blockWillMount=function(e){this.isSyncRender(e)&&this.hideLoading(e)},Zo.prototype.blockDidMount=function(e){this.isSyncRender(e)||this.hideLoading(e)},Zo.prototype.blockFailMount=function(e){this.hideLoading(e),this.displayError(e)},Zo.prototype.hideLoading=function(r){var e,t,n,i=this;r.loading&&(r.loading=!1,this.isSyncRender(r)?(e=L()(r.mountPoint).closest("."+V),t=L()(r.mountPoint).siblings("."+ae),n={id:r.blockId,type:r.blockType,inContainer:0<e.length,hasLoading:0<t.length,inDom:document.contains(r.mountPoint)},0!==t.length&&0!==e.length||this.core.event.emit("hideLoadingFail",n),t.hide(),r.mountPoint.style.display=""):this.lockViewPort(r,function(){var e=L()(r.mountPoint).closest("."+V),t=L()(r.mountPoint).siblings("."+ae),n={id:r.blockId,type:r.blockType,inContainer:0<e.length,hasLoading:0<t.length,inDom:document.contains(r.mountPoint)};0!==t.length&&0!==e.length||i.core.event.emit("hideLoadingFail",n),t.hide(),r.mountPoint.style.display=""}),this.core.event.emit("afterHideLoading",r.blockId))},Zo.prototype.lockViewPort=function(e,t){this.core.event.trigger("blockInstanceWillUpdate",[e.blockId,!0]),t(),this.core.event.trigger("blockInstanceDidUpdate",[e.blockId,!0])},Zo.prototype.displayError=function(e){var t,n,r,i,o=e.mountPoint.parentElement;o&&(n=(t=L()(o)).closest("."+K),r="",e.props&&e.props.displayMode===Be.INLINE?r="block-error-loading-placeholder--inline":n.css("width","100%"),0===(i=t.find("."+se)).length?t.prepend('\n        <div class="'+se+" block-error-loading-placeholder "+r+'">\n          <span class="block-error-loading-placeholder__icon svg-icon_error"></span>\n          <span>'+Gr("block.loading_error")+"</span>\n        </div>"):i.show(),L()(e.mountPoint).hide())},Zo);function Zo(e){this.core=e,this.className="loading"}var Go=(qo.prototype.unmount=function(){this.renderStackMap.clear()},qo.prototype.blockDidInit=function(e,t){var n,r;fr(e)||(n=t.node,r={from:t.from,stage:"renderBlock",stack:this.getStack(),inDom:document.contains(e.mountPoint),inContainer:n.contains(e.mountPoint)},this.push(e.blockId,r))},qo.prototype.blockWillUnmount=function(e){this.clearedId.delete(e.blockId),this.renderStackMap.delete(e.blockId)},qo.prototype.log=function(e,t){var n=this.renderStackMap.get(e);xr("[BLOCK_ERROR_HIDE_LOADING_FAIL]: "+e+" "+t+" "+JSON.stringify(n))},qo.prototype.push=function(e,t){var n;fr(this.adapter.getBlockById(e))||this.clearedId.has(e)||((n=this.renderStackMap.get(e))?(n.push(t),10<n.length&&n.shift()):this.renderStackMap.set(e,[t]))},qo.prototype.getStack=function(e){void 0===e&&(e="");var t=new Error(e).stack||"";try{if(t&&hn.isChrome)return t.split("\n").slice(1).map(function(e){return e.trim().split(" ")[1]}).join("\n")}catch(e){return console.log(e.stack),t}return t},qo);function qo(e){var s=this;this.adapter=e,this.className="blockRenderTracker",this.renderStackMap=new Map,this.clearedId=new Set,this.onReuseDomForBlock=function(e){var t=e.entry,n=e.blockDataSet,r=s.adapter.getBlockById(n.blockId),i=!1,o=!1;r&&t.lineNode&&(i=t.lineNode.contains(r.mountPoint),o=document.contains(r.mountPoint));var a={stage:"reuseDomForBlock",stack:s.getStack(),inContainer:i,inDom:o,from:"linesWillReplace"};s.push(n.blockId,a)},this.onReRenderBlock=function(e){var t=e.block,n=e.node,r=e.from,i={stage:"reRenderBlock",stack:s.getStack(),inContainer:n.contains(t.mountPoint),inDom:document.contains(t.mountPoint),from:r};s.push(e.block.blockId,i)},this.onHideLoadingFail=function(e){var t=e.id,n=e.type,r={from:"hideLoading",stage:"blockDidMount",inContainer:e.inContainer,inDom:e.inDom,hasLoading:e.hasLoading,stack:s.getStack()};s.push(t,r),s.log(t,n)},this.clear=function(e){s.renderStackMap.has(e)&&(s.clearedId.add(e),s.renderStackMap.delete(e))},this.adapter.event.on("reuseDomForBlock",this.onReuseDomForBlock),this.adapter.event.on("reRenderBlock",this.onReRenderBlock),this.adapter.event.on("hideLoadingFail",this.onHideLoadingFail),this.adapter.event.on("afterHideLoading",this.clear)}function Jo(){return new Map([[to,!1],[vo,!1],[ro,!1],[Eo,!1],[Co,!1],[yo,!1],[Oo,!1],[Ho,!1],[Vo,!1],[Ko,!1]])}var Yo="sheet-id";function Qo(t,n,e){return e.map(function(e){return Qt(Qt({},e),{serviceType:n,serviceToken:t})})}function Xo(e,t,n,r){var i,o={attributeKey:n,attributeValue:r};return e!==Le.SHEET_BLOCK||r||(i=pr(t).sheetId,o.attributeKey=Yo,o.attributeValue=i||""),o}function $o(e){return Yt(t,n=e),t.prototype.makeBlockServiceComments=function(e){var t=e.token,n=e.commentInfos,r=this.getBlock(t);if(!r)return console.warn("Block with token '"+t+"' does not exist."),null;var i=r.blockId,o=r.blockType,a=r.getToken()||"",s=Q,l=this.getBlockAttribute(i)||"",c=Qo(t,o,n);return Qt({comments:c,serviceType:o,serviceToken:t},Xo(o,a,s,l))},t;function t(){var p=null!==n&&n.apply(this,arguments)||this;return p.getComments=function(e){var t=[],n=p.getBlock(e);if(!n||!n.getCommentMarks)return t;var r=n.getCommentMarks();return t=Qo(n.getToken()||"",n.blockType,r)},p.getActiveComments=function(e){var t=[],n=p.getBlock(e);if(!n||!n.getActiveComments)return t;var r=n.getActiveComments();return t=Qo(n.getToken()||"",n.blockType,r)},p.getResolvedComments=function(e){var t={serviceType:"",comments:[]},n=p.getBlock(e);if(!n||!n.getResolvedComments)return t;var r=n.getResolvedComments(),i=n.getToken()||"",o=n.blockType;return t.comments=Qo(i,o,r),t},p.getSeriveTypeAndServiceTokenByAttributeKeyAndValue=function(e,t){var n=null;if(!jn(e)&&e!==Yo)return n;var r="";if(e===Yo)for(var i=t,o=p.blockInfos.values(),a=o.next().value;!r&&a;){var s=a.instance,l=s.blockId,c=s.blockType,u=s.blockToken;"SHEET_BLOCK"===c&&pr(u).sheetId===i&&(r=l),a=o.next().value}else{var d=An(t);if(!d.size)return n;r=Array.from(d)[0]}var f=p.getBlockById(r);if(!f||!f.commentImplemented)return n;var h=f.getToken();return h?n={serviceToken:h,serviceType:f.blockType}:n},p.setCommentData=function(n,r){return tn(p,void 0,void 0,function(){var t;return nn(this,function(e){return(t=this.getBlock(n))&&t.setCommentData?[2,t.setCommentData(r)]:[2]})})},p.setResolvedCommentIds=function(e,t){var n=p.getBlock(e);if(n&&n.setResolvedCommentIds)return n.setResolvedCommentIds(t)},p.startNewComment=function(e,t){var n=e.serviceToken,r=e.tempCommentId,i=p.getBlock(n);return i&&i.startNewComment?i.startNewComment(r,t):""},p.saveComment=function(o){return tn(p,void 0,void 0,function(){var t,n,r,i;return nn(this,function(e){return t=o.serviceToken,n=o.tempCommentId,r=o.commentId,(i=this.getBlock(t))?i.saveCommentMark?[2,i.saveCommentMark(n,r)]:[2]:[2,Promise.reject(new Error("Block with token '"+t+"' does not exist."))]})})},p.removeComment=function(n,r){return tn(p,void 0,void 0,function(){var t;return nn(this,function(e){return(t=this.getBlock(n))?t.removeCommentMark?[2,t.removeCommentMark(r)]:[2]:[2,Promise.reject(new Error("Block with token '"+n+"' does not exist."))]})})},p.removeTempComment=function(e,t){var n=p.getBlock(e);if(n&&n.removeTempCommentMark)return n.removeTempCommentMark(t)},p.getTeaParams=function(e,t){var n=p.getBlock(e);return n?n.getTeaParams?n.getTeaParams(t):void 0:Promise.reject(new Error("Block with token '"+e+"' does not exist."))},p.resolveComment=function(n,r){return tn(p,void 0,void 0,function(){var t;return nn(this,function(e){return(t=this.getBlock(n))?t.resolveCommentMark?[2,t.resolveCommentMark(r)]:[2]:[2,Promise.reject(new Error("Block with token '"+n+"' does not exist."))]})})},p.reopenComment=function(s,l){return tn(p,void 0,void 0,function(){var t,n,r,i,o,a;return nn(this,function(e){switch(e.label){case 0:return(t=this.getBlock(s))?t.reopenComment?(n=t.blockId,r=t.blockType,[4,t.reopenComment(l)]):[2,null]:[2,Promise.reject(new Error("Block with token '"+s+"' does not exist."))];case 1:return e.sent(),i=t.getToken()||"",o=Q,a=this.getBlockAttribute(n)||"",[2,Qt({},Xo(r,i,o,a))]}})})},p.activateComment=function(e,t){var n=p.getBlock(e);return n?n.activateComment?n.activateComment(t):void 0:Promise.reject(new Error("Block with token '"+e+"' does not exist."))},p.deactivateComment=function(e,t){var n=p.getBlock(e);return n?n.deactivateComment?n.deactivateComment(t):void 0:Promise.reject(new Error("Block with token '"+e+"' does not exist."))},p.addHoverHighlight=function(e,t){var n=p.getBlock(e);return n?n.addHoverHighlight?n.addHoverHighlight(t):void 0:Promise.reject(new Error("Block with token '"+e+"' does not exist."))},p.removeHoverHighlight=function(e,t){var n=p.getBlock(e);return n?n.removeHoverHighlight?n.removeHoverHighlight(t):void 0:Promise.reject(new Error("Block with token '"+e+"' does not exist."))},p.locateComment=function(l,c){return tn(p,void 0,void 0,function(){var t,n,r,i,o,a,s;return nn(this,function(e){switch(e.label){case 0:return(t=this.getBlock(l))?t.locateComment?[4,t.locateComment(c)]:[2,null]:[2,Promise.reject(new Error("Block with token '"+l+"' does not exist."))];case 1:return(n=e.sent())?(r=t.blockId,i=t.blockType,o=t.getToken()||"",a=Q,s=this.getBlockAttribute(r)||"",[2,Qt(Qt(Qt({},n),{serviceType:i}),Xo(i,o,a,s))]):[2,null]}})})},p.onCommentStartLoading=function(l){p.event.addListener(et.START_LOADING,function(e){var t,n,r,i,o,a=e.token,s=p.getBlock(a);s?(t=s.blockId,n=s.blockType,r=s.getToken()||"",i=Q,o=p.getBlockAttribute(t)||"",l([Qt({serviceType:n,serviceToken:a},Xo(n,r,i,o))])):console.warn("Block with token '"+a+"' does not exist.")})},p.onCommentLoaded=function(r){p.event.addListener(et.LOADED,function(e){var t=Array.isArray(e)?e:[e],n=[];t.forEach(function(e){var t=p.makeBlockServiceComments(e);t&&n.push(t)}),0<n.length&&r(n)})},p.notifyCommentBatchLoaded=function(e){p.event.trigger(et.LOADED,[e])},p.onCommentMount=function(n){p.event.addListener(et.MOUNT,function(e){var t=e.token;n(t)})},p.onCommentLoadError=function(r){p.event.addListener(et.LOADED_ERROR,function(e){var t=p.getBlock(e);t||console.warn("Block with token '"+e+"' does not exist.");var n=t&&t.blockType||"";r([{serviceType:n,serviceToken:e}])})},p.onCommentUpdated=function(r){p.event.addListener(et.UPDATED,function(e){var t=Array.isArray(e)?e:[e],n=[];t.forEach(function(e){var t=p.makeBlockServiceComments(e);t&&n.push(t)}),0<n.length&&r(n)})},p.notifyCommentBatchUpdated=function(e){p.event.trigger(et.UPDATED,[e])},p.onActiveCommentChanged=function(e){p.event.addListener(et.ACCTIVE_CHANGE,function(){e()})},p}var n}var ea,ta=(Yt(na,ea=ai),na.prototype.listenToCommentUpdate=function(){this.getToken()?Br.CommentService&&Br.CommentService.onCommentChange(this.onCommentChange.bind(this)):console.warn("Token of block '"+this.blockId+"' does not exist.")},na.prototype.stopListenToCommentUpdate=function(){this.getToken()?Br.CommentService&&Br.CommentService.offCommentChange(this.onCommentChange.bind(this)):console.warn("Token of block '"+this.blockId+"' does not exist.")},na.prototype.onCommentChange=function(e){var t=this;if(t.setCommentData)return t.setCommentData(e)},na.prototype.addComment=function(i){return tn(this,void 0,void 0,function(){var t,n,r;return nn(this,function(e){switch(e.label){case 0:return(t=this.getToken()||"")?(n=this.blockType,[4,Br.CommentService.addComment(Qt(Qt({},i),{isWhole:0,parentType:n,parentToken:t}))]):[2,Promise.reject(new Error("Token of block '"+this.blockId+"' does not exist."))];case 1:return r=e.sent(),[2,{commentId:r.comment.commentId}]}})})},na.prototype.activeCommentChange=function(){var e=this.context.event;e&&e.trigger(et.ACCTIVE_CHANGE)},na.prototype.removeComment=function(t){return tn(this,void 0,void 0,function(){return nn(this,function(e){switch(e.label){case 0:return this.getToken()||""?[4,Br.CommentService.deleteComment(t)]:[2,Promise.reject(new Error("Token of block '"+this.blockId+"' does not exist."))];case 1:return e.sent(),[2,t]}})})},na.prototype.updateComment=function(r){return tn(this,void 0,void 0,function(){var t,n;return nn(this,function(e){switch(e.label){case 0:return t=r.commentId,n=r.replyId,this.getToken()||""?[4,Br.CommentService.updateComment(r)]:[2,Promise.reject(new Error("Token of block '"+this.blockId+"' does not exist."))];case 1:return e.sent(),[2,{commentId:t,replyId:n}]}})})},na.prototype.replyComment=function(r){return tn(this,void 0,void 0,function(){var t,n;return nn(this,function(e){switch(e.label){case 0:return t=r.commentId,n=r.replyId,this.getToken()||""?[4,Br.CommentService.replyComment(r)]:[2,Promise.reject(new Error("Token of block '"+this.blockId+"' does not exist."))];case 1:return e.sent(),[2,{commentId:t,replyId:n}]}})})},na.prototype.readComment=function(t){return tn(this,void 0,void 0,function(){return nn(this,function(e){return[2,t]})})},na.prototype.resolveComment=function(t){return tn(this,void 0,void 0,function(){return nn(this,function(e){switch(e.label){case 0:return this.getToken()||""?[4,Br.CommentService.resolveComment({commentId:t})]:[2,Promise.reject(new Error("Token of block '"+this.blockId+"' does not exist."))];case 1:return e.sent(),[2,t]}})})},na);function na(){var r=null!==ea&&ea.apply(this,arguments)||this;return r.commentImplemented=!0,r.notifyCommentUpdate=function(e){var t=r.blockToken,n=r.context.event;n&&n.trigger(et.UPDATED,[{token:t,commentInfos:e}])},r.notifyCommentStartLoading=function(){var e=r.getToken(),t=r.context.event;t&&t.trigger(et.START_LOADING,[{token:e}])},r.notifyCommentLoaded=function(e){var t=r.getToken(),n=r.context.event;n&&n.trigger(et.LOADED,[{token:t,commentInfos:e}])},r.notifyCommentMount=function(){var e=r.getToken(),t=r.context.event;t&&t.trigger(et.MOUNT,{token:e})},r}function ra(e){for(var t=Object.keys(e),n=t.length,r=0;r<n;r+=1){var i=t[r];Br[i]=e[i]}zo.comment.tooltip=Gr("block.editbar_comment")}var ia=(oa.prototype.register=function(e){var t,n;try{for(var r=rn(e),i=r.next();!i.done;i=r.next()){var o=i.value;this.creators[o.blockType]=o}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},oa.prototype.getMemberId=function(){return Pr()},oa.prototype.getSyncRenderConfig=function(e,t){var n=this.getBlockCreator(e);return t?!1!==(null===n||void 0===n?void 0:n.isSyncRender):!!n&&!!n.isSyncRender},oa.prototype.getPrerenderPlaceholderConfig=function(e){var t=this.getBlockCreator(e);return!!t&&t.usePrerenderPlaceholder},oa.prototype.getBlockCreator=function(e){return this.creators[e]||(e=Le.PLACEHOLDER_BLOCK),this.creators[e]},oa.prototype.isBlockCreatorRegistered=function(e){return!!this.creators[e]},oa.prototype.getBlockEnableModules=function(e){var t=this.getBlockCreator(e);return t&&t.moduleConfigs&&t.moduleConfigs||[]},oa.prototype.unregister=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach(function(e){return delete t.creators[e]})},oa.prototype.renderHistoryItem=function(e,t){var n,r=t?JSON.parse(t):{},i=r.blockType||"",o=this.creators[i];o?o.renderHistoryItem&&((n=document.createElement("div")).className="block-history-placeholder",n.setAttribute("data-block-history-delete-tc",Gr("history.deleted")),e.innerHTML="",e.appendChild(n),o.renderHistoryItem(n,r.props)):e.innerText="[BLOCK]"},oa.prototype.resetHistoryItem=function(e,t){var n=t?JSON.parse(t):{},r=n.blockType||"",i=this.creators[r];i&&i.resetHistoryItem&&i.resetHistoryItem(e,n.props)},oa.prototype.iterateCreator=function(e){var t,n;try{for(var r=rn(Object.values(this.creators)),i=r.next();!i.done;i=r.next())e(i.value)}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},oa);function oa(e){void 0===e&&(e=[]),this.creators={},this.register(e)}var aa=(sa.prototype.setPriorityStrategy=function(e){this.priorityFunc=e},sa.prototype.setFiber=function(e){this.fiber=e},Object.defineProperty(sa.prototype,"taskCount",{get:function(){return this.runningQueue.length+this.queue.length},enumerable:!0,configurable:!0}),sa.prototype.pause=function(){this.isPaused=!0},sa.prototype.continue=function(){this.isPaused=!1,this.schedule()},sa.prototype.isBlockScheduled=function(t){return!!(t.isRendered||this.queue.find(function(e){return e.block===t})||this.runningQueue.find(function(e){return e.block===t}))},sa.prototype.add=function(n){var r=this;return n.block.event.emit("waitStart",n.block),new Promise(function(e,t){"HIGH"===n.priority?r.queue.unshift(Qt(Qt({},n),{resolve:e,reject:t})):r.queue.push(Qt(Qt({},n),{resolve:e,reject:t})),r.schedule()})},sa.prototype.clear=function(t){this.queue=this.queue.filter(function(e){return e.block.blockId!==t});var e=this.runningQueue.findIndex(function(e){return e.block.blockId===t}),n=this.runningQueue[e];n&&this.cancelTask(n)},sa.prototype.cancelTask=function(t){t.destroyed=!0,t.nextTask=void 0,t.resolve(!1);var e=this.runningQueue.findIndex(function(e){return e.block.blockId===t.block.blockId});-1!==e&&this.runningQueue.splice(e,1),this.schedule()},sa.prototype.getNextTask=function(){if(0<this.queue.length&&this.runningQueue.filter(function(e){return!e.timeout}).length<this.concurrency){if(!this.priorityFunc)return this.queue.shift();var t=this.priorityFunc(this.queue.map(function(e){return e.block.blockId}));if(t){var e=this.queue.findIndex(function(e){return e.block.blockId===t});return on(this.queue.splice(e,1),1)[0]}return this.queue.shift()}},sa.prototype.schedule=function(){var n=this;if(!this.isPaused)for(var e=function(){var t=r.getNextTask();if(!t)return"break";var e=r.runningQueue.find(function(e){return e.block.blockId===t.block.blockId});if(e)return r.chainTask(e,t),"continue";r.runningQueue.push(t),r.sync||t.sync?r.render(t):(t.block.event.emit("queueTriggerBegin",t.block),r.appConfig.fiber&&r.fiber&&t.stage!==ze.update?r.fiber.scheduleTask(function(){t.block.event.emit("queueTriggerEnd",t.block),n.render(t)},0):r.nextTick().then(function(){t.block.event.emit("queueTriggerEnd",t.block),n.render(t)}))},r=this;;)if("break"===e())break},sa.prototype.reset=function(){this.queue=[],this.runningQueue=[],this.destroyed=!0,this.fiber=null},sa.prototype.chainTask=function(e,t){if(e.block.blockId===t.block.blockId)if(e.nextTask){if(t.updatedData){for(var n=t.updatedData.type,r=e.nextTask,i=e;r;){if(r.updatedData&&r.updatedData.type===n)return void Object(C.a)(r.updatedData,t.updatedData);r=(i=r).nextTask}i.nextTask=t}}else e.nextTask=t;else console.error(t+" chained to "+e+" with different blockId!")},sa.prototype.render=function(h){var p,g;return tn(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u,d,f=this;return nn(this,function(e){switch(e.label){case 0:if(this.destroyed||h.destroyed)return[2];t=h.block,n=h.updatedData,r=h.stage,i=window.setTimeout(function(){h.timeout=!0,f.destroyed||h.block.destroyed?f.cancelTask(h):(console.error("block: "+t.blockId+" render timeout"),f.hooks.callAll("blockRenderTimeout",t),f.schedule())},this.timeout),o=r===ze.initial,e.label=1;case 1:return e.trys.push([1,17,,18]),o&&t.resolve?[4,t.resolve()]:[3,15];case 2:if(!(a=e.sent())||!_r(a))return[3,14];e.label=3;case 3:e.trys.push([3,8,9,14]),s=sn(a),e.label=4;case 4:return[4,s.next()];case 5:if((l=e.sent()).done)return[3,7];l.value,e.label=6;case 6:return[3,4];case 7:return[3,14];case 8:return c=e.sent(),p={error:c},[3,14];case 9:return e.trys.push([9,,12,13]),l&&!l.done&&(g=s.return)?[4,g.call(s)]:[3,11];case 10:e.sent(),e.label=11;case 11:return[3,13];case 12:if(p)throw p.error;return[7];case 13:return[7];case 14:t.dataLoaded=!0,e.label=15;case 15:return this.lazyBlockEnable&&t.shouldRender&&!t.shouldRender(t)?(t.isCancelRender=!0,t.event.emit("cancelBlockNotInViewport",t),[2,this.doneTask(h,"pause render",!0,i)]):(o||!1!==t.isRendered||(r=ze.initial,o=!0),this.hooks.callAll(o?"blockWillMount":"blockWillUpdate",t),this.hooks.callAll("blockWillRender",t),[4,t.render(r,o?void 0:n)]);case 16:return(u=e.sent(),t.isRendered=!0,this.destroyed||h.block.destroyed)?(window.clearTimeout(i),this.cancelTask(h),[2]):(this.hooks.callAll("blockDidRender",t),o?(this.hooks.callAll("blockDidMount",t),t.onMountCallbackList.forEach(function(e){return e(h.block)})):this.hooks.callAll("blockDidUpdate",t),this.doneTask(h,u,!0,i),[3,18]);case 17:return d=e.sent(),console.error("block: "+t.blockId+" render failed"),xr("[BLOCK]: render failed "+d.message),this.hooks.callAll(o?"blockFailMount":"blockFailUpdate",t),t.isRendered=!0,t.onErrorCallbackList.forEach(function(e){return e(d)}),this.doneTask(h,d,!0,i),[3,18];case 18:return[2]}})})},sa.prototype.doneTask=function(t,e,n,r){var i,o=this;window.clearTimeout(r),this.nextTick().then(function(){return!o.isPaused&&o.schedule()}),this.destroyed||-1!==(i=this.runningQueue.findIndex(function(e){return e===t}))&&(this.runningQueue.splice(i,1),n?t.resolve(e):t.reject(e),t.nextTask&&this.queue.unshift(t.nextTask))},sa.prototype.nextTick=function(){return tn(this,void 0,void 0,function(){return nn(this,function(e){switch(e.label){case 0:return[4,new Promise(function(e){var t=function(e){return e()};(window?window.requestAnimationFrame:t)(e)})];case 1:return e.sent(),[2]}})})},Object.defineProperty(sa.prototype,"lazyBlockEnable",{get:function(){return this.appConfig.lazyBlockRender},enumerable:!0,configurable:!0}),sa);function sa(e,t){void 0===t&&(t={}),this.hooks=e,this.isPaused=!1,this.queue=[],this.runningQueue=[],this.concurrency=Number.MAX_SAFE_INTEGER,this.timeout=5e3,this.sync=!1,this.destroyed=!1,this.priorityFunc=null,this.appConfig={},this.concurrency=Object(T.default)(t,"concurrency",this.concurrency),this.timeout=Object(T.default)(t,"timeout",this.timeout),this.sync=Object(T.default)(t,"sync",!1),this.appConfig=Object(T.default)(t,"appConfig",{})}var la=(ca.prototype.getTaskCount=function(){return this.inlineBlockQueue.taskCount+this.blockQueue.taskCount+this.iframeQueue.taskCount},ca.prototype.setPriorityStrategy=function(e){this.inlineBlockQueue.setPriorityStrategy(e),this.blockQueue.setPriorityStrategy(e),this.iframeQueue.setPriorityStrategy(e)},ca.prototype.setFiber=function(e){this.inlineBlockQueue.setFiber(e),this.blockQueue.setFiber(e),this.iframeQueue.setFiber(e)},ca.prototype.pause=function(){this.inlineBlockQueue.pause(),this.blockQueue.pause(),this.iframeQueue.pause()},ca.prototype.resume=function(){this.inlineBlockQueue.continue(),this.blockQueue.continue(),this.iframeQueue.continue()},ca.prototype.isBlockScheduled=function(e){return this.inlineBlockQueue.isBlockScheduled(e)||this.iframeQueue.isBlockScheduled(e)||this.blockQueue.isBlockScheduled(e)},ca.prototype.add=function(e){if(e.block.isCancelRender=!1,e.block.destroyed)return Promise.resolve();e.stage===ze.initial&&(e.stage=this.isBlockScheduled(e.block)?ze.update:ze.initial);var t=fr(e.block),n=e.block.blockType===Le.IFRAME_BLOCK;return(t?this.inlineBlockQueue:n?this.iframeQueue:this.blockQueue).add(e)},ca.prototype.clear=function(r){return tn(this,void 0,void 0,function(){var t,n;return nn(this,function(e){return t=fr(r),n=r.blockType===Le.IFRAME_BLOCK,t?[2,this.inlineBlockQueue.clear(r.blockId)]:n?[2,this.iframeQueue.clear(r.blockId)]:[2,this.blockQueue.clear(r.blockId)]})})},ca.prototype.reset=function(){this.inlineBlockQueue.reset(),this.blockQueue.reset(),this.iframeQueue.reset()},ca);function ca(e){var t,n={timeout:e.timeout,appConfig:e.appConfig};this.inlineBlockQueue=new aa(e.hooks,Qt({sync:!(null!==(t=null===e||void 0===e?void 0:e.appConfig)&&void 0!==t&&t.inlineBlockAsyncRender)},n)),this.blockQueue=new aa(e.hooks,Qt({concurrency:e.appConfig.concurrency||6},n)),this.iframeQueue=new aa(e.hooks,Qt({concurrency:e.appConfig.concurrency||6},n))}var ua=(da.prototype.getModuleInstance=function(t){return Object.values(this.modules).find(function(e){return e instanceof t})},da.prototype.callAll=function(i,o){for(var e,t,a=this,s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];o.destroyed?console.warn("block "+o.blockId+" has been destroyed, "+i+" hook will be ignored."):("function"==typeof o[i]&&o[i].apply(o,an(s)),this.blockManager&&(t=this.blockManager.getBlockEnableModules(o.blockType),an(this.builtInModules,t).forEach(function(t){var e,n=Array.isArray(t)?(e=t[1],a.getModuleInstance(t[0])):a.getModuleInstance(t);if(n){var r=n[i];if("function"==typeof r)try{r.call.apply(r,an([n,o],s,[e]))}catch(e){console.error("block hooks error module name "+(t[0]||t).name+", hook name "+i),console.log("block hooks call error: ",e.stack),xr("block hooks call error: "+e.message)}}else console.warn("block module "+(t[0]||t).name+" unregistered!")})),"function"==typeof this.core[i]&&(e=this.core)[i].apply(e,an([o],s)))},da);function da(e){this.core=e,this.modules=e.modules,this.blockManager=e.blockManager,this.builtInModules=e.builtInModules}var fa=(ha.prototype.getBuiltInModules=function(){return this.filterBuiltInModules([Ko])},ha.prototype.filterBuiltInModules=function(e){var n=this;return e.filter(function(e){var t=Object(a.a)(e)?e[0]:e;return!1!==n.defaultSupportModules.get(t)})},ha.prototype.getEditor=function(){return this.editor},ha.prototype.destory=function(e){var t=this;this.blockInfos.forEach(function(e){t.unmountDom(e.instance,!1)}),Object.values(this.modules).forEach(function(e){e&&e.unmount&&e.unmount()}),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),this.scheduler.reset(),this.blockInfos.clear(),this.event.removeEvent(),this.modules={}},ha.prototype.updateCopyData=function(e){var a=this;if("string"!=typeof e&&e.querySelector&&!e.querySelector("."+K))return{};var t=L()("<div></div>"),n=e instanceof HTMLElement?e.outerHTML:e,n=B.a.sanitize(n);t.html(n);var r=t.find("."+K);if(0===r.length)return{};var s={};r.each(function(e,t){var n,r,i,o=qn(t);o?(L()(t).removeAttr(te),console.log("[BLOCK]: copy has dataset"),r=!1,(n=a.getBlockInfo(o.blockId))?!n.instance||n.instance.isLoading()&&!n.instance.isReadyForCopy()||(console.log("[BLOCK]: blockInfo.instance.onCopy"),((i=n.instance.onCopy(o)).shouldReplaceWholeBlock?L()(t).parent():L()(t).find("."+Z)).replaceWith(i.html),r=!0,i.data&&(s[o.blockId]=i.data)):xr("[BLOCK_ERROR]: Copy a non-existent block: "+JSON.stringify(o)),r||(L()(t).replaceWith('<span class="'+Wt+'" '+Kt+'="'+(null===n||void 0===n?void 0:n.instance.blockType)+'">'+Gr("block.failed_to_copy_loading_block")+"</span>"),a.event.emit(Wt,[{blockType:null===n||void 0===n?void 0:n.instance.blockType}]))):xr("[BLOCK_ERROR]: Dataset should not be empty: "+(t?JSON.stringify(L()(t).attr(te)):null))});var i=qr(this.blockManager,t.html());return Or(i)||(window.blockCopiedHTMLForDebug=i,i="<span>"+Gr("block.failed_to_copy_block")+"</span>"),{html:i,data:s}},ha.prototype.updatePasteData=function(e,t,n){void 0===n&&(n=!0);var r=Qt({},e);n&&this.cleanHtml(r.pasteDataWrapper);var i=t&&t.event&&t.event.originalEvent?this.getCustomData(t.event.originalEvent.clipboardData):{};return this.blockManager.iterateCreator(function(e){e.onPaste&&(r=e.onPaste(r,Qt(Qt({},t),{customData:i})))}),Jr(this.blockManager,r.pasteDataWrapper,"paste",!0),{pasteDataWrapper:r.pasteDataWrapper,text:r.text}},ha.prototype.initBlocksOnly=function(e){var t,n;try{for(var r=rn(e),i=r.next();!i.done;i=r.next()){var o=i.value;this.initAndSaveBlock(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},ha.prototype.initAndSaveBlock=function(e){var t=this.initBlock({blockDataSet:e}),n=t.blockToken,r=t.blockId;return n&&this.tokenIndexes.set(n,r),this.setBlockInfo(t.blockId,{instance:t}),this.setBlockAttribute(r,JSON.stringify(e)),t},ha.prototype.getBlockByDataSet=function(e){var t=this.getBlockById(e.blockId);return t=t||this.initAndSaveBlock(e)},ha.prototype.initBlockPost=function(e,t){var n=lr(t,e.blockType);e.setAttributes({order:n})},ha.prototype.initBlock=function(e){var t=e.blockDataSet,n=e.isMounting,r=e.isRemote,i=t.blockType,o=t.token,a=t.blockId,s=this.generateMountPoint(),l=this.blockManager.getBlockCreator(i),c={blockType:i,blockId:a,blockToken:o};this.event.trigger(Ze.BEFORE_CREATE_BLOCK,[c]);var u=l.create(s,t,this.editor,r,n);u._setParams({scheduler:this.scheduler,hooks:this.hooks,event:this.event,plugin:this});var d={isTemplate:this.isTemplate,event:this.event};return u.setContext(Qt(Qt(Qt({},this.getBlockModuleInjectContext(u)),d),this.generateBlockContext(u))),u},ha.prototype.renderBlock=function(e){var t=this,n=e.blockDataSet,r=e.node,i=e.span,o=e.isMounting,a=void 0!==o&&o,s=e.isRemote,l=e.priority,c=e.from,u=n.blockId,d=n.blockType,f=this.blockManager.getBlockCreator(d),h=this.blockManager.getPrerenderPlaceholderConfig(d);if(f){var p=i||this.getEnsureRegionSpan(r,n),g=fr(n);(g||f.cursorCoherence)&&(p.attr("data-faketext"," "),p.attr("data-ignore-mutation","true"));var v=this.getBlockInfo(u);if(null!==v&&void 0!==v&&v.instance.isRendered&&v.span!==p[0]&&p.html(""),null!==v&&void 0!==v&&v.span)return this.reRenderBlock(v,n,p[0],r,c);var m=v?v.instance:this.initBlock({blockDataSet:n,isMounting:a,isRemote:s});this.initBlockPost(m,r),m.mountPoint.style.display="none",p.append(m.mountPoint),hn&&hn.isFF&&p.append(mr()),this.registerExternalNodeWrapper(n,p),n&&n.token&&this.tokenIndexes.set(n.token,m.blockId),this.setBlockInfo(m.blockId,{instance:m,span:p[0]}),this.hooks.callAll("blockDidInit",m,{node:r,from:c,isRemote:s});var y=void 0;return(y=h&&!g?Promise.resolve():this.isSyncRender(n)?this.renderBlockSync(m):this.renderBlockAsync(m,n,l).then(function(){t.renderBlockAsyncSuc&&t.renderBlockAsyncSuc(n,m)})).then(function(){t.doInsertExternalNode(n)}),y}},ha.prototype.renderBlockSync=function(e){return this.scheduler.add({block:e,stage:ze.initial,sync:!0})},ha.prototype.renderBlockAsync=function(e,t,n){return e.nextRender({stage:ze.initial,token:t.token,engineType:t.engineType,source:Ue.doc,priority:n})},ha.prototype.reRenderBlock=function(e,t,n,r,i){var o,a,s=e.instance,l=s.getToken()||t.token;l&&this.tokenIndexes.set(l,t.blockId);var c=e.span;if(e.span=n,s.updateDataSet(t),n!==c)if(c&&0<c.children.length)try{for(var u=rn(Array.from(c.children)),d=u.next();!d.done;d=u.next()){var f=d.value;n.contains(f)||n.appendChild(f)}}catch(e){o={error:e}}finally{try{d&&!d.done&&(a=u.return)&&a.call(u)}finally{if(o)throw o.error}}else n.appendChild(e.instance.mountPoint);return this.event.emit("reRenderBlock",{block:s,node:r,from:i}),s.nextRender({stage:ze.update,source:Ue.doc,updatedData:{type:We.dataset,data:t}})},ha.prototype.innerUpdateBlock=function(e){var t=this.blockInfos.get(e.blockId);if(t){null===e.props&&xr("[BLOCK_ERROR]: dataset.props is null"),e.initData&&xr("[BLOCK_ERROR]: dataset received has initData");var n=t.instance.getToken(),r=n||e.token;r&&(this.tokenIndexes.set(r,e.blockId),t.instance.updateDataSet(Qt(Qt({},e),{token:r}))),Object(C.a)(t.instance.props,e.props);var i=this.isSyncRender(e);return t.instance.nextRender({stage:i||n?ze.update:ze.initial,token:e.token,engineType:e.engineType,source:n?Ue.doc:Ue.create,updatedData:{type:We.dataset,data:e}})}},ha.prototype.createBlockPlaceholder=function(e){var t=e.options,n=void 0===t?{}:t,r=e.blockDataSet;if(!r.blockType||!this.blockTypeRegistered(r.blockType))throw new Error("can not insert without blockDataSet.blockType!");var i=this.initBlockDataSet(r),o=this.getBlockHtml(i);return n.renderDirectly&&this.replacePlaceHolder(o),o},ha.prototype.replacePlaceHolder=function(e){var n=this;[].slice.call(e.children).forEach(function(e){var t=qn(e);t&&n.renderBlock({blockDataSet:t,node:e,from:"replacePlaceHolder"})})},ha.prototype.updateBlock=function(r){return tn(this,void 0,void 0,function(){var t,n;return nn(this,function(e){switch(e.label){case 0:return t=r.blockId,(n=this.getBlockById(t))?[4,this.innerUpdateBlock(Qt({token:"fake-token"},r))]:[2];case 1:return e.sent(),n.updateDataSet(r),[2]}})})},ha.prototype.deleteBlock=function(e){var t="string"!=typeof e?(e||{}).blockId:e,n=this.getBlockInfo(t);n&&n.instance&&(this.scheduler.clear(n.instance),this.unmountDom(n.instance,!0),this.clearBlockData(n))},ha.prototype.clearBlockData=function(e){var t,n;e&&e.instance&&(n=(t=e.instance).getToken(),this.blockInfos.delete(t.blockId),this.blockFromRemote.delete(t.blockId),this.deleteBlockAttribute(t.blockId),n&&this.tokenIndexes.delete(n))},ha.prototype.initBlockDataSet=function(e){if(!e.blockType)return e;if(Rr(e))return e;var t=e.blockType,n=e.props;return or({blockType:t,props:n})},ha.prototype.getBlockInfos=function(){return this.blockInfos},ha.prototype.getBlockInfo=function(e){return this.blockInfos.get(e)},ha.prototype.setBlockInfo=function(e,t){var n=this.getBlockInfo(e),r=n&&n.options;!t.options&&r&&(t.options=r);var i=!!this.blockFromRemote.get(e);t.options=Object.assign({},t.options,{isRemote:i}),this.blockInfos.set(e,t)},ha.prototype.getBlockById=function(e){var t=this.blockInfos.get(e);if(t)return t.instance},ha.prototype.getBlockByToken=function(e){var t=this.tokenIndexes.get(e);if(t)return this.getBlockById(t)},ha.prototype.getBlockAttribute=function(e){return this.blockAttributes.get(e)},ha.prototype.setBlockAttribute=function(e,t){this.blockAttributes.set(e,t)},ha.prototype.deleteBlockAttribute=function(e){return this.blockAttributes.delete(e)},ha.prototype.getCopyBlocKResult=function(e,t){var n;void 0===t&&(t="copy");var r=e.block,i=e.pasteData,o=r.mountPoint,a=qn(o),s=L()(o).closest("."+V)[0];if(o&&s&&a){var l=i||r.onCopy(a),c=l.html,u=l.text,d=l.data,f=l.shouldReplaceWholeBlock?c:this.wrapHtmlWithLineInfo(o,c);return Or(f),{pasteData:{html:f,text:u,customCopyDatas:d?[{key:Dt,data:JSON.stringify(((n={})[a.blockId]=d,n))}]:void 0},type:t}}return null},ha.prototype.getScouredDataSet=function(e){var t=qn(L()(e).closest("."+K)[0]);return t?this.scourDataset(t)||t:null},ha.prototype.processMountPoint=function(e){e.setAttribute("tabindex","-1"),e.setAttribute("contenteditable","false")},ha.prototype.updateBlockSelected=function(e){var t,n,r=An(e);try{for(var i=rn(this.blockInfos.entries()),o=i.next();!o.done;o=i.next()){var a=on(o.value,2),s=a[0],l=a[1].instance;r.has(s)?l.getAttributes().selectState!==Xe.COVER_ON_BLOCK&&l.setAttributes({selected:!0,selectState:Xe.FOCUS_ON_BLOCK}):l.setAttributes({selected:!1,selectState:Xe.NONE})}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},ha.prototype.isEventOnBlock=function(e){var t=e.target,n=qn(t);if(!n)return!1;var r=n.blockType,i=this.blockManager.getBlockCreator(r);return!!i&&(!i.cursorCoherence&&!fr(n))},ha.prototype.isSyncRender=function(e){var t=fr(e),n=this.blockManager.getSyncRenderConfig(e.blockType,t);return this.useSyncRender||n},ha.prototype.initModules=function(e){var t,n,r=an(this.builtInModules,e);try{for(var i=rn(r),o=i.next();!o.done;o=i.next()){var a=o.value,s=Array.isArray(a)?new a[0](this,a[1]):new a(this),l=s.className||(a[0]||a).name;this.modules[l]=s}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},ha.prototype.getBlockModuleInjectClasses=function(e){return this.blockManager.getBlockEnableModules(e).map(function(e){return Array.isArray(e)?e[0]:e}).map(function(e){return e.injectClasses||[]}).reduce(function(e,t){return an(e,t)},[])},ha.prototype.getBlockModuleInjectContext=function(t){var n=this;return an(this.builtInModules,this.blockManager.getBlockEnableModules(t.blockType)).map(function(e){return n.getModuleInstance(Array.isArray(e)?e[0]:e)}).filter(function(e){return e&&e.generateBlockContext}).map(function(e){return e.generateBlockContext(t)}).reduce(function(e,t){return Object.assign(e,t)},{})},ha.prototype.getModuleInstance=function(t){return Object.values(this.modules).find(function(e){return e instanceof t})},ha.prototype.getCustomData=function(e){if(!e)return null;var t=e.getData(Dt);return t?Bn(t)||{}:null},ha.prototype.unmountDom=function(e,t){void 0===t&&(t=!1),e.isRendered&&this.hooks.callAll("blockWillUnmount",e,t),e.unmount(t),this.editor.version.includes(W.y)||t&&L()(e.mountPoint).closest("."+V).remove(),e.isRendered&&this.hooks.callAll("blockDidUnmount",e,t),e.destroyed=!0},ha.prototype.blockTypeRegistered=function(e){return!!this.blockManager.isBlockCreatorRegistered(e)},ha.prototype.createRegionTag=function(){return me+ye},ha.prototype.createPlaceholderTag=function(e){var t=this.dataset2Classes(e),n=this.getBlockAttribute(e.blockId),r=document.createElement("span");return r.setAttribute("class",t.join(" ")),r.setAttribute(te,n),r.innerHTML=this.createRegionTag(),r.outerHTML},ha.prototype.createInlineBlockDom=function(e){var t=V+" "+St,n=this.createPlaceholderTag(e);return[le,'<span class="'+t+'">'+n+"</span>",ce].join("")},ha.prototype.createBlockDom=function(e,t){var n=V+" "+Lt;return t.cursorCoherence||(n+=" single-line"),'<div\n      class="'+n+'"\n      dir="auto"\n      contenteditable="false">'+this.createPlaceholderTag(e)+"</div>"},ha.prototype.getBlockHtml=function(e){var t=this.blockManager.getBlockCreator(e.blockType),n=(e.props&&e.props.displayMode)===Be.INLINE?this.createInlineBlockDom(e):this.createBlockDom(e,t),r=document.createElement("div");return r.innerHTML=n,r},ha.prototype.findRegionElement=function(e){return L()(e).find("."+Z)},ha.prototype.getEnsureRegionSpan=function(e,t){return 0===this.findRegionElement(e).length&&(e.innerHTML=this.generateBlockContainer(t)),this.findRegionElement(e)},ha.prototype.scourDataset=function(e){if(e&&e.blockType===Le.IFRAME_BLOCK){var t=Qt({},e.props),n=t.data;if(n||(t={data:Qt({},t)}),""===e.token)return Qt(Qt({},e),{props:t,token:Te,engineType:"none"});if(!n)return Qt(Qt({},e),{props:t})}return null},ha.prototype.wrapHtmlWithLineInfo=function(e,t){var n=L()(e).closest("."+V)[0];if(!n)return t;var r=L()(n.outerHTML);return r.find("."+K).removeAttr(te),r.find("."+Z).replaceWith(t),qr(this.blockManager,r[0].outerHTML)},ha.prototype.registerExternalNodeWrapper=function(e,t){var n=this.blockManager.getBlockCreator(e.blockType);n&&n.getExternalNode&&L()(t).append('<div class="'+ne+'"></div>')},ha.prototype.doInsertExternalNode=function(o){return tn(this,void 0,void 0,function(){var t,n,r,i;return nn(this,function(e){switch(e.label){case 0:return(t=this.blockManager.getBlockCreator(o.blockType))&&t.getExternalNode?[4,t.getExternalNode(o)]:[2];case 1:return n=e.sent(),r=this.getBlockById(o.blockId),(i=r.mountPoint.nextElementSibling)&&i.append(n),[2]}})})},ha.prototype.generateMountPoint=function(){var e=document.createDocumentFragment(),t=document.createElement("div");return t.className=Y,e.appendChild(t),t},ha.prototype.generateBlockContainer=function(e){var t=e.blockId,n=e.blockType,r=this.getBlockModuleInjectClasses(n);return['<div class="'+V+'" contenteditable="false" dir="auto">','<span\n    class="'+an([K,"block-id-"+t,"block-type-"+n],r).join(" ")+'"\n    '+te+"='"+JSON.stringify(e)+"'><span\n    class=\""+Z+'"></span></span>',"</div>"].join("")},ha);function ha(e){var i=this;this.className="BlockCore",this.blockInfos=new Map,this.tokenIndexes=new Map,this.blockAttributes=new Map,this.blockFromRemote=new Map,this.modules={},this.builtInModules=[],this.isOnline=!0,this.event=new w.a,this.appConfig={},this.defaultSupportModules=new Map,this.useSyncRender=!1,this.handleOnline=function(){i.isOnline=!0,i.event.trigger("online")},this.handleOffline=function(){i.isOnline=!1,i.event.trigger("offline")},this.cleanHtml=function(e){L()(e).find("*").each(function(e,t){var n=t.getAttribute("data-meta-block-props"),r=t.classList;n&&t.setAttribute("data-meta-block-props",n.replace(On,function(e,t){return""+t+ln()})),Array.prototype.includes.call(r,J)&&(t.style.display="none",t.innerText=" ")})},this.updateBlockContext=function(t,n){void 0===n&&(n=!1),i.blockInfos.forEach(function(e){e&&e.instance&&e.instance.setContext(t,n)})},this.delegateBlockEvent=function(n,r){i.blockInfos.forEach(function(e){var t;e&&e.instance&&("function"==typeof(t=e.instance)[n]&&t[n](r))})},this.dataset2Classes=function(e){if(!i.blockManager.getBlockCreator(e.blockType))return[];var t=e.blockId,n=i.getBlockModuleInjectClasses(e.blockType);i.setBlockAttribute(t,JSON.stringify(e));var r=an([K,"block-id-"+t,"block-type-"+e.blockType],n);return fr(e)&&r.push(q),e.blockType===Le.SHEET_BLOCK&&r.push("sheet"),e.props&&e.props.viewType&&r.push("block-viewtype-"+e.props.viewType),r};var t=e.blockManager,n=e.isTemplate,r=e.modules,o=void 0===r?[]:r,a=e.editor,s=e.appConfig,l=e.defaultSupportModules,c=void 0===l?new Map:l;this.editor=a,this.blockManager=t,this.isTemplate=Boolean(n),this.appConfig=s||{},this.defaultSupportModules=c,this.useSyncRender=e.useSyncRender,this.builtInModules=this.getBuiltInModules(),this.initModules(o),this.hooks=new ua(this),this.scheduler=new la({hooks:this.hooks,appConfig:this.appConfig}),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)}var pa=String.fromCharCode(8203),ga=function(e,t){var n=t||e,r=n.selStart,i=n.selEnd,o=e.lines.atIndex(e.selEnd[0]);if(!o)return" ";var a=o.text,s=o.lineMarker,l=(a||"").length,c=e.lines.length(),u=i[1]<l,d=" ";if(!r||!i)return"\n \n";0===r[0]&&(d="\n"+d);var f=a===pa;r[1]>s&&!f&&(d="\n "),!u&&i[0]+1!==c||(d+="\n");var h=o.lineNode;return h&&-1<(h.className||"").indexOf("tp-sub")&&(d="\n \n"),d};function va(e){var t=[],n="";return e.split("").forEach(function(e){"\n"===e?(n&&(t.push(n),n=""),t.push(e)):n+=e}),n&&t.push(n),t}function ma(e){if(!e)return null;var t=("string"==typeof e?L()("<div>").html(e):L()(e)).find(">:not(meta):not(style)");return 1!==t.length?null:t}var ya,ba=20,Ea=40,ka=30,Ca=["author","lmkr","lineguid","insertorder"],Ia=(Yt(Sa,ya=fa),Sa.prototype.getBuiltInModules=function(){return an(ya.prototype.getBuiltInModules.call(this),this.filterBuiltInModules([Ho,Vo]))},Object.defineProperty(Sa.prototype,"pure",{get:function(){return this.editor.pure},enumerable:!0,configurable:!0}),Object.defineProperty(Sa.prototype,"undoDispatcher",{get:function(){return this.editor.undoModule&&this.editor.undoModule.undoDispatcher},enumerable:!0,configurable:!0}),Sa.prototype.destory=function(e){var t;ya.prototype.destory.call(this,e),this.entryMap=new Map,this.attachedBlocks=new Set,this.fiberIdMap=new Map,this.unRenderedZones={},this.editor.off("tableDidRender",this.handleZoneDidRender),this.editor.off("newZoneDidRender",this.handleZoneDidRender),this.event.off("blockInstanceWillUpdate",this.onBlockInstanceWillUpdate),this.event.off("blockInstanceDidUpdate",this.onBlockInstanceDidUpdate),this.event.off(Wt,this.logCopyLoadingBlock),this.isPure||((t=L()(this.editor.getDocBody())).undelegate("."+K,"focus",this.handleFocusOnBlock),t.undelegate("."+K,"blur",this.handleBlurOnBlock),t.undelegate('div[id^="magicdomid"]',"mousedown",this.handleMouseDownOnMagicDom),document.removeEventListener("keyup",this.handleKeyup),this.editor.off(W.k.DID_PASTE,this.handleDidPaste),this.editor.off(W.k.WILL_DELETE_FROM_CUT,this.handleDeleteFromCut),this.editor.off(W.k.CONTENT_CHANGE,this.handleContentChange),this.notifyLineContentChange.cancel(),hn.isMobile||(document.removeEventListener("selectionchange",this.handleSelectionChange),L()(window).off("click",this.handleOutsideClick),t.undelegate("."+K+":not(."+q+") ."+Z+":not(.block-hoverable)","click",this.handleBlockClick),t.undelegate(".block-hoverable","mouseenter",this.handleBlockMouseEnter),t.undelegate(".block-hoverable","mouseleave",this.handleBlockMouseLeave)))},Sa.prototype.blockDidMount=function(e){delete e.shouldRender,this.onBlockMounted(e)},Sa.prototype.blockFailMount=function(e){delete e.shouldRender,this.onBlockMounted(e)},Sa.prototype.onBlockMounted=function(e){var t,n;this.initialBlockList.set(e.blockId,!0);try{for(var r=rn(this.initialBlockList.values()),i=r.next();!i.done;i=r.next())if(!1===i.value)return}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}this.notifyBlockMounted(Array.from(this.initialBlockList.keys()))},Sa.prototype.isBlockMounted=function(e){var t=this.getBlockInfo(e);if(!t||!t.span||!t.instance.isRendered)return!1;var n=t.span.closest(".ace-line");if(!n)return!1;var r=this.editor.dom.rootNodeOfZoneContaining(n);if(!r)return!1;var i=this.editor.dom.zoneOfRootNode(r);if(!i)return!1;var o=this.editor.getRep(i).lines.atKey(n.id);return!!o&&o.isActive},Sa.prototype.isBlockVisible=function(e){return this.isBlockMounted(e)},Sa.prototype.generateBlockContext=function(e){var l=this,t=this.getInitialBlockTokens(e.blockType);return{initialCount:t&&t.length||0,initialTokens:t,updateBlockProps:this.updateBlockProps,setSelectionToLastLineEnd:this.setSelectionToLastLineEnd,triggerDelete:function(){l.deleteBlock({block:e})},triggerCopy:function(e,t){void 0===t&&(t="copy"),l.copyBlock(e,t)},triggerComment:function(e){var t=e.block.mountPoint,n=l.editor.domToRep(t.parentElement),r=n.selStart,i=n.selEnd,o=r[2],a=[r[0],r[1]],s=[i[0],i[1]];l.commentBlock({},{selStart:a,selEnd:s,selZone:o})},undoDispatcher:this.undoDispatcher}},Sa.prototype.getBlockRep=function(n){var e,t,r,i,o,a,s=null;return this.editor.version.includes(W.y)?(e=function(e,t){return t.includes(n.blockId)},(t=this.editor.getEntities(e))[0]&&(i=(r=t[0]).start,o=r.end,s={selStart:[i.line,i.offset,i.zoneId],selEnd:[o.line,o.offset,o.zoneId]})):(a=L()(n.mountPoint).closest("."+V)[0],s=this.editor.domToRep(a)),s||xr("[BLOCK_ERROR] block domToRep failed, lineNode in document, "+n.blockId+", "+n.blockType),s},Sa.prototype.traceBlockErrorWithLineInfo=function(e,t){var n,r=this.getBlockRep(e),i="",o=this.editor.getDocBody();r&&(n=this.editor.getAllAttributesOnLine(r.selStart[2],r.selStart[0]).filter(function(e){var t=on(e,2),n=t[0];t[1];return!jn(n)}),i=JSON.stringify(n));var a={id:e.blockId,type:e.blockType,lineAttributeString:i,docBody:o.className};xr(t+", params: "+JSON.stringify(a))},Sa.prototype.handleSelectionChange=function(){var e,t,n,r,i,o,a,s,l,c=this.editor;!c||(e=window.getSelection())&&(t="",Ur(e)&&!rr(this.editor.getRep())?t=c.getSelectedHTML():(n=Lr(e.anchorNode))&&(t=n.outerHTML),this.updateBlockSelected(t),r=c.getRep(),ir(r)||rr(r)||!e.rangeCount||(i=e.getRangeAt(0),o=L()(i.commonAncestorContainer).closest("."+K)[0],!(a=qn(o))||(s=this.blockManager.getBlockCreator(a.blockType))&&s.cursorCoherence&&(l=c.domToRep(o),c.selection.setWithSelection(r.zoneId,l.selEnd,l.selEnd))))},Sa.prototype.callAyncNodeShowLoadingEvent=function(e,t){var n,r=this.entryMap.get(t.blockId);r&&r.lineNode&&(n={zoneId:r.zone,lineEntry:r,loadingDom:t.mountPoint.querySelector("."+ae),type:"block",options:{block:t}},this.editor.call(e,n))},Sa.prototype.setInitialBlockTokens=function(e,t){this.initialBlockTokens.set(e,t)},Sa.prototype.getInitialBlockTokens=function(e){return this.initialBlockTokens.get(e)},Sa.prototype._resizeBlock=function(e,t){var n,r;e.isLoading()||(!hn.isMobile||hn.isIPad||e.mobileSizeMode===xe.NORMAL_SIZE?e.resize(t):(n=(document.body.offsetWidth-t)/2,e.mountPoint.style.maxWidth="none",r=t,e.mobileSizeMode===xe.OVER_SIZE?(r=document.body.offsetWidth-2*Se,e.mountPoint.style.marginLeft=-(n-Se)+"px"):e.mobileSizeMode===xe.OVER_SIZE_RIGHT?r=document.body.offsetWidth-n-Se:e.mobileSizeMode===xe.OVER_SIZE_LEFT&&(r=document.body.offsetWidth-n-Se,e.mountPoint.style.marginLeft=-(n-Se)+"px"),e.mountPoint.style.width=r+"px",e.resize(r)))},Sa.prototype.resizeBlock=function(e,t){var n=this.getBlockInfo(e);n&&this._resizeBlock(n.instance,t)},Sa.prototype.resizeBlocks=function(t){var n=this;t&&this.getBlockInfos().forEach(function(e){t?n._resizeBlock(e.instance,parseInt(t,10)):Tr("editorSizeChange",t,e.instance.blockType)})},Sa.prototype.preprocessBlockInfo=function(){for(var e=this.editor.getClientVars().apool.numToAttrib||{},t=Object.keys(e).length,n=0;n<t;n+=1){var r=on(e[n],2),i=r[0],o=r[1];if(jn(i)||"sheet-id"===i){var a,s,l,c,u,d=!0;try{"sheet-id"===i&&(Br.LogService&&Br.LogService.collectSuiteEvent("block_turn_old_sheet",{sheet_id:o}),(a=this.editor.getDocBody())&&a.querySelector(".sheet-id-"+o))}catch(e){d=!1}d&&(s=xn(o),l=Nn(o),c=_n(o),"sheet-id"===i&&(s=Le.SHEET_BLOCK,l=o),u=this.getInitialBlockTokens(s),Object(v.a)(u)&&(u=[]),this.initialBlockList.set(c,!1),u.push(l),this.setInitialBlockTokens(s,u))}}},Sa.prototype.processEntry=function(e,a){var s=this;void 0===a&&(a={from:"processEntry"});var t,n,r,i,l=[],o=(Array.isArray(e)?e:[e]).filter(function(e){return e.lineNode&&!L()(e.lineNode).find(".ace-table").length}),c=on(o.reduce(function(e,t){return(Mr(t)?e[1]:e[0]).push(t),e},[[],[]]),2),u=c[0],d=c[1],f=u.map(function(e){return{entry:e,spans:vr(e.lineNode)}}).filter(function(e){return e.spans.length});return 0<f.length&&(t=this.editor.preRenderer.getTopmostElementIndexInViewport(),n=f.map(function(e){return e.entry.zone===F.DEFAULT_REP_ZONE?e.entry:s.editor.managers.zoneToLineEntry[e.entry.zone]}),r=this.isPure||n.every(function(e){return s.editor.getRep(F.DEFAULT_REP_ZONE).lines.indexOfEntry(e)>=t}),i=function(){var t,e;try{for(var n=rn(f),r=n.next();!r.done;r=n.next()){var i=r.value,o=s.processPlaceholder(i.spans,i.entry,a);o&&l.push.apply(l,an(o))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},r?i():requestAnimationFrame(function(){return s.editor.preRenderer.ensureScreenNoScroll(o,i)})),d.forEach(function(e){var t=vr(e.lineNode),n=s.processPlaceholder(t,e,a);n&&l.push.apply(l,an(n))}),l},Sa.prototype.processPlaceholder=function(e,t,n){var r,i;void 0===n&&(n={from:"processPlaceholder"}),e=Array.isArray(e)?e:[e];var o=[];try{for(var a=rn(e),s=a.next();!s.done;s=a.next()){var l=s.value,c=this.getScouredDataSet(l);if(!c||!t.lineNode)return void xr("[Block Error] processPlaceholder with invalid blockDataSet");this.getBlockInfo(c.blockId);n.inTable&&this.event.emit("renderInTable",this.getBlockById(c.blockId)),o.push(this.renderBlock({blockDataSet:c,node:t.lineNode,span:L()(l),isRemote:n.isRemote,priority:n.priority,from:(null===n||void 0===n?void 0:n.from)||"unknown"})),this.event.trigger("processPlaceholder",[{newSpan:l,entry:t,blockDataSet:c}])}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o},Sa.prototype.reuseDomForBlock=function(e,p){var g=this,v=[];return e.forEach(function(e,t){var n,r,i,o,a,s,l,c,u,d=p[t],f=e.lineNode,h=d.lineNode;f&&h&&h!==f&&(n=!L()(f).hasClass("j-block-container"),f.id=h.id,f.className=h.className,f.contentEditable=h.contentEditable,dr(h,f),-1<h.className.indexOf(V)?(r=void 0,n?(o=(i=on(Array.from(f.children),3))[0],a=i[1],s=i[2],o&&a&&s||xr("[Block Error] reuseDomForBlock normal line not block"),r=a,f.removeChild(o),f.removeChild(s)):r=f.children[0],l=h.firstElementChild,c=qn(h),r.className=l.className.replace(/block-viewtype-\S+/,"block-viewtype-"+(c.props||{}).viewType),dr(l,r),n&&r.firstElementChild&&f.firstElementChild&&(f.appendChild(r.firstElementChild),f.removeChild(f.firstElementChild),dr(l,f.firstElementChild),f.firstElementChild.className=l.className,v.push(e))):(L()(f).empty().html(),Array.from(L()(h).children()).forEach(function(e){L()(f).append(e)}),v.push(e)),g.editor.version.includes(W.y)?f.parentNode&&f.parentNode.removeChild(f):h.parentNode&&h.parentNode.removeChild(h),d.lineNode=f,d.domInfo.node=f,d.isFullWidth=e.isFullWidth,d.fullWidthNode=e.fullWidthNode,g.setEntryStatus(d,e),g.editor.dirtyChecker.markNodeClean(f),u=qn(d.lineNode),g.event.trigger("reuseDomForBlock",[{entry:d,blockDataSet:u}]))}),v},Sa.prototype.setEntryStatus=function(e,t){var n,r=t.isRendered,i=t.isActive,o=t.isRetained;e.isRendered=r,e.isActive=i,e.isRetained=o,e.mounted=i,this.editor.version.includes(W.y)||-1<(n=this.editor.getRep(e.zone).lines.indexOfKey(e.key))&&this.editor.blockRender.updateLinesStatus(e.zone,n,1,1,{isActive:i,isRendered:r,isRetained:o})},Sa.prototype.getDocBody=function(){return this.editor.getDocBody()},Sa.prototype.getLineNode=function(e,t){var n=this.editor.repManager.reps[t].lines.atIndex(e);return n&&n.lineNode},Sa.prototype.getLineAttribute=function(e,t){return this.editor.getAllAttributesOnLine(t,e)},Sa.prototype.isForMainEditor=function(){if(this.editor.dom){var e=this.editor.dom.getEditorEl();return e.className.includes("innerdocbody")&&"innerdocbody"===e.id}return!1},Sa.prototype.tryGetBlockIdForNode=function(e){var t=".block-placeholder",n=L()(e).find(t).addBack(t).data("metaBlockProps");return n?n.blockId:void 0},Sa.prototype.getBlocksDataForLine=function(i,e,t){var n=this.editor,r=n.getRep(t);return n.getAllAttributesOnLine(r.zoneId,e).filter(function(e){var t=on(e,2),n=t[0],r=t[1];return zn(n)&&r.includes(i)}).map(function(e){var t,n=on(e,2),r=n[0],i=n[1];return Hn(((t={})[r]=i,t))})},Sa.prototype.onMount=function(e){this.event.trigger("onMount"),this.preprocessBlockInfo()},Object.defineProperty(Sa.prototype,"lazyBlockEnable",{get:function(){return this.appConfig.lazyBlockRender},enumerable:!0,configurable:!0}),Object.defineProperty(Sa.prototype,"blockFiberEnable",{get:function(){return this.appConfig.blockFiberRender},enumerable:!0,configurable:!0}),Sa.prototype.addEntryByIncorp=function(e,t){var n=t.entry;this.processEntry(n,{from:"addEntryByIncorp"})},Sa.prototype.lineNodesRendered=function(e,t){this.lazyBlockEnable||this.processEntry(t.data.lineEntries,{from:"lineNodesRendered"})},Sa.prototype.lineDidUpdate=function(e,t){this.processEntry(t.data.lineEntry,{isUpdate:t.isUpdate,isRemote:t.isRemote,from:"lineDidUpdate"})},Sa.prototype.linesWillReplace=function(e,t){var n,r,i,o=this,a=t.oldLineEntries,s=t.newLineEntries,l=t.isRemote,c=br(a),u=yr(s),d=u.map(function(e){return e.blockId}),f=s,h=!1;if(!this.editor.version.includes(W.y)){var p=!1;if(c.length&&Object(E.default)(c,d)&&1===s.length&&a.length===s.length){for(var g=0;g<a.length;g++){var v=a[g].lineNode,m=s[g].lineNode,y=qn(v),b=qn(m);if(this.compareDataSet(b,y)){p=!0,h=!Object(E.default)(y,b);break}}p&&(f=this.reuseDomForBlock(a,s))}else this.isInsertBelowBlock(t)?f=this.handleInsertBelowBlock(t):this.isDeleteBelowBlock(t)&&(f=this.handleDeleteBelowBlock(t))}this.processEntry(f,{isRemote:l,from:"linesWillReplace"}),0===d.length||(n=t.newLineEntries[0])&&(r=this.editor.getRep(n.zone).lines.indexOfKey(t.newLineEntries[0].lineNode.id),i={zoneId:n.zone,lineNum:r,isRemote:l,isMounting:!1},this.notifyLineContentChange(i),h&&u.forEach(function(e){o.updateBlock(e)}))},Sa.prototype.compareDataSet=function(e,t){return e&&t&&Object(E.default)(Object(I.default)(t,"props"),Object(I.default)(e,"props"))},Sa.prototype.updateBlockAttributes=function(e,t){var n=this,r=this.getBlockInfo(t.blockId),i=t.blockType,o=t.token,a={blockType:i,blockId:t.blockId,blockToken:o};this.event.trigger(Ze.BEFORE_UPDATE_BLOCK_DATA,[a]);var s=this.updateBlock(t);s&&r&&(s.then(function(){var e;t.token&&((e=n.editor.getDocBody().dataset.lastWidth)?n._resizeBlock(r.instance,parseInt(e,10)):Tr("updateBlockAttributes",e,r.instance.blockType)),n.updateLinePopover()}),this.editor.getObserver().withoutRecordingMutations(function(){r.span&&L()(r.span).closest("."+K).attr(te,JSON.stringify(t))}))},Sa.prototype.match=function(e){return e===Q||e===X},Sa.prototype.renderLine=function(e){var t=e.lineState.getEntities([[Q,void 0],[X,void 0]]);if(!t.length)return null;for(var n=null,r=0;r<t.length;r++){var i=t[r].attributes,o=i[Q]?Q:X;if(i[o])try{n=JSON.parse(i[o]);break}catch(e){return null}}return n&&!fr(n)&&(e.editable=hn.isAndroid),null},Sa.prototype.render=function(t){var e,n,r,i=t.attributes,o=t.children,a=t.index,s=t.zoneId;if(i[Q]||i[X]){var l=i[Q]?Q:X,c=i[l],u=((e={})[kr(l)]=c,e),d=void 0;try{d=JSON.parse(c)}catch(e){return t.class+=" "+K,o}var f=d.blockId,h=d.blockType;if(!f||!h)return o;var p=this.blockManager.getBlockCreator(d.blockType);if(!p)return o;t.key=f;var g=this.dataset2Classes(d),v=this.getBlockInfo(d.blockId);void 0!==(null===(n=null===v||void 0===v?void 0:v.options)||void 0===n?void 0:n.zoneId)&&(null===(r=null===v||void 0===v?void 0:v.options)||void 0===r?void 0:r.zoneId)!==t.zoneId&&this.handleBlockDelete([d.blockId]);var m,y=null,b=this.getBlockByDataSet(d),E=this.editor.getRep(s).lines.atIndex(a);return E&&this.registerInstanceToEntry(E,b),this.scheduler.isBlockScheduled(b)||(m=b.placeholderJsx(),y=U.a.createElement("div",{className:ae},m)),fr(d)?(t.class+=" "+St+" "+Zt,U.a.createElement(W.l,null,U.a.createElement("span",{className:V,"data-faketext":" ",contentEditable:"false",suppressContentEditableWarning:!0},U.a.createElement("span",Qt({className:g.join(" ")},u),U.a.createElement("span",{className:Z+" dom-pass-empty-check ignore-collect",tabIndex:-1,contentEditable:"false","data-faketext":" ",suppressContentEditableWarning:!0},y))))):(t.lineClass+=" "+V+" "+Lt,p.cursorCoherence||(t.lineClass+=" single-line"),hn.mobile?U.a.createElement(W.l,null,U.a.createElement("span",Qt({className:g.join(" ")},u),U.a.createElement("span",{className:"block-faketext dom-pass-empty-check ignore-collect","data-faketext":" "},"\ufeff"),U.a.createElement("span",{className:Z+" dom-pass-empty-check ignore-collect",tabIndex:-1,contentEditable:"false",suppressContentEditableWarning:!0},y),U.a.createElement("span",{className:"block-faketext dom-pass-empty-check ignore-collect","data-faketext":" "},"\ufeff"))):U.a.createElement(W.l,null,U.a.createElement("span",Qt({className:g.join(" ")},u),U.a.createElement("span",{className:Z+" dom-pass-empty-check ignore-collect",tabIndex:-1,contentEditable:"false",suppressContentEditableWarning:!0},y))))}return o},Sa.prototype.aceCreateDomLine=function(e,t){var n,r,i,o=t.attrObj,a={};for(r in o)o.hasOwnProperty(r)&&(-1===r.indexOf("dataMeta")||(i=kr(r))&&(a[i]=""+o[r]));t.attributes=Qt(Qt({},t.attributes),a);var s,l,c,u,d,f,h,p,g=Fn(o);g&&(l=(s=JSON.parse(g)).blockId,c=s.blockType,l&&c&&((u=this.blockManager.getBlockCreator(s.blockType))&&(h="",d=this.getBlockByDataSet(s),this.scheduler.isBlockScheduled(d)||(f=B.a.sanitize(d.placeholderHtml()),h='<div class="'+ae+'">'+f+"</div>"),fr(s)?(t.spanClass+=" "+St,this.editor.version.includes(W.y)?(t.rawHtml=""+t.extraOpenTags+be+h+ye+W.B+t.extraCloseTags,t.extraOpenHtml=ue,t.extraCloseHtml=de):(t.rawHtml=""+t.extraOpenTags+be+h+ye+t.extraCloseTags,t.extraOpenHtml=pe,t.extraCloseHtml=ge),t.editable=!0):(hn.mobile?t.rawHtml=ve+me+h+ye+ve:t.rawHtml=me+h+ye+W.B,t.lineClass+=" "+V+" "+Lt,u.cursorCoherence||(t.lineClass+=" single-line"),t.editable=hn.isAndroid),Object.assign(t.attributes,((n={})[W.m]=" ",n.contenteditable=!1,n.suppressContentEditableWarning=!0,n)),Object(v.a)(t.zoneId)||Object(v.a)(t.index)||(p=this.editor.getRep(t.zoneId).lines.atIndex(t.index))&&this.registerInstanceToEntry(p,d))))},Sa.prototype.registerInstanceToEntry=function(e,t){var n;t&&(n=t.props&&t.props.displayMode===Be.INLINE?F.DisplayType.Inline:F.DisplayType.Block,e.registerInstance({displayType:n,instanceName:t.blockType,blockId:t.blockId,isAsyncNode:!0,shouldKeepActive:t.shouldKeepActive,shouldRetain:t.shouldRetain,leaveBuffer:t.leaveBuffer,enterBuffer:t.enterBuffer}),this.entryMap.set(t.blockId,e),this.setLineInfoToBlockInfo({zoneId:e.zone,key:e.key},t.blockId))},Sa.prototype.isBlockEditorPluginInstance=function(e){return"blockId"in e},Sa.prototype.setLineInfoToBlockInfo=function(e,t){var n=this.getBlockInfo(t);n&&(n.options=Object.assign({},n.options,e),this.setBlockInfo(t,n))},Sa.prototype.changesetApply=function(e,t){this.event.trigger("changesetApply",[t])},Sa.prototype.shouldDeletePrevSingleLine=function(e,t){var n,r,i,o,a,s,l,c,u=t.prevLineEntry.lineNode;return Ln(u)&&(r=(n=this.editor.getRep()).selStart,i=n.zoneId,o=r[0]-1,s=null!==(a=this.editor.getContentState().getZoneState(i).getLine(o))&&void 0!==a&&a.hasLineMarker()?1:0,this.editor.selection.setSelection({start:{line:o,offset:s,zoneId:i},end:{line:o,offset:s+1,zoneId:i}},!0),l=qn(u),(c=this.getBlockInfo(l.blockId))&&c.instance.setAttributes({selected:!0,selectState:Xe.FOCUS_ON_BLOCK})),!1},Sa.prototype.serialize=function(e){var t,n,r,i,o,a,s,l,c=e.type,u=e.op,d=e.node,f=null===(t=null===u||void 0===u?void 0:u.attributes)||void 0===t?void 0:t.dataMetaBlockProps;return c===W.u.LEAF&&f?(l=document.createElement("span"),n=Bn(f),a=$n(n),l.innerHTML=a,null!==(r=l.firstChild)&&void 0!==r&&r.classList.add("block-old-uuid-"+n.blockId),(i=null===r||void 0===r?void 0:r.firstChild.classList).add(K),i.add("block-id-"+n.blockId),i.add("block-type-"+n.blockType),e.node=r):c===W.u.ROOT&&(a=(o=this.updateCopyData(d)).html,s=o.data,a&&((l=document.createElement("div")).innerHTML=a,e.node=l),Object(h.default)(s)||(e.customCopyDatas=[{key:Dt,data:JSON.stringify(s)}])),e},Sa.prototype.logCopyLoadingBlock=function(e){Br.LogService&&Br.LogService.collectSuiteEvent("block_copy_loading_block",{block_type:e.blockType,action:"copy"})},Sa.prototype.logPasteLoadingBlock=function(e){e.querySelectorAll("."+Wt).forEach(function(e){var t=e.getAttribute(Kt);Br.LogService&&Br.LogService.collectSuiteEvent("block_copy_loading_block",{block_type:t,action:"paste"})})},Sa.prototype.UNSAFE_editorNormalizePasteNode=function(e){var t=e.data,n=t.text,r=t.UNSAFE_HTML,i=t.node,o=e.event,a=this.editor.clipboard.getPasteInfo(),s=a.pasteTimes,l="cut"===a.pasteFrom&&1===s;if(i.innerHTML||n){if(this.cleanHtml(i),"0"!==this.editor.getRep().zoneId){var c=ma(i),u=this.getTableInSheetBlock(c);if(u)return e.data.node.innerHTML="",void e.data.node.appendChild(u[0]);var d=L()(i).find("span.block-type-"+Le.BITABLE_BLOCK).closest(".ace-line");if(d.length)return void d.remove()}this.logPasteLoadingBlock(i);var f=this.updatePasteData({pasteDataWrapper:i,purifiedHtml:r,text:n},{firstPasteAfterCut:l,event:L.a.Event(o)},!1);e.data.text=f.text}},Sa.prototype.collectCommentTargetType=function(e,t){var n=t.node;if(n.className.includes(V)){var r=vr(n);if(r.length){var i=r[0],o=qn(i);if(o){var a=o.blockId,s=o.blockType;return this.getBlockInfos().has(a)&&s?s:"block"}}}},Sa.prototype.collectText=function(e,t){var n,r=t.node,i=t.attributes;if(r){if(!r.className.includes(V))return;var o=vr(r);if(!o.length)return;var a=o[0],s=qn(a)}else!i||(n=i.find(function(e){return jn(e[0])}))&&n[1]&&(s=JSON.parse(n[1]));if(s){var l=s.blockId,c=this.getBlockInfos();if(!c.has(l))return"[BLOCK]";var u=c.get(l);return u.instance.collectText?u.instance.collectText():"[BLOCK]"}},Sa.prototype.deserialize=function(e){var t,n,r,i,o,a=e.node,s=e.deltaSet,l=e.zoneId;if(!(a instanceof HTMLElement))return s;var c=a.className;if(/adit-html-block/.test(c)){var u=/adit-html-block--collapsed/.test(c),d=/adit-html-block--hidden/.test(c),f=/adit-html-block--header/.test(c),h=!/adit-html-block--frozen/.test(c),p=or({blockType:Le.HTML_BLOCK,props:{data:{html:escape(a.innerHTML),collapsed:u,toggleHidden:d,isHeader:f,editable:h}}});return s.get(l).insert(" ",((t={})[Q]=JSON.stringify(p),t)),s}var g=s;-1<c.indexOf(Z)&&(g=g.concat(new W.E({zoneId:l}).insert(" ")));try{for(var v=rn(Array.from(a.attributes)),m=v.next();!m.done;m=v.next()){var y,b,E=m.value;/^data-meta/.test(E.nodeName)&&E.nodeValue&&(g=E.nodeName===te?(y=Bn(E.nodeValue),b=Pn(y&&y.depLoading),Object(W.H)(g,l,((i={})[b]=E.nodeValue,i))):Object(W.H)(g,l,((o={})[Nr(E.nodeName)]=E.nodeValue,o)))}}catch(e){n={error:e}}finally{try{m&&!m.done&&(r=v.return)&&r.call(v)}finally{if(n)throw n.error}}return g},Sa.prototype.editorWillPaste=function(e){var p=this,t=e.deltaSet,n=e.isInternalPaste,g=e.event;if(!0!==Dr(t))return t;var r,v,i=t;return n&&(r=null===g||void 0===g?void 0:g.clipboardData.getData("text/html"),v=(new DOMParser).parseFromString(r,"text/html").body,i=i.reduce(function(e,t){if(!(t instanceof W.E))return e.concat(t);var h=t.zoneId,n=t.reduce(function(t,e){if(!e.attributes||!e.attributes[Q])return t.push(e);var n=Bn(e.attributes[Q]);if(!n)return t.push(e);var r=[Le.BITABLE_BLOCK,Le.SHEET_BLOCK,Le.JIRA_FILTER_BLOCK,Le.OKR_BLOCK];if(h!==F.DEFAULT_REP_ZONE&&r.includes(n.blockType))return t;var i,o,a=null===v||void 0===v?void 0:v.querySelector(".block-old-uuid-"+n.blockId),s=function(){var e=document.createElement("span");return e.appendChild(a),e.innerHTML},l=n;try{var c=L()(a).find("["+te+"]");if(0<c.length){var u=c.attr(te);u&&(l=Bn(u))}else{var d=L()(a).find("."+Wt);if(0<d.length)return delete e.attributes[Q],t.insert(d.text(),e.attributes)}var f=p.blockManager.getBlockCreator(n.blockType);f&&f.onInternalPaste&&(i=f.onInternalPaste(Qt(Qt({dataset:l,getHTML:s},p.editor.clipboard.getPasteInfo()),{originalEvent:g})))}catch(e){return console.error("catch error when call "+n.blockType+" onInternalPaste",e),t}return e.attributes[Q]=JSON.stringify(i||l),i&&i.depLoading&&(o=Pn(i.depLoading),e.attributes[o]=e.attributes[Q],delete e.attributes[Q]),t.push(e)},new W.E({zoneId:h}));return e.concat(n)},new W.e)),i=i.reduce(function(e,t){if(!(t instanceof W.E))return e=e.concat(t);var n=function(e){var t=e.key,n=e.value;return t===Q&&!!Bn(n)},r=function(e){var t=e.key,n=Bn(e.value);return n.blockId=ln(),{key:t,value:JSON.stringify(n)}},i=Object(W.N)(t,n,r);return e=e.concat(i)},new W.e)},Sa.prototype.afterPasteInsert=function(e,t){var n=t.editorInfo.getRep(),r={zoneId:n.zoneId,lineNum:n.selStart[0],isRemote:!1,isMounting:!1};this.notifyLineContentChange(r)},Sa.prototype.acePaste=function(e,t){var n=t.text,r=t.source,i=t.times,o=t.rep,a=t.e,s=t.purifiedHtml,l=t.pasteDataWrapper,c="cut"===r&&1===i;if(l.innerHTML||n){if(this.cleanHtml(l),"0"!==o.zoneId){var u=ma(l),d=this.getTableInSheetBlock(u);if(d)return void(t.pasteDataWrapper=d[0]);var f=L()(l).find("span.block-type-"+Le.BITABLE_BLOCK).closest(".ace-line");if(f.length)return void f.remove()}var h=this.updatePasteData({pasteDataWrapper:l,purifiedHtml:s,text:n},{firstPasteAfterCut:c,event:a},!1);t.text=h.text,Cr(l)}},Sa.prototype.aceAfterPaste=function(e,t){var n=t.pasteDataWrapper.querySelector("."+Z);n&&n.setAttribute("data-paste-change-content","true")},Sa.prototype.aceCut=function(e,t){return this.aceCopy(e,t)},Sa.prototype.aceCopy=function(e,t){var n=this.updateCopyData(t.html),r=n.html,i=n.data;r&&(t.html=r),Object(h.default)(i)||(t.customCopyDatas=[{key:Dt,data:JSON.stringify(i)}])},Sa.prototype.editorAlinesDidSplice=function(e,t){var n,r,i,o,a,s;this.editor.version.includes(W.y)||(n=t.prevState,r=t.currentState,i=t.isRemote,o=Ar(n.numToAttrib),a=Ar(r.numToAttrib),s=Object(c.a)(o,a),this.handleBlockDelete(s,i))},Sa.prototype.handleBlockDelete=function(e,t,o){var a=this;void 0===t&&(t=!1);var s=new Set;e.forEach(function(e){var t,n,r,i=a.getBlockInfo(e);i&&i.instance&&(void 0!==o&&o!==(null===(t=i.options)||void 0===t?void 0:t.zoneId)||(a.event.trigger("blockDelete",[i.instance]),a.entryMap.delete(e),ya.prototype.deleteBlock.call(a,i.instance.blockId),r={blockType:(n=i.instance).blockType,blockId:n.blockId,blockToken:n.blockToken},a.event.trigger(Ze.DELETE_BLOCK_DATA,[r]),s.add(i.instance.blockType)))}),s.size&&this.editor.call("block:delete",{types:s,isRemote:t,ids:e})},Sa.prototype.afterUpdateBlockAttributes=function(e,t){var n,r=t.newBlockAttribute[1];!r||(n=_n(r))&&this.setBlockAttribute(n,r)},Sa.prototype.aceKeyEvent=function(e,t){var n=t.evt,r=this.editor.getRep(),i=n.keyCode;if((ir(r)||rr(r))&&9===n.which)return!0;if("keydown"===n.type&&8===i){var o=this.editor.getRep(),a=o.selStart,s=o.selEnd;if(!a||!s)return!1;var l=a[0]===s[0]&&a[1]===s[1],c=a[0],u=o.lines.atIndex(c);if(!l||!u)return!1;var d=a[1]===u.lineMarker,f=o.lines.atIndex(c-1);if(!d||!f||!f.lineNode)return!1;if(!(y=f.lineNode.classList.contains(V)))return!1;if(!(h=qn(f.lineNode)))return!1;if(!(b=this.getBlockInfo(h.blockId)))return!1;if((v=b.instance).onDeleteAtNextLine&&0===u.lineMarker)return v.onDeleteAtNextLine(),n.preventDefault(),!0}if("keydown"===n.type&&46===i){var h,p=this.editor.getRep(),c=(a=p.selStart)[0],u=p.lines.atIndex(c),g=p.lines.atIndex(c+1);if(!u||!g||!g.lineNode)return!1;if(!(h=qn(g.lineNode)))return!1;var v,m=a[1]===u.width-1,y=g.lineNode.classList.contains(V),b=this.getBlockInfo(h.blockId);if(!m||!y||!b)return!1;if((v=b.instance).onDeleteAtPrevLine)return v.onDeleteAtPrevLine(),n.preventDefault(),!0}return!1},Sa.prototype.editorSizeChange=function(e,t){this.resizeBlocks(t.next.width)},Sa.prototype.onAlinesInited=function(){var i=this,e=function(e){return e===Q},t=this.editor.getMatchedAttributePositionOnSelection(null,e),o={};t.forEach(function(e){var t=Bn(e.attrValue),n=t.blockType;Array.isArray(o[n])?o[n].push(t):o[n]=[t]}),Object.keys(o).forEach(function(e){var t=o[e],n={blockType:e,blockInfos:t.map(function(e){return{blockId:e.blockId,blockToken:e.token}})};i.event.trigger(Ze.BEFORE_INIT_BLOCKS_ONLY,[n]),i.initBlocksOnly(t);var r=i.blockManager.getBlockCreator(e);r&&r.onBlockInitOnly&&r.onBlockInitOnly(t)}),this.event.trigger("onAlinesInited"),0===t.length&&this.notifyBlockMounted([])},Sa.prototype.aceCutRangeReplaceSeletion=function(e,t){var n,r,i=t.rep,o=i.selStart,a=i.selEnd,s=i.zoneId;o&&a&&o[0]===a[0]&&(n=nr(t.rep),r=t.rep.lines.atIndex(o[0]),n&&!fr(n)&&r&&this.editor.performDocumentReplaceRange(s,[o[0],0],[o[0],r.text.length],""))},Sa.prototype.excludeBlocks=function(e,t){return Array.from(e).filter(function(e){return!t.has(e)})},Sa.prototype.diffBlocks=function(e,t){return{attaches:this.excludeBlocks(e,t),detaches:this.excludeBlocks(t,e)}},Sa.prototype.getBlocksOnLine=function(e,t){var n,r,i,o,a=this.editor.getAllAttributesOnLine(e,t),s=[];try{for(var l=rn(a),c=l.next();!c.done;c=l.next()){var u,d,f,h=on(c.value,2),p=h[0],g=h[1];zn(p)&&g?(d=void 0===(u=(Bn(g)||{}).blockId)?"":u,(f=this.getBlockById(d))&&s.push(f)):"sheet-id"===p?i=g:"sheet-token"===p&&(o=g)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}if(i&&o){var v=this.getBlockByToken(o+"_"+i);return v?[v]:[]}return s},Sa.prototype.getBlocksOnLines=function(e){var t,n,r,i,o=[];try{for(var a=rn(Object.entries(e)),s=a.next();!s.done;s=a.next()){var l=on(s.value,2),c=l[0],u=l[1];try{for(var d=(r=void 0,rn(u)),f=d.next();!f.done;f=d.next()){var h=f.value,p=this.getBlocksOnLine(c,h);p&&0<p.length&&(o=o.concat(p))}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o},Sa.prototype.processBlocks=function(e,t){var r=this,n=e.reduce(function(e,t){var n;return t.isRendered||((n=r.entryMap.get(t.blockId))&&n.isRendered&&!e.includes(n)&&e.push(n),n||xr("[Block_Error] can not find entry by id: "+t.blockId)),e},[]);this.processEntry(n,{from:t})},Sa.prototype.aceScrollEndInViewport=function(e,t){var n,r,i=this;if(this.event.trigger("scrollEndInViewport"),this.lazyBlockEnable){var o=this.getBlocksOnLines(t.viewportLines),a=this.diffBlocks(new Set(o),this.attachedBlocks),s=a.attaches,l=a.detaches;this.attachedBlocks=new Set(o),this.cancelDetachedTask(l),s.forEach(function(e){i.event.emit("scrollinview",e)});try{for(var c=rn(o),u=c.next();!u.done;u=c.next()){var d=u.value,f=this.entryMap.get(d.blockId);!d.isRendered&&f&&f.isRendered&&(fr(d)||(d.shouldRender=this.isBlockInViewport),this.processEntry(f,{priority:"HIGH",from:"scrollEndInViewport"}))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}this.scheduleUnRenderedZones()}},Sa.prototype.scheduleUnRenderedZones=function(){var n=this,e=Object.keys(this.unRenderedZones),r=[];e.forEach(function(e){var t=n.unRenderedZones[e];n.isEntriesInViewport(t)&&(r=r.concat(t),delete n.unRenderedZones[e])}),this.processEntry(r,{inTable:!0,from:"scrollEndInViewport_table"})},Sa.prototype.cancelDetachedTask=function(e){var t,n;try{for(var r=rn(e),i=r.next();!i.done;i=r.next()){var o=i.value,a=this.fiberIdMap.get(o.blockId);a&&this.editor.fiber.cancelTask(a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},Sa.prototype.findAllUnRenderedBlock=function(){var t,e,n=[];try{for(var r=rn(this.blockInfos),i=r.next();!i.done;i=r.next()){var o=i.value[1].instance;o.isRendered||n.push(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return n},Sa.prototype.aceForceRenderAll=function(e,t){var n,r=this;this.lazyBlockEnable&&((n=t.usageState?this.getBlocksOnLines(t.viewportLines):this.findAllUnRenderedBlock()).forEach(function(e){r.event.emit("firstScreen",e)}),this.processBlocks(n,t.usageState?"aceForceRenderAll":"exitVirtualScroll"))},Sa.prototype.getNextUnRenderedBlockId=function(){var i=this,e=this.editor,o=e.blockRender,t=e.getRep,n=o.getViewportLines()[F.DEFAULT_REP_ZONE];if(!n)return null;var a=Math.max.apply(Math,an(n)),s=t(F.DEFAULT_REP_ZONE).lines;return this.nextBlockId(function(e){var t=i.entryMap.get(e.blockId);if(e.isRendered||null===t||void 0===t||!t.isActive)return!1;var n=s.indexOfKey(t.key),r=o.isLineCollapsed(n);return!(n<=a||r)})},Sa.prototype.getNextUnRenderedInlineBlockId=function(){var n=this;return this.nextBlockId(function(e){var t=n.entryMap.get(e.blockId);return!(null===t||void 0===t||!t.isActive)&&!e.isRendered&&fr(e)})},Sa.prototype.nextBlockId=function(e){var t,n;try{for(var r=rn(this.blockInfos.entries()),i=r.next();!i.done;i=r.next()){var o=on(i.value,2),a=o[0];if(e(o[1].instance))return a}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},Sa.prototype.isLastFiberMissionComplete=function(){if(this.blockIdRenderingWithFiber){var e=this.getBlockById(this.blockIdRenderingWithFiber);return e&&e.isRendered}return!0},Sa.prototype.aceFiberAction=function(){if(this.lazyBlockEnable){if(!this.isLastFiberMissionComplete())return o.default;var e=this.blockFiberEnable?this.getNextUnRenderedBlockId():this.getNextUnRenderedInlineBlockId();return e?this.fiberProcessBlock(e):void 0}},Sa.prototype.fiberProcessBlock=function(t){var n=this;return function(){var e=n.entryMap.get(t);e&&e.isRendered&&(n.blockIdRenderingWithFiber=t,n.processEntry(e,{from:"aceFiberAction"}))}},Sa.prototype.isFocusBlackListEvent=function(e){var t=[Le.BITABLE_BLOCK],n=e.target,r=qn(n);return!!r&&t.includes(r.blockType)},Sa.prototype.getLineCheckedState=function(e,t){var n=this.getLineAttribute(e,t).filter(function(e){return"list"===on(e,1)[0]}).map(function(e){var t=on(e,2),n=(t[0],t[1]);return!!n.includes("done")||!n.includes("check")&&null});return n.length?n[0]:null},Sa.prototype.getAllMentionsForLine=function(e,t){var n=this.editor.getRep(t),r=this.getLineAttribute(e,n.zoneId),i=this.getLineNode(e,n.zoneId),o=r.filter(function(e){return on(e,1)[0].includes("mention-id")}).map(function(e){return on(e,1)[0]}),a=[];o.forEach(function(e){var t,n,r=L()(i).find("."+e)[0];r&&(t=r.innerText.slice(1),n=e.split("_")[1],a.push({name:t,id:n}))});var s=r.filter(function(e){var t=on(e,2),n=t[0],r=t[1];return zn(n)&&r.includes(Le.AT_USER_BLOCK)}).map(function(e){var t=on(e,2),n=(t[0],t[1]);return JSON.parse(n).props.data.user});return a.concat(s)},Sa.prototype.filterBlockAttributes=function(o,e){var a=["author","lineguid",Q,X],s=e.attribs,t=e.attribString;return Object.keys(s).reduce(function(e,t){var n;if(a.includes(t)||t.includes("comment"))return e;var r=[t,s[t]].join(","),i=null===(n=o.attribToNum[r])||void 0===n?void 0:n.toString(36);return e.replace(/\*[\da-z]+/g,function(e){return e==="*"+i?"":e})},t)},Sa.prototype.getTableInSheetBlock=function(e){if(!(e instanceof L.a))return null;var t=e.is("table")?e:e.find("table");return t.length?t:null},Sa.prototype.isCollectingBlock=function(e){if(!e||!Fn(e))return!1;try{return!fr(JSON.parse(Fn(e)))}catch(e){return!1}},Sa.prototype.replaceAttribKey=function(e,t,n){e[t]&&(e[n]=e[t],delete e[t])},Sa.prototype.updateCCStateIfBlockDepLoading=function(e){var t,n,r,i=e.attribs,o=void 0===i?{}:i,a=e.attribsValues,s=void 0===a?{}:a,l=Fn(o);!l||(t=Bn(l))&&t.depLoading&&(n=Q,r=X,this.replaceAttribKey(o,n,r),this.replaceAttribKey(s,n,r),this.editor.call(Bt,t))},Sa.prototype.isInsertBelowBlock=function(e){var t=e.oldLineEntries,n=e.newLineEntries;if(t&&1===t.length&&n&&2===n.length&&n[0].lineNode&&t[0].lineNode){var r=qn(n[0].lineNode),i=qn(t[0].lineNode);return this.compareDataSet(r,i)}return!1},Sa.prototype.handleInsertBelowBlock=function(e){var t,n,r=e.oldLineEntries,i=e.newLineEntries,o=this.reuseDomForBlock(r,[i[0]]),a=i[0].lineNode,s=i[1].lineNode;return a&&s&&(a.nextSibling?null!==(t=a.parentElement)&&void 0!==t&&t.insertBefore(s,a.nextSibling):null!==(n=a.parentElement)&&void 0!==n&&n.appendChild(s)),an(o,[i[1]])},Sa.prototype.isDeleteBelowBlock=function(e){var t=e.oldLineEntries,n=e.newLineEntries;if(t&&0<t.length&&n&&1===n.length&&n[0].lineNode&&t[0].lineNode){var r=qn(n[0].lineNode),i=qn(t[0].lineNode);return this.compareDataSet(r,i)}return!1},Sa.prototype.handleDeleteBelowBlock=function(e){var t=e.oldLineEntries,n=e.newLineEntries;return this.reuseDomForBlock([t[0]],[n[0]])},Sa.prototype.mapIdsToBlocks=function(e){var t=this;return e.map(function(e){return t.getBlockById(e)}).filter(function(e){return!!e})},Sa.prototype.setInSheet=function(e){this.inSheet=e},Sa.prototype.getInSheet=function(){return this.inSheet},Sa.prototype.enterSheet=function(){this.setInSheet(!0)},Sa.prototype.exitSheet=function(){this.setInSheet(!1)},$t([Ki(),Zi(60),en("design:type",Function),en("design:paramtypes",[]),en("design:returntype",void 0)],Sa.prototype,"handleSelectionChange",null),$t([Object(W.J)(0),en("design:type",Function),en("design:paramtypes",[Object]),en("design:returntype",void 0)],Sa.prototype,"render",null),Sa);function Sa(e){var V=ya.call(this,e)||this;if(V.className="AditAdapter",V.initialBlockTokens=new Map,V.attachedBlocks=new Set,V.entryMap=new Map,V.isPure=!1,V.initialBlockList=new Map,V.fiberIdMap=new Map,V.unRenderedZones={},V.getBlockManager=function(){return V.blockManager},V.getBlock=function(e){return V.getBlockByToken(e)},V.notifyBlockMounted=function(e){V.event.trigger(jt,[e]),V.editor.call(jt,e)},V.isAllBlockContentRendered=function(){return Array.from(V.blockInfos).every(function(e){var t=on(e,2);t[0];return t[1].instance.isRendered})},V.insertBlock=function(g,v){var e,m=Br.EventEmitter,y=[[Pn(g.depLoading),JSON.stringify(g)]],b=V.editor.getRep(),E=b.lines,t="insertblock: "+g.blockType+"-"+1e3*Math.random();return V.editor.callStack.inCallStackIfNecessary(t,function(){var e=fr(g),t=v||b;V.editor.fastIncorp(!1);var n,r,i,o,a,s,l,c,u,d,f,h=t.selStart,p=t.selEnd;h&&p?(n=V.editor.getRep(),r=h[0],o=(i=n.lines.atIndex(r))&&h[1]===i.lineMarker,a=i&&h[1]===i.width-1,(s=ga(n)).endsWith("\n")||e||o||a||(s+="\n"),h[0]===p[0]&&h[1]===p[1]&&e&&(s=" "),l=!1,0!==h[1]||-1<(c=h[0]-1)&&((u=E.atIndex(c).lineNode)&&Er(u,"single-line")&&(l=!0)),!e&&null!==i&&void 0!==i&&i.lineMarker&&o&&(V.editor.version.includes(W.y)&&(null===(d=V.editor.getContentState().getZoneState(b.zoneId).getLine(r))||void 0===d?void 0:d.getLineAttributes().every(function(e){return Ca.includes(e[0])}))||(l=!0)),l&&!e&&(s="\n"+s),m.emit("invokeCollapse",{zoneId:t.zoneId,range:{selStart:h,selEnd:p}}),g.depLoading&&((f=V.editor.getCurrentCallStack()).editEvent.mergeEvent=f.type,V.editor.call(Bt,g)),V.editor.performDocumentReplaceRangeWithAttributes(t.zoneId,h,p,va(s),y),V.editor.version.includes(W.y)||V.editor.updateBrowserSelectionFromRep(!0)):xr("[Block Error] insertBlock with invalid rep: "+b.zoneId)}),null===(e=V.getBlockInfo(g.blockId))||void 0===e?void 0:e.instance},V.getDocbodyRect=function(e){void 0===e&&(e=!1),e&&V.editor.setRect();var t=V.editor.getRect();if(!t)throw new Error("rect is undefined.");var n=t.right,r=t.width;return{width:r,right:n,left:t.left,innerWidth:r-ba-Ea}},V.setSelectionToLastLineEnd=function(e){var t,n,r,i,o,a,s=L()(e).closest(".ace-line")[0];!s||(n=(t=V.editor).domToRep(s))&&((r=on(n.selStart,1)[0])<0||(i=r-1,(o=t.getRep().lines.atIndex(i))&&(a=o.width-1,t.selection.setWithSelection("0",[i,a],[i,a]),t.selection.internalUpdateSelectionFromRep(!0))))},V.replaceBlock=function(o,a,s){return void 0===s&&(s=!1),tn(V,void 0,void 0,function(){var r,t,n,i=this;return nn(this,function(e){if(!(r=this.getBlockRep(o)))throw new Error("[BLOCK_ERROR] replaceBlock can not find blockRep: "+o.blockId);return t="replaceBlock",s&&(n=this.editor.undoModule.stack.getNthFromTop(0),t=n.eventType),this.editor.inCallStackIfNecessary(t,function(){var e=r.selStart,t=r.selEnd,n=[[Pn(),JSON.stringify(a)]];i.editor.getRep(e[2]).attributeManager.setAttributesOnRange(e,t,n)},{isForceMerge:s,mergeEvent:t}),[2]})})},V.deleteBlock=function(e,r,t){void 0===r&&(r=!0),void 0===t&&(t=!1);var n,i=V.getBlockRep(e.block);i?(n="delete-block",t&&(n=V.editor.undoModule.stack.getNthFromTop(0).eventType),V.editor.inCallStackIfNecessary(n,function(){V.editor.fastIncorp(!1);var e=i.selStart,t=e[2],n=i.selEnd;r||(n=[n[0]+1,0,t]),V.editor.performDocumentReplaceRangeWithAttributes(t,e,n,"",[]),V.editor.version.includes(W.y)?V.editor.selection.setSelection({start:{line:e[0],offset:e[1],zoneId:t},end:{line:n[0],offset:n[1],zoneId:t}},!0):(V.editor.selection.setWithSelection(t,e,n),V.editor.selection.updateBrowserSelectionFromRep(!0))},{isForceMerge:!0,mergeEvent:n})):xr("[Block Error] delete block failed, domToRep return null")},V.commentBlock=function(e,t){V.editor.call("commentButtonClick",{event:e,selection:t}),V.event.trigger("blockComment")},V.copyBlock=function(e,t){var n=V.getCopyBlocKResult(e);n&&V.editor.setDataToClipboard({data:n.pasteData,type:t||n.type})},V.cutBlock=function(e){V.copyBlock(e,"cut"),V.deleteBlock(e)},V.updateBlockProps=function(e,t){var n=t&&t.getAttribute&&t.getAttribute("class"),r=V.editor.getCurrentCallStack(),i=V.editor.domToRep(t);if(!i)return xr("[BLOCK_ERROR]: domToRep return null, span: "+n),void(Br.LogService&&Br.LogService.collectSuiteEvent("block_update_props_error",{span_class:n,attr_keys:"",reason:"domToRep return null"}));var o=qn(t);if(!o)return xr("[BLOCK_ERROR]: getDataSet return null, span: "+n),void(Br.LogService&&Br.LogService.collectSuiteEvent("block_update_props_error",{span_class:n,attr_keys:"",reason:"getDataSet return null"}));var a=i.selStart,s=i.selEnd,l=on(s,3),c=l[0],u=l[1],d=l[2];if(!e)return xr("[BLOCK_ERROR]: blockId: "+o.blockId+" updateBlockProps with props: "+e),void(Br.LogService&&Br.LogService.collectSuiteEvent("block_update_props_error",{span_class:n,attr_keys:"",reason:"props return "+e}));o.props=e;var f=V.editor.getAttributesOnPosition(d,c,u),h=f.filter(function(e){return!jn(e[0])});if(f.length===h.length)return xr("[BLOCK_ERROR]: oldAttr missing "+Q+", val "+JSON.stringify(f.map(function(e){return e[0]}))),void(Br.LogService&&Br.LogService.collectSuiteEvent("block_update_props_error",{span_class:t&&t.getAttribute&&t.getAttribute("class"),attr_keys:JSON.stringify(f.map(function(e){return e[0]})),reason:"oldAttrs missing "+Q}));var p=V.getAttrsFromBlockDataSet(o),g=an(h);h.push.apply(h,an(p));var v,m=V.editor.getRep(d).lines.atIndex(c).text,y=f.filter(function(e){return jn(e[0])})[0],b=!1,E=!1,k=JSON.parse(y[1])||{};k.props&&"inline"===k.props.displayMode&&"block"===e.displayMode&&(V.editor.version.includes(W.y)?(null===(v=V.editor.getContentState().getZoneState(d).getLine(c))||void 0===v?void 0:v.getLineAttributes().every(function(e){return Ca.includes(e[0])}))||(E=!0):0<m.slice(0,u-1).length&&(E=!0),0<m.slice(u).length&&(b=!0));var C=function(){var e,t=V.editor.getCurrentCallStack();t&&(t.preventScrolling=!0),E||b?E?(e=[{start:a,end:s,newText:"\n",attributes:g},{start:s,end:s,newText:" ",attributes:h}],b&&e.push({start:s,end:s,newText:"\n",attributes:[]}),V.editor.performDocumentReplaceMultiRangeWithAttributes(d,e)):V.editor.performDocumentReplaceMultiRangeWithAttributes(d,[{start:a,end:s,newText:" ",attributes:h},{start:s,end:s,newText:"\n",attributes:[]}]):V.editor.getRep(a[2]).attributeManager.setAttributesOnRange(a,s,h)};r?C():V.editor.callWithAce(function(){V.editor.fastIncorp(!0),C()},"updateBlockProps",!0)},V.handleFocusOnBlock=function(e){var t,n,r,i,o,a,s,l,c,u,d,f,h,p,g,v,m;V.isEventOnBlock(e)&&(n=e.target,(r=L()(n).closest('div[id^="magicdomid"]')[0])&&(i=V.editor.dom.zoneOfdom(r))?(a=(o=V.editor.getRep(i)).lines,s=o.selStart,(l=a.indexOfKey(r.id))<0?V.enterSheet():((u=Lr(c=n))&&V.updateBlockSelected(u.outerHTML),s&&s[0]===l?hn.safari&&V.isFocusBlackListEvent(e)||!c.focus||(d=V.editor.dom.getScrollElSelector())&&(f=L()(d).scrollTop(),c.focus(),void 0!==f&&(L()(d).scrollTop(f),hn.safari&&setTimeout(function(){L()(d).scrollTop(f)}))):(h=V.editor.domToRep(n))&&h.selStart?(p=h.selStart[2],v=null!==(g=V.editor.getContentState().getZoneState(p).getLine(l))&&void 0!==g&&g.hasLineMarker()?1:0,V.editor.selection.setSelection({start:{zoneId:p,line:l,offset:v},end:{zoneId:p,line:l,offset:v+1}},!0),(hn.mobile||hn.safari)&&V.isFocusBlackListEvent(e)||c.focus&&(V.editor.dom.getScrollElSelector()?(m=L()(V.editor.dom.getScrollElSelector()).scrollTop(),null!==(t=window.getSelection())&&void 0!==t&&t.removeAllRanges(),c.focus(),void 0!==m&&(L()(V.editor.dom.getScrollElSelector()).scrollTop(m),hn.safari&&setTimeout(function(){L()(V.editor.dom.getScrollElSelector()).scrollTop(m)}))):V.enterSheet())):V.enterSheet())):V.enterSheet())},V.handleMouseDownOnMagicDom=function(e){var t,n,r,i,o,a;Ln(e.currentTarget)&&Vn(e)&&(e.preventDefault(),t=-1,n=1,r=e.offsetX<=40?t:n,i=L()(e.currentTarget).index()+r,!(o=V.editor.getRep().lines.atIndex(i))||(a=r===t?o.text.length:o.lineMarker)&&V.editor.callStack.inCallStackIfNecessary("click",function(){var e=V.editor.getRep();V.editor.performSelectionChange(e.zoneId,[i,a],[i,a])}))},V.handleKeyup=function(e){V.delegateBlockEvent("onKeyup",e)},V.handleOutsideClick=function(e){var t=L()(V.editor.getDocBody());t.length&&t[0].contains(e.target)||Ir(e.target)||Sr(e.target)||V.event.trigger("outsideClick",[e])},V.handleZoneDidRender=function(e){var l,c,t=e.zoneIds;!t||t&&0===t.length||(l=V.editor.getReps(),c=[],t.forEach(function(e){var t=l[e].lines,n=t.length(),r=[],i=[];V.event.trigger("tableDidRender",[{zoneId:e}]);for(var o=0;o<n;o++){var a,s=V.getBlocksOnLine(e,o),r=r.concat(s);0<s.length&&((a=t.atIndex(o))&&i.push(a))}!V.lazyBlockEnable||V.isEntriesInViewport(i)?c.push.apply(c,an(i)):0<i.length&&(V.unRenderedZones[e]=i)}),V.processEntry(c,{inTable:!0,from:"tableDidRender"}))},V.handleBlockClick=function(e){var t,n,r=e.target,i=L()(r).closest("."+K),o=V.editor.domToRep(i[0].parentNode);o&&(t=qn(i[0]),(n=V.getBlockInfo(t.blockId))&&n.instance.blockType!==Le.PLACEHOLDER_BLOCK&&(V.editor.callStack.inCallStackIfNecessary("clickBlock",function(){V.editor.performSelectionChange(o.selStart[2],o.selStart,o.selEnd)},{shouldIncorp:!1}),n&&V.event.trigger("blockClick",[n.instance,Qt({event:e,zoneId:o.selStart[2]},o)])))},V.handleBlockMouseEnter=function(e){V.event.trigger("blockMouseEnter",[e])},V.handleBlockMouseLeave=function(e){var t=e.currentTarget,n=e.relatedTarget,r=qn(t);if(r&&r.blockType===Le.BITABLE_BLOCK&&n){var i=L()(n);if(i.hasClass("J-bitable-container")||0<i.closest(".J-bitable-container").length)return}V.event.trigger("blockMouseLeave",[e])},V.onBlockInstanceWillUpdate=function(e,t){var n,r;void 0===t&&(t=!1);var i=V.getBlockInfo(e),o=null===(r=null===(n=V.editor)||void 0===n?void 0:n.blockRender)||void 0===r?void 0:r.isSkipAboveRender();t&&o&&null!==i&&void 0!==i&&i.instance?V.callAyncNodeShowLoadingEvent(F.ASYNC_NODE_WILL_SHOW_LOADING_EVENT,i.instance):null!==i&&void 0!==i&&i.options&&V.editor.call(F.ASYNC_NODE_WILL_UPDATE_EVENT,i.options)},V.onBlockInstanceDidUpdate=function(e,t){var n,r;void 0===t&&(t=!1);var i=V.getBlockInfo(e),o=null===(r=null===(n=V.editor)||void 0===n?void 0:n.blockRender)||void 0===r?void 0:r.isSkipAboveRender();if(t&&o&&i&&i.instance)V.callAyncNodeShowLoadingEvent(F.ASYNC_NODE_DID_SHOW_LOADING_EVENT,i.instance);else if(null!==i&&void 0!==i&&i.options){if(o){var a=V.editor.blockRender.getCurrentBufferRange()[0],s=V.entryMap.get(e);if(!s)return;var l=V.editor.getReps()[s.zone].lines.indexOfEntry(s);if(V.editor.getLineNumInRootZone(s.zone,l)<a)return}V.editor.call(F.ASYNC_NODE_DID_UPDATE_EVENT,i.options)}},V.renderBlockAsyncSuc=function(e,t){var n,r;e&&e.token&&((n=V.getDocBody())&&((r=n.dataset.lastWidth)?V._resizeBlock(t,parseInt(r,10)):Tr("processEntry",r,t.blockType))),V.updateLinePopover()},V.getAttrsFromBlockDataSet=function(e){return[[Pn(e.depLoading),JSON.stringify(e)]]},V.getLeftMarginWidth=function(){return V.getDocbodyRect().left-ka},V.getRectCoordsForFullWidthElement=function(e){if(!e.fullWidthNode)return null;var t=V.tryGetBlockIdForNode(e.fullWidthNode)||"",n=V.getBlockInfo(t);if(!n||!n.instance.isRendered)return null;var r=e.fullWidthNode.getBoundingClientRect(),i=r.bottom,o=r.top;if(n){var a=V.getDocbodyRect().left;return n.instance.isRendered&&(a=n.instance.leftOffset+r.left),{bottom:i,top:o,left:a}}return r},V.bufferChanged=function(e,t){var n=t.enteredLines.map(function(e){var t=e.lineEntry.getAllInstances().find(function(e){return V.isBlockEditorPluginInstance(e)});return t&&V.getBlockInfo(t.blockId)}).filter(function(e){return!!e});n.length&&V.editor.fiber.scheduleTask(function(){V.event.emit("checkHalfFullScreenStatus",n)})},V.aceAttribsToClasses=function(e,t){if(jn(t.key)){var n=null;try{n=JSON.parse(t.value)}catch(e){return[K]}return V.dataset2Classes(n)}return[]},V.aceSelectionChanged=function(){V.event.trigger("selectionChanged")},V.handleContentChange=function(e){var t,n,r,i,o,a,s,l,c,u,d,f,h,p,g=e.changes,v=e.options;if(V.editor.version.includes(W.y)){var m=Object.keys(g);try{for(var y=rn(m),b=y.next();!b.done;b=y.next()){var E=b.value,k=[],C=[],I=g[E];try{for(var S=(r=void 0,rn(I)),T=S.next();!T.done;T=S.next()){var O=T.value;try{for(var w=(o=void 0,rn(O.deletes)),R=w.next();!R.done;R=w.next()){var x=R.value.getEntities([[Q]]);try{for(var M=(s=void 0,rn(x)),N=M.next();!N.done;N=M.next()){var _=N.value,L=JSON.parse(_.attributes[Q]);C.includes(L.blockId)||C.push(L.blockId)}}catch(e){s={error:e}}finally{try{N&&!N.done&&(l=M.return)&&l.call(M)}finally{if(s)throw s.error}}}}catch(e){o={error:e}}finally{try{R&&!R.done&&(a=w.return)&&a.call(w)}finally{if(o)throw o.error}}try{for(var D=(c=void 0,rn(O.inserts)),B=D.next();!B.done;B=D.next()){x=B.value.getEntities([[Q]]);try{for(var P=(d=void 0,rn(x)),F=P.next();!F.done;F=P.next()){_=F.value,L=JSON.parse(_.attributes[Q]);k.includes(L.blockId)||k.push(L.blockId)}}catch(e){d={error:e}}finally{try{F&&!F.done&&(f=P.return)&&f.call(P)}finally{if(d)throw d.error}}}}catch(e){c={error:e}}finally{try{B&&!B.done&&(u=D.return)&&u.call(D)}finally{if(c)throw c.error}}}}catch(e){r={error:e}}finally{try{T&&!T.done&&(i=S.return)&&i.call(S)}finally{if(r)throw r.error}}try{for(var j=(h=void 0,rn(k)),z=j.next();!z.done;z=j.next()){var H=z.value,U=C.indexOf(H);V.getBlockInfo(H)||V.blockFromRemote.set(H,!!v.isRemote),-1<U&&C.splice(U,1)}}catch(e){h={error:e}}finally{try{z&&!z.done&&(p=j.return)&&p.call(j)}finally{if(h)throw h.error}}V.handleBlockDelete(C,!1,E)}}catch(e){t={error:e}}finally{try{b&&!b.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}}},V.handleDidPaste=function(){var e=V.editor.getRep(),t={zoneId:e.zoneId,lineNum:e.selStart[0],isRemote:!1,isMounting:!1};V.notifyLineContentChange(t)},V.collectContentPre=function(e,t){var n,r,i,o,a,s=t.cls,l=t.cc,c=t.state,u=t.node;if(/adit-html-block/.test(s)){var d=/adit-html-block--collapsed/.test(s),f=/adit-html-block--hidden/.test(s),h=/adit-html-block--header/.test(s),p=!/adit-html-block--frozen/.test(s),g=or({blockType:Le.HTML_BLOCK,props:{data:{html:escape(u.innerHTML),collapsed:d,toggleHidden:f,isHeader:h,editable:p}}});return l.doAttrib(c,Q,JSON.stringify(g)),void l.lines.appendText(" ",c.attribString)}s&&-1<s.indexOf(Z)&&(i=0===l.lines.textOfLine(l.lines.length()-1).length,V.updateCCStateIfBlockDepLoading(c),!(o=V.isCollectingBlock(c&&c.attribs))&&i&&l.hasLineAttributes(c)&&l._produceLineAttributesMarker(c),a=o?V.filterBlockAttributes(l.apool,c):c.attribString,l.lines.appendText(" ",a));try{for(var v=rn(Array.from(u.attributes)),m=v.next();!m.done;m=v.next()){var y,b=m.value;/^data-meta/.test(b.nodeName)&&b.nodeValue&&(b.nodeName===te?(y=Bn(b.nodeValue),l.doAttrib(c,Pn(y&&y.depLoading),b.nodeValue)):l.doAttrib(c,Nr(b.nodeName),b.nodeValue))}}catch(e){n={error:e}}finally{try{m&&!m.done&&(r=v.return)&&r.call(v)}finally{if(n)throw n.error}}u.hasAttribute(te)&&l.incrementFlag(c,Q)},V.collectContentPost=function(e,t){var n=t.node,r=t.cc,i=t.state;n.hasAttribute(te)&&r.decrementFlag(i,Q)},V.shouldPreventCopy=function(e,t){var n=t.rep,r=t.e,i=V.editor.managers.getLineManagerForNonRootZoneId(n.zoneId),o=nr(n);if(!o||fr(o)||i&&i.state.selectedCellIds.includes(n.zoneId))return!1;var a=o&&V.getBlockById(o.blockId);if(r.target&&a&&a.shouldPreventCopy&&!0===a.shouldPreventCopy(r.target))return!0;var s=(n.selStart&&n.lines.atIndex(n.selStart[0])||{}).lineNode,l=void 0===s?void 0:s;return l&&(t.html=l.outerHTML),!1},V.searchStringRange=function(e,t){var n=t.attributeMap;(Fn(n)||n["sheet-id"])&&(t.isSearchable=!1)},V.handleDeleteFromCut=function(e){var t,n,r=V.editor.getRep(),i=r.selStart,o=r.selEnd,a=r.zoneId;i&&o&&i[0]===o[0]&&(t=nr(r),n=r.lines.atIndex(i[0]),t&&!fr(t)&&n&&(V.editor.performDocumentReplaceRange(a,[i[0],0],[i[0],n.text.length],""),e.preventEvent()))},V.hasDepLoadingBlock=function(){var e=function(e){return e===X};return 0<V.editor.getMatchedAttributePositionOnSelection(null,e).length},V.isBlockInViewport=function(e){var t=V.entryMap.get(e.blockId);return!!t&&V.isEntryInViewport(t)},V.isEntryInViewport=function(e){var t=e.zone,n=V.editor.getRep(t).lines.indexOfEntry(e);return V.editor.blockRender.isInViewport(t,n)},V.isEntriesInViewport=function(e){return 0<e.length&&(V.isEntryInViewport(e[0])||V.isEntryInViewport(e[e.length-1]))},V.updateLinePopover=function(){V.editor.call("updateLinePopover")},V.notifyLineContentChange=Object(s.default)(function(r){var i,o,a;"number"!=typeof r.lineNum||r.isMounting||(i=V.getAllMentionsForLine(r.lineNum,r.zoneId),o=V.getLineCheckedState(r.lineNum,r.zoneId),a=V.getLineNode(r.lineNum,r.zoneId),V.getBlockInfos().forEach(function(e){var t=e.instance,n=(L()(t.mountPoint).closest(".ace-line")[0]||{}).id;a&&a.id===n&&!1===r.isRemote&&t.onContentChange&&t.onContentChange({data:{allMentions:i,isChecked:o}})}))},50),V.inSheet=!1,V.handleBlurOnBlock=function(e){V.exitSheet()},V.isPure=!!e.pure,V.editor=e.editor,V.scheduler.setFiber(V.editor.fiber),V.editor.on("tableDidRender",V.handleZoneDidRender),V.editor.on("newZoneDidRender",V.handleZoneDidRender),V.event.on("blockInstanceWillUpdate",V.onBlockInstanceWillUpdate),V.event.on("blockInstanceDidUpdate",V.onBlockInstanceDidUpdate),V.event.on(Wt,V.logCopyLoadingBlock),V.isPure)return V;var t=L()(V.editor.getDocBody());return t.delegate("."+K,"focus",V.handleFocusOnBlock),t.delegate("."+K,"blur",V.handleBlurOnBlock),t.delegate('div[id^="magicdomid"]',"mousedown",V.handleMouseDownOnMagicDom),document.addEventListener("keyup",V.handleKeyup),V.editor.on(W.k.DID_PASTE,V.handleDidPaste),V.editor.on(W.k.WILL_DELETE_FROM_CUT,V.handleDeleteFromCut),V.editor.on(W.k.CONTENT_CHANGE,V.handleContentChange),hn.isMobile||(document.addEventListener("selectionchange",V.handleSelectionChange),L()(window).on("click",V.handleOutsideClick),t.delegate("."+K+":not(."+q+") ."+Z+":not(.block-hoverable)","click",V.handleBlockClick),t.delegate(".block-hoverable","mouseenter",V.handleBlockMouseEnter),t.delegate(".block-hoverable","mouseleave",V.handleBlockMouseLeave)),V}var Ta="BLOCK_CONTENT_CHANGE";function Oa(e){return Yt(t,n=e),t.prototype.onSearch=function(e){var t=e.blockDataSet,n=Xt(e,["blockDataSet"]),r=this.getBlockById(t.blockId);return r&&r.onSearch?r.onSearch(n):[]},t.prototype.onCancelSearch=function(e){var t=e.blockId,n=this.getBlockById(t);n&&n.onCancelSearch&&n.onCancelSearch(e)},t.prototype.onHighlight=function(e,t){var n=e.blockId,r=this.getBlockById(n);r&&r.onHighlight&&r.onHighlight(e,t)},t.prototype.onContentChange=function(e){this.editor.eventEmitter.emitEvent(Ta,[e])},t.prototype.onReplace=function(e){var t,n=e.replaceText,r=e.context,i=e.isReplaceAll;!r.isReplaceable||(t=this.getBlockById(r.blockId))&&t.onReplace&&t.onReplace({replaceText:n,context:r,isReplaceAll:i})},t.prototype.onGetNextTimes=function(e){var t=e.replaceText,n=e.context;if(!n.isReplaceable)return 0;var r=this.getBlockById(n.blockId);return r&&r.onGetNextTimes?r.onGetNextTimes({replaceText:t,context:n}):0},t;function t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var u=n.apply(this,an(e))||this;return u.searchStringRange=function(e,t){var n,r=t.attributeMap,i=t.zoneId,o=t.selStart,a=t.selEnd;r["sheet-id"]&&(t.isSearchable=!1);var s,l,c=Hn(r);c&&(l=(s=u.onSearch({searchKey:t.searchKey,matcher:t.matcher,blockDataSet:c})).map(function(e){return{isReplaceable:e.isReplaceable,context:Qt(Qt({},e),{matches:s}),zoneId:i,type:"BLOCK",selStart:o,selEnd:a}}),(n=t.searchStringList).push.apply(n,an(l)),t.isSearchable=!0)},u.event.addListener(Ta,u.onContentChange),u}var n}var wa=(Ra.prototype.unmount=function(){this.adapter.editor.eventEmitter.off("aceSelectionChanged",this.handleSelectionChange)},Ra);function Ra(e){var a=this;this.adapter=e,this.className="selectionCover",this.handleSelectionChange=function(e){var t=e.rep,n=t.selStart,r=t.selEnd,i=t.zoneId;if(n&&r&&!Object(E.default)(n[0],r[0]))for(var o=n[0];o<=r[0];o++)a.adapter.getBlocksOnLine(i,o).forEach(function(e){e.setAttributes({selected:!0,selectState:Xe.COVER_ON_BLOCK})})},this.adapter.editor.eventEmitter.on("aceSelectionChanged",this.handleSelectionChange)}var Aa,xa=(Yt(Ma,Aa=Ia),Ma.prototype.getBuiltInModules=function(){var e,t,n=[to,vo,ro,[Eo,{log:function(e,t){var n;null!==(n=Br.LogService)&&void 0!==n&&n.collectSuiteEvent(e,t)}}],Co,Go];return hn.mobile?hn.isAndroid&&n.push(wa):n.push([yo,Kr()]),hn.isMobile&&null!==(t=null===(e=window.User)||void 0===e?void 0:e.appConfig)&&void 0!==t&&t.mobile_menu_v2&&n.push(Oo),an(Aa.prototype.getBuiltInModules.call(this),this.filterBuiltInModules(n))},Ma.prototype.destory=function(e){Aa.prototype.destory.call(this,e),this.isPure||(Br.EventEmitter.off("collapseLineChange",this.handleCollapseLineChange),Br.EventEmitter.off("updateCommentHighlight",this.emitterUpdateCommentHighlight),this.blockManager.iterateCreator(function(e){e.destroy&&e.destroy()}))},Ma.prototype.getEditor=function(){return this.editor},Ma.prototype.notify=function(d){return tn(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u;return nn(this,function(e){switch(e.label){case 0:t=this.getBlockInfos(),n=!1,e.label=1;case 1:e.trys.push([1,10,11,12]),r=rn(t.values()),i=r.next(),e.label=2;case 2:return i.done?[3,9]:(o=i.value)&&o.instance?(a=o.instance).blockType!==Le.SHEET_BLOCK||n?[3,5]:(n=!0,(s=this.blockManager.getBlockCreator(a.blockType))&&s.notify?[4,s.notify(d)]:[3,4]):[3,8];case 3:e.sent(),e.label=4;case 4:return[3,8];case 5:return a.notify?[4,a.notify(d)]:[3,7];case 6:e.sent(),e.label=7;case 7:e.label=8;case 8:return i=r.next(),[3,2];case 9:return[3,12];case 10:return l=e.sent(),c={error:l},[3,12];case 11:try{i&&!i.done&&(u=r.return)&&u.call(r)}finally{if(c)throw c.error}return[7];case 12:return[2]}})})},Ma.prototype.initBlockPost=function(e,t){Aa.prototype.initBlockPost.call(this,e,t),Br.EventEmitter.trigger("collectBlockIdForShortCut",[e.blockId])},Ma.prototype.blockWillMount=function(e){this.editor.plugins.editBarManager&&this.editor.plugins.editBarManager.fireCaretLineUpdated(this.editor,!1),Br.EventEmitter.trigger("blockWillMount",[e.blockId])},Ma.prototype.blockDidMount=function(e){Aa.prototype.blockDidMount.call(this,e),this.editor.plugins.editBarManager&&this.editor.plugins.editBarManager.fireCaretLineUpdated(this.editor,!1),this.event.trigger(Ze.MOUNT,[e]),Br.EventEmitter.trigger("blockDidMount",[e.blockId])},Ma.prototype.blockDidUpdate=function(e){Br.EventEmitter.trigger("blockDidUpdate",[e.blockId])},Ma.prototype.blockDidInit=function(e){Br.EventEmitter.trigger("blockDidInit",[e.blockId])},Ma.prototype.blockDidCreate=function(e){Br.EventEmitter.trigger("blockDidCreate",[e.blockId])},Ma.prototype.blockFailMount=function(e){this.editor.plugins.editBarManager&&this.editor.plugins.editBarManager.fireCaretLineUpdated(this.editor,!1),Br.EventEmitter.trigger("blockFailMount",[e.blockId])},Ma.prototype.blockWillUnmount=function(e){Br.EventEmitter.trigger("blockWillUnmount",[e.blockId])},Ma.prototype.blockDidUnmount=function(e){Br.EventEmitter.trigger("deleteBlock",[e.blockId])},Ma.prototype.watchdogShouldIgnoreCCInputEvent=function(e,t){var n=t.event.target;if(n&&n!==this.editor.getInnerContainer()&&0!==L()(n).closest("."+V).length)return!0},Ma=$t([Oa,en("design:paramtypes",[Object])],Ma));function Ma(e){var p=Aa.call(this,e)||this;return p.className="BlockPlugin",p.updateBlockContext=function(r,i){void 0===i&&(i=!1),p.blockInfos.forEach(function(e){var t,n;e&&e.instance&&(t=e.instance.blockType===Le.AT_USER_BLOCK,(n=e.instance).setContext(r,!t&&i&&n.isRendered))})},p.handleCopyBlockFromMenu=function(e){Br.LogService.collectSuiteEvent("click_block_lefttoolbar_func",{block_id:e.blockId,block_type:e.blockType,block_function:"block_copy"})},p.handleDeleteBlockFromMenu=function(e){Br.LogService.collectSuiteEvent("click_block_lefttoolbar_func",{block_id:e.blockId,block_type:e.blockType,block_function:"block_delete"})},p.handleCutBlockFromMenu=function(e){Br.LogService.collectSuiteEvent("click_block_lefttoolbar_func",{block_id:e.blockId,block_type:e.blockType,block_function:"block_cut"})},p.getBlockAttribOnLine=function(e){return p.editor.getAttributeOnLine(F.DEFAULT_REP_ZONE,e,Q)||p.editor.getAttributeOnLine(F.DEFAULT_REP_ZONE,e,X)},p.handleCollapseLineChange=function(e){e.collapseRange.forEach(function(e){var t,n,r,i,o,a,s,l=p.getBlockAttribOnLine(e);!l||(n=null===(t=p.editor.lineTracker.collapseLines)||void 0===t?void 0:t.getCollapsedStatusOfLine(F.DEFAULT_REP_ZONE,e))&&(r=n.renderCollapsed,i=n.startOfCollapseSection,o=!(!r||i),a=Bn(l).blockId,(s=p.getBlockById(a))&&s.collapseLineChange&&s.collapseLineChange(o))})},p.emitterUpdateCommentHighlight=function(e){var t,n,r,i;if(p.isForMainEditor()){var o=e.docPositions;if(o)try{for(var a=rn(o),s=a.next();!s.done;s=a.next()){var l=s.value,c=p.editor.getMatchedAttributePositionOnSelection(l,function(e){return jn(e)});try{for(var u=(r=void 0,rn(c)),d=u.next();!d.done;d=u.next()){var f,h=Bn(d.value.attrValue);h&&h.blockId&&((f=p.getBlockInfo(h.blockId))&&f.instance.updateHighlight&&("remove"===e.actionType?f.instance.updateHighlight(qe.NONE):"hasComment"===e.actionType?f.instance.updateHighlight(qe.HAS_COMMENT):"focus"===e.actionType&&f.instance.updateHighlight(qe.FOCUS)))}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}},p.isPure||(p.event.on("copyBlockFromMenu",p.handleCopyBlockFromMenu),p.event.on("deleteBlockFromMenu",p.handleDeleteBlockFromMenu),p.event.on("cutBlockFromMenu",p.handleCutBlockFromMenu),Br.EventEmitter.on("collapseLineChange",p.handleCollapseLineChange),Br.EventEmitter.on("updateCommentHighlight",p.emitterUpdateCommentHighlight),p.blockManager=e.blockManager),p}var Na,_a={readable:!0,editable:!0,commentable:!1,shareable:!1,printable:!1,exportable:!1,copyable:!1},La=(Yt(Da,Na=fa),Da.prototype.bindEvent=function(){},Da.prototype.removeEvent=function(){},Da.prototype.resizeHalfFullScreenBlock=function(){},Da.prototype.handleCopy=function(e){var t=this.getBlockInfo(e.blockId);if(!t)throw new Error("can not find block: blockDataSet.blockId");e.token;var n=Xt(e,["token"]);return t.instance.onCopy(n)},Da.prototype.handleCut=function(e){var t=this.handleCopy(e);return this.deleteBlock(e),t},Da.prototype.handlePaste=function(e){var t=this.blockManager.getBlockCreator(e.blockType);if(!t)throw new Error("Invalid BlockDataSet, blockType: "+e.blockType+" not recognized!");var n=t.onPaste(e),r=(n.token,n.blockId,Xt(n,["token","blockId"]));return Qt({blockId:ln()},r)},Da.prototype.generateBlockContext=function(e){var t=this;return{triggerDelete:function(){},triggerCopy:function(){},updateBlockProps:function(){},setBlockDataSet:function(e){t.editor.setBlockDataSet&&t.editor.setBlockDataSet(e)},getBlockDataSet:function(e){return t.editor.getBlockDataSet?t.editor.getBlockDataSet(e):null}}},Object.defineProperty(Da.prototype,"pure",{get:function(){return this.editor&&this.editor.pure},enumerable:!0,configurable:!0}),Da);function Da(e){var t=e.editor,n=e.blockManager,r=e.isTemplate,i=Na.call(this,{blockManager:n,isTemplate:r,permissions:_a,editor:t})||this;return i.className="SlideAdapter",i.renderBlockAsyncSuc=function(e,t){},i.editor=t,i.bindEvent(),i}var Ba,Pa={readable:!0,editable:!0,commentable:!1,shareable:!1,printable:!1,exportable:!1,copyable:!1},Fa=(Yt(ja,Ba=fa),ja.prototype.resizeHalfFullScreenBlock=function(){},ja.prototype.generateBlockContext=function(e){return{undoDispatcher:this.undoDispatcher}},Object.defineProperty(ja.prototype,"pure",{get:function(){},enumerable:!0,configurable:!0}),ja);function ja(e){var t=Ba.call(this,{blockManager:e.blockManager,isTemplate:e.isTemplate,permissions:Pa,editor:e.editor})||this;return t.className="SheetAdapter",t.renderBlockAsyncSuc=function(e,t){},t.undoDispatcher=e.undoDispatcher,t}var za=Ha;function Ha(e){var t=e.isSyncRender,n=e.usePrerenderPlaceholder,r=Xt(e,["isSyncRender","usePrerenderPlaceholder"]);this.isSyncRender=t,this.usePrerenderPlaceholder=Boolean(n),Object.assign(this,Object(i.a)(r,Object.keys(r)))}},Hj9z:function(e,t,o){var n;window,n=function(){return n=[function(e,t){e.exports=o("q1tI")},function(e,t){e.exports=o("H6oK")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HISTORY_MODE=t.VIEW_RENDERED=t.EMPTY_CHAT_GROUP_IDENTIFIER=t.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT=t.DEFAULT_PERMISSIONS=t.CollaborativeEvents=t.OpStateVersion=t.FAKE_TOKEN=t.RecordChange=t.CollaborativeChange=t.MOBILE_OVER_SIZE_GAP=t.Errors=t.MessageTypes=t.BLOCK_TOOLBAR_HTML_TEMPLATE=t.pastePlaceholderReg=t.BLOCK_REGION_CLOSE_TAG=t.BLOCK_REGION_OPEN_TAG=t.INLINE_BLOCK_CLOSE_HTML=t.INLINE_BLOCK_OPEN_HTML=t.MATCHED_BACKGROUND_COLOR=t.SELECTED_BACKGROUND_COLOR=t.BLOCK_LOADING=t.BLOCK_MENU_WRAPPER=t.BLOCK_EDITBAR_WRAPPER=t.BLOCK_TOOLBAR_WRAPPER=t.BLOCK_DIRTY_NODE=t.DATA_META_BLOCK_PROPS=t.META_BLOCK_PROPS=t.BLOCK_DATA_META_BLOCK_PROPS=t.BLOCK_V_TEXT=t.BLOCK_PASTE_PLACEHOLDER=t.INLINE_BLOCK_PLACEHOLDER=t.BLOCK_REGION=t.BLOCK_PLACEHOLDER=t.BLOCK_CONTAINER=void 0;var r=n(31),i=o(n(89));function o(e){return e&&e.__esModule?e:{default:e}}var a,s,l,c,u,d,f=t.BLOCK_CONTAINER="j-block-container",h=(t.BLOCK_PLACEHOLDER="block-placeholder",t.BLOCK_REGION="block-autonomous-region"),p=(t.INLINE_BLOCK_PLACEHOLDER="inline-block-placeholder",t.BLOCK_PASTE_PLACEHOLDER="block-paste-placeholder"),g=(t.BLOCK_V_TEXT="block-v-text",t.BLOCK_DATA_META_BLOCK_PROPS="dataMetaBlockProps",t.META_BLOCK_PROPS="meta-block-props",t.DATA_META_BLOCK_PROPS="data-meta-block-props",t.BLOCK_DIRTY_NODE="block-dirty",t.BLOCK_TOOLBAR_WRAPPER="block-toolbar-wraper"),v=t.BLOCK_EDITBAR_WRAPPER="block-editbar-wraper",m=t.BLOCK_MENU_WRAPPER="block-menu-wraper";(a=(t.BLOCK_LOADING="block-loading",t.SELECTED_BACKGROUND_COLOR=(0,i.default)(r.R400,.8),t.MATCHED_BACKGROUND_COLOR=(0,i.default)(r.Y400,.96),t.INLINE_BLOCK_OPEN_HTML=['<span data-faketext="" data-contentcollector-ignore-space-at="end">&#8203;</span>','<span class="'+f+'">'].join(""),t.INLINE_BLOCK_CLOSE_HTML=["</span>",'<span data-faketext="" data-contentcollector-ignore-space-at="start">&#8203;</span>'].join(""),t.BLOCK_REGION_OPEN_TAG='<span class="'+h+' ignore-collect">',t.BLOCK_REGION_CLOSE_TAG="</span>",t.pastePlaceholderReg=new RegExp('<span class="'+p+'">[\\s\\S]*?<\\/span>',"gi"),t.BLOCK_TOOLBAR_HTML_TEMPLATE='<div class="'+g+'" contentEditable="false">\n  <div class="'+v+'"></div>\n  <div class="'+m+'"></div>\n</div>',t.MessageTypes=void 0)||(t.MessageTypes={})).USER_NEWINFO="USER_NEWINFO",a.USER_LEAVE="USER_LEAVE",a.CLIENT_VARS="CLIENT_VARS",a.ENGAGEMENT_CURSOR="ENGAGEMENT_CURSOR",a.RESPONSE="RESPONSE",a.ACCEPT_WATCH="ACCEPT_WATCH",a.ACCEPT_COMMIT="ACCEPT_COMMIT",a.REJECT_COMMIT="REJECT_COMMIT",a.NEW_CHANGES="NEW_CHANGES",a.USER_CHANGES="USER_CHANGES",a.CHECK_READY="CHECK_READY",a.SERVER_READY="SERVER_READY",a.USER_COMMENT="USER_COMMENT",a.NEW_COMMENT="NEW_COMMENT",a.MESSAGE_CHANNEL="MESSAGE_CHANNEL",a.ROOM_MEMBERS="ROOM_MEMBERS",a.ERROR="ERROR",(s=(t.Errors=void 0)||(t.Errors={})).ERR_REQUEST_FAIL="1",s.ERR_INVALID_PARAM="2",s.ERR_NOT_FOUND="3",s.ERR_FORBIDDEN="4",s.ERR_LOGIN_REQUIRE="5",s.ERR_DATA_EXCEED_LIMIT="6",s.ERR_OBJECT_DELETED="7",s.ERR_NOT_IN_ROOM="8",s.ERR_UNCHANGE="9",s.ERR_CHANGESET_EXCEED_LIMIT="1001",s.ERR_NOTE_DELETED="1002",s.ERR_NOT_IN_SESSION="1003",s.ERR_NOTE_NOT_EXISTS="1004",s.ERR_CHAGESET_VALID_FAIL="1005",s.ERR_500="1006",s.ERR_MESSAGE_INVALID="1007",s.ERR_SYNC_ALGO_FAIL="1008",s.ERR_RCE_LIVE_SYNC="1009",s.ERR_OLD_VERSION="1010",s.ERR_USER_LIST_SYNC="1011",s.ERR_NO_WRITE_PERMISSION="1012",s.ERR_NO_COMMENT_PERMISSION="1013",s.ERR_LOCK_FAILED="1015",s.ERR_GET_EXACT_NOTE="2001",s.ERROR_RECOVER="ERROR_RECOVER",t.MOBILE_OVER_SIZE_GAP=10,t.CollaborativeChange="COLLABORATIVE_CHANGE",t.RecordChange="RECORD_CHANGE",t.FAKE_TOKEN="faketoken",(l=(t.OpStateVersion=void 0)||(t.OpStateVersion={}))[l.SUCCESS=0]="SUCCESS",l[l.FAIL=1]="FAIL",l[l.VERSION_TOO_LOW=2]="VERSION_TOO_LOW",(c=(t.CollaborativeEvents=void 0)||(t.CollaborativeEvents={})).REV_INIT="REV_INIT",c.CLIENT_VARS="CLIENT_VARS",c.DATA_TABLE="DATA_TABLE",c.SPREAD_LOADED="SPREAD_LOADED",c.SEND_USER_CHANGES="SEND_USER_CHANGES",c.MONITOR_USER_CHANGES="MONITOR_USER_CHANGES",c.NEW_CHANGES="NEW_CHANGES",c.APPLY_ACTIONS="APPLY_ACTIONS",c.APPLY_ACTIONS_LOCAL="APPLY_ACTIONS_LOCAL",c.AFTER_APPLY_ACTIONS="AFTER_APPLY_ACTIONS",c.FETCH_MISS_VERSIONS="FETCH_MISS_VERSIONS",c.SYNC_BASE_REV="SYNC_BASE_REV",c.ACCEPT_COMMIT="ACCEPT_COMMIT",c.REJECT_COMMIT="REJECT_COMMIT",c.LOCAL_CONFLICT="LOCAL_CONFLICT",c.REFETCH_CLIENT_VARS="REFETCH_CLIENT_VARS",c.CONFLICT_HANDLE="CONFLICT_HANDLE",c.SUSPEND_ACTION="SUSPEND_ACTION",c.RESUME_ACTION="RESUME_ACTION",c.PRODUCE_ACTIONS="PRODUCE_ACTIONS",c.ACTIVE_SHEET_CHANGE="ACTIVE_SHEET_CHANGE",c.PRODUCE_RECOVER_ACTION="PRODUCE_RECOVER_ACTION",c.SEND_RECOVER="SEND_RECOVER",c.RECOVER_SUCCESS="RECOVER_SUCCESS",c.RECOVER_ERROR="RECOVER_ERROR",c.ACCEPT_RECOVER="ACCEPT_RECOVER",c.RECEIVE_RECOVER="RECEIVE_RECOVER",c.CONFIRM_RECOVER="CONFIRM_RECOVER",c.RECOVER_SPREAD="RECOVER_SPREAD",c.ERROR="ERROR",c.OFFLINE_SAVE_ERROR="OFFLINE_SAVE_ERROR",c.SYNC_STATUS="SYNC_STATUS",c.CHANNEL_STATE_CHANGE="CHANNEL_STATE_CHANGE",c.FREEZE_SPREAD="FREEZE_SPREAD",c.EDIT_STATE_CHANGE="EDIT_STATE_CHANGE",c.SEND_CURSOR="SEND_CURSOR",c.SEND_COMMENT_CHANGE="SEND_COMMENT_CHANGE",c.ACCEPT_COMMENT_CHANGE="ACCEPT_COMMENT_CHANGE",c.MAX_WIDTH_CHANGE="MAX_WIDTH_CHANGE",c.PASTE="PASTE",c.SET_USERS="SET_USERS",c.USER_NEWINFO="USER_NEWINFO",c.USER_LEAVE="USER_LEAVE",c.ENGAGEMENT_CURSOR="ENGAGEMENT_CURSOR",c.CELL_COORD_CHANGE="CELL_COORD_CHANGE",c.SPANS_CHANGE="SPANS_CHANGE",c.SPREAD_APPEND="APPEND_SPREAD",t.DEFAULT_PERMISSIONS={readable:!0,editable:!0,commentable:!0,shareable:!0,printable:!0,exportable:!0,copyable:!0},(u=(t.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT=void 0)||(t.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT={})).WILL_UPDATE="BLOCK_INSTANCE_HEIGHT_WILL_UPDATE",u.DID_UPDATE="BLOCK_INSTANCE_HEIGHT_DID_UPDATE",t.EMPTY_CHAT_GROUP_IDENTIFIER="none",t.VIEW_RENDERED="VIEW_RENDERED",(d=(t.HISTORY_MODE=void 0)||(t.HISTORY_MODE={})).PLACEHOLDER="PLACEHOLDER",d.PLACEHOLDER_NEW="PLACEHOLDER_NEW",d.CONTENT="CONTENT"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.captureException=t.isJsonString=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return i(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function i(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}t.parseUrl=l,t.getCookie=c,t.getSearch=u,t.openUrl=d,t.getDocBody=f,t.getDocBodyWidth=h;var o=a(n(88));function a(e){return e&&e.__esModule?e:{default:e}}function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=new o.default(e);return{pathname:t.pathname,search:t.query,hash:t.hash}}function c(e){var t=document.cookie.match(new RegExp("(?:^|;)\\s*"+e+"=([^;]+)"));return window.decodeURIComponent(t?t[1]:"")}function u(o){var e=l(window.location.href).search;if(!e)return"";var a="";return e.slice(1).split("&").find(function(e){var t=e.split("="),n=s(t,2),r=n[0],i=n[1];return r===o&&(a=i,!0)}),a}function d(e,t){var n,r,i,o=void 0;t?(n=t.getDocSecureLink,r=t.sendSecLinkClickEvent,e&&n&&(i=n(e),o=window.open(i),r&&r())):o=window.open(e),o&&(o.opener=null)}function f(){return document.querySelector("#outerdocbody .innerdocbody")}function h(){var e=f();if(!e)return 0;var t=window.getComputedStyle(e),n=t.width,r=t.paddingLeft,i=t.paddingRight;return parseFloat(n)-parseFloat(r)-parseFloat(i)}t.isJsonString=function(e){try{if("object"===r(JSON.parse(e)))return!0}catch(e){return!1}return!1},t.captureException=function(t){"function"==typeof window.Slardar&&window.Slardar("Sentry",function(e){e.captureException(new Error(t))})}},function(e,t){e.exports=o("TSYQ")},function(e,t){e.exports=o("i8i4")},function(e,t){e.exports=o("FJEn")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n(14)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(83);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=(i(d,[{key:"notifyWillUpdateImpl",value:function(){var e=this.props.getContext();e.event&&e.event.trigger("blockInstanceWillUpdate",[this.props.getBlockId()])}},{key:"notifyDidUpdateImpl",value:function(){var e=this.props.getContext();e.event&&e.event.trigger("blockInstanceDidUpdate",[this.props.getBlockId()])}},{key:"destroy",value:function(){this.hasCalledWillUpdate&&this.notifyDidUpdateImpl(),this.notifyWillUpdate=r.default,this.notifyDidUpdate=r.default,this.isDestroyed=!0}}]),d);function d(e){var t=this;c(this,d),this.props=e,this.hasCalledWillUpdate=!1,this.isDestroyed=!1,this.hasRequested=!1,this.notifyUpdateOnce=function(){t.notifyUpdate(),t.notifyUpdateOnce=r.default},this.notifyUpdate=function(){t.notifyWillUpdate(),t.notifyDidUpdate()},this.notifyWillUpdate=function(){t.hasCalledWillUpdate||(t.hasCalledWillUpdate=!0,t.notifyWillUpdateImpl())},this.notifyDidUpdate=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!1===t.hasCalledWillUpdate||!0===t.hasRequested)return e.abrupt("return");e.next=2;break;case 2:if((t.hasRequested=!0)===t.props.throttleByRAF)return e.next=6,d.didUpdateAnimationFrame.request({cancelPreviousOne:!1});e.next=6;break;case 6:t.hasRequested=!1,t.hasCalledWillUpdate=!1,t.isDestroyed||t.notifyDidUpdateImpl();case 9:case"end":return e.stop()}},e,t)}))}(t.default=u).didUpdateAnimationFrame=new a.AnimationFrame},function(e,t){e.exports=o("7EGn")},function(e,t,n){"use strict";var r,i;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.resizeContainerClass="block-resizable-container",t.RESIZE_REGION_CLASS="block-resizable-region",t.RESIZE_REGION_SHOW_CLASS="block-resizable-show",t.RESIZE_MODULE_CLASS="block-resize-module",t.sliderClass="resize-slider",(i=(t.BLOCK_RESIZE_EVENT_NAME=void 0)||(t.BLOCK_RESIZE_EVENT_NAME={})).INIT="BLOCK_RESIZE_EVENT_NAME_INIT",i.START="BLOCK_RESIZE_EVENT_NAME_START",i.ING="BLOCK_RESIZE_EVENT_NAME_ING",i.END="BLOCK_RESIZE_EVENT_NAME_END",i.COMMENT_OVERLAY_CHANGE="BLOCK_RESIZE_EVENT_NAME_COMMENT_OVERLAY_CHANGE";var a,s=t.DIRECTION=void 0;(a=s||(t.DIRECTION=s={})).NONE="",a.NORTH="n",a.SOUTH="s",a.WEST="w",a.EAST="e",a.NORTH_WEST="nw",a.SOUTH_EAST="se",a.NORTH_EAST="ne",a.SOUTH_WEST="sw",t.DEFAULT_SIZE={MIN_WIDTH:88,MIN_HEIGHT:88};var l,c,u=t.ResizeType=void 0;(l=u||(t.ResizeType=u={}))[l.None=0]="None",l[l.Flexible=1]="Flexible",l[l.Fixed=2]="Fixed",l[l.LeftRight=3]="LeftRight",l[l.UpDown=4]="UpDown",l[l.Down=5]="Down",(c=(t.SliderType=void 0)||(t.SliderType={}))[c.Point=0]="Point",c[c.Line=1]="Line",t.ResizeTypeDirectionMap=(o(r={},u.None,[]),o(r,u.Flexible,Object.values(s)),o(r,u.Fixed,[s.NORTH_WEST,s.SOUTH_EAST,s.NORTH_EAST,s.SOUTH_WEST]),o(r,u.LeftRight,[s.WEST,s.EAST]),o(r,u.UpDown,[s.NORTH,s.SOUTH]),o(r,u.Down,[s.SOUTH]),r)},function(e,t){e.exports=o("EVdn")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stopPropagation=t.getHandle=t.getAction=t.focusEditor=t.katexManager=t.initStyle=void 0;var i=l(n(95)),o=l(n(14)),r=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=n(31),c=n(1);function l(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=function(){var e="doc-equation-init-style";document.getElementById(e)||$("head").append('\n    <style id="'+e+"\">\n      .block-type-EQUATION_BLOCK {\n        display: inline-block !important;\n        width: auto !important;\n        padding: 0 !important;\n        vertical-align: middle;\n        font-size: 0 !important;\n        text-indent: initial;\n      }\n      .block-type-EQUATION_BLOCK > span {\n        font-size: 16px;\n      }\n      .block-type-EQUATION_BLOCK[class*=\"comment-local-id\"] .equation-view{\n        padding-bottom: 2px;\n      }\n      .equation-view {\n        display: inline-block;\n        min-height: 26px;\n        line-height: 26px;\n        padding: 4px 0;\n        font-size: 14px;\n        vertical-align: middle;\n      }\n      .equation-view-equation-rendered {\n        max-width: calc(~'100% - 8px');\n        min-height: 22px;\n        line-height: 22px;\n        font-size: 0;\n        vertical-align: text-bottom;\n      }\n      .equation-view-loading {\n        position: relative;\n        width: 180px;\n        min-height: 18px;\n        line-height: 18px;\n        padding: 0;\n        vertical-align: text-bottom;\n      }\n      .equation-view-loading::after {\n        content: 'jk';\n        visibility: hidden;\n      }\n      .equation-view-loading-box {\n        position: absolute;\n        display: inline-block;\n        top: 50%;\n        left: 50%;\n        width: 180px;\n        height: 18px;\n        border-radius: 2px;\n        transform: translate(-50%, -50%);\n        background: linear-gradient(90deg, "+s.N200+" 25%, rgba(222, 224, 227, 0.65) 40%, "+s.N200+" 70%);\n        background-size: 400% 100%;\n        animation: equationLoading 1.4s ease infinite;\n      }\n      @keyframes equationLoading {\n        0% {\n          background-position-x: 100%;\n        }\n        100% {\n          background-position-x: 0%;\n        }\n      }\n      .equation-view-container {\n        display: inline-block;\n        min-height: 26px;\n        padding: 2px 4px;\n        white-space: nowrap;\n        transform-origin: left center;\n      }\n      .equation-view.equation-view-placeHoldered,\n      .equation-view.equation-view-errored.equation-view-equation-rendered {\n        line-height: 26px;\n        vertical-align: baseline;\n      }\n      .equation-view-errored .equation-view-container {\n        display: none;\n      }\n      .equation-view-error,\n      .equation-view-placeHolder {\n        height: 26px;\n        padding: 0 12px;\n        border-radius: 4px;\n        font-size: 14px;\n        white-space: nowrap;\n        background: "+s.N200+";\n        color: "+s.N600+";\n      }\n      .equation-view-error i {\n        position: relative;\n        display: inline-block;\n        width: 12px;\n        height: 12px;\n      }\n      .equation-view-error svg {\n        position: absolute;\n        top: 7px;\n        left: 50%;\n        transform: translate(-50%, -50%);\n      }\n      .equation-view-error span {\n        margin-left: 4px;\n        color: "+s.N900+";\n      }\n      .equation-view .katex {\n        font-size: 18px;\n        font-family: KaTeX_Main;\n        color: "+s.N900+";\n        vertical-align: middle;\n      }\n      .katex-display {\n        margin: 0;\n      }\n      .katex-html {\n        display: inline-block;\n      }\n      .doc-new-layout .equation-view {\n        padding: 0;\n      }\n      .doc-new-layout .equation-view-equation-rendered {\n        vertical-align: 8px;\n      }\n      .maindocbody > .ace-line:first-child .equation-view,\n      .ace-table .equation-view,\n      .list-div .equation-view {\n        vertical-align: middle;\n      }\n      .equation-view-mobile.equation-view-equation-rendered {\n        max-width: 100%;\n        vertical-align: middle;\n      }\n    </style>\n  ")};function h(){var t,r=this;d(this,h),this.set=o.default,this.install=(t=u(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.relKatex&&(0,i.default)(t))return e.next=3,t();e.next=6;break;case 3:n=e.sent,r.relKatex=n,r.set(n);case 6:case"end":return e.stop()}},e,r)})),function(e){return t.apply(this,arguments)}),this.katex=new Promise(function(e){r.set=e})}var p=(r(h,[{key:"get",value:function(){return this.katex}},{key:"getRelKatex",value:function(){return this.relKatex}},{key:"isLoaded",value:function(){return!!this.relKatex}}]),new h),g=function(e,t){var n,r,i,o,a,s,l=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];e&&e.editable&&((n=e.domToRep(t.closest("."+c.BLOCK_PLACEHOLDER)))&&(r=n.selStart,i=n.selEnd,o=r[2],a=[i[0],i[1]],s=l?a:[r[0],r[1]],e.inCallStackIfNecessary("focusEquationLast",function(){e.performSelectionChange(o,s,a)}),e.updateBrowserSelectionFromRep(!0)))},v=function(e){return e?"on":"off"},m=function(e){return e?"addEventListener":"removeEventListener"},y=function(e){e.stopPropagation()};t.initStyle=f,t.katexManager=p,t.focusEditor=g,t.getAction=v,t.getHandle=m,t.stopPropagation=y},function(e,t){e.exports=o("m/+l")},function(e,t,n){"use strict";var r,i,o,a,s;Object.defineProperty(t,"__esModule",{value:!0}),(r=(t.FieldType=void 0)||(t.FieldType={}))[r.NotSupport=0]="NotSupport",r[r.Text=1]="Text",r[r.Number=2]="Number",r[r.SingleSelect=3]="SingleSelect",r[r.MultiSelect=4]="MultiSelect",r[r.DateTime=5]="DateTime",(i=(t.JiraCollabAction=void 0)||(t.JiraCollabAction={})).SET_VIEW="SET_VIEW",i.SET_VIEW_TYPE="SET_VIEW_TYPE",i.SET_VIEW_NAME="SET_VIEW_NAME",i.SET_FIELD_VISIBLE="SET_FIELD_VISIBLE",i.SET_VIEW_RECORDS="SET_VIEW_RECORDS",i.SET_VIEW_EX_INFO="SET_VIEW_EX_INFO",i.MOVE_VIEW="MOVE_VIEW",i.MOVE_FIELD="MOVE_FIELD",i.MOVE_RECORD="MOVE_RECORD",i.REMOVE_VIEW="REMOVE_VIEW",(o=(t.ActionType=void 0)||(t.ActionType={})).SET="SET",o.MOVE="MOVE",o.REMOVE="REMOVE",(a=(t.Type=void 0)||(t.Type={})).Issue="issue",a.Filter="filter",(s=(t.AuthState=void 0)||(t.AuthState={}))[s.HAS_NOT_FETCH=-2]="HAS_NOT_FETCH",s[s.FETCH_FAIL=-1]="FETCH_FAIL",s[s.NO_JIRA=0]="NO_JIRA",s[s.OPEN_JIRA=1]="OPEN_JIRA",s[s.WITHIN_JIRA=2]="WITHIN_JIRA",s[s.HAS_CONNECTED=3]="HAS_CONNECTED"},function(e,t){e.exports=o("ifKl")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=r(n(0)),o=r(n(124));function r(e){return e&&e.__esModule?e:{default:e}}var i=function(e){var t=e.bgColor,a=void 0===t?"":t,n=e.activeBgColor,s=void 0===n?"":n,l=e.activeKey,r=e.context,c=void 0===r?[]:r,i=e.children,u=e.isSelected;if(0===c.length)return i;var d=0,f=[],h=(0,o.default)(i);return c.forEach(function(e,t){var n=h.slice(d,e.start);n&&f.push(n);var r,i=e.key===l&&u?s:a,o=p.default.createElement("span",{style:{backgroundColor:i},key:e.key},h.slice(e.start,e.end));f.push(o),t===c.length-1&&(r=h.slice(e.end))&&f.push(r),d=e.end}),f};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotifyHeightUpdateOnMount=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e){a(this,c);var t=s(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e));return t.props.notifier.notifyWillUpdate(),t}t.NotifyHeightUpdateOnMount=(l(c,o.Component),r(c,[{key:"componentDidMount",value:function(){this.props.notifier.notifyDidUpdate()}},{key:"render",value:function(){return this.props.children}}]),c)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalDOMEventEmitter=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=a(n(18));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e){s(this,l),this.element=e,this.eventEmitter=new o.default,this.elementHandlerMap=new Map}(t.GlobalDOMEventEmitter=(r(l,[{key:"on",value:function(e,t){this.eventEmitter.on(e,t),this.addEventListenerToElementIfNeeded(e)}},{key:"off",value:function(e,t){this.eventEmitter.off(e,t),this.removeEventListenerFromElementIfNeeded(e)}},{key:"addEventListenerToElementIfNeeded",value:function(t){var e,n=this;this.elementHandlerMap.has(t)||(e=function(e){n.eventEmitter.emit(t,e)},this.elementHandlerMap.set(t,e),this.element.addEventListener(t,e))}},{key:"removeEventListenerFromElementIfNeeded",value:function(e){var t;0<this.eventEmitter.getListeners(e).length||!this.elementHandlerMap.has(e)||(t=this.elementHandlerMap.get(e),this.elementHandlerMap.delete(e),this.element.removeEventListener(e,t))}}],[{key:"get",value:function(e){return this.elementEventEmitterMap.has(e)||this.elementEventEmitterMap.set(e,new l(e)),this.elementEventEmitterMap.get(e)}}]),l)).elementEventEmitterMap=new WeakMap},function(e,t){e.exports=o("4O8T")},function(e,t){e.exports=o("XIp8")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JIRA_ID={KEY:"key",SUMMARY:"summary",TYPE:"issuetype",STATUS:"status",PRIORITY:"priority",ASSIGNEE:"assignee",UPDATED:"updated",DESC:"description",REPORTER:"reporter",CREATED:"created",PROJECT:"project",LABEL:"labels",AFFECTED:"versions",COMPONENTS:"components",CREATOR:"creator",DUEDATE:"duedate",ENVIRONMENT:"environment",FIXED:"fixVersions",RESOLVED:"resolutiondate",RESOLUTION:"resolution",ORIGINAL:"timeoriginalestimate",REMAINING:"timeestimate",SPENT:"timespent",VOTES:"votes",WATCHERS:"watches",WORKRATIO:"workratio"},t.SYNC_INTERVAL=144e5},function(e,t){e.exports=o("3Hq1")},function(e,t){e.exports=o("hbEN")},function(e,t){e.exports=o("Muja")},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=(t.PollType=void 0)||(t.PollType={})).single="single",r.multiple="multiple"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initStyle=t.getJiraType=t.isEditable=t.getDefaultJiraIssueRecord=void 0;var i=s(n(19)),o=s(n(71));t.filterRecord=c,t.insertSelectOption=u;var a=n(13),r=n(31);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function c(e){var t,n,r=(0,i.default)(e);for(t in r)r.hasOwnProperty(t)&&((n=r[t]).fieldType!==a.FieldType.SingleSelect&&n.fieldType!==a.FieldType.MultiSelect||!(0,o.default)(n.property)||delete r[t]);return r}function u(e,t){return e.property||(e.property={options:{}}),e.property.options.selectOptions||(e.property.options.selectOptions=[]),Object.assign({},e,{property:Object.assign({},e.property,{options:Object.assign({},e.property.options,{selectOptions:[].concat(l(e.property.options.selectOptions),[{name:t,id:t,color:e.property.options.selectOptions.length+1}])})})})}t.getDefaultJiraIssueRecord=function(){return{jiraIssueId:"",isDelete:!1,issueKey:"",typeIconUrl:"",lastSyncTime:0,linkUrl:"",issueRecordMap:{}}},t.isEditable=function(e,t){return!!e&&!t.Helpers.browser.mobile&&e&&e.editable},t.getJiraType=function(e){var t=e.Redux,n=t.store,r=t.selectors.selectJiraAuthStatus;if(r)return r(n.getState()).jiraType},t.initStyle=function(){var e="doc-jira-issue-init-style";document.getElementById(e)||$("head").append('\n    <style id="'+e+'">\n      .block-type-JIRA_ISSUE_BLOCK .inline-mode {\n        display: inline-flex;\n        vertical-align: text-top;\n        padding: 0 4px;\n      }\n\n      .block-type-JIRA_ISSUE_BLOCK .block-inline-placeholder {\n        margin-right: 4px;\n        width: 16px;\n        height: 16px;\n        border-radius: 1px;\n        background-image: linear-gradient(to right, fade('+r.N300+", 40%) 0%, fade("+r.N300+", 70%) 99%);\n      }\n\n      .block-type-JIRA_ISSUE_BLOCK .block-inline-placeholder-expand {\n        width: 160px;\n        height: 16px;\n        border-radius: 1px;\n        background: linear-gradient(90deg, "+r.N200+" 25%, fade("+r.N300+", 65%) 40%, "+r.N200+" 70%);\n        background-size: 400% 100%;\n        animation: jiraIssueLoading 1.4s ease infinite;\n      }\n\n      @keyframes jiraIssueLoading {\n        0% {\n          background-position-x: 100%;\n        }\n        100% {\n          background-position-x: 0%;\n        }\n      }\n    </style>\n  ")}},function(e,t,n){"use strict";var r,i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.pinTopMenuStyle=t.defaultMenuStyle=t.FILTER_DEFAULT_FIELD_MAP=t.collabActionPathMap=t.FIELD_ID=t.VIEW_ID=t.JIRA_FILTER_COMMENT_HIGHLIGHT_EVENT=t.JIRA_FILTER_SYNC_EVENT=t.JIRA_FILTER_LOADING_EVENT=t.JIRA_FILTER_COLLAB_EVENT=void 0;var s=n(20),l=n(13);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.JIRA_FILTER_COLLAB_EVENT="JIRA_FILTER_COLLAB_EVENT",t.JIRA_FILTER_LOADING_EVENT="JIRA_FILTER_LOADING_EVENT",t.JIRA_FILTER_SYNC_EVENT="JIRA_FILTER_SYNC_EVENT",t.JIRA_FILTER_COMMENT_HIGHLIGHT_EVENT="JIRA_FILTER_COMMENT_HIGHLIGHT_EVENT";var u=t.VIEW_ID="VIEW_ID",d=t.FIELD_ID="FIELD_ID",f="SORT_INDEX",h="OTHER_PATH",p=(c(r={},l.JiraCollabAction.SET_VIEW_TYPE,{path:["viewInfo","type"]}),c(r,l.JiraCollabAction.SET_VIEW,{path:["viewInfo","viewMap",u]}),c(r,l.JiraCollabAction.SET_VIEW_NAME,{key:"name",path:["viewInfo","viewMap",u,"name"]}),c(r,l.JiraCollabAction.SET_FIELD_VISIBLE,{key:"fieldVisibleMap",path:["viewInfo","viewMap",u,"fieldVisibleMap",d]}),c(r,l.JiraCollabAction.SET_VIEW_RECORDS,{path:["viewInfo","viewMap",u,"records"]}),c(r,l.JiraCollabAction.SET_VIEW_EX_INFO,{key:"exInfo",path:["viewInfo","viewMap",u,"exInfo",h]}),r),g=(c(i={},l.JiraCollabAction.MOVE_VIEW,{key:"views",path:["viewInfo","views",f]}),c(i,l.JiraCollabAction.MOVE_FIELD,{key:"fields",path:["viewInfo","viewMap",u,"fields",f]}),c(i,l.JiraCollabAction.MOVE_RECORD,{key:"records",path:["viewInfo","viewMap",u,"records",f]}),i),v=c({},l.JiraCollabAction.REMOVE_VIEW,{key:"viewMap",path:["viewInfo","viewMap",u]});t.collabActionPathMap=(c(o={},l.ActionType.SET,p),c(o,l.ActionType.MOVE,g),c(o,l.ActionType.REMOVE,v),o),t.FILTER_DEFAULT_FIELD_MAP=(c(a={},s.JIRA_ID.KEY,{sort:0,visible:!0}),c(a,s.JIRA_ID.SUMMARY,{sort:1,visible:!0}),c(a,s.JIRA_ID.TYPE,{sort:2,visible:!0}),c(a,s.JIRA_ID.STATUS,{sort:3,visible:!0}),c(a,s.JIRA_ID.PRIORITY,{sort:4,visible:!0}),c(a,s.JIRA_ID.ASSIGNEE,{sort:5,visible:!0}),c(a,s.JIRA_ID.UPDATED,{sort:6,visible:!0}),c(a,s.JIRA_ID.DESC,{sort:7,visible:!1}),c(a,s.JIRA_ID.REPORTER,{sort:8,visible:!1}),c(a,s.JIRA_ID.CREATED,{sort:9,visible:!1}),c(a,s.JIRA_ID.PROJECT,{sort:10,visible:!1}),c(a,s.JIRA_ID.LABEL,{sort:11,visible:!1}),a),t.defaultMenuStyle={position:"relative",top:17,transform:"none","z-index":5,left:"20px"},t.pinTopMenuStyle={top:81,position:"fixed",transform:"translateX(20px)","z-index":5,left:"unset"}},function(e,t,n){"use strict";var r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),(r=(t.DiagramEvents=void 0)||(t.DiagramEvents={})).OPEN_VIEWER="open_diagram_image_viewer",r.EXIT_GRAPH_EDITOR="exit_graph_editor",r.DELETE_DIAGRAM_BLOCK="delete_diagram_block",(i=(t.DiffType=void 0)||(t.DiffType={})).REMOVE="remove",i.REPLACE="replace",i.ADD="add",(o=(t.DiagramType=void 0)||(t.DiagramType={})).FLOWCHART="flowchart",o.UML="uml"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configs=t.urlReg=t.ACTION_LAYER_HOVER_CLASS=t.ACTION_LAYER_FOCUS_CLASS=t.ACTION_LAYER_CLASS=t.BLANK_URL=void 0;var b=o(n(86)),E=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var i=n(9),k=n(38);function o(e){return e&&e.__esModule?e:{default:e}}t.BLANK_URL="about:blank",t.ACTION_LAYER_CLASS="iframe-overlayer",t.ACTION_LAYER_FOCUS_CLASS="iframe-overlayer-focus",t.ACTION_LAYER_HOVER_CLASS="iframe-overlayer-hover",t.urlReg=/^((https?|http|ftp):\/\/)?[-a-zA-Z0-9:%._+~#=]{2,256}\.(com|org|net|edu|gov|aero|app|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|travel|arpa|asia|xxx|google|[a-z][a-z])\b([-a-zA-Z0-9@:%_+.~#?&\/\/=;()$,!]*)$/,t.configs=[{type:"youtube",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/www\.youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)$/,/^https:\/\/youtu\.be\/([a-zA-Z0-9\-_]+)$/,/^https:\/\/www\.youtube\.com\/watch\?[^\s#]*&?v=([a-zA-Z0-9\-_]+)&?[^\s]*$/,/^https:\/\/www\.youtube\.com\/embed\/([a-zA-Z0-9\-_]+)$/],templateFunc:function(e){return"https://www.youtube.com/embed/"+e[1]},border:!0},{type:"bilibili",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/www\.bilibili\.com\/video\/av(\w+)/,/^https:\/\/player\.bilibili\.com\/player\.html\?aid=(\d+)$/],templateFunc:function(e){return"https://player.bilibili.com/player.html?aid="+e[1]},border:!0},{type:"bilibilip",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/www\.bilibili\.com\/video\/av(\w+)\?([^\s]+)?/,/^https:\/\/player\.bilibili\.com\/player\.html\?aid=(\d+)&?([^\s]+)?$/],templateFunc:function(e){return"https://player.bilibili.com/player.html?aid="+e[1]+"&"+e[2]},border:!0},{type:"bilibili-bv",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/www\.bilibili\.com\/video\/bv(\w+)/i,/^https:\/\/player\.bilibili\.com\/player\.html\?bvid=(\d+)$/],templateFunc:function(e){return"https://player.bilibili.com/player.html?bvid="+e[1]},border:!0},{type:"airtable",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/airtable\.com\/shr([a-zA-Z0-9]+)[^\s]*$/,/^https:\/\/airtable\.com\/embed\/shr([a-zA-Z0-9]+)\?backgroundColor=green&viewControls=on$/],templateFunc:function(e){return"https://airtable.com/embed/shr"+e[1]+"?backgroundColor=purple&viewControls=on"},border:!0,defaultHeight:534},{type:"datastudio",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/datastudio\.google\.com\/embed\/reporting.+/],templateFunc:function(e){return e.input}},{type:"ad",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/ad\.bytedance\.net\/kompaso\/page\/dashboard\/share\/[^\s#]*&?id=(\d+)&?[^\s]*/,/^https:\/\/compass-sg\.bytedance\.net\/kompaso\/page\/dashboard\/share\/[^\s#]*&?id=(\d+)&?[^\s]*$/,/^https:\/\/compass-va\.bytedance\.net\/compass\/report\/dashboardv2\/share\/[^\s#]*&?id=(\d+)&?[^\s]*$/],templateFunc:function(e){return e.input}},{type:"youku",resizeType:i.ResizeType.Fixed,pattern:[/^http(s)?:\/\/v\.youku\.com\/v_show\/id_([a-zA-Z0-9=]+)\.html[^\s]*$/,/^http(s)?:\/\/player\.youku\.com\/embed\/([a-zA-Z0-9=]+)$/],templateFunc:function(e){return"https://player.youku.com/embed/"+e[2]}},{type:"baidumap",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/(j\.)?map(s)?\.baidu\.com\/[^\s]+$/,/^https:\/\/ditu\.baidu\.com\/[^\s]+$/],templateFunc:function(e){return e.input},lazyload:!0,renderLinkInMobile:!0},{type:"autonavi",resizeType:i.ResizeType.Flexible,pattern:[/^http(s)?:\/\/surl\.amap\.com\/([A-z0-9/]+)$/,/^http(s)?:\/\/((ditu)|(www))\.amap\.com\/([a-zA-Z0-9=/_&@,?%#.();:]+)$/,/^https?:\/\/gaode\.com\/place\/([A-z0-9/]+)$/],templateFunc:function(e){return e.input},lazyload:!0,renderLinkInMobile:!0},{type:"gmaps",resizeType:i.ResizeType.Flexible,pattern:[/^https?:\/\/(www\.)?google\.[a-z.]+\/maps\/place\/(.+)$/,/^https:\/\/www\.google\.com\/maps\/embed\/v1\/place\?key=.+$/,/^https?:\/\/(www\.)?google\.[a-z.]+\/maps\/@(.+)$/,/^https:\/\/www\.google\.com\/maps\/embed\/v1\/view\?key=.+$/],templateFunc:function(e){if(/^https:\/\/www\.google\.com\/maps\/embed\/v1\/place.+$/.test(e.input)||/^https:\/\/www\.google\.com\/maps\/embed\/v1\/view\?key=.+$/.test(e.input))return e.input;var t=e.input,n=e[2];if(t.includes("place")){var r,i,o,a,s,l=n.split("/"),c=E(l,2),u=c[0],d=c[1],f="";return d&&(r=d.substring(1).split(","),o=(i=E(r,3))[0],a=i[1],s=i[2],isNaN(+o)||isNaN(+a)||(f="&center="+o+","+a+"&zoom="+s)),"https://www.google.com/maps/embed/v1/place?key="+(0,k.getGoogleApiKey)()+"&q="+u+f+"&language=en"}var h=e[2],p=(0,b.default)(h,function(e){return"?"!==e}).join("").split(","),g=E(p,3),v=g[0],m=g[1],y=g[2];return"https://www.google.com/maps/embed/v1/view?key="+(0,k.getGoogleApiKey)()+"&center="+v+","+m+"&zoom="+y+"&language=en"}},{type:"xigua",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/www\.ixigua\.com\/(.+)$/,/^https:\/\/www\.365yg\.com\/(.+)$/],templateFunc:function(e){return e.input},renderLinkInIOS:!0,border:!0},{type:"tiktok",resizeType:i.ResizeType.Fixed,pattern:[/^http(s)?:\/\/vm\.tiktok\.com\/(.+)$/,/^http(s)?:\/\/vt\.tiktok\.com\/(.+)$/,/^http(s)?:\/\/t\.tiktok\.com\/i18n\/share\/video\/(.+)$/,/^http(s)?:\/\/www\.tiktok\.com\/embed\/(.+)$/,/^http(s)?:\/\/www\.tiktok\.com\/@[^\s]+\/video\/(.+)$/],templateFunc:function(e){return e.input},defaultWidth:325,defaultHeight:850,renderLinkInIOS:!0},{type:"says",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/getsays\.cn\/share\/([0-9a-z]{32}[^\s]*)/i],templateFunc:function(e){return"https://getsays.cn/embed/"+e[1]},copyable:!0},{type:"survey",resizeType:i.ResizeType.Fixed,pattern:[/^http(s)?:\/\/kariya-stage\.bytedance\.net\/m?[^\s#]*&?t=([0-9a-z-]+)[^\s]*$/i,/^http(s)?:\/\/kariya-stage\.bytedance\.net\/m\/cfm?[^\s#]*&?t=([0-9a-z-]+)[^\s]*$/i],templateFunc:function(e){return"https://kariya-stage.bytedance.net/m/cfm?t="+e[2]},border:!0,defaultHeight:500},{type:"figma",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/www\.figma\.com\/((file|proto)\/[0-9a-zA-Z]{22,128}(\/.*)?)$/,/^https:\/\/www\.figma\.com\/embed\?embed_host=share&url=https:\/\/www\.figma\.com\/([a-zA-Z0-9=/_&?%#-]+)$/],templateFunc:function(e){return"https://www.figma.com/embed?embed_host=share&url=https://www.figma.com/"+e[1]},border:!0,renderLinkInMobile:!0},{type:"trello",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/trello\.com\/c\/(.+)?$/,/^https:\/\/trello\.com\/embed\/card\?id=(.+)$/],templateFunc:function(e){return"https://trello.com/embed/card?id="+e[1]},renderLinkInMobile:!0},{type:"vimeo",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/vimeo\.com\/(.+)\/?$/,/^https:\/\/player\.vimeo\.com\/video\/(\w+)$/],templateFunc:function(e){return"https://player.vimeo.com/video/"+e[1]}},{type:"instagram",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/www\.instagram\.com\/p\/(\w+)\/?$/,/^https:\/\/www\.instagram\.com\/p\/(\w+)\/embed\/captioned\/?$/],templateFunc:function(e){return"https://www.instagram.com/p/"+e[1]+"/embed/captioned/"},renderLinkInMobile:!0},{type:"facebook",resizeType:i.ResizeType.Fixed,pattern:[/^(https:\/\/www\.facebook\.com\/[^/]+\/(posts|videos)\/.+\/?)$/,/^https:\/\/www\.facebook\.com\/plugins\/post\.php\?href=(https:\/\/www\.facebook\.com\/[^/]+\/(posts|videos)\/.+\/?)$/],templateFunc:function(e){return"https://www.facebook.com/plugins/post.php?href="+e[1]},renderLinkInMobile:!0},{type:"googleDrive",resizeType:i.ResizeType.Flexible,pattern:[/^https?:\/\/docs\.google\.com\/([^/]+\/[^.]+.[^/]+\/)?(document|spreadsheets|presentation|forms)\/d\/([^/]+)/],templateFunc:function(e){var t=e[2],n=e.input;switch(t){case"document":/\/pub\/?$/.test(n)&&(n+="?embedded=true");break;case"spreadsheets":/\/pubhtml\/?$/.test(n)&&(n+="?widget=true&amp;headers=false");break;case"presentation":n=n.replace(/\/pub/,"/embed");break;case"forms":n=e[0]+"/viewform?embedded=true"}return n},renderLinkInMobile:!0},{type:"oneDrive",resizeType:i.ResizeType.Flexible,pattern:[/^https?:\/\/onedrive\.live\.com\/\w+\.aspx\?(.+)\/?$/,/^https:\/\/onedrive\.live\.com\/embed\?(.+)&em=2$/],templateFunc:function(e){return"https://onedrive.live.com/embed?"+e[1].replace(/&amp;/g,"&")+"&em=2"},renderLinkInMobile:!0},{type:"openStreetMap",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/www\.openstreetmap\.org\/export\/embed\.html.+$/],templateFunc:function(e){return e.input},renderLinkInMobile:!0},{type:"marvelapp",resizeType:i.ResizeType.Flexible,pattern:[/^https?:\/\/marvelapp\.com\/.+\/?$/],templateFunc:function(e){return e.input},renderLinkInMobile:!0},{type:"prezi",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/prezi\.com\/view\/([^/]+)\/?$/,/^https:\/\/prezi\.com\/view\/([^/]+)\/embed$/],templateFunc:function(e){return"https://prezi.com/view/"+e[1]+"/embed"},renderLinkInMobile:!0},{type:"soundcloud",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/w\.soundcloud\.com\/player\/?\?url=.+$/],templateFunc:function(e){return e.input},renderLinkInMobile:!0},{type:"spotify",resizeType:i.ResizeType.Fixed,pattern:[/^https:\/\/open\.spotify\.com\/track\/(.+)\/?$/,/^https:\/\/open\.spotify\.com\/embed\?uri=spotify:track:(.+)$/],templateFunc:function(e){return"https://open.spotify.com/embed?uri=spotify:track:"+e[1]},renderLinkInMobile:!0},{type:"pastebin",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/pastebin\.com\/(.+)\/?$/,/^https:\/\/pastebin\.com\/embed_iframe\/(.+)$/],templateFunc:function(e){return"https://pastebin.com/embed_iframe/"+e[1]},renderLinkInMobile:!0},{type:"lucidchart",resizeType:i.ResizeType.Flexible,pattern:[/^https?:\/\/www\.lucidchart\.com\/documents\/embeddedchart\/(.+)\/?$/],templateFunc:function(e){return e.input},renderLinkInMobile:!0},{type:"drawIO",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/www\.draw\.io\/?\?.+$/],templateFunc:function(e){return e.input},renderLinkInMobile:!0},{type:"slideshare",resizeType:i.ResizeType.Flexible,pattern:[/^((https?:)?\/\/www\.slideshare\.net\/slideshow\/embed_code\/key\/\w+)$/],templateFunc:function(e){return e[1]},renderLinkInMobile:!0},{type:"haikudeck",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/(www\.)?haikudeck\.com\/p\/(.+)\/?$/,/^https:\/\/www\.haikudeck\.com\/e\/(.+)$/],templateFunc:function(e){return"https://www.haikudeck.com/e/"+e[2]},renderLinkInMobile:!0},{type:"upscribe",resizeType:i.ResizeType.Fixed,pattern:[/^https?:\/\/upscri\.be\/(.+)\/?$/,/^https:\/\/upscri\.be\/[^?]+\?as_embed$/],templateFunc:function(e){return"https://upscri.be/"+e[1]+"?as_embed"},renderLinkInMobile:!0},{type:"wenjuan",resizeType:i.ResizeType.UpDown,pattern:[/^https?:\/\/wj\.toutiao\.com\/q\/(.+)$/,/^https?:\/\/wj\.bytedance\.com\/q\/(.+)$/],templateFunc:function(e){return e.input},defaultHeight:320,border:!0},{type:"indify",resizeType:i.ResizeType.UpDown,pattern:[/^https?:\/\/indify\.co\/widgets\/live\/(.+)$/],templateFunc:function(e){return e.input},renderLinkInMobile:!0},{type:"modao",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/modao\.cc\/app\/([0-9a-zA-Z]+)[^\s]*$/],templateFunc:function(e){return"https://modao.cc/app/"+e[1]+"/embed/v2"},border:!0,renderLinkInMobile:!0},{type:"canva",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/www.canva.cn\/design\/([0-9a-zA-Z]+)\/[^\s]*/],templateFunc:function(e){return"https://www.canva.cn/design/"+e[1]+"/view?embed"},border:!0,renderLinkInIOS:!0},{type:"codepen",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/codepen.io\/([0-9a-zA-Z]+)\/pen\/([0-9a-zA-Z]+[^\s]*)/],templateFunc:function(e){return"https://codepen.io/"+e[1]+"/embed/"+e[2]},border:!0},{type:"jinshuju",resizeType:i.ResizeType.Flexible,pattern:[/^(https:\/\/jinshuju\.net\/(f|forms)\/[0-9a-zA-Z]+)[^\s]*/],templateFunc:function(e){return e[1]+"?background=white&banner=show&embedded=true&inner_redirect=false"},border:!0},{type:"feishu_survey",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/wenjuan\.feishu\.cn\/m\?[^\s]+/],templateFunc:function(e){return e.input},border:!0,defaultHeight:500,renderLinkInIOS:!0},{type:"lark_survey",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/survey\.larksuite\.com\/m\/\?[^\s]+/],templateFunc:function(e){return e.input},border:!0,defaultHeight:500,renderLinkInIOS:!0},{type:"tea_bulletin",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/data\.bytedance\.net\/tea\/app\/\d+\/dashboard\/\d+/],templateFunc:function(e){return e.input+"?hideAppHeader&hideDashLeft"},border:!0,renderLinkInMobile:!0},{type:"tea_bulletin_suffix",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/data\.bytedance\.net\/tea\/app\/\d+\/dashboard\/\d+\?[^\s]+/],templateFunc:function(e){return e.input+"&hideAppHeader&hideDashLeft"},border:!0,renderLinkInMobile:!0},{type:"tea_report",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/data\.bytedance\.net\/tea\/app\/\d+\/share-link\/report\?dashboardId=\d+[^\s#]+reportId=\d+[^\s]*/],templateFunc:function(e){return e.input},border:!0,renderLinkInMobile:!0},{type:"aeolus",resizeType:i.ResizeType.Flexible,pattern:[/^https:\/\/data\.bytedance\.net\/aeolus\/(\?from=[a-zA-Z_]+)?#(\/external)?\/dashboard\/[0-9]+\?appId=.*/,/^https:\/\/data\.bytedance\.net\/aeolus\/#(\/external)?\/dashboard\/[0-9]+\/[0-9]+\?appId=.*/,/^https:\/\/data\.bytedance\.net\/aeolus\/\?from=[a-zA-Z_]+#(\/external)?\/dashboard\/[0-9]+\/[0-9]+\?appId=.*/,/^https:\/\/aeolus-va\.bytedance\.net\/(\?from=[a-zA-Z_]+)?#(\/external)?\/dashboard\/[0-9]+\?appId=.*/,/^https:\/\/aeolus-va\.bytedance\.net\/(\?from=[a-zA-Z_]+)?#(\/external)?\/dashboard\/[0-9]+\/[0-9]+\?appId=.*/,/^https:\/\/aeolus-sg\.bytedance\.net\/(\?from=[a-zA-Z_]+)?#(\/external)?\/dashboard\/[0-9]+\?appId=.*/,/^https:\/\/aeolus-sg\.bytedance\.net\/(\?from=[a-zA-Z_]+)?#(\/external)?\/dashboard\/[0-9]+\/[0-9]+\?appId=.*/],templateFunc:function(e){return e.input},border:!0,renderLinkInMobile:!0},{type:"tiktokCode",resizeType:i.ResizeType.Fixed,pattern:[/^<iframe.+src="(https:\/\/www\.tiktok\.com\/embed\/[^"]+)[^>]+><\/iframe>$/],templateFunc:function(e){return e[1]},code:!0},{type:"trelloCode",resizeType:i.ResizeType.Fixed,pattern:[/^<blockquote\sclass="trello-card"><a\shref="https?:\/\/trello\.com\/c\/(.+)">.+<\/a><\/blockquote><script\ssrc=".+"><\/script>$/],templateFunc:function(e){return"https://trello.com/embed/card?id="+e[1]},code:!0},{type:"vimeoCode",resizeType:i.ResizeType.Fixed,pattern:[/^<iframe\ssrc="(https:\/\/player\.vimeo\.com[^"]+)".+><\/iframe>\n?(<p>.+<\/p>)?$/],templateFunc:function(e){return e[1]},code:!0},{type:"instagramCode",resizeType:i.ResizeType.Fixed,pattern:[/^<blockquote.+data-instgrm-permalink="https:\/\/www.instagram.com\/p\/([^/]+)\/[^>]+>[\s\S]+<\/blockquote>\s?<script.+src=".+www\.instagram\.com\/embed\.js"><\/script>$/],templateFunc:function(e){return"https://www.instagram.com/p/"+e[1]+"/embed/captioned/"},code:!0},{type:"facebookCode",resizeType:i.ResizeType.Fixed,pattern:[/^<iframe\ssrc="(https:\/\/www.facebook.com\/plugins\/post.php[^"]+)"[^>]+><\/iframe>$/],templateFunc:function(e){return e[1]},code:!0},{type:"googleDriveCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe.+src="(https:\/\/docs\.google\.com\/([^/]+\/[^.]+.[^/]+\/)?(?:document|spreadsheets|presentation|forms)[^"]+)"[^>]*><\/iframe>$/],templateFunc:function(e){return e[1]},code:!0},{type:"datastudioCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe.+src="(https:\/\/datastudio\.google\.com\/embed\/reporting\/[^"]+)"[^>]+><\/iframe>$/],templateFunc:function(e){return e[1]},code:!0},{type:"openstreetmapCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe.+src="(https:\/\/www\.openstreetmap\.org\/export\/embed\.html[^"]+)"[^>]+><\/iframe>(|<br\/><small><a[^>]+>.+<\/a><\/small>)?$/],templateFunc:function(e){return e[1]},code:!0},{type:"figmaCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe.+src="(https:\/\/www.figma.com\/embed[^"]+)"[^>]+><\/iframe>$/],templateFunc:function(e){return e[1]},border:!0,code:!0,renderLinkInMobile:!0},{type:"soundcloudCode",resizeType:i.ResizeType.Fixed,pattern:[/^<iframe.+src="(https:\/\/w\.soundcloud\.com\/player\/\?[^"]+)"><\/iframe>/],templateFunc:function(e){return e[1]},code:!0},{type:"pastebinCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe\ssrc="(https:\/\/pastebin\.com\/embed_iframe\/[^"]+)"[^>]+><\/iframe>$/],templateFunc:function(e){return e[1]},code:!0},{type:"lucidchartCode",resizeType:i.ResizeType.Flexible,pattern:[/^(?:<div[^>]*>)?<iframe.+src="(https:\/\/www\.lucidchart\.com\/documents\/embeddedchart\/[^"]+)"[^>]+><\/iframe>(<\/div>)?$/],templateFunc:function(e){return e[1]},code:!0},{type:"drawIOCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe.+src="(https:\/\/www\.draw\.io[^"]+)"><\/iframe>$/],templateFunc:function(e){return e[1]},code:!0,renderLinkInMobile:!0},{type:"slideshareCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe\ssrc="((?:https?:)?\/\/www\.slideshare\.net\/slideshow\/embed_code\/key\/[^"]+)"[^>]+>[^<]*<\/iframe>(|[^<]*<div[^>]*>.+<\/div>)?$/],templateFunc:function(e){return e[1]},code:!0},{type:"speakerdeckCode",pattern:[/^<script.+data-id="([^"]+)"[^>]+><\/script>$/],resizeType:i.ResizeType.Flexible,templateFunc:function(e){return"https://speakerdeck.com/player/"+e[1]},code:!0},{type:"haikudeckCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe\ssrc="(https:\/\/www\.haikudeck\.com\/e[^"]+)"[^>]+><\/iframe>(|<br\/><span[^>]+>.+<\/span>;)?$/],templateFunc:function(e){return e[1]},code:!0},{type:"modaoCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe\ssrc="https:\/\/modao\.cc\/app\/([0-9a-zA-Z]+)\/embed[^\s"]*"[^>]*><\/iframe>$/],templateFunc:function(e){return"https://modao.cc/app/"+e[1]+"/embed/v2"},border:!0,code:!0,renderLinkInMobile:!0},{type:"codepenCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe\s.*src="https:\/\/codepen\.io\/([0-9a-zA-Z]+)\/embed\/([0-9a-zA-Z]+)[^>]+>[\s\S]/],templateFunc:function(e){return"https://codepen.io/"+e[1]+"/embed/"+e[2]},border:!0,code:!0},{type:"jinshujuCode",resizeType:i.ResizeType.Flexible,pattern:[/^<iframe\s.*src="(https:\/\/jinshuju\.net\/f\/[0-9a-zA-Z]+)[^>]+><\/iframe>$/],templateFunc:function(e){return e[1]+"?background=white&banner=show&embedded=true&inner_redirect=false"},border:!0,code:!0}]},function(e,t){e.exports=o("UXvI")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHasResizeModule=l,t.getBlockWidthNotifyModule=c,t.getHasResizeModuleConfig=f;var r=o(n(52)),i=o(n(54));function o(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.getPlugin();return t?t.modules:[]}function s(e,t){var n=a(e);return Object.values(n).find(function(e){return e instanceof t})}function l(e){return s(e,r.default)}function c(e){return s(e,i.default)}function u(e){var t=e.getPlugin();return t?t.blockManager.getBlockEnableModules(e.blockType):[]}function d(e,t){return u(e).find(function(e){return Array.isArray(e)&&(e=e[0]),e===t})}function f(e){return!!d(e,r.default)}},function(e,t){e.exports=o("Ngi8")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=p(n(14)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0};t.convertSmartableComments=b;var a=p(n(0)),c=p(n(5)),s=n(1),u=p(n(41)),d=p(n(7)),f=p(n(103)),h=n(2);function p(e){return e&&e.__esModule?e:{default:e}}function g(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e){return e.map(function(e){var t=e.commentId,n=e.offsetTop;return{commentId:t||"",thirdPartyHeight:e.offsetHeight,relativeTopToThirdParty:n,quote:e.quote}})}var E,k,C,I,S=(y(T,s.CommentableBlock),r(T,[{key:"beforeMountBitable",value:function(){}},{key:"onInternalSizeChange",value:function(e,t){console.log(e,t)}},{key:"onEditbarPinChange",value:function(e){console.log(e)}},{key:"getBitableInfo",value:function(){return{token:this.blockToken,bitableId:this.props.tableId||void 0}}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"isShowHistoryPlaceholder",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e;return t.historyMode===h.HISTORY_MODE.PLACEHOLDER||t.historyMode===h.HISTORY_MODE.PLACEHOLDER_NEW}},{key:"render",value:(I=g(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("== bitable block render"),this.isShowHistoryPlaceholder())return c.default.render(this.getHistoryView(),this.mountPoint),this.rendered=!0,e.abrupt("return");e.next=5;break;case 5:if(t=this.getBitableInfo(),n=t.token,r=t.bitableId,this.beforeMountBitable(),!this.rendered&&n&&r){e.next=9;break}return e.abrupt("return");case 9:if(i=this.blockContext.undoDispatcher,(o=this.getBitableBridge())&&i){e.next=13;break}return e.abrupt("return");case 13:return this.rendered=!0,console.log("== start bitable block render",n,r),this.heightUpdateNotifier.notifyWillUpdate(),a=this.ExternalServices.mountOptions,s=void 0===a?{}:a,e.next=19,o.mountBitable(Object.assign({id:r,host:this.mountPoint,undoDispatcher:i,viewIndex:u.default.pasteViewIndex,overlayContainer:this.overlayContainer},Object.assign({},s,{isHistoryMode:this.isInHistoryMode()}),{operator:Object.assign({activeTab:this.onActiveBitable,internalSizeChange:this.onInternalSizeChange,editbarPinChange:this.onEditbarPinChange,onChanged:this.onBitableChanged,getBitablePosition:this.getBitablePosition,triggerComment:this.triggerComment,onSwitchNewTableView:this.onSwitchNewTableView,onSwitchNewView:this.onSwitchNewView,onRecover:this.ExternalServices.onRecover||l.default,onActiveCommentChange:this.onActiveCommentChange,onDeleteComment:this.onDeleteComment,onEditComment:this.onEditComment,onReplyComment:this.onReplyComment,onReadComment:this.onReadComment,onResolveComment:this.onResolveComment,onCommentLoaded:this.onCommentLoaded,onAddComment:this.onAddFullScreenComment,onTableLoaded:this.onTableLoaded,onBatchUpdateBlockComment:this.onBatchUpdateBlockComment,onStartNewComment:this.onStartNewComment},s.operator||{}),onActive:function(){return null},onHeightWillUpdate:this.heightUpdateNotifier.notifyWillUpdate,onHeightDidUpdate:this.heightUpdateNotifier.notifyDidUpdate,onRectChange:this.onRectChange}));case 19:this.heightUpdateNotifier.notifyDidUpdate(),!this.hasSetCommentBatchUpdateListener&&this.ExternalServices.setOnCommentBatchUpdate&&(this.ExternalServices.setOnCommentBatchUpdate(r,this.onCommentBatchUpdate),this.hasSetCommentBatchUpdateListener=!0),u.default.pasteViewIndex="",this.notifyContentReady(),console.log("== bitable block rendered");case 24:case"end":return e.stop()}},e,this)})),x)},{key:"getHistoryView",value:function(){var e=this.ExternalServices.t;return a.default.createElement("div",{className:"bitable-placeholder","data-block-history-bitable-name":e("doc.block.bitable")},a.default.createElement("img",{src:f.default}))}},{key:"delete",value:function(){console.log("== bitable block delete")}},{key:"unmount",value:function(e){o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"unmount",this).call(this,e);var t=this.getBitableBridge(),n=this.getBitableInfo().bitableId;t&&n&&(e?t.delBitable(n):t.unmountBitable(n)),this.rendered=!1,this.heightUpdateNotifier.destroy(),console.log("== bitable block unmount")}},{key:"onCopy",value:function(){return{html:"bitable copy html",text:"bitable copy text"}}},{key:"resize",value:function(){console.log("== bitable block resize")}},{key:"getBitableBridge",value:function(){return this.ExternalServices.getBitableBridge?this.ExternalServices.getBitableBridge():null}},{key:"onSearch",value:function(e){var t=this,n=e.searchKey,r=this.getBitableInfo().bitableId,i=this.getBitableBridge();return r&&i&&i.getSearchResult?i.getSearchResult(r,n).map(function(e){return Object.assign({},e,{searchKey:n,blockId:t.blockId,isReplaceable:!1})}):[]}},{key:"onHighlight",value:function(e,t){var n=this.getBitableInfo().bitableId,r=this.getBitableBridge();n&&r&&r.highlightSearchItem&&r.highlightSearchItem(n,e,t)}},{key:"onCancelSearch",value:function(e){var t=this.getBitableInfo().bitableId,n=this.getBitableBridge();t&&n&&n.clearSearchResult&&n.clearSearchResult(t,e)}},{key:"saveCommentMark",value:(C=g(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.getBitableInfo(),i=r.bitableId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.getBitableBridge().saveComment(i,n,t));case 4:case"end":return e.stop()}},e,this)})),R)},{key:"removeCommentMark",value:(k=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getBitableInfo(),r=n.bitableId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.getBitableBridge().removeComment(r,t));case 4:case"end":return e.stop()}},e,this)})),w)},{key:"locateComment",value:(E=g(regeneratorRuntime.mark(function e(t){var n,r,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getBitableInfo(),r=n.bitableId){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.getBitableBridge().findComment(r,t);case 5:if(i=e.sent){e.next=8;break}return e.abrupt("return",null);case 8:return o=i.offsetHeight,a=i.offsetTop,e.abrupt("return",{top:a,height:o});case 10:case"end":return e.stop()}},e,this)})),O)},{key:"onTap",value:function(){return{preventFocus:!0}}},{key:"onLongTap",value:function(){return{preventFocus:!0}}},{key:"overlayContainer",get:function(){}},{key:"blockContext",get:function(){return this.context}}]),T);function T(e,t,n,r){var i=this;v(this,T);var o,a,s=m(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,e,t));return s.rendered=!1,s.contentAsyncRender=!0,s.hasSetCommentBatchUpdateListener=!1,s.getBitablePosition=function(){},s.triggerComment=function(){var e=s.context.triggerComment;e&&e({block:s})},s.heightUpdateNotifier=new d.default({getContext:function(){return s.context},getBlockId:function(){return s.blockId}}),s.onInternalSizeChange=function(e,t){},s.hideLoadingAtEnd=!0,s.onRectChange=function(e){var t=Object.assign({blockId:s.blockId},e);s.editor.call("onBitableRectChange",t)},s.onActiveBitable=function(){var e=s.blockToken,t=s.props.tableId;s.ExternalServices.activeBlock&&e&&t&&s.ExternalServices.activeBlock(e+"_"+t)},s.onSwitchNewTableView=function(){s.ExternalServices.onSwitchNewTableView&&s.ExternalServices.onSwitchNewTableView()},s.onSwitchNewView=function(){s.ExternalServices.triggerContentChangeInDoc&&s.ExternalServices.triggerContentChangeInDoc()},s.onBitableChanged=function(e){s.ExternalServices.onBitableChanged&&s.ExternalServices.onBitableChanged(e),s.ExternalServices.triggerContentChangeInDoc&&s.ExternalServices.triggerContentChangeInDoc()},s.onTableLoaded=function(){s.ExternalServices.onTableLoaded&&s.ExternalServices.onTableLoaded()},s.onStartNewComment=function(e){s.ExternalServices.onStartNewComment&&s.ExternalServices.onStartNewComment(e)},s.onBatchUpdateBlockComment=function(){s.ExternalServices.onBatchUpdateBlockComment&&s.ExternalServices.onBatchUpdateBlockComment()},s.onActiveCommentChange=function(){s.activeCommentChange()},s.onDeleteComment=function(e,t){return s.removeComment({commentId:e,replyId:t})},s.onEditComment=function(e,t,n){return s.updateComment({commentId:e,replyId:t,content:n})},s.onReplyComment=function(e,t,n){return s.replyComment({commentId:e,replyId:t,content:n})},s.onReadComment=function(e,t){return s.readComment({commentId:e,replyId:t})},s.onResolveComment=function(e){return s.resolveComment(e)},s.onCommentLoaded=function(e){return s.notifyCommentLoaded(b(e))},s.onCommentBatchUpdate=function(e){return s.notifyCommentUpdate(b(e))},s.onAddFullScreenComment=function(e){return s.addComment(e)},s.getCommentMarks=function(){var e=s.getBitableInfo().bitableId;return e?b(s.getBitableBridge().getComments(e)):[]},s.getActiveComments=function(){var e=s.getBitableInfo().bitableId;return e?b(s.getBitableBridge().getActiveComments(e)):[]},s.getResolvedComments=function(){var e=s.getBitableInfo().bitableId;return e?b(s.getBitableBridge().getResolvedComments(e)):[]},s.setResolvedCommentIds=function(e){var t=s.getBitableInfo().bitableId;return t?s.getBitableBridge().setResolvedCommentIds(t,e):[]},s.setCommentData=function(e){var t=s.getBitableInfo().bitableId;if(t)return s.getBitableBridge().setCommentData(t,e)},s.startNewComment=function(e,t){var n=s.getBitableInfo().bitableId;return n?s.getBitableBridge().startNewComment(n,e,t).recordDescribe:""},s.removeTempCommentMark=function(e){var t=s.getBitableInfo().bitableId;if(t)return s.getBitableBridge().removeTempComment(t,e)},s.resolveCommentMark=(o=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.getBitableInfo(),r=n.bitableId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",s.getBitableBridge().resolveComment(r,t));case 4:case"end":return e.stop()}},e,i)})),function(e){return o.apply(this,arguments)}),s.activateComment=function(e){var t=s.getBitableInfo().bitableId;if(t&&t)return s.getBitableBridge().activateComment(t,e)},s.deactivateComment=function(e){var t=s.getBitableInfo().bitableId;if(t)return s.getBitableBridge().deactivateComment(t,e)},s.reopenComment=(a=g(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.getBitableInfo(),r=n.bitableId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",s.getBitableBridge().reopenComment(r,t));case 4:case"end":return e.stop()}},e,i)})),function(e){return a.apply(this,arguments)}),s.addHoverHighlight=function(e){var t=s.getBitableInfo().bitableId;if(t)return s.getBitableBridge().addHoverHighlight(t,e)},s.removeHoverHighlight=function(e){var t=s.getBitableInfo().bitableId;if(t)return s.getBitableBridge().removeHoverHighlight(t,e)},s.getTeaParams=function(e){var t=s.getBitableInfo().bitableId;if(t)return s.getBitableBridge().getTeaParams(t,e)},s.dataset=t,s.ExternalServices=n,s.editor=r,s}function O(e){return E.apply(this,arguments)}function w(e){return k.apply(this,arguments)}function R(e,t){return C.apply(this,arguments)}function x(){return I.apply(this,arguments)}t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pcMindNotePadding=16,t.mobileMindNotePadding=12,t.BASE_SCALE=.8,t.mindNoteSelectedClass="mindnote-selected",t.defaultSize={width:730,height:404,originalWidth:730,originalHeight:500,isModified:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_EMOJI_ID=t.DEFAULT_POLL_RECORD=void 0;var r=n(24);t.DEFAULT_POLL_RECORD={title:"",type:r.PollType.single,voteOptions:[],voteOptionMap:{},voteMap:{}},t.DEFAULT_EMOJI_ID="heart"},function(e,t){e.exports=o("ptp9")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFieldName=o,t.checkIfNeedSync=a;var r=n(20);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n;return i(n={},r.JIRA_ID.KEY,e("doc.jira.key")),i(n,r.JIRA_ID.PROJECT,e("doc.jira.field_project")),i(n,r.JIRA_ID.TYPE,e("doc.jira.field_issue_type")),i(n,r.JIRA_ID.SUMMARY,e("doc.jira.field_summary")),i(n,r.JIRA_ID.DESC,e("doc.jira.field_description")),i(n,r.JIRA_ID.STATUS,e("doc.jira.field_status")),i(n,r.JIRA_ID.LABEL,e("doc.jira.field_label")),i(n,r.JIRA_ID.ASSIGNEE,e("doc.jira.field_assignee")),i(n,r.JIRA_ID.UPDATED,e("doc.jira.field_update_time")),i(n,r.JIRA_ID.PRIORITY,e("doc.jira.field_priority")),i(n,r.JIRA_ID.CREATED,e("doc.jira.field_created")),i(n,r.JIRA_ID.REPORTER,e("doc.jira.field_reporter")),i(n,r.JIRA_ID.AFFECTED,e("doc.jira.field_affects_versions")),i(n,r.JIRA_ID.COMPONENTS,e("doc.jira.field_components")),i(n,r.JIRA_ID.CREATOR,e("doc.jira.field_creator")),i(n,r.JIRA_ID.DUEDATE,e("doc.jira.field_due_date")),i(n,r.JIRA_ID.ENVIRONMENT,e("doc.jira.field_environment")),i(n,r.JIRA_ID.FIXED,e("doc.jira.field_fix_versions")),i(n,r.JIRA_ID.RESOLVED,e("doc.jira.field_resolved")),i(n,r.JIRA_ID.RESOLUTION,e("doc.jira.field_resolution")),i(n,r.JIRA_ID.ORIGINAL,e("doc.jira.field_original_estimate")),i(n,r.JIRA_ID.REMAINING,e("doc.jira.field_remaining_estimate")),i(n,r.JIRA_ID.SPENT,e("doc.jira.field_time_spent")),i(n,r.JIRA_ID.VOTES,e("doc.jira.field_votes")),i(n,r.JIRA_ID.WATCHERS,e("doc.jira.field_watchers")),i(n,r.JIRA_ID.WORKRATIO,e("doc.jira.field_work_ratio")),n[t]}function a(e){return!e||Date.now()-e>r.SYNC_INTERVAL}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},a=n(1),s=f(n(0)),l=f(n(5)),c=f(n(81));n(82);var u=f(n(7)),d=n(16);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v=function(e){var t=e.t,n="placeholder-block";return s.default.createElement("div",{className:n},s.default.createElement("div",{className:n+"--left"},s.default.createElement(c.default,null)),s.default.createElement("div",{className:n+"--right"},s.default.createElement("div",{className:n+"--title"},s.default.createElement("div",null,t("block.placeholder.new_app")))))},m=(g(y,a.Block),r(y,[{key:"render",value:function(){var t=this;return new Promise(function(e){l.default.render(s.default.createElement(d.NotifyHeightUpdateOnMount,{notifier:t.heightUpdateNotifier},s.default.createElement(v,{t:t.ExternalServices.t})),t.mountPoint,e)})}},{key:"unmount",value:function(e){o(y.prototype.__proto__||Object.getPrototypeOf(y.prototype),"unmount",this).call(this,e),l.default.unmountComponentAtNode(this.mountPoint),this.heightUpdateNotifier.destroy()}},{key:"resize",value:function(e){this.oldWidth!==e&&(this.heightUpdateNotifier.notifyWillUpdate(),this.mountPoint.style.width=e+"px",this.oldWidth=e,this.heightUpdateNotifier.notifyDidUpdate())}},{key:"onCopy",value:function(){return{html:"",text:""}}},{key:"onTap",value:function(){return{preventFocus:!0}}},{key:"onLongTap",value:function(){return{preventFocus:!0}}}]),y);function y(e,t,n){h(this,y);var r=p(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,e,t));return r.oldWidth=null,r.shouldKeepAlive=!1,r.renderLocally=!0,r.heightUpdateNotifier=new u.default({getContext:function(){return r.context},getBlockId:function(){return r.blockId},throttleByRAF:!0}),r.ExternalServices=n,r}t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatUrl=t.filterUrl=t.replaceAmpersand=t.isUrl=t.wrapProtocolIfNeeded=t.getGoogleApiKey=void 0;var r=o(n(8));t.upgradeToHttps=l,t.getIframeSize=u;var E=n(6),i=n(28),a=n(39);function o(e){return e&&e.__esModule?e:{default:e}}t.getGoogleApiKey=function(){return(0,r.default)(window,"User.minaConfig.google_api_key")},t.wrapProtocolIfNeeded=function(e){return/^http/.test(e)||(e="https:"+e),e};var s=t.isUrl=function(e){return i.urlReg.test(encodeURI(e))};function l(e){return window&&"https:"===window.location.protocol&&(e=e.replace(/^http:\/\//i,"https://")),e}function c(){return document.querySelector("#outerdocbody .innerdocbody")}function k(){var e=(0,a.getConfigMap)().tiktok,t=e.defaultWidth,n=void 0===t?250:t,r=e.defaultHeight,i=void 0===r?515:r;if(E.browser.isMobile){var o=c().getBoundingClientRect().width;return{width:o,height:Math.ceil(i/n*o+2)}}return{width:n,height:i}}var C=null;function I(){var e=c(),t=window.getComputedStyle(e),n=t.width,r=t.paddingLeft,i=t.paddingRight;return parseFloat(n)-parseFloat(r)-parseFloat(i)}function u(e){var t,n=e.type,r=e.getIFrameBlockSettings,i=e.hasResizeModule,o=void 0!==i&&i,a=e.defaultWidth,s=void 0===a?I():a,l=e.defaultHeight,c=void 0===l?1/0:l,u=e.autosize,d=void 0===u||u,f=0,h=0,p=r&&r()||{},g=p.initialSize,v=void 0===g?{}:g,m=p.defaultSize,y=void 0===m?{width:730,height:410}:m,b=v[n];return h="tiktok"===n?(f=(C=C||k()).width,C.height):!E.browser.isMobile&&b&&o?(f=(t=b.width?b:y).width,t.height):d?9*s/16<c?9*(f=s)/16:(f=16*c/9,c):(f=s,c),{styleWidth:Math.round(f),styleHeight:Math.round(h)}}var d=t.replaceAmpersand=function(e){return e&&e.replace(/\\u0026/g,"&").replace(/&amp;/g,"&")},f=t.filterUrl=function(e){return e&&s(e)?e:"about:blank"};t.formatUrl=function(e){return f(d(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConfigs=t.getMinaConfigs=t.getLocalConfigs=t.getConfigMap=t.genConfigsOnMina=t.genTemplateFunc=t.genPattern=void 0;var c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(28);function u(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}var a=void 0,s=new Map,d=t.genPattern=function(e){return e.map(function(e){return new RegExp(e)})},f=t.genTemplateFunc=function(t){return function(r){var e=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r[t[2]]};return t.replace(/\$\{matched(\.(input))\}/g,e).replace(/\$\{matched(\[(\d)\])\}/g,e)}},l=function(e){if(!e||"object"!==(void 0===e?"undefined":i(e)))throw new Error("\bIFrameMinaConfig Is Empty");return Object.entries(e).map(function(e){var t=c(e,2),n=t[0],r=t[1],i=r.patterns,o=r.template,a=u(r,["patterns","template"]),s=d(i),l=f(o);return Object.assign({},a,{type:n,pattern:s,templateFunc:l})})};t.genConfigsOnMina=l;var h=t.getConfigMap=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.configs,n=e.getIFrameConfig,r=e.useCache,t=t||v(n,void 0===r||r);if(s.has(t))return s.get(t);var i=t.reduce(function(e,t){return e[t.type]=t,e},{});return s.set(t,i),i},p=t.getLocalConfigs=function(){return o.configs},g=t.getMinaConfigs=function(e){if(a&&(!(1<arguments.length&&void 0!==arguments[1])||arguments[1])||!e||!e())return a;try{var t=e(),n=h({configs:l(t)}),r=h({configs:p()});a=Object.values(Object.assign({},r,n))}catch(e){console.error("iframeblock",e)}return a},v=t.getConfigs=function(e,t){return g(e,t)||p()}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i;Object.defineProperty(t,"__esModule",{value:!0}),t.IResizeLog=function e(){r(this,e)},(i=(t.ResizeTriggerType=void 0)||(t.ResizeTriggerType={})).Hover="hover",i.Selected="selected",i.Manual="Manual"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=n(1),o=c(n(32)),a=c(n(59)),s=c(n(104)),m=n(60);n(105);var l=n(6),y=n(58);function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=(f(p,v.Creator),r(p,[{key:"getIsDepLoaded",value:function(){return this.ExternalServices.isBitableBridgeLoaded()}},{key:"loadDep",value:function(){return this.ExternalServices.loadBitableBridge()}},{key:"create",value:function(e,t,n){return this.renderSource=t.props.renderSource,t.props.renderSource===v.RenderSource.doc?l.browser.isMobile?new s.default(e,t,this.ExternalServices,n):new a.default(e,t,n,this.ExternalServices):new o.default(e,t,this.ExternalServices,n)}},{key:"isPastingSingleCell",value:function(e){return 1===e.length&&1===e[0].querySelectorAll("td").length}},{key:"onInternalPaste",value:function(e){var t=e.getHTML,n=e.pasteFrom,r=e.pasteTimes,i=t(),o=document.createElement("div");o.innerHTML=i;var a="cut"===n&&1===r,s=$(o).find(".block-type-"+this.blockType)[0],l=Array.from(s.classList).find(function(e){return e.startsWith("block-id-")});if(l){var c=l.split("block-id-")[1];if(c){var u=null,d={bitableBlockHTML:s.outerHTML,bitableBlockId:c,firstPasteAfterCut:a};if(this.getIsDepLoaded()){if(!(u=(0,m.generatePasteBitableDataSet)(d,this.ExternalServices)))return}else u=(0,m.generateLoadingDataSet)({source:m.InsertBitableSource.Paste,pasteParams:d});return u}}}},{key:"onPaste",value:function(e){var a=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.event,r=t.firstPasteAfterCut,s=void 0===r||r,i=t.customData;if(!n)return e;var o=n.originalEvent.clipboardData;if(!o)return e;var l,c,u,d,f,h,p=$(e.pasteDataWrapper),g=p.find(".byte-bitable");return this.isPastingSingleCell(g)?(c=(l=g[0]).querySelector("td"),u=(0,y.escapeHTML)(c.innerText||"\n"),$(l).replaceWith(u)):(d=o.getData("text/bitable"))||0<g.length?(f=g[0].outerHTML,h=null,(h=this.getIsDepLoaded()?(0,m.generatePasteBitableDataSet)({bitableData:d,bitableHTML:f,firstPasteAfterCut:s},this.ExternalServices):(0,m.generateLoadingDataSet)({source:m.InsertBitableSource.Paste,pasteParams:{bitableData:d,bitableHTML:f,firstPasteAfterCut:s,customData:i}}))&&p.html((0,v.generateBlockHTML)(h))):p.find(".block-type-"+this.blockType).each(function(e,t){var n=Array.from(t.classList).find(function(e){return e.startsWith("block-id-")});if(n){var r=n.split("block-id-")[1];if(r){var i=null,o={bitableBlockHTML:t.outerHTML,bitableBlockId:r,firstPasteAfterCut:s};if(a.getIsDepLoaded()){if(!(i=(0,m.generatePasteBitableDataSet)(o,a.ExternalServices)))return void $(t).html("bitable html")}else i=(0,m.generateLoadingDataSet)({source:m.InsertBitableSource.Paste,pasteParams:o});i&&$(t).html((0,v.generateBlockHTML)(i))}}}),{pasteDataWrapper:p[0],text:e.text,purifiedHtml:e.purifiedHtml}}},{key:"makeLoadedDataSet",value:function(e){var t=e.initData;if(!t)return null;var n=(0,v.parseEscapedInitData)(t);return n.source===m.InsertBitableSource.Paste?(0,m.generatePasteBitableDataSet)(n.pasteParams,this.ExternalServices):n.source===m.InsertBitableSource.Insert?(0,m.generateInsertBitableDataSet)(n.insertParams,this.ExternalServices):null}},{key:"insertTea",value:function(e){(0,m.logPaste)(e,this.ExternalServices)}}]),p);function p(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder;u(this,p);var i=d(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return i.ExternalServices={},i.blockType=v.BlockType.BITABLE_BLOCK,i.defaultProps={},i.ExternalServices=t,i}(t.default=h).pasteViewIndex=""},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(65));t.getNormalDateStr=l,t.showColor=c,t.deleteReminder=u,t.propsChange=d,t.onClick=f,t.onMouseEnter=h,t.onMouseLeave=p;var i=a(n(115)),o=n(44);function a(e){return e&&e.__esModule?e:{default:e}}var s=new i.default;function l(e,t){return(0,r.default)(e)?s.getTimeString(e,t):e}function c(e,t){var n=t.Helpers.moment;return n().isAfter(e)?"red":n(e).isBetween(n(),n().add("7","days"))?"orange":"blue"}function u(e,t){var n=t.EventEmitter;n&&n.trigger(o.REMINDER_BLOCK_DELETED,[e])}function d(e,t,n){var r=n.EventEmitter;r&&r.trigger(o.REMINDER_BLOCK_PROPS_CHANGE,[e,t])}function f(e,t,n,r){var i=r.EventEmitter;i&&i.trigger(o.REMINDER_BLOCK_CLICK,[e,t,n])}function h(e,t,n,r){var i=r.EventEmitter;i&&i.trigger(o.REMINDER_BLOCK_MOUSE_ENTER,[e,t,n])}function p(e,t,n,r){var i=r.EventEmitter;i&&i.trigger(o.REMINDER_BLOCK_MOUSE_LEAVE,[e,t,n])}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function e(t){var n=this;r(this,e),this.getToday=function(){return n.today},this.getYesterday=function(){return n.yesterday},this.getTomorrow=function(){return n.tomorrow},this.yesterday=t.yesterday,this.today=t.today,this.tomorrow=t.tomorrow};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.REMINDER_BLOCK_DELETED="REMINDER_BLOCK_DELETED",t.REMINDER_BLOCK_PROPS_CHANGE="REMINDER_BLOCK_PROPS_CHANGE",t.REMINDER_BLOCK_CLICK="REMINDER_BLOCK_CLICK",t.REMINDER_BLOCK_MOUSE_ENTER="REMINDER_BLOCK_MOUSE_ENTER",t.REMINDER_BLOCK_MOUSE_LEAVE="REMINDER_BLOCK_MOUSE_LEAVE",t.REMINDER_BLOCK_SET_PROPS="REMINDER_BLOCK_SET_PROPS",t.TIME_STR_PROP="data-time-str"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUserShowNameForLang=i,t.getCurrentUserId=o;var r=n(3);function i(e,t){var n="en";return(0,r.getSearch)("lang")?n=(0,r.getSearch)("lang"):t&&(n=t()),"en"===n?e.en_name||e.name||e.cn_name:e.name||e.cn_name||e.en_name}function o(){var e=window.User;return e&&e.id||""}},function(e,t){e.exports=o("UlbS")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Poll=t.advancedStatus=t.ActiveStatus=t.CHAR_LIMIT=t.preCls=void 0;var i=u(n(23)),r=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isRemoteDevice=Y;var a=n(0),D=u(a),s=n(12),B=u(n(4)),P=n(46),F=u(n(144)),j=n(24),z=n(145),H=n(1),I=u(n(146)),U=u(n(70)),V=u(n(152));n(153),n(154);var W=u(n(15)),G=n(2),c=n(17);function u(e){return e&&e.__esModule?e:{default:e}}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g,v=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},m=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Z=t.preCls="block-poll",y=t.CHAR_LIMIT={title:88,option:1e3},q=t.ActiveStatus=void 0;(g=q||(t.ActiveStatus=q={})).normal="normal",g.focus="focus",g.editting="editting";var J=t.advancedStatus=function(e){return{isNormal:e===q.normal,isFocus:e===q.focus,isEditting:e===q.editting}};function Y(e){var t=e.Helpers.browser;return t.mobile||t.isIPad}var b=(p(E,a.Component),r(E,[{key:"emitHeightWillUpdate",value:function(){this.props.emitter&&this.props.emitter.emit(G.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.WILL_UPDATE)}},{key:"emitHeightDidUpdate",value:function(){this.props.emitter&&this.props.emitter.emit(G.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.DID_UPDATE)}},{key:"emitViewRendered",value:function(){this.props.emitter&&this.props.emitter.emit(G.VIEW_RENDERED)}},{key:"bindEvents",value:function(){this.documentEvent.on("click",this.handleDocumentClick),window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),this.props.emitter.on("highlightResult",this.updateSearchResult),this.props.emitter.on("clearSearchResult",this.clearSearchResult)}},{key:"removeEvents",value:function(){this.documentEvent.off("click",this.handleDocumentClick),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline),this.props.emitter.removeAllListeners()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){(0,z.isEditable)(e.permissions,this.props.ExternalServices)||this.setState({activeStatus:q.normal})}},{key:"componentDidMount",value:function(){this.bindEvents(),this.emitHeightDidUpdate(),this.emitViewRendered()}},{key:"mounted",value:function(){this.setState({loaded:!0})}},{key:"componentWillUnmount",value:function(){this.removeEvents()}},{key:"UNSAFE_componentWillUpdate",value:function(e,t){this.isHeightPossibleToChange(e,t)&&this.emitHeightWillUpdate()}},{key:"componentDidUpdate",value:function(){this.titleRef&&this.checkFocus(),this.emitHeightDidUpdate()}},{key:"isHeightPossibleToChange",value:function(t,n){var r=this,e=function(e){return e(t,n)!==e(r.props,r.state)};return!(0,i.default)(t.title,this.props.title)||e(this.shouldRenderAddOptionButton)||e(this.shouldRenderPaddingBottom)||!(0,i.default)(t.options,this.props.options)}},{key:"focusOption",value:function(e){var t=this.voteOptionRefs[e];t&&t.focusInput()}},{key:"getUserId",value:function(){var e=this.props,t=e.reduxState,n=e.ExternalServices.Redux.selectors.selectCurrentUser(t);return n&&n.get("id")||(0,z.getCurrentUserId)()||""}},{key:"checkFocus",value:function(){var e,t=document.activeElement,n=Boolean(t&&this.titleRef===t);for(e in n!==this.state.isTitleFocusing&&this.setState({isTitleFocusing:n}),this.voteOptionRefs)this.voteOptionRefs[e]&&this.voteOptionRefs[e].checkFocus()}},{key:"render",value:function(){var e,t,A,n,r=this,i=this.props,o=i.isPresentation,a=i.size,s=i.selected,l=i.selectState,c=i.permissions,u=i.title,d=i.options,f=i.blockId,h=i.pollType,p=i.ExternalServices,g=this.state,v=g.activeStatus,m=g.dialogVisible,y=g.dialogText,b=g.isTitleFocusing,E=g.voteActionFocused,k=g.searchResult,C=(0,z.isEditable)(c,p),I=p.Helpers.browser,S=p.t,T=J(v),O=T.isNormal,w=T.isFocus,R=T.isEditting,x=h===j.PollType.single,M=(0,B.default)(Z,(K(e={},Z+"__single",x),K(e,Z+"__multiple",!x),K(e,Z+"__normal",O),K(e,Z+"__focus",w),K(e,Z+"__editting",R),K(e,Z+"__selected",s&&!E&&l!==H.SelectionState.COVER_ON_BLOCK),K(e,Z+"__covered",l===H.SelectionState.COVER_ON_BLOCK),K(e,Z+"__presentation",o),K(e,Z+"--remote-device",Y(p)),K(e,Z+"--windows","Windows"===I.osname),K(e,Z+"--ie",I.msie||I.msedge),e)),N=(0,B.default)(Z+"--title-wrapper",(K(t={},Z+"--title-wrapper-editable",!O&&C&&!b),K(t,Z+"--editting-title",b&&C),t)),_={};o&&a&&(A=a.width,n=a.height,_.maxHeight=n+"px",_.maxWidth=A+"px");var L="poll-title-"+f;return D.default.createElement("div",{ref:function(e){e&&(r.props.innerRef(e),r.containerRef=e)},className:M,"data-assign-poll-status":q.focus,style:_},D.default.createElement("div",{className:"block--offline-mask",style:{display:this.state.isOnline?"none":"block"}},D.default.createElement("div",{className:"block--offline-info"},D.default.createElement(F.default,{className:"block--offline__icon"}),D.default.createElement("span",null,S("block.no_offline_edit_support")))),D.default.createElement(P.Dialog,{dialogRef:function(e){return e&&(r.dialogRef=e)},visible:m,title:S("block.poll_warning"),onClose:function(){return r.setState({dialogVisible:!1})},onOkClick:this.handleDialogConfirm,okText:S("block.poll_confirm_ok"),cancelText:S("block.poll_confirm_cancel")},y),D.default.createElement("header",{className:Z+"--header"},D.default.createElement("span",{className:Z+"--type"},S(x?"block.poll_type_single":"block.poll_type_multiple")),D.default.createElement("label",{htmlFor:L,className:N},D.default.createElement("div",{className:Z+"--title-div"},D.default.createElement(W.default,{bgColor:G.MATCHED_BACKGROUND_COLOR,activeBgColor:G.SELECTED_BACKGROUND_COLOR,activeKey:this.state.selectedKey,isSelected:this.state.isSelected,context:k},u)),D.default.createElement(U.default,{id:L,className:"vote-title",getRef:function(e){return e&&(r.titleRef=e)},readOnly:!C,onChange:this.handleTitleInput,placeholder:I.mobile?"":S("block.poll_title_placeholder")+"...",value:u}))),d.map(function(e,t){return r.renderVoteOption({order:(0,z.getOrder)(t),option:e})}),this.shouldRenderAddOptionButton(this.props,this.state)&&D.default.createElement("div",{className:Z+"--add-option"},D.default.createElement("div",{className:Z+"--add-option-hover-area","data-assign-poll-status":q.editting,onClick:this.handleAddOption},D.default.createElement(V.default,null),D.default.createElement("div",{className:Z+"--add-option-text"},S("block.poll_add_option")))),this.shouldRenderPaddingBottom(this.props,this.state)&&D.default.createElement("div",{style:{paddingBottom:7}}))}}]),E);function E(e){var i=this;f(this,E);var C=h(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e));return C.state={isTitleFocusing:!1,activeStatus:q.normal,dialogText:"",dialogVisible:!1,voteActionFocused:!1,isOnline:!0,loaded:!1,searchResult:[],selectedKey:"",isSelected:!1},C.dialogCallback=function(){},C.titleRef=null,C.containerRef=null,C.dialogRef=null,C.voteOptionRefs={},C.documentEvent=c.GlobalDOMEventEmitter.get(document),C.handleDocumentClick=function(e){var t={},n=function(){Object.keys(t).some(function(e){return C.state[e]!==t[e]})&&C.setState(t)};C.titleRef&&C.checkFocus();var r=e.currentTarget,i=e.target;if(i){for(var o=i,a=q.normal;i&&i!==r;){if(i.dataset&&i.dataset.assignPollStatus){if(!["normal","focus","editting"].includes(i.dataset.assignPollStatus))return;a=i.dataset.assignPollStatus;break}i=i.parentElement}var s=C.containerRef&&C.containerRef.contains(i),l=s&&i&&i.classList.contains("block-poll--vote-action-mask");if(t.voteActionFocused=J(a).isNormal&&!!l,(0,z.isEditable)(C.props.permissions,C.props.ExternalServices))return C.dialogRef&&C.dialogRef.contains(o)?t.activeStatus=q.editting:s?t.activeStatus=a:document.body.contains(o)&&(C.titleRef&&C.titleRef.blur(),t.activeStatus=q.normal),void n();n()}},C.clearSearchResult=function(e){C.setState(function(){return{searchResult:e}})},C.updateSearchResult=function(e){C.setState(function(){return{searchResult:e.searchResult}}),void 0!==e.isSelected&&C.setState(function(){return{selectedKey:e.selectedKey,isSelected:e.isSelected}})},C.handleOnline=function(){C.setState({isOnline:!0})},C.handleOffline=function(){C.setState({isOnline:!1})},C.getNextVoteOptionIndex=function(){var e=C.props.options;if(!e.length)return-1;var t=e.findIndex(function(e){var t=C.voteOptionRefs[e.id];return Boolean(t&&t.state.isFocusing)})+1;return t<e.length?t:-1},C.focusNextOptionOrCreateOption=d(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=C.state.activeStatus,J(t).isEditting){e.next=4;break}return e.abrupt("return");case 4:if(n=C.props.options,C.state.isTitleFocusing&&n.length)return C.focusOption(n[0].id),C.checkFocus(),e.abrupt("return");e.next=10;break;case 10:if(r=n[C.getNextVoteOptionIndex()])return C.focusOption(r.id),C.checkFocus(),e.abrupt("return");e.next=15;break;case 15:return e.next=17,C.handleAddOption();case 17:C.checkFocus();case 18:case"end":return e.stop()}},e,i)})),C.onKeyup=function(e){e.which===H.KeyCode.Tab&&C.checkFocus(),e.which===H.KeyCode.Enter&&C.focusNextOptionOrCreateOption()},C.handleTitleInput=function(e){var t=C.props,n=t.onTitleChange,r=t.ExternalServices,i=e.target.value;i.includes("\n")&&(i=i.replace(/\n/g,"")),i.length>y.title&&(r.Toast.show({key:"pollTitle",type:"error",content:r.t("block.poll_title_exceeded",y.title)}),i=i.slice(0,y.title)),n(i)},C.handleAddOption=d(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=C.props.onAddOption,e.next=3,t();case 3:""!==(n=e.sent)&&C.focusOption(n);case 5:case"end":return e.stop()}},e,i)})),C.renderVoteOption=function(e){var t=e.order,n=e.option,r=C.getUserId(),i=C.props,o=i.isPresentation,a=i.permissions,s=i.getEmoji,l=i.isVoted,c=i.blockId,u=i.pollType,d=i.onDeleteOption,f=i.onVoteToggle,h=i.onEditOption,p=i.onEmojiChange,g=i.ExternalServices,v=C.state,m=v.activeStatus,y=v.loaded,b=n.id,E=n.votes,k={userId:r,optionId:b,order:t,activeStatus:m,isPresentation:o,editable:(0,z.isEditable)(a,g),containerRef:C.containerRef,confirmWithDialog:C.confirmWithDialog,text:n.text,blockId:c,pollType:u,loaded:y,votes:E,isVoted:l(b,r),emojiId:s(b,r),onDeleteOption:d,onVoteToggle:f,onEditOption:h,onEmojiChange:p,isRemoteDevice:Y(g),ExternalServices:g};return D.default.createElement(I.default,Object.assign({key:b},k,{ref:function(e){C.voteOptionRefs[b]=e}}))},C.confirmWithDialog=function(e,t){C.dialogCallback=t,C.setState({dialogText:e,dialogVisible:!0})},C.handleDialogConfirm=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"==typeof C.dialogCallback)return e.next=3,C.dialogCallback();e.next=3;break;case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}},e,i)})),C.shouldRenderAddOptionButton=function(e,t){var n=e.ExternalServices.Helpers.browser;return!J(t.activeStatus).isNormal&&!n.mobile&&t.isOnline},C.shouldRenderPaddingBottom=function(e,t){var n=J(t.activeStatus),r=n.isNormal,i=n.isFocus;return r||i&&!t.isOnline},C.emitHeightWillUpdate(),C}t.Poll=b=v([(0,s.connect)(function(e){return{reduxState:e}},{},null,{withRef:!0}),m("design:paramtypes",[Object])],b),t.Poll=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isEditable=t.getDefaultJiraFilterRecord=void 0;var r=a(n(21));t.getFilterName=c,t.getDefaultFieldVisibleMap=u,t.getDefaultFields=d;var i=n(26),o=n(20);function a(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n;return l(n={},-1,t("doc.jira.filter_name_1")),l(n,-2,t("doc.jira.filter_name_2")),l(n,-3,t("doc.jira.filter_name_6")),l(n,-4,t("doc.jira.filter_name_3")),l(n,-5,t("doc.jira.filter_name_4")),l(n,-6,t("doc.jira.filter_name_7")),l(n,-7,t("doc.jira.filter_name_8")),l(n,-8,t("doc.jira.filter_name_9")),l(n,-9,t("doc.jira.filter_name_5")),n[e]}function u(e){var t={};return Object.keys(e).forEach(function(e){t[e]=!!i.FILTER_DEFAULT_FIELD_MAP[e]&&i.FILTER_DEFAULT_FIELD_MAP[e].visible}),t}function d(e){var t=Object.keys(i.FILTER_DEFAULT_FIELD_MAP).length,n=Array(t);return Object.keys(e).forEach(function(e){(0,r.default)(i.FILTER_DEFAULT_FIELD_MAP[e])?n.push(e):n[i.FILTER_DEFAULT_FIELD_MAP[e].sort]=e}),[o.JIRA_ID.KEY].concat(s(n.filter(function(e){return e})))}t.getDefaultJiraFilterRecord=function(){return{filterId:"",filterName:"",isDelete:!1,jql:"",linkUrl:"",lastSyncTime:0,fieldMap:{},issues:[],issueCount:0,issueMap:{},viewInfo:{type:"",viewMap:{},views:[]}}},t.isEditable=function(e,t){return!!e&&!t.Helpers.browser.mobile&&e&&e.editable}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=d(n(19)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.generateDiagramInitData=I;var a=n(35),s=n(196),l=n(27),c=n(3),u=n(6);function d(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function h(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var g,v,m,y=(i(b,[{key:"initRecord",value:function(e,t){var n=(0,a.Synchronous)(new a.Record({}),{token:e,io:t,tenant_id:b.TENANT_ID,logger:{log:this.ExternalServices.LogService.collectEvent}});return(n=(0,a.Undoable)(n)).onError(this.errorHandler),n}},{key:"getVersion",value:function(){return this.record.getSync().version}},{key:"getRecord",value:function(e){var t=this.record;if(t)return e?t.get([e]):t.getSnapshot()}},{key:"getFixedRecord",value:function(){var e=this.record;if(e){var t=e.getSnapshot();if(!this.isDataError())return t;var n=(0,r.default)(t);return n.data.mxCellList=[].concat(h(new Set(t.data.mxCellList))),n}return I()}},{key:"setRecord",value:(m=f(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.record.set(t);case 2:case"end":return e.stop()}},e,this)})),C)},{key:"fixRecord",value:(v=f(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.getRecord(),n=[].concat(h(new Set(t.data.mxCellList))),this.setRecord([{path:["data","mxCellList"],value:n}]);case 3:case"end":return e.stop()}},e,this)})),k)},{key:"isDataError",value:function(){var e=this.getRecord();return[].concat(h(new Set(e.data.mxCellList))).length!==e.data.mxCellList.length}},{key:"updateRecord",value:(g=f(regeneratorRuntime.mark(function e(t){var n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(n=(0,s.diff)(this.getRecord(),t)).forEach(function(e){"mxCellList"===e.path[e.path.length-2]&&(e.path[e.path.length-1]=+e.path[e.path.length-1])}),r=[],i=[],n.forEach(function(e){e.op!==l.DiffType.ADD&&e.op!==l.DiffType.REPLACE||r.push({path:e.path,value:e.value}),e.op===l.DiffType.REMOVE&&i.push(e.path)}),0<r.length&&this.record.set(r,{type:"undoable"+this.typeNumber,undoable:!0}),0<i.length&&this.record.remove(i.reverse(),{type:"undoable"+this.typeNumber,undoable:!0}),this.typeNumber++;case 8:case"end":return e.stop()}},e,this)})),E)},{key:"fetchClientVars",value:function(){return this.record.fetchClientVars()}},{key:"addListener",value:function(e){this.recordHandlerMap[e]=e,this.record.onChange(e)}},{key:"removeListener",value:function(e){this.record.removeChangeListener(e),delete this.recordHandlerMap[e]}},{key:"destructor",value:function(){var t=this;this.record&&(Object.keys(this.recordHandlerMap).forEach(function(e){t.record.removeChangeListener(e)}),this.recordHandlerMap={},this.record.destroy())}},{key:"isBlankDiagram",value:function(){var e=this.getRecord();return!e||e.data.mxCellList.length<=2}}]),b);function b(e,t,n){var r=this;p(this,b),this.recordHandlerMap={},this.typeNumber=1,this.errorHandler=function(e){var t;u.browser.isMobile||(r.ExternalServices.graphEditorManager&&r.ExternalServices.graphEditorManager.exit(),console.log("[diagram]: Data Sdk Error",e,e.detail.code,e.detail.msg),(0,c.captureException)("[diagram]: Data Sdk Error, code: "+e.detail.code+", msg: "+e.detail.msg),e.detail.code?(t=e.detail,r.ExternalServices.EventEmitter.emit("Etherpad:Error",{message:"[diagram]: "+t.msg,code:t.code})):r.ExternalServices.EventEmitter.emit("Etherpad:Error",{message:"[diagram]: "+e.detail.message}))},this.undo=function(){r.record.undo()},this.redo=function(){r.record.redo()},this.canUndo=function(){return r.record.getUndoDispatcher().canUndo},this.canRedo=function(){return r.record.getUndoDispatcher().canRedo},this.ExternalServices=n,this.record=this.initRecord(e,t)}function E(e){return g.apply(this,arguments)}function k(){return v.apply(this,arguments)}function C(e){return m.apply(this,arguments)}function I(){return{data:{mxGraphModel:{dx:"765",dy:"705",grid:"1",gridSize:"10",guides:"1",tooltips:"1",connect:"1",arrows:"1",fold:"1",page:"1",pageScale:"1",pageWidth:"827",pageHeight:"1169"},mxCellMap:{Xfazc13W:{id:"Xfazc13W"},Pect1uf9:{id:"Pect1uf9",parent:"Xfazc13W"}},mxCellList:["Xfazc13W","Pect1uf9"]},lastEditTime:0,snapshot:""}}(t.default=y).TENANT_ID=18},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=v(n(8)),o=v(n(29)),s=v(n(22)),i=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=y(["",""],["",""]),c=n(0),u=v(c),d=v(n(10)),f=n(31),h=n(6),p=n(11),g=v(n(207));function v(e){return e&&e.__esModule?e:{default:e}}function m(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function y(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function b(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var I,S=(C(T,c.PureComponent),i(T,[{key:"componentDidMount",value:function(){this.bindEvent(!0);var e=this.props,t=e.equation,n=e.onRendered;t&&t.trim()?this.genEquation():n()}},{key:"componentWillUnmount",value:function(){this.bindEvent(!1),this.props.editor.off("horzResizeEnd",this.equationNodeResize),this.debounceGenEquation.cancel(),this.handleEditorResize.cancel(),this.equationContainer=void 0}},{key:"componentDidUpdate",value:function(e){var t,n,r=this.props,i=r.equation,o=r.isError,a=r.onRendered;i&&(t=i!==e.equation,n=o!==e.isError,t&&!e.equation||n&&!o?this.genEquation():(t||this.isEquationNoRender)&&this.debounceGenEquation(),!o&&this.isEquationNoRender||a())}},{key:"bindEvent",value:function(e){var t=this.props.editor,n=(0,p.getAction)(e);t.eventEmitter[n]("editorSizeChange",this.handleEditorResize),h.browser.isMobile||(t[n]("fullscreenEntered",this.equationNodeResize),t[n]("fullscreenExited",this.equationNodeResize))}},{key:"genEquationStart",value:(I=b(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,n=t.loading,r=t.handleStateChange,!n){e.next=14;break}i=0;case 3:if(i<3)return e.next=6,p.katexManager.get();e.next=14;break;case 6:if(e.sent)return e.next=10,new Promise(function(e){r({loading:!1},e)});e.next=11;break;case 10:return e.abrupt("break",14);case 11:i++,e.next=3;break;case 14:case"end":return e.stop()}},e,this)})),O)},{key:"renderEquationNode",value:function(e){var t=this.props.equation;e.render(String.raw(l,t.trim()),this.equationContainer,{leqno:!1,fleqn:!1,throwOnError:!0,errorColor:f.R500,strict:"warn",trust:!1})}},{key:"renderLoading",value:function(){return u.default.createElement("span",{className:"equation-view-loading-box"})}},{key:"renderError",value:function(){var e=this.props.errorPlaceHolder;return u.default.createElement("div",{className:"equation-view-error"},u.default.createElement("i",null,u.default.createElement(g.default,null)),u.default.createElement("span",null,e))}},{key:"renderEquation",value:function(){var e=this.state.style;return u.default.createElement("div",{ref:this.setEquationContainerRef,className:"equation-view-container",style:e})}},{key:"renderPlaceHolder",value:function(){var e=this.props.placeHolder;return u.default.createElement("div",{className:"equation-view-placeHolder"},e)}},{key:"renderContent",value:function(){var e=this.props,t=e.equation,n=e.isError;return e.loading?this.renderLoading():t&&t.trim()?u.default.createElement(u.default.Fragment,null,n&&this.renderError(),this.renderEquation()):this.renderPlaceHolder()}},{key:"render",value:function(){var e=this.props,t=(e.editor,e.editing,e.editable,e.equation,e.placeHolder,e.errorPlaceHolder,e.isError,e.loading,e.handleStateChange,e.handleWillGenEquation,e.handleDidGenEquation,e.ExternalServices,e.getContainerRef),n=(e.onRendered,m(e,["editor","editing","editable","equation","placeHolder","errorPlaceHolder","isError","loading","handleStateChange","handleWillGenEquation","handleDidGenEquation","ExternalServices","getContainerRef","onRendered"])),r={onTouchEnd:this.handleTouchEnd,onDragStart:this.handleDragStart};return u.default.createElement("div",Object.assign({ref:t},n,h.browser.isMobile&&r),this.renderContent())}},{key:"isDocSSR",get:function(){return this.props.ExternalServices.isDocSSR}},{key:"isEquationNoRender",get:function(){return!(0,r.default)(this.equationContainer,"children.length")}}]),T);function T(e){var t=this;E(this,T);var a=k(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,e));a.setEquationContainerRef=function(e){e&&a.bindTableResize(e),a.equationContainer=e},a.genEquation=b(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.isDocSSR)return e.abrupt("return");e.next=2;break;case 2:if(p.katexManager.isLoaded()){e.next=5;break}return e.next=5,a.genEquationStart();case 5:a.genEquationNode();case 6:case"end":return e.stop()}},e,t)})),a.debounceGenEquation=(0,s.default)(a.genEquation,300),a.bindTableResize=function(e){var t;!h.browser.isMobile&&e.closest(".ace-table")&&(t=(0,p.getAction)(!!e),a.props.editor[t]("horzResizeEnd",a.equationNodeResize))},a.genEquationNode=function(){var e=p.katexManager.getRelKatex();if(a.equationContainer&&e){var t=a.props,n=t.handleWillGenEquation,r=t.handleDidGenEquation,i=t.handleStateChange,o=!1;try{n(),a.renderEquationNode(e),a.equationNodeResize()}catch(e){o=!0}i({isError:o},r)}},a.equationNodeResize=function(){var e,t,n,r=a.equationContainer;!r||(e=(0,d.default)(r).parent().width())&&(t=((0,d.default)(".katex",r).outerWidth()||0)+8,(n="scale("+Math.min(Math.ceil(e)/t,1)+")")!==a.state.style.transform&&a.setState({style:{transform:n}}))},a.handleEditorResize=(0,o.default)(function(e){var t=e.prev,n=e.next,r=a.state.style.transform,i=t.width===n.width;r&&i&&!a.isEquationNoRender||a.equationNodeResize()},10),a.handleTouchEnd=function(e){var t,n=a.props,r=n.editable,i=n.editing;(!h.browser.isAndroid||r()&&i())&&(e.preventDefault(),(t=a.props.onTouchEnd)&&t(e))},a.handleDragStart=function(e){e.preventDefault()},a.state={style:{transform:void 0}};var n=e.ExternalServices,r=n.isDocSSR,i=n.getKatex;return r||p.katexManager.install(i),a}function O(){return I.apply(this,arguments)}t.default=S},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),(r=(t.LinkBlockType=void 0)||(t.LinkBlockType={})).Record="record",r.Card="card",r.Embed="embed",r.Database="database",r.Bookmark="bookmark",(i=(t.LinkProvider=void 0)||(t.LinkProvider={})).Pano="pano",i.SmartLink="smartLink"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(2),a=n(9),s=l(n(90));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=(r(d,[{key:"bindEvents",value:function(){this.permissions&&this.permissions.editable&&(this.regionDom.on("mousedown","."+a.resizeContainerClass,this.handleMouseDown),this.isEventsBind=!0)}},{key:"unbindEvents",value:function(){this.regionDom.off("mousedown","."+a.resizeContainerClass,this.handleMouseDown),this.isEventsBind=!1}},{key:"bindMouseEvents",value:function(){document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},{key:"unbindMouseEvents",value:function(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)}},{key:"doResize",value:function(e,t){var n;!this.resizeBlock||(n=this.blockMap.get(this.resizeBlock))&&n.doResize(e,t)}},{key:"getBlockResizeModule",value:function(e){return this.blockMap.get(e)}},{key:"blockDidMount",value:function(e,t){var n,r,i;e.completeResizeProps&&e.completeResizeProps(),e.props.resizeType!==a.ResizeType.None&&(r=arguments.length<=(n=(arguments.length<=2?0:arguments.length-2)-1+2)?void 0:arguments[n],(i=new s.default(e,r,this.blockCore)).setVisibleEnable(),i.confirmResize(),this.blockMap.set(e,i))}},{key:"blockDidUpdate",value:function(e){e.completeResizeProps&&e.completeResizeProps();var t=this.blockMap.get(e);t&&t.blockDidUpdate()}},{key:"blockWillUnmount",value:function(e){var t=this.blockMap.get(e);t&&t.destroy(),this.blockMap.delete(e)}},{key:"unmount",value:function(){this.blockCore.event.off("permissionsChange",this.handlePermissionChange),this.unbindEvents()}},{key:"resizeBlockFromRemote",value:function(e,t){var n=this.blockMap.get(e);n&&n.resizeBlockFromRemote(t)}},{key:"setSliderVisibleByBlock",value:function(e,t){var n=this.blockMap.get(e);n&&n.setSliderVisibleByBlock(t)}},{key:"permissions",get:function(){var e=this.blockCore.modules.permission;return e?e.permissions:o.DEFAULT_PERMISSIONS}}]),d);function d(e){var r=this;c(this,d),this.className="resize",this.blockMap=new Map,this.resizeBlock=null,this.isEventsBind=!1,this.handleMouseDown=function(e){var t=e.currentTarget.dataset.blockId||"",n=r.blockCore.getBlockById(t);n&&(r.resizeBlock=n,r.doResize(a.BLOCK_RESIZE_EVENT_NAME.START,e.originalEvent),r.bindMouseEvents())},this.handleMouseMove=function(e){r.resizeBlock&&r.doResize(a.BLOCK_RESIZE_EVENT_NAME.ING,e)},this.handleMouseUp=function(e){r.resizeBlock&&(r.doResize(a.BLOCK_RESIZE_EVENT_NAME.END,e),r.unbindMouseEvents())},this.handlePermissionChange=function(t){r.blockMap.forEach(function(e){e.handlePermissionChange(t)}),!r.isEventsBind&&t.editable?r.bindEvents():r.isEventsBind&&!t.editable&&r.unbindEvents()},this.blockCore=e,this.regionDom=$(e.editor.getScrollContainer()),this.blockCore.event.on("permissionsChange",this.handlePermissionChange),this.bindEvents()}u.injectClasses=[a.RESIZE_MODULE_CLASS],t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=f(n(22)),i=f(n(29)),o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=f(n(0)),g=n(9),l=f(n(91)),c=n(1),u=f(n(7)),d=n(30);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=(p(y,s.default.PureComponent),o(y,[{key:"componentDidMount",value:function(){this.bindEvents(),this.initBoundData(),this.adaptResize(),this.emitSizeEvent(g.BLOCK_RESIZE_EVENT_NAME.INIT),this.updateBlockPlaceholderSize(),this.notifyBlockWdith()}},{key:"componentDidUpdate",value:function(){this.unBindEvents(),this.bindEvents(),this.updateResizeBlock()}},{key:"componentWillUnmount",value:function(){this.unBindEvents(),this.changeTableSize.cancel(),this.handleWindowSizeChange.cancel(),this.handleEditorSizeChange.cancel()}},{key:"updateDocBodyPadding",value:function(){var e,t=this.getEditor().getDocBody();t&&(e=window.getComputedStyle(t).getPropertyValue("padding").split(" "),this.docBodyPadding={top:parseInt(e[0]),right:parseInt(e[1]),bottom:parseInt(e[2]),left:parseInt(e[3])})}},{key:"setEditable",value:function(e){this.editable!==e&&(this.editable=e,!this.editable&&this.isResizing&&(this.undoEffect(),this.initSizeData(),this.updateResizeBlock()))}},{key:"doResize",value:function(e,t){var n=this,r=this.props.externalServices.log;switch(e){case g.BLOCK_RESIZE_EVENT_NAME.START:this.handleMouseDown(t),r.resizeStart&&r.resizeStart();break;case g.BLOCK_RESIZE_EVENT_NAME.ING:requestAnimationFrame(function(){n.handleMouseMove(t)}),r.resizing&&r.resizing();break;case g.BLOCK_RESIZE_EVENT_NAME.END:this.handleMouseUp(),r.resizeEnd&&r.resizeEnd()}}},{key:"bindEvents",value:function(){var e,t,n,r,i,o;this.resizableContainer=this.props.container.querySelector("."+g.resizeContainerClass),this.resizableContainer&&(t=(e=this.props.externalServices.context).comment,n=e.table,r=this.getEditor(),this.filterOperationByResizeType()||(r.eventEmitter.on("editorSizeChange",this.handleEditorSizeChange),window.addEventListener("resize",this.handleWindowSizeChange)),this.isInTable?(i=n.horzResizeEventName,r.on(i,this.changeTableSize)):t&&((o=t.halfFullController).onhalfFullStartToChange(this.handleHalfFullStartToChange),this.lastCommentPosData=o.register(this.getBlockId())),r.on("fullscreenExited",this.handleWindowSizeChange))}},{key:"initTableData",value:function(){var e,t,n,r,i=this.props,o=i.container,a=i.externalServices.context.table;a&&(e=a.zoneSelector,t=a.zoneAttrKey,n=a.cellDisableSelectedClass,r=$(o).parents(e),this.isInTable=0<r.length,this.isInTable&&(this.zoneId=r.attr(t)||"0",this.props.blockResizableContainer.classList.add(n)))}},{key:"getBlockPlugin",value:function(){return this.props.block.getPlugin()}},{key:"getBlockId",value:function(){return this.props.block.blockId}},{key:"getEditor",value:function(){return this.getBlockPlugin().getEditor()}},{key:"getEditorWidth",value:function(){if(this.isInTable)return this.regionData.docWidth;var e=this.getEditor().getDocBody();return e?parseInt(e.dataset.lastWidth||"0",10):0}},{key:"initSizeData",value:function(){var e,t,n;this.updateDocBodyPadding(),this.props.block.props.size&&(t=(e=this.props.block.props.size).width,n=e.height,this.setFinalSize(t,n));var r=this.props.externalServices.context;this.setLimitSize(r)}},{key:"setLimitSize",value:function(e){var t=e.minWidth,n=e.minHeight,r=e.maxWidth,i=e.maxHeight;t&&(this.limitSize.minWidth=t),n&&(this.limitSize.minHeight=n),r&&(this.limitSize.maxWidth=r),i&&(this.limitSize.maxHeight=i)}},{key:"initBoundData",value:function(){this.updateRegionData(),this.updateCommentRect()}},{key:"updateRegionData",value:function(){var e,t,n,r,i,o,a,s,l,c,u,d,f,h,p,g,v,m;this.isInTable?(t=(e=this.props).container,r=(n=e.externalServices.context.table).cellSelector,i=n.padding,(o=$(t).parents(r)[0])&&(a=o.getBoundingClientRect().width,this.regionData.boundWidth=a-i,this.regionData.docWidth=this.regionData.boundWidth)):(s=this.props.externalServices.context.region.padding,c=(l=this.regionDom.getBoundingClientRect()).left,u=l.right,d=l.top,f=s||0,p=(h=this.getEditor().getBound().left+this.docBodyPadding.left)+this.getEditorWidth(),g=this.isRegionDocBody&&0===f?h:c+f,v=(this.isOverlayComment&&this.commentRect?this.commentRect.left:u)-(s||0),m=this.isRegionDocBody&&0===f?p:v,Object.assign(this.regionData,{boundLeft:g,boundRight:m,docLeft:h,docRight:p,offsetTop:d}),this.regionData.boundWidth=this.regionData.boundRight-this.regionData.boundRight,this.regionData.docWidth=this.regionData.docRight-this.regionData.docRight)}},{key:"updateCommentRect",value:function(){var e,t;this.isInTable||(e=this.props.externalServices.context.comment)&&(t=e.selector,$(t).length&&(this.commentRect=$(t)[0].getBoundingClientRect()))}},{key:"getBoundWidth",value:function(){if(this.isInTable)return this.regionData.boundWidth;var e=this.regionData,t=e.boundLeft;return e.boundRight-t}},{key:"getBlockMarginLeft",value:function(){if(this.isInTable)return 0;var e=this.finalWidth,t=this.regionData,n=t.boundLeft,r=t.boundRight,i=t.docLeft,o=t.docRight,a=this.getBoundWidth(),s=this.getEditorWidth(),l=i-n,c=r-o;if(this.isAlignCenter=!0,a<e)return l;if(a<e||e<s)return 0;var u=(e-s)/2;return l<u?(u=l,this.isAlignCenter=!1):c<u&&(u=e-s-c,this.isAlignCenter=!1),u}},{key:"checkIsOverlayComment",value:function(r,i){return this.lastCommentPosData.some(function(e){var t=e.top+e.transformY,n=t+e.height;return r<=n&&t<=i})}},{key:"unBindEvents",value:function(){var e,t,n,r,i,o;this.resizableContainer&&(t=(e=this.props.externalServices.context).comment,n=e.table,r=this.getEditor(),this.filterOperationByResizeType()||(r.eventEmitter.off("editorSizeChange",this.handleEditorSizeChange),window.removeEventListener("resize",this.handleWindowSizeChange)),this.isInTable?(i=n.horzResizeEventName,r.off(i,this.changeTableSize)):t&&((o=t.halfFullController).offhalfFullStartToChange(this.handleHalfFullStartToChange),o.unRegister(this.getBlockId())),this.heightUpdateNotifier.destroy(),r.off("fullscreenExited",this.handleWindowSizeChange))}},{key:"updateResizeBlockWhenDidMount",value:function(){this.isLoading=!1,this.updateRegionData(),this.updateResizeBlock()}},{key:"updateResizeBlock",value:function(){var e,t=this.getBoundWidth();this.finalWidth>t&&!this.filterOperationByResizeType()?(this.isOverlayCommentChanged&&(this.isWidthChange=!0),e=t/(this.finalWidth/this.finalHeight),this.resizeBlock(t,e)):this.resizeBlock(this.finalWidth,this.finalHeight)}},{key:"updateBlockPlaceholderSize",value:function(){var e,t,n,r,i;this.filterOperationByResizeType()||(e=this.props.container,0!==(t=$("."+c.BLOCK_LOADING_MODE,e)).length&&(r=(n=this.getStyleSize()).styleWidth,i=n.styleHeight,t.css({width:r+"px",height:i+"px"})))}},{key:"getStyleSize",value:function(){var e,t=this.getBoundWidth(),n=this.getEditorWidth(),r=this.finalWidth,i=this.finalHeight;return this.filterOperationByResizeType()&&(r=t),this.finalWidth>t&&(i=(r=t)/(this.finalWidth/this.finalHeight)),!this.isModified&&n<r&&(e=r/i,i=(r=n)/e),{styleWidth:r,styleHeight:i}}},{key:"notifyBlockWdith",value:function(){var e,t=this.props.block,n=(0,d.getBlockWidthNotifyModule)(t);n&&(e=this.getStyleSize().styleWidth,n.notifyBlockWidth(t,e))}},{key:"setStartPoint",value:function(e){var t=e.clientX,n=e.clientY;this.startPoint={clientX:t,clientY:n}}},{key:"logResizeEvent",value:function(){this.props.externalServices.log.resizeEnd()}},{key:"calcContainerSize",value:function(){this.containerMouseDownRect=this.props.container.getBoundingClientRect();var e=this.containerMouseDownRect,t=e.width,n=e.height;this.setFinalSize(t,n)}},{key:"doEffect",value:function(){this.props.setVisible(!0),this.props.blockResizableContainer.classList.add("block-resize-dragging"),document.body.classList.add("block-resizing"),document.documentElement.classList.add("resize-cursor-"+this.direction)}},{key:"undoEffect",value:function(){this.props.setVisible(!1),this.props.blockResizableContainer.classList.remove("block-resize-dragging"),document.documentElement.classList.remove("resize-cursor-"+this.direction),document.body.classList.remove("block-resizing"),this.startPoint=null,this.direction=g.DIRECTION.NONE}},{key:"setProps",value:function(){var e=this.props.block,t={size:{isModified:!0,width:this.finalWidth,height:this.finalHeight}};e.setProps(t)}},{key:"blockUpdateSize",value:function(e){var t=e.size,n=t.width,r=t.height,i=t.isModified;this.isModified=!!i,this.isResizing||n===this.finalWidth&&r===this.finalHeight||(this.heightUpdateNotifier.notifyWillUpdate(),this.setFinalSize(n,r),this.adaptResize(),this.heightUpdateNotifier.notifyDidUpdate())}},{key:"setFinalSize",value:function(e,t){this.finalWidth=e,this.finalHeight=t}},{key:"adaptResize",value:function(){var e={prev:{width:1/0},next:{width:this.getEditorWidth()}};this.editorSizeChange(e)}},{key:"resizeBlock",value:function(e,t){var n,r,i,o;this.isLoading&&this.filterOperationByResizeType()||(n=this.props.container,r=e,i=t,o=this.getEditorWidth(),!this.isModified&&o<r&&(i=(r=o)/(e/t)),r=Math.round(r),i=Math.round(i),this.filterOperationByResizeType()||(n.style.width=r+"px",n.dataset.width=""+r),n.style.height=i+"px",n.dataset.height=""+i)}},{key:"updateBlockMargin",value:function(){var e,t=this.props.container;this.isModified&&this.props.externalServices.context.region.enableResizeOutEditor&&(e=this.getBlockMarginLeft(),t.style.marginLeft=0<e?"-"+e+"px":"0")}},{key:"emitSizeEvent",value:function(e){var t=this.props.block.blockId,n=this.getBlockMarginLeft(),r=this.getBlockPlugin(),i={callerBlockId:t,leftOffset:0<n?-n:0};r&&r.event.emit(e,i),this.getEditor().call(e,i)}},{key:"filterOperationByResizeType",value:function(){return this.props.resizeType===g.ResizeType.Down}},{key:"resizeBlockFromRemote",value:function(e){var t=e.width,n=void 0===t?this.finalWidth:t,r=e.height,i=void 0===r?this.finalHeight:r,n=Math.max(n,this.limitSize.minWidth),i=Math.max(i,this.limitSize.minHeight);n=this.limitSize.maxWidth?Math.min(n,this.limitSize.maxWidth):n,i=this.limitSize.maxHeight?Math.min(i,this.limitSize.maxHeight):i,this.setFinalSize(n,i),this.resizeBlock(n,i)}},{key:"render",value:function(){return s.default.createElement(l.default,{resizeType:this.props.resizeType,sliderType:this.props.sliderType})}},{key:"isResizing",get:function(){return!!this.startPoint}},{key:"isRegionDocBody",get:function(){return this.regionDom===this.getEditor().getDocBody()}}]),y);function y(e){h(this,y);var p=v(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,e));p.resizableContainer=null,p.startPoint=null,p.direction=g.DIRECTION.NONE,p.finalWidth=0,p.finalHeight=0,p.lastCommentPosData=[],p.commentRect=null,p.isAlignCenter=!0,p.zoneId="0",p.isModified=Boolean(p.props.block.props.size&&p.props.block.props.size.isModified),p.regionData={boundLeft:0,boundRight:0,boundWidth:0,docLeft:0,docRight:0,docWidth:0,offsetTop:0},p.isOverlayComment=!1,p.isInTable=!1,p.limitSize={minWidth:g.DEFAULT_SIZE.MIN_WIDTH,minHeight:g.DEFAULT_SIZE.MIN_HEIGHT},p.editable=!1,p.containerMouseDownRect=null,p.docBodyPadding={left:0,right:0,top:0,bottom:0},p.isOverlayCommentChanged=!1,p.isWidthChange=!1,p.isLoading=!0,p.heightUpdateNotifier=new u.default({getContext:function(){return{event:p.props.block.getPlugin().event}},getBlockId:function(){return p.props.block.blockId}}),p.handleHalfFullStartToChange=function(e,t){p.lastCommentPosData=t;var n,r,i=p.props.externalServices.context.comment;i&&(n=i.halfFullController,r=p.getBlockId(),p.commentRect||p.updateCommentRect(),p.isOverlayCommentChanged=!1,p.commentPositionUpdated(),n.halfFullIsChanged(r,e))},p.commentPositionUpdated=function(){var e,t,n,r,i,o;p.isOverlayCommentChanged||p.isResizing||p.isInTable||0===p.getEditorWidth()||(t=(e=p.props.container.getBoundingClientRect()).top,n=e.height,i=(r=t+p.getBlockPlugin().getEditor().getScrollTop()-p.regionData.offsetTop)+n,o=p.checkIsOverlayComment(r,i),p.isWidthChange||(p.isOverlayCommentChanged=o!==p.isOverlayComment,p.isOverlayCommentChanged&&(p.isOverlayComment=o,p.updateRegionData(),p.updateResizeBlock(),p.resetOverlayCommentChanged()),p.updateBlockMargin(),p.emitSizeEvent(g.BLOCK_RESIZE_EVENT_NAME.COMMENT_OVERLAY_CHANGE)),p.isWidthChange=!1)},p.changeTableSize=(0,r.default)(function(e){var t,n,r,i,o=e.colWidth,a=e.diffX;-1!==e.colCellIds.indexOf(p.zoneId)&&(t=o+a-p.props.externalServices.context.table.padding,n=p.finalWidth/p.finalHeight,r=Math.max(p.limitSize.minWidth,p.limitSize.minHeight/n),i=Math.max(t,r),p.regionData.boundWidth=i,p.regionData.docWidth=i,p.updateResizeBlock())},100),p.handleWindowSizeChange=(0,i.default)(function(){p.updateDocBodyPadding(),p.updateRegionData(),p.updateResizeBlock(),p.updateCommentRect(),p.commentPositionUpdated(),p.updateBlockMargin()},100),p.editorSizeChange=function(e){!p.isResizing&&p.isOverlayCommentChanged||(Math.ceil(e.next.width)!==Math.ceil(e.prev.width)&&(p.updateDocBodyPadding(),p.updateRegionData(),p.updateResizeBlock()),p.commentPositionUpdated(),p.updateBlockMargin())},p.handleEditorSizeChange=(0,i.default)(p.editorSizeChange,100,{leading:!1}),p.resetOverlayCommentChanged=(0,r.default)(function(){p.isOverlayCommentChanged=!1},100),p.handleMouseDown=function(e){if(p.editable){var t=e.target;if(t.classList.contains(g.sliderClass)){if(p.setStartPoint(e),p.calcContainerSize(),p.direction=t.dataset.direction,!p.direction)throw new Error(" data-direction ");p.doEffect(),p.emitSizeEvent(g.BLOCK_RESIZE_EVENT_NAME.START);var n=p.props.block;n.handleResizeStart&&n.handleResizeStart()}else p.startPoint=null}},p.handleMouseMove=function(e){var t,n,r,i,o,a,s,l,c,u,d,f,h;p.startPoint&&p.direction&&(p.isModified||(p.isModified=!0),t=p.startPoint,n=p.direction,i=(r=p.props).resizeType,(o=r.block).beforeMouseMove&&o.beforeMouseMove(e),a=e.clientX,s=e.clientY,l=a-t.clientX,c=s-t.clientY,p.setStartPoint(e),u=p.finalWidth/p.finalHeight,n.includes(g.DIRECTION.EAST)||n.includes(g.DIRECTION.WEST)?l*=p.isAlignCenter?2:1:!e.shiftKey&&(n.includes(g.DIRECTION.EAST)||n.includes(g.DIRECTION.WEST))||(l=e.shiftKey?c*u:0),n.includes(g.DIRECTION.SOUTH)||n.includes(g.DIRECTION.NORTH)||(c=0),f=n.includes(g.DIRECTION.WEST)?p.finalWidth-l:p.finalWidth+l,d=0,f=Math.max(p.limitSize.minWidth,f),h=p.getBoundWidth(),f=Math.min(h,f),e.shiftKey||i===g.ResizeType.Fixed?(d=f/u)<p.limitSize.minHeight&&(d=p.limitSize.minHeight,f=p.limitSize.minHeight*u):(d=n.includes(g.DIRECTION.SOUTH)?p.finalHeight+c:p.finalHeight-c,d=Math.max(p.limitSize.minHeight,d)),o.afterMouseMoveAndResize&&o.afterMouseMoveAndResize(f,d),p.setFinalSize(f,d),p.resizeBlock(f,d),p.updateBlockMargin(),p.emitSizeEvent(g.BLOCK_RESIZE_EVENT_NAME.ING),o.afterMouseMoveAndResize&&o.afterMouseMoveAndResize(p.finalWidth,p.finalHeight))},p.handleMouseUp=function(){var e;p.startPoint&&(p.undoEffect(),p.setProps(),p.updateBlockMargin(),p.emitSizeEvent(g.BLOCK_RESIZE_EVENT_NAME.END),p.logResizeEvent(),(e=p.props.block).handleResizeEnd&&e.handleResizeEnd(p.finalWidth,p.finalHeight))},p.initSizeData(),p.initTableData();var t=p.props.externalServices.context.region.selector;return p.regionDom=document.querySelector(t),p}t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=n(1),c=n(6);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=(i(d,[{key:"getBlockBlongZoneId",value:function(e){if(this.blockCore instanceof l.BlockPlugin){var t=this.blockCore.entryMap.get(e.blockId);return t?t.zone:""}return""}},{key:"blockDidMount",value:function(e){this.setTableCellNotifyWidth(e)}},{key:"setTableCellNotifyWidth",value:function(e){var t;!e.getNotifyWidth||null!==(t=e.getNotifyWidth())&&this.notifyBlockWidth(e,t)}},{key:"notifyBlockWidth",value:function(e,t){var n=this.externalServices.setTableCellMinWidthKey,r=this.getBlockBlongZoneId(e);r!==c.DEFAULT_REP_ZONE&&this.blockCore.editor.call(n,{zoneId:r,blockId:e.blockId,minWidth:t})}},{key:"clearTableCellMinWidth",value:function(e,t){var n=this.externalServices.clearTableCellMinWidthKey;this.blockCore.editor.call(n,{zoneId:t,blockId:e})}},{key:"unmount",value:function(){var e=this.externalServices;e.dropBeforeApplyFinishEventName&&this.editor.on(e.dropBeforeApplyFinishEventName,this.notifyBlockWidthBeforDropFinish),e.dropAfterApplyFinishEventName&&this.editor.on(e.dropAfterApplyFinishEventName,this.notifyBlockWidthAfterDropFinish),this.blockCore.event.off("blockDelete",this.blockDelete)}}]),d);function d(e,t){var a=this;u(this,d),this.className="widthNotify",this.blockDelete=function(e){var t=a.getBlockBlongZoneId(e);a.clearTableCellMinWidth(e.blockId,t)},this.notifyBlockWidthBeforDropFinish=function(e){var o=e.oldZoneId,t=e.oldLine;o!==c.DEFAULT_REP_ZONE&&a.editor.getAllAttributesOnLine(o,t).forEach(function(e){var t,n=s(e,2),r=n[0],i=n[1];r===l.BLOCK_DATA_META_BLOCK_PROPS&&(t=JSON.parse(i),a.clearTableCellMinWidth(t.blockId,o))})},this.notifyBlockWidthAfterDropFinish=function(e){var t=e.newZoneId,n=e.newLines;c.DEFAULT_REP_ZONE!==t&&n.forEach(function(e){a.editor.getAllAttributesOnLine(t,e).forEach(function(e){var t,n,r=s(e,2),i=r[0],o=r[1];i===l.BLOCK_DATA_META_BLOCK_PROPS&&(t=JSON.parse(o).blockId,(n=a.blockCore.blockInfos.get(t))&&a.setTableCellNotifyWidth(n.instance))})})},this.blockCore=e,this.externalServices=t,this.editor=this.blockCore.getEditor(),t.dropBeforeApplyFinishEventName&&this.editor.on(t.dropBeforeApplyFinishEventName,this.notifyBlockWidthBeforDropFinish),t.dropAfterApplyFinishEventName&&this.editor.on(t.dropAfterApplyFinishEventName,this.notifyBlockWidthAfterDropFinish),this.blockCore.event.on("blockDelete",this.blockDelete)}a.injectClasses=[],t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("g",{fillRule:"evenodd"},i.default.createElement("path",{d:"M12 20a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-1.5a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13z",fillRule:"nonzero"}),i.default.createElement("path",{d:"M13.46 13.47l-4.26 1.8a.36.36 0 0 1-.47-.47l1.84-4.22 4.23-1.85a.36.36 0 0 1 .48.48l-1.82 4.26z"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=v(n(8)),o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var i=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},c=v(n(0)),u=v(n(5)),d=n(1),f=n(100),h=n(101),p=v(n(7));n(102);var g=n(2);function v(e){return e&&e.__esModule?e:{default:e}}function m(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function k(e){return e.map(function(e){var t=e.commentId,n=e.offsetTop;return{commentId:t||"",thirdPartyHeight:e.offsetHeight,relativeTopToThirdParty:n,quote:e.quote}})}var C,I,S,T,O,w,R=(E(x,d.CommentableBlock),i(x,[{key:"isShowHistoryPlaceholder",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e;return t.historyMode===g.HISTORY_MODE.PLACEHOLDER||t.historyMode===g.HISTORY_MODE.PLACEHOLDER_NEW}},{key:"getSheetBridge",value:function(){return this.ExternalServices.getSheetBridge()}},{key:"onSearch",value:function(e){var t=this,n=e.searchKey,r=x.processToken(this.blockToken).sheetId,i=this.getSheetBridge();return r&&i&&i.getSearchResult?i.getSearchResult(r,n).map(function(e){return Object.assign({},e,{searchKey:n,blockId:t.blockId,isReplaceable:!0})}):[]}},{key:"onHighlight",value:function(e,t){var n=x.processToken(this.blockToken).sheetId,r=this.getSheetBridge();n&&r&&r.highlightSearchItem(n,e,t)}},{key:"onCancelSearch",value:function(e){var t=x.processToken(this.blockToken).sheetId,n=this.getSheetBridge();t&&n&&n.clearSearchResult(t,e)}},{key:"onReplace",value:function(e){var t=x.processToken(this.blockToken).sheetId,n=this.getSheetBridge();t&&n&&n.replaceSearchItem(t,e)}},{key:"onGetNextTimes",value:function(e){var t=e.context,n=e.replaceText,r=t.searchKey;return r&&-1!==n.toLowerCase().indexOf(r.toLowerCase())?1:0}},{key:"getEditbarOffset",value:function(){var e=(this.context.permissions||{editable:!1}).editable;this.toolbar&&this.toolbar.show();var t,n,r,i,o={x:20,y:0,transformXPercent:0,transformYPercent:-100};return this.mountPoint&&!e&&(t=this.mountPoint.getBoundingClientRect(),n=this.internalWidth||t.width,r=this.editor.getDocBody().dataset.lastWidth||"",i=parseInt(r)||730,o.x=Math.min(i,n)/2,o.transformXPercent=-50),o}},{key:"commentQuota",value:function(){return"["+this.ExternalServices.t("common.sheet")+"]"}},{key:"collectText",value:function(){return"["+this.ExternalServices.t("common.sheet")+"]"}},{key:"onEditbarUnmount",value:function(){this.toolbar&&this.toolbar.hideAllDialog()}},{key:"onCopy",value:function(){var e=x.processToken(this.blockToken).sheetId;return{html:this.getSheetBridge().handleCopy(e),text:this.ExternalServices.t("block.common_paste_unsupported")}}},{key:"shouldPreventCopy",value:function(){return!0}},{key:"blockDidCreate",value:function(){var e=x.processToken(this.blockToken).sheetId;if(e){this.getSheetBridge().sheetBlockEnterBuffer(e);var t={createSource:"unknown",rowCount:0,colCount:0,pasteFrom:""};if(this.dataSet.initData)try{var n=unescape(this.dataSet.initData),r=JSON.parse(n);t.createSource=r.createSource||"unknown",t.pasteFrom=r.pasteFrom||"Other",t.rowCount=r.cs.content[0].value.snapshot.rowCount||0,t.colCount=r.cs.content[0].value.snapshot.columnCount||0}catch(e){t.createSource="paste",t.rowCount=0,t.colCount=0,console.log(e)}this.ExternalServices.LogService.collectEvent("client_sheet_insert",{block_id:e,block_type:"sheet",create_source:t.createSource,paste_from:"paste"===t.createSource?t.pasteFrom:"",row_num:t.rowCount,col_num:t.colCount})}}},{key:"getCommentMarks",value:function(){var e=x.processToken(this.blockToken).sheetId;return e?k(this.getSheetBridge().getComments(e)):[]}},{key:"getActiveComments",value:function(){var e=x.processToken(this.blockToken).sheetId;return e?k(this.getSheetBridge().getActiveComments(e)):[]}},{key:"getResolvedComments",value:function(){var e=x.processToken(this.blockToken).sheetId;return e?k(this.getSheetBridge().getResolvedComments(e)):[]}},{key:"setResolvedCommentIds",value:function(e){var t=x.processToken(this.blockToken).sheetId;return t?this.getSheetBridge().setResolvedCommentIds(t,e):[]}},{key:"setCommentData",value:function(e){var t=x.processToken(this.blockToken).sheetId;if(t)return this.getSheetBridge().setCommentData(t,e)}},{key:"startNewComment",value:function(e,t){var n=x.processToken(this.blockToken).sheetId;return n?this.getSheetBridge().startNewComment(n,e,t).cellCordinate:""}},{key:"saveCommentMark",value:(w=m(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=x.processToken(this.blockToken),i=r.sheetId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.getSheetBridge().saveComment(i,n,t));case 4:case"end":return e.stop()}},e,this)})),D)},{key:"removeCommentMark",value:(O=m(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=x.processToken(this.blockToken),r=n.sheetId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.getSheetBridge().removeComment(r,t));case 4:case"end":return e.stop()}},e,this)})),L)},{key:"removeTempCommentMark",value:function(e){var t=x.processToken(this.blockToken).sheetId;if(t)return this.getSheetBridge().removeTempComment(t,e)}},{key:"resolveCommentMark",value:(T=m(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=x.processToken(this.blockToken),r=n.sheetId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.getSheetBridge().resolveComment(r,t));case 4:case"end":return e.stop()}},e,this)})),_)},{key:"activateComment",value:function(e){var t=x.processToken(this.blockToken).sheetId;if(t)return this.getSheetBridge().activateComment(t,e)}},{key:"deactivateComment",value:function(e){var t=x.processToken(this.blockToken).sheetId;if(t)return this.getSheetBridge().deactivateComment(t,e)}},{key:"reopenComment",value:(S=m(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=x.processToken(this.blockToken),r=n.sheetId){e.next=3;break}return e.abrupt("return");case 3:return e.abrupt("return",this.getSheetBridge().reopenComment(r,t));case 4:case"end":return e.stop()}},e,this)})),A)},{key:"addHoverHighlight",value:function(e){var t=x.processToken(this.blockToken).sheetId;if(t)return this.getSheetBridge().addHighlight(t,e)}},{key:"removeHoverHighlight",value:function(e){var t=x.processToken(this.blockToken).sheetId;if(t)return this.getSheetBridge().removeHighlight(t,e)}},{key:"locateComment",value:(I=m(regeneratorRuntime.mark(function e(t){var n,r,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=x.processToken(this.blockToken),r=n.sheetId){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.getSheetBridge().findComment(r,t);case 5:if(i=e.sent){e.next=8;break}return e.abrupt("return",null);case 8:return o=i.offsetHeight,a=i.offsetTop,e.abrupt("return",{top:a,height:o});case 10:case"end":return e.stop()}},e,this)})),N)},{key:"render",value:(C=m(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s,l,c=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isShowHistoryPlaceholder())return u.default.render(this.getHistoryView(),this.mountPoint),e.abrupt("return");e.next=3;break;case 3:if(t=this.attributes,n=t.selected,r=t.selectState,i=this.context.undoDispatcher,o=x.processToken(this.blockToken),a=o.sheetId,s=o.token,l=this.getSheetBridge(),a&&n!==this.selected&&void 0!==n&&(this.selected=n,l.updateSheetSelectionState(a,this.selected)),a&&r!==this.selectState&&void 0!==r&&(this.selectState=r,l.updateSelectionState&&l.updateSelectionState(a,this.selectState)),!this.rendered&&s&&a){e.next=11;break}return e.abrupt("return");case 11:if(this.setBlockIdForSheetId(a,this.blockId),this.hasSetCommentBatchUpdateListener||(this.ExternalServices.setOnCommentBatchUpdate(a,this.onCommentBatchUpdate),this.hasSetCommentBatchUpdateListener=!0),this.notifyCommentStartLoading(),this.rendered=!0,!this.toolbar&&a&&(this.toolbar=new f.EmbedBlockToolbar(a,this)),i){e.next=18;break}return e.abrupt("return");case 18:return console.log("MountingSheet: "+a),this.heightUpdateNotifier.notifyWillUpdate(),e.next=22,this.getSheetBridge().mountSheet({token:s,sheetId:a,editor:this.editor,host:this.mountPoint,deleteFn:function(){var e=c.context.triggerDelete;e&&e()},csQueue:this.collabQueue,undoDispatcher:i,onFullScreen:function(){c.listenToCommentUpdate(),c.setAttributes({isFullscreen:!0})},onExitFullScreen:function(){c.stopListenToCommentUpdate(),c.setAttributes({isFullscreen:!1})},isTemplate:this.context.isTemplate,onCutWholeSheet:function(e){var t=e.text,n=e.html,r=c.context.triggerCopy;r&&r({block:c,pasteData:{text:t,html:n}},"cut")},onAddComment:this.onAddFullScreenComment,onContextMenuComment:function(){var e=c.context.triggerComment;e&&e({block:c})},onInternalSizeChange:function(e,t){var n=c.context.triggerInternalSizeChange;n&&n({block:c},e,t)},onActiveCommentChange:this.onActiveCommentChange,onDeleteComment:this.onDeleteComment,onEditComment:this.onEditComment,onReplyComment:this.onReplyComment,onReadComment:this.onReadComment,onResolveComment:this.onResolveComment,onCommentLoaded:this.onCommentLoaded,onHeightWillUpdate:this.heightUpdateNotifier.notifyWillUpdate,onHeightDidUpdate:this.heightUpdateNotifier.notifyDidUpdate,onMountStatusChange:this.onMountStatusChange,onRectChange:this.onRectChange});case 22:this.heightUpdateNotifier.notifyDidUpdate(),this.notifyContentReady(),console.log("SheetMounted: "+a);case 25:case"end":return e.stop()}},e,this)})),M)},{key:"getHistoryView",value:function(){return c.default.createElement("div",{className:"sheet-placeholder"},c.default.createElement("div",{className:"sheet-placeholder-t"},this.ExternalServices.t("common.form")),c.default.createElement("div",{className:"sheet-placeholder-b clearfix"},new Array(24).fill(0).map(function(e){return c.default.createElement("span",null)})))}},{key:"getSheetNoExistsView",value:function(){var e=this.ExternalServices.failImgSrc;return c.default.createElement("div",{className:"sheet-no-exists-placeholder"},c.default.createElement("div",{className:"fail-img"},c.default.createElement("img",{width:"100%",src:e})),c.default.createElement("div",{className:"fail-text"},this.ExternalServices.t("feed.load_failed")))}},{key:"blockDidMount",value:function(){var e;this.isShowHistoryPlaceholder()||(e=this.ExternalServices.onSheetBlockMount)&&e(x.processToken(this.blockToken).sheetId)}},{key:"blockDidUnmount",value:function(){var e=this.ExternalServices.onSheetBlockUnmount;e&&e(x.processToken(this.blockToken).sheetId)}},{key:"delete",value:function(){var e=x.processToken(this.blockToken).sheetId;e&&this.getSheetBridge().delSheet(e)}},{key:"unmount",value:function(e){s(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"unmount",this).call(this,e);var t=x.processToken(this.blockToken).sheetId,n=this.getSheetBridge();e&&t?n&&n.delSheet(t):t&&n&&n.unmountSheet(t),this.toolbar&&this.toolbar.destroy(),this.heightUpdateNotifier.destroy()}},{key:"resize",value:function(e,t,n,r){var i;this.context.presentationMode!==d.PresentationMode.PAGED&&(void 0!==n&&void 0!==r?(i=x.processToken(this.blockToken).sheetId)&&this.ExternalServices.setWidth(n,r,i):this.ExternalServices.setMaxWidth(e))}},{key:"updateHighlight",value:function(e){var t=x.processToken(this.blockToken).sheetId,n=this.getSheetBridge();t&&n&&n.updateHighlight&&n.updateHighlight(t,e)}},{key:"getTeaParams",value:function(e){console.log(e)}},{key:"onTap",value:function(){return{preventFocus:!0}}},{key:"onLongTap",value:function(){return{preventFocus:!0}}},{key:"blockContext",get:function(){return this.context}}],[{key:"processToken",value:function(e){var t,n,r=null,i=null;return"string"==typeof e&&(t=e.split(/_/,2),r=(n=o(t,2))[0],i=n[1]),{token:r,sheetId:i}}}]),x);function x(e,t,n,r,i){y(this,x);var o=b(this,(x.__proto__||Object.getPrototypeOf(x)).call(this,e,t));o.editor=n,o.isReplaceable=!0,o.mobileSizeMode=d.MobileBlockSizeMode.OVER_SIZE,o.editbarCommands=[],o.toolbar=null,o.selected=!1,o.selectState=d.SelectionState.NONE,o.hasSetCommentBatchUpdateListener=!1,o.shouldKeepAlive=!1,o.contentAsyncRender=!0,o.heightUpdateNotifier=new p.default({getContext:function(){return o.context},getBlockId:function(){return o.blockId}}),o.rendered=!1,o.editbarPin=!0,o.onAddFullScreenComment=function(e,t,n,r){return o.addComment({commentId:e,replyId:t,content:n,quote:r})},o.onActiveCommentChange=function(){o.activeCommentChange()},o.onDeleteComment=function(e,t){return o.removeComment({commentId:e,replyId:t})},o.onEditComment=function(e,t,n){return o.updateComment({commentId:e,replyId:t,content:n})},o.onReplyComment=function(e,t,n){return o.replyComment({commentId:e,replyId:t,content:n})},o.onReadComment=function(e,t){return o.readComment({commentId:e,replyId:t})},o.onResolveComment=function(e){return o.resolveComment(e)},o.onCommentLoaded=function(e){return o.notifyCommentLoaded(k(e))},o.onCommentBatchUpdate=function(e){return o.notifyCommentUpdate(k(e))},o.onRectChange=function(e){var t=Object.assign({blockId:o.blockId},e);o.editor.call("onSheetRectChange",t)},o.onMountStatusChange=function(e){e===h.SheetMountStatus.NO_EXISTS&&u.default.render(o.getSheetNoExistsView(),o.mountPoint)},o.enterBuffer=function(){var e,t=x.processToken(o.blockToken).sheetId;!t||(e=o.getSheetBridge())&&e.sheetBlockEnterBuffer(t)},o.leaveBuffer=function(){var e,t=x.processToken(o.blockToken).sheetId;!t||(e=o.getSheetBridge())&&e.sheetBlockLeaveBuffer(t)},o.getBlockScrollStatus=function(){var e=x.processToken(o.blockToken).sheetId;if(e){var t=o.getSheetBridge();if(t)return t.getScrollStatus&&t.getScrollStatus(e)}},o.dataSet=t;var a,s=(o.ExternalServices=r).Utils.isShortCut;return o.supportsHalfFullScreen=!(s&&s()||o.isShowHistoryPlaceholder()),o.collabQueue=(0,l.default)(n,"plugins.client.collabQueue"),o.ExternalServices=r,o.setBlockIdForSheetId=i,t.token&&(a=x.processToken(t.token).sheetId,o.ExternalServices.setOnCommentBatchUpdate(a,o.onCommentBatchUpdate),o.hasSetCommentBatchUpdateListener=!0),o}function M(){return C.apply(this,arguments)}function N(e){return I.apply(this,arguments)}function A(e){return S.apply(this,arguments)}function _(e){return T.apply(this,arguments)}function L(e){return O.apply(this,arguments)}function D(e,t){return w.apply(this,arguments)}t.default=R},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InsertSheetSource=void 0,t.generateLoadingDataSet=a,t.generateInsertSheetDataSetWithSideEffect=s,t.generateDataSet=i;var r,u=n(1),o=t.InsertSheetSource=void 0;function a(e){return(0,u.generateBlockDataSet)({initData:e,blockType:u.BlockType.SHEET_BLOCK,depLoading:!0})}function s(e,t){var n=t.addSheet(e.rowCount,e.colCount),r=(0,u.generateBlockDataSet)({blockType:u.BlockType.SHEET_BLOCK,initData:{cs:n,member_id:(0,u.getMemberId)(),createSource:e.createSource||""}}),i=n.content.find(function(e){return"copySheet"===e.action});return i&&t.registerOrphanSheetId(r.blockId,i.sheet_id),r}function i(e,t,n,r){var i=n.withComment,o=void 0===i||i,a=n.pasteFrom,s=r.pasteSheet(e,t,o);if(!s)return null;var l=(0,u.generateBlockDataSet)({blockType:u.BlockType.SHEET_BLOCK,initData:{cs:s,member_id:(0,u.getMemberId)(),createSource:"paste",pasteFrom:a}}),c=s.content.find(function(e){return"copySheet"===e.action});return c&&r.registerOrphanSheetId(l.blockId,c.sheet_id),l}(r=o||(t.InsertSheetSource=o={})).Paste="paste",r.Insert="insert",t.default=function(e,t){var n=e.plugins.blockPlugin,r=n.getBlockManager().getBlockCreator(u.BlockType.SHEET_BLOCK),i=void 0,i=r.getIsDepLoaded()?s(t,r.ExternalServices):a({source:o.Insert,insertParams:{sheetSize:t}});return n.insertBlock(i),i}},function(e,t){e.exports=o("PyL4")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var k=c(n(8)),o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var i=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l=c(n(32)),u=n(1);function c(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g,v,m,y={position:"relative",top:17,transform:"none","z-index":5,left:"20px"},b=[u.KeyCode.BackSpace,u.KeyCode.Delete],E=(p(C,l.default),i(C,[{key:"bindEvents",value:function(){this.mountPoint.addEventListener("mousedown",this.handleMouseDown)}},{key:"unBindEvents",value:function(){this.mountPoint.removeEventListener("mousedown",this.handleMouseDown)}},{key:"selectionIsRange",value:function(){var e=window.getSelection();return e&&"Range"===e.type}},{key:"isCaretInBlockInstance",value:function(){var e=window.getSelection(),t=(0,k.default)(e,"focusNode",null),n=(0,k.default)(e,"focusNode.nextSibling",null),r=(0,k.default)(e,"focusNode.parentNode",null),i=r.parentNode,o=document.querySelector(".bitable-float-toolbar-wrapper");return[t,n,r,i].some(function(e){var t=e&&/block-mode|block-spin|block-loading|embeded-faster-view|j-safari-selection|bitable-toolbar-doc-wrapper|comment-btn-separator|block-placeholder/.test(e.className);return!t&&o&&(t=o.contains(e)),t})}},{key:"collectText",value:function(){return"["+this.ExternalServices.t("common.bitable")+"]"}},{key:"_createOverlayMount",value:function(e){var t=e.querySelector(".block-overlay")||document.createElement("div");return t.className="block-overlay",e.appendChild(t),t}},{key:"_initOverlayMount",value:function(){var e=this.editor.getScrollContainer(),t=document.querySelector(".global-overlay-container");return{globalOverlayMount:t&&this._createOverlayMount(t),scrollOverlayMount:e&&this._createOverlayMount(e)}}},{key:"getMenuStyle",value:function(e){return e?{top:81,position:"fixed",transform:"translateX(20px)","z-index":5,left:"unset"}:y}},{key:"getEditbarOffset",value:function(){return{xRight:20,y:16,transformXPercent:0,transformYPercent:0}}},{key:"collapseLineChange",value:function(e){var t=C.processToken(this.blockToken).bitableId,n=this.getBitableBridge();t&&n&&n.collapseLineChange&&n.collapseLineChange(t,e)}},{key:"updateHighlight",value:function(e){var t=C.processToken(this.blockToken).bitableId,n=this.getBitableBridge();t&&n&&n.updateHighlight&&n.updateHighlight(t,e)}},{key:"shouldPreventCopy",value:function(){return!0}},{key:"onCopy",value:function(){var e=this.getBitableInfo().bitableId,t=this.getBitableBridge();if(!(e&&t&&"handleCopy"in t))return{html:"bitable copy html",text:"bitable copy text"};var n=t.handleCopy(e);this.dataset.initData=n;var r="bitable copy text";return{html:(0,u.generateBlockHTML)(Object.assign({},this.dataset,{token:""}),r),text:r,data:n}}},{key:"resize",value:(m=d(regeneratorRuntime.mark(function e(t,n,r,i){var o,a,s,l,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.context.presentationMode,a=this.editor.getDocBody().offsetWidth-60||730,this._docWidth!==a)return e.next=5,this.ExternalServices.setDocWidth(a);e.next=6;break;case 5:this._docWidth=a;case 6:if(o!==u.PresentationMode.PAGED&&(void 0!==r&&void 0!==i?(s=C.processToken(this.blockToken),(l=s.bitableId)&&(this._fullWidth===r&&this._leftMargin===i||(this._fullWidth=r,this._leftMargin=i,this.ExternalServices.setWidth(r,i,l)))):this.ExternalServices.setMaxWidth(t)),(c=this.getBitableBridge())&&this._presentationMode!==o){e.next=10;break}return e.abrupt("return");case 10:(this._presentationMode=o)===u.PresentationMode.NONE?window.requestAnimationFrame(function(){c.unfreeze(),c.setZoom(1),c.syncVirtualScroll()}):c.freeze();case 12:case"end":return e.stop()}},e,this)})),T)},{key:"unmount",value:function(e){s(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"unmount",this).call(this,e),this.unBindEvents(),this.heightUpdateNotifier.destroy()}},{key:"blockDidCreate",value:function(){this.ExternalServices.LogService.LogFlow("client_bitable_insert").report({block_id:this.blockId})}},{key:"notify",value:(v=d(regeneratorRuntime.mark(function e(t){var n,r,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("screenshot"!==t.eventType){e.next=12;break}if((n=this.getBitableBridge())&&n.takeScreenShot&&this.bitableId){e.next=4;break}return e.abrupt("return");case 4:if(t.status===u.NotifyStatus.start)return r=t.detail,i=(void 0===r?{}:r).isBlob,o=void 0===i||i,e.next=9,n.takeScreenShot(this.bitableId,o,!0);e.next=9;break;case 9:if(t.status===u.NotifyStatus.end)return e.next=12,n.takeScreenShot(this.bitableId,!0,!1);e.next=12;break;case 12:case"end":return e.stop()}},e,this)})),S)},{key:"render",value:(g=d(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"render",this).call(this);case 2:case"end":return e.stop()}},e,this)})),I)},{key:"overlayContainer",get:function(){var e=this._initOverlayMount().scrollOverlayMount;return this._overlayContainer=e.querySelector(".block-overlay-"+this.blockId)||void 0,this._overlayContainer||(this._overlayContainer=document.createElement("div"),this._overlayContainer.className="block-overlay-"+this.blockId,e.appendChild(this._overlayContainer)),this._overlayContainer}}],[{key:"processToken",value:function(e){var t,n,r=void 0,i=void 0;return"string"==typeof e&&(t=e.split(/_/,2),r=(n=o(t,2))[0],i=n[1]),{token:r,bitableId:i}}}]),C);function C(e,t,n,r){f(this,C);var E=h(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,e,t,r,n));return E.editbarCommands=[],E.editbarTrigger=u.Trigger.hover,E.editbarPin=!1,E.menuStyle=y,E.selected=!1,E._fullWidth=0,E._leftMargin=0,E._docWidth=0,E._presentationMode=u.PresentationMode.NONE,E._preventSelect=!1,E._prevLineNu=null,E._prevHeight=null,E.shouldKeepAlive=!1,E.selectionChange=function(){var e,t=E.editor.getRep();!t.selStart||null!==E._prevLineNu&&E._prevLineNu===t.selStart[0]||(E._prevLineNu=t.selStart[0],(e=E.editor.domToRep(E.mountPoint.parentElement))&&e.selStart[0]!==t.selStart[0]&&(E._preventSelect=!1))},E.preventKeyDown=function(e){!(!E.selected&&-1<b.indexOf(e.keyCode)&&(0,u.isCaretOnBlock)(E.editor.getRep(),E.blockId)&&E.isCaretInBlockInstance())||e.target&&e.target.tagName&&"input"===e.target.tagName.toLowerCase()||(e.stopImmediatePropagation(),e.preventDefault())},E.handleMouseDown=function(){E._preventSelect=!0},E.updateVerticalPosition=function(e){var t,n,r,i,o=E.getBitableBridge();o&&(n=(t=E.getBitableInfo().bitableId)?[t]:[],e?(r=e.prev,i=e.next,r.height!==i.height&&o.syncVirtualScroll(n)):o.syncVirtualScroll(n))},E.getBitableInfo=function(){var e=C.processToken(E.blockToken),t=e.token,n=e.bitableId;return{token:t,bitableId:E.bitableId=n}},E.getBitablePosition=function(){var e=document.querySelector(".navigation-bar-wrapper"),t=E.editor.getScrollContainer(),n=E.mountPoint.querySelector(".bitable-toolbar-doc-wrapper"),r=0;e&&(r=e.getBoundingClientRect().bottom);var i=0;t&&t.getBoundingClientRect&&(i=t.getBoundingClientRect().left);var o=(0,k.default)(n,"offsetHeight",0),a=110,s=E.mountPoint.querySelector(".embeded-faster-view"),l=E.mountPoint.querySelector(".embeded-faster-dom-wrapper");if(!s||!l)return{};var c=s.getBoundingClientRect(),u=l.getBoundingClientRect(),d=u.top<r&&c.bottom<=u.height+r,f=c.bottom>a+r,h=d&&f,p=E.ExternalServices.Helpers;if(p){var g=p.browser.isSafari,v=$(document.body),m=v.hasClass("fs-mode-non-paged")||v.hasClass("fs-mode");if(!g&&!m){if(h){var y=r+o;return{left:c.left,top:y}}if(d&&!f)return{left:c.left,top:c.bottom-o}}if(E.editbarPin)return c;var b=E.editor.getScrollTop()||0;return{left:c.left-i,top:c.top-r+b}}},E.beforeMountBitable=function(){var e=E.attributes.selected,t=E.getBitableBridge();E.bitableId&&t&&t.updateBitableSelectionState&&(e||(E._preventSelect=!1),e!==E.selected&&void 0!==e)&&(e&&(E._preventSelect&&(0,u.isCaretOnBlock)(E.editor.getRep(),E.blockId)||!E.selectionIsRange()&&!E.isCaretInBlockInstance())||(E._preventSelect=!1,E.selected=e,t.updateBitableSelectionState(E.bitableId,E.selected)))},E.onInternalSizeChange=function(e,t,n){var r=E.context.triggerInternalSizeChange;r&&r({block:E},e,t),void 0!==n&&n!==E._prevHeight&&(E._prevHeight=n)},E.onEditbarPinChange=function(e){var t,n,r;e!==E.editbarPin&&(E._overlayContainer&&(n=(t=E._initOverlayMount()).globalOverlayMount,r=t.scrollOverlayMount,e?n&&n.appendChild(E._overlayContainer):r&&r.appendChild(E._overlayContainer)),E.editbarPin=e,E.menuStyle=E.getMenuStyle(e),E.blockContext.updateEditbar&&E.blockContext.updateEditbar([],E))},E.leaveBuffer=function(){var e;!E.bitableId||(e=E.ExternalServices).onLeaveBuffer&&e.onLeaveBuffer(E.bitableId)},E.enterBuffer=function(){var e;!E.bitableId||(e=E.ExternalServices).onEnterBuffer&&e.onEnterBuffer(E.bitableId)},E.supportsHalfFullScreen=!E.isShowHistoryPlaceholder(),E.bindEvents(),E}function I(){return g.apply(this,arguments)}function S(e){return v.apply(this,arguments)}function T(e,t,n,r){return m.apply(this,arguments)}t.default=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateLoadingDataSet=t.InsertBitableSource=void 0;var r=o(n(8));t.logPaste=u,t.getDataSetFromPasteWithSideEffect=g,t.generatePasteBitableDataSet=d,t.generateInsertBitableDataSet=m,t.pasteBitableDataSet=y;var f=n(1),a=n(61),i=o(n(41)),h=o(n(10));function o(e){return e&&e.__esModule?e:{default:e}}var s,l=t.InsertBitableSource=void 0;(s=l||(t.InsertBitableSource=l={})).Paste="paste",s.Insert="insert";var c=t.generateLoadingDataSet=function(e){return(0,f.generateBlockDataSet)({initData:e,props:{renderSource:f.RenderSource.doc},blockType:f.BlockType.BITABLE_BLOCK,depLoading:!0})};function u(e,t){if((0,r.default)(t,"LogService.LogFlow"))try{var n=JSON.parse(e);t.LogService.LogFlow("client_bitable_insert").push({create_source:"paste",field_num:Object.keys((0,r.default)(n,"snapshot.fieldMap")).length,record_num:Object.keys((0,r.default)(n,"snapshot.recordMap")).length})}catch(e){}}function p(e,t){console.info("get bitableData fail"),console.error(e);var n,r,i,o,a=e.stack||e.toString(),s=t.getLogService&&t.getLogService();s&&(n="global_unhandle_exception",r="bitable_doc_paste_error",i="ee.docs.bitable.error",s.teaLog({key:r,name:e.name,stack:a||"",info:e.message}),o={tags:{scm:JSON.stringify(window.scm||{}),name:i,key:n,info:a||""}},s.ravenCatch(e,o))}function g(e,t,n){try{var r=JSON.parse(e);i.default.pasteViewIndex=r.viewIndex}catch(e){return p(e,n),null}return e&&u(e,n),y(n.pasteBitable(e,t))}function v(e){if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}}function d(e,t){var n=e.bitableData,r=e.bitableHTML,i=e.bitableBlockHTML,o=e.bitableBlockId,a=e.customData,s=e.firstPasteAfterCut;if(n)return g(n,s,t);if(r)return g(t.getBitablePasteData((0,h.default)(r)[0]),s,t);if(i){var l=void 0;try{var c,u=(0,f.getBlockDataSet)((0,h.default)(i).find(".j-block-container span")[0]).initData;v(u)?l=u:(l=u&&t.decodeBitableData(u),(c=t.getLogService&&t.getLogService())&&c.teaLog({key:"bitable_doc_paste_base64_data",scm_version:JSON.stringify(window.scm||{}),scm_bitable:JSON.stringify(window.scmbitable||{}),source:"paste_bitable_block"}))}catch(e){return p(e,t),null}var d=a&&a[o]||l;if(d)return g(d,s,t)}return null}function m(e,t){var n=e.viewType,r=void 0===n?a.BitableViewType.GridView:n;return(0,f.generateBlockDataSet)({blockType:f.BlockType.BITABLE_BLOCK,props:{renderSource:f.RenderSource.doc,data:{viewType:r}},initData:Object.assign({},r===a.BitableViewType.GridView?t.getInitBitableCs():t.getInitKanbanCs(),{member_id:parseInt((0,f.getMemberId)())})})}function y(e){return(0,f.generateBlockDataSet)({blockType:f.BlockType.BITABLE_BLOCK,props:{renderSource:f.RenderSource.doc},initData:Object.assign({},e,{member_id:parseInt((0,f.getMemberId)()),createSource:"paste"})})}t.default=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.BitableViewType.GridView,n=e.plugins.blockPlugin,r=n.getBlockManager().getBlockCreator(f.BlockType.BITABLE_BLOCK),i={viewType:t},o=void 0,o=r.getIsDepLoaded()?m(i,r.ExternalServices):c({source:l.Insert,insertParams:i});return n.insertBlock(o),o}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=(t.BitableViewType=void 0)||(t.BitableViewType={})).GridView="GridView",r.Kanban="Kanban"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=I(n(8)),o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return i(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function i(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var a=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e};function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=I(n(0)),d=I(n(5)),f=n(1),h=n(6),p=I(n(107)),g=n(33),v=n(2),m=I(n(110)),y=I(n(111)),b=I(n(112)),E=n(17),k=n(3),C=I(n(7));function I(e){return e&&e.__esModule?e:{default:e}}function S(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var R,x,M=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},N=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},A=(w(_,p.default),a(_,[{key:"blockDidMount",value:function(){this.handleEventsBinding("on")}},{key:"handleEventsBinding",value:function(e){h.browser.isMobile||this.documentEvent[e]("click",this.handleDocumentClick),this.ExternalServices.EventEmitter[e]("showBlockEditbarWithComment",this.handleShowBlockEditbar),this.ExternalServices.EventEmitter[e]("hideBlockEditbar",this.handleHideBlockEditbar)}},{key:"handleDocumentClick",value:function(e){var t,n,r,i=e.target,o=i.closest("."+f.BLOCK_PLACEHOLDER);/mindnote-image-uploader/.test(i.className)||i.closest(".embedded-mindnote-toolbar-container")||this.selectedByRange||(t=void 0,!o||(n=(0,f.getBlockDataSet)(o))&&(t=n.blockId),t&&t===this.blockId||(this.handleSelectStatusChange(!1),(r=this.getMindnoteBridge())&&r.updateMindnoteSelectionState(this.blockId,!1)))}},{key:"handleShowBlockEditbar",value:function(e){var t,n,r=e.context,i=e.isAllowedComment;r&&r.block===this?(t=this.getMindnoteBridge())&&t.setShowBlockEditbar(this.blockId,!0,i):(n=this.getMindnoteBridge())&&n.setShowBlockEditbar(this.blockId,!1)}},{key:"handleHideBlockEditbar",value:function(){var e=this.getMindnoteBridge();e&&e.setShowBlockEditbar(this.blockId,!1)}},{key:"selectionIsRange",value:function(){var e=window.getSelection();return e&&"Range"===e.type}},{key:"selectionIsNone",value:function(){var e=window.getSelection();return e&&"None"===e.type}},{key:"isCaretInBlockInstance",value:function(){var e=window.getSelection();return[(0,r.default)(e,"focusNode",null),(0,r.default)(e,"focusNode.nextSibling",null),(0,r.default)(e,"focusNode.parentNode",null)].some(function(e){return e&&/mindnote-block-mask|block-loading|j-safari-selection|mindnote-block/.test(e.className)})}},{key:"getBitableInfo",value:function(){return{token:this.blockToken,bitableId:this.props.tableId||void 0}}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"beforeRender",value:function(){var e,t=this.attributes.selected,n=this.getMindnoteBridge();n&&n.updateMindnoteSelectionState&&(void 0===t||h.browser.isMobile?h.browser.isMobile&&n.updateMindnoteSelectionState(this.blockId,this.attributes.selectState===f.SelectionState.FOCUS_ON_BLOCK):(e=t&&!!this.selectionIsRange())!==this.selectedByRange&&(this.selectedByRange=e,n.updateMindnoteSelectionState(this.blockId,e)))}},{key:"render",value:(x=S(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.beforeRender(),this.isInHistoryMode())return d.default.render(this.getHistoryView(),this.mountPoint),e.abrupt("return");e.next=4;break;case 4:if(t=this.attributes.selectState,n=this.blockContext.undoDispatcher,!((r=this.getMindnoteBridge())&&this.blockToken&&n)){e.next=13;break}if(r.mountMindnote)return this.heightUpdateNotifier.notifyWillUpdate(),e.next=12,r.mountMindnote({editor:this.editor,host:this.mountPoint,token:this.blockToken,blockId:this.blockId,width:this.width,undoDispatcher:n,selectState:t,operator:{triggerComment:this.triggerComment,setSliderVisibleByBlock:this.setSliderVisibleByBlock},onMinderSet:this.handleMinderSet});e.next=13;break;case 12:this.heightUpdateNotifier.notifyDidUpdate();case 13:(i=this.getIsCaretOnBlock())!==this.prevSelected&&(this.handleSelectStatusChange(i),i?this.mountPoint.classList.add(g.mindNoteSelectedClass):this.mountPoint.classList.remove(g.mindNoteSelectedClass)),(this.prevSelected=i)&&this.handleMinderSizeChange();case 17:case"end":return e.stop()}},e,this)})),D)},{key:"delete",value:function(){}},{key:"unmount",value:function(e){var t=this.getMindnoteBridge();t&&(t.unmount(this.blockId,e),l(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"unmount",this).call(this,e),d.default.unmountComponentAtNode(this.mountPoint)),this.rendered=!1,this.unBindEvents(),this.handleEventsBinding("off"),this.heightUpdateNotifier.destroy(),this.mobileEditStats=null}},{key:"getIsCaretOnBlock",value:function(){var e=this;this.editor.inCallStackIfNecessary("updateSelection",function(){e.editor.fastIncorp()});var t=this.editor.getRep();return(0,f.isCaretOnBlock)(t,this.blockId)}},{key:"handleEnterFullScreen",value:function(){var e=this.getMindnoteBridge();e&&e.enterFullscreen&&e.enterFullscreen(this.blockId)}},{key:"onTap",value:function(){return this.mobileEditStats&&this.mobileEditStats.getIsEditing()&&this.attributes.selected?(this.handleEnterFullScreen(),{preventFocus:!0}):{preventFocus:!1}}},{key:"onDoubleTap",value:function(){return this.mobileEditStats&&!this.mobileEditStats.getIsEditing()?{preventFocus:!1}:(this.handleEnterFullScreen(),{preventFocus:!0})}},{key:"onCopy",value:function(){var e=this.getMindnoteBridge();e&&(this.dataset.initData=e.handleCopy(this.blockId));var t=this.ExternalServices.t("block.common_paste_unsupported");return{html:(0,f.generateBlockHTML)(Object.assign({},this.dataset,{token:""}),t),text:t}}},{key:"resize",value:function(e){var t=this.ExternalServices.Utils,n=t.isShortCut,r=t.isPDFAccess;this.isInTable||h.browser.mobile||this.width===e||n&&n()&&!r||(this.heightUpdateNotifier.notifyWillUpdate(),this.width=e,this.render(),this.resetMinderCanvas(),this.heightUpdateNotifier.notifyDidUpdate())}},{key:"getMindnoteBridge",value:function(){return this.ExternalServices.getMindnoteBridge?this.ExternalServices.getMindnoteBridge():null}},{key:"commentQuota",value:function(){return"["+this.ExternalServices.t("mindnote.block_menu_item_name")+"]"}},{key:"collectText",value:function(){return"["+this.ExternalServices.t("mindnote.block_menu_item_name")+"]"}},{key:"notify",value:(R=S(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("screenshot"!==t.eventType){e.next=8;break}if(t.status!==f.NotifyStatus.start){e.next=7;break}if(n=this.getMindnoteBridge())return e.next=6,n.takeScreenShot(this.blockId);e.next=7;break;case 6:this.screenShot=e.sent;case 7:t.status===f.NotifyStatus.end&&this.screenShot&&this.screenShot.done();case 8:case"end":return e.stop()}},e,this)})),L)},{key:"getHistoryView",value:function(){var e=this.ExternalServices.mountOptions;return(void 0===e?{}:e).historyMode===v.HISTORY_MODE.PLACEHOLDER?u.default.createElement("div",{className:"mindnote-placeholder"},u.default.createElement("div",{className:"mindnote-placeholder-header"},u.default.createElement(m.default,{className:"mindnote-placeholder-header-logo"}),u.default.createElement("span",null,this.ExternalServices.t("mindnote.block_menu_item_name"))),u.default.createElement("div",{className:"mindnote-placeholder-content"},u.default.createElement(y.default,null))):u.default.createElement("div",{className:"mindnote-placeholder-new"},u.default.createElement(b.default,null),u.default.createElement("span",{className:"mindnote-placeholder-new-title"},this.ExternalServices.t("mindnote.block_menu_item_name")))}},{key:"zoneId",get:function(){var e=this.getPlugin().getBlockRep(this);return e?e.selStart[2]:h.DEFAULT_REP_ZONE}},{key:"isInTable",get:function(){return this.zoneId!==h.DEFAULT_REP_ZONE}},{key:"overlayContainer",get:function(){}},{key:"blockContext",get:function(){return this.context}}],[{key:"processToken",value:function(e){var t,n,r=void 0,i=void 0;return"string"==typeof e&&(t=e.split(/_/,2),r=(n=o(t,2))[0],i=n[1]),{token:r,mindnoteId:i}}}]),_);function _(e,t,n,r,i){T(this,_);var o=O(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,e,t));return o.mobileEditStats=i,o.screenShot=null,o.editbarCommands=[],o.editbarTrigger=f.Trigger.hover,o.selectedByRange=!1,o._prevLineNu=null,o.documentEvent=E.GlobalDOMEventEmitter.get(document),o.width=o.defaultStyle.width,o.heightUpdateNotifier=new C.default({getContext:function(){return o.context},getBlockId:function(){return o.blockId}}),o.rendered=!1,o.prevSelected=!1,o.triggerComment=function(){var e,t,n,r,i=o.editor.domToRep(o.mountPoint.parentElement);i&&(e=i.selStart,t=i.selEnd,n=e[2],r={selStart:[e[0],e[1]],selEnd:[t[0],t[1]],selZone:n},o.editor.call("commentButtonClick",{event:{},selection:r}))},o.enterBuffer=function(){o.getIsCaretOnBlock()||o.resetMinderCanvas()},o.selectionChange=function(){var e,t=o.editor.getRep();!t.selStart||null!==o._prevLineNu&&o._prevLineNu===t.selStart[0]||(o._prevLineNu=t.selStart[0],(e=o.editor.domToRep(o.mountPoint.parentElement))&&(e.selStart[0],t.selStart[0]),o.beforeRender())},o.ExternalServices=r,o.editor=n,o.dataset=t,r.Utils.isShortCut&&r.Utils.isShortCut()&&o.ExternalServices.Utils.isPDFAccess&&(o.width=624),o.isInHistoryMode()||(o.width=Math.min((0,k.getDocBodyWidth)(),o.width)),o}function L(e){return R.apply(this,arguments)}function D(){return x.apply(this,arguments)}M([(0,f.Bind)(),N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],A.prototype,"handleDocumentClick",null),M([f.Bind,N("design:type",Function),N("design:paramtypes",[Object]),N("design:returntype",void 0)],A.prototype,"handleShowBlockEditbar",null),M([(0,f.Bind)(),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],A.prototype,"handleHideBlockEditbar",null),M([(0,f.Debounce)(0),N("design:type",Function),N("design:paramtypes",[]),N("design:returntype",void 0)],A.prototype,"beforeRender",null),M([(0,f.Debounce)(150),N("design:type",Function),N("design:paramtypes",[Number]),N("design:returntype",void 0)],A.prototype,"resize",null),t.default=A},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pasteMindnoteDataSet=o;var a=n(1),s=n(9),r=n(33),i=n(3);function o(e,t){var n=Object.assign({renderSource:a.RenderSource.doc,size:l(),resizeType:s.ResizeType.Down,sliderType:s.SliderType.Line},t);return(0,a.generateBlockDataSet)({blockType:a.BlockType.MINDNOTE_BLOCK,props:n,initData:Object.assign({},e,{member_id:parseInt((0,a.getMemberId)()),createSource:"paste"})})}function l(){var e=(0,i.getDocBodyWidth)(),t=r.defaultSize.height;return{width:e,height:t,originalWidth:e,originalHeight:t,isModified:!0}}t.default=function(e){var t=e.plugins.blockPlugin,n=t.getBlockManager().getBlockCreator(a.BlockType.MINDNOTE_BLOCK),r=n.ExternalServices,i=(0,a.generateBlockDataSet)({blockType:a.BlockType.MINDNOTE_BLOCK,initData:r.getInitMindnoteData?r.getInitMindnoteData():{},props:{size:l(),resizeType:s.ResizeType.Down,sliderType:s.SliderType.Line}});t.insertBlock(i);var o=n.ExternalServices.LogService;return o&&o.collectEvent&&o.collectEvent("client_insert_mindmap",{create_source:"toolbar"}),i}},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o,a,s,l=(o=c,(a=[{key:"getIsEditing",value:function(){return this.editing}},{key:"reset",value:function(){this.emitter.off("MOBILE:COMMON:ENTER_EDIT",this.enterEditing),this.emitter.off("MOBILE:COMMON:EXIT_EDIT",this.exitEditing),this.emitter=null}}])&&r(o.prototype,a),s&&r(o,s),c);function c(e){var t=this;i(this,c),this.editing=!1,this.emitter=null,this.enterEditing=function(){t.editing=!0},this.exitEditing=function(){t.editing=!1},this.emitter=e,this.emitter.on("MOBILE:COMMON:ENTER_EDIT",this.enterEditing),this.emitter.on("MOBILE:COMMON:EXIT_EDIT",this.exitEditing)}t.default=l},function(e,t){e.exports=o("yIs4")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(0),m=a(o);n(127),n(128);var y=n(45),b=a(n(4)),E=a(n(15)),k=n(2),C=n(6);function a(e){return e&&e.__esModule?e:{default:e}}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=(c(d,o.Component),r(d,[{key:"componentDidMount",value:function(){this.props.emitter&&(this.props.emitter.on("highlightResult",this.updateSearchResult),this.props.emitter.on("clearSearchResult",this.clearSearchResult))}},{key:"componentWillUnmount",value:function(){this.props.emitter&&this.props.emitter.removeAllListeners()}},{key:"render",value:function(){var e,t=(0,y.getCurrentUserId)(),n=this.props,r=n.user,i=n.mentionId,o=void 0===i?"":i,a=n.unreadable,s=n.disabled,l=void 0!==s&&s,c=n.getLanguage,u=n.isPlaceholder,d=n.isMentionNewUi,f=n.fromSSR,h=n.draggable,p=r?(0,y.getUserShowNameForLang)(r,c):"",g=r?r.id:0,v=(0,b.default)("at-user-text","mention-type_0","mention-token_"+g,(I(e={},"mention-id_"+o,o),I(e,"popover-disabled",l),I(e,"at-user-disabled",!l&&a),I(e,"at-user-placeholder",u),I(e,"at-self-highlight",!l&&t===g),e));return m.default.createElement("a",{className:v,contentEditable:!1,href:"javascript:void(0)","data-user-name":p,draggable:h},d?m.default.createElement("div",{className:"at-user-avatar"},f?m.default.createElement("div",{className:"at-user-default-avatar"}):m.default.createElement("img",{src:r.avatar_url})):null,m.default.createElement("span",null,m.default.createElement(E.default,{bgColor:k.MATCHED_BACKGROUND_COLOR,activeBgColor:k.SELECTED_BACKGROUND_COLOR,activeKey:this.state.selectedKey,isSelected:this.state.isSelected,context:this.state.searchResult},d?null:m.default.createElement("strong",null,"@"),p)),C.browser.isAndroid?" ":"")}}]),d);function d(e){s(this,d);var t=l(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,e));return t.state={searchResult:[],selectedKey:"",isSelected:!1},t.clearSearchResult=function(e){t.setState(function(){return{searchResult:e}})},t.updateSearchResult=function(e){t.setState(function(){return{searchResult:e.searchResult}}),void 0!==e.isSelected&&t.setState(function(){return{selectedKey:e.selectedKey,isSelected:e.isSelected}})},t}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderCardPlaceholderJsx=t.renderCardPlaceholder=void 0;var r=o(n(0));n(133);var i=n(6);function o(e){return e&&e.__esModule?e:{default:e}}t.renderCardPlaceholder=function(e){return'<div style="width: '+(i.browser.isMobile?"100%":e||"438px")+'" class="block-card-loading"><div class="block-icon-placeholder"></div><div><div class="block-title-placeholder"></div><div class="block-desc-placeholder"></div></div></div>'},t.renderCardPlaceholderJsx=function(e){var t=i.browser.isMobile?"100%":e||"438px";return r.default.createElement("div",{style:{width:t},className:"block-card-loading"},r.default.createElement("div",{className:"block-icon-placeholder"}),r.default.createElement("div",null,r.default.createElement("div",{className:"block-title-placeholder"}),r.default.createElement("div",{className:"block-desc-placeholder"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isAuthorityDownloadable=function(e){var t=e.getAuthorityDownloadable;return!t||t()},t.isExportable=function(e,t){return!!e&&!t.Helpers.browser.mobile&&e&&e.exportable}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var w=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=n(24),a=c(n(142)),d=n(34),s=n(3),l=n(35);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var p=2e3,g=100,v=1e3;function m(e,t){for(var n=performance.now()-t,r=0,i=0,o=0;o<e.length;o++){var a=e[o],s=a.count;n<a.timestamp?r+=s:i=o}var l=e.length-i;return e.splice(i,l),r}var y=(i(b,[{key:"destructor",value:function(){this.record.removeChangeListener(this.handleCollaborativeChange)}},{key:"logInvalidRecord",value:function(e,t,n,r){var i,o,a;this.logFlag.has(n)||(i=JSON.stringify(this.logQueue)).includes(n)&&(this.logFlag.add(n),!(o=r&&r.optionId?r.optionId:null)||(a=this.getRecordSymbol(this.record.getSnapshot(),o))&&console.log("relative vote map:",JSON.stringify(a)),console.log("relative changes:",i),console.log("relative arguments:",JSON.stringify({type:e,msg:t,id:n,optionId:o})),(0,s.captureException)("oops debug: poll record invalid"))}},{key:"logRecordError",value:function(e,t){console.log(e,t.stack)}},{key:"collect",value:function(e,t){for(this.logQueue.push({type:e,data:this.desensitize(t)});this.logQueue.length>this.cacheSize;)this.logQueue.shift()}},{key:"getRecordSymbol",value:function(t,e){var n=this,r=t.voteOptionMap[e];if(!r)return null;var i=r.votes.map(function(e){return n.desensitize(t.voteMap[e])});return{votes:i,valid:!i.some(function(e){return!e})}}},{key:"desensitize",value:function(e){var t=this,n=["text","title","updatedAt","createdAt","emojiId"];if(!e)return e;if(Array.isArray(e))return e.map(function(e){return"object"===(void 0===e?"undefined":h(e))?t.desensitize(e):e});if("object"!==(void 0===e?"undefined":h(e)))return e;var r={},i=!0,o=!1,a=void 0;try{for(var s,l=Object.entries(e)[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value,u=w(c,2),d=u[0],f=u[1];n.includes(d)||("userId"===d&&"string"==typeof f?r[d]=this.ExternalServices.Utils.encryptTea(f):"object"===(void 0===f?"undefined":h(f))?r[d]=this.desensitize(f):r[d]=f)}}catch(e){o=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}return r}}]),b);function b(e,t){var n=this;f(this,b),this.record=t,this.logQueue=[],this.logFlag=new Set,this.cacheSize=20,this.handleCollaborativeChange=function(e){for(n.logQueue.push({type:"newChanges",data:n.desensitize(e)});n.logQueue.length>n.cacheSize;)n.logQueue.shift()},t.onChange(this.handleCollaborativeChange),this.ExternalServices=e.ExternalServices}var E,k,C,I,S,T,O,x,M=(i(N,[{key:"destructor",value:function(){this.record.removeChangeListener(this.handleChange),this.record.destroy(),this.logCollector.destructor()}},{key:"initRecord",value:function(e,t){var n=this,r=(0,l.Synchronous)(new l.Record({}),{token:e,io:t});return r.onChange(this.handleChange),r.onError(function(e){var t;console.log("[POLL]: Data Sdk Error",e,e.detail.code,e.detail.msg),(0,s.captureException)("[POLL]: Data Sdk Error, code: "+e.detail.code+", msg: "+e.detail.msg),e.detail.code?(t=e.detail,n.ExternalServices.EventEmitter.emit("Etherpad:Error",{message:"[POLL]: "+t.msg,code:t.code})):n.ExternalServices.EventEmitter.emit("Etherpad:Error",{message:"[POLL]: "+e.detail.message})}),r.fetchClientVars().then(function(){n.updateBlock()}).catch(function(e){(0,s.captureException)("[Poll]: init record fail, "+JSON.stringify(e))}),r}},{key:"updateBlock",value:function(){this.block.render()}},{key:"enablePoll",value:function(){this.isVotingEnabled=!0}},{key:"disablePoll",value:function(){this.isVotingEnabled=!1}},{key:"setRecord",value:(x=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.logCollector.collect("setRecord",t),this.record.set(t);case 2:case"end":return e.stop()}},e,this)})),j)},{key:"removeRecord",value:(O=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.logCollector.collect("removeRecord",t),this.record.remove(t);case 2:case"end":return e.stop()}},e,this)})),F)},{key:"getBlockId",value:function(){return this.block.blockId}},{key:"getTitle",value:function(){return this.record.get(["title"])}},{key:"getPollType",value:function(){return this.record.get(["type"])}},{key:"getOptionIds",value:function(){return this.record.get(["voteOptions"])}},{key:"getOption",value:function(e){return this.record.get(["voteOptionMap",e])||(this.logCollector.logInvalidRecord("getOption","optionId doesn't exsits in optionMap",e),null)}},{key:"getEmoji",value:function(e,t){var n=this.getOption(e);if(!n)return d.DEFAULT_EMOJI_ID;var r=n.votes,i=!0,o=!1,a=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value,u=this.getVote(c,{optionId:e});if(u&&u.userId===t)return u.emojiId}}catch(e){o=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}return d.DEFAULT_EMOJI_ID}},{key:"getVote",value:function(n,e){var t=this.record.get(["voteMap",n]);if(t)return t;var r,i,o=[];return e&&e.optionId&&((i=(r=this.getOption(e.optionId))&&r.votes)&&i.forEach(function(e,t){e===n&&o.push(t)})),this.logCollector.logInvalidRecord("getVote","voteId doesn't exsits in voteMap, indexes: "+o.join(","),n,e),null}},{key:"isVoted",value:function(e,t){var n=this.getOption(e);if(!n)return!1;var r=n.votes,i=!0,o=!1,a=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value,u=this.getVote(c,{optionId:e});if(u&&u.userId===t)return!0}}catch(e){o=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw a}}return!1}},{key:"getSnapshot",value:function(){return this.record.getSnapshot()}},{key:"setTitle",value:(T=u(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRecord([{path:["title"],value:t}]);case 2:case"end":return e.stop()}},e,this)})),P)},{key:"addOption",value:(S=u(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ExternalServices.LogService.collectEvent("click_poll_option_add",{block_id:this.getBlockId(),poll_type:this.getPollType()}),t=this.getOptionIds().length,v<=t)return this.ExternalServices.Toast.show({key:"pollOptionsCountOverLimit",type:"error",content:this.ExternalServices.t("block.poll_options_count_over_limit")}),e.abrupt("return","");e.next=5;break;case 5:return n=N.createOption(),r=n.id,e.next=9,this.setRecord([{path:["voteOptionMap",r],value:n},{path:["voteOptions",t.toString()],value:r}]);case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}},e,this)})),B)},{key:"editOption",value:(I=u(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRecord([{path:["voteOptionMap",t,"text"],value:n}]);case 2:case"end":return e.stop()}},e,this)})),D)},{key:"delOption",value:(C=u(regeneratorRuntime.mark(function e(t){var n,r,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getOption(t)){e.next=4;break}return this.ExternalServices.Toast.show({key:"pollVotingOverLimit",type:"error",content:this.ExternalServices.t("block.poll_voting_over_limit")}),e.abrupt("return");case 4:return r=n.votes.length,i=this.getOptionIds(),o=i.indexOf(t),(a=[]).push(["voteOptionMap",t]),a.push(["voteOptions",o.toString()]),e.next=12,this.removeRecord(a);case 12:this.ExternalServices.LogService.collectEvent("click_poll_option_delete",{block_id:this.getBlockId(),option_id:t,poll_type:this.getPollType(),poll_option_votes:r});case 13:case"end":return e.stop()}},e,this)})),L)},{key:"voteToggle",value:(k=u(regeneratorRuntime.mark(function e(t,n){var r,i,o,a,s,l,c,u,d,f,h,p,g,v,m,y,b,E,k,C,I,S,T,O;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isVotingEnabled){e.next=2;break}return e.abrupt("return");case 2:if(r=!this.isVoted(t,n),i=this.getOption(t)){e.next=6;break}return e.abrupt("return");case 6:if(!r){e.next=37;break}if(this.getPollType()!==R.PollType.single){e.next=29;break}for(o=this.getOptionIds(),s=!(a=!0),l=void 0,e.prev=13,c=o[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)d=u.value,t!==d&&this.isVoted(d,n)&&this.voteToggle(d,n);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),s=!0,l=e.t0;case 21:e.prev=21,e.prev=22,!a&&c.return&&c.return();case 24:if(e.prev=24,s)throw l;e.next=27;break;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return f=N.createVote(n),h=f.id,p=i.votes.length,e.next=34,this.setRecord([{path:["voteMap",h],value:f},{path:["voteOptionMap",t,"votes",p.toString()],value:h}]);case 34:this.ExternalServices.LogService.collectEvent("click_poll_vote",{block_id:this.getBlockId(),poll_type:this.getPollType()}),e.next=76;break;case 37:g=i.votes,v=[],y=!(m=!0),b=void 0,e.prev=42,E=Object.entries(g)[Symbol.iterator]();case 44:if(m=(k=E.next()).done){e.next=57;break}if(C=k.value,I=w(C,2),S=I[0],T=I[1],(O=this.getVote(T,{optionId:t}))&&O.userId===n)return v.push(["voteMap",O.id]),v.push(["voteOptionMap",t,"votes",S]),e.abrupt("break",57);e.next=54;break;case 54:m=!0,e.next=44;break;case 57:e.next=63;break;case 59:e.prev=59,e.t1=e.catch(42),y=!0,b=e.t1;case 63:e.prev=63,e.prev=64,!m&&E.return&&E.return();case 66:if(e.prev=66,y)throw b;e.next=69;break;case 69:return e.finish(66);case 70:return e.finish(63);case 71:if(e.t2=v.length,e.t2)return e.next=75,this.removeRecord(v);e.next=75;break;case 75:this.ExternalServices.LogService.collectEvent("click_poll_vote_cancel",{block_id:this.getBlockId(),poll_type:this.getPollType()});case 76:case"end":return e.stop()}},e,this,[[13,17,21,29],[22,,24,28],[42,59,63,71],[64,,66,70]])})),_)},{key:"setEmoji",value:(E=u(regeneratorRuntime.mark(function e(t,n,r){var i,o,a,s,l,c,u,d,f,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ExternalServices.LogService.collectEvent("click_poll_emoji",{block_id:this.getBlockId(),poll_type:this.getPollType(),emoji_id:r}),i=this.getOption(t),o=this.isVoted(t,n),i&&o){e.next=5;break}return e.abrupt("return");case 5:a=i.votes,l=!(s=!0),c=void 0,e.prev=9,u=a[Symbol.iterator]();case 11:if(s=(d=u.next()).done){e.next=20;break}if(f=d.value,(h=this.getVote(f,{optionId:t}))&&h.userId===n)return e.next=17,this.setRecord([{path:["voteMap",h.id,"emojiId"],value:r}]);e.next=17;break;case 17:s=!0,e.next=11;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(9),l=!0,c=e.t0;case 26:e.prev=26,e.prev=27,!s&&u.return&&u.return();case 29:if(e.prev=29,l)throw c;e.next=32;break;case 32:return e.finish(29);case 33:return e.finish(26);case 34:case"end":return e.stop()}},e,this,[[9,22,26,34],[27,,29,33]])})),A)}],[{key:"createOption",value:function(){return{id:(0,a.default)(),text:"",createdAt:+new Date,updatedAt:+new Date,votes:[]}}},{key:"createVote",value:function(e){return{id:(0,a.default)(),userId:e,emojiId:d.DEFAULT_EMOJI_ID,createdAt:+new Date,updatedAt:+new Date}}}]),N);function N(e,t,n){var r=this;f(this,N),this.block=e,this.changeCountArr=[],this.reenableTimerId=0,this.isRecordReady=function(){try{return r.record._sync._receiveClientVars}catch(e){return!1}},this.handleChange=function(e){e.type===l.ClientVarsEventType.collab&&r.handleCollaborativeChange(e),r.updateBlock()},this.insertNewChangeCount=function(e){0!==r.reenableTimerId&&(window.clearTimeout(r.reenableTimerId),r.reenableTimerId=0);var t={count:e,timestamp:performance.now()};r.changeCountArr.push(t);var n=m(r.changeCountArr,p);g<n?(r.disablePoll(),r.reenableTimerId=window.setTimeout(function(){r.enablePoll(),r.reenableTimerId=0},p)):r.enablePoll()},this.handleCollaborativeChange=function(e){r.insertNewChangeCount(e.detail.length)},this.record=this.initRecord(t,n),this.logCollector=new y(e,this.record),this.isVotingEnabled=!0,this.ExternalServices=e.ExternalServices}function A(e,t,n){return E.apply(this,arguments)}function _(e,t){return k.apply(this,arguments)}function L(e){return C.apply(this,arguments)}function D(e,t){return I.apply(this,arguments)}function B(){return S.apply(this,arguments)}function P(e){return T.apply(this,arguments)}function F(e){return O.apply(this,arguments)}function j(e){return x.apply(this,arguments)}t.default=M},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(0),c=a(o),u=n(47);function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(151);var f=(d(h,o.Component),r(h,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.className,r=e.getRef,i=e.readOnly,o=e.placeholder,a=e.onChange,s=e.onBlur,l=e.value;return c.default.createElement("div",{className:"dynamic-height-input "+n},c.default.createElement("div",{className:"dynamic-height-input--fake-text"},l),c.default.createElement("textarea",Object.assign({id:t,key:t,rows:1},{spellCheck:!0},{className:"dynamic-height-input--text",ref:r,readOnly:i,"data-assign-poll-status":u.ActiveStatus.editting,onChange:a,onBlur:s,placeholder:o,onFocus:this.moveCaretAtEnd,value:l})))}}]),h);function h(){s(this,h);var e=l(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments));return e.moveCaretAtEnd=function(e){var t,n=e.target;"number"==typeof n.selectionStart?n.selectionStart=n.selectionEnd=n.value.length:void 0!==n.createTextRange&&(n.focus(),(t=n.createTextRange()).collapse(!1),t.select())},e}t.default=f},function(e,t){e.exports=o("fujP")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(165));function i(e){return e&&e.__esModule?e:{default:e}}t.default=r.default},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s(n(171));t.JiraIcon=l,t.JiraIconGray=c,t.JiraIconGrayWithHoverBg=u,t.JiraIconWithHoverHighlight=d,t.JiraIconWithHoverBg=f;var i=s(n(0)),o=s(n(172)),a=s(n(4));function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return i.default.createElement("svg",Object.assign({style:Object.assign({width:"18px",height:"18px",backgroundImage:"url("+o.default+")",backgroundSize:"contain"},e.style)},(0,r.default)(e,["style"])))}function c(e){return i.default.createElement("svg",Object.assign({className:(0,a.default)("jira-icon-gray",e.className)},(0,r.default)(e,["className"])))}function u(e){return i.default.createElement("div",{className:"hover-bg"},i.default.createElement(c,Object.assign({},e)))}function d(e){return i.default.createElement(c,Object.assign({className:(0,a.default)("hover-highlight",e.className)},(0,r.default)(e,["className"])))}function f(e){return i.default.createElement("div",{className:"hover-bg"},i.default.createElement(d,Object.assign({},e)))}n(173)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(14)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(0),s=p(a),c=p(n(4)),u=n(6),l=n(11),d=p(n(50)),f=p(n(208)),h=p(n(211));function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(212);var y=(m(b,a.PureComponent),i(b,[{key:"componentDidMount",value:function(){var e=this;this.props.defaultVisible&&setTimeout(function(){e.handleVisibleChange(!0)})}},{key:"componentWillUnmount",value:function(){this.handleVisibleChange(!1)}},{key:"render",value:function(){var e=this.props.onInput,t=this.state,n=t.visible,r=t.active;return this.isRenderDefault?s.default.createElement(d.default,Object.assign({},this.commonProps)):u.browser.isMobile||u.browser.isIPad?s.default.createElement(h.default,Object.assign({},this.commonProps,{visible:n,active:r,onInput:e,onVisibleChange:this.handleVisibleChange})):s.default.createElement(f.default,Object.assign({},this.commonProps,{visible:n,onInput:e,onVisibleChange:this.handleVisibleChange}))}},{key:"isRenderDefault",get:function(){var e=this.props.ExternalServices,t=e.isDocSSR,n=e.isShortCut;return t||n||!this.editable()}},{key:"cls",get:function(){var e=this.props,t=e.selected,n=e.equation,r=this.state,i=r.visible,o=r.active,a=r.isError,s=r.loading,l=n&&n.trim();return(0,c.default)("equation-view",{"equation-view-mobile":u.browser.isMobile,"equation-view-editable":this.editable(),"equation-view-selected":t,"equation-view-visible":u.browser.isMobile?o:i,"equation-view-errored":a,"equation-view-loading":s,"equation-view-placeHoldered":!l,"equation-view-equation-rendered":l})}},{key:"placeHolder",get:function(){var e=this.props.ExternalServices.t;return this.editable()?e("CreationDoc_Docs_Equation.placeholder.edit"):e("CreationDoc_Docs_Equation.placeholder.view")}},{key:"errorPlaceHolder",get:function(){return(0,this.props.ExternalServices.t)("CreationDoc_Docs_Equation.placeholder.error")}},{key:"commonProps",get:function(){var e=this.props,t=e.editor,n=e.equation,r=e.onRendered,i=e.handleWillGenEquation,o=e.handleDidGenEquation,a=e.ExternalServices,s=this.state,l=s.loading,c=s.isError;return{className:this.cls,editor:t,equation:n,placeHolder:this.placeHolder,errorPlaceHolder:this.errorPlaceHolder,loading:l,isError:c,editable:this.editable,editing:this.editing,handleWillGenEquation:i,handleDidGenEquation:o,onRendered:r,handleStateChange:this.handleStateChange,ExternalServices:a}}}]),b);function b(e){g(this,b);var r=v(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,e));r.editable=function(){var e=r.props,t=e.editor.editable,n=e.ExternalServices.mobileEditable;return!(u.browser.isMobile&&!n)&&Boolean(t)},r.editing=function(){var e=r.props.ExternalServices.Utils.getIsEditing;return Boolean(e&&e())},r.handleVisibleChange=function(e,t){var n=r.props.ExternalServices.LogService.collectEvent;e&&n("toggle_attribute",{action:"edit_tex_block"}),r.setState({visible:e},t)},r.handleStateChange=function(e,t){r.setState(Object.assign({},r.state,e),t)};var t=e.defaultVisible,n=e.equation,i=e.ExternalServices.isDocSSR||!l.katexManager.isLoaded()&&!t&&!!n;return r.state={active:t,visible:t,isError:!1,loading:i},r}y.defaultProps={equation:"",selected:!1,defaultVisible:!1,onInput:r.default,handleWillGenEquation:r.default,handleDidGenEquation:r.default,onRendered:r.default},t.default=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=p(n(14)),i=p(n(22)),o=p(n(8)),a=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e};function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=n(0),c=p(l),u=p(n(5)),d=p(n(4)),f=n(6),h=p(n(209));function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(210);var y=13,b=(m(E,l.PureComponent),a(E,[{key:"componentDidMount",value:function(){$(".equation-view-input-wrap").on("mousedown",this.handleStopPropagation)}},{key:"componentDidUpdate",value:function(){this.breakFocusInputPosition()}},{key:"componentWillUnmount",value:function(){$(".equation-view-input-wrap").off("mousedown",this.handleStopPropagation),this.handleSizeChange.cancel(),this.observer&&this.observer.disconnect(),this.observer=void 0,this.inputRef=void 0}},{key:"focusInputPosition",value:function(e){this.inputRef&&(this.inputRef.selectionStart=e,this.inputRef.selectionEnd=e)}},{key:"breakFocusInputPosition",value:function(){f.browser.isMobile||this.props.equation!==this.nextText||-1===this.nextPosition||(this.focusInputPosition(this.nextPosition),this.nextText="",this.nextPosition=-1)}},{key:"renderInput",value:function(){var e=this.props,t=e.t,n=e.equation,r=e.inputStyle,i=e.onBlur;return c.default.createElement("textarea",{ref:this.setInputRef,className:"equation-view-input",placeholder:t("CreationDoc_Docs_Equation.placeholder.input"),rows:4,value:n,style:r,spellCheck:!1,onChange:this.handleInput,onKeyDown:f.browser.isMobile?void 0:this.hanldePCKeyDown,onBlur:i})}},{key:"renderHelp",value:function(){var e=this.props,t=e.t,n=e.helpLink;return c.default.createElement("div",{className:"equation-view-help-wrap"},c.default.createElement("a",{className:"equation-view-help",href:n,target:"_blank"},c.default.createElement("i",null,c.default.createElement(h.default,null)),c.default.createElement("span",null,t("CreationDoc_Docs_Equation.help.button"))))}},{key:"renderMobile",value:function(){var e=this.props,t=e.mobileStyle,n=e.onFinish,r=e.t,i=c.default.createElement("div",{className:this.cls,style:t,onTouchEnd:this.handleStopPropagation},c.default.createElement("div",{className:"equation-view-input-mask"}),c.default.createElement("div",{className:"equation-view-input-box"},this.renderInput(),c.default.createElement("div",{className:"equation-view-input-footer",onTouchEnd:n},c.default.createElement("span",null,r("CreationDoc_Docs_Equation.complete.button")))));return u.default.createPortal(i,document.body)}},{key:"renderPC",value:function(){return c.default.createElement("div",{className:this.cls,onClick:this.handleStopPropagation},this.renderInput(),this.renderHelp())}},{key:"render",value:function(){return f.browser.isMobile?this.renderMobile():this.renderPC()}},{key:"cls",get:function(){var e=this.props,t=e.className,n=e.contentEditable;return(0,d.default)("equation-view-input-wrap",t,{"equation-view-input-mobile":f.browser.isMobile,"equation-view-input-pc":!f.browser.isMobile,"equation-view-input-editable":n})}}]),E);function E(){g(this,E);var p=v(this,(E.__proto__||Object.getPrototypeOf(E)).apply(this,arguments));return p.nextText="",p.nextPosition=-1,p.setInputRef=function(e){p.sizeObserver(e),p.inputRef=e;var t=f.browser.isIPad?300:0;setTimeout(p.focus,t)},p.handleSizeChange=(0,i.default)(function(){var e,t;p.inputRef&&(e=(0,o.default)(p.props,"inputStyle.maxHeight",1/0),t=Math.min(p.inputRef.offsetHeight,e),p.inputRef.style.height=t+"px")},100),p.sizeObserver=function(e){!f.browser.isMobile&&e&&(p.observer||(p.observer=new MutationObserver(p.handleSizeChange))).observe(e,{attributes:!0,attributeFilter:["style"]})},p.focus=function(){var e,t=p.inputRef;t&&(t.focus(),p.props.onFocus(),e=t.value.length,p.focusInputPosition(e),t.scrollTop=t.scrollHeight,t.scrollLeft=t.scrollWidth)},p.handleStopPropagation=function(e){e.stopPropagation()},p.handleInput=function(e){p.props.onInput(e.target.value)},p.hanldePCKeyDown=function(e){var t,n,r,i,o=p.props,a=o.onVisibleChange,s=o.onInput,l=o.equation,c=e.keyCode,u=e.ctrlKey,d=e.metaKey,f=e.shiftKey,h=e.altKey;c===y&&(u||d||f||h?!f&&p.inputRef&&(n=(t=p.inputRef).selectionStart,r=t.selectionEnd,i=l.slice(0,n)+"\n"+l.slice(r),p.nextText=i,p.nextPosition=n+1,s(i)):(e.preventDefault(),a(!1)))},p}b.defaultProps={className:"",inputStyle:{},helpLink:"about:blank",onFinish:r.default,onFocus:r.default,onBlur:r.default},t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=v(n(14)),a=v(n(8)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l=n(1),c=n(6);n(215);var u,d,f=v(n(0)),h=v(n(5)),p=v(n(216)),g=v(n(7));function v(e){return e&&e.__esModule?e:{default:e}}function m(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(d=u=u||{}).FOCUS="select-focus",d.COVER="select-cover";var k,C,I,S,T,O=(E(w,l.Block),r(w,[{key:"blockDidInit",value:function(e){e.isRemote;var t=this.getPlugin().blockInfos.get(this.blockId);this.isRemote=(0,a.default)(t,"options.isRemote")}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"resize",value:function(){}},{key:"placeHolderView",value:function(){var e=this.getBlockFilledIcon(),t=this.getBlockName();return f.default.createElement("div",{className:"placeHolder-view"},f.default.createElement("div",{className:"information"},f.default.createElement("img",{src:e}),t),f.default.createElement("div",{className:"gray-block"}))}},{key:"shortcutView",value:function(e){var t=this.props.data.blockTypeId,n=e.find(function(e){return e.blockTypeID===t}),r=(0,a.default)(n,"icon"),i=this.ExternalServices.Helpers.getLocale(),o=(0,a.default)(n,"name");return f.default.createElement("div",{className:"placeHolder-view"},f.default.createElement("div",{className:"information"},f.default.createElement("img",{src:r}),o?o[i]:null),f.default.createElement("div",{className:"gray-block"}))}},{key:"unmount",value:function(e){s(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"unmount",this).call(this,e),this.resizeObserver.disconnect(),this.heightUpdateNotifier.destroy(),this.destroyAppBlock()}},{key:"getBlockName",value:function(){var e=this.ExternalServices.getBlockInfo(this.props.data.blockTypeId),t=this.ExternalServices.Helpers.getLocale();return e?e.name[t]:"null"}},{key:"getBlockIcon",value:function(){var e=this.ExternalServices.getBlockInfo(this.props.data.blockTypeId);return e?e.icon:null}},{key:"getBlockFilledIcon",value:function(){var e=this.ExternalServices.getBlockInfo(this.props.data.blockTypeId);return e?e.filledIcon:null}},{key:"isAuthor",value:function(){var e=this.ExternalServices.Utils.getSelectionByBlockId(this.editor,this.blockId);if(e){var t=e.selZone,n=e.selStart;if(t){var r=this.editor.getAllAttributesOnLine(t,n[0]).find(function(e){return"author"===e[0]}),i=this.ExternalServices.Helpers.getCurrentUser();return!!r&&r[1]===i.get("id")}}return!1}},{key:"collectText",value:function(){return this.getBlockName()}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=(0,l.generateBlockDataSet)({blockType:t,props:n}),i="$$"+n.data.blockTypeId+"$$";return{html:(0,l.generateBlockHTML)(r,i),text:i}}},{key:"shouldPreventCopy",value:function(){return!0}},{key:"destroyAppBlock",value:function(){this.Blockit.unmountBlock(this.ISVBlockInstance)}},{key:"debugCreator",value:(T=m(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.data.blockTypeId,this.destroyAppBlock(),this.Blockit.mountCreator({blockTypeID:t,blockRoot:this.container,cache:!0,debug:!0}).then(function(e){var t=e.blockID;n.setProps({data:{AppBlockId:t}}),n.renderBlockById(t,!0)}).catch(function(e){console.error(e)});case 3:case"end":return e.stop()}},e,this)})),A)},{key:"debugBlock",value:(S=m(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.data.AppBlockId,this.destroyAppBlock(),this.renderBlockById(t,!0);case 3:case"end":return e.stop()}},e,this)})),N)},{key:"reload",value:(I=m(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.destroyAppBlock(),this.isISVRendered=!1,this.render();case 3:case"end":return e.stop()}},e,this)})),M)},{key:"switchSelect",value:function(){var e=this.attributes.selectState,t=window.getSelection();switch(e){case l.SelectionState.FOCUS_ON_BLOCK:case l.SelectionState.COVER_ON_BLOCK:t&&"Range"===t.type&&$(this.container).addClass(u.FOCUS);break;default:$(this.container).removeClass([u.COVER,u.FOCUS])}}},{key:"isRenderPlaceHolder",value:function(){var e=this.props.data.AppBlockId;return this.isInHistoryMode()||!this.isAuthor()&&!e||this.isAuthor()&&this.isRemote&&!e}},{key:"renderBlockById",value:(C=m(regeneratorRuntime.mark(function e(t){var n=this,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Blockit.mountBlockByID({blockID:t,blockRoot:this.container,cache:!0,debug:r});case 2:if(this.ISVBlockInstance=e.sent,this.inBuffer){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,new Promise(function(e,t){n.ISVBlockInstance.onLoaded(function(){e()}),n.ISVBlockInstance.onLoadFail(function(e){t(e)})});case 7:case"end":return e.stop()}},e,this)})),x)},{key:"render",value:(k=m(regeneratorRuntime.mark(function e(){var t,n,r,i,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.data,n=t.blockTypeId,r=t.AppBlockId,this.switchSelect(),this.isISVRendered)return e.abrupt("return");e.next=4;break;case 4:if(this.isShortcut)return e.next=7,this.ExternalServices.getShortcutBlockList(this.editor);e.next=10;break;case 7:return i=e.sent,h.default.render(this.shortcutView(i),this.container),e.abrupt("return");case 10:if(this.Blockit){e.next=14;break}return e.next=13,this.ExternalServices.initBlockit();case 13:this.Blockit=e.sent;case 14:if(this.isRenderPlaceHolder())return h.default.render(this.placeHolderView(),this.container),e.abrupt("return");e.next=17;break;case 17:if(this.isISVRendered=!0,e.prev=18,h.default.unmountComponentAtNode(this.container),r)return e.next=23,this.renderBlockById(r);e.next=25;break;case 23:e.next=26;break;case 25:this.Blockit.mountCreator({blockTypeID:n,blockRoot:this.container,cache:!0}).then(function(e){var t=e.blockID;o.setProps({data:{AppBlockId:t}}),o.renderBlockById(t)}).catch(function(e){console.error(e)});case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(18),console.error(e.t0);case 31:case"end":return e.stop()}},e,this,[[18,28]])})),R)},{key:"zoneId",get:function(){var e=this.getPlugin().getBlockRep(this);return e?e.selStart[2]:c.DEFAULT_REP_ZONE}},{key:"isInTable",get:function(){return this.zoneId!==c.DEFAULT_REP_ZONE}},{key:"isShortcut",get:function(){var e=(0,a.default)(this.ExternalServices,"Utils.isShortCut");return e&&e()}}]),w);function w(e,t,n,r){y(this,w);var i=b(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,t,n));return i.editbarTrigger=l.Trigger.hover,i.isISVRendered=!1,i.ISVBlockInstance=null,i.container=document.createElement("div"),i.layout=document.createElement("div"),i.isRemote=!1,i.renderLocally=!0,i.inBuffer=!1,i.heightUpdateNotifier=new g.default({getContext:function(){return i.context},getBlockId:function(){return i.blockId}}),i.editbarCommands=[{key:"edit",Icon:function(){return f.default.createElement("div",{className:"isv-edit-btn-wrapper"},f.default.createElement("img",{src:i.getBlockFilledIcon()}),f.default.createElement("span",{className:"edit-btn-text"},i.getBlockName()))},handler:o.default,readOnlyVisibility:[]},l.CommonCommandKey.separator,l.CommonCommandKey.comment],i.enterBuffer=function(){i.inBuffer=!0},i.leaveBuffer=function(){i.inBuffer=!1},i.ExternalServices=r,i.editor=e,$(i.container).addClass("block-container"),$(i.layout).addClass("block-layout").append(i.container),i.mountPoint.appendChild(i.layout),i.resizeObserver=new p.default(function(){(i.inBuffer||i.isInTable)&&(i.ExternalServices.EventEmitter.emit("ISVBlock:containerResize",{node:i.layout}),i.heightUpdateNotifier.notifyWillUpdate(),i.heightUpdateNotifier.notifyDidUpdate())}),i.resizeObserver.observe(i.layout),i}function R(){return k.apply(this,arguments)}function x(e){return C.apply(this,arguments)}function M(){return I.apply(this,arguments)}function N(){return S.apply(this,arguments)}function A(){return T.apply(this,arguments)}t.default=O},function(e,t,n){e.exports=n(79)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80);Object.defineProperty(t,"PlaceholderCreator",{enumerable:!0,get:function(){return z(r).default}});var i=n(84);Object.defineProperty(t,"IframeCreator",{enumerable:!0,get:function(){return z(i).default}});var o=n(98);Object.defineProperty(t,"SheetCreator",{enumerable:!0,get:function(){return z(o).default}});var a=n(41);Object.defineProperty(t,"BitableCreator",{enumerable:!0,get:function(){return z(a).default}});var s=n(106);Object.defineProperty(t,"MindnoteCreator",{enumerable:!0,get:function(){return z(s).default}});var l=n(114);Object.defineProperty(t,"ReminderCreator",{enumerable:!0,get:function(){return z(l).default}}),Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var c=n(125);Object.defineProperty(t,"AtUserCreator",{enumerable:!0,get:function(){return z(c).default}});var u=n(66);Object.defineProperty(t,"AtUser",{enumerable:!0,get:function(){return z(u).default}}),Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var d=n(129);Object.defineProperty(t,"FileCardCreator",{enumerable:!0,get:function(){return z(d).default}});var f=n(135);Object.defineProperty(t,"ChatCardCreator",{enumerable:!0,get:function(){return z(f).default}});var h=n(37);Object.defineProperty(t,"placeholderBlock",{enumerable:!0,get:function(){return z(h).default}});var p=n(57);Object.defineProperty(t,"insertSheetBlock",{enumerable:!0,get:function(){return z(p).default}});var g=n(56);Object.defineProperty(t,"SheetBlock",{enumerable:!0,get:function(){return z(g).default}});var v=n(60);Object.defineProperty(t,"insertBitableBlock",{enumerable:!0,get:function(){return z(v).default}});var m=n(32);Object.defineProperty(t,"BitableBlock",{enumerable:!0,get:function(){return z(m).default}});var y=n(59);Object.defineProperty(t,"DocBitableBlock",{enumerable:!0,get:function(){return z(y).default}});var b=n(61);Object.defineProperty(t,"BitableViewType",{enumerable:!0,get:function(){return b.BitableViewType}});var E=n(141);Object.defineProperty(t,"PollCreator",{enumerable:!0,get:function(){return z(E).default}});var k=n(24);Object.keys(k).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}})});var C=n(158);Object.defineProperty(t,"JiraIssueCreator",{enumerable:!0,get:function(){return z(C).default}});var I=n(176);Object.defineProperty(t,"JiraFilterCreator",{enumerable:!0,get:function(){return z(I).default}});var S=n(13);Object.keys(S).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}})});var T=n(26);Object.keys(T).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}})});var O=n(74);Object.keys(O).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}})});var w=n(187);Object.defineProperty(t,"DiagramCreator",{enumerable:!0,get:function(){return z(w).default}});var R=n(49);Object.defineProperty(t,"RecordManager",{enumerable:!0,get:function(){return z(R).default}}),Object.defineProperty(t,"generateDiagramInitData",{enumerable:!0,get:function(){return R.generateDiagramInitData}});var x=n(27);Object.keys(x).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}})});var M=n(63);Object.defineProperty(t,"insertMindnoteBlock",{enumerable:!0,get:function(){return z(M).default}});var N=n(62);Object.defineProperty(t,"DocMindnoteBlock",{enumerable:!0,get:function(){return z(N).default}});var A=n(33);Object.defineProperty(t,"BASE_SCALE",{enumerable:!0,get:function(){return A.BASE_SCALE}}),Object.defineProperty(t,"pcMindNotePadding",{enumerable:!0,get:function(){return A.pcMindNotePadding}});var _=n(15);Object.defineProperty(t,"Highlight",{enumerable:!0,get:function(){return z(_).default}});var L=n(2);Object.keys(L).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return L[e]}})});var D=n(203);Object.keys(D).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return D[e]}})});var B=n(204);Object.defineProperty(t,"EquationCreator",{enumerable:!0,get:function(){return z(B).default}}),Object.defineProperty(t,"EquationView",{enumerable:!0,get:function(){return B.EquationView}}),Object.defineProperty(t,"equationInsert",{enumerable:!0,get:function(){return B.equationInsert}}),Object.defineProperty(t,"katexManager",{enumerable:!0,get:function(){return B.katexManager}});var P=n(77);Object.defineProperty(t,"ISVBlock",{enumerable:!0,get:function(){return z(P).default}});var F=n(217);Object.defineProperty(t,"ISVCreator",{enumerable:!0,get:function(){return F.ISVCreator}}),Object.defineProperty(t,"insertISVBlock",{enumerable:!0,get:function(){return F.insertISVBlock}});var j=n(220);function z(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"LinkBlockCreator",{enumerable:!0,get:function(){return j.LinkBlockCreator}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1),a=s(n(37));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=(u(f,o.Creator),r(f,[{key:"create",value:function(e,t){return new a.default(e,t,this.ExternalServices)}}]),f);function f(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder;l(this,f);var i=c(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return i.ExternalServices={},i.blockType=o.BlockType.PLACEHOLDER_BLOCK,i.defaultProps={likeUsers:{}},i.ExternalServices=t,i}t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",width:"72",height:"72",viewBox:"0 0 72 72"},t),i.default.createElement("g",{fill:"none",fillRule:"evenodd"},i.default.createElement("path",{fill:"#DEE0E3",d:"M57.4 8.11L6.55 17.08l8.26 46.86 50.87-8.97z"}),i.default.createElement("path",{fill:"#F5F6F7",d:"M21.91 19.72h39.76v38.2H21.91z"}),i.default.createElement("path",{fill:"#C3C6CB",fillRule:"nonzero",d:"M28.17 28.03h27.24v-1.12H28.17zm0 5.01h27.24v-1.12H28.17zm0 5.1h27.24v-1.12H28.17zm0 5.01h17.38v-1.12H28.17z"}),i.default.createElement("g",{transform:"translate(46 46)"},i.default.createElement("path",{fill:"#FFC60A",d:"M0 9a9 9 0 0 0 9 9 9 9 0 0 0 9-9 9 9 0 0 0-9-9 9 9 0 0 0-9 9z"}),i.default.createElement("rect",{width:"1.69",height:"1.69",x:"8.16",y:"11.81",fill:"#FFF",rx:".5"}),i.default.createElement("rect",{width:"1.69",height:"5.63",x:"8.16",y:"4.5",fill:"#FFF",rx:".5"}))))}},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){o(this,a),this.frame=void 0,this.requestPromise=null}t.AnimationFrame=(r(a,[{key:"hasRequested",value:function(){return void 0!==this.frame}},{key:"request",value:function(e){var t=this;return e.cancelPreviousOne&&this.cancel(),null===this.requestPromise&&(this.requestPromise=new Promise(function(e){t.frame=window.requestAnimationFrame(function(){t.frame=void 0,t.requestPromise=null,e()})})),this.requestPromise}},{key:"cancel",value:function(){void 0!==this.frame&&(window.cancelAnimationFrame(this.frame),this.frame=void 0),this.requestPromise=null}}]),a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=f(n(8)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(1),a=n(85),c=n(28),v=n(38),u=n(39),d=n(87);function f(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(97);var m,y=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},b=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},E=(g(k,s.Creator),r(k,[{key:"create",value:function(e,t,n){var r,i=(0,o.default)(t,"props.data",t.props);return i&&(r=i.originalText||i.src||"",this.findMatchedConfig(r)||(t.props.data||(t.props.data={}),t.props.data.url=c.BLANK_URL)),new d.IframeBlock(e,t,n,this.ExternalServices,{isSupportUrl:this.isSupportUrl})}},{key:"findMatchedConfig",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=(e=e.replace(/\\u0026/g,"&"))+JSON.stringify(t);if(this.configCache[n])return this.configCache[n];var r=this.ExternalServices.Utils,i=r.getIFrameConfig,o=r.htmlDecode,a=(0,u.getConfigs)(i),s=t.findInCode;void 0!==s&&s&&(e=o(e),a=a.filter(function(e){return e.code}));var l=this.findConfigOnStr(e,a);return l&&(this.configCache[n]=l)}},{key:"findConfigOnStr",value:function(r,e){try{r=decodeURIComponent(r)}catch(e){}var i=void 0;return e.find(function(n){return!!n.pattern.find(function(e){var t=e.exec(r);return t&&(i={currIframe:n,matched:t}),!!t})}),i}},{key:"onPaste",value:function(e){var t=e.text;if(!t||-1<t.indexOf("\n"))return e;var n=this.tryToGetUrl(t),r=t.trim(),i=(0,v.isUrl)(r);if(i&&(n?this.ExternalServices.LogService.collectEvent("client_insert_iframe",{iframe_type:n.data.type,create_source:"paste"}):this.ExternalServices.LogService.collectEvent("client_insert_url",{source:"indoc_unsupport_URL",url_host:(0,s.getUrlHost)(r),create_source:"paste",has_text:0<r.length})),i||!n)return e;this.logIframeInsert(n);var o=(0,s.generateBlockDataSet)({blockType:s.BlockType.IFRAME_BLOCK,props:{data:Object.assign({},n)}}),a=document.createElement("div");return a.innerHTML=(0,s.generateBlockHTML)(o),{text:t,pasteDataWrapper:a,purifiedHtml:e.purifiedHtml}}},{key:"logIframeInsert",value:function(e){var t=e.data,n=t.type,r=t.url;this.ExternalServices.LogService.collectEvent("client_insert_iframe",{withFileInfo:!0,iframe_type:n,iframe_extra:(0,s.getUrlHost)(r)})}}]),k);function k(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;h(this,k);var g=p(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return g.blockType=s.BlockType.IFRAME_BLOCK,g.defaultProps={},g.configCache={},g.init=function(){var e=g.ExternalServices.Utils.getIFrameConfig;(0,u.getConfigs)(e)},g.isSupportUrl=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return!!(0,v.isUrl)(e)&&!!g.findMatchedConfig(e,t)},g.findSupportCode=function(e){return g.findMatchedConfig(e,{findInCode:!0})},g.findSupportCodeURL=function(e){return e.matched&&e.matched[1]||""},g.generateIframeDataSet=function(e,t){var n=g.tryToGetUrl(e,t);if(n)return(0,s.generateBlockDataSet)({blockType:s.BlockType.IFRAME_BLOCK,props:n})},g.tryToGetUrl=function(e,t){var n=t||g.findMatchedConfig(e);if(n){var r=n.currIframe,i=n.matched,o=r.type,a=r.templateFunc,s=r.resizeType,l=r.defaultWidth,c=r.defaultHeight,u=(0,v.upgradeToHttps)(a(i)),d=g.ExternalServices.Utils.getIFrameBlockSettings,f=(0,v.getIframeSize)({type:o,getIFrameBlockSettings:d,defaultWidth:l,defaultHeight:c,autosize:!(l||c)}),h=f.styleWidth,p=f.styleHeight;return{data:{type:o,url:u,originalText:(0,g.ExternalServices.Utils.htmlEncode)(encodeURI(i.input)).replace(/&/g,"\\u0026")},size:{width:h,height:p,isModified:!1,originalWidth:h,originalHeight:p},resizeType:s}}},g.ExternalServices=t,g.moduleConfigs=i,g.init(),g}t.default=E,y([(0,s.Bind)(),b("design:type",Function),b("design:paramtypes",["function"==typeof(m=void 0!==a.IframeBlockProps&&a.IframeBlockProps)?m:Object]),b("design:returntype",void 0)],E.prototype,"logIframeInsert",null)},function(e,t,n){},function(e,t){e.exports=o("Gz0X")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IframeBlock=void 0;var s=w(n(14)),l=w(n(8)),c=w(n(29)),u=w(n(21)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},d=w(n(0)),f=w(n(5)),a=w(n(10)),h=n(1),p=n(6),g=n(3),v=n(17),m=w(n(7)),y=n(9),b=n(30),E=n(11),k=n(2),C=n(38),I=n(28),S=n(39),T=w(n(55)),O=w(n(96));function w(e){return e&&e.__esModule?e:{default:e}}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function N(e,t,n,r,i){R(this,N);var o=x(this,(N.__proto__||Object.getPrototypeOf(N)).call(this,e,t));o.config={type:"",pattern:[],templateFunc:s.default},o.iframe=null,o.fullScreenIframe=null,o.container=null,o.actionLayer=null,o.iframeClickedLast=!1,o.rendered=!1,o.hasContainer=!0,o.windowEvent=v.GlobalDOMEventEmitter.get(window),o.needActionLayer=!1,o.editbarTrigger=h.Trigger.hover,o.editbarCommands=[],o.oldHeight=0,o.shouldRetain=!0,o.hideLoadingAtEnd=!0,o.appended=!1,o.heightUpdateNotifier=new m.default({getContext:function(){return o.context},getBlockId:function(){return o.blockId}}),o.handleIframeBlur=function(){o.iframeClickedLast=!1,o.updateActionLayerClass(I.ACTION_LAYER_FOCUS_CLASS,"remove")},o.handleWindowFocus=function(){document.activeElement===o.iframe?o.iframeClickedLast=!0:o.iframeClickedLast&&o.handleIframeBlur()},o.handleWindowBlur=function(){o.iframeClickedLast&&document.activeElement!==o.iframe&&o.handleIframeBlur()},o.handleActionLayerClick=function(){o.updateActionLayerClass(I.ACTION_LAYER_FOCUS_CLASS,"add"),o.iframeClickedLast=!0},o.handleActionLayerTouchMove=function(){o.updateActionLayerClass(I.ACTION_LAYER_HOVER_CLASS,"add"),o.actionLayer.innerText=o.ExternalServices.t("iframe.action_message")},o.handleActionLayerTouchEnd=function(){o.updateActionLayerClass(I.ACTION_LAYER_HOVER_CLASS,"remove"),o.actionLayer.innerText="",o.actionLayer.addEventListener("touchmove",o.handleActionLayerTouchMove,{once:!0})},o.init=function(){var e,t,n;o.editbarCommands=[{key:"refresh",Icon:function(){return d.default.createElement(O.default,null)},handler:function(){var e,t;o.iframe&&(e=o.url,t=new URL(e).search,o.iframe.src=e.replace(/#/,(t.includes("?")?"":"?")+"&"+ +new Date+"#"),o.ExternalServices.LogService.collectEvent("click_iframe_refresh"))},tooltip:o.ExternalServices.t("block.editbar_iframe_refresh")},{key:"redirect",Icon:function(){return d.default.createElement(T.default,null)},handler:function(){o.ExternalServices.LogService.collectEvent("click_iframe_openorigin_link");var e=o.getData().originalText,t=(0,C.isUrl)(e)?o.originalText:o.url,n=o.ExternalServices.Helpers;(0,g.openUrl)(t,n)},tooltip:o.ExternalServices.t("block.editbar_iframe_redirect")},h.CommonCommandKey.separator,h.CommonCommandKey.comment],o.props.resizeType&&(t=(e=o.props.size).height,n=e.width,o.defaultStyle={height:t,width:n});var r=(0,l.default)(o.ExternalServices,"Utils.isSwipeMenuEnabled");o.needActionLayer=!(!r||!r()),o.needActionLayer&&(o.windowEvent.on("focus",o.handleWindowFocus),o.windowEvent.on("blur",o.handleWindowBlur))},o.createIframe=function(t,e,n){var r=document.createElement("iframe");return o.setIframeAttribute(r,e),o.toggleDisplay(r,!1),r.onload=function(){n&&n.resolve&&n.resolve();var e=r.contentWindow||r.contentDocument;if(!e||!e.location||t===I.BLANK_URL)return o.onerror();o.config.lazyload?o.loadLazyLoadIframe(r,o.inView()):o.onload()},r.onerror=function(){n&&n.reject&&n.reject(),o.onerror()},r.src=t,r},o.enteredFullScreen=function(){var e;o.container&&(o.iframe&&o.container.removeChild(o.iframe),o.container.className="iframe-container loading",o.config.lazyload?(o.iframe=null,o.appended=!1,o.inView()?o.loadLazyLoadIframe():o.bindLazyloadEvent(!0)):(o.fullScreenIframe||(e=o.createIframe(o.url,!1),o.fullScreenIframe=e),o.container.appendChild(o.fullScreenIframe)))},o.exitedFullScreen=function(){o.container&&o.iframe&&(o.toggleDisplay(o.iframe,!1),o.fullScreenIframe&&o.container.removeChild(o.fullScreenIframe),o.container.className="iframe-container loading",o.config.lazyload?o.bindLazyloadEvent(!0):o.container.appendChild(o.iframe))},o.printEntered=function(){o.container.appendChild(o.iframe),o.onload(),o.appended=!0},o.onload=function(){o.doHeightUpdateTask(function(){o.toggleDisplay(o.iframe,!0),o.container&&(o.container.className="iframe-container loaded")}),o.notifyContentReady(),o.bindLazyloadEvent(!1)},o.handleScroll=(0,c.default)(function(){o.inView()&&o.loadLazyLoadIframe()},17),o.editor=n,o.ExternalServices=r,o.externalParames=i;var a=o.getData().type;return o.config=(0,S.getConfigMap)()[a]||o.config,o.init(),o}t.IframeBlock=(M(N,h.Block),r(N,[{key:"getNotifyWidth",value:function(){return!(0,b.getHasResizeModuleConfig)(this)&&this.props.size?this.props.size.width:0}},{key:"isShowHistoryPlaceholder",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e;return t.historyMode===k.HISTORY_MODE.PLACEHOLDER||t.historyMode===k.HISTORY_MODE.PLACEHOLDER_NEW}},{key:"getData",value:function(){return this.props.data||this.props}},{key:"getEditorWidth",value:function(){var e=this.getPlugin().getEditor().getDocBody();return e?parseInt(e.dataset.lastWidth||"0",10):0}},{key:"blockDidMount",value:function(){this.handleEventBinding(!0)}},{key:"handleEventBinding",value:function(e){var t;this.editor&&(t=(0,E.getAction)(e),this.editor[t]("fullscreenEntered",this.enteredFullScreen),this.editor[t]("fullscreenExited",this.exitedFullScreen),this.editor[t]("printEntered",this.printEntered),this.bindLazyloadEvent(e))}},{key:"completeResizeProps",value:function(){var e,t,n,r,i,o=this.props,a=o.data,s=o.resizeType,l=o.size;!a||!(0,u.default)(s)||(this.props.resizeType=this.config.resizeType||y.ResizeType.None,l)||(e=this.ExternalServices.Utils.getIFrameBlockSettings)&&(t=this.config.type.split("Code")[0],r=(n=(0,C.getIframeSize)({type:t,getIFrameBlockSettings:e,hasResizeModule:!0,defaultWidth:this.getEditorWidth()})).styleWidth,i=n.styleHeight,this.props.size={width:r,height:i,isModify:!1})}},{key:"doHeightUpdateTask",value:function(e){this.heightUpdateNotifier.notifyWillUpdate(),e(),this.heightUpdateNotifier.notifyDidUpdate()}},{key:"updateActionLayerClass",value:function(e,t){this.actionLayer&&this.actionLayer.classList[t](e)}},{key:"createActionLayer",value:function(){var e=document.createElement("div");return e.classList.add(I.ACTION_LAYER_CLASS),e.addEventListener("click",this.handleActionLayerClick),e.addEventListener("touchmove",this.handleActionLayerTouchMove,{once:!0}),e.addEventListener("touchend",this.handleActionLayerTouchEnd),e}},{key:"updateSelectionClassName",value:function(e,t){var n="covered";t===h.SelectionState.COVER_ON_BLOCK?e.add(n):e.remove(n)}},{key:"isRenderLinkInMobile",value:function(){var e=this.config,t=e.renderLinkInMobile,n=e.renderLinkInAndroid,r=e.renderLinkInIOS;return t||p.browser.android&&n||p.browser.ios&&r}},{key:"render",value:function(){var r=this;if(this.isShowHistoryPlaceholder())return f.default.render(this.getHistoryView(),this.mountPoint),void(this.rendered=!0);if(this.rendered){var e,t,n=this.mountPoint.querySelector(".iframe-container");if(!n)return void(this.hasContainer||(e=this.mountPoint.classList,t=this.attributes.selectState,this.updateSelectionClassName(e,t)));var i=n.classList,o=this.attributes,a=o.selected,s=o.selectState,l="selected";return a?(i.add(l),this.handleActionLayerClick()):(i.remove(l),this.handleIframeBlur()),void this.updateSelectionClassName(i,s)}if(p.browser.isMobile&&this.isRenderLinkInMobile()){var c=document.createElement("a"),u=this.originalText;return c.href=u,c.target="_blank",c.innerText=u,this.mountPoint.appendChild(c),this.mountPoint.classList.add("block-link-container"),this.hasContainer=!1,this.mountPoint.style.fontSize="16px",void(this.rendered=!0)}return new Promise(function(e,t){var n=document.createElement("div");n.className="iframe-container loading",r.container=n,r.iframe=r.createIframe(r.url,!0,{resolve:e,reject:t}),n.appendChild(r.iframe),r.needActionLayer&&(r.actionLayer=r.createActionLayer(),n.appendChild(r.actionLayer)),r.doHeightUpdateTask(function(){r.mountPoint.appendChild(n),r.renderWithSizeIfNeeded(n)}),r.rendered=!0})}},{key:"allowReferrerpolicy",value:function(){var t=this,e=["ad","tiktok"],n=this.config.type;if(e.includes(n)){var r=(0,S.getConfigMap)()[n];if(r){var i=r.pattern;return Boolean(i.find(function(e){return e.test(t.originalText)}))}}return!1}},{key:"setIframeAttribute",value:function(e,t){var n=this.config,r=n.type,i=n.border,o=n.copyable,a=["allow-scripts","allow-same-origin","allow-popups","allow-presentation","allow-forms"];p.browser.isSafari&&a.push("allow-storage-access-by-user-activation"),"jinshuju"===r&&a.push("allow-top-navigation-by-user-activation");var s=a.join(" ");e.setAttribute("sandbox",s),e.setAttribute("frameborder","0"),t&&e.setAttribute("allowFullScreen","");var l=["encrypted-media;"];o&&l.push("clipboard-write;"),e.setAttribute("allow",l.join("")),"processon"===r&&(e.id="embed_dom",e.setAttribute("name","embed_dom")),this.allowReferrerpolicy()&&e.setAttribute("referrerpolicy","no-referrer-when-downgrade"),i&&e.classList.add("iframe-border")}},{key:"renderWithSizeIfNeeded",value:function(e){var t=this.props.size,n=!!(0,b.getHasResizeModuleConfig)(this);t&&n&&!this.rendered&&(e.style.width=t.width+"px",e.style.height=t.height+"px")}},{key:"resize",value:function(e,t){t=t||1/0;var n=this.ExternalServices.Utils.getIFrameBlockSettings;if(n){var r=!!(0,b.getHasResizeModuleConfig)(this);if(!this.iframe||r&&!p.browser.isMobile)return;var i=this.config,o=i.type,a=i.defaultWidth,s=i.defaultHeight,l=this.autosize,c=(0,C.getIframeSize)({type:o,getIFrameBlockSettings:n,hasResizeModule:r,defaultWidth:l?e:a,defaultHeight:l?t:s,autosize:l}),u=c.styleWidth,d=c.styleHeight;this.oldHeight!==d&&(this.heightUpdateNotifier.notifyWillUpdate(),this.oldHeight=d),this.iframe.style.width=u+"px",this.iframe.style.height=d+"px"}this.heightUpdateNotifier.notifyDidUpdate()}},{key:"collectText",value:function(){return"["+this.plainText+"]"}},{key:"onerror",value:function(){var t=this;this.doHeightUpdateTask(function(){var e;t.container&&"iframe-container error"!==t.container.className&&(t.container.className="iframe-container error",(e=document.createElement("span")).innerText=t.ExternalServices.t("iframe.error_message"),t.container.appendChild(e))})}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=(0,h.generateBlockDataSet)({blockType:t,props:n}),i=this.ExternalServices.t("block.common_paste_unsupported");return{html:(0,h.generateBlockHTML)(r,i),text:this.url||this.src||this.originalText}}},{key:"unmount",value:function(e){var t;this.handleScroll.cancel(),o(N.prototype.__proto__||Object.getPrototypeOf(N.prototype),"unmount",this).call(this,e),this.handleEventBinding(!1),this.needActionLayer&&(this.windowEvent.off("focus",this.handleWindowFocus),this.windowEvent.off("blur",this.handleWindowBlur),(t=this.actionLayer)&&(t.removeEventListener("click",this.handleActionLayerClick),t.removeEventListener("touchmove",this.handleActionLayerTouchMove),t.removeEventListener("touchend",this.handleActionLayerTouchEnd))),this.heightUpdateNotifier.destroy()}},{key:"getHistoryView",value:function(){var e=this.props,t=(e.data||{}).url||e.url||"-";if(!(0,C.isUrl)(t))return d.default.createElement("span",null,t);var n=this.externalParames.isSupportUrl(t);return d.default.createElement("div",{className:"url iframe-history-item"},this.plainText,"",n?d.default.createElement("a",{href:t},t):t)}},{key:"bindLazyloadEvent",value:function(e){var t,n,r;this.config.lazyload&&(IntersectionObserver?(this.observer||this.initObserver(),t=(0,a.default)(this.mountPoint).parents(".ace-line")[0],this.observer[e?"observe":"unobserve"](t)):(n=this.editor.getScrollContainer(),r=(0,E.getHandle)(e),n&&n[r]("scroll",this.handleScroll)))}},{key:"initObserver",value:function(){var r=this;this.observer=new IntersectionObserver(function(e){e.forEach(function(e){var t=e.target,n=e.intersectionRatio;0<n&&n<=1&&(r.loadLazyLoadIframe(),r.observer.unobserve(t)),t.addEventListener("load",function(){return r.observer.unobserve(t)}),t.addEventListener("error",function(){return r.observer.unobserve(t)})})})}},{key:"inView",value:function(){var e=(0,a.default)(this.mountPoint).parents(".ace-line").offset().top,t=this.editor.getScrollContainer().clientHeight;return-400<e&&e<t}},{key:"loadLazyLoadIframe",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.iframe,t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=!!e;"autonavi"===(e=e||(this.iframe=this.createIframe(this.url,!1)),this.getData().type)?this.appended?this.onload():t&&this.container&&this.container.appendChild(e):t&&(n?this.onload():this.container&&this.container.appendChild(e)),this.appended=!0}},{key:"toggleDisplay",value:function(e,t){var n=this.config,r=n.lazyload,i=n.type;r&&("autonavi"===i?this.doHeightUpdateTask(function(){e.style.opacity=t?"1":"0"}):this.doHeightUpdateTask(function(){e.style.display=t?"block":"none"}))}},{key:"url",get:function(){var e=this.getData().url;return(0,C.formatUrl)(e)}},{key:"originalText",get:function(){var e=this.getData().originalText;return(0,C.formatUrl)(e)}},{key:"src",get:function(){var e=this.getData().src;return e&&(0,C.formatUrl)(e)}},{key:"plainText",get:function(){return this.ExternalServices.t("block.iframe")}},{key:"autosize",get:function(){var e=this.config,t=e.defaultWidth,n=e.defaultHeight;return!p.browser.isMobile||!(t||n)}}]),N)},function(e,t){e.exports=o("GBY4")},function(e,t){e.exports=o("qxQb")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=p(n(8)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=p(n(0)),s=p(n(5)),l=n(1),c=p(n(53)),u=n(17),d=n(40),f=n(9),h=n(2);function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var v=(i(m,[{key:"markResizeRegion",value:function(){this.resizeRegion.classList.add(f.RESIZE_REGION_CLASS)}},{key:"buildResizeContainer",value:function(){this.blockResizableContainer=document.createElement("div"),this.blockResizableContainer.className=f.resizeContainerClass,this.blockResizableContainer.dataset.blockId=this.block.blockId;var e=this.blockResizableContainer.classList;this.isHoverResizeTriggerType()||e.add(f.resizeContainerClass+"__hide-outline"),this.resizeRegion.insertBefore(this.blockResizableContainer,this.block.mountPoint)}},{key:"isSelectedResizeTriggerType",value:function(){return this.getBlockResizeTriggerType()===d.ResizeTriggerType.Selected}},{key:"isHoverResizeTriggerType",value:function(){return this.getBlockResizeTriggerType()===d.ResizeTriggerType.Hover}},{key:"getBlockResizeTriggerType",value:function(){return(0,r.default)(this,"block.resizeTriggerType",d.ResizeTriggerType.Hover)}},{key:"setVisibleEnable",value:function(){this.visibleEnable=!0}},{key:"doResize",value:function(e,t){this.resizeRef&&this.resizeRef.doResize(e,t)}},{key:"confirmResize",value:function(){this.resizeRef&&this.resizeRef.updateResizeBlockWhenDidMount()}},{key:"renderResizeView",value:function(){s.default.render(a.default.createElement(c.default,{block:this.block,container:this.resizeRegion,resizeType:this.block.props.resizeType||f.ResizeType.None,sliderType:this.block.props.sliderType||f.SliderType.Point,ref:this.setRef,setVisible:this.setVisible,blockResizableContainer:this.blockResizableContainer,externalServices:this.externalServices}),this.blockResizableContainer)}},{key:"bindEvents",value:function(e){this.isEventsBind&&!e||(this.isHoverResizeTriggerType()&&(this.resizeRegion.addEventListener("mouseenter",this.showSlider),this.resizeRegion.addEventListener("mouseleave",this.hideSlider)),this.isSelectedResizeTriggerType()&&this.documentEvent.on("click",this.toggleSliderIfSelected),this.isEventsBind=!0)}},{key:"unBindEvents",value:function(){this.isEventsBind&&(this.isHoverResizeTriggerType()&&(this.resizeRegion.removeEventListener("mouseenter",this.showSlider),this.resizeRegion.removeEventListener("mouseleave",this.hideSlider)),this.isSelectedResizeTriggerType()&&this.documentEvent.off("click",this.toggleSliderIfSelected),this.isEventsBind=!1)}},{key:"getIsEditable",value:function(){return this.permissions.editable}},{key:"blockDidUpdate",value:function(){this.resizeRef&&(this.block.props&&this.block.props.size&&this.resizeRef.blockUpdateSize(this.block.props),this.updateResizeRegion())}},{key:"updateResizeRegion",value:function(){this.getIsEditable()&&this.unBindEvents(),this.resizeRegion=this.block.mountPoint.parentElement,this.getIsEditable()&&this.bindEvents(!0),this.markResizeRegion(),this.renderResizeView()}},{key:"destroy",value:function(){this.unBindEvents(),this.resizeRef&&this.resizeRef.unBindEvents(),this.blockResizableContainer&&s.default.unmountComponentAtNode(this.blockResizableContainer),this.blockResizableContainer=null}},{key:"clearVisibleLock",value:function(){this.visibleLock=0}},{key:"setEditable",value:function(e){e?this.bindEvents():(this.setVisible(!1),this.unBindEvents()),this.resizeRef&&this.resizeRef.setEditable(e)}},{key:"handlePermissionChange",value:function(e){(!this.isEventsBind&&e.editable||this.isEventsBind&&!e.editable)&&this.setEditable(e.editable),this.clearVisibleLock()}},{key:"resizeBlockFromRemote",value:function(e){this.resizeRef&&this.resizeRef.resizeBlockFromRemote(e)}},{key:"permissions",get:function(){var e=this.blockCore.modules.permission;return e?e.permissions:h.DEFAULT_PERMISSIONS}}]),m);function m(e,t,n){var a=this;g(this,m),this.blockCore=n,this.resizeRef=null,this.blockResizableContainer=null,this.documentEvent=u.GlobalDOMEventEmitter.get(document),this.visibleLock=0,this.isEventsBind=!1,this.preSelected=!1,this.visibleEnable=!1,this.setRef=function(e){a.resizeRef=e,a.resizeRef&&a.resizeRef.setEditable(a.getIsEditable())},this.toggleSliderIfSelected=function(e){var t,n=e.target,r=n&&n.closest("."+l.BLOCK_PLACEHOLDER),i=void 0;!r||(t=(0,l.getBlockDataSet)(r))&&(i=t.blockId);var o=i&&i===a.block.blockId;o&&!a.preSelected?a.showSlider():!o&&a.preSelected&&a.hideSlider(),a.preSelected=o},this.setVisibleLock=function(e){a.visibleLock+=e?1:-1,a.visibleLock=Math.max(a.visibleLock,0)},this.setVisible=function(e){var t;a.getIsEditable()&&a.visibleEnable&&(e||a.setVisibleLock(!1),!a.visibleLock&&a.blockResizableContainer&&(t=a.blockResizableContainer.classList,e?t.add(f.RESIZE_REGION_SHOW_CLASS):t.remove(f.RESIZE_REGION_SHOW_CLASS)),e&&a.setVisibleLock(!0))},this.showSlider=function(){a.setVisible(!0)},this.hideSlider=function(){a.setVisible(!1)},this.setSliderVisibleByBlock=function(e){e&&!a.preSelected?a.showSlider():!e&&a.preSelected&&a.hideSlider(),a.preSelected=e},this.externalServices=t,this.block=e,this.resizeRegion=e.mountPoint.parentElement,this.markResizeRegion(),this.buildResizeContainer(),this.renderResizeView(),this.setEditable(this.permissions.editable)}t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n(0)),o=n(92),a=n(9);function r(e){return e&&e.__esModule?e:{default:e}}n(94);var s=function(e){var t=e.resizeType,n=e.sliderType,r=a.ResizeTypeDirectionMap[t];return i.default.createElement(i.default.Fragment,null,r.map(function(e){return e&&i.default.createElement(o.ResizableSlider,{direction:e,key:e,sliderType:n})}))};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResizableSlider=void 0;var i=r(n(0)),o=r(n(4)),a=n(9);function r(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n(93),t.ResizableSlider=function(e){var t,n=e.direction,r=e.sliderType;return i.default.createElement("span",{className:(0,o.default)(""+a.sliderClass,a.sliderClass+"-"+n,(s(t={},a.sliderClass+"__point",r===a.SliderType.Point),s(t,a.sliderClass+"__line",r===a.SliderType.Line),t)),"data-direction":n})}},function(e,t,n){},function(e,t,n){},function(e,t){e.exports=o("vJtL")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M16.47 8.89a5.44 5.44 0 1 0 .75 4.67h1.6a7 7 0 1 1-1.38-5.96V5.39c0-.22.18-.39.4-.39h.77c.22 0 .39.17.39.39v4.28a.78.78 0 0 1-.78.77h-4.28a.39.39 0 0 1-.38-.38v-.78c0-.22.17-.4.38-.4h2.53z",fillRule:"evenodd"}))}},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=s(n(21)),E=s(n(99)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=n(1),a=s(n(56)),k=n(57),C=s(n(10)),b=n(58),I=n(3);function s(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f,h=(d(S,y.Creator),i(S,[{key:"getSheetBridge",value:function(){return this.ExternalServices.getSheetBridge()}},{key:"create",value:function(e,t,n){var r=a.default.processToken(t.token).sheetId;return this.setBlockIdForSheetId(r,t.blockId),new a.default(e,t,n,this.ExternalServices,this.setBlockIdForSheetId)}},{key:"notify",value:(f=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("screenshot"!==t.eventType){e.next=11;break}if(t.status===y.NotifyStatus.start)return n=!(!(0,r.default)(t.detail)&&!(0,r.default)(t.detail.isBlob))||t.detail.isBlob,e.next=5,this.getSheetBridge().takeScreenShot(n);e.next=6;break;case 5:this.screenShot=e.sent;case 6:if(t.status!==y.NotifyStatus.end){e.next=11;break}if(this.screenShot){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,this.screenShot.done();case 11:case"end":return e.stop()}},e,this)})),p)},{key:"getIsDepLoaded",value:function(){return this.ExternalServices.isDocSheetBridgeLoaded()}},{key:"loadDep",value:function(){return this.ExternalServices.loadDocSheetBridge()}},{key:"onInternalPaste",value:function(e){var t=e.getHTML,n=e.pasteFrom,r=e.pasteTimes,i=e.originalEvent,o=t(),a=document.createElement("div");a.innerHTML=o;var s,l=(0,C.default)(a),c=S.getTablesWhichWillPasteAsSheet(l)[0],u=l.find("style"),d=l.find(".block-type-BITABLE_BLOCK").length;0===d&&i&&(d=(s=i.clipboardData)&&s.getData("text/bitable")?1:0),this.ExternalServices.EventEmitter.trigger("PASTE_TO_DOC",[o,l,1,!1,d]);var f=(0,E.default)(u,function(e){return e.outerHTML});if(this.getIsDepLoaded()){var h=this.ExternalServices.getHtmlWhilePastingSheet,p=h?h(o):"",g={withComment:"cut"===p&&1===r,pasteFrom:p},v=this.getTableHtml(c),m=(0,k.generateDataSet)(f,v,g,this.ExternalServices);if(!m)throw new Error("can not generate sheet dataset from serialize html");var y=m.token;return y&&((0,I.captureException)("Error! Pasted sheet has token "+y+"."),delete m.token),m}var b=this.getTableHtml(c);return(0,k.generateLoadingDataSet)({source:k.InsertSheetSource.Paste,pasteParams:{pasteHTML:o,tableHTML:b,styleHTMLs:f,gernerateOption:{withComment:"cut"===n&&1===r}}})}},{key:"onPaste",value:function(e){var t,s=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=e.pasteDataWrapper,o=e.purifiedHtml,l=n.firstPasteAfterCut,i=n.event,a=(0,C.default)(r),c=S.getTablesWhichWillPasteAsSheet(a),u=a.find("style");o&&((t=document.createElement("div")).innerHTML=o,u=(0,C.default)(t).find("style"));var d,f=a.find(".block-type-BITABLE_BLOCK").length;if(0===f&&i&&(f=(d=i.originalEvent.clipboardData)&&d.getData("text/bitable")?1:0),0===c.length)return this.ExternalServices.EventEmitter.trigger("PASTE_TO_DOC",[o,a,c.length,!1,f]),e;var h,p,g,v,m=c[0].getElementsByTagName("td");return 1===c.length&&1===m.length?(this.ExternalServices.EventEmitter.trigger("PASTE_TO_DOC",[o,a,c.length,!0,f]),h=(0,b.escapeHTML)(m[0].innerText),(0,C.default)(c[0]).replaceWith(h)):(this.ExternalServices.EventEmitter.trigger("PASTE_TO_DOC",[o,a,c.length,!1,f]),p=(0,E.default)(u,function(e){return e.outerHTML}),this.getIsDepLoaded()?(g=this.ExternalServices.getHtmlWhilePastingSheet,v=g?g(o):"",c.each(function(e,t){var n,r,i=s.getTableHtml(t),o={withComment:l,pasteFrom:v},a=(0,k.generateDataSet)(p,i,o,s.ExternalServices);a?((n=a.token)&&((0,I.captureException)("Error! Pasted sheet has token "+n+"."),delete a.token),r=(0,y.generateBlockHTML)(a),(0,C.default)(t).replaceWith(r)):(0,C.default)(t).replaceWith("")})):c.each(function(e,t){var n=s.getTableHtml(t),r=(0,k.generateLoadingDataSet)({source:k.InsertSheetSource.Paste,pasteParams:{pasteHTML:o,tableHTML:n,styleHTMLs:p,gernerateOption:{withComment:l}}}),i=(0,y.generateBlockHTML)(r);(0,C.default)(t).replaceWith(i)})),{pasteDataWrapper:a[0],text:e.text,purifiedHtml:o}}},{key:"makeLoadedDataSet",value:function(e){var t=e.initData;if(!t)return null;var n=(0,y.parseEscapedInitData)(t);if(n.source===k.InsertSheetSource.Paste){var r=n.pasteParams,i=r.pasteHTML,o=r.styleHTMLs,a=r.tableHTML,s=r.gernerateOption,l=this.ExternalServices.getHtmlWhilePastingSheet,c=l?l(i):"",u=Object.assign({},s,{pasteFrom:c});return(0,k.generateDataSet)(o,a,u,this.ExternalServices)}if(n.source!==k.InsertSheetSource.Insert)return null;var d=n.insertParams.sheetSize;return(0,k.generateInsertSheetDataSetWithSideEffect)(d,this.ExternalServices)}},{key:"getTableHtml",value:function(e){return(e.parentElement&&"byte-sheet-html-origin"===e.parentElement.tagName.toLowerCase()?e.parentElement:e).outerHTML}}],[{key:"getTablesWhichWillPasteAsSheet",value:function(e){var t={GOOGLE_SHEET:'content="Sheets"',GOOGLE_TABLE:'id="docs-internal-guid',QQ_SHEET:'xmlns:x="tencent"',QQ_TABLE:"<melo-data",QQ_TABLE_OLD:"copy-ghost-table-wrapper",MS_EXCEL:'xmlns:x="urn:schemas-microsoft-com:office:excel"',MS_WORD:'class="MsoTableGrid"',BYTE_SHEET:'class="byte-sheet"',BYTE_BITABLE:'class="byte-bitable"',PAPER_TABLE:"data-ace-table-col-widths",WIKI_TABLE:"confluenceTable",BYTE_TABLE:'className="ace-table'},n=[t.MS_WORD,t.QQ_TABLE,t.QQ_TABLE_OLD,t.WIKI_TABLE,t.GOOGLE_TABLE,t.WIKI_TABLE,t.BYTE_BITABLE],r=[t.PAPER_TABLE,t.BYTE_TABLE],i=e.html();return n.some(function(e){return-1!==i.indexOf(e)})?[]:e.find("table").filter(function(e,t){return r.every(function(e){return-1===t.outerHTML.indexOf(e)})})}}]),S);function S(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder;c(this,S);var i=u(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return i.screenShot=null,i.ExternalServices={},i.blockType=y.BlockType.SHEET_BLOCK,i.defaultProps={},i.sheetIdToBlockId=new Map,i.getBlockIdBySheetId=function(e){var t=i.sheetIdToBlockId.get(e);if(!t)throw new Error("Cannot get `blockId` from Sheet block.");return t},i.setBlockIdForSheetId=function(e,t){i.sheetIdToBlockId.has(e)||i.sheetIdToBlockId.set(e,t)},i.ExternalServices=t,i}function p(e){return f.apply(this,arguments)}t.default=h},function(e,t){e.exports=o("zmn3")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmbedBlockToolbar=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){var i=this;a(this,s),this.toolbarState={items:[]},this.toolbarItemsHOC={},this.getToolbarItem=function(e){var t=i.toolbarState.items[e];return!t||t&&"comment"===t.type?null:t},this.onSheetBlockToolbarStatusEvent=function(e){e.detail.sheetId===i.sheetId&&(i.toolbarState=e.detail,i.block.editbarCommands=i.getEditorbarCommands(),i.block.replaceCommandPlaceholder(),i.block.blockContext.updateEditbar&&i.block.blockContext.updateEditbar(i.block.editbarCommands,i.block))},this.getEditorbarCommands=function(){var e=i.toolbarState,r=[];return e.items.forEach(function(e,t){var n;e&&(n="toolbarItem_"+t,i.toolbarItemsHOC[n]=i.toolbarItemsHOC[n]||function(){return i.getToolbarItem(t)},"comment"===e.type?r.push(o.CommonCommandKey.comment):r.push({key:"toolbarItem_"+t,Icon:i.toolbarItemsHOC[n],handler:function(){}}))}),r},this.sheetId=e,this.block=t,this.ExternalServices=t.ExternalServices,this.bindEvents()}t.EmbedBlockToolbar=(r(s,[{key:"bindEvents",value:function(){if(!this.sheetId)throw Error("Null SheetID! Cannot Build SheetBlockToolbar!");window.addEventListener("block:sheet-toolbar-status-"+this.sheetId,this.onSheetBlockToolbarStatusEvent)}},{key:"hideAllDialog",value:function(){var e=(0,this.ExternalServices.Utils.createCustomEvent)("block:sheet-toolbar-hide-dialog",{detail:{sheetId:this.sheetId},bubbles:!1,cancelable:!0});window.dispatchEvent(e)}},{key:"show",value:function(){var e=(0,this.ExternalServices.Utils.createCustomEvent)("block:sheet-toolbar-show",{detail:{sheetId:this.sheetId},bubbles:!1,cancelable:!0});window.dispatchEvent(e)}},{key:"destroy",value:function(){window.removeEventListener("block:sheet-toolbar-status-"+this.sheetId,this.onSheetBlockToolbarStatusEvent),this.toolbarState={items:[]}}}]),s)},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=(t.SheetMountStatus=void 0)||(t.SheetMountStatus={}))[r.SUCCESS=0]="SUCCESS",r[r.NO_EXISTS=1]="NO_EXISTS"},function(e,t,n){},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjY4cHgiIGhlaWdodD0iMTEwcHgiIHZpZXdCb3g9IjAgMCAyNjggMTEwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA2MC4xICg4ODEzMykgLSBodHRwczovL3NrZXRjaC5jb20gLS0+CiAgICA8dGl0bGU+5pyq5ZG95ZCNPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Iumhtemdoi0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0i5LiL6L29IiBmaWxsLXJ1bGU9Im5vbnplcm8iPgogICAgICAgICAgICA8ZyBpZD0iaGlzdG9yeV9wbGFjZWhvbGRlcl96aCI+CiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLTM4IiBmaWxsPSIjRTFFQUZGIiB4PSIwIiB5PSIwIiB3aWR0aD0iMjY4IiBoZWlnaHQ9IjExMCI+PC9yZWN0PgogICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgc3Ryb2tlPSIjRUZGMEYxIiBmaWxsPSIjRkZGRkZGIiB4PSI0LjUiIHk9IjI0LjUiIHdpZHRoPSIyNTkiIGhlaWdodD0iODUiPjwvcmVjdD4KICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8ZyBpZD0i57yW57uELTUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIyLjAwMDAwMCwgMzguMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8ZyBpZD0i57yW57uEIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5My41MDAwMDAsIDAuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Iue8lue7hC0zIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjAwMDAwMCwgMTguMDAwMDAwKSIgZmlsbD0iI0VGRjBGMSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik01Mi4yODMzOTM1LDEuMTE4MjU2NTYgTDU1LjMwODczMTksNC4xNDQ4NDU2NiBDNTUuNDY2MTU4Nyw0LjMwMjMzNzYgNTUuNDY2MTA2LDQuNTU3NjI5NzEgNTUuMzA4NjE0LDQuNzE1MDU2NTYgQzU1LjIzMzAwNDIsNC43OTA2MzUxOSA1NS4xMzA0NzM5LDQuODMzMDkyMTkgNTUuMDIzNTY3NSw0LjgzMzA5MjE5IEw0OC45NzMxMjY1LDQuODMzMDkyMTkgQzQ4Ljc1MDQ0NTMsNC44MzMwOTIxOSA0OC41Njk5MjY1LDQuNjUyNTczNCA0OC41Njk5MjY1LDQuNDI5ODkyMTkgQzQ4LjU2OTkyNjUsNC4zMjI5ODU3OCA0OC42MTIzODM1LDQuMjIwNDU1NTQgNDguNjg3OTYyMSw0LjE0NDg0NTY2IEw1MS43MTMzMDA1LDEuMTE4MjU2NTYgQzUxLjg3MDYwOTUsMC45NjA2NDY4MzIgNTIuMTI1OTAxNiwwLjk2MDU5NDA3MiA1Mi4yODMzOTM1LDEuMTE4MDIwOTIgQzUyLjI4MzQzMjgsMS4xMTgwNjAxOSA1Mi4yODM0NzIxLDEuMTE4MDk5NDggNTIuMjgzMzkzNSwxLjExODI1NjU2IFoiIGlkPSLkuInop5LlvaLlpIfku70tNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTEuOTk4MzQ3LCAyLjkxNjU0Nikgc2NhbGUoLTEsIDEpIHJvdGF0ZSgtMTgwLjAwMDAwMCkgdHJhbnNsYXRlKC01MS45OTgzNDcsIC0yLjkxNjU0NikgIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIHg9IjAiIHk9IjAiIHdpZHRoPSI0NCIgaGVpZ2h0PSI2IiByeD0iMC45Ij48L3JlY3Q+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgICAgIDxnIGlkPSLnvJbnu4QtMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDM0LjAwMDAwMCkiIGZpbGw9IiNFRkYwRjEiPgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNTIuMjgzMzkzNSwxLjExODI1NjU2IEw1NS4zMDg3MzE5LDQuMTQ0ODQ1NjYgQzU1LjQ2NjE1ODcsNC4zMDIzMzc2IDU1LjQ2NjEwNiw0LjU1NzYyOTcxIDU1LjMwODYxNCw0LjcxNTA1NjU2IEM1NS4yMzMwMDQyLDQuNzkwNjM1MTkgNTUuMTMwNDczOSw0LjgzMzA5MjE5IDU1LjAyMzU2NzUsNC44MzMwOTIxOSBMNDguOTczMTI2NSw0LjgzMzA5MjE5IEM0OC43NTA0NDUzLDQuODMzMDkyMTkgNDguNTY5OTI2NSw0LjY1MjU3MzQgNDguNTY5OTI2NSw0LjQyOTg5MjE5IEM0OC41Njk5MjY1LDQuMzIyOTg1NzggNDguNjEyMzgzNSw0LjIyMDQ1NTU0IDQ4LjY4Nzk2MjEsNC4xNDQ4NDU2NiBMNTEuNzEzMzAwNSwxLjExODI1NjU2IEM1MS44NzA2MDk1LDAuOTYwNjQ2ODMyIDUyLjEyNTkwMTYsMC45NjA1OTQwNzIgNTIuMjgzMzkzNSwxLjExODAyMDkyIEM1Mi4yODM0MzI4LDEuMTE4MDYwMTkgNTIuMjgzNDcyMSwxLjExODA5OTQ4IDUyLjI4MzM5MzUsMS4xMTgyNTY1NiBaIiBpZD0i5LiJ6KeS5b2i5aSH5Lu9LTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUxLjk5ODM0NywgMi45MTY1NDYpIHNjYWxlKC0xLCAxKSByb3RhdGUoLTE4MC4wMDAwMDApIHRyYW5zbGF0ZSgtNTEuOTk4MzQ3LCAtMi45MTY1NDYpICI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDQiIGhlaWdodD0iNiIgcng9IjAuOSI+PC9yZWN0PgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0i57yW57uELTMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLCA1MC4wMDAwMDApIiBmaWxsPSIjRUZGMEYxIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTUyLjI4MzM5MzUsMS4xMTgyNTY1NiBMNTUuMzA4NzMxOSw0LjE0NDg0NTY2IEM1NS40NjYxNTg3LDQuMzAyMzM3NiA1NS40NjYxMDYsNC41NTc2Mjk3MSA1NS4zMDg2MTQsNC43MTUwNTY1NiBDNTUuMjMzMDA0Miw0Ljc5MDYzNTE5IDU1LjEzMDQ3MzksNC44MzMwOTIxOSA1NS4wMjM1Njc1LDQuODMzMDkyMTkgTDQ4Ljk3MzEyNjUsNC44MzMwOTIxOSBDNDguNzUwNDQ1Myw0LjgzMzA5MjE5IDQ4LjU2OTkyNjUsNC42NTI1NzM0IDQ4LjU2OTkyNjUsNC40Mjk4OTIxOSBDNDguNTY5OTI2NSw0LjMyMjk4NTc4IDQ4LjYxMjM4MzUsNC4yMjA0NTU1NCA0OC42ODc5NjIxLDQuMTQ0ODQ1NjYgTDUxLjcxMzMwMDUsMS4xMTgyNTY1NiBDNTEuODcwNjA5NSwwLjk2MDY0NjgzMiA1Mi4xMjU5MDE2LDAuOTYwNTk0MDcyIDUyLjI4MzM5MzUsMS4xMTgwMjA5MiBDNTIuMjgzNDMyOCwxLjExODA2MDE5IDUyLjI4MzQ3MjEsMS4xMTgwOTk0OCA1Mi4yODMzOTM1LDEuMTE4MjU2NTYgWiIgaWQ9IuS4ieinkuW9ouWkh+S7vS00IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1MS45OTgzNDcsIDIuOTE2NTQ2KSBzY2FsZSgtMSwgMSkgcm90YXRlKC0xODAuMDAwMDAwKSB0cmFuc2xhdGUoLTUxLjk5ODM0NywgLTIuOTE2NTQ2KSAiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgeD0iMCIgeT0iMCIgd2lkdGg9IjQ0IiBoZWlnaHQ9IjYiIHJ4PSIwLjkiPjwvcmVjdD4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iI0RFRTBFMyIgeD0iMCIgeT0iMCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjgiIHJ4PSIwLjkiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxnIGlkPSLnvJbnu4QiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE2Ny4wMDAwMDAsIDAuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Iue8lue7hC0zIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjAwMDAwMCwgMTguMDAwMDAwKSIgZmlsbD0iI0VGRjBGMSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik01My4yODMzOTM1LDEuMTE4MjU2NTYgTDU2LjMwODczMTksNC4xNDQ4NDU2NiBDNTYuNDY2MTU4Nyw0LjMwMjMzNzYgNTYuNDY2MTA2LDQuNTU3NjI5NzEgNTYuMzA4NjE0LDQuNzE1MDU2NTYgQzU2LjIzMzAwNDIsNC43OTA2MzUxOSA1Ni4xMzA0NzM5LDQuODMzMDkyMTkgNTYuMDIzNTY3NSw0LjgzMzA5MjE5IEw0OS45NzMxMjY1LDQuODMzMDkyMTkgQzQ5Ljc1MDQ0NTMsNC44MzMwOTIxOSA0OS41Njk5MjY1LDQuNjUyNTczNCA0OS41Njk5MjY1LDQuNDI5ODkyMTkgQzQ5LjU2OTkyNjUsNC4zMjI5ODU3OCA0OS42MTIzODM1LDQuMjIwNDU1NTQgNDkuNjg3OTYyMSw0LjE0NDg0NTY2IEw1Mi43MTMzMDA1LDEuMTE4MjU2NTYgQzUyLjg3MDYwOTUsMC45NjA2NDY4MzIgNTMuMTI1OTAxNiwwLjk2MDU5NDA3MiA1My4yODMzOTM1LDEuMTE4MDIwOTIgQzUzLjI4MzQzMjgsMS4xMTgwNjAxOSA1My4yODM0NzIxLDEuMTE4MDk5NDggNTMuMjgzMzkzNSwxLjExODI1NjU2IFoiIGlkPSLkuInop5LlvaLlpIfku70tNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNTIuOTk4MzQ3LCAyLjkxNjU0Nikgc2NhbGUoLTEsIDEpIHJvdGF0ZSgtMTgwLjAwMDAwMCkgdHJhbnNsYXRlKC01Mi45OTgzNDcsIC0yLjkxNjU0NikgIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIHg9IjAiIHk9IjAiIHdpZHRoPSI0NCIgaGVpZ2h0PSI2IiByeD0iMC45Ij48L3JlY3Q+CiAgICAgICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICAgICAgICAgIDxnIGlkPSLnvJbnu4QtMyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDM0LjAwMDAwMCkiIGZpbGw9IiNFRkYwRjEiPgogICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNTMuMjgzMzkzNSwxLjExODI1NjU2IEw1Ni4zMDg3MzE5LDQuMTQ0ODQ1NjYgQzU2LjQ2NjE1ODcsNC4zMDIzMzc2IDU2LjQ2NjEwNiw0LjU1NzYyOTcxIDU2LjMwODYxNCw0LjcxNTA1NjU2IEM1Ni4yMzMwMDQyLDQuNzkwNjM1MTkgNTYuMTMwNDczOSw0LjgzMzA5MjE5IDU2LjAyMzU2NzUsNC44MzMwOTIxOSBMNDkuOTczMTI2NSw0LjgzMzA5MjE5IEM0OS43NTA0NDUzLDQuODMzMDkyMTkgNDkuNTY5OTI2NSw0LjY1MjU3MzQgNDkuNTY5OTI2NSw0LjQyOTg5MjE5IEM0OS41Njk5MjY1LDQuMzIyOTg1NzggNDkuNjEyMzgzNSw0LjIyMDQ1NTU0IDQ5LjY4Nzk2MjEsNC4xNDQ4NDU2NiBMNTIuNzEzMzAwNSwxLjExODI1NjU2IEM1Mi44NzA2MDk1LDAuOTYwNjQ2ODMyIDUzLjEyNTkwMTYsMC45NjA1OTQwNzIgNTMuMjgzMzkzNSwxLjExODAyMDkyIEM1My4yODM0MzI4LDEuMTE4MDYwMTkgNTMuMjgzNDcyMSwxLjExODA5OTQ4IDUzLjI4MzM5MzUsMS4xMTgyNTY1NiBaIiBpZD0i5LiJ6KeS5b2i5aSH5Lu9LTQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUyLjk5ODM0NywgMi45MTY1NDYpIHNjYWxlKC0xLCAxKSByb3RhdGUoLTE4MC4wMDAwMDApIHRyYW5zbGF0ZSgtNTIuOTk4MzQ3LCAtMi45MTY1NDYpICI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0i55+p5b2iIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDQiIGhlaWdodD0iNiIgcng9IjAuOSI+PC9yZWN0PgogICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgICAgICA8ZyBpZD0i57yW57uELTMiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAuMDAwMDAwLCA1MC4wMDAwMDApIiBmaWxsPSIjRUZGMEYxIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTUzLjI4MzM5MzUsMS4xMTgyNTY1NiBMNTYuMzA4NzMxOSw0LjE0NDg0NTY2IEM1Ni40NjYxNTg3LDQuMzAyMzM3NiA1Ni40NjYxMDYsNC41NTc2Mjk3MSA1Ni4zMDg2MTQsNC43MTUwNTY1NiBDNTYuMjMzMDA0Miw0Ljc5MDYzNTE5IDU2LjEzMDQ3MzksNC44MzMwOTIxOSA1Ni4wMjM1Njc1LDQuODMzMDkyMTkgTDQ5Ljk3MzEyNjUsNC44MzMwOTIxOSBDNDkuNzUwNDQ1Myw0LjgzMzA5MjE5IDQ5LjU2OTkyNjUsNC42NTI1NzM0IDQ5LjU2OTkyNjUsNC40Mjk4OTIxOSBDNDkuNTY5OTI2NSw0LjMyMjk4NTc4IDQ5LjYxMjM4MzUsNC4yMjA0NTU1NCA0OS42ODc5NjIxLDQuMTQ0ODQ1NjYgTDUyLjcxMzMwMDUsMS4xMTgyNTY1NiBDNTIuODcwNjA5NSwwLjk2MDY0NjgzMiA1My4xMjU5MDE2LDAuOTYwNTk0MDcyIDUzLjI4MzM5MzUsMS4xMTgwMjA5MiBDNTMuMjgzNDMyOCwxLjExODA2MDE5IDUzLjI4MzQ3MjEsMS4xMTgwOTk0OCA1My4yODMzOTM1LDEuMTE4MjU2NTYgWiIgaWQ9IuS4ieinkuW9ouWkh+S7vS00IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg1Mi45OTgzNDcsIDIuOTE2NTQ2KSBzY2FsZSgtMSwgMSkgcm90YXRlKC0xODAuMDAwMDAwKSB0cmFuc2xhdGUoLTUyLjk5ODM0NywgLTIuOTE2NTQ2KSAiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgeD0iMCIgeT0iMCIgd2lkdGg9IjQ0IiBoZWlnaHQ9IjYiIHJ4PSIwLjkiPjwvcmVjdD4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iI0RFRTBFMyIgeD0iMCIgeT0iMCIgd2lkdGg9IjMyIiBoZWlnaHQ9IjgiIHJ4PSIwLjkiPjwvcmVjdD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxnIGlkPSLnvJbnu4QtMiI+CiAgICAgICAgICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgZmlsbD0iI0RFRTBFMyIgeD0iMC4yIiB5PSIwIiB3aWR0aD0iMzIiIGhlaWdodD0iOCIgcng9IjAuOSI+PC9yZWN0PgogICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIGZpbGw9IiNFRkYwRjEiIHg9IjAiIHk9IjE4IiB3aWR0aD0iNTUiIGhlaWdodD0iNiIgcng9IjAuOSI+PC9yZWN0PgogICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIGZpbGw9IiNFRkYwRjEiIHg9IjAiIHk9IjUwIiB3aWR0aD0iNjQiIGhlaWdodD0iNiIgcng9IjAuOSI+PC9yZWN0PgogICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIGZpbGw9IiNFRkYwRjEiIHg9IjAiIHk9IjM0IiB3aWR0aD0iNzYiIGhlaWdodD0iNiIgcng9IjAuOSI+PC9yZWN0PgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return r(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function r(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}var i=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=n(1);function s(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h,p,g=(f(v,s(n(32)).default),i(v,[{key:"onCopy",value:function(){var e=this.getBitableInfo().bitableId,t=this.getBitableBridge(),n="bitable copy text";if(!e||!t||!t.handleCopy)return{html:"bitable copy html",text:n};var r=t.handleCopy(e);return this.dataset.initData=r,{html:(0,l.generateBlockHTML)(Object.assign({},this.dataset,{token:""}),n),text:n,data:r}}},{key:"notify",value:(p=c(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("screenshot"!==t.eventType){e.next=13;break}if(n=this.getBitableBridge(),r=this.getBitableInfo(),i=r.bitableId,n&&n.takeScreenShot&&i){e.next=5;break}return e.abrupt("return");case 5:if(t.status===l.NotifyStatus.start)return o=t.detail,a=(void 0===o?{}:o).isBlob,s=void 0===a||a,e.next=10,n.takeScreenShot(i,s,!0);e.next=10;break;case 10:if(t.status===l.NotifyStatus.end)return e.next=13,n.takeScreenShot(i,!0,!1);e.next=13;break;case 13:case"end":return e.stop()}},e,this)})),y)},{key:"updateHighlight",value:function(e){var t=v.processToken(this.blockToken).bitableId,n=this.getBitableBridge();t&&n&&n.updateHighlight&&n.updateHighlight(t,e)}},{key:"getBlockScrollStatus",value:(h=c(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getBitableInfo(),n=t.bitableId,r=this.getBitableBridge(),n&&r&&r.getScrollStatus){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,r.getScrollStatus(n);case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}},e,this)})),m)},{key:"resize",value:function(){var e=this.getBitableInfo().bitableId;e&&this.ExternalServices.setWidth(window.innerWidth,0,e)}},{key:"getBitableInfo",value:function(){var e=v.processToken(this.blockToken),t=e.token,n=e.bitableId;return{token:t,bitableId:void 0===n?this.props.tableId:n}}}],[{key:"processToken",value:function(e){var t,n,r=void 0,i=void 0;return"string"==typeof e&&(t=e.split("_",2),r=(n=o(t,2))[0],i=n[1]),{token:r,bitableId:i}}}]),v);function v(){u(this,v);var r=d(this,(v.__proto__||Object.getPrototypeOf(v)).apply(this,arguments));return r.selectState=l.SelectionState.NONE,r.beforeMountBitable=function(){var e,t=r.getBitableInfo().bitableId,n=r.getBitableBridge();t&&n&&n.updateSelectionState&&((e=r.attributes.selectState)!==r.selectState&&void 0!==e&&(r.selectState=e,n.updateSelectionState(t,r.selectState)))},r}function m(){return h.apply(this,arguments)}function y(e){return p.apply(this,arguments)}t.default=g},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=n(1),o=s(n(62));n(113);var d=n(63),a=s(n(64));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=(u(p,h.Creator),r(p,[{key:"generateMindnoteData",value:function(e){var t,n,r=e.nodes,i=e.theme,o=e.structure,a=e.globalLineStyle,s={};return 1===r.length?(t=r[0],n="",n=Array.isArray(t.text)?t.text.map(function(e){return e.text}).join(""):t.text,s.title=n,s.content={nodes:t.children}):(s.title="",s.content={nodes:r}),i&&(s.content.theme=i),o&&(s.content.structure=o),a&&(s.content.globalLineStyle=a),s}},{key:"generatePasteHTML",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=(0,d.pasteMindnoteDataSet)(e,t);return(0,h.generateBlockHTML)(n)}},{key:"create",value:function(e,t,n){return new o.default(e,t,n,this.ExternalServices,this.mobileEditStats)}},{key:"onPaste",value:function(e){var c=this,t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).event,n=/class="mm-editor-clipboard"/;if(!t)return e;var r=t.originalEvent.clipboardData;if(!r)return e;var i=$(e.pasteDataWrapper),o=r.getData("text/html");if(n.test(o))try{var a=document.createElement("div");a.innerHTML=o;var s=a.querySelector("ul").dataset.json||"",l=JSON.parse(decodeURIComponent(s)),u={};switch(l.type){case"define":u=this.generateMindnoteData(l.data);break;case"nodes":u={content:{nodes:l.data}}}var d=this.generatePasteHTML(u);i.html(d);var f=this.ExternalServices.LogService;f&&f.collectEvent&&f.collectEvent("client_insert_mindmap",{create_source:"paste",paste_type:"nodes"})}catch(e){console.error(e)}else i.find(".block-type-"+this.blockType).each(function(e,t){var n,r,i,o,a,s,l=Array.from(t.classList).find(function(e){return e.startsWith("block-id-")});l&&l.split("block-id-")[1]&&(n=$(t).find("."+h.BLOCK_CONTAINER),i=(r=(0,h.getBlockDataSet)(n[0]))&&r.props,(o=r&&r.initData)&&(a=c.generatePasteHTML(c.generateMindnoteData(o),i),$(t).html(a),(s=c.ExternalServices.LogService)&&s.collectEvent&&s.collectEvent("client_insert_mindmap",{create_source:"paste",paste_type:"block"})))});return{pasteDataWrapper:i[0],text:e.text,purifiedHtml:e.purifiedHtml}}},{key:"onInternalPaste",value:function(e){var t=(0,e.getHTML)(),n=document.createElement("div");n.innerHTML=t;var r=$(n).find(".block-type-"+this.blockType)[0];if(r){var i=Array.from(r.classList).find(function(e){return e.startsWith("block-id-")});if(i&&i.split("block-id-")[1]){var o=$(r).find("."+h.BLOCK_CONTAINER),a=(0,h.getBlockDataSet)(o[0]),s=a&&a.props,l=a&&a.initData;if(l){var c=(0,d.pasteMindnoteDataSet)(this.generateMindnoteData(l),s),u=this.ExternalServices.LogService;return u&&u.collectEvent&&u.collectEvent("client_insert_mindmap",{create_source:"paste",paste_type:"block"}),c}}}}},{key:"destroy",value:function(){this.mobileEditStats.reset(),this.mobileEditStats=null}}]),p);function p(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;l(this,p);var o=c(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=h.BlockType.MINDNOTE_BLOCK,o.defaultProps={},o.mobileEditStats=null,o.ExternalServices=t,o.moduleConfigs=i,o.mobileEditStats=new a.default(o.ExternalServices.EventEmitter),o}(t.default=f).pasteViewIndex=""},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(6),a=n(1),s=n(108),l=n(109),c=n(33),u=n(40),d=n(30);function f(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v,m=(g(y,a.Block),r(y,[{key:"handleSelectStatusChange",value:function(e){e||this.resetMinderCanvas()}},{key:"bindEvents",value:(v=f(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.minder){e.next=2;break}return e.abrupt("return");case 2:this.minderLayoutSubscription=this.minder.getService("ContextEvent").layout$.pipe((0,l.map)(function(e){return Object.assign({},e.bounds)}),(0,s.distinctUntilChanged)(function(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height})).subscribe(function(){o.browser.isMobile&&t.resetMobileMinderCanvas()});case 3:case"end":return e.stop()}},e,this)})),b)},{key:"resetMinderCanvas",value:function(){var n=this;requestAnimationFrame(function(){var e,t;n.minder&&((e=n.minder.getService("PinchPan")).notifyViewPortUpdate(),t=o.browser.isMobile?c.mobileMindNotePadding:c.pcMindNotePadding,e.fitMap({top:t,bottom:t,left:t,right:t},c.BASE_SCALE))})}},{key:"unBindEvents",value:function(){this.minderLayoutSubscription&&this.minderLayoutSubscription.unsubscribe()}},{key:"resetMobileMinderCanvas",value:function(){var e,t,n,r,i=this;this.minder&&(e=this.getBlockSize().width,t=c.mobileMindNotePadding,n=this.minder.getCentralBranchView().bounds,r=Math.min(e-2*t,n.width*c.BASE_SCALE)*(n.height/n.width)+2*t,this.mountPoint.style.height=r+"px",requestAnimationFrame(function(){var e;i.minder&&((e=i.minder.getService("PinchPan")).notifyViewPortUpdate(),e.fitMap({top:t,bottom:t,left:t,right:t},c.BASE_SCALE))}))}},{key:"getBlockSize",value:function(){return this.mountPoint.getBoundingClientRect()||c.defaultSize}},{key:"afterMouseMoveAndResize",value:function(){this.minder&&(this.minder.config.setConfig("scrollBar",!1),this.handleMinderSizeChange())}},{key:"handleResizeEnd",value:function(){this.minder&&(this.minder.getService("PinchPan").notifyViewPortUpdate(),this.minder.config.setConfig("scrollBar",!0))}}]),y);function y(){h(this,y);var n=p(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments));return n.resizeTriggerType=u.ResizeTriggerType.Manual,n.minder=null,n.minderLayoutSubscription=null,n.handleMinderSet=function(e){n.minder=e,n.bindEvents(),n.resetMinderCanvas()},n.setSliderVisibleByBlock=function(e){var t=(0,d.getHasResizeModule)(n);t&&t.setSliderVisibleByBlock(n,e)},n.handleMinderSizeChange=function(){requestAnimationFrame(function(){n.minder&&n.minder.getService("PinchPan").notifyViewPortUpdate()})},n}function b(){return v.apply(this,arguments)}t.default=m},function(e,t){e.exports=o("ad02")},function(e,t){e.exports=o("67Y/")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.75 12.5h.75v1.76c0 2.34 1.9 4.24 4.24 4.24a.75.75 0 0 0 0-1.5A2.74 2.74 0 0 1 7 14.26V12.5h2.75a.75.75 0 0 0 0-1.5H7V9.24A2.74 2.74 0 0 1 9.74 6.5a.75.75 0 1 0 0-1.5A4.24 4.24 0 0 0 5.5 9.24V11h-.75a.75.75 0 0 0 0 1.5zM12.5 5a.5.5 0 0 0-.5.5V6c0 .28.22.5.5.5h6A.5.5 0 0 0 19 6v-.5a.5.5 0 0 0-.5-.5h-6zm-.5 6.5c0-.28.22-.5.5-.5h6c.28 0 .5.22.5.5v.5a.5.5 0 0 1-.5.5h-6a.5.5 0 0 1-.5-.5v-.5zm.5 5.5a.5.5 0 0 0-.5.5v.5c0 .28.22.5.5.5h6a.5.5 0 0 0 .5-.5v-.5a.5.5 0 0 0-.5-.5h-6z",fill:"#14C0FF"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"244",height:"76",viewBox:"0 0 244 76",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 24c0-1.1.9-2 2-2h62a2 2 0 0 1 2 2v28a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V24z",fill:"#EFF0F1"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M127 13H96a9 9 0 0 0-9 9v37a9 9 0 0 0 9 9h31V13zm-31-1a10 10 0 0 0-10 10v37a10 10 0 0 0 10 10h32V12H96z",fill:"#BBBFC4"}),i.default.createElement("path",{fill:"#BBBFC4",d:"M66 39.71h20v.79H66zM86 39.71h20v.79H86z"}),i.default.createElement("path",{fill:"#fff",d:"M106 0h49v76h-49z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M106 2c0-1.1.9-2 2-2h45a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-45a2 2 0 0 1-2-2V2zM106 31c0-1.1.9-2 2-2h45a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-45a2 2 0 0 1-2-2V31zM106 60c0-1.1.9-2 2-2h45a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-45a2 2 0 0 1-2-2V60z",fill:"#EFF0F1"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M224 27h-39a9 9 0 0 0-9 9v4a9 9 0 0 0 9 9h39V27zm-39-1a10 10 0 0 0-10 10v4a10 10 0 0 0 10 10h40V26h-40z",fill:"#BBBFC4"}),i.default.createElement("path",{fill:"#BBBFC4",d:"M155 38h20v1h-20z"}),i.default.createElement("path",{fill:"#fff",d:"M195 20h49v36h-49z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M195 22c0-1.1.9-2 2-2h45a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-45a2 2 0 0 1-2-2v-9zM195 45c0-1.1.9-2 2-2h45a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-45a2 2 0 0 1-2-2v-9z",fill:"#EFF0F1"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"730",height:"160",viewBox:"0 0 730 160",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M4 .5h722a3.5 3.5 0 0 1 3.5 3.5v152a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 156V4A3.5 3.5 0 0 1 4 .5z",fill:"#fff",stroke:"#DEE0E3"}),i.default.createElement("g",{clipPath:"url(#a)",fillRule:"evenodd",clipRule:"evenodd"},i.default.createElement("path",{d:"M16 17c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V17z",fill:"#14C0FF"}),i.default.createElement("path",{d:"M25.38 18.75c-.21 0-.38.17-.38.38v.37c0 .2.17.38.38.38h4.5c.2 0 .37-.17.37-.38v-.38c0-.2-.17-.37-.37-.37h-4.5zm-5.82 5.63h.57v1.31a3.18 3.18 0 0 0 3.18 3.18.56.56 0 0 0 0-1.12 2.06 2.06 0 0 1-2.06-2.06v-1.32h2.06a.56.56 0 1 0 0-1.12h-2.06v-1.32c0-1.13.92-2.05 2.06-2.05a.56.56 0 0 0 0-1.13 3.18 3.18 0 0 0-3.18 3.18v1.32h-.57a.56.56 0 0 0 0 1.13zm5.44-.75c0-.21.17-.38.38-.38h4.5c.2 0 .37.17.37.38V24c0 .2-.17.38-.37.38h-4.5A.38.38 0 0 1 25 24v-.38zm.38 4.12c-.21 0-.38.17-.38.38v.37c0 .2.17.38.38.38h4.5c.2 0 .37-.17.37-.38v-.38c0-.2-.17-.37-.37-.37h-4.5z",fill:"#fff"})),i.default.createElement("path",{d:"M42.45 17.97v6.73h9.04v-6.73h-9.04zm7.73 5.46h-2.6v-1.5h2.6v1.5zm-3.85 0h-2.56v-1.5h2.56v1.5zm-2.56-2.68v-1.54h2.56v1.54h-2.56zm3.82-1.54h2.59v1.54h-2.6v-1.54zm-5.56 6.53a12.1 12.1 0 0 1-1.53 3.58l1.15.72c.7-1.14 1.25-2.48 1.64-4.04l-1.26-.26zm5.36-.73l-1.2.4c.47.73.92 1.59 1.33 2.55l1.22-.54c-.38-.86-.83-1.65-1.35-2.41zm4.12.38l-1.28.4a22.2 22.2 0 0 1 1.96 3.74l1.22-.54a22.57 22.57 0 0 0-1.9-3.6zm-2.4 4.87c.54 0 .94-.11 1.2-.34.27-.25.47-1 .58-2.26l-1.27-.44c-.06.87-.14 1.37-.27 1.54-.1.16-.25.24-.47.24h-3.01c-.45 0-.66-.21-.66-.6v-2.73h-1.32v3.02c0 1.04.52 1.57 1.56 1.57h3.66zm10.4-2.81c-1.38.5-3 .9-4.87 1.2l.17 1.33c1.77-.32 3.33-.74 4.7-1.26v-1.27zm-2.72-10c-.47 1.54-1 2.94-1.6 4.2-.17.24-.35.4-.56.49l.34 1.22 1.97-.31a14.2 14.2 0 0 1-1.48 2.42 2 2 0 0 1-.6.38l.34 1.2c1.26-.2 2.6-.6 4-1.17v-1.22c-.83.36-1.64.66-2.44.88a36.82 36.82 0 0 0 2.67-4.9l-1.16-.43-.74 1.62c-.45.09-.9.14-1.35.2.65-1.05 1.26-2.41 1.88-4.08l-1.27-.5zm4.88 6.43h2.19v1.56h-2.19v-1.56zm0 2.78h2.19v1.8h-2.19v-1.8zm0 3.03h5.83v-1.24h-2.37v-1.79h1.85v-1.22h-1.85v-1.56h1.85v-1.22h-1.85v-1.6h2.09V19.8H65.2c-.17-.7-.42-1.47-.73-2.32l-1.29.35c.28.63.54 1.29.76 1.97h-2.17c.25-.64.46-1.3.63-1.99l-1.26-.25a15.95 15.95 0 0 1-2.23 5.24l.41 1.34c.4-.5.74-1.02 1.08-1.55v7.82h1.27v-.72zm2.19-8.63v1.6h-2.19v-1.6h2.19zm4.73 4.1v1.3h8.44v2.37c0 .28-.2.44-.56.44-.5 0-1.05-.03-1.61-.09l.3 1.3h1.77c.95 0 1.44-.44 1.44-1.33v-2.7h3.03v-1.29h-3.03v-.71h-1.34v.71h-8.44zm10.75-7.18H70v4.79c0 .85.48 1.29 1.43 1.29h8.26c.63-.03 1.04-.25 1.22-.7.1-.28.2-.73.28-1.37l-1.26-.41c-.06.56-.13.9-.2 1-.08.15-.24.23-.46.25h-7.32c-.4 0-.6-.2-.6-.58v-.71h7.99v-3.56zm-8 2.35V19.2h6.67v1.14h-6.66zm.75 6.29l-.95.92c.96.79 1.72 1.53 2.25 2.22l1-1c-.62-.71-1.4-1.43-2.3-2.14zM87.5 19.4a5.57 5.57 0 0 1-2.49 2.54l.73.97c.47-.3.9-.63 1.29-.97.33.34.72.66 1.17.97-.92.4-2.07.69-3.41.91l.57 1.06c1.54-.35 2.84-.78 3.9-1.31.96.5 2.08.92 3.38 1.27l.69-1c-1.11-.24-2.09-.55-2.96-.94A5.22 5.22 0 0 0 92 21.08v-.9h-3.6c.1-.2.2-.4.28-.63l-1.18-.15zm1.8 2.96a8.06 8.06 0 0 1-1.59-1.14c0-.03.03-.05.06-.07h2.9c-.34.44-.8.85-1.38 1.21zm-2.72 3.77l-.5 1c1.86.36 3.65.85 5.38 1.48l.44-1.07a33 33 0 0 0-5.32-1.41zM88 24.24l-.6.87c1.04.3 2.07.73 3.06 1.27l.62-.95c-.93-.46-1.96-.85-3.08-1.19zm6.84-6.2h-11.7v12.4h1.3v-.49h9.1v.5h1.3V18.03zm-10.4 10.74V19.2h9.1v9.57h-9.1z",fill:"#fff"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 78c0-1.1.9-2 2-2h145a2 2 0 0 1 2 2v36a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V78z",fill:"#EFF0F1"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M236 61h-31a9 9 0 0 0-9 9v52a9 9 0 0 0 9 9h31V61zm-31-1a10 10 0 0 0-10 10v52a10 10 0 0 0 10 10h32V60h-32z",fill:"#BBBFC4"}),i.default.createElement("path",{fill:"#BBBFC4",d:"M165 95h30v1h-30zM195 95h30v1h-30z"}),i.default.createElement("path",{fill:"#fff",d:"M225 48h123v96H225z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M225 50c0-1.1.9-2 2-2h119a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H227a2 2 0 0 1-2-2V50zM225 86c0-1.1.9-2 2-2h119a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H227a2 2 0 0 1-2-2V86zM225 122c0-1.1.9-2 2-2h119a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H227a2 2 0 0 1-2-2v-20z",fill:"#EFF0F1"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M427 82h-39a9 9 0 0 0-9 9v10a9 9 0 0 0 9 9h39V82zm-39-1a10 10 0 0 0-10 10v10a10 10 0 0 0 10 10h40V81h-40z",fill:"#BBBFC4"}),i.default.createElement("path",{fill:"#BBBFC4",d:"M348 95h30v1h-30z"}),i.default.createElement("path",{fill:"#fff",d:"M408 72h123v48H408z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M408 74c0-1.1.9-2 2-2h119a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H410a2 2 0 0 1-2-2V74zM408 104c0-1.1.9-2 2-2h119a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H410a2 2 0 0 1-2-2v-14z",fill:"#EFF0F1"}),i.default.createElement("path",{fill:"#BBBFC4",d:"M531 80.5h60v1h-60z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M591 74c0-1.1.9-2 2-2h119a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H593a2 2 0 0 1-2-2V74z",fill:"#EFF0F1"}),i.default.createElement("defs",null,i.default.createElement("clipPath",{id:"a"},i.default.createElement("path",{fill:"#fff",transform:"translate(16 15)",d:"M0 0h18v18H0z"}))))}},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getNormalDateStr=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(42);Object.defineProperty(t,"getNormalDateStr",{enumerable:!0,get:function(){return o.getNormalDateStr}});var c=n(1),a=s(n(121)),u=n(44);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h=(f(p,c.Creator),r(p,[{key:"create",value:function(e,t){return new a.default(e,t,this.ExternalServices)}},{key:"onPaste",value:function(e){if(this.ExternalServices.Helpers.browser.isOpenDoc){for(var t=e.pasteDataWrapper,n=e.text,r=$(t),i=r.find(".block-type-"+this.blockType),o=0;o<i.length;o++){var a=i[o],s=$(a).find("["+c.DATA_META_BLOCK_PROPS+"]"),l=s.attr(""+u.TIME_STR_PROP);l&&s.replaceWith("<span>"+l+"</span>")}return{pasteDataWrapper:r[0],text:n,purifiedHtml:e.purifiedHtml}}return e}}]),p);function p(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder;l(this,p);var i=d(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return i.ExternalServices={},i.blockType=c.BlockType.REMINDER_BLOCK,i.defaultProps={displayMode:c.BlockDisplayMode.INLINE},i.ExternalServices=t,i}t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(116));function i(e){return e&&e.__esModule?e:{default:e}}t.default=r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FnMap=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=a(n(117));function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l,c=t.FnMap=void 0;(l=c||(t.FnMap=c={})).today="getToday",l.yesterday="getYesterday",l.tomorrow="getTomorrow",l.monthDay="getMonthDay",l.yearMonthDay="getYearMonthDay",l.currentWeek="getCurrentWeek",l.nextWeek="getNextWeek";var u=(r(d,[{key:"getTimeString",value:function(e,t){var n,r,i="",o=new Date(e),a=new Date,s=this.parseDate(o),l=this.parseDate(a),i=this.getNormalDateStr(s,l);return t&&(n=this.parseTimeIfNeeded(s.hour),r=this.parseTimeIfNeeded(s.minute),i+=this.i18nDate.getFormateTime(n,r)),i}},{key:"parseDate",value:function(e){var t=0===(t=e.getDay())?7:t;return{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),day:t,time:e.getTime()}}},{key:"parseTimeIfNeeded",value:function(e){return 1===String(e).length?"0"+e:e}},{key:"getNormalDateStr",value:function(e,t){var n=e.year,r=e.month,i=e.date,o=this.getRealWeek(e,t),a=o.dateWeeks,s=o.nowWeeks;return e.year!==t.year?this.i18nDate.getFormatedDate(c.yearMonthDay,n,r,i):2<=a-s||a-s<=-1?t.date-e.date==1&&a-s==-1&&r===t.month?this.i18nDate.getFormatedDate(c.yesterday):this.i18nDate.getFormatedDate(c.monthDay,r,i):e.date===t.date?this.i18nDate.getFormatedDate(c.today):t.date-e.date==1?this.i18nDate.getFormatedDate(c.yesterday):e.date-t.date==1?this.i18nDate.getFormatedDate(c.tomorrow):1<=a-s?this.i18nDate.getFormatedDate(c.nextWeek,e.day):this.i18nDate.getFormatedDate(c.currentWeek,e.day)}},{key:"getRealWeek",value:function(e,t){var n=new Date(new Date(e.time).setHours(0,0,0,0)).getTime(),r=new Date(new Date(t.time).setHours(0,0,0,0)).getTime(),i=864e5;return{dateWeeks:Math.ceil((n/i+4)/7),nowWeeks:Math.ceil((r/i+4)/7)}}}],[{key:"setLanguage",value:function(e){o.default.setLanguage(e)}}]),d);function d(){s(this,d),this.i18nDate=new o.default}t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LanguageMap=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=c(n(118)),a=c(n(119)),s=c(n(120)),l=n(3);function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var d,f=t.LanguageMap=void 0;(d=f||(t.LanguageMap=f={}))["zh-CN"]="cn",d["zh-cn"]="cn",d.cn="cn",d.en="en",d["en-US"]="en",d["en-us"]="en",d.ja="ja",d["ja-JP"]="ja",d["ja-jp"]="ja";var h=(r(p,[{key:"getLocale",value:function(){var e=void 0;if(window.User&&window.User.language?e=window.User.language:(0,l.getSearch)("lang")?e=(0,l.getSearch)("lang"):(0,l.getCookie)("lang")?e=(0,l.getCookie)("lang"):window.navigator.language&&(e=window.navigator.language),e){if(-1!==e.indexOf("zh"))return"zh-CN";if(-1!==e.indexOf("ja"))return"ja-JP"}return"en"}},{key:"getFormatedDate",value:function(e){for(var t=f[this.getLocale()],n=this.locale[t][e],r=arguments.length,i=Array(1<r?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return n&&n.apply(void 0,i)}},{key:"getFormateTime",value:function(e,t){if("en"!==f[this.getLocale()])return" "+e+":"+t;var n=Number(e);return" "+(n%12||12)+":"+t+" "+(11<n?"PM":"AM")}}],[{key:"setLanguage",value:function(e){return e in f&&(p.language=e),p.language}}]),p);function p(){u(this,p),this.locale={cn:o.default,en:a.default,ja:s.default},p.language=f[this.getLocale()]}h.language=f.en,t.default=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=(a(l,r(n(43)).default),l);function l(){i(this,l);var t=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,{yesterday:"",today:"",tomorrow:""}));return t.getMonthDay=function(e,t){return e+""+t+""},t.getYearMonthDay=function(e,t,n){return e+""+t+""+n+""},t.getCurrentWeek=function(e){return""+t.weekMap[e]},t.getNextWeek=function(e){return""+t.weekMap[e]},t.weekMap={1:"",2:"",3:"",4:"",5:"",6:"",7:""},t}t.default=new s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=(a(l,r(n(43)).default),l);function l(){i(this,l);var r=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,{yesterday:"Yesterday",today:"Today",tomorrow:"Tomorrow"}));return r.getMonthDay=function(e,t){return r.monthMap[e]+" "+t},r.getYearMonthDay=function(e,t,n){return r.monthMap[t]+" "+n+", "+e},r.getCurrentWeek=function(e){return r.weekMap[e]},r.getNextWeek=function(e){return"Next "+r.weekMap[e]},r.weekMap={1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday",7:"Sunday"},r.monthMap={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},r}t.default=new s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=(a(l,r(n(43)).default),l);function l(){i(this,l);var t=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,{yesterday:"",today:"",tomorrow:""}));return t.getMonthDay=function(e,t){return e+""+t+""},t.getYearMonthDay=function(e,t,n){return e+""+t+""+n+""},t.getCurrentWeek=function(e){return t.weekMap[e]+""},t.getNextWeek=function(e){return""+t.weekMap[e]+""},t.weekMap={1:"",2:"",3:"",4:"",5:"",6:"",7:""},t}t.default=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=g(n(0)),s=g(n(5)),c=g(n(122)),u=n(1),d=n(42),f=g(n(4)),h=g(n(18)),p=n(44);function g(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b,E,k,C=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},I=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=(y(T,u.Block),r(T,[{key:"handleClick",value:function(e){var t=this.props.data;(0,d.onClick)(e,this.blockId,t,this.ExternalServices)}},{key:"handleMouseEnter",value:function(e){var t=this.props.data;(0,d.onMouseEnter)(e,this.blockId,t,this.ExternalServices)}},{key:"handleMouseLeave",value:function(e){var t=this.props.data;(0,d.onMouseLeave)(e,this.blockId,t,this.ExternalServices)}},{key:"placeholderHtml",value:function(){var e=this.props.data,t=e.expireTime,n=e.shouldNotify,r=e.isWholeDay;return"<span class='"+(0,f.default)("reminder-inline-block",(0,d.showColor)(t,this.ExternalServices),{"should-notify":Boolean(n)})+"'>"+(0,d.getNormalDateStr)(t,!r)+"</span>"}},{key:"placeholderJsx",value:function(){var e=this.props.data,t=e.expireTime,n=e.shouldNotify,r=e.isWholeDay,i=(0,f.default)("reminder-inline-block",(0,d.showColor)(t,this.ExternalServices),{"should-notify":Boolean(n)}),o=(0,d.getNormalDateStr)(t,!r);return a.default.createElement("span",{className:i},o)}},{key:"render",value:function(){var t=this,e=this.props.data;if(e){var n=e.shouldNotify,r=e.notifyTime,i=e.expireTime,o=e.isWholeDay;return new Promise(function(e){s.default.render(a.default.createElement(c.default,{blockId:t.blockId,isWholeDay:o,expireTime:i,shouldNotify:n,notifyTime:r,onClick:t.handleClick,onMouseEnter:t.handleMouseEnter,onMouseLeave:t.handleMouseLeave,ExternalServices:t.ExternalServices,emitter:t.emitter}),t.mountPoint,e)})}}},{key:"delete",value:function(){this.destroy()}},{key:"destroy",value:function(){}},{key:"unmount",value:function(e){o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"unmount",this).call(this,e),(0,d.deleteReminder)(this.blockId,this.ExternalServices),s.default.unmountComponentAtNode(this.mountPoint)}},{key:"resize",value:function(){}},{key:"commentQuota",value:function(){if(this.props.data){var e=this.props.data,t=e.expireTime,n=e.isWholeDay;return(0,d.getNormalDateStr)(t,!n)}return""}},{key:"collectText",value:function(){if(this.props.data){var e=this.props.data,t=e.expireTime,n=e.isWholeDay;return(0,d.getNormalDateStr)(t,!n)}return""}},{key:"onSearch",value:function(e){var t=this,n=e.searchKey.toLowerCase(),r=this.collectText().toLowerCase();return(0,u.searchString)(r,n).map(function(e){return Object.assign({},e,{isReplaceable:!1,blockId:t.blockId})})}},{key:"onHighlight",value:function(e,t){var n=e.key,r=e.matches;this.emitter.emit("highlightResult",{searchResult:r,selectedKey:n,isSelected:t})}},{key:"onCancelSearch",value:function(){this.emitter.emit("clearSearchResult",[])}},{key:"onReplace",value:function(){}},{key:"onCopy",value:function(e){var t,n,r,i=e.blockType,o=e.props,a=(0,u.generateBlockDataSet)({blockType:i,props:o}),s="";o.data&&(n=(t=o.data).expireTime,r=t.isWholeDay,s=(0,d.getNormalDateStr)(n,!r));var l=(0,u.generateBlockHTML)(a,s),c=$("<div></div>");return c.html(l),c.find("["+u.DATA_META_BLOCK_PROPS+"]").attr(""+p.TIME_STR_PROP,s),{html:c.html(),text:s}}}]),T);function T(e,t,n){v(this,T);var r=m(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,e,t));return r.emitter=new h.default,r.shouldKeepAlive=!1,r.isReplaceable=!1,r.renderLocally=!0,r.ExternalServices=n,r}C([(0,u.Bind)(),I("design:type",Function),I("design:paramtypes",["function"==typeof(b="undefined"!=typeof HTMLElement&&HTMLElement)?b:Object]),I("design:returntype",void 0)],S.prototype,"handleClick",null),C([(0,u.Bind)(),I("design:type",Function),I("design:paramtypes",["function"==typeof(E="undefined"!=typeof HTMLElement&&HTMLElement)?E:Object]),I("design:returntype",void 0)],S.prototype,"handleMouseEnter",null),C([(0,u.Bind)(),I("design:type",Function),I("design:paramtypes",["function"==typeof(k="undefined"!=typeof HTMLElement&&HTMLElement)?k:Object]),I("design:returntype",void 0)],S.prototype,"handleMouseLeave",null),t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=p(n(23)),i=p(n(29)),o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=p(n(0)),c=p(n(4));n(123);var u=n(42),d=n(1),f=p(n(15)),h=n(2);function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},b=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},E=(m(k,s.default.Component),o(k,[{key:"componentDidMount",value:function(){this.props.emitter.on("highlightResult",this.updateSearchResult),this.props.emitter.on("clearSearchResult",this.clearSearchResult),this.updateTime(),document.addEventListener("visibilitychange",this.handleVisibilityChange)}},{key:"componentDidUpdate",value:function(e){(0,r.default)(e,this.props)||this.updateTime()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null}},{key:"handleVisibilityChange",value:function(){"visible"===document.visibilityState?this.pageShow():this.pageHide()}},{key:"pageShow",value:function(){this.updateTime()}},{key:"pageHide",value:function(){clearTimeout(this.updateTimeoutId)}},{key:"updateTime",value:function(){var e=this;this.updateTimeoutId&&clearTimeout(this.updateTimeoutId),this.setState({timeStr:this.getTimeStr()});var t=Date.now(),n=t+864e5,r=Number(this.props.expireTime)-t,i=new Date(n).setHours(0,0,0,0)-t,o=r<i&&0<r?r:i;this.updateTimeoutId=setTimeout(function(){e.updateTime()},o)}},{key:"getTimeStr",value:function(){var e=this.props,t=e.expireTime,n=e.isWholeDay;return(0,u.getNormalDateStr)(t,!n)}},{key:"setRef",value:function(e){this.dom=e}},{key:"handleClick",value:function(){this.dom&&this.props.onClick(this.dom)}},{key:"handleMouseLeave",value:function(){this.dom&&this.props.onMouseLeave(this.dom)}},{key:"handleMouseMove",value:function(){this.dom&&this.props.onMouseEnter(this.dom)}},{key:"render",value:function(){var e=this.props,t=e.expireTime,n=e.shouldNotify,r=e.blockId,i=e.ExternalServices,o=(0,c.default)("reminder-inline-block",(0,u.showColor)(t,i),{"should-notify":Boolean(n)});return s.default.createElement("span",{ref:this.setRef,className:o,id:"reminder-block-"+r,onClick:this.handleClick,onMouseEnter:this.handleMouseMove,onMouseMove:this.throttleMouseMove,onMouseLeave:this.handleMouseLeave},s.default.createElement(f.default,{bgColor:h.MATCHED_BACKGROUND_COLOR,activeBgColor:h.SELECTED_BACKGROUND_COLOR,activeKey:this.state.selectedKey,isSelected:this.state.isSelected,context:this.state.searchResult},this.state.timeStr))}}]),k);function k(e){g(this,k);var t=v(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,e));return t.dom=null,t.clearSearchResult=function(e){t.setState(function(){return{searchResult:e}})},t.updateSearchResult=function(e){t.setState(function(){return{searchResult:e.searchResult}}),void 0!==e.isSelected&&t.setState(function(){return{selectedKey:e.selectedKey,isSelected:e.isSelected}})},t.state={timeStr:t.getTimeStr(),searchResult:[],selectedKey:"",isSelected:!1},t.throttleMouseMove=(0,i.default)(t.handleMouseMove,500,{trailing:!1}),t}t.default=E,y([(0,d.Bind)(),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],E.prototype,"handleVisibilityChange",null),y([(0,d.Bind)(),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],E.prototype,"updateTime",null),y([(0,d.Bind)(),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",void 0)],E.prototype,"setRef",null),y([(0,d.Bind)(),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],E.prototype,"handleClick",null),y([(0,d.Bind)(),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],E.prototype,"handleMouseLeave",null),y([(0,d.Bind)(),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],E.prototype,"handleMouseMove",null)},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return Object.prototype.hasOwnProperty.call(e,"props")},i=function(e,t){return e+o(t)},o=function e(t){return null===t||"boolean"==typeof t||void 0===t?"":"number"==typeof t?t.toString():"string"==typeof t?t:Array.isArray(t)?t.reduce(i,""):r(t)&&Object.prototype.hasOwnProperty.call(t.props,"children")?e(t.props.children):""};o.default=o,t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.getUserShowNameForLang=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(45);Object.defineProperty(t,"getUserShowNameForLang",{enumerable:!0,get:function(){return o.getUserShowNameForLang}});var a=n(1),s=l(n(126));function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var f=(d(h,a.Creator),r(h,[{key:"create",value:function(e,t,n){return new s.default(e,t,this.ExternalServices,n)}}]),h);function h(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;c(this,h);var o=u(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=a.BlockType.AT_USER_BLOCK,o.defaultProps={displayMode:a.BlockDisplayMode.INLINE},o.defaultDisplayMode=a.BlockDisplayMode.INLINE,o.ExternalServices=t,o.moduleConfigs=i,o}t.default=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},s=p(n(0)),l=p(n(5)),c=p(n(66)),u=n(1),d=n(45),f=n(12),a=p(n(18)),h=p(n(7));function p(e){return e&&e.__esModule?e:{default:e}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y=(m(b,u.Block),r(b,[{key:"placeholderHtml",value:function(){var e=(0,d.getCurrentUserId)(),t=this.props.data.user,n=t?(0,d.getUserShowNameForLang)(t,this.ExternalServices.getLanguage):"",r=t?t.id:0;return'<span class="'+["at-user-text","mention-type_0","mention-token_"+r,e===r?"at-self-highlight":""].join(" ")+'" contentEditable="false" href="javascript:void(0)"><span><strong>@</strong>'+n+"</span></span>"}},{key:"placeholderJsx",value:function(){var e=(0,d.getCurrentUserId)(),t=this.props.data.user,n=t?(0,d.getUserShowNameForLang)(t,this.ExternalServices.getLanguage):"",r=t?t.id:0,i=["at-user-text","mention-type_0","mention-token_"+r,e===r?"at-self-highlight":""].join(" ");return s.default.createElement("span",{className:i,contentEditable:!1},s.default.createElement("span",null,s.default.createElement("strong",null,"@"),n))}},{key:"render",value:function(){var r=this;if(this.props.data){var e=this.props.data,t=e.user,n=e.mentionId,i=e.source,o=void 0===i?"":i,a={getLanguage:this.ExternalServices.getLanguage,user:t,source:o,block:this,mentionId:n,emitter:this.emitter,fromSSR:this.ExternalServices.fromSSR,isMentionNewUi:this.ExternalServices.isMentionNewUi};return new Promise(function(e){var t=r.ExternalServices.RenderComponent||c.default,n=r.ExternalServices.Redux?s.default.createElement(f.Provider,{store:r.ExternalServices.Redux.store},s.default.createElement(t,Object.assign({},a))):s.default.createElement(t,Object.assign({},a));l.default.render(n,r.mountPoint,e)})}return Promise.resolve()}},{key:"getNotifyWidth",value:function(){return this.mountPoint.offsetWidth}},{key:"onSearch",value:function(e){var t=this,n=e.searchKey.toLowerCase(),r=this.collectText().toLowerCase();return(0,u.searchString)(r,n).map(function(e){return Object.assign({},e,{isReplaceable:t.isReplaceable,blockId:t.blockId})})}},{key:"onHighlight",value:function(e,t){var n=e.key,r=e.matches;this.emitter.emit("highlightResult",{searchResult:r,selectedKey:n,isSelected:t})}},{key:"onCancelSearch",value:function(){this.emitter.emit("clearSearchResult",[])}},{key:"onReplace",value:function(){}},{key:"unmount",value:function(e){o(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"unmount",this).call(this,e),l.default.unmountComponentAtNode(this.mountPoint),this.heightUpdateNotifier.destroy()}},{key:"resize",value:function(){}},{key:"commentQuota",value:function(){if(this.props.data){var e=this.props.data.user;return"@"+(0,d.getUserShowNameForLang)(e,this.ExternalServices.getLanguage)}return""}},{key:"collectText",value:function(){if(this.props.data){var e=this.props.data.user;return(this.ExternalServices.isMentionNewUi?"":"@")+(0,d.getUserShowNameForLang)(e,this.ExternalServices.getLanguage)}return""}},{key:"onCopy",value:function(e){var t,n=e.blockType,r=e.props,i=(0,u.generateBlockDataSet)({blockType:n,props:r}),o="",a="";return i.props&&i.props.data&&delete i.props.data.mentionId,this.props.data&&(t=this.props.data.user,o="@"+(0,d.getUserShowNameForLang)(t,this.ExternalServices.getLanguage),a=(0,u.generateBlockHTML)(i,o)),{html:a,text:o}}}]),b);function b(e,t,n,r){g(this,b);var i=v(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,e,t));return i.emitter=new a.default,i.isReplaceable=!1,i.shouldKeepAlive=!1,i.renderLocally=!0,i.heightUpdateNotifier=new h.default({getContext:function(){return i.context},getBlockId:function(){return i.blockId}}),i.editor=r,i.ExternalServices=n,i}t.default=y},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(1),o=s(n(130));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=(u(f,a.Creator),r(f,[{key:"create",value:function(e,t,n){return new o.default(e,t,n,this.ExternalServices)}},{key:"onPaste",value:function(e){return this.ExternalServices&&this.ExternalServices.utils&&this.ExternalServices.utils.collectEvent&&this.ExternalServices.utils.collectEvent("doc_paste_filecard"),e}},{key:"onInternalPaste",value:function(e){var t=e.dataset;this.ExternalServices&&this.ExternalServices.utils&&this.ExternalServices.utils.collectEvent&&this.ExternalServices.utils.collectEvent("doc_paste_filecard");var n=t.blockType,r=t.props;return r.fromCopy=!0,(0,a.generateBlockDataSet)({blockType:n,props:r})}}]),f);function f(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;l(this,f);var o=c(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=a.BlockType.FILE_CARD_BLOCK,o.defaultProps={displayMode:a.BlockDisplayMode.BLOCK},o.defaultDisplayMode=a.BlockDisplayMode.BLOCK,o.ExternalServices=t,o.moduleConfigs=i,o}t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},p=b(n(0)),g=b(n(5)),v=n(12),a=b(n(4)),m=n(1),s=b(n(131)),l=b(n(132)),c=b(n(18)),u=b(n(7)),d=n(2),f=n(67),h=n(30);n(134);var y=n(68);function b(e){return e&&e.__esModule?e:{default:e}}function E(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var S=(I(T,m.Block),r(T,[{key:"render",value:function(){var n=this,e=this.attributes,r=e.selected,i=e.selectState;if(this.props.data){var t=this.props,o=t.data,a=t.fromCopy,s=void 0!==a&&a,l=t.viewType,c=void 0===l?m.ViewTypes.CARD:l,u=t.version,d=t.size,f=o.fileId,h=o.fileInfo;return new Promise(function(e){var t=n.ExternalServices.components.FileCard;g.default.render(p.default.createElement(v.Provider,{store:n.ExternalServices.Redux.store},p.default.createElement(t,Object.assign({fileId:f},h,{toggleRef:n.toggleRef,selected:r,selectState:i,viewType:c,registActions:n.registActions,updateToolbar:n.updateToolbar,allToolbars:n.allToolbars,editor:n.editor,fromCopy:s,emitter:n.emitter,blockVersion:u,blockSize:d}))),n.mountPoint,function(){e()})})}return Promise.resolve()}},{key:"getNotifyWidth",value:function(){if(this.props.data){var e=this.props.viewType;if((void 0===e?m.ViewTypes.CARD:e)!==m.ViewTypes.INLINE)return 440}return 0}},{key:"unmount",value:function(e){o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"unmount",this).call(this,e),g.default.unmountComponentAtNode(this.mountPoint),this.heightUpdateNotifier.destroy(),this.emitter.off(d.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.WILL_UPDATE,this.heightUpdateNotifier.notifyWillUpdate),this.emitter.off(d.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.DID_UPDATE,this.heightUpdateNotifier.notifyDidUpdate),this.emitter.off(d.VIEW_RENDERED,this.handleViewRendered)}},{key:"resize",value:function(){}},{key:"commentQuota",value:function(){return"["+this.ExternalServices.t("etherpad.Drive")+"]"}},{key:"collectText",value:function(){return"["+this.ExternalServices.t("etherpad.Drive")+"]"}},{key:"onSearch",value:function(e){var t=this,n=e.searchKey,r=this.props.data;if(!r)return[];var i=n.toLowerCase(),o=r.fileInfo.name.toLowerCase();return(0,m.searchString)(o,i).map(function(e){return Object.assign({},e,{isReplaceable:t.isReplaceable,blockId:t.blockId})})}},{key:"onHighlight",value:function(e,t){var n=e.key,r=e.matches;this.emitter.emit("highlightResult",{searchResult:r,selectedKey:n,isSelected:t})}},{key:"onCancelSearch",value:function(){this.emitter.emit("clearSearchResult",[])}},{key:"onReplace",value:function(){}},{key:"onCopy",value:function(e){this.ExternalServices&&this.ExternalServices.utils&&this.ExternalServices.utils.collectEvent&&this.ExternalServices.utils.collectEvent("doc_copy_filecard");var t=e.blockType,n=e.props;if(n.data&&n.data.fileInfo&&"none"===n.data.fileInfo.driveKey)return this.ExternalServices.Toast&&this.ExternalServices.Toast.show({key:"filecardCopyFailed",type:"error",content:this.ExternalServices.t("filecard.copy_failed")}),{html:"",text:""};n.fromCopy=!0;var r=(0,m.generateBlockDataSet)({blockType:t,props:n}),i=this.ExternalServices.t("block.common_paste_unsupported");return{html:(0,m.generateBlockHTML)(r,i),text:i}}},{key:"placeholderHtml",value:function(e,t){return this.props.viewType===m.ViewTypes.CARD?(0,f.renderCardPlaceholder)(e):o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"placeholderHtml",this).call(this,e,t)}},{key:"placeholderJsx",value:function(e,t){return this.props.viewType===m.ViewTypes.CARD?(0,f.renderCardPlaceholderJsx)(e):o(T.prototype.__proto__||Object.getPrototypeOf(T.prototype),"placeholderJsx",this).call(this,e,t)}},{key:"onTap",value:function(e){return{preventFocus:!!$(e.target).closest(".drive-button-opt").length}}},{key:"onLongTap",value:function(e){return{preventFocus:!!$(e.target).closest(".drive-button-opt").length}}},{key:"onDoubleTap",value:function(e){this.previewAction&&this.previewAction(e)}},{key:"downloadTooltip",get:function(){var e=this.ExternalServices.t;return(0,y.isAuthorityDownloadable)(this.ExternalServices)?e("mention.download"):e("CreationDoc_ECM_AdminDisableToast")}}]),T);function T(e,t,n,r){k(this,T);var i=C(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,e,t));return i.editbarTrigger=m.Trigger.hover,i.setScreenVisible=function(){return null},i.emitter=new c.default,i.isReplaceable=!1,i.allToolbars=[],i.editbarCommands=[],i.shouldKeepAlive=!1,i.renderLocally=!0,i.heightUpdateNotifier=new u.default({getContext:function(){return i.context},getBlockId:function(){return i.blockId}}),i.onClickViewSwitch=function(e){var t;i.onViewSwitch&&(i.onViewSwitch(e),(t=(0,h.getBlockWidthNotifyModule)(i))&&t.notifyBlockWidth(i,i.getNotifyWidth()))},i.init=function(){i.allToolbars=[{key:"preview",Icon:function(){return p.default.createElement(s.default,null)},handler:function(e){i.previewAction&&i.previewAction(e)},tooltip:i.ExternalServices.t("common.view")},{key:"download",Icon:i.renderDownloadIcon,handler:function(e){(0,y.isAuthorityDownloadable)(i.ExternalServices)&&i.downloadAction&&i.downloadAction(e)},tooltip:i.downloadTooltip},m.CommonCommandKey.separator,i.getToolbarButtonFor(m.ViewTypes.INLINE,i.onClickViewSwitch),i.getToolbarButtonFor(m.ViewTypes.CARD,i.onClickViewSwitch),i.getToolbarButtonFor(m.ViewTypes.PREVIEW,i.onClickViewSwitch),m.CommonCommandKey.separator,m.CommonCommandKey.comment],i.editbarCommands=[].concat(E(i.allToolbars)),i.emitter.on(d.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.WILL_UPDATE,i.heightUpdateNotifier.notifyWillUpdate),i.emitter.on(d.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.DID_UPDATE,i.heightUpdateNotifier.notifyDidUpdate),i.emitter.on(d.VIEW_RENDERED,i.handleViewRendered),i.ExternalServices.previewSize&&i.ExternalServices.previewSize.width&&(i.defaultStyle.width=i.ExternalServices.previewSize.width),i.ExternalServices.previewSize&&i.ExternalServices.previewSize.height&&(i.defaultStyle.height=i.ExternalServices.previewSize.height)},i.registActions=function(e,t,n){i.previewAction=e,i.downloadAction=t,i.onViewSwitch=n},i.updateToolbar=function(e){var t;toolbar&&i.context&&i.context.updateEditbar&&(t=i.context.getCommandByKey,e=e.map(function(e){return t&&(0,m.isCommonCommandKey)(e)?t(e):e}),i.editbarCommands=e,i.context.updateEditbar(e,i))},i.toggleRef=function(e){i.setScreenVisible=e},i.handleViewRendered=function(){i.notifyContentReady()},i.renderDownloadIcon=function(){var e=(0,a.default)({"file-card-download-disable":!(0,y.isAuthorityDownloadable)(i.ExternalServices)});return p.default.createElement(l.default,{className:e})},i.editor=n,i.ExternalServices=r,i.init(),i}t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M12.82 13.86a.38.38 0 0 1 0-.53l.53-.53a.38.38 0 0 1 .53 0l3.62 3.62v-2.2c0-.16.02-.22.05-.28.03-.06.08-.11.14-.15.06-.03.12-.05.3-.05h.53c.17 0 .23.02.29.05.06.04.1.09.14.15.03.06.05.12.05.29v4.01a.75.75 0 0 1-.75.75h-4.02c-.17 0-.23-.01-.29-.05a.34.34 0 0 1-.14-.14c-.03-.06-.05-.12-.05-.29v-.53c0-.17.02-.23.05-.3.03-.05.08-.1.14-.14.06-.03.12-.05.3-.05h2.21l-3.63-3.63zM6.5 9.88c0 .2-.17.38-.38.38h-.75A.37.37 0 0 1 5 9.88V5.76A.75.75 0 0 1 5.75 5h4.12c.21 0 .38.16.38.37v.75c0 .2-.17.38-.38.38H7.5l3.65 3.64c.15.15.15.39 0 .54l-.53.53a.38.38 0 0 1-.53 0L6.5 7.63v2.25z",fillRule:"evenodd"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M19.5 16.38v1.87c0 .41-.34.75-.75.75H5.25a.75.75 0 0 1-.75-.75v-1.88c0-.2.17-.37.38-.37h.75c.2 0 .37.17.37.38v1.12h12v-1.13c0-.2.17-.37.38-.37h.75c.2 0 .37.17.37.38zm-6.74-3.35l2.16-2.16a.38.38 0 0 1 .53 0l.53.53c.14.14.14.38 0 .53l-3.71 3.71a.37.37 0 0 1-.54 0l-3.7-3.71a.37.37 0 0 1 0-.53l.52-.53a.38.38 0 0 1 .53 0l2.18 2.17V4.39c0-.21.16-.38.37-.38h.75c.2 0 .38.17.38.38v8.64z",fillRule:"evenodd"}))}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(1),d=o(n(136)),s=o(n(140)),f=n(2);function o(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p,g,v=(h(m,a.Creator),r(m,[{key:"create",value:function(e,t,n){var r=t.props.data,i=r.chatId,o=r.chatToken,a=this.instanceList,s=a.byChatId,l=a.byChatToken,c=new d.default(e,t,this.ExternalServices,n,this.api),u=this.ExternalServices.Utils.isAnonymousAccess;return u&&u()||o===f.EMPTY_CHAT_GROUP_IDENTIFIER||i===f.EMPTY_CHAT_GROUP_IDENTIFIER||(o?(l[o]?l[o].push(c):l[o]=[c],this.onFetchingInfoByChatToken(o)):(s[i]?s[i].push(c):s[i]=[c],this.onFetchingInfoByChatId(i))),c}},{key:"throttleFetchingInfo",value:function(t){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:100,o=[],a=null;return function(e){o.push(e),a&&(window.clearTimeout(a),a=null),o.length===i&&t.call(n,o.splice(0,o.length)),a=window.setTimeout(function(){t.call(n,o.splice(0,o.length))},r)}}},{key:"fetchChatInfoByChatToken",value:(g=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.api.fetchChatInfoByChatToken(t);case 4:n=e.sent,this.updateInstanceInfo(n.data);case 6:case"end":return e.stop()}},e,this)})),b)},{key:"fetchChatInfoByChatId",value:(p=l(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.api.fetchChatInfoByChatId(t);case 4:n=e.sent,this.updateInstanceInfo(n.data);case 6:case"end":return e.stop()}},e,this)})),y)},{key:"updateInstanceInfo",value:function(n){var e,r,i,t=Object.keys(n);t.length&&(e=this.instanceList,r=e.byChatId,i=e.byChatToken,t.forEach(function(t){var e=i[t]||r[t];Array.isArray(e)?e.forEach(function(e){e.update(n[t])}):e.update(n[t])}))}},{key:"onInternalPaste",value:function(e){var t=e.dataset,n=t.blockType,r=t.props;return(0,a.generateBlockDataSet)({blockType:n,props:r})}}]),m);function m(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;c(this,m);var o=u(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=a.BlockType.CHAT_CARD_BLOCK,o.defaultProps={},o.chatCardInfoCache={},o.instanceList={byChatToken:{},byChatId:{}},o.onFetchingInfoByChatToken=o.throttleFetchingInfo(o.fetchChatInfoByChatToken),o.onFetchingInfoByChatId=o.throttleFetchingInfo(o.fetchChatInfoByChatId),o.ExternalServices=t,o.moduleConfigs=i,o.api=new s.default(t),o}function y(e){return p.apply(this,arguments)}function b(e){return g.apply(this,arguments)}t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},g=l(n(0)),v=l(n(5)),m=n(137),y=n(1),a=l(n(7)),b=n(16),s=n(67);function l(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h,p,E=4012,k=440,C=(f(I,y.Block),r(I,[{key:"getNotifyWidth",value:function(){return k}},{key:"update",value:function(e){this.chatCardInfo=e,this.updateUI()}},{key:"handleOpenLark",value:function(e){e.stopPropagation();var t=document.createEvent("Event");t.initEvent("openLark",!0,!0),dispatchEvent(t)}},{key:"convertToHttps",value:function(e){var t="http://";return e.startsWith(t)?e.replace(t,"https://"):e}},{key:"handleOnJoin",value:(p=c(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s,l,c,u,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.dataSet.props.data,n=t.author,r=t.chatId,i=t.chatToken,o=this.ExternalServices,a=o.Constants,s=o.t,l=o.Toast,c=a.JOIN_CHAT_ERROR_MSG,u="",e.prev=4,d=void 0,i)return e.next=9,this.api.joinChatByChatToken(i);e.next=12;break;case 9:d=e.sent,e.next=15;break;case 12:return e.next=14,this.api.joinChatByChatId(r,n);case 14:d=e.sent;case 15:(f=d.data.code)?(u=c[f]||s("etherpad.join_group_failed"),f===E&&this.uiComponent.update({hasJoined:!0})):this.uiComponent.update({hasJoined:!0}),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(4),u=s("etherpad.join_group_failed");case 22:u&&(l.show({key:"join-chat-error",type:"error",content:u}),this.uiComponent.update({showConfirmStatus:!1})),this.ExternalServices.LogService.collectEvent("client_join_chat",{join_succ:u?0:1,is_external:this.chatCardInfo.is_cross_tenant});case 24:case"end":return e.stop()}},e,this,[[4,19]])})),T)},{key:"render",value:(h=c(regeneratorRuntime.mark(function e(t,n){var r,i,o,a,s,l,c,u,d,f,h,p=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t===y.RenderStage.update&&n&&"attribute"!==n.type)return e.abrupt("return");e.next=2;break;case 2:return r=this.dataSet.props.data,i=r.icon,o=r.chatId,a=r.chatToken,s=this.handleOnJoin.bind(this),l=this.attributes,c=l.selected,u=l.selectState,d="ERROR"===a,f=this.ExternalServices.Utils.isAnonymousAccess,h=f&&f(),e.next=10,new Promise(function(e){v.default.render(g.default.createElement(b.NotifyHeightUpdateOnMount,{notifier:p.heightUpdateNotifier},g.default.createElement(m.ChatCard,{icon:p.convertToHttps(i),chatId:o,selected:c,selectState:u,onOpenLark:p.handleOpenLark,onJoinChat:s,ExternalServices:p.ExternalServices,ref:function(e){return p.uiComponent=e},isInvalid:d,isAnonymous:!!h,blockId:p.blockId})),p.mountPoint,function(){return e()})});case 10:case"end":return e.stop()}},e,this)})),S)},{key:"blockDidMount",value:function(){this.updateUI()}},{key:"updateUI",value:function(){var e,t,n,r,i,o;this.chatCardInfo&&this.uiComponent&&(this.heightUpdateNotifier.notifyWillUpdate(),t=(e=this.chatCardInfo).content,n=e.group_desc,r=e.has_join,i=e.is_cross_tenant,o=e.is_external,this.uiComponent.update({title:t,desc:n,hasJoined:r,ready:!0,isCrossTenant:i,isExternal:o}),this.heightUpdateNotifier.notifyDidUpdate())}},{key:"unmount",value:function(e){o(I.prototype.__proto__||Object.getPrototypeOf(I.prototype),"unmount",this).call(this,e),v.default.unmountComponentAtNode(this.mountPoint),this.heightUpdateNotifier.destroy()}},{key:"resize",value:function(){}},{key:"commentQuota",value:function(){return"["+this.ExternalServices.t("etherpad.chatcard")+"]"}},{key:"collectText",value:function(){return"["+this.ExternalServices.t("etherpad.chatcard")+"]"}},{key:"onCopy",value:function(e){var t=this.ExternalServices.Utils.isAnonymousAccess;if(t&&t())return{html:"",text:""};this.ExternalServices&&this.ExternalServices.LogService&&this.ExternalServices.LogService.collectEvent("doc_copy_chatcard");var n=e.blockType,r=e.props,i=(0,y.generateBlockDataSet)({blockType:n,props:r}),o=this.ExternalServices.t("block.common_paste_unsupported");return{html:'<span class="clientside-chatcard" style="white-space:pre;"\n    data-clientside-chatcard-props='+JSON.stringify(i)+"> </span>",text:o}}},{key:"onTap",value:function(e){return{preventFocus:!!$(e.target).closest(".block-chatcard--opt").length}}},{key:"onLongTap",value:function(e){return{preventFocus:!!$(e.target).closest(".block-chatcard--opt").length}}},{key:"placeholderHtml",value:function(e){return(0,s.renderCardPlaceholder)(e||"438px")}},{key:"placeholderJsx",value:function(e){return(0,s.renderCardPlaceholderJsx)(e||"438px")}}]),I);function I(e,t,n,r,i){u(this,I);var o=d(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,e,t));return o.uiComponent=null,o.editbarTrigger=y.Trigger.hover,o.editbarCommands=[y.CommonCommandKey.comment],o.shouldKeepAlive=!1,o.renderLocally=!0,o.heightUpdateNotifier=new a.default({getContext:function(){return o.context},getBlockId:function(){return o.blockId}}),o.dataSet=t,o.ExternalServices=n,o.editor=r,o.api=i,o}function S(e,t){return h.apply(this,arguments)}function T(){return p.apply(this,arguments)}t.default=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatCard=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(0),v=u(o),a=u(n(4)),m=n(46),y=n(6),s=u(n(138));n(139);var l=n(2),c=n(1);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g="block-chatcard",b=g+"--icon",E=g+"--info",k=g+"--title",C=g+"--title_text",I=g+"--label",S=g+"--desc",T=g+"--opt";function O(){f(this,O);var i=h(this,(O.__proto__||Object.getPrototypeOf(O)).apply(this,arguments));return i.state={title:"",desc:"",notAllowJoin:!1,hasJoined:!1,showConfirmStatus:!1,ready:!1,isCrossTenant:!1,isExternal:!1},i.wrapperEl=null,i.handleJoinHover=function(e){e||i.collectHoverEvent()},i.collectHoverEvent=function(){var e,t,n=i.props.ExternalServices.LogService;n&&(e=n.getFileType,t=n.getEncryToken,(0,n.collectEvent)("client_cant_join_chat",{file_id:t(),file_type:e()}))},i.handleJoinClick=function(e,t){var n,r;e?t&&(r=(n=i.props.ExternalServices).t,n.Toast.show({key:"join-chat-error",type:"error",content:r&&r("block.chat.join_no_permission")}),i.collectHoverEvent()):i.setState({showConfirmStatus:!0})},i.setWrapperRef=function(e){i.wrapperEl=e},i}t.ChatCard=(p(O,o.Component),r(O,[{key:"shouldShowPlaceholder",value:function(){var e=this.props,t=e.isAnonymous,n=e.chatId,r=this.state.title;return t||n===l.EMPTY_CHAT_GROUP_IDENTIFIER||!r}},{key:"update",value:function(e){var t=this,n=this.state.ready;this.setState(Object.assign({},this.state,e),function(){var e;n||!t.state.ready||!t.wrapperEl||(e=t.props.ExternalServices.onRenderComplete)&&e(t.wrapperEl,t.props.blockId)})}},{key:"renderIconElem",value:function(){var e=this.props.icon;return v.default.createElement("div",{className:b},v.default.createElement("img",{src:this.shouldShowPlaceholder()?s.default:e}))}},{key:"renderInfoElem",value:function(){var e=this.props,t=e.ExternalServices,n=e.isInvalid,r=e.isAnonymous,i=this.state,o=i.ready,a=i.title,s=i.desc,l=i.isCrossTenant,c=t.t,u="",d="";if(this.shouldShowPlaceholder())u=c(r?"CreationDoc_Docs_GroupCard_Anonymous_Title":"etherpad.chatcard");else if(o)u=a,d=s;else{if(!n)return null;u=c("etherpad.chatcard_invalidation")}return v.default.createElement("div",{className:E},v.default.createElement("div",{className:k},v.default.createElement("div",{className:C+" "+(l?"with-label":"")},u),l&&v.default.createElement("div",{className:I},v.default.createElement("span",null,c("common.external")))),d&&v.default.createElement("div",{className:S},d))}},{key:"renderOperationElem",value:function(){var e=this,t=this.props,n=t.ExternalServices,r=t.onJoinChat,i=t.onOpenLark,o=t.chatId;if(n.mountOptions&&n.mountOptions.historyMode)return null;var a=n.t,s=this.state,l=s.ready,c=s.hasJoined,u=s.showConfirmStatus,d=s.isExternal,f=s.isCrossTenant,h=d&&!f,p=!h||y.browser.isMobile,g=n.Utils.isShortCut;return this.shouldShowPlaceholder()||!l||g&&g()?null:u&&!c?v.default.createElement("div",{className:T},v.default.createElement("button",{className:"btn-cancel",onClick:function(){return e.setState({showConfirmStatus:!1})}},a("common.cancel")),v.default.createElement("button",{className:"btn-confirm",onClick:r},a("common.confirm"))):v.default.createElement("div",{className:T},c?v.default.createElement("button",{className:"btn-chat js-open-lark","data-id":o,"data-is-cross-tenant":f,onClick:i},a("etherpad.initiate_conversation")):v.default.createElement(m.Tooltip,{title:a("block.chat.join_no_permission"),placement:"top",hideActions:["onMouseLeave","onClick"],showDelay:200,disable:p},v.default.createElement("button",{className:"btn-join "+(h?"disable":""),onClick:function(){return e.handleJoinClick(h,p)},onMouseEnter:function(){return e.handleJoinHover(p)}},a("etherpad.join_group_chat"))))}},{key:"render",value:function(){var e,t=this.props,n=t.selected,r=t.selectState,i=(0,a.default)(g,(d(e={},g+"__selected",n&&r!==c.SelectionState.COVER_ON_BLOCK),d(e,g+"__covered",r===c.SelectionState.COVER_ON_BLOCK),d(e,g+"__pc",!y.browser.isMobile),d(e,g+"__ready",this.state.ready),d(e,g+"__content",!0),e));return v.default.createElement("div",{className:i,ref:this.setWrapperRef},this.renderIconElem(),this.renderInfoElem(),this.renderOperationElem(),v.default.createElement("span",{className:"j-copy-span"}))}}]),O)},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iNDRweCIgaGVpZ2h0PSI0NHB4IiB2aWV3Qm94PSIwIDAgNDQgNDQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDY0ICg5MzUzNykgLSBodHRwczovL3NrZXRjaC5jb20gLS0+CiAgICA8dGl0bGU+aWNvbl90b29sX2dyb3VwIGNhcmRfbm9yPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Iumhtemdoi0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iV2ViLeagt+W8j+S4vuS+iyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTM3My4wMDAwMDAsIC0xMTI1LjAwMDAwMCkiPgogICAgICAgICAgICA8ZyBpZD0i57yW57uELTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI0Mi4wMDAwMDAsIDMyMi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxnIGlkPSLkvJror53nvqTlpIfku70tOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTE4LjAwMDAwMCwgNzkwLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgICAgIDxnIGlkPSLnvJbovpHlmagv5paH5Lu25Y2h54mHIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Iue8lue7hC0yIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMy4wMDAwMDAsIDEzLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Imljb25fdG9vbF9ncm91cC1jYXJkX25vciI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGNpcmNsZSBpZD0i5qSt5ZyG5b2iIiBmaWxsPSIjMTRDMEZGIiBjeD0iMjIiIGN5PSIyMiIgcj0iMjIiPjwvY2lyY2xlPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxyZWN0IGlkPSLnn6nlvaIiIHN0cm9rZT0iI0ZGRkZGRiIgc3Ryb2tlLXdpZHRoPSIyIiB4PSIxMiIgeT0iMTQiIHdpZHRoPSIyMCIgaGVpZ2h0PSIxNiIgcng9IjEiPjwvcmVjdD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMjcuNjYyOTgyLDE4LjA2OTQ3NzYgTDI0LjA1ODAxNTIsMTguMzI2OTc1MyBMMjQuMzM3MDE4LDIyLjkzMDUyMjQgTDI3Ljk0MTk4NDgsMjIuNjczMDI0NyBMMjcuNjYyOTgyLDE4LjA2OTQ3NzYgWiIgaWQ9IlJlY3RhbmdsZSIgc3Ryb2tlPSIjRkZGRkZGIiBzdHJva2Utd2lkdGg9IjIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUuNCwyMSBMMTkuNiwyMSBDMTkuODIwOTEzOSwyMSAyMCwyMS4xNzkwODYxIDIwLDIxLjQgTDIwLDIyLjYgQzIwLDIyLjgyMDkxMzkgMTkuODIwOTEzOSwyMyAxOS42LDIzIEwxNS40LDIzIEMxNS4xNzkwODYxLDIzIDE1LDIyLjgyMDkxMzkgMTUsMjIuNiBMMTUsMjEuNCBDMTUsMjEuMTc5MDg2MSAxNS4xNzkwODYxLDIxIDE1LjQsMjEgWiIgaWQ9IlJlY3RhbmdsZSIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNS40LDI1IEwyMS42LDI1IEMyMS44MjA5MTM5LDI1IDIyLDI1LjE3OTA4NjEgMjIsMjUuNCBMMjIsMjYuNiBDMjIsMjYuODIwOTEzOSAyMS44MjA5MTM5LDI3IDIxLjYsMjcgTDE1LjQsMjcgQzE1LjE3OTA4NjEsMjcgMTUsMjYuODIwOTEzOSAxNSwyNi42IEwxNSwyNS40IEMxNSwyNS4xNzkwODYxIDE1LjE3OTA4NjEsMjUgMTUuNCwyNSBaIiBpZD0iUmVjdGFuZ2xlIiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=="},function(e,t,n){},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a,s,l,c,u,d,f,h=(u=p,(d=[{key:"joinChatByChatId",value:(c=i(regeneratorRuntime.mark(function e(t,n){var r,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.ExternalServices,i=r.Request,o=r.Utils,e.next=3,i.post("/api/mention/join.chat/",{token:o.getPageToken(),chat_id:t,invitor:n});case 3:return a=e.sent,e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)})),y)},{key:"joinChatByChatToken",value:(l=i(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.ExternalServices.Request,e.next=3,n.post("/api/mention/join.chat.v2/",{share_token:t});case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}},e,this)})),m)},{key:"fetchChatInfoByChatId",value:(s=i(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.ExternalServices,r=n.Request,i=n.Utils,o=n.Constants,a={chat_ids:t,source:o.SOURCE,token:i.getPageToken()},e.next=4,r.post("/api/mention/chat.info.v2/",a,{headers:{"Content-Type":"application/json"}});case 4:return s=e.sent,e.abrupt("return",s);case 6:case"end":return e.stop()}},e,this)})),v)},{key:"sourceFetchChatInfoByChatToken",value:(a=i(regeneratorRuntime.mark(function e(t){var n,r,i,o,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.ExternalServices,r=n.Request,i=n.Utils,o=n.Constants,a={share_tokens:t.join(","),source:o.SOURCE,obj_type:o.SUITE_TYPE,obj_token:i.getPageToken()},e.next=4,r.post("/api/mention/chat.info.v3/",a,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return s=e.sent,e.abrupt("return",s);case 6:case"end":return e.stop()}},e,this)})),g)},{key:"addFetchChatInfoCount",value:function(){var e=this;this.fetchChatInfoCount++,setTimeout(function(){e.fetchChatInfoCount=0},this.FETCH_CHAT_INFO_RESET_DELAY)}},{key:"fetchChatInfoByChatToken",value:function(n){var r=this;return 1<n.length?this.sourceFetchChatInfoByChatToken(n):this.fetchChatInfoCount?(window.clearTimeout(this.fetchChatInfoTimeId),this.fetchChatInfoTimeId=setTimeout(function(){r.sourceFetchChatInfoByChatToken(r.chatTokenList).then(function(e){r.handleCallbacks(r.fetchChatInfoResolves,e)}).catch(function(e){r.handleCallbacks(r.fetchChatInfoRejects,e)}).finally(function(){r.fetchChatInfoCount=0,r.fetchChatInfoResolves=[],r.fetchChatInfoRejects=[],r.chatTokenList=[]})},this.FETCH_CHAT_INFO_RESET_DELAY),new Promise(function(e,t){r.chatTokenList=r.chatTokenList.concat(n),r.fetchChatInfoResolves.push(e),r.fetchChatInfoRejects.push(t)})):(this.addFetchChatInfoCount(),this.sourceFetchChatInfoByChatToken(n))}}])&&r(u.prototype,d),f&&r(u,f),p);function p(e){o(this,p),this.ExternalServices={},this.FETCH_CHAT_INFO_RESET_DELAY=10,this.fetchChatInfoCount=0,this.fetchChatInfoResolves=[],this.fetchChatInfoRejects=[],this.chatTokenList=[],this.handleCallbacks=function(e,t){return e.forEach(function(e){return e(t)})},this.ExternalServices=e}function g(e){return a.apply(this,arguments)}function v(e){return s.apply(this,arguments)}function m(e){return l.apply(this,arguments)}function y(e,t){return c.apply(this,arguments)}t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=n(1),d=c(n(10)),o=n(24),a=n(34),s=c(n(69)),l=c(n(143)),f=n(3);function c(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v=(g(m,u.Creator),r(m,[{key:"create",value:function(e,t){return new l.default(e,t,this.ExternalServices)}},{key:"onInternalPaste",value:function(e){var t=e.dataset,n="";if("string"==typeof t.initData)try{n=JSON.parse(unescape(t.initData)).type}catch(e){console.error(e)}this.ExternalServices.LogService.collectEvent("click_create_poll",{block_id:t.blockId,create_source:"paste",poll_type:n}),t.token&&(0,f.captureException)("Error! Pasted poll has token "+t.token+".")}},{key:"onPaste",value:function(e){for(var t=e.pasteDataWrapper,n=(0,d.default)(t),r=new Set,i=n.find("."+u.BLOCK_CONTAINER),o=0;o<i.length;o++){var a=i[o],s=(0,u.getBlockDataSet)(a),l=s&&!r.has(s.blockId);if(s&&s.blockType===this.blockType&&l){r.add(s.blockId);var c="";if("string"==typeof s.initData)try{c=JSON.parse(unescape(s.initData)).type}catch(e){console.error(e)}this.ExternalServices.LogService.collectEvent("click_create_poll",{block_id:s.blockId,create_source:"paste",poll_type:c}),s.token&&(0,f.captureException)("Error! Pasted poll has token "+s.token+".")}}return e}}],[{key:"generateInitData",value:function(e){var n={title:"",type:o.PollType.single,voteOptions:[],voteOptionMap:{},voteMap:{}};o.PollType[e]&&(n.type=e);for(var t=function(){var e=s.default.createOption(),t=e.id;n.voteOptions.push(t),n.voteOptionMap[t]=e},r=0;r<2;r+=1)t();return{initData:n}}}]),m);function m(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;h(this,m);var o=p(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=u.BlockType.POLL_BLOCK,o.defaultProps={},o.defaultRecord=a.DEFAULT_POLL_RECORD,o.ExternalServices=t,o.moduleConfigs=i,o}t.default=v},function(e,t){e.exports=o("xk4V")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},g=k(n(0)),v=k(n(5)),m=n(47),a=n(1),s=n(34),l=n(2),c=k(n(7)),y=k(n(69)),b=n(12),u=k(n(18)),d=k(n(155)),f=k(n(156)),h=k(n(157)),p=k(n(4)),E=n(3);function k(e){return e&&e.__esModule?e:{default:e}}function C(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var O,w=(T(R,a.Block),r(R,[{key:"getNotifyWidth",value:function(){return this.isInHistoryMode()?this.mountPoint.offsetWidth:500}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"collectText",value:function(){return"["+this.plainText+"]"}},{key:"blockDidMount",value:function(){this.poll&&this.poll.mounted()}},{key:"onSearch",value:function(e){var t=this,n=e.searchKey;if(!this.pollRef)return[];var r=this.pollRef.querySelector(".vote-title > .dynamic-height-input--text");if(!r)return[];var i=n.toLowerCase(),o=r.textContent;return o?(0,a.searchString)(o.toLowerCase(),i).map(function(e){return Object.assign({},e,{isReplaceable:t.isReplaceable,blockId:t.blockId})}):[]}},{key:"onHighlight",value:function(e,t){var n=e.key,r=e.matches;this.emitter.emit("highlightResult",{searchResult:r,selectedKey:n,isSelected:t})}},{key:"onCancelSearch",value:function(){this.emitter.emit("clearSearchResult",[])}},{key:"onReplace",value:function(){}},{key:"onKeyup",value:function(e){this.poll&&this.poll.onKeyup(e)}},{key:"render",value:(O=C(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s,l,c,u,d,f,h,p=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isInHistoryMode())return v.default.render(this.getHistoryView(),this.mountPoint),e.abrupt("return");e.next=3;break;case 3:if(t=this.context.permissions,n=this.attributes,r=n.selected,i=n.selectState,o=this.getToken(),a=this.ExternalServices.io,this.manager){e.next=10;break}return o&&a&&(this.manager=new y.default(this,o,a)),e.abrupt("return");case 10:if((s=this.manager).isRecordReady()){e.next=14;break}return(0,E.captureException)("[Poll]: render before record ready"),e.abrupt("return");case 14:if(l=s.getTitle(),c=s.getOptionIds()){e.next=21;break}return u=s.getSnapshot(),d=Object.keys(u),(0,E.captureException)("[Poll]: invalid record with keys: "+d.join(",")),e.abrupt("return");case 21:return f=c.map(function(e){var t=s.getOption(e);if(!t)return null;var n=t.votes.map(function(e){return s.getVote(e)}).filter(function(e){return e});return Object.assign({},t,{votes:n})}).filter(function(e){return e}),h=s.getPollType(),e.next=25,new Promise(function(e){v.default.render(g.default.createElement(b.Provider,{store:p.ExternalServices.Redux.store},g.default.createElement(m.Poll,{ref:p.getPollInstance,innerRef:p.getPollRef,title:l,options:f,permissions:t||null,isPresentation:p.isPresentation,size:p.presentationSize,selected:r,selectState:i,blockId:p.blockId,pollType:h,onTitleChange:function(){return s.setTitle.apply(s,arguments)},onAddOption:function(){return s.addOption.apply(s,arguments)},onDeleteOption:function(){return s.delOption.apply(s,arguments)},onVoteToggle:function(){return s.voteToggle.apply(s,arguments)},onEditOption:function(){return s.editOption.apply(s,arguments)},onEmojiChange:function(){return s.setEmoji.apply(s,arguments)},isVoted:function(){return s.isVoted.apply(s,arguments)},getEmoji:function(){return s.getEmoji.apply(s,arguments)},ExternalServices:p.ExternalServices,emitter:p.emitter})),p.mountPoint,e)});case 25:case"end":return e.stop()}},e,this)})),x)},{key:"getHistoryView",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e,n=this.ExternalServices.Helpers.getLanguage,r=h.default;t.historyMode===l.HISTORY_MODE.PLACEHOLDER&&(r=("zh"===n()?d:f).default);var i=(0,p.default)("poll-placeholder",{"poll-placeholder-old":t.historyMode===l.HISTORY_MODE.PLACEHOLDER,"poll-placeholder-new":t.historyMode===l.HISTORY_MODE.PLACEHOLDER_NEW});return g.default.createElement("div",{className:i},g.default.createElement(r,{className:"history-icon"}),t.historyMode===l.HISTORY_MODE.PLACEHOLDER_NEW&&g.default.createElement("span",{className:"history-block-name"},this.plainText))}},{key:"blockDidCreate",value:function(){this.poll&&this.poll.titleRef&&(this.poll.titleRef.click(),this.poll.titleRef.focus(),this.poll.checkFocus())}},{key:"resize",value:function(e,t){this.presentationSize={width:e,height:t},this.isPresentation&&this.nextRender({stage:a.RenderStage.update,source:a.RenderSource.doc})}},{key:"unmount",value:function(e){o(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"unmount",this).call(this,e),v.default.unmountComponentAtNode(this.mountPoint),this.manager&&this.manager.destructor(),this.heightUpdateNotifier.destroy(),this.emitter.off(l.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.WILL_UPDATE,this.heightUpdateNotifier.notifyWillUpdate),this.emitter.off(l.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.DID_UPDATE,this.heightUpdateNotifier.notifyDidUpdate),this.emitter.off(l.VIEW_RENDERED,this.handleViewRendered)}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=this.manager,i=(0,a.generateBlockDataSet)({blockType:t,props:n,initData:r?r.getSnapshot():s.DEFAULT_POLL_RECORD}),o=this.ExternalServices.t("block.common_paste_unsupported");return{html:(0,a.generateBlockHTML)(i,o),text:o}}},{key:"shouldPreventCopy",value:function(){return!!document.activeElement&&"TEXTAREA"===document.activeElement.tagName}},{key:"onTap",value:function(e){return{preventFocus:!!$(e.target).closest(".block-poll--vote-action").length}}},{key:"onLongTap",value:function(e){return{preventFocus:!!$(e.target).closest(".block-poll--vote-action").length}}},{key:"isPresentation",get:function(){return this.context.presentationMode!==a.PresentationMode.NONE}}]),R);function R(e,t,n){I(this,R);var r=S(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,e,t));return r.manager=null,r.pollRef=null,r.editbarTrigger=a.Trigger.hover,r.isReplaceable=!1,r.emitter=new u.default,r.plainText="",r.editbarCommands=[a.CommonCommandKey.comment],r.shouldKeepAlive=!1,r.contentAsyncRender=!0,r.handleViewRendered=function(){r.notifyContentReady()},r.getPollInstance=function(e){e&&(r.poll=e.getWrappedInstance())},r.getPollRef=function(e){e&&(r.pollRef=e)},r.ExternalServices=n,r.heightUpdateNotifier=new c.default({getContext:function(){return r.context},getBlockId:function(){return r.blockId},throttleByRAF:!!r.ExternalServices.Helpers&&!1===r.ExternalServices.Helpers.browser.safari}),r.emitter.on(l.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.WILL_UPDATE,r.heightUpdateNotifier.notifyWillUpdate),r.emitter.on(l.BLOCK_INSTANCE_HEIGHT_CHANGE_EVENT.DID_UPDATE,r.heightUpdateNotifier.notifyDidUpdate),r.emitter.on(l.VIEW_RENDERED,r.handleViewRendered),r.plainText=r.ExternalServices.t("block.poll"),r}function x(){return O.apply(this,arguments)}t.default=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",fill:"#88909A"},t),i.default.createElement("path",{d:"M8 15.5a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15zm0-1a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13zM6 8.22v-.5C7.1 6.53 7.93 5.99 8.52 6.1c.89.17.8.94.74 1.23-.05.3-1.8 4.6-1.44 4.66.24.04.72-.34 1.44-1.16v.63C8.6 12.48 7.75 13 6.68 13c-.67 0-.82-.59-.56-1.26.56-1.46 1.52-3.95 1.52-4.42 0-.47-.54-.17-1.63.9zM8.7 5.3a1.15 1.15 0 1 1 0-2.3 1.15 1.15 0 0 1 0 2.3z"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOrder=function(e){for(var t=e,r=[];0<=t&&(r.unshift(t%26),0!=(t=(t-t%26)/26)););var i="A".charCodeAt(0);return r.map(function(e,t){var n=0===t&&t!==r.length-1?e-1:e;return String.fromCharCode(i+n)}).join("")},t.isEditable=function(e,t){return!!e&&!t.Helpers.browser.mobile&&e&&e.editable},t.getCurrentUserId=function(){var e=window.User;return e&&e.id||""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=n(0),R=s(w),x=s(n(4)),M=n(46),o=n(1),u=s(n(147)),N=n(47),A=n(34),_=s(n(148)),L=s(n(149)),D=s(n(150)),B=s(n(70)),a=n(17);function s(e){return e&&e.__esModule?e:{default:e}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var h,p,g=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},v=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=10,b=350,F=25,j=3,E=430;(p=h=h||{}).top="top",p.bottom="bottom";var y=(f(k,w.Component),r(k,[{key:"bindEvents",value:function(){var e=document.querySelector(".etherpad-container-wrapper");e&&(this.scrollContainerEvent=a.GlobalDOMEventEmitter.get(e)),window.addEventListener("resize",this.handleScroll),this.documentEvent.on("click",this.handleDocumentClick),this.props.isRemoteDevice?document.addEventListener("touchmove",this.handleScroll):this.scrollContainerEvent&&(this.scrollContainerEvent.on("scroll",this.handleScroll),this.scrollContainerEvent.on("mousewheel",this.handleScroll)),window.addEventListener("resize",this.updateEmojiContainerWidth)}},{key:"removeEvents",value:function(){window.removeEventListener("resize",this.handleScroll),this.documentEvent.off("click",this.handleDocumentClick),this.props.isRemoteDevice?document.removeEventListener("touchmove",this.handleScroll):this.scrollContainerEvent&&(this.scrollContainerEvent.off("scroll",this.handleScroll),this.scrollContainerEvent.off("mousewheel",this.handleScroll)),window.removeEventListener("resize",this.updateEmojiContainerWidth)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"handleScroll",value:function(){this.updatePickerPlacement()}},{key:"updatePickerPlacement",value:function(){var e=this.getPickerPlacement();e!==this.state.pickerPlacement&&this.setState({pickerPlacement:e})}},{key:"getPickerPlacement",value:function(){var e=h.bottom;if(!this.voteRef)return e;var t=339,n=document.body.clientHeight,r=this.voteRef.getBoundingClientRect(),i=r.top;return n-r.bottom-t<m&&!(i-t<m)&&(e=h.top),e}},{key:"componentDidMount",value:function(){this.bindEvents(),this.updatePickerPlacement(),this.inputRef&&this.checkFocus(),this.updateEmojiContainerWidth()}},{key:"componentWillUnmount",value:function(){this.removeEvents()}},{key:"componentDidUpdate",value:function(){this.inputRef&&this.checkFocus()}},{key:"getPopoverContainer",value:function(){var e=this.props.isPresentation,t=document.body;return e&&document.querySelector("#editorcontainerbox")||t}},{key:"renderPicker",value:function(e){var t,n=this,r=this.props,i=r.isRemoteDevice,o=r.ExternalServices,a=o.Helpers.browser,s=o.VotePicker,l=this.state.pickerVisible,c=(0,x.default)((P(t={},N.preCls+"--picker-remote-device",i),P(t,N.preCls+"--picker-windows","Windows"===a.osname),P(t,N.preCls+"--picker-ie",a.msie||a.msedge),t));return R.default.createElement("div",{className:c,ref:function(e){return e&&(n.pickerRef=e)},"data-assign-poll-status":N.ActiveStatus.focus},l&&R.default.createElement(s,{onSelect:this.handleEmojiSelect(e),emojisToShowFilter:function(e){var t=e.unified;return u.default.includes(t)},emojiSize:i?26:24,showPreview:!1,perLine:i?8:9,i18n:this.PickerI18n(o),native:!0}))}},{key:"handlePickerVisible",value:function(e){this.setState({pickerVisible:e})}},{key:"checkFocus",value:function(){var e=document.activeElement,t=Boolean(e&&this.inputRef===e);t!==this.state.isFocusing&&this.setState({isFocusing:t})}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.editable,i=n.optionId,o=n.order,a=n.activeStatus,s=n.text,l=n.isVoted,c=n.votes,u=n.blockId,d=n.isRemoteDevice,f=n.ExternalServices,h=f.VoteEmoji,p=this.state,g=p.isFocusing,v=p.isExpanded,m=p.emojiContainerWidth,y=(0,N.advancedStatus)(a),b=y.isNormal,E=y.isEditting,k=f.Helpers.browser,C=f.t,I=(0,x.default)(N.preCls+"--vote-option",(P(e={},N.preCls+"--voted-option",!E&&l),P(e,N.preCls+"--vote-option-editable",!b&&r&&!g),P(e,N.preCls+"--editting-option",g&&r),e)),S=d?16:18,T="poll-option-"+u+"-"+i,O=Math.floor(m/F)*j;return R.default.createElement(w.Fragment,null,R.default.createElement("div",{className:N.preCls+"--vote-option-wrapper"},R.default.createElement("label",{htmlFor:T,className:I},R.default.createElement("div",{className:N.preCls+"--vote-order"},o),R.default.createElement(B.default,{id:T,className:"vote-option",getRef:function(e){return e&&(t.inputRef=e)},readOnly:!r,onChange:this.handleOptionInput,onBlur:function(){t.editLogged=!1},placeholder:k.mobile?"":C("block.poll_option_placeholder")+"...",value:s}),!E&&R.default.createElement("div",{className:N.preCls+"--vote-number"},R.default.createElement("div",null,1===c.length?C("block.poll_one_vote",c.length):C("block.poll_x_votes",c.length)))),E&&R.default.createElement("div",{className:N.preCls+"--del","data-assign-poll-status":N.ActiveStatus.focus,onClick:this.handleClick("delOption")},R.default.createElement(_.default,null)),this.renderVoteAction()),R.default.createElement("div",{className:N.preCls+"--vote-list-wrapper"},0<c.length&&R.default.createElement("div",{className:N.preCls+"--vote-list",ref:function(e){return e&&(t.voteContainerRef=e)}},c.slice(0,v?c.length:O).map(function(e){var t=e.emojiId,n=e.id;return R.default.createElement(h,{key:n,native:!0,emoji:t||A.DEFAULT_EMOJI_ID,size:S})}),c.length>O&&!v&&R.default.createElement("div",{className:N.preCls+"--vote-more-overlay"})),R.default.createElement("div",{className:N.preCls+"--vote-more-wrap"},c.length>O&&R.default.createElement(M.Tooltip,{title:C(v?"doc.toggle.collapse":"doc.toggle.expand"),placement:"bottom",hideActions:["onMouseLeave","onClick"],showDelay:200,disable:k.isMobile},R.default.createElement("div",{onClick:this.expandVote,className:(0,x.default)(N.preCls+"--vote-more")},v?R.default.createElement(D.default,null):R.default.createElement(L.default,null))))))}}]),k);function k(){c(this,k);var y=d(this,(k.__proto__||Object.getPrototypeOf(k)).apply(this,arguments));return y.PickerI18n=function(e){return{categories:{recent:e.t("block.poll_emoji_recent"),people:e.t("block.poll_emoji_people"),nature:e.t("block.poll_emoji_nature"),foods:e.t("block.poll_emoji_foods"),activity:e.t("block.poll_emoji_activity"),places:e.t("block.poll_emoji_places"),objects:e.t("block.poll_emoji_objects"),symbols:e.t("block.poll_emoji_symbols"),flags:e.t("block.poll_emoji_flags"),custom:e.t("block.poll_emoji_custom")}}},y.state={isFocusing:!1,pickerVisible:!1,pickerPlacement:h.bottom,isExpanded:!1,emojiContainerWidth:E},y.touchInfo=null,y.pickerRef=null,y.inputRef=null,y.voteRef=null,y.editLogged=!1,y.documentEvent=a.GlobalDOMEventEmitter.get(document),y.scrollContainerEvent=null,y.voteContainerRef=null,y.isMobileAndNotIPadBrowser=function(){var e=y.props.ExternalServices.Helpers.browser;return e.mobile&&(!e.isIPad||e.isBytedanceApp)},y.handleClick=function(l){return function(){var e=y.props,t=e.userId,n=e.optionId,r=e.confirmWithDialog,i=e.votes,o=e.onDeleteOption,a=e.onVoteToggle,s=e.ExternalServices.t;switch(l){case"delOption":0<i.length?r(1===i.length?s("block.poll_confirm_delete_single",i.length):s("block.poll_confirm_delete",i.length),function(){return o(n)}):o(n);break;case"vote":if(!t)break;a(n,t)}}},y.handleOptionInput=function(e){var t=y.props,n=t.optionId,r=t.onEditOption,i=t.ExternalServices,o=i.t;y.logEditEvent();var a=e.target.value;a.includes("\n")&&(a=a.replace(/\n/g,"")),a.length>N.CHAR_LIMIT.option&&(i.Toast.show({key:"voteOption"+n,type:"error",content:o("block.poll_option_exceeded",N.CHAR_LIMIT.option)}),a=a.slice(0,N.CHAR_LIMIT.option)),r(n,a)},y.logEditEvent=function(){var e=y.props,t=e.optionId,n=e.votes,r=e.blockId,i=e.pollType,o=e.ExternalServices;y.editLogged||o.LogService.collectEvent("client_edit_poll_option",{block_id:r,option_id:t,poll_type:i,poll_option_votes:n.length}),y.editLogged=!0},y.handleDocumentClick=function(e){var t=e.currentTarget,n=e.target,r=y.state.pickerVisible,i=y.props,o=i.containerRef,a=i.isRemoteDevice,s=n;if(s){for(y.inputRef&&y.checkFocus(),o&&o.contains(s)||!document.body.contains(s)||y.inputRef&&y.inputRef.blur();s&&s!==t&&s!==y.pickerRef&&s!==y.voteRef;)s=s.parentElement;a&&r&&s!==y.pickerRef&&y.setState({pickerVisible:!1})}},y.updateEmojiContainerWidth=function(){y.voteContainerRef&&y.setState({emojiContainerWidth:y.voteContainerRef.clientWidth||E})},y.handleEmojiSelect=function(o){return function(e){var t=e.id,n=y.props,r=n.userId,i=n.onEmojiChange;y.isMobileAndNotIPadBrowser()&&y.setState({pickerVisible:!1}),i(o,r,t)}},y.handleMobilePicker=function(s){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(e){var t=y.props.optionId,n=l.isVoted,r=l.clickCallback,i=function(e){return function(){y.touchInfo=null,y.setState({pickerVisible:e})}},o=i(!0),a=i(!1);switch(s){case"touchstart":if(!n){y.touchInfo=null;break}y.touchInfo={optionId:t,timeout:window.setTimeout(o,b)};break;case"touchend":if(e&&e.preventDefault(),!n){a(),r(e);break}if(!y.touchInfo||y.touchInfo.optionId!==t)break;window.clearTimeout(y.touchInfo.timeout),a(),r(e)}}},y.transformPlacement=function(e){var t=y.props.isRemoteDevice;return e===h.top?t?"topRight":"top":t?"bottomRight":"bottom"},y.renderVoteAction=function(){var e=y.props,t=e.optionId,n=e.activeStatus,r=e.isVoted,i=e.emojiId,o=e.disabled,a=e.isRemoteDevice,s=e.ExternalServices.VoteEmoji,l=N.preCls+"--vote-action";if(o)return R.default.createElement("div",{className:(0,x.default)(l,l+"__disabled")},R.default.createElement("span",{className:l+"-disable"}));var c=y.state,u=c.pickerVisible,d=c.pickerPlacement,f=(0,N.advancedStatus)(n).isEditting,h=y.isMobileAndNotIPadBrowser()?{visible:!1}:{},p=y.handleClick("vote"),g=Object.assign({},a?{onTouchStart:y.handleMobilePicker("touchstart",{isVoted:r}),onTouchEnd:y.handleMobilePicker("touchend",{isVoted:r,clickCallback:p}),onClick:p}:{onClick:p},{"data-assign-poll-status":N.ActiveStatus.normal});if(f)return null;var v=y.getPopoverContainer(),m=(0,x.default)(l,P({},l+"-voted",r));return R.default.createElement("div",{className:m},R.default.createElement("div",{className:l+"-blank"},R.default.createElement("span",{className:l+"-empty"}),R.default.createElement("span",{className:l+"-hover"})),R.default.createElement("span",{className:l+"-fill"},R.default.createElement(s,{native:!0,emoji:i||A.DEFAULT_EMOJI_ID,size:24})),R.default.createElement(M.Popover,Object.assign({},h,{className:N.preCls+"--popover",content:u&&y.renderPicker(t),adjustOverflow:!1,getContainer:function(){return v},placement:y.transformPlacement(d),destroyAfterClose:!0,animate:!1,disable:!r,onVisibleChange:function(e){y.handlePickerVisible(e)}}),R.default.createElement("div",Object.assign({},g,{className:l+"-mask",ref:function(e){return e&&(y.voteRef=e)}}))))},y.expandVote=function(){var e=y.state.isExpanded;y.setState({isExpanded:!e})},y}t.default=y,g([(0,o.Bind)(),(0,o.Debounce)(300),v("design:type",Function),v("design:paramtypes",[]),v("design:returntype",void 0)],y.prototype,"handleScroll",null)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={mac:["1F1F9-1F1FC"],smartisan:["1F1E6-1F1E8","1F1E9-1F1EC","1F1EE-1F1E8","1F1F9-1F1E6","1F1FD-1F1F0"]},i=Object.keys(r).reduce(function(e,t){return e.concat(r[t])},[]),o=function(e){return!i.includes(e)};t.default=["1F600","1F601","1F602","1F603","1F604","1F605","1F606","1F609","1F60A","1F60B","1F60E","1F60D","1F618","1F617","1F619","1F61A","1F642","1F917","1F914","1F610","1F611","1F636","1F644","1F60F","1F623","1F625","1F62E","1F910","1F62F","1F62A","1F62B","1F634","1F60C","1F61B","1F61C","1F61D","1F612","1F613","1F614","1F615","1F643","1F911","1F632","1F641","1F616","1F61E","1F61F","1F624","1F622","1F62D","1F626","1F627","1F628","1F629","1F62C","1F630","1F631","1F633","1F635","1F621","1F620","1F637","1F912","1F915","1F607","1F913","1F608","1F47F","1F479","1F47A","1F480","1F47B","1F47D","1F47E","1F916","1F4A9","1F63A","1F638","1F639","1F63B","1F63C","1F63D","1F640","1F63F","1F63E","1F648","1F649","1F64A","1F476","1F466","1F467","1F468","1F469","1F474","1F475","1F46E","1F482","1F477","1F478","1F473","1F472","1F471","1F470","1F47C","1F385","1F64D","1F64E","1F645","1F646","1F481","1F64B","1F647","1F486","1F487","1F6B6","1F3C3","1F483","1F46F","1F6C0","1F6CC","1F464","1F465","1F3C7","1F3C2","1F3C4","1F6A3","1F3CA","1F6B4","1F6B5","1F46B","1F46C","1F46D","1F48F","1F491","1F46A","1F4AA","1F448","1F449","1F446","1F595","1F447","1F596","1F918","270B","1F44C","1F44D","1F44E","270A","1F44A","1F44B","1F44F","1F450","1F64C","1F64F","1F485","1F442","1F443","1F463","1F440","1F445","1F444","1F48B","1F498","1F493","1F494","1F495","1F496","1F497","1F499","1F49A","1F49B","1F49C","1F49D","1F49E","1F49F","1F48C","1F4A4","1F4A2","1F4A3","1F4A5","1F4A6","1F4A8","1F4AB","1F4AC","1F4AD","1F453","1F454","1F455","1F456","1F457","1F458","1F459","1F45A","1F45B","1F45C","1F45D","1F392","1F45E","1F45F","1F460","1F461","1F462","1F451","1F452","1F3A9","1F393","1F4FF","1F484","1F48D","1F48E","1F435","1F412","1F436","1F415","1F429","1F43A","1F431","1F408","1F981","1F42F","1F405","1F406","1F434","1F40E","1F984","1F42E","1F402","1F403","1F404","1F437","1F416","1F417","1F43D","1F40F","1F411","1F410","1F42A","1F42B","1F418","1F42D","1F401","1F400","1F439","1F430","1F407","1F43B","1F428","1F43C","1F43E","1F983","1F414","1F413","1F423","1F424","1F425","1F426","1F427","1F438","1F40A","1F422","1F40D","1F432","1F409","1F433","1F40B","1F42C","1F41F","1F420","1F421","1F419","1F41A","1F980","1F40C","1F41B","1F41C","1F41D","1F41E","1F982","1F490","1F338","1F4AE","1F339","1F33A","1F33B","1F33C","1F337","1F331","1F332","1F333","1F334","1F335","1F33E","1F33F","1F340","1F341","1F342","1F343","1F347","1F348","1F349","1F34A","1F34B","1F34C","1F34D","1F34E","1F34F","1F350","1F351","1F352","1F353","1F345","1F346","1F33D","1F344","1F330","1F35E","1F9C0","1F356","1F357","1F354","1F35F","1F355","1F32D","1F32E","1F32F","1F373","1F372","1F37F","1F371","1F358","1F359","1F35A","1F35B","1F35C","1F35D","1F360","1F362","1F363","1F364","1F365","1F361","1F366","1F367","1F368","1F369","1F36A","1F382","1F370","1F36B","1F36C","1F36D","1F36E","1F36F","1F37C","2615","1F375","1F376","1F37E","1F377","1F378","1F379","1F37A","1F37B","1F374","1F52A","1F3FA","1F383","1F384","1F386","1F387","2728","1F388","1F389","1F38A","1F38B","1F38D","1F38E","1F38F","1F390","1F391","1F380","1F381","1F3AB","1F3C6","1F3C5","26BD","26BE","1F3C0","1F3D0","1F3C8","1F3C9","1F3BE","1F3B1","1F3B3","1F3CF","1F3D1","1F3D2","1F3D3","1F3F8","1F3AF","26F3","1F3A3","1F3BD","1F3BF","1F3AE","1F3B2","1F0CF","1F004","1F3B4","1F30D","1F30E","1F30F","1F310","1F5FE","1F30B","1F5FB","1F3E0","1F3E1","1F3E2","1F3E3","1F3E4","1F3E5","1F3E6","1F3E8","1F3E9","1F3EA","1F3EB","1F3EC","1F3ED","1F3EF","1F3F0","1F492","1F5FC","1F5FD","26EA","1F54C","1F54D","1F54B","26F2","26FA","1F301","1F303","1F304","1F305","1F306","1F307","1F309","1F30C","1F3A0","1F3A1","1F3A2","1F488","1F3AA","1F3AD","1F3A8","1F3B0","1F682","1F683","1F684","1F685","1F686","1F687","1F688","1F689","1F68A","1F69D","1F69E","1F68B","1F68C","1F68D","1F68E","1F690","1F691","1F692","1F693","1F694","1F695","1F696","1F697","1F698","1F699","1F69A","1F69B","1F69C","1F6B2","1F68F","26FD","1F6A8","1F6A5","1F6A6","1F6A7","2693","26F5","1F6A4","1F6A2","1F6EB","1F6EC","1F4BA","1F681","1F69F","1F6A0","1F6A1","1F680","1F6AA","1F6BD","1F6BF","1F6C1","231B","23F3","231A","23F0","1F55B","1F567","1F550","1F55C","1F551","1F55D","1F552","1F55E","1F553","1F55F","1F554","1F560","1F555","1F561","1F556","1F562","1F557","1F563","1F558","1F564","1F559","1F565","1F55A","1F566","1F311","1F312","1F313","1F314","1F315","1F316","1F317","1F318","1F319","1F31A","1F31B","1F31C","1F31D","1F31E","2B50","1F31F","1F320","26C5","1F300","1F308","1F302","2614","26A1","26C4","1F525","1F4A7","1F30A","1F507","1F508","1F509","1F50A","1F4E2","1F4E3","1F4EF","1F514","1F515","1F3BC","1F3B5","1F3B6","1F3A4","1F3A7","1F4FB","1F3B7","1F3B8","1F3B9","1F3BA","1F3BB","1F4F1","1F4F2","1F4DE","1F4DF","1F4E0","1F50B","1F50C","1F4BB","1F4BD","1F4BE","1F4BF","1F4C0","1F3A5","1F3AC","1F4FA","1F4F7","1F4F8","1F4F9","1F4FC","1F50D","1F50E","1F52C","1F52D","1F4E1","1F4A1","1F526","1F3EE","1F4D4","1F4D5","1F4D6","1F4D7","1F4D8","1F4D9","1F4DA","1F4D3","1F4D2","1F4C3","1F4DC","1F4C4","1F4F0","1F4D1","1F516","1F4B0","1F4B4","1F4B5","1F4B6","1F4B7","1F4B8","1F4B3","1F4B9","1F4B1","1F4B2","1F4E7","1F4E8","1F4E9","1F4E4","1F4E5","1F4E6","1F4EB","1F4EA","1F4EC","1F4ED","1F4EE","1F4DD","1F4BC","1F4C1","1F4C2","1F4C5","1F4C6","1F4C7","1F4C8","1F4C9","1F4CA","1F4CB","1F4CC","1F4CD","1F4CE","1F4CF","1F4D0","1F512","1F513","1F50F","1F510","1F511","1F528","1F52B","1F3F9","1F527","1F529","1F517","1F489","1F48A","1F6AC","1F5FF","1F52E","1F3E7","1F6AE","1F6B0","267F","1F6B9","1F6BA","1F6BB","1F6BC","1F6BE","1F6C2","1F6C3","1F6C4","1F6C5","1F6B8","26D4","1F6AB","1F6B3","1F6AD","1F6AF","1F6B1","1F6B7","1F4F5","1F51E","1F503","1F504","1F519","1F51A","1F51B","1F51C","1F51D","1F6D0","1F54E","1F52F","2648","2649","264A","264B","264C","264D","264E","264F","2650","2651","2652","2653","26CE","1F500","1F501","1F502","23E9","23EA","1F53C","23EB","1F53D","23EC","1F3A6","1F505","1F506","1F4F6","1F4F3","1F4F4","1F531","1F4DB","1F530","2B55","2705","274C","274E","2795","2796","2797","27B0","27BF","2753","2754","2755","2757","1F51F","1F4AF","1F520","1F521","1F522","1F523","1F524","1F18E","1F191","1F192","1F193","1F194","1F195","1F196","1F197","1F198","1F199","1F19A","1F201","1F236","1F22F","1F250","1F239","1F21A","1F232","1F251","1F238","1F234","1F233","1F23A","1F235","25FD","25FE","2B1B","2B1C","1F536","1F537","1F538","1F539","1F53A","1F53B","1F4A0","1F518","1F532","1F533","26AA","26AB","1F534","1F535"].filter(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"12",height:"12",viewBox:"0 0 12 12",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M7.4 6l4.3 4.3a1 1 0 0 1-1.4 1.42L6 7.42l-4.3 4.3a1 1 0 1 1-1.42-1.41L4.58 6 .28 1.7A1 1 0 0 1 1.69.29L6 4.6 10.3.3a1 1 0 0 1 1.42 1.42L7.4 6z",fillRule:"nonzero"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"14",height:"9",viewBox:"0 0 14 9",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M1.33 1.07a.67.67 0 0 1 .95 0l4.71 4.71 4.71-4.71a.67.67 0 0 1 .95 0l.47.47a.67.67 0 0 1 0 .94L7.46 8.14a.67.67 0 0 1-.94 0L.86 2.48a.67.67 0 0 1 0-.94l.47-.47z"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"14",height:"9",viewBox:"0 0 14 9",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M12.67 7.93a.67.67 0 0 1-.95 0L7.01 3.22 2.3 7.93a.67.67 0 0 1-.95 0l-.47-.47a.67.67 0 0 1 0-.94L6.54.86a.67.67 0 0 1 .94 0l5.66 5.66a.67.67 0 0 1 0 .94l-.47.47z"}))}},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M9.5 9.5V4a.5.5 0 0 1 1 0v5.5H16a.5.5 0 1 1 0 1h-5.5V16a.5.5 0 1 1-1 0v-5.5H4a.5.5 0 1 1 0-1h5.5z",fillRule:"nonzero"}))}},function(e,t,n){},function(e,t){e.exports=o("kHJC")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"268",height:"88",viewBox:"0 0 268 88",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},t),i.default.createElement("defs",null,i.default.createElement("path",{id:"a",d:"M0 0h268v64H0z"})),i.default.createElement("g",{fill:"none",fillRule:"evenodd"},i.default.createElement("g",{transform:"translate(0 24)"},i.default.createElement("mask",{id:"b",fill:"#fff"},i.default.createElement("use",{xlinkHref:"#a"})),i.default.createElement("path",{stroke:"#F1F2F3",mask:"url(#b)",d:"M.5-23.5h267v87H.5z"})),i.default.createElement("path",{fill:"#07F",opacity:".15",d:"M0 0h268v24H0z"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, LarkChineseQuote, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"10",fill:"#07F"},i.default.createElement("tspan",{x:"124",y:"16"},"")),i.default.createElement("g",{transform:"translate(12 32)"},i.default.createElement("path",{fill:"#f8f9fa",d:"M0 0h215v12H0z"}),i.default.createElement("path",{fill:"#eff0f1",d:"M0 0h142v12H0z"}),i.default.createElement("circle",{fill:"#eff0f1",cx:"235.5",cy:"5.5",r:"5.5"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, LarkChineseQuote, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"6",fill:"#8f959e"},i.default.createElement("tspan",{x:"4",y:"8"},"A"))),i.default.createElement("g",{transform:"translate(12 50)"},i.default.createElement("path",{fill:"#f8f9fa",d:"M0 0h215v12H0z"}),i.default.createElement("path",{fill:"#eff0f1",d:"M0 0h39v12H0z"}),i.default.createElement("circle",{fill:"#eff0f1",cx:"235.5",cy:"5.5",r:"5.5"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, LarkChineseQuote, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"6",fill:"#8f959e"},i.default.createElement("tspan",{x:"4",y:"8"},"B"))),i.default.createElement("g",{transform:"translate(12 68)"},i.default.createElement("path",{fill:"#f8f9fa",d:"M0 0h215v12H0z"}),i.default.createElement("path",{fill:"#eff0f1",d:"M0 0h66v12H0z"}),i.default.createElement("circle",{fill:"#eff0f1",cx:"235.5",cy:"5.5",r:"5.5"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, LarkChineseQuote, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"6",fill:"#8f959e"},i.default.createElement("tspan",{x:"4",y:"8"},"C")))))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"268",height:"88",viewBox:"0 0 268 88",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},t),i.default.createElement("defs",null,i.default.createElement("path",{id:"a",d:"M0 0h268v64H0z"})),i.default.createElement("g",{fill:"none",fillRule:"evenodd"},i.default.createElement("path",{fill:"#FFF",fillRule:"nonzero",d:"M0 0h268v88H0z"}),i.default.createElement("g",{transform:"translate(0 24)"},i.default.createElement("mask",{id:"b",fill:"#fff"},i.default.createElement("use",{xlinkHref:"#a"})),i.default.createElement("path",{stroke:"#F1F2F3",mask:"url(#b)",d:"M.5-23.5h267v87H.5z"})),i.default.createElement("path",{fill:"#07F",opacity:".15",d:"M0 0h268v24H0z"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"10",fill:"#07F"},i.default.createElement("tspan",{x:"126",y:"16"},"Poll")),i.default.createElement("g",{transform:"translate(12 32)"},i.default.createElement("path",{fill:"#f8f9fa",d:"M0 0h215v12H0z"}),i.default.createElement("path",{fill:"#eff0f1",d:"M0 0h142v12H0z"}),i.default.createElement("circle",{fill:"#eff0f1",cx:"235.5",cy:"5.5",r:"5.5"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"6",fill:"#8f959e"},i.default.createElement("tspan",{x:"4",y:"8"},"A"))),i.default.createElement("g",{transform:"translate(12 50)"},i.default.createElement("path",{fill:"#f8f9fa",d:"M0 0h215v12H0z"}),i.default.createElement("path",{fill:"#eff0f1",d:"M0 0h39v12H0z"}),i.default.createElement("circle",{fill:"#eff0f1",cx:"235.5",cy:"5.5",r:"5.5"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"6",fill:"#8f959e"},i.default.createElement("tspan",{x:"4",y:"8"},"B"))),i.default.createElement("g",{transform:"translate(12 68)"},i.default.createElement("path",{fill:"#f8f9fa",d:"M0 0h215v12H0z"}),i.default.createElement("path",{fill:"#eff0f1",d:"M0 0h66v12H0z"}),i.default.createElement("circle",{fill:"#eff0f1",cx:"235.5",cy:"5.5",r:"5.5"}),i.default.createElement("text",{fontFamily:"LarkEmojiFont, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"6",fill:"#8f959e"},i.default.createElement("tspan",{x:"4",y:"8"},"C")))))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"496",height:"124",viewBox:"0 0 496 124",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M.5 4A3.5 3.5 0 0 1 4 .5h488a3.5 3.5 0 0 1 3.5 3.5v116a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 120V4z",fill:"#fff",stroke:"#DEE0E3"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M28.17 17.25c-1.32 0-2.36.68-3.17 1.8-.8-1.12-1.85-1.8-3.17-1.8-2.39 0-4.33 2.18-4.33 4.86 0 1.6.7 2.72 1.26 3.62 1.6 2.62 5.5 5.44 5.68 5.57.17.14.36.2.56.2.2 0 .38-.07.55-.2.17-.13 4.07-2.96 5.7-5.57.55-.9 1.25-2.02 1.25-3.62 0-2.67-1.95-4.86-4.33-4.86z",fill:"#F54A45"}),i.default.createElement("path",{d:"M42.28 30.29c.91 0 1.37-.48 1.37-1.4v-3.96c.48-.23.94-.48 1.42-.76v-1.36c-.46.28-.94.53-1.42.79v-2.34h1.49v-1.28h-1.49v-2.45h-1.31v2.45h-1.6v1.28h1.6v2.92c-.62.24-1.26.44-1.9.6l.33 1.35a27.5 27.5 0 0 0 1.57-.6v3.02c0 .34-.18.52-.52.52a9.2 9.2 0 0 1-1.04-.07l.3 1.29h1.2zm3.24-6.89v1.29h.77a6.98 6.98 0 0 0 2.03 3.1c-.97.64-2.16 1.18-3.56 1.6l.73 1.12a12.9 12.9 0 0 0 3.92-1.85c.94.66 2.08 1.26 3.46 1.81l.71-1.15a15.19 15.19 0 0 1-3.2-1.47c.92-.9 1.59-1.97 1.98-3.22V23.4h-6.84zm2 1.29h3.5c-.4.88-1 1.66-1.77 2.36-.82-.7-1.4-1.5-1.73-2.36zm-1.04-6.7v2.04c0 .85-.52 1.5-1.52 1.97l.88 1.02c1.29-.74 1.94-1.79 1.94-3.13v-.65h2.41v1.99c0 .92.5 1.39 1.53 1.39h1.43v-1.24h-1.07c-.39 0-.59-.15-.59-.46V18h-5zm8.26-.02v1.15h4.12v.9h-3.14v3.3h10.56v-3.3h-3.14v-.9h4.12v-1.15H54.74zM61.88 20h-1.76v-.9h1.76v.9zM65 22.24h-1.86V21.1H65v1.14zm-3.12 0h-1.76V21.1h1.76v1.14zm-3.02 0H57V21.1h1.86v1.14zm-2.5 1.89v1.09h9.36v-1.1h-9.35zm-1.4 1.86v1.13h5.55v1.63c0 .35-.18.53-.55.53-.35 0-.71-.03-1.1-.07l.25 1.18h1.29c.92 0 1.4-.47 1.4-1.36v-1.9h5.23v-1.14H54.97zM64 27.4l-.89.84c1.35.73 2.4 1.4 3.14 2.03l.92-.92c-.86-.64-1.91-1.3-3.17-1.95zm-5.72.03c-.9.69-2.03 1.29-3.34 1.8l.8 1.04c1.34-.58 2.49-1.27 3.41-2.05l-.87-.79z",fill:"#fff"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 50c0-1.1.9-2 2-2h424a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V50zM16 86c0-1.1.9-2 2-2h424a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V86zM456 50c0-1.1.9-2 2-2h20a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2h-20a2 2 0 0 1-2-2V50zM456 86c0-1.1.9-2 2-2h20a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2h-20a2 2 0 0 1-2-2V86z",fill:"#EFF0F1"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=n(1),c=d(n(10)),u=n(25),o=d(n(159)),a=n(20),s=n(36);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=(p(v,l.Creator),r(v,[{key:"onBlockInitOnly",value:function(){(0,u.initStyle)()}},{key:"create",value:function(e,t,n){return new o.default(e,t,n,this.ExternalServices)}},{key:"onInternalPaste",value:function(){var e=this.ExternalServices.LogService;e&&e.collectEvent&&e.collectEvent("client_insert_isvblock",{block_type:"isv_jiramaster",create_source:"paste",jira_type:(0,u.getJiraType)(this.ExternalServices)})}},{key:"onPaste",value:function(e){for(var t=e.pasteDataWrapper,n=(0,c.default)(t).find("."+l.BLOCK_CONTAINER),r=new Set,i=0;i<n.length;i++){var o,a=n[i],s=(0,l.getBlockDataSet)(a);!s||s.blockType!==this.blockType||(o=this.ExternalServices.LogService)&&o.collectEvent&&!r.has(s.blockId)&&(r.add(s.blockId),o.collectEvent("client_insert_isvblock",{block_type:"isv_jiramaster",create_source:"paste",jira_type:(0,u.getJiraType)(this.ExternalServices)}))}return e}}],[{key:"getFieldName",value:function(e,t){return(0,s.getFieldName)(e,t)}}]),v);function v(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;f(this,v);var o=h(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=l.BlockType.JIRA_ISSUE_BLOCK,o.defaultProps={viewType:l.ViewTypes.INLINE,displayMode:l.BlockDisplayMode.INLINE},o.ExternalServices=t,o.moduleConfigs=i,o}(t.default=g).JIRA_ID=a.JIRA_ID},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=T(n(19)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=T(n(5)),c=n(12),u=n(0),d=T(u),f=n(1),h=n(3),p=n(16),g=T(n(7)),v=T(n(160)),m=T(n(170)),y=n(74),b=n(13),E=n(25),k=T(n(174)),C=T(n(175)),I=n(2);n(73);var S=T(n(72));function T(e){return e&&e.__esModule?e:{default:e}}function O(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function M(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var N,A,_,L=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},D=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},B=(M(P,f.Block),i(P,[{key:"getNotifyWidth",value:function(){return this.isInHistoryMode()?this.mountPoint.offsetWidth:0}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"handleEventBinding",value:function(e){this.editor&&(this.editor[e]("fullscreenEntered",this.handleFullscreenOptionChange),this.editor[e]("fullscreenModeChanged",this.handleFullscreenOptionChange))}},{key:"handleFullscreenOptionChange",value:function(e){this.getFullScreenSize=e.size}},{key:"resetToolBar",value:function(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f.ViewTypes.INLINE,n=[],r=(0,E.isEditable)(this.context.permissions||null,this.ExternalServices);this.getIsDelete()||(e===f.ViewTypes.CARD?(n=n.concat([this.getJiraLinkToolbarBtn(e),f.CommonCommandKey.separator]),r&&(n=n.concat([this.getJiraFieldConfigurePopoverToolbarBtn(),f.CommonCommandKey.separator]))):e===f.ViewTypes.INLINE&&(n=n.concat([this.getJiraSyncToolbarBtn(),f.CommonCommandKey.separator,this.getJiraLinkToolbarBtn(e),f.CommonCommandKey.separator])),e===f.ViewTypes.CARD&&(n=n.concat([Object.assign(this.getToolbarButtonFor(f.ViewTypes.INLINE,this.viewTypeSwitch),{active:!1}),Object.assign(this.getToolbarButtonFor(f.ViewTypes.CARD,this.viewTypeSwitch),{active:e===f.ViewTypes.CARD}),f.CommonCommandKey.separator]))),n=n.concat([f.CommonCommandKey.comment]),this.editbarCommands=n,toolbar&&this.context&&this.context.updateEditbar&&(t=this.context.getCommandByKey,n=n.map(function(e){return t&&(0,f.isCommonCommandKey)(e)?t(e):e}),this.editbarCommands=n,this.context.updateEditbar(n,this))}},{key:"getJiraLinkToolbarBtn",value:function(i){var o=this;return{key:"jira",Icon:function(){return d.default.createElement(y.JiraIconGrayWithHoverBg,null)},handler:function(){var e=o.getLinkUrl(),t=o.ExternalServices,n=t.LogService,r=t.Helpers;e&&(0,h.openUrl)(e,r),n&&n.collectEvent("click_openorigin_link",{link_type:"jira",source:"editorbar",view_status:i,jira_type:(0,E.getJiraType)(o.ExternalServices),open_with_app:"false"})},tooltip:this.ExternalServices.t("doc.jira.open_in_jira_platform")}}},{key:"getJiraFieldConfigurePopoverToolbarBtn",value:function(){var r=this;return{key:"jira-field-configure",Icon:function(){var e=r.ExternalServices.components;if(!e)return null;var t=e.JiraFieldConfigurePopover,n=Object.values(r.getIssueRecordMap()||{}).sort(function(e,t){return e.sort-t.sort});return d.default.createElement(t,{configureItems:n,onChange:r.setIssueRecordVisible})},handler:function(){}}}},{key:"getJiraSyncToolbarBtn",value:function(){var r=this;return{key:"sync",Icon:function(){var e=r.ExternalServices.components;if(!e)return null;var t=e.SyncBtn,n=r.getLastSyncTime();return d.default.createElement(t,{lastSyncTime:n,blockToken:r.getToken(),syncJira:r.syncJiraIssue})},handler:function(){}}}},{key:"getAuthStatus",value:function(e){var t=this.ExternalServices.Redux;if(t&&e){var n=t.selectors;if(n){var r=n.selectJiraAuthStatus;return r&&r(e)}}}},{key:"syncJiraIssue",value:function(e){var t,n,r,i,o=this.ExternalServices.Redux,a=this.getToken();a&&o&&(t=o.store,n=o.actions,t&&n&&(r=n.syncJira,i=this.getAuthStatus(t.getState()),r&&i&&t.dispatch(r({type:b.Type.Issue,blockToken:a,teaSource:e,visibleFieldIds:"",authState:i.authState,baseUrl:i.baseUrl}))))}},{key:"viewTypeSwitch",value:function(e){var t,n,r=this.ExternalServices;r.LogService&&r.LogService.collectEvent&&(w(t={},f.ViewTypes.CARD,"switchto_card"),w(t,f.ViewTypes.INLINE,"switchto_inline"),n=t[e],r.LogService.collectEvent("toggle_attribute",{action:n,view_status:this.currentViewType,source:"editorbar",block_type:"isv_jiramaster"})),this.currentViewType=e,this.resetToolBar(e)}},{key:"collectText",value:function(){return"["+this.plainText+"]"}},{key:"blockDidMount",value:function(){this.handleEventBinding("on")}},{key:"blockDidCreate",value:function(){}},{key:"resize",value:function(e,t){var n=this.getFullScreenSize&&this.getFullScreenSize(),r=this.context.presentationMode===f.PresentationMode.PAGED;this.size={width:e,height:r&&n?n.height:t},this.isPresentation&&this.nextRender({stage:f.RenderStage.update,source:f.RenderSource.doc}),this.jiraIssueRef&&this.jiraIssueRef.wrappedInstance&&this.jiraIssueRef.wrappedInstance.setSize(this.size)}},{key:"unmount",value:function(e){a(P.prototype.__proto__||Object.getPrototypeOf(P.prototype),"unmount",this).call(this,e),this.handleEventBinding("off"),s.default.unmountComponentAtNode(this.mountPoint),this.manager&&this.manager.destructor(),this.manager=null,this.heightUpdateNotifier.destroy(),this.jiraIssueRef=null,this.editbarCommands=[],this.ExternalServices={},this.size=null,this.editor=null,this.dataset=null}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=this.manager,i=r?r.getRecord():(0,E.getDefaultJiraIssueRecord)();Object.keys(i.issueRecordMap).forEach(function(e){i.issueRecordMap[e].visible||delete i.issueRecordMap[e]});var o=(0,f.generateBlockDataSet)({blockType:t,props:n,initData:i}),a=this.ExternalServices.t("block.common_paste_unsupported");return{html:(0,f.generateBlockHTML)(o,a),text:a}}},{key:"onSearch",value:function(e){var t,n,r=this,i=e.searchKey.toLowerCase(),o=this.getIssueKey(),a=this.getIssueRecordMap(),s=[],l=function(t,e){var n;!e||(n=(0,f.searchString)(e.toLowerCase(),i).map(function(e){return Object.assign({},e,{type:t,isReplaceable:!1,blockId:r.blockId})})).length&&(s=[].concat(O(s),O(n)))};return o&&l("issueKey",o),a&&(t=void 0,n="summary",this.currIsDelete||this.currentViewType!==f.ViewTypes.INLINE||(t=a[n].value),l(n,t)),s}},{key:"onHighlight",value:function(e,t){var n=e.key,r=e.matches,i=this.ExternalServices.EventEmitter;i&&i.emit("jira:highlightResult",{searchResult:r,selectedKey:n,isSelected:t})}},{key:"onCancelSearch",value:function(){var e=this.ExternalServices.EventEmitter;e&&e.emit("jira:clearSearchResult",[])}},{key:"shouldPreventCopy",value:function(){if(!document.activeElement)return!1;var e=document.activeElement,t=e.tagName,n=e.contentEditable;return"INPUT"===t.toLocaleUpperCase()||"true"===n}},{key:"setIssueRecordVisible",value:function(e,t){var n=this.manager;return n&&n.setIssueRecordVisible(e,t)}},{key:"getIssueKey",value:function(){var e=this.manager;return e?e.getRecord("issueKey"):null}},{key:"getLinkUrl",value:function(){var e=this.manager;return e?e.getRecord("linkUrl"):null}},{key:"getLastSyncTime",value:function(){var e=this.manager;return e?e.getRecord("lastSyncTime"):null}},{key:"getIssueRecordMap",value:function(){var e=this.manager;return e?(0,E.filterRecord)(e.getRecord("issueRecordMap")):null}},{key:"getIsDelete",value:function(){var e=this.manager;return e?e.getRecord("isDelete"):null}},{key:"setBlockInline",value:function(){this.props.viewType===f.ViewTypes.CARD&&this.setProps({viewType:f.ViewTypes.INLINE,displayMode:f.BlockDisplayMode.INLINE})}},{key:"updateToolbar",value:function(){var e=this.props.viewType;e&&this.currentViewType!==e?(this.heightUpdateNotifier.notifyWillUpdate(),this.viewTypeSwitch(e)):this.resetToolBar(e)}},{key:"getJiraIssueRef",value:function(e){this.jiraIssueRef=e}},{key:"renderJiraIssue",value:function(e){var t=this.ExternalServices.Redux;return t?d.default.createElement(c.Provider,{store:t.store},d.default.createElement(v.default,Object.assign({},e,{ref:this.getJiraIssueRef,permissions:this.context.permissions||null,isPresentation:this.isPresentation,size:this.size,selected:this.attributes.selected,updateBlock:this.render,blockId:this.blockId,viewType:this.props.viewType||f.ViewTypes.INLINE,blockToken:this.getToken(),ExternalServices:this.ExternalServices,onRendered:this.handleOnRendered}))):null}},{key:"getDeletedBlockToolbar",value:function(e){var t=e.isDelete;this.currIsDelete!==t&&(this.resetToolBar(this.currentViewType),(this.currIsDelete=t)&&this.setBlockInline())}},{key:"getJiraIssue",value:function(){if(this.getToken()){this.manager||(this.manager=new m.default(this));var e=(0,r.default)(this.manager.getRecord());if(e&&e.jiraIssueId)return this.getDeletedBlockToolbar(e),this.renderJiraIssue(e)}return this.initData?this.renderJiraIssue(this.initData):d.default.createElement(S.default,null)}},{key:"handleOnRendered",value:function(){this.renderResolves.forEach(function(e){return e()}),this.renderResolves=[]}},{key:"render",value:function(){var n=this;if(!this.isInHistoryMode())return this.updateToolbar(),new Promise(function(e){var t=n.getJiraIssue();if(!t)return e();n.isShortcut&&n.renderResolves.push(e),s.default.render(d.default.createElement(p.NotifyHeightUpdateOnMount,{notifier:n.heightUpdateNotifier},(0,u.cloneElement)(t)),n.mountPoint,function(){n.isShortcut||e(),n.heightUpdateNotifier.notifyDidUpdate()})});s.default.render(this.getHistoryView(),this.mountPoint)}},{key:"getHistoryView",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e,n=this.props.viewType;return t.historyMode===I.HISTORY_MODE.PLACEHOLDER?d.default.createElement("div",{className:"jira-issue-placeholder"},d.default.createElement(k.default,{className:"history-icon"})):n===f.ViewTypes.INLINE?d.default.createElement("div",{className:"jira-issue-placeholder-inline"},d.default.createElement("span",{className:"history-block-name"},this.plainText)):d.default.createElement("div",{className:"jira-issue-placeholder"},d.default.createElement(C.default,{className:"history-icon"}),d.default.createElement("span",{className:"history-block-name"},this.plainText))}},{key:"isShortcut",get:function(){var e=this.ExternalServices.Utils;return e&&e.isShortCut&&e.isShortCut()}},{key:"initData",get:function(){var e=this.dataset;if(e&&e.initData){var t=unescape(e.initData);if((0,h.isJsonString)(t))return JSON.parse(t)}return null}},{key:"isPresentation",get:function(){var e=this.context.presentationMode!==f.PresentationMode.NONE;return this.jiraIssueRef&&this.jiraIssueRef.wrappedInstance&&this.jiraIssueRef.wrappedInstance.setIsPresentation(e),e}}]),P);function P(e,t,n,r){R(this,P);var i=x(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,e,t));return i.editbarTrigger=f.Trigger.hover,i.editbarCommands=[],i.heightUpdateNotifier=new g.default({getContext:function(){return i.context},getBlockId:function(){return i.blockId}}),i.manager=null,i.jiraIssueRef=null,i.currIsDelete=null,i.getFullScreenSize=null,i.plainText="",i.renderResolves=[],i.dataset=t,i.editor=n,i.ExternalServices=r,i.currentViewType=i.props.viewType||f.ViewTypes.INLINE,i.plainText=i.ExternalServices.t("doc.jira.jira_issue"),i}t.default=B,L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",["function"==typeof(N=void 0!==b.FullscreenOptions&&b.FullscreenOptions)?N:Object]),D("design:returntype",void 0)],B.prototype,"handleFullscreenOptionChange",null),L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",["function"==typeof(A=void 0!==f.ViewTypes&&f.ViewTypes)?A:Object]),D("design:returntype",void 0)],B.prototype,"resetToolBar",null),L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",[String]),D("design:returntype",void 0)],B.prototype,"syncJiraIssue",null),L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",["function"==typeof(_=void 0!==f.ViewTypes&&f.ViewTypes)?_:Object]),D("design:returntype",void 0)],B.prototype,"viewTypeSwitch",null),L([(0,f.Debounce)(150),D("design:type",Function),D("design:paramtypes",[Number,Number]),D("design:returntype",void 0)],B.prototype,"resize",null),L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",[String,Boolean]),D("design:returntype",void 0)],B.prototype,"setIssueRecordVisible",null),L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",[Object]),D("design:returntype",void 0)],B.prototype,"getJiraIssueRef",null),L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",void 0)],B.prototype,"handleOnRendered",null),L([(0,f.Bind)(),D("design:type",Function),D("design:paramtypes",[]),D("design:returntype",void 0)],B.prototype,"render",null)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=d(n(8)),E=d(n(71)),s=d(n(19)),v=d(n(23)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(12),a=n(0),k=d(a),c=d(n(15)),C=n(1),m=n(36),I=d(n(161)),S=d(n(167)),T=n(25),u=n(2),y=n(13);function d(e){return e&&e.__esModule?e:{default:e}}function f(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function h(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function w(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(73);var R,x,M,N,A=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},_=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},L=2,D=12e4,B=(w(P,a.Component),r(P,[{key:"componentDidMount",value:function(){var e=this.props.reduxState,t=this.getAuthStatus(e);this.resetRecordMap(),t&&t.authState===y.AuthState.HAS_CONNECTED&&this.getFieldEditableByIssueId(),this.event("on"),this.triggerOnRendered()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props,r=n.issueRecordMap,i=n.reduxState,o=n.linkUrl,a=n.lastSyncTime,s=e.issueRecordMap,l=e.reduxState,c=this.getAuthStatus(l),u=this.getAuthStatus(i);!this.hasSyncJira&&u&&![y.AuthState.HAS_NOT_FETCH,y.AuthState.FETCH_FAIL].includes(u.authState)&&(0,m.checkIfNeedSync)(a)&&this.syncJiraIssue("open_doc"),c&&u&&c.authState!==y.AuthState.HAS_CONNECTED&&u.authState===y.AuthState.HAS_CONNECTED&&this.getFieldEditableByIssueId();var d=!(0,v.default)(r,s),f=!(0,v.default)(t.fieldsEditableMap,this.state.fieldsEditableMap);(d||f)&&this.resetRecordMap();var h=(0,g.default)(e.initDataMap[o],"issueRecordMap.status"),p=(0,g.default)(this.props.initDataMap[o],"issueRecordMap.status");!p||h&&this.state.status||this.resetStatus(p),this.triggerOnRendered()}},{key:"componentWillUnmount",value:function(){var t=this;this.event("off"),Object.keys(this.timerMap).forEach(function(e){clearTimeout(t.timerMap[e]),delete t.timerMap[e]}),this.timerMap=Object.create(null)}},{key:"setSize",value:function(e){this.setState({size:e})}},{key:"setIsPresentation",value:function(e){e!==this.state.isPresentation&&this.setState({isPresentation:e})}},{key:"triggerOnRendered",value:function(){var e=this.props,t=e.viewType;(e.isDelete||t!==C.ViewTypes.INLINE||this.state.status)&&this.props.onRendered()}},{key:"event",value:function(e){var t=this.props.ExternalServices.EventEmitter;t&&(t[e]("jira:highlightResult",this.updateSearchResult),t[e]("jira:clearSearchResult",this.clearSearchResult))}},{key:"updateSearchResult",value:function(e){var t=e.searchResult,n=e.selectedKey,r=e.isSelected;void 0!==r?this.setState({searchResult:t,selectedKey:n,isSelected:r}):this.setState({searchResult:t})}},{key:"clearSearchResult",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.setState(function(){return{searchResult:e}})}},{key:"resetRecordMap",value:function(){var e,t=this.state,n=t.fieldsEditableMap,r=t.recordMap,i=(0,T.filterRecord)((0,s.default)(this.props.issueRecordMap));if(n!=={}){for(var o in n)n.hasOwnProperty(o)&&i[o]&&(i[o].editable=n[o]);for(var a in r)r.hasOwnProperty(a)&&(e=r[a].reEditValue,i[a]&&e&&(i[a].reEditValue=e))}this.setState({recordMap:i}),this.resetStatus()}},{key:"setRecordValue",value:function(e,t){var n=this.state.recordMap,r=n[e];r&&t!==r.value&&this.setState({recordMap:Object.assign({},n,b({},e,Object.assign({},r,{value:t})))})}},{key:"setRecordReEditValue",value:function(e,t){var n=this.state.recordMap,r=n[e];r&&t!==r.reEditValue&&this.setState({recordMap:Object.assign({},n,b({},e,Object.assign({},r,{reEditValue:t})))})}},{key:"setClearRecordReEditValueTimer",value:function(e){var t=this;this.timerMap[e]&&clearTimeout(this.timerMap[e]),this.timerMap[e]=setTimeout(function(){t.clearRecordReEditValue(e),delete t.timerMap[e]},D)}},{key:"setRecordSelectOption",value:(N=h(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.state.recordMap,i=r[t]){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.setState({recordMap:Object.assign({},r,b({},t,(0,T.insertSelectOption)(i,n)))});case 6:case"end":return e.stop()}},e,this)})),z)},{key:"revertRecordValue",value:function(e){var t=this.props.issueRecordMap[e].value;this.setRecordValue(e,t)}},{key:"getSyncStatus",value:function(e){var t=this.props,n=t.blockToken,r=t.ExternalServices.Redux;if(n&&r&&e&&r.selectors)return(0,r.selectors.selectJiraSyncStatus)(e)[n]}},{key:"getAuthStatus",value:function(e){var t=this.props.ExternalServices.Redux;if(t&&e&&t.selectors){var n=t.selectors.selectJiraAuthStatus;return n&&n(e)}}},{key:"syncJiraIssue",value:function(e){var t,n=this.props,r=n.isDelete,i=n.blockToken,o=n.ExternalServices.Redux,a=n.reduxState,s=this.getSyncStatus(a),l=this.getAuthStatus(a);!r&&i&&o&&o.store&&o.actions&&s!==L&&l&&((t=o.actions.syncJira)&&(o.store.dispatch(t({type:y.Type.Issue,blockToken:i,visibleFieldIds:"",teaSource:e,authState:l.authState,baseUrl:l.baseUrl})),this.hasSyncJira=!0))}},{key:"logEdit",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=this.props,i=r.ExternalServices,o=r.viewType,a=i.LogService;a&&a.collectEvent("client_edit_cardfield",Object.assign({block_type:"isv_jiramaster",field_name:e,view_status:o,edit_status:t},n))}},{key:"showEditErrorToast",value:function(e,t){var n,r,i=this.props,o=i.ExternalServices,a=i.issueKey,s=o.Toast,l=o.t,c=o.Helpers;s&&l&&c&&(n="en"===c.getLanguage(),r={95007:l("doc.jira.edit_fail_no_field",a,e),95012:n?""+l("doc.jira.edit_need_connect")+l("doc.jira.connect"):""+l("doc.jira.connect")+l("doc.jira.edit_need_connect")}[t]||l("doc.jira.edit_fail_check_internet",a,e),s.show({key:"edit-jira-error",type:"error",content:r}))}},{key:"onIssueRecordValueChange",value:function(a,e){var t,s,n,r,l,c=this,i=this.props,o=i.ExternalServices,u=o.Redux,d=o.request,f=o.t,h=i.blockToken,p=i.jiraIssueId,g=i.updateBlock;u&&h&&(t=u.actions,s=u.store,n=t.fakeSyncJiraStart,r=t.fakeSyncJiraSuccess,l=t.fakeSyncJiraEnd,this.setRecordValue(a,e),n&&s.dispatch(n(h)),d&&d.post("/api/doc.v2/jira/edit/",{issueID:p,blockToken:h,params:JSON.stringify(b({},a,e))}).then(function(){r&&s.dispatch(r(h)),c.logEdit(a,"success"),c.clearRecordReEditValue(a)}).catch(function(e){var t=e.code,n=e.msg;g();var r=c.state.recordMap[a],i=r.value,o=r.name;f&&c.showEditErrorToast((0,m.getFieldName)(f,a)||o,t),c.setRecordReEditValue(a,i),c.revertRecordValue(a),c.setClearRecordReEditValueTimer(a),l&&s.dispatch(l(h)),c.logEdit(a,"fail",{responseCode:t,responseMsg:n})}))}},{key:"onSelectOptionsCreate",value:(M=h(regeneratorRuntime.mark(function e(t,n){var r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setRecordSelectOption(t,n);case 2:r=this.state.recordMap[t],i=r.value,i=r.fieldType===y.FieldType.MultiSelect?[].concat(f(i),[n]):n,this.onIssueRecordValueChange(t,i);case 6:case"end":return e.stop()}},e,this)})),j)},{key:"getFieldEditableByIssueId",value:(x=h(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,n=t.ExternalServices.request,r=t.jiraIssueId,t.isDelete||!n)return e.abrupt("return");e.next=3;break;case 3:return e.next=5,n.get("/api/doc.v2/jira/fields_editable/",{params:{issueID:r}});case 5:i=e.sent,o=i.data,a=o.fieldsEditable,this.setState({fieldsEditableMap:a});case 9:case"end":return e.stop()}},e,this)})),F)},{key:"renderHighlight",value:function(e,t){var n=this.state,r=n.searchResult,i=n.selectedKey,o=n.isSelected;return k.default.createElement(c.default,{bgColor:u.MATCHED_BACKGROUND_COLOR,activeBgColor:u.SELECTED_BACKGROUND_COLOR,activeKey:i,isSelected:o,context:r.filter(function(e){return e.type===t})},e)}},{key:"resetStatus",value:function(e){var t=this.state.recordMap,n=this.props.issueRecordMap,r="status",i=e||t[r]||n[r],o=this.getStatusFromRecordMap(i);o&&this.setState({status:o})}},{key:"getStatusFromRecordMap",value:function(t){if(t&&t.property&&t.property.options&&t.property.options.selectOptions){var e=t.property.options.selectOptions.find(function(e){return e.id===t.value});if(e&&e.name)return e.name}return""}},{key:"render",value:function(){var e=this.props,t=e.viewType,n=e.isDelete,r=e.ExternalServices,i=e.linkUrl,o=e.issueKey,a=e.lastSyncTime,s=e.permissions,l=e.selected,c=e.blockToken,u=e.jiraIssueId,d=e.blockId,f=e.issueRecordMap,h=this.state,p=h.size,g=h.isPresentation,v=h.recordMap,m=h.status,y=r.components;if(n)return k.default.createElement(S.default,{selected:l,issueKey:o,linkUrl:i,ExternalServices:r,renderHighlight:this.renderHighlight});if(t===C.ViewTypes.INLINE)return k.default.createElement(I.default,{selected:l,linkUrl:i,typeIconUrl:this.typeIconUrl,issueKey:o,summary:this.summaryValue,status:m,ExternalServices:r,renderHighlight:this.renderHighlight});if(y){var b=y.JiraIssueCard;return b?k.default.createElement(b,{size:p,blockId:d,selected:l,jiraIssueId:u,blockToken:c,editable:(0,T.isEditable)(s,r),linkUrl:i,typeIconUrl:this.typeIconUrl,issueKey:o,lastSyncTime:a,recordMap:(0,E.default)(v)?(0,T.filterRecord)(f):v,isPresentation:g,syncJira:this.syncJiraIssue,onIssueRecordValueChange:this.onIssueRecordValueChange,onClearRecordReEditValue:this.clearRecordReEditValue,onSelectOptionsCreate:this.onSelectOptionsCreate,renderHighlight:this.renderHighlight}):null}return null}},{key:"typeIconUrl",get:function(){var e=this.props,t=e.typeIconBase64,n=e.typeIconUrl;return t||n}},{key:"summaryValue",get:function(){var e=this.state.recordMap,t=this.props.issueRecordMap,n="summary";return e[n]?e[n].value:t[n]?t[n].value:""}}]),P);function P(){p(this,P);var t=O(this,(P.__proto__||Object.getPrototypeOf(P)).apply(this,arguments));return t.timerMap=Object.create(null),t.hasSyncJira=!1,t.state={size:t.props.size,isPresentation:t.props.isPresentation,recordMap:{},fieldsEditableMap:{},searchResult:[],selectedKey:"",isSelected:!1,status:t.getStatusFromRecordMap(t.props.issueRecordMap.status)},t.clearRecordReEditValue=function(e){t.setRecordReEditValue(e,void 0)},t}function F(){return x.apply(this,arguments)}function j(e,t){return M.apply(this,arguments)}function z(e,t){return N.apply(this,arguments)}A([(0,C.Bind)(),_("design:type",Function),_("design:paramtypes",[Object]),_("design:returntype",void 0)],B.prototype,"updateSearchResult",null),A([(0,C.Bind)(),_("design:type",Function),_("design:paramtypes",[Object]),_("design:returntype",void 0)],B.prototype,"clearSearchResult",null),A([(0,C.Debounce)(150),_("design:type",Function),_("design:paramtypes",[]),_("design:returntype",void 0)],B.prototype,"resetRecordMap",null),A([(0,C.Bind)(),_("design:type",Function),_("design:paramtypes",[String]),_("design:returntype",void 0)],B.prototype,"syncJiraIssue",null),A([(0,C.Bind)(),_("design:type",Function),_("design:paramtypes",[String,"function"==typeof(R=void 0!==y.RecordValue&&y.RecordValue)?R:Object]),_("design:returntype",void 0)],B.prototype,"onIssueRecordValueChange",null),A([(0,C.Bind)(),_("design:type",Function),_("design:paramtypes",[String,String]),_("design:returntype",Promise)],B.prototype,"onSelectOptionsCreate",null),A([(0,C.Bind)(),_("design:type",Function),_("design:paramtypes",[String,String]),_("design:returntype",void 0)],B.prototype,"renderHighlight",null),B=A([(0,o.connect)(function(e){return{reduxState:e,initDataMap:(0,g.default)(e,"doc.jira.initDataMap")||{}}},{},null,{withRef:!0})],B),t.default=B},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(162));function i(e){return e&&e.__esModule?e:{default:e}}t.default=r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=h(n(0)),o=n(1),u=h(n(4)),a=n(25);n(163);var s=n(3),d=h(n(164)),f=h(n(72));function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},y=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=(v(E,c.default.Component),r(E,[{key:"UNSAFE_componentWillMount",value:function(){this.setTypeIconUrl()}},{key:"componentWillUnmount",value:function(){this.clearTimer()}},{key:"clearTimer",value:function(){this.timer&&clearTimeout(this.timer),this.timer=null}},{key:"setTypeIconUrl",value:function(){var e=this,t=this.props.typeIconUrl;this.timer=setTimeout(function(){e.timer=null,e.setState({typeIconUrl:d.default})},5e3);var n=document.createElement("img");n.onload=function(){e.clearTimer(),e.state.typeIconUrl!==t&&e.setState({typeIconUrl:t})},n.src=t}},{key:"handleClick",value:function(){var e=this.props,t=e.ExternalServices,n=e.linkUrl,r=t.Helpers;r&&(r.browser.mobile?(window.location.href=n,this.log(!0)):((0,s.openUrl)(n,r),this.log(!1)))}},{key:"log",value:function(e){var t=this.props.ExternalServices,n=t.LogService;n&&n.collectEvent("click_openorigin_link",{link_type:"jira",source:"block",view_status:"inline",jira_type:(0,a.getJiraType)(t),open_with_app:e?"true":"false"})}},{key:"render",value:function(){var e=this.props,t=e.issueKey,n=e.summary,r=e.status,i=e.selected,o=e.renderHighlight,a=this.state.typeIconUrl,s=(0,u.default)("jira-issue--inline",{"is-selected":i});return r?c.default.createElement("div",{className:s,onClick:this.handleClick},c.default.createElement("img",{className:"jira-issue-type-icon",src:a}),c.default.createElement("span",{className:"jira-issue-key"},o(t,"issueKey")),c.default.createElement("span",{className:"jira-issue-summary"},o(n,"summary")),c.default.createElement("span",{className:"jira-issue-status"},r)):c.default.createElement(f.default,null)}}]),E);function E(e){p(this,E);var t=g(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e));return t.timer=null,t.state={typeIconUrl:e.typeIconUrl},t}t.default=b,m([(0,o.Bind)(),y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",void 0)],b.prototype,"handleClick",null)},function(e,t,n){},function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMThweCIgaGVpZ2h0PSIxOHB4IiB2aWV3Qm94PSIwIDAgMTggMTgiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8ZGVmcz4KICAgICAgICA8cmVjdCBpZD0icGF0aC0xIiB4PSIwIiB5PSIwIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIj48L3JlY3Q+CiAgICA8L2RlZnM+CiAgICA8ZyBpZD0iamlyYS3pu5jorqTlm77moIciIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnPgogICAgICAgICAgICA8bWFzayBpZD0ibWFzay0yIiBmaWxsPSJ3aGl0ZSI+CiAgICAgICAgICAgICAgICA8dXNlIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgICAgICAgICA8L21hc2s+CiAgICAgICAgICAgIDx1c2UgaWQ9Ik1hc2siIGZpbGw9IiNERUUwRTMiIHhsaW5rOmhyZWY9IiNwYXRoLTEiPjwvdXNlPgogICAgICAgICAgICA8ZyBpZD0iamlyYS0xIiBtYXNrPSJ1cmwoI21hc2stMikiIGZpbGw9IiM4Rjk1OUUiIGZpbGwtcnVsZT0ibm9uemVybyI+CiAgICAgICAgICAgICAgICA8ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyLjAwMDAwMCwgNC4wMDAwMDApIiBpZD0iUGF0aCI+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExLjUyMzIyOSwwLjA2MjE3NTU0MDYgTDYuMDI3MzA5NDgsMC4wNjIxNzU1NDA2IEM2LjAyNzMwOTQ4LDEuNDMyMzYyOTcgNy4xMzgwNjU4NiwyLjU0MzExOTM1IDguNTA4MjUzMjksMi41NDMxMTkzNSBMOS41MjA2NjUzOSwyLjU0MzExOTM1IEw5LjUyMDY2NTM5LDMuNTIwNjIwNjkgQzkuNTIxNTU5MzksNC44ODk1NjA2MyAxMC42MzEwNjAxLDUuOTk5MTA2IDEyLDYgTDEyLDAuNTM4OTQ2NTg4IEMxMiwwLjI3NTcwNzgyIDExLjc4NjYwMTgsMC4wNjIxNzU1NDA2IDExLjUyMzIyOSwwLjA2MjE3NTU0MDYgWiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0zLjMwNzk4MDE0LDIuODAwNTkxODEgQzMuMzA4ODI5NDQsNC4xNjk1MzE3NCA0LjQxODMzMDEyLDUuMjc5MDc3MTIgNS43ODczMTQ3NSw1LjI3OTk3MTEyIEw2Ljc5OTcyNjg1LDUuMjc5OTcxMTIgTDYuNzk5NzI2ODUsNi4yNjA2MDE0NiBDNi44MDE0NzAxNiw3LjYyOTU0MTQgNy45MTE3MzA3Myw4LjczODMyNjg3IDkuMjgwNjcwNjYsOC43MzgzMjY4NyBMOS4yODA2NzA2NiwzLjI3NzQ1MjI2IEM5LjI4MDY3MDY2LDMuMDE0MTI0MDkgOS4wNjcxODMwOCwyLjgwMDU5MTgxIDguODAzODU0OTIsMi44MDA1OTE4MSBMMy4zMDc5ODAxNCwyLjgwMDU5MTgxIFoiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNi4wODI5MTYzOCw1LjUzNzQ0MzU4IEwwLjU4Njk5NjkwNCw1LjUzNzQ0MzU4IEMwLjU4Njk5NjkwNCw2LjkwNzYzNTExIDEuNjk3NzkzODgsOC4wMTgzODczOSAzLjA2Nzk0MDcyLDguMDE4Mzg3MzkgTDQuMDgzNTI2NTIsOC4wMTgzODczOSBMNC4wODM1MjY1Miw4Ljk5NTg0NDAzIEM0LjA4NDQyMDUyLDEwLjM2MzUzMjQgNS4xOTE5OTkwOSwxMS40NzI1ODYgNi41NTk3MzIxMywxMS40NzUxNzg2IEw2LjU1OTczMjEzLDYuMDE0MjU5MzMgQzYuNTU5NzMyMTMsNS43NTA5MzExNiA2LjM0NjI0NDU1LDUuNTM3NDQzNTggNi4wODI5MTYzOCw1LjUzNzQ0MzU4IFoiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+Cg=="},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var r=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}function o(){return r.default.createElement("div",{className:"inline-mode"},r.default.createElement("span",{className:"block-inline-placeholder"}),r.default.createElement("span",{className:"block-inline-placeholder-expand"}))}n(166)},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(168));function i(e){return e&&e.__esModule?e:{default:e}}t.default=r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=d(n(0)),o=n(1),s=d(n(4)),c=n(25);n(169);var u=n(3);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},v=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=(p(y,a.default.Component),r(y,[{key:"handleClick",value:function(){var e=this.props,t=e.ExternalServices,n=e.linkUrl,r=t.Helpers;r&&(r.browser.mobile?(window.location.href=n,this.log(!0)):((0,u.openUrl)(n,r),this.log(!1)))}},{key:"log",value:function(e){var t=this.props.ExternalServices,n=t.LogService;n&&n.collectEvent("click_openorigin_link",{link_type:"jira",source:"block",view_status:"inline",jira_type:(0,c.getJiraType)(t),open_with_app:e?"true":"false"})}},{key:"render",value:function(){var e=this.props,t=e.ExternalServices,n=e.selected,r=e.issueKey,i=e.renderHighlight,o=(0,s.default)("jira-issue--deleted",{"is-selected":n});return a.default.createElement("div",{className:o,onClick:this.handleClick},a.default.createElement("span",{className:"jira-issue-key"},i(r,"issueKey")),a.default.createElement("span",{className:"jira-issue-tip"},t.t("doc.jira.is_deleted")))}}]),y);function y(){return f(this,y),h(this,(y.__proto__||Object.getPrototypeOf(y)).apply(this,arguments))}t.default=m,g([(0,o.Bind)(),v("design:type",Function),v("design:paramtypes",[]),v("design:returntype",void 0)],m.prototype,"handleClick",null)},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(35),a=n(1);function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u,d,f=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},h=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=(r(g,[{key:"destructor",value:function(){this.record&&(this.record.removeChangeListener(this.handleRecordChange),this.record.destroy())}},{key:"initRecord",value:function(){var e=this,t=this.block.ExternalServices.io;t&&(this.record=(0,o.Synchronous)(new o.Record({}),{token:this.block.getToken(),io:t,tenant_id:g.TENANT_ID}),this.record.fetchClientVars().then(function(){e.updateBlock(),e.record&&(e.record.onChange(e.handleRecordChange),e.record.onError(function(e){console.log("[JIRA ISSUE]: Data Sdk Error",e)}))}))}},{key:"updateBlock",value:function(){this.block.render(),this.block.heightUpdateNotifier.notifyWillUpdate()}},{key:"handleRecordChange",value:function(){this.updateBlock()}},{key:"setRecord",value:(d=s(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=this.record,e.t0)return e.next=5,this.record.set(t);e.next=5;break;case 5:e.next=10;break;case 7:throw e.prev=7,e.t1=e.catch(0),e.t1;case 10:case"end":return e.stop()}},e,this,[[0,7]])})),m)},{key:"getRecord",value:function(e){var t=this.record;if(t)return e?t.get([e]):t.getSnapshot()}},{key:"setIssueRecordVisible",value:(u=s(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setRecord([{path:["issueRecordMap",t,"visible"],value:n}]);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this,[[0,5]])})),v)}]),g);function g(e){c(this,g),this.block=e,this.initRecord()}function v(e,t){return u.apply(this,arguments)}function m(e){return d.apply(this,arguments)}(t.default=p).TENANT_ID=12,f([(0,a.Bind)(),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],p.prototype,"destructor",null),f([(0,a.Bind)(),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],p.prototype,"handleRecordChange",null),f([(0,a.Bind)(),h("design:type",Function),h("design:paramtypes",[String]),h("design:returntype",void 0)],p.prototype,"getRecord",null),f([(0,a.Bind)(),h("design:type",Function),h("design:paramtypes",[String,Boolean]),h("design:returntype",Promise)],p.prototype,"setIssueRecordVisible",null)},function(e,t){e.exports=o("m8R6")},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgd2lkdGg9IjI0IgogIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmlld0JveD0iMCAtMzAuNjMyMzg4NTE2NTEwMjMzIDI1NS4zMjQgMjg1Ljk1NjM4ODUxNjUxMDIzIj4KICA8bGluZWFyR3JhZGllbnQgaWQ9ImFhYSI+CiAgICA8c3RvcCBvZmZzZXQ9Ii4xOCIgc3RvcC1jb2xvcj0iIzAwNTJjYyIvPgogICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjMjY4NGZmIi8+CiAgPC9saW5lYXJHcmFkaWVudD4KICA8bGluZWFyR3JhZGllbnQgaWQ9ImIiIHgxPSI5OC4wMzElIiB4Mj0iNTguODg4JSIgeGxpbms6aHJlZj0iI2FhYSIgeTE9Ii4xNjElIiB5Mj0iNDAuNzY2JSIvPgogIDxsaW5lYXJHcmFkaWVudCBpZD0iYyIgeDE9IjEwMC42NjUlIiB4Mj0iNTUuNDAyJSIgeGxpbms6aHJlZj0iI2FhYSIgeTE9Ii40NTUlIiB5Mj0iNDQuNzI3JSIvPgogIDxwYXRoIGQ9Ik0yNDQuNjU4IDBIMTIxLjcwN2E1NS41MDIgNTUuNTAyIDAgMCAwIDU1LjUwMiA1NS41MDJoMjIuNjQ5Vjc3LjM3Yy4wMiAzMC42MjUgMjQuODQxIDU1LjQ0NyA1NS40NjYgNTUuNDY3VjEwLjY2NkMyNTUuMzI0IDQuNzc3IDI1MC41NSAwIDI0NC42NTggMHoiIGZpbGw9IiMyNjg0ZmYiLz4KICA8cGF0aCBkPSJNMTgzLjgyMiA2MS4yNjJINjAuODcyYy4wMTkgMzAuNjI1IDI0Ljg0IDU1LjQ0NyA1NS40NjYgNTUuNDY3aDIyLjY0OXYyMS45MzhjLjAzOSAzMC42MjUgMjQuODc3IDU1LjQzIDU1LjUwMiA1NS40M1Y3MS45M2MwLTUuODkxLTQuNzc2LTEwLjY2Ny0xMC42NjctMTAuNjY3eiIgZmlsbD0idXJsKCNiKSIvPgogIDxwYXRoIGQ9Ik0xMjIuOTUxIDEyMi40ODlIMGMwIDMwLjY1MyAyNC44NSA1NS41MDIgNTUuNTAyIDU1LjUwMmgyMi43MnYyMS44NjdjLjAyIDMwLjU5NyAyNC43OTggNTUuNDA4IDU1LjM5NiA1NS40NjZWMTMzLjE1NmMwLTUuODkxLTQuNzc2LTEwLjY2Ny0xMC42NjctMTAuNjY3eiIgZmlsbD0idXJsKCNjKSIvPgo8L3N2Zz4K"},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"268",height:"110",viewBox:"0 0 268 110",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},t),i.default.createElement("defs",null,i.default.createElement("path",{id:"a",d:"M0 24h268v64H0z"}),i.default.createElement("path",{id:"b",d:"M0 0h16v16H0z"}),i.default.createElement("linearGradient",{x1:"98.03%",y1:".16%",x2:"58.89%",y2:"40.77%",id:"d"},i.default.createElement("stop",{stopColor:"#0052CC",offset:"18%"}),i.default.createElement("stop",{stopColor:"#2684FF",offset:"100%"})),i.default.createElement("linearGradient",{x1:"100.67%",y1:".46%",x2:"55.4%",y2:"44.73%",id:"e"},i.default.createElement("stop",{stopColor:"#0052CC",offset:"18%"}),i.default.createElement("stop",{stopColor:"#2684FF",offset:"100%"}))),i.default.createElement("g",{fill:"none",fillRule:"evenodd"},i.default.createElement("path",{fill:"#E1EAFF",d:"M0 0h268v110H0z"}),i.default.createElement("path",{stroke:"#EFF0F1",fill:"#FFF",d:"M4.5 24.5h259v85H4.5z"}),i.default.createElement("path",{d:"M66.9 39h168.2c.5 0 .9.4.9.9v4.2c0 .5-.4.9-.9.9H66.9a.9.9 0 0 1-.9-.9v-4.2c0-.5.4-.9.9-.9zM244.28 43.71l3.03-3.02a.4.4 0 0 0-.29-.69h-6.05a.4.4 0 0 0-.28.69l3.02 3.02a.4.4 0 0 0 .57 0zM244.28 61.71l3.03-3.02a.4.4 0 0 0-.29-.69h-6.05a.4.4 0 0 0-.28.69l3.02 3.02a.4.4 0 0 0 .57 0zM66.9 57h168.2c.5 0 .9.4.9.9v4.2c0 .5-.4.9-.9.9H66.9a.9.9 0 0 1-.9-.9v-4.2c0-.5.4-.9.9-.9zM66.9 75h168.2c.5 0 .9.4.9.9v21.2c0 .5-.4.9-.9.9H66.9a.9.9 0 0 1-.9-.9V75.9c0-.5.4-.9.9-.9z",fill:"#EFF0F1"}),i.default.createElement("text",{fill:"#07F",fontFamily:"LarkEmojiFont, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"10"},i.default.createElement("tspan",{x:"112",y:"16"},"Jira Issue")),i.default.createElement("g",{fill:"#DEE0E3"},i.default.createElement("rect",{x:".2",width:"32",height:"8",rx:".9",transform:"translate(22 38)"})),i.default.createElement("g",{fill:"#DEE0E3"},i.default.createElement("rect",{x:".2",width:"32",height:"8",rx:".9",transform:"translate(22 56)"})),i.default.createElement("g",{fill:"#DEE0E3"},i.default.createElement("rect",{x:".2",width:"32",height:"8",rx:".9",transform:"translate(22 75)"})),i.default.createElement("g",{transform:"translate(5 4)"},i.default.createElement("mask",{id:"c",fill:"#fff"},i.default.createElement("use",{xlinkHref:"#b"})),i.default.createElement("g",{mask:"url(#c)",fillRule:"nonzero"},i.default.createElement("path",{d:"M12.13 3.33h-5.1a2.3 2.3 0 0 0 2.3 2.3h.94v.9a2.3 2.3 0 0 0 2.3 2.3V3.77c0-.24-.2-.44-.44-.44z",fill:"#2684FF"}),i.default.createElement("path",{d:"M7.6 2.54H2.53a2.3 2.3 0 0 0 2.3 2.3h.93v.9a2.3 2.3 0 0 0 2.3 2.3V2.97c0-.25-.2-.44-.44-.44z",fill:"url(#d)",transform:"translate(2 3.33)"}),i.default.createElement("path",{d:"M5.09 5.07H0a2.3 2.3 0 0 0 2.3 2.3h.94v.9a2.3 2.3 0 0 0 2.29 2.3V5.5c0-.24-.2-.44-.44-.44z",fill:"url(#e)",transform:"translate(2 3.33)"})))))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"496",height:"160",viewBox:"0 0 496 160",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M.5 4A3.5 3.5 0 0 1 4 .5h488a3.5 3.5 0 0 1 3.5 3.5v152a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 156V4z",fill:"#fff",stroke:"#DEE0E3"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.64 17h5.72c.36 0 .64.28.64.64v5.72a3.18 3.18 0 0 1-3.18-3.18A3.18 3.18 0 0 1 25.64 17zm-3.82 3.82h5.73c.35 0 .63.28.63.63v5.73A3.18 3.18 0 0 1 25 24a3.18 3.18 0 0 1-3.18-3.18zm1.9 3.82H18a3.18 3.18 0 0 0 3.18 3.18A3.18 3.18 0 0 0 24.36 31v-5.73a.64.64 0 0 0-.63-.63z",fill:"#3370FF"}),i.default.createElement("path",{d:"M44.96 19v6.72c0 .75-.14 1.28-.4 1.61-.26.34-.68.52-1.27.52-1.04 0-1.55-.6-1.55-1.79v-.32H40.2v.33c0 .98.27 1.74.8 2.3.5.55 1.26.83 2.25.83 1.15 0 1.99-.31 2.52-.9.46-.56.7-1.4.7-2.52V19h-1.52zm4.4-.14c-.3 0-.54.09-.73.28-.2.19-.3.42-.3.72 0 .28.1.53.3.73.2.18.43.28.72.28.28 0 .54-.1.73-.28a1 1 0 0 0 .31-.73c0-.3-.1-.53-.3-.72a1 1 0 0 0-.74-.28zm-.75 2.9V29h1.49v-7.24H48.6zm6.86-.2c-.45 0-.84.13-1.18.41-.28.2-.52.5-.7.88v-1.09h-1.48V29h1.48v-3.84c0-.63.18-1.14.56-1.54.35-.36.76-.54 1.2-.54.34 0 .69.04 1.05.15v-1.48a2.12 2.12 0 0 0-.93-.18zm5.1 0c-.89 0-1.62.16-2.15.5-.62.36-1 .95-1.16 1.73l1.47.13c.08-.4.3-.7.63-.9.28-.17.66-.25 1.12-.25 1.1 0 1.64.5 1.64 1.51v.3l-1.63.04c-1.06.03-1.9.24-2.49.66a2.13 2.13 0 0 0-.97 1.87c0 .6.23 1.1.7 1.47.41.38 1 .58 1.75.58.65 0 1.2-.13 1.68-.35.42-.21.77-.5 1.05-.87V29h1.38v-4.62c0-.88-.23-1.55-.66-2.02-.5-.53-1.29-.8-2.35-.8zm1.55 4.1v.41a1.8 1.8 0 0 1-.69 1.42c-.45.38-.98.57-1.6.57-.39 0-.7-.1-.92-.28a.82.82 0 0 1-.35-.68c0-.9.67-1.38 2.03-1.4l1.53-.05zm18 4.7c1.2 0 1.83-.56 1.83-1.65V18.23H75.3v1.3h5.29v8.83c0 .51-.25.78-.73.78l-1.5-.03.34 1.25h1.43zm-9.85-10.52v10.62h1.36V19.84h-1.36zm3.14 1.9v5.58h5.34v-5.57h-5.34zm4.01 4.3h-2.68v-3.02h2.68v3.03zm-4.73-8.66l-1.23.55c.63.74 1.2 1.6 1.74 2.57l1.19-.61c-.5-.91-1.07-1.75-1.7-2.51zm20.5 11.6c-2.77 0-4.55-.12-5.3-.34l-.06-.02v-1.24h1.8V26.2h-1.8V25h2.15v-1.2h-6V25h2.68v3a5.27 5.27 0 0 1-.95-1.04c.07-.42.11-.87.14-1.33l-1.17-.16a9.13 9.13 0 0 1-1.17 4.15l.96.85c.4-.69.72-1.43.96-2.24.52.69 1.1 1.18 1.78 1.46.84.35 2.93.53 6.29.53h2.84l.22-1.32c-.74.06-1.86.09-3.37.09zm-8.65-11v5.08h4.97v-5.08h-4.97zm3.68 4h-2.4v-.95h2.4v.94zm-2.4-1.95v-.96h2.4v.96h-2.4zm4.27-2.05v1.2h2.5c-.02.3-.06.6-.12.89h-2v5.75h1.18V21.2h3.02v4.62h1.23v-5.75h-2.25c.06-.28.11-.58.15-.88h2.43v-1.2h-6.14zm4.2 7.79l-.9.84c.9.71 1.59 1.38 2.1 2l.92-.93a14.36 14.36 0 0 0-2.12-1.91zm-1.75-4.04v2.02a4.82 4.82 0 0 1-.57 2.32c-.36.56-1.05 1.03-2.06 1.39l.72 1.13a4.64 4.64 0 0 0 2.35-1.69c.47-.78.74-1.83.8-3.15v-2.02h-1.24z",fill:"#fff"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 50c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V50zM16 86c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V86zM16 122c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2v-20zM132 50c0-1.1.9-2 2-2h344a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H134a2 2 0 0 1-2-2V50zM132 86c0-1.1.9-2 2-2h344a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H134a2 2 0 0 1-2-2V86zM132 122c0-1.1.9-2 2-2h344a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H134a2 2 0 0 1-2-2v-20z",fill:"#EFF0F1"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(1),s=d(n(10)),o=d(n(177)),l=n(20),c=n(48),u=n(36);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=(p(v,a.Creator),r(v,[{key:"create",value:function(e,t,n){return new o.default(e,t,n,this.ExternalServices)}},{key:"onPaste",value:function(e){for(var t=e.pasteDataWrapper,n=(0,s.default)(t).find("."+a.BLOCK_CONTAINER),r=0;r<n.length;r++){var i=n[r],o=(0,a.getBlockDataSet)(i);o&&(o.blockType,this.blockType)}return e}}]),v);function v(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;f(this,v);var o=h(this,(v.__proto__||Object.getPrototypeOf(v)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=a.BlockType.JIRA_FILTER_BLOCK,o.defaultProps={},o.ExternalServices=t,o.moduleConfigs=i,o}(t.default=g).JIRA_ID=l.JIRA_ID,g.getFilterName=c.getFilterName,g.getDefaultFieldVisibleMap=c.getDefaultFieldVisibleMap,g.getDefaultFields=c.getDefaultFields,g.getFieldName=u.getFieldName},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=T(n(21)),i=T(n(19)),o=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=T(n(5)),u=n(12),d=n(0),f=T(d),h=n(1),p=T(n(178)),g=T(n(183)),v=n(3),m=n(48),y=n(13),b=n(16),E=T(n(7)),k=n(26),C=T(n(185)),I=T(n(186)),S=n(2);function T(e){return e&&e.__esModule?e:{default:e}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function x(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var M,N,A=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},_=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},L=(x(D,h.Block),o(D,[{key:"getNotifyWidth",value:function(){return this.isInHistoryMode()?this.mountPoint.offsetWidth:0}},{key:"isShowHistoryPlaceholder",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e;return t.historyMode===S.HISTORY_MODE.PLACEHOLDER||t.historyMode===S.HISTORY_MODE.PLACEHOLDER_NEW}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"handleEventBinding",value:function(e){this.editor&&(this.editor[e]("fullscreenEntered",this.handleFullscreenOptionChange),this.editor[e]("fullscreenModeChanged",this.handleFullscreenOptionChange),this.editor[e]("fullscreenExited",this.handleFullscreenExited))}},{key:"handleFullscreenOptionChange",value:function(e){this.jiraFilterRef&&this.jiraFilterRef.setZoom(this.zoom),this.jiraFilterRef&&this.jiraFilterRef.setIsPresentation(this.isPresentation),this.getFullScreenSize=e.size}},{key:"handleFullscreenExited",value:function(){this.jiraFilterRef&&this.jiraFilterRef.setZoom(1),this.jiraFilterRef&&this.jiraFilterRef.setIsPresentation(this.isPresentation)}},{key:"resetToolBar",value:function(){var t,e=[];this.getIsDelete()&&(e=e.concat([h.CommonCommandKey.comment])),this.editbarCommands=e,toolbar&&this.context&&this.context.updateEditbar&&(t=this.context.getCommandByKey,e=e.map(function(e){return t&&(0,h.isCommonCommandKey)(e)?t(e):e}),this.editbarCommands=e,this.context.updateEditbar(e,this))}},{key:"collectText",value:function(){return"["+this.plainText+"]"}},{key:"blockDidUpdate",value:function(){var e=this.attributes.selectState;e!==this.selectState&&void 0!==e&&(this.selectState=e,this.updateSelectionState(this.selectState))}},{key:"blockDidMount",value:function(){this.handleEventBinding("on")}},{key:"blockDidCreate",value:function(){}},{key:"updateHighlight",value:function(e){var t;this.commentActionType!==e&&((t=this.ExternalServices.EventEmitter)&&t.emit(k.JIRA_FILTER_COMMENT_HIGHLIGHT_EVENT,{blockToken:this.getToken(),commentActionType:e}),this.commentActionType=e)}},{key:"updateSelectionState",value:function(e){var t=this.jiraFilterRef;t&&t.viewRef&&t.viewRef.updateSelectionState&&t.viewRef.updateSelectionState(e)}},{key:"getBlockScrollStatus",value:function(){var e=this.jiraFilterRef;return e&&e.viewRef&&e.viewRef.getScrollStatus&&e.viewRef.getScrollStatus()}},{key:"resize",value:function(e,t,n,r){var i=this.getFullScreenSize&&this.getFullScreenSize(),o=this.context.presentationMode===h.PresentationMode.PAGED;this.size={width:e,height:o&&i?i.height:t,fullWidth:o&&i?i.width:n,leftMargin:r},this.jiraFilterRef&&this.jiraFilterRef.setSize(this.size)}},{key:"unmount",value:function(e){s(D.prototype.__proto__||Object.getPrototypeOf(D.prototype),"unmount",this).call(this,e),this.handleEventBinding("off"),c.default.unmountComponentAtNode(this.mountPoint),this.manager&&this.manager.destructor(),this.heightUpdateNotifier.destroy(),this.jiraFilterRef=null,this.editbarCommands=[],this.ExternalServices={},this.size=null,this.dataset=null,this.editor=null,this.getFullScreenSize=null}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=this.manager?this.manager.getRecord():(0,m.getDefaultJiraFilterRecord)(),i=(0,h.generateBlockDataSet)({blockType:t,props:n,initData:r}),o=this.ExternalServices.t("block.common_paste_unsupported");return{html:(0,h.generateBlockHTML)(i,o),text:o}}},{key:"getIssueCount",value:function(){var e=this.manager;return e?e.getRecord("issueCount"):null}},{key:"getIssues",value:function(){var e=this.manager;return e?e.getRecord("issues"):null}},{key:"getIsDelete",value:function(){var e=this.manager;return e?e.getRecord("isDelete"):null}},{key:"setBlockInline",value:function(){this.props.viewType===h.ViewTypes.CARD&&this.setProps({viewType:h.ViewTypes.INLINE,displayMode:h.BlockDisplayMode.INLINE})}},{key:"getDeletedBlockToolbar",value:function(e){var t=e.isDelete;this.currIsDelete!==t&&(this.resetToolBar(),(this.currIsDelete=t)&&this.setBlockInline())}},{key:"getJiraFilter",value:function(){if(this.getToken()){this.manager||(this.manager=new g.default(this));var e=(0,i.default)(this.manager.getRecord());if(e&&!(0,r.default)(e.filterId))return this.getDeletedBlockToolbar(e),this.renderJiraFilter(e)}return this.initData?this.renderJiraFilter(this.initData):null}},{key:"handleComment",value:function(){var e=this.context;return e.triggerComment?e.triggerComment({block:this}):function(){}}},{key:"handleInternalSizeChange",value:function(e,t){var n=this.context.triggerInternalSizeChange;n&&n({block:this},e,t)}},{key:"handleEditbarPinChange",value:function(e){e!==this.editbarPin&&(this.editbarPin=e,this.menuStyle=e?k.pinTopMenuStyle:k.defaultMenuStyle,this.context.updateEditbar&&this.context.updateEditbar([],this))}},{key:"getJiraFilterRef",value:function(e){e&&e.getWrappedInstance?this.jiraFilterRef=e.getWrappedInstance():this.jiraFilterRef=e}},{key:"renderJiraFilter",value:function(e){var t=this,n=this.manager,r=this.context,i=this.ExternalServices,o=this.isRecordInitFinish,a=this.attributes,s=this.editor;if(!s)return null;var l={onSetJiraFilterRecord:n?n.setJiraFilterRecord:void 0,onSetViewType:n?n.setViewType:void 0,onSetFieldVisible:n?n.setFieldVisible:void 0,onSetView:n?n.setView:void 0,onSetViewRecords:n?n.setViewRecords:void 0,onSetViewFields:n?n.setViewFields:void 0,onSetViewName:n?n.setViewName:void 0,onSetViewExInfo:n?n.setViewExInfo:void 0,onRemoveView:n?n.removeView:void 0,onMoveView:n?n.moveView:void 0,onMoveField:n?n.moveFilterField:void 0,onMoveRecord:n?n.moveFilterIssue:void 0};return f.default.createElement(u.Provider,{store:i.Redux.store},f.default.createElement(p.default,Object.assign({},e,l,{ref:this.getJiraFilterRef,isLoading:!o,permissions:r.permissions||null,zoom:this.zoom,isPresentation:this.isPresentation,size:this.size||void 0,selected:a.selected,blockId:this.blockId,blockToken:this.getToken(),onTriggerComment:this.handleComment,onInternalSizeChange:this.handleInternalSizeChange,onEditbarPinChange:this.handleEditbarPinChange,ExternalServices:i,editor:s,mountPoint:this.mountPoint,onHeightWillUpdate:function(){return t.heightUpdateNotifier.notifyWillUpdate()},onHeightDidUpdate:function(){return t.heightUpdateNotifier.notifyDidUpdate()}})))}},{key:"checkRecordInitFinish",value:function(){if(this.manager){var e=this.getIssueCount(),t=this.getIssues();if(this.jiraFilterRef&&this.jiraFilterRef.hasSyncJira||!(0,r.default)(e)&&!(0,r.default)(t)&&(0<t.length||t.length===e))return void(this.isRecordInitFinish=!0)}this.isRecordInitFinish=!1}},{key:"render",value:function(){var t=this;if(this.isInHistoryMode())c.default.render(this.getHistoryView(),this.mountPoint);else{this.checkRecordInitFinish();var n=this.getJiraFilter();if(n)return new Promise(function(e){c.default.render(f.default.createElement(b.NotifyHeightUpdateOnMount,{notifier:t.heightUpdateNotifier},(0,d.cloneElement)(n)),t.mountPoint,function(){e(),t.heightUpdateNotifier.notifyDidUpdate()})})}}},{key:"getHistoryView",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e,n=(t.historyMode===S.HISTORY_MODE.PLACEHOLDER?C:I).default;return f.default.createElement("div",{className:"jira-Filter-placeholder"},f.default.createElement(n,{className:"history-icon"}),t.historyMode===S.HISTORY_MODE.PLACEHOLDER_NEW&&f.default.createElement("span",{className:"history-block-name"},this.plainText))}},{key:"onTap",value:function(){return{preventFocus:!0}}},{key:"onLongTap",value:function(){return{preventFocus:!0}}},{key:"initData",get:function(){var e=this.dataset;if(e&&e.initData){var t=unescape(e.initData);if((0,v.isJsonString)(t))return JSON.parse(t)}return null}},{key:"zoom",get:function(){var e,t=(O(e={},h.PresentationMode.NONE,1),O(e,h.PresentationMode.NON_PAGED,1.8),O(e,h.PresentationMode.PAGED,2),e),n=void 0!==this.context.presentationMode&&t[this.context.presentationMode]||1;return this.jiraFilterRef&&this.jiraFilterRef.setZoom(n),n}},{key:"isPresentation",get:function(){return this.context.presentationMode!==h.PresentationMode.NONE}}]),D);function D(e,t,n,r){w(this,D);var i=R(this,(D.__proto__||Object.getPrototypeOf(D)).call(this,e,t));return i.editbarTrigger=h.Trigger.hover,i.editbarCommands=[],i.menuStyle=k.defaultMenuStyle,i.editbarPin=!1,i.supportsHalfFullScreen=!1,i.heightUpdateNotifier=new E.default({getContext:function(){return i.context},getBlockId:function(){return i.blockId}}),i.isRecordInitFinish=!1,i.manager=null,i.currIsDelete=null,i.commentActionType=0,i.jiraFilterRef=null,i.getFullScreenSize=null,i.plainText="",i.selectState=h.SelectionState.NONE,i.dataset=t,i.editor=n,i.ExternalServices=r,i.supportsHalfFullScreen=!i.isShowHistoryPlaceholder(),i.plainText=i.ExternalServices.t("doc.jira.jira_filter"),i}t.default=L,A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",["function"==typeof(M=void 0!==y.FullscreenOptions&&y.FullscreenOptions)?M:Object]),_("design:returntype",void 0)],L.prototype,"handleFullscreenOptionChange",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[]),_("design:returntype",void 0)],L.prototype,"handleFullscreenExited",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[]),_("design:returntype",void 0)],L.prototype,"resetToolBar",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",["function"==typeof(N=void 0!==h.SelectionState&&h.SelectionState)?N:Object]),_("design:returntype",void 0)],L.prototype,"updateSelectionState",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[]),_("design:returntype",void 0)],L.prototype,"getBlockScrollStatus",null),A([(0,h.Debounce)(150),_("design:type",Function),_("design:paramtypes",[Number,Number,Number,Number]),_("design:returntype",void 0)],L.prototype,"resize",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[]),_("design:returntype",void 0)],L.prototype,"handleComment",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[Number,Number]),_("design:returntype",void 0)],L.prototype,"handleInternalSizeChange",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[Boolean]),_("design:returntype",void 0)],L.prototype,"handleEditbarPinChange",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[Object]),_("design:returntype",void 0)],L.prototype,"getJiraFilterRef",null),A([(0,h.Bind)(),_("design:type",Function),_("design:paramtypes",[]),_("design:returntype",void 0)],L.prototype,"render",null)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=m(n(23)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(0),a=m(o),s=n(12),c=n(1),h=n(20),p=n(13),u=m(n(179)),U=n(48),d=n(26),g=n(3),v=n(36);function m(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(182);var k,C=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},I=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=2,T=3,O=(E(w,o.Component),r(w,[{key:"componentDidMount",value:function(){this.jiraSyncStatus=this.getSyncStatus(this.props.reduxState),this.handleEventBinding("on"),this.initViewManager(),this.mountView()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.reduxState,r=t.lastSyncTime,i=this.getAuthStatus(n);this.jiraSyncStatus=this.getSyncStatus(n),this.getSyncStatus(e.reduxState)!==this.jiraSyncStatus&&this.jiraSyncStatus===T&&this.setTimer(),this.firstTimeSyncJira||(0,v.checkIfNeedSync)(r)||(this.firstTimeSyncJira=!0,this.fakeSyncJira("success")),!this.firstTimeSyncJira&&i&&![p.AuthState.HAS_NOT_FETCH,p.AuthState.FETCH_FAIL].includes(i.authState)&&(0,v.checkIfNeedSync)(r)&&this.syncJiraFilter("open_doc"),this.updateView()}},{key:"componentWillUnmount",value:function(){this.clearTimer(),this.handleEventBinding("off"),this.jiraFilterRef=null,this.viewRef=null,this.jiraSyncStatus=void 0,this.unMountView()}},{key:"setSize",value:function(e){this.setState({size:e})}},{key:"setIsPresentation",value:function(e){this.setState({isPresentation:e})}},{key:"setZoom",value:function(e){this.setState({zoom:e})}},{key:"setTimer",value:function(){var e=this;this.timer=setTimeout(function(){e.fakeSyncJira("fail")},15e3)}},{key:"fakeSyncJira",value:function(e){var t,n,r,i,o=this.props,a=o.blockToken,s=o.ExternalServices.Redux;a&&s&&s.store&&s.actions&&(n=(t=s.actions).fakeSyncJiraSuccess,r=t.fakeSyncJiraFail,(i="success"===e?n:r)&&s.store.dispatch(i(a)))}},{key:"clearTimer",value:function(){this.timer&&clearTimeout(this.timer),this.timer=null}},{key:"handleEventBinding",value:function(e){var t=this.props.ExternalServices.EventEmitter;t&&t[e](d.JIRA_FILTER_SYNC_EVENT,this.handleSync);var n="on"===e?"addEventListener":"removeEventListener";window[n]("online",this.handleOnline),window[n]("offline",this.handleOffline)}},{key:"handleOnline",value:function(){this.setIsOnline(!0)}},{key:"handleOffline",value:function(){this.setIsOnline(!1)}},{key:"setIsOnline",value:function(e){e!==this.state.isOnline&&this.setState({isOnline:e})}},{key:"handleSync",value:function(e){e===this.props.blockToken&&this.handleLastSyncTimeUpdate()}},{key:"initViewManager",value:function(){var e=this.props.ExternalServices.viewManager;e&&(this.viewManager=e())}},{key:"mountView",value:function(){this.viewManager&&this.jiraFilterRef&&this.viewManager.createView(this.jiraFilterRef,this.viewProps)}},{key:"updateView",value:function(){this.viewManager&&this.jiraFilterRef&&this.viewManager.updateView(this.jiraFilterRef,this.viewProps)}},{key:"unMountView",value:function(){var e=this.props.blockToken;e&&this.viewManager&&this.viewManager.destroy(e),this.viewManager=null}},{key:"handleLastSyncTimeUpdate",value:function(){this.getSyncStatus(this.props.reduxState)===T&&(this.fakeSyncJira("success"),this.clearTimer())}},{key:"getSyncStatus",value:function(e){var t=this.props,n=t.blockToken,r=t.ExternalServices.Redux;if(n&&r&&e&&r.selectors)return(0,r.selectors.selectJiraSyncStatus)(e)[n]}},{key:"getAuthStatus",value:function(e){var t=this.props.ExternalServices.Redux;if(t&&e&&t.selectors){var n=t.selectors.selectJiraAuthStatus;return n&&n(e)}}},{key:"syncJiraFilter",value:function(e){var t,n,r,i,o,a,s,l=this,c=this.props,u=c.isDelete,d=c.blockToken,f=c.ExternalServices.Redux,h=c.reduxState;!u&&d&&f&&(t=f.store,n=f.actions,t&&n&&((r=n.syncJira)&&(i=this.getSyncStatus(h),o=this.getAuthStatus(h),i!==S&&o&&(a=new Set,Object.values(this.props.viewInfo.viewMap).forEach(function(t){Object.keys(t.fieldVisibleMap).forEach(function(e){t.fieldVisibleMap[e]&&a.add(e)})}),s=Array.from(a).join(","),t.dispatch(r({type:p.Type.Filter,blockToken:d,visibleFieldIds:s,teaSource:e,authState:o.authState,baseUrl:o.baseUrl})).then(function(e){l.distributeSyncData(e.payload)}).finally(function(){l.hasSyncJira=!0}),this.firstTimeSyncJira=!0))))}},{key:"distributeSyncData",value:function(e){var t=e.fieldMap,n=e.issueMap,r=e.issues,i=e.lastSyncTime,o=e.filterName,a=e.issueCount,s=e.isDelete,l=this.props.onSetJiraFilterRecord,c=Object.create(null);o!==this.props.filterName&&(c.filterName=o),a!==this.props.issueCount&&(c.issueCount=a),s!==this.props.isDelete&&(c.isDelete=s);var u=this.getNextFieldMap(t);(0,f.default)(u,this.props.fieldMap)||(c.fieldMap=u),c.issueMap=n,c.issues=r,c.lastSyncTime=i,c.viewInfo=this.getViewInfoChange({fieldMap:u,issues:r}),l&&l(c)}},{key:"getNextFieldMap",value:function(e){var n=this,r=e,i=this.props.fieldMap;return Object.keys(i).forEach(function(t){!Object.values(n.props.viewInfo.viewMap).find(function(e){return e.fieldVisibleMap[t]})||r[t]||(r[t]=i[t])}),r}},{key:"getViewInfoChange",value:function(e){var l=e.fieldMap,c=e.issues,u=this.props.isLoading,d={viewMap:{}};return Object.values(this.props.viewInfo.viewMap).forEach(function(e){var t,n,r,i,o=e.id,a=e.fields,s=e.records;d.viewMap[o]={id:o},u?d.viewMap[o]=Object.assign({},d.viewMap[o],{records:c,fields:(0,U.getDefaultFields)(l)}):(t=c.filter(function(e){return!s.includes(e)}),n=s.filter(function(e){return c.includes(e)}).concat(t),(0,f.default)(n,s)||(d.viewMap[o].records=n),r=Object.keys(l).filter(function(e){return!a.includes(e)}),i=a.filter(function(e){return l[e]||e===h.JIRA_ID.KEY}).concat(r),(0,f.default)(i,a)||(d.viewMap[o].fields=i))}),d}},{key:"openJiraLink",value:function(e){var t=this.props,n=t.ExternalServices,r=t.linkUrl,i=n.Helpers,o=n.LogService;i&&(i.browser.mobile?window.location.href=r:(0,g.openUrl)(r,i),o&&o.collectEvent("click_openorigin_link",{link_type:"jira_filter",source:e}))}},{key:"getJiraFilterRef",value:function(e){this.jiraFilterRef=e}},{key:"getViewRef",value:function(e){!e||e&&e.props&&e.props.isFullscreenMode||(this.viewRef=e)}},{key:"render",value:function(){var e=this.props,t=e.isDelete,n=e.ExternalServices,r=e.selected,i=e.linkUrl,o=this.state.size;return t?a.default.createElement(u.default,{size:o,selected:r,filterName:this.filterName,linkUrl:i,ExternalServices:n}):a.default.createElement("div",{ref:this.getJiraFilterRef,className:"jira-filter"})}},{key:"filterName",get:function(){var e=this.props,t=e.filterId,n=e.filterName,r=e.ExternalServices.t;return(0,U.getFilterName)(Number(t),r)||n||r("doc.jira.jira_filter")}},{key:"isBlockMount",get:function(){var e=this.props,t=e.editor,n=e.blockId,r=document.querySelector(".block-id-"+n);if(!r||!r.parentNode)return!1;var i="none"!==window.getComputedStyle(r.parentNode).display;return t.plugins.blockPlugin.isBlockMounted(n)&&i}},{key:"viewProps",get:function(){var e=this.props,t=e.ExternalServices,n=e.permissions,r=e.blockToken,i=e.blockId,o=e.onTriggerComment,a=e.onInternalSizeChange,s=e.onEditbarPinChange,l=e.filterId,c=e.linkUrl,u=e.lastSyncTime,d=e.jql,f=e.issueCount,h=e.issueMap,p=e.issues,g=e.fieldMap,v=e.viewInfo,m=e.onSetView,y=e.onSetViewType,b=e.onSetFieldVisible,E=e.onSetViewRecords,k=e.onSetViewName,C=e.onSetViewExInfo,I=e.onRemoveView,S=e.onMoveView,T=e.onMoveField,O=e.onMoveRecord,w=e.editor,R=e.mountPoint,x=e.isLoading,M=e.selected,N=e.onHeightDidUpdate,A=e.onHeightWillUpdate,_=this.filterName,L=this.isBlockMount,D=this.jiraSyncStatus,B=this.state,P=B.size,F=B.isPresentation,j=B.zoom,z=B.isOnline,H={onSetView:m,onSetViewType:y,onSetFieldVisible:b,onSetViewRecords:E,onSetViewName:k,onSetViewExInfo:C,onRemoveView:I,onMoveView:S,onMoveField:T,onMoveRecord:O};return Object.assign({},H,{isBlockMount:L,isOnline:z,blockId:i,blockToken:r,onTriggerComment:o,onInternalSizeChange:a,onEditbarPinChange:s,containerSize:P,editable:(0,U.isEditable)(n,t),lastSyncTime:u,jql:d,linkUrl:c,filterId:l,filterName:_,fieldMap:g,viewInfo:v,zoom:j,isPresentation:F,issues:p,issueCount:f,issueMap:h,syncJira:this.syncJiraFilter,openJiraLink:this.openJiraLink,ExternalServices:t,editor:w,mountPoint:R,isLoading:x,selected:M,jiraSyncStatus:D,getViewRef:this.getViewRef,onHeightDidUpdate:N,onHeightWillUpdate:A})}}]),w);function w(){y(this,w);var e=b(this,(w.__proto__||Object.getPrototypeOf(w)).apply(this,arguments));return e.firstTimeSyncJira=!1,e.hasSyncJira=!1,e.jiraFilterRef=null,e.viewRef=null,e.viewManager=null,e.state={size:e.props.size,isPresentation:e.props.isPresentation,zoom:e.props.zoom,isOnline:!0},e}C([(0,c.Bind)(),I("design:type",Function),I("design:paramtypes",[]),I("design:returntype",void 0)],O.prototype,"handleOnline",null),C([(0,c.Bind)(),I("design:type",Function),I("design:paramtypes",[]),I("design:returntype",void 0)],O.prototype,"handleOffline",null),C([(0,c.Bind)(),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",void 0)],O.prototype,"handleSync",null),C([(0,c.Bind)(),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",void 0)],O.prototype,"syncJiraFilter",null),C([(0,c.Bind)(),I("design:type",Function),I("design:paramtypes",[String]),I("design:returntype",void 0)],O.prototype,"openJiraLink",null),C([(0,c.Bind)(),I("design:type",Function),I("design:paramtypes",["function"==typeof(k="undefined"!=typeof HTMLDivElement&&HTMLDivElement)?k:Object]),I("design:returntype",void 0)],O.prototype,"getJiraFilterRef",null),C([(0,c.Bind)(),I("design:type",Function),I("design:paramtypes",[Object]),I("design:returntype",void 0)],O.prototype,"getViewRef",null),O=C([(0,s.connect)(function(e){return{reduxState:e}},{},null,{withRef:!0})],O),t.default=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(180));function i(e){return e&&e.__esModule?e:{default:e}}t.default=r.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=u(n(0)),o=n(1),c=u(n(4)),a=n(3);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(181);var p=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},g=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=(h(m,s.default.Component),r(m,[{key:"handleClick",value:function(){var e=this.props,t=e.ExternalServices,n=e.linkUrl,r=t.Helpers;r&&(r.browser.mobile?(window.location.href=n,this.log(!0)):((0,a.openUrl)(n,r),this.log(!1)))}},{key:"log",value:function(e){var t=this.props.ExternalServices.LogService;t&&t.collectEvent("click_openorigin_link",{link_type:"jira_filter",source:"block",view_status:"inline",open_with_app:e?"true":"false"})}},{key:"render",value:function(){var e=this.props,t=e.ExternalServices,n=e.selected,r=e.filterName,i=e.size,o=(0,c.default)("jira-filter--deleted",{"is-selected":n}),a={marginLeft:(i?i.leftMargin:0)+"px"};return i&&i.fullWidth&&(a.width=i.fullWidth-(i.leftMargin||0)),s.default.createElement("div",{className:o,onClick:this.handleClick,style:a},s.default.createElement("span",{className:"jira-filter-name"},r),s.default.createElement("span",{className:"jira-filter-tip"},t.t("doc.jira.filter_is_deleted")))}}]),m);function m(){return d(this,m),f(this,(m.__proto__||Object.getPrototypeOf(m)).apply(this,arguments))}t.default=v,p([(0,o.Bind)(),g("design:type",Function),g("design:paramtypes",[]),g("design:returntype",void 0)],v.prototype,"handleClick",null)},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=g(n(19)),d=g(n(23)),f=g(n(21)),c=g(n(65)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=n(26),o=n(1),a=n(184),s=n(35),p=n(13);function g(e){return e&&e.__esModule?e:{default:e}}function v(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function m(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var b,E,k,C,I,S,T,O,w,R,x,M,N=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},A=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=(r(L,[{key:"destructor",value:function(){this.record&&(this.record.removeChangeListener(this.handleRecordChange),this.record.destroy())}},{key:"initRecord",value:function(){var e=this,t=this.block.ExternalServices.io;t&&(this.record=(0,s.Synchronous)(new s.Record({}),{token:this.block.getToken(),io:t,tenant_id:L.TENANT_ID}),this.record.fetchClientVars().then(function(){e.updateBlock(),e.record&&(e.record.onChange(e.handleRecordChange),e.record.onError(function(e){console.log("[JIRA FILTER]: Data Sdk Error",e)}))}))}},{key:"updateBlock",value:function(){this.block.render(),this.block.heightUpdateNotifier.notifyWillUpdate()}},{key:"handleRecordChange",value:function(e){var t,n=e.detail,r=e.type;this.updateBlock(),n.find(function(e){return e.p.includes("lastSyncTime")})?(t=this.block.ExternalServices.EventEmitter)&&t.emit(h.JIRA_FILTER_SYNC_EVENT,this.block.getToken()):n&&"COLLAB"===r&&n.forEach(this.execCollabOperation)}},{key:"execCollabOperation",value:function(e){var t,n=e.action,r=e.p,i=n.od,o=n.oi,a=n.lm,s=(0,u.default)(r),l=void 0;(0,c.default)(a)?l=p.ActionType.MOVE:(0,f.default)(o)?(0,f.default)(o)&&!(0,f.default)(i)&&(l=p.ActionType.REMOVE):l=p.ActionType.SET,l&&(t=this.getCollabAction(l,s))&&this.sendEvent(this.getCollabData(l,t,s,n))}},{key:"getCollabAction",value:function(e,s){var l=h.collabActionPathMap[e],c=(0,u.default)(s);return Object.keys(l).find(function(e){var t=l[e],n=t.key,r=t.path;if(n)return c.includes(n);if(r){var i=r.findIndex(function(e){return e===h.VIEW_ID}),o=(0,u.default)(s),a=(0,u.default)(r);return 0<=i&&(o.splice(i,1),a.splice(i,1)),(0,d.default)(a,o)}return!1})}},{key:"getCollabData",value:function(e,t,n,r){var i=r.od,o=r.oi,a=r.lm,s={};switch(e){case p.ActionType.MOVE:s.sourceIndex=n[n.length-1],s.targetIndex=a;break;case p.ActionType.SET:s.oldValue=i,s.newValue=o;break;case p.ActionType.REMOVE:s.oldValue=i}var l="";return t===p.JiraCollabAction.MOVE_VIEW&&(l=this.getRecord("viewInfo").views[s.sourceIndex]),Object.assign({type:e,action:t,token:this.block.getToken(),path:n,viewId:l||this.getPathStr(e,t,n,h.VIEW_ID),fieldId:this.getPathStr(e,t,n,h.FIELD_ID)},s)}},{key:"getPathStr",value:function(e,t,n,r){var i=h.collabActionPathMap[e][t].path.findIndex(function(e){return e===r});return 0<=i?n[i]:void 0}},{key:"sendEvent",value:function(e){var t=this.block.ExternalServices.EventEmitter;t&&t.emit(h.JIRA_FILTER_COLLAB_EVENT,e)}},{key:"setRecord",value:(M=m(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=this.record,e.t0)return e.next=5,this.record.set(t);e.next=5;break;case 5:e.next=10;break;case 7:throw e.prev=7,e.t1=e.catch(0),e.t1;case 10:case"end":return e.stop()}},e,this,[[0,7]])})),V)},{key:"moveRecord",value:function(e,t){try{this.record&&this.record.move(e,t)}catch(e){throw e}}},{key:"removeRecord",value:function(e){try{this.record&&this.record.remove(e)}catch(e){throw e}}},{key:"getRecord",value:function(e){var t=this.record;if(t)return e?t.get([e]):t.getSnapshot()}},{key:"setJiraFilterRecord",value:(x=m(regeneratorRuntime.mark(function e(t){var i,n=t.isDelete,r=t.lastSyncTime,o=t.filterName,a=t.fieldMap,s=t.issues,l=t.issueCount,c=t.issueMap,u=t.viewInfo;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],(0,f.default)(n)||i.push({path:["isDelete"],value:n}),r&&i.push({path:["lastSyncTime"],value:r}),(0,f.default)(o)||i.push({path:["filterName"],value:o}),a&&i.push({path:["fieldMap"],value:a}),s&&i.push({path:["issues"],value:s}),(0,f.default)(l)||i.push({path:["issueCount"],value:l}),c&&i.push({path:["issueMap"],value:c}),u&&Object.values(u.viewMap).forEach(function(e){var t=e.id,n=e.records,r=e.fields;n&&i.push({path:["viewInfo","viewMap",t,"records"],value:n}),r&&i.push({path:["viewInfo","viewMap",t,"fields"],value:r})}),e.prev=9,e.next=12,this.setRecord(i);case 12:e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(9),e.abrupt("return",!1);case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}},e,this,[[9,14]])})),U)},{key:"setViewType",value:(R=m(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setRecord([{path:["viewInfo","type"],value:t}]);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this,[[0,5]])})),H)},{key:"setView",value:(w=m(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getRecord("viewInfo"),e.prev=1,e.next=4,this.setRecord([{path:["viewInfo","viewMap",t.id],value:t},{path:["viewInfo","views",n.views.length],value:t.id}]);case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",!1);case 9:return e.abrupt("return",!0);case 10:case"end":return e.stop()}},e,this,[[1,6]])})),z)},{key:"setViewName",value:(O=m(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setRecord([{path:["viewInfo","viewMap",t,"name"],value:n}]);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this,[[0,5]])})),j)},{key:"setViewFields",value:(T=m(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setRecord([{path:["viewInfo","viewMap",t,"fields"],value:n}]);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this,[[0,5]])})),F)},{key:"setViewRecords",value:(S=m(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setRecord([{path:["viewInfo","viewMap",t,"records"],value:n}]);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this,[[0,5]])})),P)},{key:"setFieldVisible",value:(I=m(regeneratorRuntime.mark(function e(t,n,r){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],n.forEach(function(e){i.push({path:["viewInfo","viewMap",t,"fieldVisibleMap",e],value:r})}),e.prev=2,e.next=5,this.setRecord(i);case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",!1);case 10:return e.abrupt("return",!0);case 11:case"end":return e.stop()}},e,this,[[2,7]])})),B)},{key:"setViewExInfo",value:(C=m(regeneratorRuntime.mark(function e(t,n,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setRecord([{path:["viewInfo","viewMap",t,"exInfo"].concat(v(n)),value:r}]);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:return e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this,[[0,5]])})),D)},{key:"removeView",value:function(e,t){try{this.removeRecord([["viewInfo","viewMap",e],["viewInfo","views",t]])}catch(e){return!1}return!0}},{key:"moveView",value:function(e,t){try{this.moveRecord(["viewInfo","views",e],t)}catch(e){return!1}return!0}},{key:"moveFilterField",value:function(e,t,n){try{this.moveRecord(["viewInfo","viewMap",e,"fields",t],n)}catch(e){return!1}return!0}},{key:"moveFilterIssue",value:function(e,t,n){try{this.moveRecord(["viewInfo","viewMap",e,"records",t],n)}catch(e){return!1}return!0}}]),L);function L(e){y(this,L),this.block=e,this.initRecord()}function D(e,t,n){return C.apply(this,arguments)}function B(e,t,n){return I.apply(this,arguments)}function P(e,t){return S.apply(this,arguments)}function F(e,t){return T.apply(this,arguments)}function j(e,t){return O.apply(this,arguments)}function z(e){return w.apply(this,arguments)}function H(e){return R.apply(this,arguments)}function U(e){return x.apply(this,arguments)}function V(e){return M.apply(this,arguments)}(t.default=_).TENANT_ID=13,N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[]),A("design:returntype",void 0)],_.prototype,"destructor",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],_.prototype,"handleRecordChange",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[Object]),A("design:returntype",void 0)],_.prototype,"execCollabOperation",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",void 0)],_.prototype,"getRecord",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",["function"==typeof(b="undefined"!=typeof Omit&&Omit)?b:Object]),A("design:returntype",Promise)],_.prototype,"setJiraFilterRecord",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String]),A("design:returntype",Promise)],_.prototype,"setViewType",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",["function"==typeof(E=void 0!==p.IView&&p.IView)?E:Object]),A("design:returntype",Promise)],_.prototype,"setView",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,String]),A("design:returntype",Promise)],_.prototype,"setViewName",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,Array]),A("design:returntype",Promise)],_.prototype,"setViewFields",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,Array]),A("design:returntype",Promise)],_.prototype,"setViewRecords",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,Array,Boolean]),A("design:returntype",Promise)],_.prototype,"setFieldVisible",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,"function"==typeof(k=void 0!==a.Path&&a.Path)?k:Object,Object]),A("design:returntype",Promise)],_.prototype,"setViewExInfo",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,Number]),A("design:returntype",void 0)],_.prototype,"removeView",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[Number,Number]),A("design:returntype",void 0)],_.prototype,"moveView",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,Number,Number]),A("design:returntype",void 0)],_.prototype,"moveFilterField",null),N([(0,o.Bind)(),A("design:type",Function),A("design:paramtypes",[String,Number,Number]),A("design:returntype",void 0)],_.prototype,"moveFilterIssue",null)},function(e,t){e.exports=o("GSgQ")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"268",height:"110",viewBox:"0 0 268 110",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},t),i.default.createElement("defs",null,i.default.createElement("path",{id:"a",d:"M0 24h268v64H0z"}),i.default.createElement("path",{id:"b",d:"M0 0h16v16H0z"}),i.default.createElement("linearGradient",{x1:"98.03%",y1:".16%",x2:"58.89%",y2:"40.77%",id:"d"},i.default.createElement("stop",{stopColor:"#0052CC",offset:"18%"}),i.default.createElement("stop",{stopColor:"#2684FF",offset:"100%"})),i.default.createElement("linearGradient",{x1:"100.67%",y1:".46%",x2:"55.4%",y2:"44.73%",id:"e"},i.default.createElement("stop",{stopColor:"#0052CC",offset:"18%"}),i.default.createElement("stop",{stopColor:"#2684FF",offset:"100%"}))),i.default.createElement("g",{fill:"none",fillRule:"evenodd"},i.default.createElement("path",{fill:"#E1EAFF",d:"M0 0h268v110H0z"}),i.default.createElement("path",{stroke:"#EFF0F1",fill:"#FFF",d:"M4.5 24.5h259v85H4.5z"}),i.default.createElement("path",{d:"M66.9 39h168.2c.5 0 .9.4.9.9v4.2c0 .5-.4.9-.9.9H66.9a.9.9 0 0 1-.9-.9v-4.2c0-.5.4-.9.9-.9zM244.28 43.71l3.03-3.02a.4.4 0 0 0-.29-.69h-6.05a.4.4 0 0 0-.28.69l3.02 3.02a.4.4 0 0 0 .57 0zM244.28 61.71l3.03-3.02a.4.4 0 0 0-.29-.69h-6.05a.4.4 0 0 0-.28.69l3.02 3.02a.4.4 0 0 0 .57 0zM66.9 57h168.2c.5 0 .9.4.9.9v4.2c0 .5-.4.9-.9.9H66.9a.9.9 0 0 1-.9-.9v-4.2c0-.5.4-.9.9-.9zM66.9 75h168.2c.5 0 .9.4.9.9v21.2c0 .5-.4.9-.9.9H66.9a.9.9 0 0 1-.9-.9V75.9c0-.5.4-.9.9-.9z",fill:"#EFF0F1"}),i.default.createElement("text",{fill:"#07F",fontFamily:"LarkEmojiFont, -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Tahoma, 'PingFang SC','Microsoft Yahei', Arial, 'Hiragino Sans GB', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji','Segoe UI Symbol', 'Noto Color Emoji'",fontSize:"10"},i.default.createElement("tspan",{x:"112",y:"16"},"Jira Filter")),i.default.createElement("g",{fill:"#DEE0E3"},i.default.createElement("rect",{x:".2",width:"32",height:"8",rx:".9",transform:"translate(22 38)"})),i.default.createElement("g",{fill:"#DEE0E3"},i.default.createElement("rect",{x:".2",width:"32",height:"8",rx:".9",transform:"translate(22 56)"})),i.default.createElement("g",{fill:"#DEE0E3"},i.default.createElement("rect",{x:".2",width:"32",height:"8",rx:".9",transform:"translate(22 75)"})),i.default.createElement("g",{transform:"translate(5 4)"},i.default.createElement("mask",{id:"c",fill:"#fff"},i.default.createElement("use",{xlinkHref:"#b"})),i.default.createElement("g",{mask:"url(#c)",fillRule:"nonzero"},i.default.createElement("path",{d:"M12.13 3.33h-5.1a2.3 2.3 0 0 0 2.3 2.3h.94v.9a2.3 2.3 0 0 0 2.3 2.3V3.77c0-.24-.2-.44-.44-.44z",fill:"#2684FF"}),i.default.createElement("path",{d:"M7.6 2.54H2.53a2.3 2.3 0 0 0 2.3 2.3h.93v.9a2.3 2.3 0 0 0 2.3 2.3V2.97c0-.25-.2-.44-.44-.44z",fill:"url(#d)",transform:"translate(2 3.33)"}),i.default.createElement("path",{d:"M5.09 5.07H0a2.3 2.3 0 0 0 2.3 2.3h.94v.9a2.3 2.3 0 0 0 2.29 2.3V5.5c0-.24-.2-.44-.44-.44z",fill:"url(#e)",transform:"translate(2 3.33)"})))))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"750",height:"160",viewBox:"0 0 750 160",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M.5 4A3.5 3.5 0 0 1 4 .5h742a3.5 3.5 0 0 1 3.5 3.5v152a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 156V4z",fill:"#fff",stroke:"#DEE0E3"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M25.64 17h5.72c.36 0 .64.28.64.64v5.72a3.18 3.18 0 0 1-3.18-3.18A3.18 3.18 0 0 1 25.64 17zm-3.82 3.82h5.73c.35 0 .63.28.63.63v5.73A3.18 3.18 0 0 1 25 24a3.18 3.18 0 0 1-3.18-3.18zm1.9 3.82H18a3.18 3.18 0 0 0 3.18 3.18A3.18 3.18 0 0 0 24.36 31v-5.73a.64.64 0 0 0-.63-.63z",fill:"#3370FF"}),i.default.createElement("path",{d:"M44.96 19v6.72c0 .75-.14 1.28-.4 1.61-.26.34-.68.52-1.27.52-1.04 0-1.55-.6-1.55-1.79v-.32H40.2v.33c0 .98.27 1.74.8 2.3.5.55 1.26.83 2.25.83 1.15 0 1.99-.31 2.52-.9.46-.56.7-1.4.7-2.52V19h-1.52zm4.4-.14c-.3 0-.54.09-.73.28-.2.19-.3.42-.3.72 0 .28.1.53.3.73.2.18.43.28.72.28.28 0 .54-.1.73-.28a1 1 0 0 0 .31-.73c0-.3-.1-.53-.3-.72a1 1 0 0 0-.74-.28zm-.75 2.9V29h1.49v-7.24H48.6zm6.86-.2c-.45 0-.84.13-1.18.41-.28.2-.52.5-.7.88v-1.09h-1.48V29h1.48v-3.84c0-.63.18-1.14.56-1.54.35-.36.76-.54 1.2-.54.34 0 .69.04 1.05.15v-1.48a2.12 2.12 0 0 0-.93-.18zm5.1 0c-.89 0-1.62.16-2.15.5-.62.36-1 .95-1.16 1.73l1.47.13c.08-.4.3-.7.63-.9.28-.17.66-.25 1.12-.25 1.1 0 1.64.5 1.64 1.51v.3l-1.63.04c-1.06.03-1.9.24-2.49.66a2.13 2.13 0 0 0-.97 1.87c0 .6.23 1.1.7 1.47.41.38 1 .58 1.75.58.65 0 1.2-.13 1.68-.35.42-.21.77-.5 1.05-.87V29h1.38v-4.62c0-.88-.23-1.55-.66-2.02-.5-.53-1.29-.8-2.35-.8zm1.55 4.1v.41a1.8 1.8 0 0 1-.69 1.42c-.45.38-.98.57-1.6.57-.39 0-.7-.1-.92-.28a.82.82 0 0 1-.35-.68c0-.9.67-1.38 2.03-1.4l1.53-.05zm8.82-8l-.9.87c1 .81 1.77 1.58 2.33 2.28l.97-.97a18.54 18.54 0 0 0-2.4-2.18zm8.4 12.54h2.97l.32-1.34c-.35.03-.85.06-1.52.08l-1.94.02c-1.14 0-2.12-.02-2.95-.03a5.35 5.35 0 0 1-1.95-.34 3.78 3.78 0 0 1-1.06-.82 1.05 1.05 0 0 0-.22-.21v-5.3H69.8v1.25h1.9v3.95c-.56.3-1.2 1.02-1.92 2.18l.98.91c.73-1.3 1.25-1.94 1.54-1.94.17 0 .37.11.56.35.44.47.96.81 1.54.98.6.14 1.38.22 2.33.24l2.6.02zm-.4-1.89c.95 0 1.44-.47 1.44-1.42V21h1.99v-1.3h-2v-2.16h-1.32v2.15h-5.27V21h5.27v5.56c0 .37-.2.56-.58.56-.57 0-1.17-.02-1.8-.08l.3 1.27h1.97zm-3.4-6.28l-1.03.64a22.15 22.15 0 0 1 1.96 2.77l1.07-.74a21.94 21.94 0 0 0-2-2.67zm15.42-4.54v2.62h-3.3v3.47c-.06 2.41-.58 4.4-1.57 5.97l.98.86a12.93 12.93 0 0 0 1.74-6.83v-2.35h1.89v1.06l-1.5.23.14 1.03 1.36-.2v.61c0 .76.47 1.15 1.42 1.15h1.95c.49 0 .85-.09 1.1-.24.24-.15.43-.63.52-1.44l-1.09-.37c-.04.45-.12.73-.25.83-.11.08-.27.13-.5.13h-1.38c-.4 0-.6-.12-.6-.31v-.53l2.35-.37-.16-1.03-2.19.33v-.88h3c-.14.46-.3.87-.46 1.23l1.16.31c.26-.7.46-1.39.57-2.09v-.57h-3.9v-.83h3.54V18.2h-3.54v-.7h-1.28zm-5.96.16l-.93.86c.98.68 1.74 1.32 2.3 1.9l.9-.9A16.15 16.15 0 0 0 85 17.65zm-.35 3.34l-.93.91a14.6 14.6 0 0 1 2.2 2.09l.94-.93c-.6-.68-1.34-1.37-2.21-2.07zm1.05 3.77a45.63 45.63 0 0 1-1.9 4.94l1.25.56a48.3 48.3 0 0 0 1.8-5.04l-1.15-.46zm9.7 1.47l-.98.45c.42.93.8 2.01 1.15 3.22l1.03-.55a20.4 20.4 0 0 0-1.2-3.12zm-6.2.35c-.23 1.03-.58 2-1.08 2.91l1.02.63c.46-.94.83-2.04 1.1-3.33l-1.04-.21zm4.11 3.74c.45 0 .77-.09 1-.24.22-.18.39-.72.49-1.61l-1.1-.35c-.04.52-.1.82-.2.92a.55.55 0 0 1-.4.14h-.82c-.32 0-.48-.1-.48-.3v-2.57h-1.17v2.82c0 .78.43 1.19 1.3 1.19h1.38zm-.64-5.02l-.81.62c.46.55.92 1.19 1.4 1.95l.9-.68c-.45-.68-.96-1.31-1.5-1.89zm6.3-7.32v3.64h4.5v-3.64h-4.5zm3.29 2.54h-2.09v-1.4h2.09v1.4zm2.5-2.54v3.64h2.86l-1.04.34c.19.24.37.5.54.8h-3.13c.16-.28.3-.56.43-.86l-1.28-.14a4.8 4.8 0 0 1-.57 1h-4.68v1.17h3.49c-.93.69-2.17 1.26-3.74 1.71l.6 1.08.93-.31v4.05h1.16v-.55h2.03v.55h1.17v-4.58h-3.1a8.99 8.99 0 0 0 2.7-1.95h2.27a8.4 8.4 0 0 0 2.61 1.95h-3.34v4.58h1.17v-.55h2.27v.55h1.18v-4.02l.77.28.53-1.12c-1.6-.42-2.84-.97-3.73-1.67h3.46v-1.17h-1.9c-.2-.4-.44-.77-.7-1.14h1.67v-3.64h-4.63zm3.42 2.54h-2.21v-1.4h2.21v1.4zm-7.85 8.26v-1.81h2.03v1.8h-2.03zm5.51 0v-1.81h2.27v1.8h-2.27z",fill:"#fff"}),i.default.createElement("g",{clipPath:"url(#a)"},i.default.createElement("g",{clipPath:"url(#b)"},i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 58c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V58z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M0 46h136v38H0z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152 58c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H154a2 2 0 0 1-2-2V58z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M136 46h136v38H136z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M288 58c0-1.1.9-2 2-2h442a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H290a2 2 0 0 1-2-2V58z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M272 46h478v38H272z"})),i.default.createElement("path",{stroke:"#DEE0E3",d:"M0 46h750v38H0z"})),i.default.createElement("g",{clipPath:"url(#c)"},i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 96c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V96z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M0 84h136v38H0z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152 96c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H154a2 2 0 0 1-2-2V96z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M136 84h136v38H136z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M288 96c0-1.1.9-2 2-2h442a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H290a2 2 0 0 1-2-2V96z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M272 84h478v38H272z"})),i.default.createElement("g",{clipPath:"url(#d)"},i.default.createElement("g",{clipPath:"url(#e)"},i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 134c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2v-14z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M0 122h136v38H0z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M152 134c0-1.1.9-2 2-2h100a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H154a2 2 0 0 1-2-2v-14z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M136 122h136v38H136z"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M288 134c0-1.1.9-2 2-2h442a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H290a2 2 0 0 1-2-2v-14z",fill:"#EFF0F1"}),i.default.createElement("path",{stroke:"#DEE0E3",d:"M272 122h478v38H272z"})),i.default.createElement("path",{stroke:"#DEE0E3",d:"M0 122h750v38H0z"})),i.default.createElement("path",{fill:"#DEE0E3",d:"M0 46h750v1H0z"}),i.default.createElement("defs",null,i.default.createElement("clipPath",{id:"a"},i.default.createElement("path",{fill:"#fff",transform:"translate(0 46)",d:"M0 0h750v38H0z"})),i.default.createElement("clipPath",{id:"b"},i.default.createElement("path",{fill:"#fff",d:"M0 46h750v38H0z"})),i.default.createElement("clipPath",{id:"c"},i.default.createElement("path",{fill:"#fff",transform:"translate(0 84)",d:"M0 0h750v38H0z"})),i.default.createElement("clipPath",{id:"d"},i.default.createElement("path",{d:"M0 122h750v34a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4v-34z",fill:"#fff"})),i.default.createElement("clipPath",{id:"e"},i.default.createElement("path",{fill:"#fff",d:"M0 122h750v38H0z"}))))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=n(1),o=s(n(188)),a=s(n(64)),f=n(27),h=n(49);function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p=(u(g,d.Creator),r(g,[{key:"create",value:function(e,t,n){return new o.default(e,t,this.ExternalServices,n,this.mobileEditStats)}},{key:"onPaste",value:function(e){var t=this.ExternalServices.LogService;if(!t||!t.collectEvent)return e;for(var n=e.pasteDataWrapper.querySelectorAll(".ace-line."+d.BLOCK_CONTAINER),r=0;r<n.length;r++){var i=n[r],o=(0,d.getBlockDataSet)(i);o&&o.blockType===this.blockType&&t.collectEvent("client_insert_diagram",{create_source:"paste",block_subtype:o.props.diagramType})}var a=e.pasteDataWrapper.querySelector("[data-diagram-type]");if(!a)return e;var s=a.getAttribute("data-diagram-type")===f.DiagramType.UML?f.DiagramType.UML:f.DiagramType.FLOWCHART,l=a.getAttribute("data-diagram-record")||"",c=null;try{c=JSON.parse(l)}catch(e){console.log("fail to parse clipboard diagram data",e)}if(!c||!c.data)return e;c.data.mxGraphModel=(0,h.generateDiagramInitData)().data.mxGraphModel;var u=(0,d.generateBlockDataSet)({blockType:d.BlockType.DIAGRAM_BLOCK,props:{viewType:d.ViewTypes.CARD,diagramType:s},initData:c});return a.outerHTML=(0,d.generateBlockHTML)(u),t.collectEvent("client_insert_diagram",{create_source:"paste_shape",block_subtype:s}),e}},{key:"onInternalPaste",value:function(e){var t=e.dataset,n=this.ExternalServices.LogService;return n&&n.collectEvent&&n.collectEvent("client_insert_diagram",{create_source:"paste",block_subtype:t.props.diagramType}),t}},{key:"destroy",value:function(){this.mobileEditStats.reset(),this.mobileEditStats=null}}]),g);function g(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder,i=e.moduleConfigs;l(this,g);var o=c(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return o.ExternalServices={},o.blockType=d.BlockType.DIAGRAM_BLOCK,o.defaultProps={},o.defaultRecord={},o.mobileEditStats=null,o.ExternalServices=t,o.mobileEditStats=new a.default(o.ExternalServices.EventEmitter),o.moduleConfigs=i,o}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=n(1),c=n(6),u=x(n(0)),d=x(n(5)),s=x(n(4)),f=x(n(189)),h=n(27),p=x(n(194)),g=x(n(195)),v=n(49),m=x(v),y=n(3),b=x(n(7)),E=n(17),k=x(n(197)),C=x(n(198)),I=x(n(199)),S=x(n(200)),T=x(n(201)),O=x(n(202)),w=n(2),R=n(68);function x(e){return e&&e.__esModule?e:{default:e}}function M(e){return function(){var s=e.apply(this,arguments);return new Promise(function(i,o){function a(e,t){try{var n=s[e](t),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){a("next",e)},function(e){a("throw",e)});i(r)}return a("next")})}}function N(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var L,D,B,P,F,j,z=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},H=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},U=(_(V,a.Block),r(V,[{key:"setWidth",value:function(){this.ExternalServices.Utils.isShortCut&&this.ExternalServices.Utils.isShortCut()&&(this.width=624),this.isInHistoryMode()||(this.width=(0,y.getDocBodyWidth)()?Math.min((0,y.getDocBodyWidth)(),this.width):this.width)}},{key:"setAuthorityDownloadable",value:function(){var e=(0,R.isAuthorityDownloadable)(this.ExternalServices),t=this.authorityDownloadable!==e;return t&&(this.authorityDownloadable=e),t}},{key:"collectTea",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=this.ExternalServices.LogService;n&&n.collectEvent&&n.collectEvent(e,Object.assign({source:"click_btn",block_type:"diagram"},t))}},{key:"handleEventsBinding",value:function(e){this.ExternalServices.EventEmitter[e](h.DiagramEvents.EXIT_GRAPH_EDITOR,this.handleExitGraphEditor),this.ExternalServices.EventEmitter[e]("showBlockEditbarWithComment",this.handleShowBlockEditbar),this.ExternalServices.EventEmitter[e]("hideBlockEditbar",this.handleHideBlockEditbar),this.editor[e]("fullscreenEntered",this.handleFullscreenOptionChange),this.editor[e]("fullscreenModeChanged",this.handleFullscreenOptionChange),this.editor[e]("fullscreenExited",this.handleFullscreenExited),this.event[e]("permissionUpdate",this.handlePermissionUpdate),this.documentEvent[e]("keydown",this.handleKeydown),c.browser.isMobile&&this.documentEvent[e]("click",this.handleDocumentClick)}},{key:"updateSvg",value:function(){var e,t=this.viewerModule.diagramRecord2Xml;t&&(e=t(this.record),this.diagramViewer.decode(e),this.svg=this.diagramViewer.getSvg(null),this.heightUpdateNotifier.notifyWillUpdate(),this.render())}},{key:"getDiagramEditBtn",value:function(){var e=this;return{key:"edit",Icon:function(){return u.default.createElement("div",{className:"edit-btn-wrapper"},u.default.createElement(p.default,null),u.default.createElement("span",{className:"edit-btn-text"},e.ExternalServices.t("CreationDoc_Docs_Diagram.Edit.Button")))},handler:this.handleEditDiagram,readOnlyVisibility:[]}}},{key:"getDiagramDownloadBtn",value:function(){var e=this.ExternalServices.t,t=(0,s.default)({"diagram-block-download-disable":!this.authorityDownloadable});return{key:"download",Icon:function(){return u.default.createElement(g.default,{className:t})},tooltip:this.authorityDownloadable?e("CreationDoc_Docs_DiagramBlock_DownloadPic_Button"):e("CreationDoc_ECM_AdminDisableToast"),handler:this.handleExportImage}}},{key:"updateToolbar",value:function(){var t,e=[],n=(0,R.isExportable)(this.context.permissions||null,this.ExternalServices);e=e.concat([this.getDiagramEditBtn(),a.CommonCommandKey.separator]),n&&(e=e.concat([this.getDiagramDownloadBtn()])),e=e.concat([a.CommonCommandKey.comment]),this.context&&this.context.updateEditbar&&(t=this.context.getCommandByKey,e=e.map(function(e){return t&&(0,a.isCommonCommandKey)(e)?t(e):e}),this.editbarCommands=e,this.context.updateEditbar(e,this))}},{key:"handlePermissionUpdate",value:function(e){this.permission&&this.permission.exportable===e.exportable||this.updateToolbar()}},{key:"handleEditDiagram",value:function(){var e=this.props.diagramType;this.isEditMode=!0,this.collectTea("click_enter_full_screen",{block_subtype:e}),this.ExternalServices.graphEditorManager.enter({manager:this.manager,blockId:this.blockId,blockElement:this.mountPoint.firstChild,diagramType:e})}},{key:"handleExportImage",value:function(){var e=this.ExternalServices.graphEditorManager.exportImage;this.authorityDownloadable&&e&&e(this.blockId)}},{key:"handleEditDiagramFromAuto",value:function(){var e=this.props.diagramType;this.isEditMode=!0,this.ExternalServices.graphEditorManager.enter({blockId:this.blockId,blockElement:this.mountPoint&&this.mountPoint.parentNode&&this.mountPoint.parentNode.firstChild,isCreateDiagram:!0,diagramType:e})}},{key:"handleEnterPreview",value:function(){this.manager&&!this.manager.isBlankDiagram()&&this.ExternalServices.EventEmitter.emit(h.DiagramEvents.OPEN_VIEWER,this.blockId)}},{key:"handleDocumentClick",value:function(e){var t,n,r;this.manager&&this.manager.isBlankDiagram()&&this.logoVisible&&(n=void 0,!(t=e.target.closest("."+a.BLOCK_PLACEHOLDER))||(r=(0,a.getBlockDataSet)(t))&&(n=r.blockId),n&&n===this.blockId||(this.logoVisible=!1,this.render()))}},{key:"handleDiagramClick",value:function(){var e=this.context.permissions,t=this.attributes.selected;c.browser.isMobile?this.manager&&this.manager.isBlankDiagram()?this.logoVisible||(this.logoVisible=!0,this.render()):this.mobileEditStats&&this.mobileEditStats.getIsEditing()&&!t||this.handleEnterPreview():(e&&e.editable&&!(e&&e.editable&&t)||this.handleEnterPreview(),this.editor.selection.updateBrowserSelectionFromRep(!0))}},{key:"handleRecordChange",value:function(){this.isEditMode||(this.record=this.manager&&this.manager.getRecord(),this.updateSvg())}},{key:"handleFullscreenOptionChange",value:function(e){this.fullscreenOptions&&this.fullscreenOptions.mode===a.PresentationMode.NON_PAGED&&e.mode===a.PresentationMode.PAGED&&(this.width=this.defaultStyle.width,this.fullscreenOptions=null,this.render()),this.fullscreenOptions=e}},{key:"handleFullscreenExited",value:function(){this.fullscreenOptions=null,this.heightUpdateNotifier.notifyWillUpdate(),this.render()}},{key:"handleExitGraphEditor",value:function(){var e=this.props.diagramType;this.isEditMode&&(this.isEditMode=!1,this.updateSvg(),this.collectTea("click_exit_full_screen",{block_subtype:e}))}},{key:"handleKeydown",value:function(e){this.attributes.selected&&e.which===a.KeyCode.Tab&&(e.preventDefault(),e.stopPropagation())}},{key:"handleShowBlockEditbar",value:function(e){var t=e.context;t&&t.block===this?(this.logoVisible=!0,this.render()):this.logoVisible&&(this.logoVisible=!1,this.render())}},{key:"handleHideBlockEditbar",value:function(){this.logoVisible&&(this.logoVisible=!1,this.render())}},{key:"collectText",value:function(){switch(this.props.diagramType){case h.DiagramType.FLOWCHART:return this.ExternalServices.t("CreationDoc_Docs_FlowDiagram_Title");case h.DiagramType.UML:return this.ExternalServices.t("CreationDoc_Docs_UMLDiagram_Title");default:return this.ExternalServices.t("CreationDoc_Docs_FlowDiagram_Title")}}},{key:"getSvg",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.diagramViewer&&this.manager?1===e?(this.svgCache&&this.svgCacheVersion===this.manager.getVersion()||(this.svgCache=this.diagramViewer.getSvg(null,e,c.browser.isMobile?12:16),this.svgCacheVersion=this.manager.getVersion()),this.svgCache):this.diagramViewer.getSvg(null,e,c.browser.isMobile?12:16):null}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=(0,a.generateBlockDataSet)({blockType:t,props:n,initData:this.manager?this.manager.getFixedRecord():(0,v.generateDiagramInitData)()}),i=this.ExternalServices.t("block.common_paste_unsupported");return{html:(0,a.generateBlockHTML)(r,i),text:i}}},{key:"notify",value:(j=M(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"screenshot"===t.eventType&&this.resize((0,y.getDocBodyWidth)());case 1:case"end":return e.stop()}},e,this)})),K)},{key:"getNotifyWidth",value:function(){return this.isInHistoryMode()?this.mountPoint.offsetWidth:this.width}},{key:"resize",value:function(e){this.isInTable||void 0===e||this.width===e||this.fullscreenOptions&&this.fullscreenOptions.mode===a.PresentationMode.PAGED||this.ExternalServices.Utils.isShortCut&&this.ExternalServices.Utils.isShortCut()||(this.heightUpdateNotifier.notifyWillUpdate(),this.width=e,this.render())}},{key:"blockDidMount",value:function(){var e;this.setWidth(),this.record&&this.manager&&(this.manager.isBlankDiagram()||(!this.manager.isDataError()||(e=this.ExternalServices.LogService)&&e.collectEvent&&e.collectEvent("client_diagram_error",{type:"dataError"}),this.updateSvg()),this.manager.addListener(this.handleRecordChange)),this.handleEventsBinding("on"),this.updateToolbar()}},{key:"blockDidCreate",value:function(){this.manager&&this.ExternalServices.graphEditorManager&&this.ExternalServices.graphEditorManager.setRecordManager({manager:this.manager,isCreateDiagram:!0,blockId:this.blockId})}},{key:"unmount",value:function(e){o(V.prototype.__proto__||Object.getPrototypeOf(V.prototype),"unmount",this).call(this,e),this.manager&&this.manager.removeListener(this.handleRecordChange),this.handleEventsBinding("off"),this.diagramViewer&&this.diagramViewer.destroy(),this.heightUpdateNotifier.destroy(),e&&(c.browser.isMobile?this.ExternalServices.EventEmitter.emit(h.DiagramEvents.DELETE_DIAGRAM_BLOCK,this.blockId):this.ExternalServices.graphEditorManager.exitWithBlockId(this.blockId)),this.mobileEditStats=null,this.editbarCommands=[]}},{key:"onTap",value:function(){return this.mobileEditStats&&this.mobileEditStats.getIsEditing()&&this.attributes.selected&&this.manager&&!this.manager.isBlankDiagram()?(this.handleEnterPreview(),{preventFocus:!0}):{preventFocus:!1}}},{key:"onDoubleTap",value:function(){return this.mobileEditStats&&!this.mobileEditStats.getIsEditing()?{preventFocus:!1}:(this.handleEnterPreview(),{preventFocus:!0})}},{key:"initDiagramViewer",value:function(e){var t=(this.viewerModule=e).DiagramViewer;this.diagramViewer=new t}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"getHistoryView",value:function(){var e=this.ExternalServices.mountOptions,t=void 0===e?{}:e,n=this.props.diagramType;if(t.historyMode===w.HISTORY_MODE.PLACEHOLDER){if(n===h.DiagramType.FLOWCHART||void 0===n)return u.default.createElement("div",{className:"diagram-placeholder"},u.default.createElement("div",{className:"diagram-placeholder-header"},u.default.createElement("img",{src:I.default,className:"diagram-placeholder-header-logo"}),u.default.createElement("span",null,this.ExternalServices.t("CreationDoc_Docs_FlowDiagram_Title"))),u.default.createElement("div",{className:"diagram-placeholder-content"},u.default.createElement("img",{src:T.default})));if(n===h.DiagramType.UML)return u.default.createElement("div",{className:"diagram-placeholder diagram-uml-placeholder"},u.default.createElement("div",{className:"diagram-placeholder-header"},u.default.createElement("img",{src:S.default,className:"diagram-placeholder-header-logo"}),u.default.createElement("span",null,this.ExternalServices.t("CreationDoc_Docs_UMLDiagram_Title"))),u.default.createElement("div",{className:"diagram-placeholder-content"},u.default.createElement("img",{src:O.default})))}return n===h.DiagramType.FLOWCHART||void 0===n?u.default.createElement("div",{className:"diagram-placeholder-new"},u.default.createElement(k.default,null),u.default.createElement("span",{className:"diagram-placeholder-new-title"},this.ExternalServices.t("CreationDoc_Docs_FlowDiagram_Title"))):u.default.createElement("div",{className:"diagram-placeholder-new"},u.default.createElement(C.default,null),u.default.createElement("span",{className:"diagram-placeholder-new-title"},this.ExternalServices.t("CreationDoc_Docs_UMLDiagram_Title")))}},{key:"setRecordManager",value:(F=M(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getToken(),n=this.ExternalServices.io,t&&n&&!this.manager)return this.manager=new m.default(t,n,this.ExternalServices),e.next=6,this.manager.fetchClientVars();e.next=7;break;case 6:this.record=this.manager&&this.manager.getRecord();case 7:case"end":return e.stop()}},e,this)})),G)},{key:"render",value:(P=M(regeneratorRuntime.mark(function e(){var t,n,r,i,o,a,s=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.width,n=this.attributes.selected,r=this.attributes.selectState,i=this.context.permissions,o=this.props.diagramType,c.browser.isMobile||(n=n&&!!i&&i.editable),this.isInHistoryMode())return d.default.render(this.getHistoryView(),this.mountPoint),e.abrupt("return");e.next=9;break;case 9:return this.setAuthorityDownloadable()&&this.updateToolbar(),e.next=12,this.setRecordManager();case 12:if(this.record){e.next=14;break}return e.abrupt("return");case 14:if(this.diagramViewer){e.next=19;break}return e.next=17,this.ExternalServices.getDiagramViewer&&this.ExternalServices.getDiagramViewer();case 17:a=e.sent,this.initDiagramViewer(a);case 19:return o=o||h.DiagramType.FLOWCHART,e.next=22,new Promise(function(e){d.default.render(u.default.createElement(f.default,{width:t,selected:n,selectState:r,logoVisible:n||s.logoVisible,svg:s.svg,ExternalServices:s.ExternalServices,manager:s.manager,onClick:s.handleDiagramClick,diagramType:o}),s.mountPoint,function(){e(),s.heightUpdateNotifier.notifyDidUpdate()})});case 22:case"end":return e.stop()}},e,this)})),W)},{key:"zoneId",get:function(){var e=this.getPlugin().getBlockRep(this);return e?e.selStart[2]:c.DEFAULT_REP_ZONE}},{key:"isInTable",get:function(){return this.zoneId!==c.DEFAULT_REP_ZONE}}]),V);function V(e,t,n,r,i){N(this,V);var o=A(this,(V.__proto__||Object.getPrototypeOf(V)).call(this,e,t));return o.ExternalServices=n,o.editor=r,o.mobileEditStats=i,o.width=o.defaultStyle.width,o.svg=null,o.fullscreenOptions=null,o.isEditMode=!1,o.logoVisible=!1,o.svgCache=null,o.svgCacheVersion=null,o.authorityDownloadable=!0,o.heightUpdateNotifier=new b.default({getContext:function(){return o.context},getBlockId:function(){return o.blockId}}),o.documentEvent=E.GlobalDOMEventEmitter.get(document),o.editbarTrigger=a.Trigger.hover,o.editbarCommands=[],o.permission=null,o.manager=null,o.record=null,o.setWidth(),o.setAuthorityDownloadable(),o}function W(){return P.apply(this,arguments)}function G(){return F.apply(this,arguments)}function K(e){return j.apply(this,arguments)}t.default=U,z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"updateToolbar",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",["function"==typeof(L=void 0!==c.Permission&&c.Permission)?L:Object]),H("design:returntype",void 0)],U.prototype,"handlePermissionUpdate",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleEditDiagram",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleExportImage",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleEditDiagramFromAuto",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleEnterPreview",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",void 0)],U.prototype,"handleDocumentClick",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleDiagramClick",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleRecordChange",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",["function"==typeof(D=void 0!==a.FullscreenOptions&&a.FullscreenOptions)?D:Object]),H("design:returntype",void 0)],U.prototype,"handleFullscreenOptionChange",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleFullscreenExited",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleExitGraphEditor",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",["function"==typeof(B="undefined"!=typeof KeyboardEvent&&KeyboardEvent)?B:Object]),H("design:returntype",void 0)],U.prototype,"handleKeydown",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[Object]),H("design:returntype",void 0)],U.prototype,"handleShowBlockEditbar",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",void 0)],U.prototype,"handleHideBlockEditbar",null),z([(0,a.Debounce)(150),H("design:type",Function),H("design:paramtypes",[Number]),H("design:returntype",void 0)],U.prototype,"resize",null),z([(0,a.Bind)(),H("design:type",Function),H("design:paramtypes",[]),H("design:returntype",Promise)],U.prototype,"setRecordManager",null)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(0),u=s(o),d=s(n(4)),f=n(1),h=s(n(190)),p=s(n(191)),a=s(n(192));n(193);var g=n(27);function s(e){return e&&e.__esModule?e:{default:e}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},E=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},k="diagram-block",C=(y(I,o.Component),r(I,[{key:"renderNoContent",value:function(){var e=this.props.ExternalServices;return u.default.createElement("div",{className:k+"_no-content"},u.default.createElement(a.default,{className:k+"_no-content-img"}),u.default.createElement("span",null,e.t("CreationDoc_Docs_Diagram.NoContent.Desc")))}},{key:"setRef",value:function(e){this.svgContainer=e}},{key:"componentDidUpdate",value:function(e){var t,n,r,i=this.props,o=i.svg,a=i.width,s=void 0===a?0:a;(e.width!==s||e.svg!==o)&&o&&this.svgContainer&&(t=parseInt(o.getAttribute("width")||"0"),r=(n=parseInt(o.getAttribute("height")||"0"))/t,t<s?(this.svgContainer.style.width=t+"px",this.svgContainer.style.height=n+"px",this.svgContainer.style.paddingBottom="0"):(this.svgContainer.style.paddingBottom=100*r+"%",this.svgContainer.style.width="100%",this.svgContainer.style.height="0"))}},{key:"render",value:function(){var e,t=this.props,n=t.selected,r=t.width,i=t.ExternalServices,o=t.svg,a=t.manager,s=t.logoVisible,l=t.diagramType,c=t.selectState;return u.default.createElement("div",{className:(0,d.default)(k,(v(e={},k+"_selected",c!==f.SelectionState.COVER_ON_BLOCK&&n),v(e,k+"_covered",c===f.SelectionState.COVER_ON_BLOCK),v(e,k+"_blank",a&&a.isBlankDiagram()),e)),style:{width:r},onMouseDown:this.props.onClick},s&&u.default.createElement("div",{className:k+"_logo"},l===g.DiagramType.FLOWCHART&&u.default.createElement(u.default.Fragment,null,u.default.createElement(h.default,null),u.default.createElement("span",null,i.t("CreationDoc_Docs_FlowDiagram_Title"))),l===g.DiagramType.UML&&u.default.createElement(u.default.Fragment,null,u.default.createElement(p.default,null),u.default.createElement("span",null,i.t("CreationDoc_Docs_UMLDiagram_Title")))),a&&!a.isBlankDiagram()&&o?u.default.createElement("div",{ref:this.setRef,className:k+"_svg",dangerouslySetInnerHTML:{__html:o.outerHTML}}):this.renderNoContent(),u.default.createElement("span",{className:"j-copy-span"}))}}]),I);function I(e){c(this,I);var t=m(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,e));return t.svgContainer=null,t}t.default=C,b([(0,f.Bind)(),E("design:type",Function),E("design:paramtypes",[Object]),E("design:returntype",void 0)],C.prototype,"setRef",null)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("g",{clipPath:"url(#clip0)",fillRule:"evenodd",clipRule:"evenodd"},i.default.createElement("path",{d:"M0 2C0 .9.9 0 2 0h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z",fill:"#F80"}),i.default.createElement("path",{d:"M10.04 6.4l1.22-1.2 1.21 1.2-1.21 1.2-1.22-1.2zm-3.29.64h2.16l.25.24 1.21 1.2.89.88.89-.87 1.21-1.2.89-.89-.89-.87-1.21-1.2-.9-.89-.88.88-1.21 1.2-.27.27H6a.5.5 0 0 0-.5.5V8.68h-2a.5.5 0 0 0-.5.5v.25c0 .27.22.5.5.5h2V12.32c0 .28.22.5.5.5h2.63v.75c0 .28.22.5.5.5h4.3a.5.5 0 0 0 .5-.5v-2.75a.5.5 0 0 0-.5-.5h-4.3a.5.5 0 0 0-.5.5v.75H6.75V7.04zm3.13 5.78v-1.25h2.8v1.25h-2.8z",fill:"#fff"})))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 2C0 .9.9 0 2 0h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2z",fill:"#4954E6"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.75 5.79v4.41a2 2 0 0 0 4.01 0V5.8h-1.2v4.41a.8.8 0 1 1-1.6 0V5.8H1.74zm5.22 0h1.2v6.42h-1.2V5.8zm4.41 0h1.2v6.42h-1.2V9.03l-1.07 3.18H9.24l-1.07-3.2V5.78l1.6 4.62 1.61-4.62zm2.41 0h1.2v5.22H17v1.2h-3.21V5.8z",fill:"#fff"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("g",{clipPath:"url(#clip0)"},i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M23.03 99.96H94.1V13.47H23.03v86.49z",fill:"#D6DAE1"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M83.78 84.68l-49.45.18-.14-60.26 49.45-.18.14 60.26z",fill:"#F4F5F9"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M39.43 9l20.63 20.38L80.68 9H39.43z",fill:"#B5BEC8"}),i.default.createElement("path",{d:"M41.42 35.67l35.57.14M40.42 42.13l35.58.14",stroke:"#fff",strokeWidth:"2"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M60.62 109.62l6.4-5.22-41.8-51.08-6.39 5.22 41.8 51.08z",fill:"#FFC200"}),i.default.createElement("path",{d:"M15.04 55.13l-1.87-9.33 7.67 4.3M110.25 47.56c-18.42 15.6-26.68 34.6-24.8 57.03-8.95-13.8-18.92-21.75-29.9-23.84",stroke:"#18263C",strokeLinecap:"round",strokeLinejoin:"round"})))}},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.7 16.16h2.67l7.94-7.95a.7.7 0 0 0 0-.98l-2.4-2.42a.7.7 0 0 0-1 0l-.49.5L5 12.78v2.67c0 .38.31.7.7.7zm7.5-9.48l1.16 1.17-.92.93-1.16-1.16.91-.94zm-.99 3.44L11 8.9l-4.16 4.24 1.18 1.18 4.2-4.2zm6.44 7.38H5.35c-.2 0-.35.17-.35.37v.75c0 .21.16.38.35.38h13.3c.2 0 .35-.17.35-.38v-.75c0-.2-.16-.37-.35-.37z"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M18.75 16.88v1.87c0 .41-.34.75-.75.75H6a.75.75 0 0 1-.75-.75v-1.88c0-.2.17-.37.38-.37h.75c.2 0 .37.17.37.38V18h10.5v-1.13c0-.2.17-.37.38-.37h.75c.2 0 .37.17.37.38zm-6-3.35l2.26-2.26a.38.38 0 0 1 .53 0l.53.53c.14.15.14.38 0 .53l-3.71 3.71a.37.37 0 0 1-.53 0L8.1 12.33a.37.37 0 0 1 0-.53l.53-.53a.38.38 0 0 1 .53 0l2.08 2.07V5.25c0-.2.17-.38.38-.38h.74c.21 0 .38.17.38.38v8.28z"}))}},function(e,t){e.exports=o("wvVt")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"730",height:"160",viewBox:"0 0 730 160",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M4 .5h722a3.5 3.5 0 0 1 3.5 3.5v152a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 156V4A3.5 3.5 0 0 1 4 .5z",fill:"#fff",stroke:"#DEE0E3"}),i.default.createElement("g",{clipPath:"url(#a)",fillRule:"evenodd",clipRule:"evenodd"},i.default.createElement("path",{d:"M16 17c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V17z",fill:"#F80"}),i.default.createElement("path",{d:"M26.04 21.4l1.22-1.2 1.21 1.2-1.21 1.2-1.22-1.2zm-3.29.64h2.16l.25.24 1.21 1.2.89.88.89-.87 1.21-1.2.89-.89-.89-.87-1.21-1.2-.9-.89-.88.88-1.21 1.2-.27.27H22a.5.5 0 0 0-.5.5V23.68h-2a.5.5 0 0 0-.5.5v.25c0 .27.22.5.5.5h2V27.32c0 .28.22.5.5.5h2.63v.75c0 .28.22.5.5.5h4.3a.5.5 0 0 0 .5-.5v-2.75a.5.5 0 0 0-.5-.5h-4.3a.5.5 0 0 0-.5.5v.75h-1.88v-4.53zm3.13 5.78v-1.25h2.8v1.25h-2.8z",fill:"#fff"})),i.default.createElement("path",{d:"M44.76 23.55c2.4-.14 4.62-.33 6.66-.57.23.34.44.69.63 1.02l1.11-.77c-.5-.87-1.25-1.87-2.21-3.02l-1.08.66.81 1.05c-1.4.15-2.81.28-4.21.37.45-.53.94-1.28 1.5-2.26h5.1v-1.2h-3.6c-.17-.54-.36-1.03-.54-1.48l-1.36.23c.2.39.38.8.55 1.26h-3.74v1.19h2.21c-.75 1.23-1.37 2-1.86 2.3l-.26.1.29 1.12zm-2.8-5.9l-.97.92c.93.64 1.66 1.26 2.17 1.82l.96-.95c-.6-.6-1.32-1.2-2.16-1.8zm-.34 3.34l-.95.93c.95.72 1.68 1.41 2.2 2.05l.95-.95a15.7 15.7 0 0 0-2.2-2.03zm1.14 3.78a47.54 47.54 0 0 1-1.84 4.94l1.22.55a49.23 49.23 0 0 0 1.8-5.04l-1.18-.45zm4.74-.74v6.13h1.35v-6.13H47.5zm-2.28 0c-.05 1.61-.2 2.76-.45 3.46a4.36 4.36 0 0 1-1.35 1.89l.85 1.05a5.71 5.71 0 0 0 1.7-2.34c.3-.87.48-2.21.54-4.06h-1.29zm6.86 6.27c.62-.04 1.01-.2 1.2-.47.17-.3.27-1.11.27-2.43l-1.16-.43c0 .67-.03 1.2-.06 1.57-.02.33-.12.53-.3.56h-.5c-.15-.03-.22-.13-.22-.28v-4.79h-1.26v5.04c0 .81.46 1.23 1.42 1.23h.61zm8.36-12.32v4.24h6.15v-4.24h-6.15zm4.86 3.05h-3.56v-1.87h3.56v1.87zM60 23.3v1.2h2.76v1.46h-2.43v1.2h2.43v1.55h-3.29v1.26h7.91V28.7h-3.27v-1.56h2.5v-1.19h-2.5v-1.45h2.94v-1.2H60zm-5.23-2.06v1.28h1.78a10.5 10.5 0 0 1-2.13 3.8l.59 1.48c.68-.98 1.24-2.08 1.7-3.25v5.84h1.27v-6.02c.33.47.71 1.07 1.16 1.8l.74-1.12c-.64-.7-1.27-1.36-1.9-1.94v-.6h1.6v-1.27h-1.6v-1.9c.67-.13 1.3-.27 1.9-.43l-.46-1.26c-1.36.42-2.9.71-4.64.85l.27 1.25 1.65-.2v1.7h-1.93zM73.5 19.4a5.57 5.57 0 0 1-2.49 2.54l.73.97c.47-.3.9-.63 1.29-.97.33.34.72.66 1.17.97-.92.4-2.07.69-3.41.91l.57 1.06c1.54-.35 2.84-.78 3.9-1.31.96.5 2.08.92 3.38 1.27l.69-1c-1.11-.24-2.09-.55-2.96-.94A5.22 5.22 0 0 0 78 21.08v-.9h-3.6c.1-.2.2-.4.28-.63l-1.18-.15zm1.8 2.96a8.06 8.06 0 0 1-1.59-1.14c0-.03.03-.05.06-.07h2.9c-.34.44-.8.85-1.38 1.21zm-2.72 3.77l-.5 1c1.86.36 3.65.85 5.38 1.48l.44-1.07a33 33 0 0 0-5.32-1.41zM74 24.24l-.6.87c1.04.3 2.07.73 3.06 1.27l.62-.95c-.93-.46-1.96-.85-3.08-1.19zm6.84-6.2h-11.7v12.4h1.3v-.49h9.1v.5h1.3V18.03zm-10.4 10.74V19.2h9.1v9.57h-9.1z",fill:"#fff"}),i.default.createElement("g",{clipPath:"url(#b)",fillRule:"evenodd",clipRule:"evenodd"},i.default.createElement("path",{d:"M16 50c0-1.1.9-2 2-2h142a2 2 0 0 1 2 2v56a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V50z",fill:"#EFF0F1"}),i.default.createElement("path",{d:"M193 74.5l7 3.5-7 3.5v-3h-31v-1h31v-3z",fill:"#BBBFC4"}),i.default.createElement("path",{d:"M273.12 48.15a1 1 0 0 1 .76 0l70.85 28.92a1 1 0 0 1 0 1.86l-70.85 28.92a1 1 0 0 1-.76 0l-70.85-28.92a1 1 0 0 1 0-1.86l70.85-28.92z",fill:"#EFF0F1"}),i.default.createElement("path",{d:"M378 74.5l7 3.5-7 3.5v-3h-31v-1h31v-3z",fill:"#BBBFC4"}),i.default.createElement("path",{d:"M385 50c0-1.1.9-2 2-2h141a2 2 0 0 1 2 2v56a2 2 0 0 1-2 2H387a2 2 0 0 1-2-2V50z",fill:"#EFF0F1"}),i.default.createElement("path",{d:"M561 74.5l7 3.5-7 3.5v-3h-31v-1h31v-3z",fill:"#BBBFC4"}),i.default.createElement("path",{d:"M568 78a30 30 0 0 1 30-30h86a30 30 0 1 1 0 60h-86a30 30 0 0 1-30-30z",fill:"#EFF0F1"})),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M273.5 108a.5.5 0 0 0-.5.5V143H92v-26.5a.5.5 0 0 0-1 0V144h183v-35.5a.5.5 0 0 0-.5-.5z",fill:"#BBBFC4"}),i.default.createElement("path",{d:"M91.5 110l-3.5 7h7l-3.5-7z",fill:"#BBBFC4"}),i.default.createElement("defs",null,i.default.createElement("clipPath",{id:"a"},i.default.createElement("path",{fill:"#fff",transform:"translate(16 15)",d:"M0 0h18v18H0z"})),i.default.createElement("clipPath",{id:"b"},i.default.createElement("path",{fill:"#fff",transform:"translate(16 48)",d:"M0 0h698v60H0z"}))))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"730",height:"160",viewBox:"0 0 730 160",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M4 .5h722a3.5 3.5 0 0 1 3.5 3.5v152a3.5 3.5 0 0 1-3.5 3.5H4A3.5 3.5 0 0 1 .5 156V4A3.5 3.5 0 0 1 4 .5z",fill:"#fff",stroke:"#DEE0E3"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 17c0-1.1.9-2 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V17z",fill:"#4954E6"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.75 20.79v4.41a2 2 0 0 0 4.01 0V20.8h-1.2v4.41a.8.8 0 1 1-1.6 0V20.8h-1.21zm5.22 0h1.2v6.42h-1.2V20.8zm4.41 0h1.2v6.42h-1.2v-3.18l-1.07 3.18h-1.07L24.17 24v-3.21l1.6 4.62 1.61-4.62zm2.41 0h1.2v5.22H33v1.2h-3.21V20.8z",fill:"#fff"}),i.default.createElement("path",{d:"M40.98 19v6.2c0 1.3.36 2.29 1.1 2.99.7.67 1.7 1 3.03 1 1.32 0 2.32-.34 3.04-1.02.71-.68 1.08-1.68 1.08-2.98V19H47.7v6.22c0 .9-.21 1.55-.62 1.99-.42.43-1.07.66-1.97.66-.91 0-1.57-.23-1.99-.66-.42-.44-.61-1.1-.61-1.99V19h-1.53zm10.2 0v10h1.53v-7.14h.05L55.83 29h1.31l3.07-7.14h.06V29h1.52V19H60l-3.48 8.01h-.04l-3.48-8h-1.81zm12.58 0v10h7.01v-1.3h-5.5V19h-1.51zm17.45.4a5.57 5.57 0 0 1-2.49 2.54l.73.97c.47-.3.9-.63 1.29-.97.33.34.72.66 1.17.97-.92.4-2.07.69-3.41.91l.57 1.06c1.54-.35 2.84-.78 3.9-1.31.96.5 2.08.92 3.38 1.27l.69-1c-1.1-.24-2.09-.55-2.96-.94a5.22 5.22 0 0 0 1.63-1.82v-.9h-3.6c.1-.2.2-.4.28-.63l-1.18-.15zm1.8 2.96a8.06 8.06 0 0 1-1.59-1.14c0-.03.03-.05.06-.07h2.9c-.34.44-.8.85-1.38 1.21zm-2.72 3.77l-.5 1c1.86.36 3.65.85 5.38 1.48l.44-1.07a33 33 0 0 0-5.32-1.41zm1.43-1.89l-.6.87c1.04.3 2.07.73 3.06 1.27l.62-.95c-.93-.46-1.96-.85-3.08-1.19zm6.84-6.2h-11.7v12.4h1.3v-.49h9.1v.5h1.3V18.03zm-10.4 10.74V19.2h9.1v9.57h-9.1z",fill:"#fff"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 50c0-1.1.9-2 2-2h142a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H18a2 2 0 0 1-2-2V50zM200 50c0-1.1.9-2 2-2h142a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H202a2 2 0 0 1-2-2V50zM384 50c0-1.1.9-2 2-2h142a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H386a2 2 0 0 1-2-2V50zM568 50c0-1.1.9-2 2-2h142a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H570a2 2 0 0 1-2-2V50z",fill:"#EFF0F1"}),i.default.createElement("path",{d:"M90 130.5l7 3.5v-7l-7 3.5z",fill:"#BBBFC4"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M97 130h544v1H97v-1zM89 85h177v1H89v-1z",fill:"#BBBFC4"}),i.default.createElement("path",{d:"M273 85.5l-7-3.5v7l7-3.5z",fill:"#BBBFC4"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M273 98h177v1H273v-1z",fill:"#BBBFC4"}),i.default.createElement("path",{d:"M457 98.5l-7-3.5v7l7-3.5z",fill:"#BBBFC4"}),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M457 111h177v1H457v-1z",fill:"#BBBFC4"}),i.default.createElement("path",{d:"M641 111.5l-7-3.5v7l7-3.5z",fill:"#BBBFC4"}),i.default.createElement("path",{stroke:"#BBBFC4",strokeDasharray:"3 3",d:"M89.5 72v72M273.5 72v72M457.5 72v72M641.5 72v72"}))}},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMy4xNTU5IDguOTk5OUwxNS4wMTE4IDcuMTYzMjNMMTYuODY3NyA4Ljk5OTlMMTUuMDExOCAxMC44MzY2TDEzLjE1NTkgOC45OTk5Wk05IDkuNzUwMDJIMTEuNzgxNUwxMi4wODk3IDEwLjA1NUwxMy45NDU2IDExLjg5MTdMMTUuMDExOCAxMi45NDY4TDE2LjA3NzkgMTEuODkxN0wxNy45MzM4IDEwLjA1NUwxOSA4Ljk5OTlMMTcuOTMzOCA3Ljk0NDc4TDE2LjA3NzkgNi4xMDgxTDE1LjAxMTggNS4wNTI5OEwxMy45NDU2IDYuMTA4MUwxMi4wODk3IDcuOTQ0NzhMMTEuNzgxMyA4LjI1MDAySDlWOC4yNDk5Nkg4QzcuNzIzODYgOC4yNDk5NiA3LjUgOC40NzM4MiA3LjUgOC43NDk5NlY4Ljc1MDAyVjkuNzUwMDJWMTJINC41QzQuMjIzODYgMTIgNCAxMi4yMjM5IDQgMTIuNVYxM0M0IDEzLjI3NjIgNC4yMjM4NiAxMy41IDQuNSAxMy41SDcuNVYxNS43NVYxNi43NUM3LjUgMTcuMDI2MSA3LjcyMzg2IDE3LjI1IDggMTcuMjVIOUgxMS41VjE4LjVDMTEuNSAxOC43NzYyIDExLjcyMzkgMTkgMTIgMTlIMThDMTguMjc2MSAxOSAxOC41IDE4Ljc3NjIgMTguNSAxOC41VjE0LjVDMTguNSAxNC4yMjM5IDE4LjI3NjEgMTQgMTggMTRIMTJDMTEuNzIzOSAxNCAxMS41IDE0LjIyMzkgMTEuNSAxNC41VjE1Ljc1SDlWOS43NTAwMlpNMTMgMTcuNVYxNS41SDE3VjE3LjVIMTNaIiBmaWxsPSIjRkY4ODAwIi8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xOCA4SDE5LjVWMTQuNUgyMlYxNkgxOS41SDE4VjE0LjVWOFpNMyA4LjAwMDAyVjEzLjVDMyAxNC44ODA3IDQuMTE5MjkgMTYgNS41IDE2QzYuODgwNzEgMTYgOCAxNC44ODA3IDggMTMuNVY4LjAwMDAySDYuNVYxMy41QzYuNSAxNC4wNTIzIDYuMDUyMjggMTQuNSA1LjUgMTQuNUM0Ljk0NzcyIDE0LjUgNC41IDE0LjA1MjMgNC41IDEzLjVWOC4wMDAwMkgzWk05LjUgOC4wMDAwMkgxMUwxMyAxMy43NkwxNSA4LjAwMDAySDE2LjVWMTZIMTVWMTIuMDM0NEwxMy42NjY3IDE2SDEyLjMzMzNMMTEgMTJWMTZIOS41VjguMDAwMDJaIiBmaWxsPSIjNDk1NEU2Ii8+Cjwvc3ZnPgo="},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQ0IiBoZWlnaHQ9Ijc2IiB2aWV3Qm94PSIwIDAgMjQ0IDc2IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDApIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0wIDJDMCAwLjg5NTQzMSAwLjg5NTQzMSAwIDIgMEg2M0M2NC4xMDQ2IDAgNjUgMC44OTU0MzEgNjUgMlY0MkM2NSA0My4xMDQ2IDY0LjEwNDYgNDQgNjMgNDRIMkMwLjg5NTQzMSA0NCAwIDQzLjEwNDYgMCA0MlYyWiIgZmlsbD0iI0VGRjBGMSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTgxIDE4LjVMODggMjJMODEgMjUuNVYyMi41SDY1VjIxLjVIODFWMTguNVoiIGZpbGw9IiNCQkJGQzQiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMjEuMjI2IDAuMTgwMjQ1QzEyMS4zOTIgMC4wNzA4MjQ0IDEyMS42MDggMC4wNzA4MjQ3IDEyMS43NzQgMC4xODAyNDVMMTU0LjM2NCAyMS41ODIxQzE1NC42NjQgMjEuNzc5NiAxNTQuNjY0IDIyLjIyMDUgMTU0LjM2NCAyMi40MTc5TDEyMS43NzQgNDMuODE5OEMxMjEuNjA4IDQzLjkyOTIgMTIxLjM5MiA0My45MjkyIDEyMS4yMjYgNDMuODE5OEw4OC42MzY0IDIyLjQxNzlDODguMzM1NyAyMi4yMjA1IDg4LjMzNTcgMjEuNzc5NiA4OC42MzY0IDIxLjU4MjFMMTIxLjIyNiAwLjE4MDI0NVoiIGZpbGw9IiNFRkYwRjEiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNzEgMTguNUwxNzggMjJMMTcxIDI1LjVWMjIuNUgxNTVWMjEuNUgxNzFWMTguNVoiIGZpbGw9IiNCQkJGQzQiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xNzggMjJDMTc4IDkuODQ5NzQgMTg3Ljg1IDAgMjAwIDBIMjIyQzIzNC4xNSAwIDI0NCA5Ljg0OTc0IDI0NCAyMkMyNDQgMzQuMTUwMyAyMzQuMTUgNDQgMjIyIDQ0SDIwMEMxODcuODUgNDQgMTc4IDM0LjE1MDMgMTc4IDIyWiIgZmlsbD0iI0VGRjBGMSIvPgo8L2c+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjkgNTFMMzIuNSA0NEwzNiA1MUgzM1Y3NUgxMjFWNDQuNUMxMjEgNDQuMjIzOSAxMjEuMjI0IDQ0IDEyMS41IDQ0QzEyMS43NzYgNDQgMTIyIDQ0LjIyMzkgMTIyIDQ0LjVWNzUuNUMxMjIgNzUuNzc2MSAxMjEuNzc2IDc2IDEyMS41IDc2SDMyLjVDMzIuMjkyOSA3NiAzMi4xMTUyIDc1Ljg3NDEgMzIuMDM5MyA3NS42OTQ2QzMyLjAxNzcgNzUuNjQzNyAzMi4wMDQ0IDc1LjU4ODQgMzIuMDAwOSA3NS41MzA1QzMyLjAwMDMgNzUuNTIwNCAzMiA3NS41MTAzIDMyIDc1LjVWNTFIMjlaIiBmaWxsPSIjQkJCRkM0Ii8+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwIj4KPHJlY3Qgd2lkdGg9IjI0NCIgaGVpZ2h0PSI0NCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"},function(e,t){e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQ0IiBoZWlnaHQ9Ijc2IiB2aWV3Qm94PSIwIDAgMjQ0IDc2IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTAgMkMwIDAuODk1NDMgMC44OTU0MzEgMCAyIDBINjRDNjUuMTA0NiAwIDY2IDAuODk1NDMxIDY2IDJWMjJDNjYgMjMuMTA0NiA2NS4xMDQ2IDI0IDY0IDI0SDJDMC44OTU0MjkgMjQgMCAyMy4xMDQ2IDAgMjJWMloiIGZpbGw9IiNFRkYwRjEiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik04OSAyQzg5IDAuODk1NDMgODkuODk1NCAwIDkxIDBIMTUzQzE1NC4xMDUgMCAxNTUgMC44OTU0MzEgMTU1IDJWMjJDMTU1IDIzLjEwNDYgMTU0LjEwNSAyNCAxNTMgMjRIOTFDODkuODk1NCAyNCA4OSAyMy4xMDQ2IDg5IDIyVjJaIiBmaWxsPSIjRUZGMEYxIi8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTc4IDJDMTc4IDAuODk1NDMgMTc4Ljg5NSAwIDE4MCAwSDI0MkMyNDMuMTA1IDAgMjQ0IDAuODk1NDMxIDI0NCAyVjIyQzI0NCAyMy4xMDQ2IDI0My4xMDUgMjQgMjQyIDI0SDE4MEMxNzguODk1IDI0IDE3OCAyMy4xMDQ2IDE3OCAyMlYyWiIgZmlsbD0iI0VGRjBGMSIvPgo8cGF0aCBkPSJNMzQgNjQuNUw0MSA2OFY2MUwzNCA2NC41WiIgZmlsbD0iI0JCQkZDNCIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTQxIDY0SDIxMVY2NUg0MVY2NFoiIGZpbGw9IiNCQkJGQzQiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0zNCAzNkgxMTVWMzdIMzRWMzZaIiBmaWxsPSIjQkJCRkM0Ii8+CjxwYXRoIGQ9Ik0xMjIgMzYuNUwxMTUgMzNWNDBMMTIyIDM2LjVaIiBmaWxsPSIjQkJCRkM0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMTIzIDQ5SDIwNFY1MEgxMjNWNDlaIiBmaWxsPSIjQkJCRkM0Ii8+CjxwYXRoIGQ9Ik0yMTEgNDkuNUwyMDQgNDZWNTNMMjExIDQ5LjVaIiBmaWxsPSIjQkJCRkM0Ii8+CjxsaW5lIHgxPSIzMy41IiB5MT0iMjQiIHgyPSIzMy41IiB5Mj0iNzYiIHN0cm9rZT0iI0JCQkZDNCIgc3Ryb2tlLWRhc2hhcnJheT0iMyAzIi8+CjxsaW5lIHgxPSIxMjIuNSIgeTE9IjI0IiB4Mj0iMTIyLjUiIHkyPSI3NiIgc3Ryb2tlPSIjQkJCRkM0IiBzdHJva2UtZGFzaGFycmF5PSIzIDMiLz4KPGxpbmUgeDE9IjIxMS41IiB5MT0iMjQiIHgyPSIyMTEuNSIgeTI9Ijc2IiBzdHJva2U9IiNCQkJGQzQiIHN0cm9rZS1kYXNoYXJyYXk9IjMgMyIvPgo8L3N2Zz4K"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(54);Object.defineProperty(t,"blockWidthNotifyModule",{enumerable:!0,get:function(){return l(r).default}});var i=n(52);Object.defineProperty(t,"ResizeModule",{enumerable:!0,get:function(){return l(i).default}});var o=n(9);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var a=n(40);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=n(53);function l(e){return e&&e.__esModule?e:{default:e}}Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.katexManager=t.EquationView=t.equationInsert=void 0;var r=n(205);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(214);Object.defineProperty(t,"equationInsert",{enumerable:!0,get:function(){return i.equationInsert}});var o=n(75);Object.defineProperty(t,"EquationView",{enumerable:!0,get:function(){return l(o).default}});var a=n(11);Object.defineProperty(t,"katexManager",{enumerable:!0,get:function(){return a.katexManager}});var s=l(r);function l(e){return e&&e.__esModule?e:{default:e}}t.default=s.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n(8)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=n(1),c=u(n(10)),a=n(11),s=u(n(206));function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var p=(h(g,l.Creator),i(g,[{key:"onBlockInitOnly",value:function(){(0,a.initStyle)()}},{key:"create",value:function(e,t,n){return new s.default(e,t,this.ExternalServices,{editor:n})}},{key:"onPaste",value:function(e){var t=e.text,n=e.purifiedHtml,r=e.pasteDataWrapper;if(!t||n&&n.includes("ace-line"))return e;var i=/^\$\$([\s\S]*)\$\$$/.exec(t);if(!i)return e;var o=i[1],a=(0,l.generateBlockDataSet)({blockType:l.BlockType.EQUATION_BLOCK,props:Object.assign({},this.defaultProps,{data:{equation:o}})}),s=(0,l.generateBlockHTML)(a);return{pasteDataWrapper:(0,c.default)(r).html(s)[0],purifiedHtml:s,text:t}}},{key:"onInternalPaste",value:function(e){var t=e.dataset;return(0,l.generateBlockDataSet)({blockType:l.BlockType.EQUATION_BLOCK,props:Object.assign({},this.defaultProps,{data:{equation:(0,r.default)(t,"props.data.equation")}})})}}]),g);function g(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder;d(this,g);var i=f(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return i.blockType=l.BlockType.EQUATION_BLOCK,i.defaultProps={displayMode:l.BlockDisplayMode.INLINE,viewType:l.ViewTypes.INLINE,data:{equation:""}},i.ExternalServices=t,i}t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=g(n(8)),r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},a=g(n(0)),l=g(n(5)),c=n(1),u=n(3),d=n(16),f=g(n(7)),h=n(11),p=g(n(75));function g(e){return e&&e.__esModule?e:{default:e}}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n(213);var b=(y(E,c.Block),r(E,[{key:"blockDidMount",value:function(){this.useLocalEquation&&this.hanldeUseLocal()}},{key:"unmount",value:function(e){clearTimeout(this.resetUserLocalEquation),o(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"unmount",this).call(this,e),l.default.unmountComponentAtNode(this.mountPoint),this.heightUpdateNotifier.destroy()}},{key:"collectText",value:function(){return"$$"+this.props.data.equation.trim()+"$$"}},{key:"placeholderHtml",value:function(){return'<span class="equation-view equation-view-loading"><span class="equation-view-loading-box" /></span>'}},{key:"placeholderJsx",value:function(){return a.default.createElement("span",{className:"equation-view equation-view-loading"},a.default.createElement("span",{className:"equation-view-loading-box"}))}},{key:"getDefaultVisible",value:function(e){if(e&&e.initData){var t=unescape(e.initData);if((0,u.isJsonString)(t))try{return JSON.parse(t).defaultVisible}catch(e){}}return!1}},{key:"hanldeUseLocal",value:function(){var e=this;this.resetUserLocalEquation=window.setTimeout(function(){e.useLocalEquation=!1,e.equation!==e.localEquation&&e.handleInput(e.localEquation)},1e3)}},{key:"resize",value:function(){}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=(0,c.generateBlockDataSet)({blockType:t,props:n}),i="$$"+n.data.equation+"$$";return{html:(0,c.generateBlockHTML)(r,i),text:i}}},{key:"isInHistoryMode",value:function(){var e=this.ExternalServices.mountOptions;return!!(void 0===e?{}:e).historyMode}},{key:"onTap",value:function(){return{preventFocus:!0,preventShowMenu:!0}}},{key:"onDoubleTap",value:function(){var e=this.ExternalServices,t=e.EventEmitter,n=e.events,r=e.Utils.getIsEditing,i=Boolean(r&&r());return this.equationInputVisible||i||(t.emit(n.MOBILE.COMMON.BEGIN_DOC_EDIT,{from:"click"}),(0,h.focusEditor)(this.editor,this.mountPoint)),{preventFocus:!0}}},{key:"render",value:function(){var r=this,i=this.attributes.selected;if(!this.isInHistoryMode())return new Promise(function(e){var t=r.rendered?void 0:function(){e(),r.rendered=!0},n=function(){return r.rendered&&e()};l.default.render(a.default.createElement(d.NotifyHeightUpdateOnMount,{notifier:r.heightUpdateNotifier},a.default.createElement(p.default,{editor:r.editor,selected:i,equation:r.equation,defaultVisible:r.defaultVisible,handleWillGenEquation:r.handleWillGenEquation,handleDidGenEquation:r.handleDidGenEquation,ExternalServices:r.ExternalServices,onInput:r.handleInput,onRendered:t})),r.mountPoint,n)});l.default.render(a.default.createElement(d.NotifyHeightUpdateOnMount,{notifier:this.heightUpdateNotifier},a.default.createElement(p.default,{editor:this.editor,selected:i,equation:this.equation,defaultVisible:this.defaultVisible,handleWillGenEquation:this.handleWillGenEquation,handleDidGenEquation:this.handleDidGenEquation,ExternalServices:this.ExternalServices,onInput:this.handleInput})),this.mountPoint)}},{key:"equation",get:function(){var e=this.props.data.equation;return this.useLocalEquation?this.localEquation:e}},{key:"equationInputVisible",get:function(){return!!document.querySelector(".equation-view-input-wrap")}}]),E);function E(e,t,n,r){v(this,E);var i=m(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e,t));i.shouldKeepAlive=!1,i.editbarTrigger=c.Trigger.hover,i.editbarCommands=[c.CommonCommandKey.comment],i.rendered=!1,i.defaultVisible=!1,i.useLocalEquation=!1,i.localEquation=(0,s.default)(i.props,"data.equation",""),i.resetUserLocalEquation=0,i.renderLocally=!0,i.handleInput=function(e){i.useLocalEquation?i.localEquation=e:(i.setProps({data:{equation:e}}),i.editor.plugins.client.handleResetUserAction())},i.heightUpdateNotifier=new f.default({getContext:function(){return i.context},getBlockId:function(){return i.blockId}}),i.handleWillGenEquation=function(){i.heightUpdateNotifier.notifyWillUpdate()},i.handleDidGenEquation=function(){i.heightUpdateNotifier.notifyDidUpdate()},i.ExternalServices=n;var o=r.editor;i.editor=o;var a=i.getDefaultVisible(t);return i.defaultVisible=a,i.useLocalEquation=a,i}t.default=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M0 6a6 6 0 1 1 12 0A6 6 0 0 1 0 6zm6 1.88c-.2 0-.38.16-.38.37v.38c0 .2.17.37.38.37h.38c.2 0 .37-.17.37-.38v-.37c0-.2-.17-.38-.38-.38H6zM6 3c-.2 0-.38.17-.38.38v3c0 .2.17.37.38.37h.38c.2 0 .37-.17.37-.38v-3c0-.2-.17-.37-.38-.37H6z",fill:"#FFC60A"}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(n(8)),o=g(n(22)),i=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=n(0),c=g(s),l=g(n(10)),u=n(6),d=n(1),f=n(11),h=g(n(76)),p=g(n(50));function g(e){return e&&e.__esModule?e:{default:e}}function v(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var E=27,k={points:["tl","bl"],offset:[0,4]},C="https://larksuite.help/hc/articles/360048487926",I=(b(S,s.PureComponent),i(S,[{key:"componentDidMount",value:function(){u.browser.isMobile||(0,l.default)(".ace-table .equation-view").on("mousedown",f.stopPropagation);var e=this.props,t=e.visible,n=e.editor;t&&this.handleInputResize(),n.on("block:delete",this.handleDeleteBlock)}},{key:"componentWillUnmount",value:function(){u.browser.isMobile||(0,l.default)(".ace-table .equation-view").off("mousedown",f.stopPropagation),this.bindEvent(!1),this.handleInputResize.cancel(),this.hanldeScroll.cancel(),this.container=void 0}},{key:"bindEvent",value:function(e){var t=this.props.editor,n=(0,f.getHandle)(e);window[n]("click",this.handleClick),window[n]("keydown",this.hanldeKeyDown),window[n]("resize",this.handleInputResize);var r=t.getScrollContainer();r&&r[n]("scroll",this.hanldeScroll)}},{key:"handleDidGenEquation",value:function(){var e=this.props.handleDidGenEquation;e&&e(),window.dispatchEvent(new Event("resize"))}},{key:"handleDeleteByOther",value:function(){var e,t,n,r=this.props.visible;!this.isDocSSR&&r&&(t=(e=this.props.ExternalServices).Toast,n=e.t,t.show({key:"equation-is-delete",type:"warn",content:n("CreationDoc_Docs_Equation.delete.toast")}))}},{key:"render",value:function(){var e=this.props,t=e.equation,n=e.visible,r=e.onInput,i=(e.onVisibleChange,e.ExternalServices),o=v(e,["equation","visible","onInput","onVisibleChange","ExternalServices"]),a=this.state.inputStyle,s=i.Popover,l=i.t;return c.default.createElement(s,{overlayClassName:"equation-view-popover",align:k,trigger:"click",visible:n,destroyTooltipOnHide:!0,content:c.default.createElement(h.default,{t:l,helpLink:this.getHelpLink(),equation:t,inputStyle:a,onInput:r,onVisibleChange:this.handleVisibleChange}),getPopupContainer:this.getPopupContainer,onVisibleChange:this.handleVisibleChange,zIndex:80},c.default.createElement(p.default,Object.assign({},o,{getContainerRef:this.setContainerRef,equation:t,handleDidGenEquation:this.handleDidGenEquation,ExternalServices:i})))}},{key:"isDocSSR",get:function(){return this.props.ExternalServices.isDocSSR}}]),S);function S(){m(this,S);var i=y(this,(S.__proto__||Object.getPrototypeOf(S)).apply(this,arguments));return i.state={inputStyle:{maxHeight:void 0}},i.setContainerRef=function(e){i.container=e},i.getPopupContainer=function(){return i.props.editor.getScrollContainer()},i.getHelpLink=function(){var e="feishu"===(0,r.default)(window,"globalConfig.common.product","feishu");return(0,i.props.ExternalServices.t)(e?"CreationDoc_Docs_Equation.help.link.feishu":"CreationDoc_Docs_Equation.help.link.lark")||C},i.handleDeleteBlock=function(e){e&&e.isRemote&&e.types&&e.types.has(d.BlockType.EQUATION_BLOCK)&&(i.handleDeleteByOther(),i.props.editor.off("block:delete",i.handleDeleteBlock))},i.handleInputResize=(0,o.default)(function(){var e,t,n;!i.props.visible||(e=(0,l.default)(".equation-view-input-wrap")).length&&(n=i.props.editor.getScrollContainer().clientHeight-((t=e.offset())?t.top-64:0)-70,i.setState({inputStyle:{maxHeight:n}}))},400),i.hanldeScroll=(0,o.default)(function(){i.props.visible&&i.handleInputResize()},500),i.handleClick=function(e){var t=i.props.visible,n=i.container,r=e.target;t&&n&&!n.contains(r)&&!r.closest(".equation-view-input-wrap")&&i.handleVisibleChange(!1)},i.hanldeKeyDown=function(e){e.keyCode===E&&i.handleVisibleChange(!1)},i.handleVisibleChange=function(e){(0,i.props.onVisibleChange)(e,function(){i.bindEvent(e),e?i.handleInputResize():(i.handleInputResize.cancel(),i.hanldeScroll.cancel())})},i}t.default=I},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=o(n(0));function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}t.default=function(e){e.styles;var t=a(e,["styles"]);return i.default.createElement("svg",r({width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},t),i.default.createElement("path",{d:"M12 4a8 8 0 1 1 0 16 8 8 0 0 1 0-16zm0 1.45a6.55 6.55 0 1 0 0 13.1 6.55 6.55 0 0 0 0-13.1zm.44 9.41c.2 0 .35.16.35.35v.9c0 .2-.16.35-.35.35h-.9a.35.35 0 0 1-.35-.35v-.9c0-.2.15-.35.35-.35h.9zm-.3-7.14c.78 0 1.42.21 1.9.65.49.43.74 1.02.74 1.75 0 .6-.16 1.1-.47 1.5l-.14.14-.25.24-.75.68c-.12.11-.22.23-.3.36l-.18.32a.58.58 0 0 0-.05.15l-.03.16a.22.22 0 0 1-.17.17l-.07.01h-.9c-.18 0-.24-.1-.23-.26.01-.27.05-.44.16-.67l.12-.23c.17-.3.55-.72 1.14-1.26l.18-.15.2-.23c.22-.28.33-.55.33-.84 0-.4-.11-.72-.34-.95a1.34 1.34 0 0 0-.98-.35c-.53 0-.9.17-1.14.5-.14.19-.23.44-.28.74l-.03.28v.03c-.03.1-.1.16-.21.18l-.09.01h-.76c-.24 0-.3-.13-.29-.37.06-.73.3-1.33.76-1.78a2.83 2.83 0 0 1 2.12-.78z",fill:"#646a73",fillRule:"nonzero"}))}},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(n(22)),i=function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e};function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=n(0),d=l(a),f=l(n(4)),c=n(6),u=n(11),h=l(n(76)),p=l(n(50)),s=n(1);function l(e){return e&&e.__esModule?e:{default:e}}function g(e,t){var n,r={};for(n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var b=(y(E,a.PureComponent),i(E,[{key:"componentDidMount",value:function(){this.bindEvent(!0);var e=this.props.visible;e&&(this.showEquationToolbar(),this.bindVisibleChangeEvent(e))}},{key:"componentWillUnmount",value:function(){this.bindEvent(!1),clearTimeout(this.classTimeout),this.hanldeIOSScroll.cancel(),this.handleKeyBoardChange.cancel(),this.container=void 0}},{key:"bindEvent",value:function(e){var t,n=this.props,r=n.visible,i=n.ExternalServices,o=i.mobileEditable,a=i.EventEmitter,s=i.events,l=(0,u.getAction)(e);o&&a[l](s.MOBILE.COMMON.KEYBOARD_CHANGED,this.handleKeyBoardChange),r&&c.browser.isIOS&&(t=(0,u.getHandle)(e),window[t]("scroll",this.hanldeIOSScroll))}},{key:"handleMobileScrollToView",value:function(){var e=this.props,t=e.editor;e.ExternalServices.Helpers.scrollCursorToView(t)}},{key:"bindVisibleChangeEvent",value:function(e){var t,n=(0,u.getHandle)(e);window[n]("touchstart",this.handleClickWindow),window[n]("touchend",this.handleClickWindow),c.browser.isIOS&&(t=(0,u.getHandle)(e),window[t]("scroll",this.hanldeIOSScroll))}},{key:"render",value:function(){var e=this.props,t=e.editor,n=e.equation,r=e.visible,i=e.onInput,o=g(e,["editor","equation","visible","onInput"]),a=this.state,s=a.scrolling,l=a.mobileStyle,c=a.seted,u=(0,f.default)({"equation-view-input-mobile-scrolling":s,"equation-view-input-mobile-visible":c});return d.default.createElement(d.default.Fragment,null,d.default.createElement(p.default,Object.assign({},o,{getContainerRef:this.setContainerRef,editor:t,equation:n,onTouchStart:this.handleTouch,onTouchMove:this.handleTouch,onTouchEnd:this.handleTouch,onMouseDown:this.handleMouseDown,onClick:this.handleClickContainer})),r&&d.default.createElement(h.default,{className:u,t:o.ExternalServices.t,contentEditable:t.isContentEditable(),mobileStyle:l,equation:n,onInput:i,onFocus:this.showEquationToolbar,onBlur:this.handleBlur,onVisibleChange:this.handleVisibleChange,onFinish:this.handleFinish}))}}]),E);function E(){v(this,E);var a=m(this,(E.__proto__||Object.getPrototypeOf(E)).apply(this,arguments));return a.scrollCursorToViewed=!1,a.state={scrolling:!1,innerHeight:0,mobileStyle:{top:c.browser.isIOS?0:E.defaultTop},seted:!c.browser.isIOS&&!!E.defaultTop},a.classTimeout=0,a.setContainerRef=function(e){a.container=e},a.showEquationToolbar=function(){var e=a.props.ExternalServices,t=e.EventEmitter,n=e.events;t.trigger(n.TOOLBAR.SHOW_EQUATION_TOOLBAR)},a.handleKeyBoardChange=(0,r.default)(function(e){var t,n,r=e.innerHeight,i=e.isOpenKeyboard,o=e.keyboardType;i&&"equation"===o?(t=r-162,window._currentViewHeight=t,!a.scrollCursorToViewed&&a.props.visible&&(a.handleMobileScrollToView(),a.scrollCursorToViewed=!0),n=E.defaultTop=c.browser.isIOS?t+window.scrollY:t,a.setState({innerHeight:t,mobileStyle:{top:n}}),a.state.seted||setTimeout(function(){a.setState({seted:!0})},100)):i||a.handleVisibleChange(!1)},100),a.hanldeIOSScroll=(0,r.default)(function(){clearTimeout(a.classTimeout);var e=a.state.innerHeight+window.scrollY;a.setState({seted:!0,scrolling:!0,mobileStyle:{top:e}},function(){a.classTimeout=window.setTimeout(function(){a.setState({scrolling:!1})},300)})},100,{maxWait:100,leading:!0}),a.handleClickWindow=(0,s.touchToClick)({onClick:function(e){var t=a.props,n=t.visible,r=t.editor,i=e.target;!n||i.closest(".block-type-EQUATION_BLOCK")||i.closest(".equation-view-input-wrap")||(!r.isFocus()&&i.closest("#innerdocbody")&&(a.focusContainer(!1),r.focus()),a.handleVisibleChange(!1))}}),a.handleVisibleChange=function(e,t){var n,r=a.props,i=r.visible,o=r.onVisibleChange;(0,r.handleStateChange)({active:e}),e!==i&&(e?a.showEquationToolbar():a.scrollCursorToViewed=!1,a.bindVisibleChangeEvent(e),c.browser.isIOS?(n=e?window.scrollY+130:0,a.setState({mobileStyle:{top:n},seted:!1},function(){o(e,t)})):o(e,t))},a.focusContainer=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=a.props.editor;t.isContentEditable()||t.setContentEditable(!0),(0,u.focusEditor)(a.props.editor,a.container,e)},a.handleClickContainer=function(e){var t=a.props,n=t.editing,r=t.visible;n()&&(r?setTimeout(function(){a.handleFinish(e)}):(a.focusContainer(),a.handleVisibleChange(!0)))},a.handleTouch=function(){if(c.browser.isMobile)return(0,s.touchToClick)({onClick:a.handleClickContainer,touchDuration:450})}(),a.handleMouseDown=function(e){a.props.editing()?a.focusContainer(!1):2===e.nativeEvent.detail&&setTimeout(function(){a.focusContainer(),a.handleVisibleChange(!0)})},a.handleFinish=function(e){e.preventDefault(),a.focusContainer(),a.handleVisibleChange(!1)},a.handleBlur=function(){(0,a.props.handleStateChange)({active:!1}),setTimeout(function(){a.handleVisibleChange(!1)},68)},a}b.defaultTop=0,t.default=b},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.equationInsert=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(){a(this,s)}var l=(r(s,[{key:"insert",value:function(e){var t=e.editor,n=e.props,r=e.openInput,i=(0,o.generateBlockDataSet)({blockType:o.BlockType.EQUATION_BLOCK,creator:(0,o.getBlockCreator)(o.BlockType.EQUATION_BLOCK,t),props:n,initData:{defaultVisible:r}});t.plugins.blockPlugin.insertBlock(i)}}]),new s);t.equationInsert=l},function(e,t,n){},function(e,t){e.exports=o("bdgK")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(218);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var i=n(219);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ISVCreator=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1),a=s(n(77));function s(e){return e&&e.__esModule?e:{default:e}}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e){var t=e.ExternalServices,n=e.isSyncRender,r=e.usePrerenderPlaceholder;l(this,d);var i=c(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,{isSyncRender:n,usePrerenderPlaceholder:r}));return i.blockType=o.BlockType.ISV_BLOCK,i.defaultProps={},i.defaultRecord={},i.ExternalServices=t,i}t.ISVCreator=(u(d,o.Creator),r(d,[{key:"create",value:function(e,t,n){return new a.default(n,e,t,this.ExternalServices)}},{key:"onPaste",value:function(e){return e}},{key:"destroy",value:function(){}}]),d)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.insertISVBlock=void 0;var r=n(1);t.insertISVBlock=function(e,t){var n=(0,r.generateBlockDataSet)({blockType:r.BlockType.ISV_BLOCK,props:{data:{blockTypeId:t,AppBlockId:""}}});e.plugins.blockPlugin.insertBlock(n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(221);Object.defineProperty(t,"LinkBlockCreator",{enumerable:!0,get:function(){return r.LinkBlockCreator}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LinkBlockCreator=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=c(n(37)),a=n(1),s=n(51),l=c(n(222));function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e){var t=e.isSyncRender,n=e.usePrerenderPlaceholder,r=e.ExternalServices;u(this,h);var i=d(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,{isSyncRender:t,usePrerenderPlaceholder:n}));return i.blockType=a.BlockType.LINK_BLOCK,i.defaultProps={displayMode:a.BlockDisplayMode.INLINE,viewType:a.ViewTypes.INLINE},i.ExternalServices=r,i}t.LinkBlockCreator=(f(h,a.Creator),r(h,[{key:"isSmartLinkEnable",value:function(){var e=this.ExternalServices.smartLinkService;return!!e&&e.getSmartLinkEnable()}},{key:"create",value:function(e,t){var n=t.props.data.linkProvider,r=(0,this.ExternalServices.getConfigMap)()[n];return r&&r.isEnable()||n===s.LinkProvider.SmartLink&&this.isSmartLinkEnable()?new l.default(e,t,this.ExternalServices,r):new o.default(e,t,this.ExternalServices)}}]),h)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.getUrlHostName=C;var a=v(n(7)),o=n(16),s=n(1),l=v(n(223)),c=v(n(0)),u=v(n(5)),d=v(n(18)),f=v(n(55)),h=n(3),p=n(51),g=n(6);function v(e){return e&&e.__esModule?e:{default:e}}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var E=(b(k,s.Block),r(k,[{key:"init",value:function(){this.isNeedMoreCommand()&&(this.editbarCommands=this.getCommands(!0))}},{key:"updateEditbar",value:function(e){var t,n=e.hide;if(this.context.updateEditbar){if(n)return this.context.updateEditbar([],this);this.isNeedMoreCommand()&&(t=this.getCommands(!1),this.editbarCommands=t,this.context.updateEditbar(t,this))}}},{key:"isNeedMoreCommand",value:function(){var e=this.props.displayMode;return!g.browser.isMobile&&e!==s.BlockDisplayMode.INLINE}},{key:"onCopy",value:function(e){var t=e.blockType,n=e.props,r=(0,s.generateBlockDataSet)({blockType:t,props:n}),i=this.ExternalServices.t("block.common_paste_unsupported"),o=n.data,a=n.displayMode;return o&&(i=a===s.BlockDisplayMode.INLINE?o.title:o.url),{html:(0,s.generateBlockHTML)(r,i),text:i}}},{key:"collectText",value:function(){var e=this.getData(),t=e.title;switch(e.linkProvider){case p.LinkProvider.Pano:return t;case p.LinkProvider.SmartLink:return"["+(this.ExternalServices.t&&this.ExternalServices.t("CreationDoc_Docs_WebBookmark_Button"))+"]";default:return t}}},{key:"getData",value:function(){return this.props.data}},{key:"resize",value:function(){}},{key:"render",value:function(){var n=this,r=this.props.data;return new Promise(function(e){var t=function(){return e({})};u.default.render(c.default.createElement(o.NotifyHeightUpdateOnMount,{notifier:n.heightUpdateNotifier},c.default.createElement(l.default,Object.assign({},r,{attributes:n.attributes,emitter:n.emitter,config:n.config,ExternalServices:n.ExternalServices,handlers:{redirect:n.redirectHandler}}))),n.mountPoint,t)})}},{key:"onSearch",value:function(e){var t=this,n=e.searchKey.toLowerCase(),r=this.getData().title.toLowerCase();return(0,s.searchString)(r,n).map(function(e){return Object.assign({},e,{isReplaceable:t.isReplaceable,blockId:t.blockId})})}},{key:"onCancelSearch",value:function(){this.emitter.emit("clearSearchResult",[])}},{key:"onHighlight",value:function(e,t){var n=e.key,r=e.matches;this.emitter.emit("highlightResult",{searchResult:r,selectedKey:n,isSelected:t})}},{key:"onReplace",value:function(){}},{key:"unmount",value:function(){}}]),k);function k(e,t,n,r){m(this,k);var o=y(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,e,t));return o.config=r,o.renderLocally=!0,o.editbarTrigger=s.Trigger.hover,o.editbarCommands=[s.CommonCommandKey.comment],o.isReplaceable=!1,o.emitter=new d.default,o.getCommands=function(t){var n=o.context.getCommandByKey,r=[{key:"redirect",Icon:function(){return c.default.createElement(f.default,null)},handler:o.redirectHandler,tooltip:o.ExternalServices.t("CreationDoc_Docs_WebBookmark_Open_Tooltip")}];return[s.CommonCommandKey.separator,s.CommonCommandKey.comment].forEach(function(e){t?r.push(e):n&&(0,s.isCommonCommandKey)(e)&&r.push(n(e))}),r},o.redirectHandler=function(e){var t,n,r,i=o.props.data;i&&(i.linkType===p.LinkBlockType.Bookmark&&(t="string"==typeof e?e:"toolbar",o.ExternalServices.LogService.collectEvent("click_bookmark_openorigin_link",{url_host:C(i.url),source:t})),n=i.url,r=o.ExternalServices.Helpers,g.browser.isMobile?window.location.href=n:(o.updateEditbar({hide:!0}),(0,h.openUrl)(n,r)))},o.heightUpdateNotifier=new a.default({getContext:function(){return o.context},getBlockId:function(){return o.blockId}}),o.ExternalServices=n,o.init(),o}function C(e){var t=document.createElement("a");return t.href=e,t.hostname}t.default=E},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(0),u=h(o),a=n(51);n(224);var d=h(n(15)),f=n(2),s=n(1),c=n(225);function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var m=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,n,a):i(t,n))||a);return 3<o&&a&&Object.defineProperty(t,n,a),a},y=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=(v(E,o.PureComponent),r(E,[{key:"componentDidMount",value:function(){this.props.emitter&&(this.props.emitter.on("highlightResult",this.updateSearchResult),this.props.emitter.on("clearSearchResult",this.clearSearchResult))}},{key:"componentWillUnmount",value:function(){this.props.emitter&&this.props.emitter.removeAllListeners()}},{key:"handleClick",value:function(){var e=this.props,t=e.config,n=e.entityId;t&&t.logger&&t.logger.logClickLink(n)}},{key:"renderRecord",value:function(){var e=this.props,t=e.url,n=e.entityId,r=e.title,i=e.ExternalServices.Utils.isShortCut,o=this.state,a=o.selectedKey,s=o.isSelected,l=o.searchResult,c=i&&i();return u.default.createElement("span",{className:"link-block__container"},u.default.createElement("a",{className:"link-block__record",href:c?"javascript:void(0)":t,"data-id":n,onClick:this.handleClick},u.default.createElement(d.default,{bgColor:f.MATCHED_BACKGROUND_COLOR,activeBgColor:f.SELECTED_BACKGROUND_COLOR,activeKey:a,isSelected:s,context:l},r)))}},{key:"getLinkView",value:function(){var e=this.props.linkType;switch(e){case a.LinkBlockType.Record:return this.renderRecord();case a.LinkBlockType.Bookmark:return(0,c.renderBookmark)(this.props,this.state);default:return console.error("It comes an unrecognized link type: "+e),this.renderRecord()}}},{key:"render",value:function(){return this.getLinkView()}}]),E);function E(e){p(this,E);var t=g(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e));return t.updateSearchResult=function(e){t.setState({searchResult:e.searchResult}),void 0!==e.isSelected&&t.setState(function(){return{selectedKey:e.selectedKey,isSelected:e.isSelected}})},t.clearSearchResult=function(e){t.setState({searchResult:e})},t.state={searchResult:[],selectedKey:"",isSelected:!1},t}t.default=b,m([(0,s.Bind)(),y("design:type",Function),y("design:paramtypes",[]),y("design:returntype",void 0)],b.prototype,"handleClick",null)},function(e,t,n){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderBookmark=i;var d=r(n(0));n(226);var f=n(2),h=r(n(15)),p=r(n(4));function r(e){return e&&e.__esModule?e:{default:e}}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v="bookmark";function i(e,t){var n=t.selectedKey,r=t.isSelected,i=t.searchResult,o=e.handlers,a=e.title,s=e.attributes,l=e.summary,c=e.ExternalServices.Utils.isShortCut,u=o.redirect||function(){};return d.default.createElement("div",{className:(0,p.default)(v+"-wrapper",g({},v+"-wrapper__selected",s.selected)),contentEditable:!1,onClick:function(){u("click_block")}},d.default.createElement("div",{className:v+"-info"},d.default.createElement("div",{className:v+"-title"},d.default.createElement(h.default,{bgColor:f.MATCHED_BACKGROUND_COLOR,activeBgColor:f.SELECTED_BACKGROUND_COLOR,activeKey:n,isSelected:r,context:i},a)),l?d.default.createElement("div",{className:v+"-abstract"},l):void 0,m(e)),!(c&&c())&&y(e))}function m(e){var t=e.url,n=e.icon;return d.default.createElement("div",{className:v+"-link-wrapper"},n?d.default.createElement("div",{className:v+"-icon",style:{backgroundImage:"url("+n+")"}}):void 0,d.default.createElement("div",{className:v+"-url"},t))}function y(e){var t={backgroundImage:"url("+e.cover_url+")"};return e.cover_width&&e.cover_height&&(.5<=e.cover_width/e.cover_height?t.backgroundPositionY="center":t.backgroundPositionY="top"),e.cover_url?d.default.createElement("div",{className:v+"-cover",style:t}):void 0}},function(e,t,n){}],r={},i.m=n,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=78);function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var n,r},e.exports=n()},Tb95:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var u,r,f=n("owWc"),m=n("HI9p");(r=u=u||{}).POST="post",r.GET="get";var y=function(){return(y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function h(e,a,n,s){function l(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n=n||Promise)(function(t,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function i(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){e.done?t(e.value):l(e.value).then(r,i)}o((s=s.apply(e,a||[])).next())})}function g(e,n){var r,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function s(t){return function(e){return l([t,e])}}function l(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function b(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function E(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}var p="loading",v="comment",k="success",C="mentionUser",I="mentionLink",d="/api"+"/translation/language/contents/detection/",S="id",i=(o.prototype.onTranslateError=function(e){this.errorQueue.push(e)},o.prototype.handleTranslateTime=function(){var t,e=Date.now();0<this.translateStartTime&&(t=e-this.translateStartTime,this.translateTimeCallbackQueue.forEach(function(e){return e(t)}))},o.prototype.handleAutoTranslate=function(r){return h(this,void 0,void 0,function(){var t,n;return g(this,function(e){switch(e.label){case 0:t=this.getAllComments(r),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.handleLangDetection(r)];case 2:return e.sent(),[3,4];case 3:return e.sent(),console.log(""),[3,4];case 4:return 0<Object.keys(t).length?(this.translateStartTime=Date.now(),this.handleTranslateDataToChange(t,r),n=this.handleLoadingMessages(r),this.handleCommentChange(n),[2]):(this.handleCommentChange(r),[2])}})})},o.prototype.handleNoAutoTranslate=function(u){return h(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c;return g(this,function(e){switch(e.label){case 0:t=this.getAllComments(u),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.handleLangDetection(u)];case 2:return e.sent(),[3,4];case 3:return e.sent(),console.log(""),[3,4];case 4:if(0===Object.keys(this.handTranslatedMap).length)return this.handleCommentChange(u),[2];n=[];try{for(r=b(Object.keys(this.handTranslatedMap)),i=r.next();!i.done;i=r.next())o=i.value,a=o.split("-")[1],n.push(a)}catch(e){l={error:e}}finally{try{i&&!i.done&&(c=r.return)&&c.call(r)}finally{if(l)throw l.error}}return 0<Object.keys(t).length?(this.translateStartTime=Date.now(),this.handleTranslateDataToChange(t,u,n),s=this.handleLoadingMessages(u,n),this.handleCommentChange(s),[2]):(this.handleCommentChange(u),[2])}})})},o.prototype.handleTranslateBroadcast=function(){var r=this,i=this.broadcast.register;return this.broadcast.register=function(t,e,n){t===v?(r.handleCommentChange=e,i(t,function(e){t===v&&r.enableAutoTranslate?r.handleAutoTranslate(e):r.handleNoAutoTranslate(e)},n)):i(t,e,n)},this.broadcast},o.prototype.handleLangDetection=function(o,c){return h(this,void 0,void 0,function(){var s,t,n,r,i,a,l=this;return g(this,function(e){switch(e.label){case 0:return s=[],o.forEach(function(e){var t,n,r=e.comments;try{for(var i=b(Object.keys(r)),o=i.next();!o.done;o=i.next()){var a=o.value;(r[a].is_whole||l.commentIdList.has(a))&&r[a].comment_list.forEach(function(e){var t,n=e.content,r=e.reply_id,i=l.srcLangMap[n];c?(t=c.find(function(e){return e==r}),!i&&t&&s.push(n)):i||s.push(n)})}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}),0<s.length?[4,this.request({url:d,method:u.POST,data:{contents:s},headers:{"Content-Type":"application/json"}})]:[3,2];case 1:t=e.sent(),n=t.data,r=n.src_lang,i=n.supported_src_langs,this.supportedSrcLangs=i,r.forEach(function(e,t){var n=s[t];l.srcLangMap[n]=e}),e.label=2;case 2:return a=this.translateLang,o.forEach(function(e){var t,n,r=e.comments;try{for(var i=b(Object.keys(r)),o=i.next();!o.done;o=i.next())r[o.value].comment_list.forEach(function(e){var t=e.content;e.equal_lang=l.getEqualLang(t,a)})}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}),[2]}})})},o.prototype.handleLoadingMessages=function(e,d){var f=this,h=this.translateLang;return e.map(function(e){var t,n,r=e.comments,i=y({},r);try{for(var o=b(Object.keys(r)),a=o.next();!a.done;a=o.next()){var s=a.value,l=r[s],c=l.comment_list.map(function(e){var t=e.reply_id,n=e.content,r=e.user_id,i=f.getEqualLang(n,h),o=S+"-"+t,a=f.translatedMap[o],s=f.getUserId();if(f.getIsHaveTranslatedContent(t,n,h)){var l=f.getTranlateOriginalContent(e.content),c=f.getTranlateOriginalContent(a[h+"_content"]);if(l===c&&!f.handTranslatedMap[S+"-"+t])if(!(u=d&&d.find(function(e){return e==t})))return y(y({},e),{equal_lang:i,translate_content:void 0,translate_status:void 0});return y(y({},e),{equal_lang:i,translate_content:a[h+"_content"],translate_status:k})}if(d){var u=d.find(function(e){return e==t});return y(y({},e),u?{equal_lang:i,translate_status:p}:{equal_lang:i})}return s!==r||f.handTranslatedMap[S+"-"+t]?i||f.handTranslatedMap[S+"-"+t]?y(y({},e),{equal_lang:i,translate_content:void 0,translate_status:void 0}):y(y({},e),{equal_lang:i,translate_status:p}):y(y({},e),{equal_lang:i})});i[s]=y(y({},l),{comment_list:c})}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return y(y({},e),{comments:y({},i)})})},o.prototype.getTranslateBroadcast=function(){return this.translateBroadcast},o.prototype.handleTranslateDataToComment=function(t,e){var n,r,h=this;if(0<t.failure_data.text_list.length&&(this.errorQueue.forEach(function(e){return e(t.failure_data)}),0===t.data.text_list.length))return this.handleFailComments(e);var i=t.data,p=i.text_list,g=i.suppl,v=this.translateLang;try{for(var o=b(Object.keys(e)),a=o.next();!a.done;a=o.next()){var s=a.value,l=e[s],c=l.comment_list.map(function(e){var t,n,r,i=e.reply_id,o=e.content,a=h.getEqualLang(o,v),s=S+"-"+i,l=Object(m.a)(g,function(e){return e[s]}),c=h.translatedMap[s];if(-1<l){var u=p[l],d=y({},g[l]);delete d[s];var f="";return 0===Object.keys(d).length?f=u:h.toLineTexts({text:u,suppl:d}).forEach(function(e){var t,n,r,i,o,a,s,l,c=e.attribs,u=e.text;c[0]&&c[0][0]?(n=(t=E(c[0][0].split("_")))[0],r=t.slice(1),"mentionUser"!==n&&"mentionLink"!==n||!r||(o=(i=JSON.parse(decodeURIComponent(r.join("")))).href,a=i.token,s=i.type,l=i.icon,f+=l?'<at type="'+s+'" href="'+o+'" token="'+a+"\" icon='"+l+"'>"+u+"</at>":'<at type="'+s+'" href="'+o+'" token="'+a+'">'+u+"</at>")):f+=u}),c?c.content===o?h.translatedMap[s]=y(y({},h.translatedMap[s]),((t={})[v+"_content"]=f,t)):h.translatedMap[s]=((n={content:o})[v+"_content"]=f,n):h.translatedMap[s]=((r={content:o})[v+"_content"]=f,r),h.getTranlateOriginalContent(e.content)!==h.getTranlateOriginalContent(f)||h.handTranslatedMap[s]?y(y({},e),{equal_lang:a,translate_content:f,translate_status:"success",translate_lang:v}):y(y({},e),{equal_lang:a,translate_content:void 0,translate_status:void 0})}return c&&c[v+"_content"]?h.getTranlateOriginalContent(e.content)!==h.getTranlateOriginalContent(c[v+"_content"])||h.handTranslatedMap[s]?y(y({},e),{equal_lang:a,translate_content:c[v+"_content"],translate_status:"success",translate_lang:v}):y(y({},e),{equal_lang:a,translate_content:void 0,translate_status:void 0}):a&&!h.handTranslatedMap[s]?y(y({},e),{equal_lang:a,translate_content:void 0,translate_status:void 0}):y(y({},e),{equal_lang:a})});e[s]=y(y({},l),{comment_list:c})}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return y({},e)},o.prototype.handleRequestData=function(e,u){var t,n,d=this,f=[],h=[],p={A:[],B:[]},g=this.translateItemLang||this.translateLang;try{for(var r=b(Object.keys(e)),i=r.next();!i.done;i=r.next())e[i.value].comment_list.forEach(function(e){var t,a,n,r,i,o=e.reply_id,s=e.user_id,l=e.content,c=d.getUserId();if(u){if(!u.find(function(e){return e==o}))return}else{if(c===s&&!d.handTranslatedMap[S+"-"+o])return;if(d.getEqualLang(l,g))return}d.getIsHaveTranslatedContent(o,l,g)||(t=d.parseCommentContent(l),a=[],t.forEach(function(e){var t=e.content,n=e.type,r=E(n.split("_"),2),i=r[0],o=r[1];i===C&&o?(a.push({text:t,attribs:[[n,"true"]]}),p.A.push(n+",true")):i===I&&o?(a.push({text:t,attribs:[[n,"true"]]}),p.B.push(n+",true")):a.push({text:t,attribs:[]})}),r=(n=d.toAILabTypeData(a)).text,(i=n.suppl)[S+"-"+o]=[[0,r.length-1]],f.push(r),h.push(i))})}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}var o=this.getSrcLang&&this.getSrcLang()||"zh";return{textList:f,suppl:h,srcLang:o,targetLang:g,protectedSuppl:p}},o.prototype.translateData=function(n){return h(this,void 0,void 0,function(){var t=this;return g(this,function(e){return[2,new Promise(function(e){t.translateDataList=t.translateDataList.concat(n),t.translate(e)})]})})},o);function o(e){var d=this;this.translateDataList=[],this.translatedMap={},this.srcLangMap={},this.supportedSrcLangs=[],this.handTranslatedMap={},this.errorQueue=[],this.translateTimeCallbackQueue=[],this.commentIdList=new Set,this.allMessages={comments:{},entities:{users:{}}},this.translateItemLang="",this.offTranslateError=function(t){d.errorQueue=d.errorQueue.filter(function(e){return!(e===t)})},this.onTranslateTime=function(e){d.translateTimeCallbackQueue.push(e)},this.offTranslateTime=function(t){d.translateTimeCallbackQueue=d.translateTimeCallbackQueue.filter(function(e){return!(e===t)})},this.handleTranslateDataToChange=function(n,i,r){return new Promise(function(t){var e=d.handleRequestData(n,r);d.translateData(e).then(function(r){var e=i.map(function(e){var t=e.comments,n=d.handleTranslateDataToComment(r,t);return d.allMessages.comments=y(y({},d.allMessages.comments),n),y(y({},e),{comments:n})});d.handleCommentChange(e),t(r),d.handleTranslateTime()})})},this.translateCommentItem=function(e,t,n){var r=d.allMessages,i=r.comments,o=r.entities;d.translateItemLang=n;var a=i[e];if(a){var s={};s[e]=a;var l=[{comments:s,entities:o}];d.translateStartTime=Date.now();var c=d.handleLoadingMessages(l,[t]);d.handleCommentChange(c),d.handTranslatedMap[S+"-"+t]=!0;var u=d.handleTranslateDataToChange(s,l,[t]);return d.translateItemLang="",u}},this.getAllComments=function(e){return Object(f.a)(e,function(e,t){var n,r,i=t.comments,o=t.entities;d.allMessages={comments:y(y({},d.allMessages.comments),i),entities:{users:y(y({},d.allMessages.entities.users),o.users)}};var a={};try{for(var s=b(Object.keys(i)),l=s.next();!l.done;l=s.next()){var c=l.value;(i[c].is_whole||d.commentIdList.has(c))&&(a[c]=y({},i[c]))}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return 0===Object.keys(a).length?e:y(y({},e),a)},{})},this.getEqualLang=function(e,t){var n=d.srcLangMap[e];return!!n&&(!d.supportedSrcLangs.find(function(e){return e===n})||n===t)},this.setCommentTranslateEnableLang=function(e,t){var n,r,i=d.allMessages.comments;if(d.enableAutoTranslate===e)d.enableAutoTranslate===e&&d.translateLang!==t&&(d.translateLang=t,d.enableAutoTranslate=e,0!==Object.keys(i).length&&(d.enableAutoTranslate?d.handleAutoTranslate([d.allMessages]):d.handleNoAutoTranslate([d.allMessages])));else if(d.translateLang=t,d.enableAutoTranslate=e,0!==Object.keys(i).length)if(d.enableAutoTranslate)d.handleAutoTranslate([d.allMessages]);else{var o={};try{for(var a=b(Object.keys(d.handTranslatedMap)),s=a.next();!s.done;s=a.next()){var l=s.value.split("-")[1];d.translatedMap[l]&&(o[l]=y({},d.translatedMap[l]))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}d.allMessages={comments:{},entities:{users:{}}},d.translatedMap=o,d.broadcast.fetchClientVars(v)}},this.addTranslateCommentId=function(p){return h(d,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u,d,f,h=this;return g(this,function(e){switch(e.label){case 0:t=[];try{for(n=b(p),r=n.next();!r.done;r=n.next())i=r.value.commentId,this.commentIdList.has(i)||(t.push(i),this.commentIdList.add(i))}catch(e){d={error:e}}finally{try{r&&!r.done&&(f=n.return)&&f.call(n)}finally{if(d)throw d.error}}return 0<t.length?(o={},a=this.allMessages,s=a.comments,l=a.entities,t.forEach(function(e){s[e]&&(o[e]=s[e])}),c=[{comments:o,entities:this.allMessages.entities}],[4,this.handleLangDetection(c)]):[3,2];case 1:if(e.sent(),this.allMessages.comments=y(y({},this.allMessages.comments),c[0].comments),this.handleCommentChange(c),!this.enableAutoTranslate)return[2];u=this.handleRequestData(o),this.translateData(u).then(function(e){var t=h.handleTranslateDataToComment(e,o);h.allMessages.comments=y(y({},h.allMessages.comments),t),h.handleCommentChange([{comments:t,entities:l}])}),e.label=2;case 2:return[2]}})})},this.handleFailComments=function(e){var t,n;try{for(var r=b(Object.keys(e)),i=r.next();!i.done;i=r.next()){var o=i.value,a=e[o],s=a.comment_list.map(function(e){return"loading"===e.translate_status?y(y({},e),{translate_status:"error"}):y({},e)});e[o]=y(y({},a),{comment_list:s})}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return y({},e)},this.getTranlateOriginalContent=function(e){return e},this.getIsHaveTranslatedContent=function(e,t,n){var r=S+"-"+e,i=d.translatedMap[r];return i&&i.content===t&&i[n+"_content"]},this.destroy=function(){d.translateDataList=[],d.translatedMap={},d.translateTimeCallbackQueue=[],d.errorQueue=[],d.handTranslatedMap={},d.broadcast.unregister(v),d.commentIdList=new Set,d.translateStartTime=0,d.srcLangMap={},d.allMessages={comments:{},entities:{users:{}}}},this.translate=function(t){var o=[],a=[],s={A:[],B:[]};d.translateDataList.forEach(function(e){var t=e.textList,n=e.suppl,r=e.protectedSuppl,A=r.A,i=r.B;o=o.concat(t),a=a.concat(n),s.A=s.A.concat(A),s.B=s.B.concat(i)});var e=d.translateDataList.length,n=d.translateDataList[e-1],r=n.srcLang,i=n.targetLang;d.translateDataList=[],0!==o.length&&d.translateFn({text_list:o,suppl:a,src_lang:r,target_lang:i,protected_suppl:s},d.request).then(function(e){t(e)})};var t=e.broadcast,n=e.request,r=e.getTranslateLang,i=e.getSrcLang,o=e.getUserId,a=e.translateFn,s=e.enableAutoTranslate,l=e.parseCommentContent,c=e.toAILabTypeData,u=e.toLineTexts;this.broadcast=t,this.translateLang=r(),this.getUserId=o,this.translateFn=a,this.enableAutoTranslate=s,this.translateBroadcast=this.handleTranslateBroadcast(),this.request=n,this.parseCommentContent=l,this.toAILabTypeData=c,this.toLineTexts=u,this.getSrcLang=i,this.translateStartTime=0}},YnAa:function(e,t,n){},Z7ZV:function(e,t,n){},"f+gR":function(e,t,n){"use strict";n.d(t,"a",function(){return O}),n.d(t,"b",function(){return D}),n.d(t,"c",function(){return P});var d=n("x/Yo"),L=function(){return(L=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,a,n,s){function l(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n=n||Promise)(function(t,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function i(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){e.done?t(e.value):l(e.value).then(r,i)}o((s=s.apply(e,a||[])).next())})}function f(e,n){var r,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function s(t){return function(e){return l([t,e])}}function l(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var i,o,a,s,D,l,c,u,B,h,P,p,g="/api",v=g+"/message/read/",m=g+"/message/get_message.v2/",y=g+"/message/get_message.v3/",b=g+"/message/solve/";(o=i=i||{}).HTTP="http",o.SOCKET="socket",(s=a=a||{}).POST="post",s.GET="get",(l=D=D||{})[l.READ=2]="READ",l[l.UNREAD=1]="UNREAD",(u=c=c||{})[u.DONE=1]="DONE",u[u.UNDONE=0]="UNDONE",(h=B=B||{})[h.MENTION=1]="MENTION",h[h.NOT_MENTION=0]="NOT_MENTION",(p=P=P||{}).Comment="MESSAGE_DOC_COMMENT",p.Mention="MESSAGE_DOC_MENTION",p.Share="MESSAGE_DOC_SHARE",p.Card="MESSAGE_CARD";var E,k,C=(I.prototype.registerMsgBox=function(){var e;this.msgBox&&(e=this.getTag(),this.msgBox.register(e,this.handleMessageBox))},I.prototype.registerUserMsgBox=function(){var e;this.msgBox&&(e=this.getUserTag(),this.msgBox.register(e,this.handleMessageBox))},I.prototype.getTag=function(){return{token:"NOTICE_"+this.rootType+"_"+this.rootToken,resourceType:"NOTICE_"+this.rootType,routeType:"token",routeKey:this.rootToken,subtype:"NOTIFY"}},I.prototype.getUserTag=function(){return{token:"MESSAGE_USER_NEW_"+this.getCurrentUserId(),resourceType:"MESSAGE_USER_NEW",routeType:"uid",routeKey:this.getCurrentUserId()}},I.prototype.notifyMessageChange=function(t,n){var r=this;this.changeQueue.forEach(function(e){e(r.messageData,t,n)})},I.prototype.request=function(t){return r(this,void 0,void 0,function(){return f(this,function(e){switch(e.label){case 0:if(!this.requestMethod)throw new Error("no request method found");return[4,this.requestMethod(t)];case 1:return[2,e.sent().data]}})})},I.prototype.normalizeMessage=function(e){var o=this,a=this.getCurrentUserId(),t=this.getCurrentMemberId(),n=this.getIsOwner(),r=this.getComments().comments,i=e.related,s=e.solveStatus,l=e.toUserids;if(e.type===P.Comment){var c=e.commentId,u=e.userId,d=e.messageId,f=e.replyId,h=e.isWhole,p=e.commentMention,g=r.find(function(e){return e.commentId===c}),v=e,m=p;if(p||(m=e.commentMentionUserIds.includes(a)?B.MENTION:B.NOT_MENTION),u===a)this.markRead({memberId:t,messageIds:[d]}),v=L(L({},e),{related:this.getRelated(i,!0),solveStatus:this.getSolveStatus(s,0),status:D.READ});else if(n)v=L(L({},e),{solveStatus:this.getSolveStatus(s,0),related:this.getRelated(i,!0),commentMention:m});else if(void 0===i&&g){var y=!1;if(!0===(y=h?r.some(function(e){var t=e.isWhole,n=e.commentList;if(!t)return!1;var r=n[0];if(r.userId===a)return!0;var i=-1<r.content.indexOf('token="'+a+'"');return!(!i||3===o.messageVersion)||!(!i||f!==r.replyId)}):g.commentList.some(function(e){if(e.userId===a)return!0;var t=-1<e.content.indexOf('token="'+a+'"');return!(!t||3===o.messageVersion)||!(!t||f!==e.replyId)}))&&3!==this.messageVersion)if(h?r.some(function(e){var t=e.commentId;return!(!e.isWhole||t===c)&&!o.messageData.find(function(e){return e.commentId===t})}):g.commentList.some(function(e){var r=e.replyId;return r!==f&&!o.messageData.find(function(e){var t=e.commentId,n=e.replyId;return t===c&&n===r})}))return void this.fetchMessages(!0);v=L(L({},e),{related:y,commentMention:m,solveStatus:this.getSolveStatus(s,0)})}if(g){var b=void 0;if(b=this.commentData[c]&&this.commentData[c].tokenReply[f]?this.commentData[c].tokenReply[f]:g.commentList.find(function(e){return e.replyId===f})){var E=g.quote,k=g.isWhole,C=g.finish,I=b.createTimestamp,S=b.content,T=b.modify,O=b.translateContent,w=b.translateStatus,R=b.updateTimestamp,x=b.extra;return v=L(L({},v),{quote:E,isWhole:k,finish:C,commentCreateTime:I,commentUpdateTime:R,content:S,modify:T,extra:x,translateContent:O,translateStatus:w,commentMention:m})}}var M=void 0!==v.related?v.related:this.getRelated(i,m===B.MENTION);return L(L({},v),{related:M,commentMention:m})}var N,_=e.userId===a;return e.type===P.Card&&l?(l.find(function(e){return e===a})&&(_=!0),L(L({},e),{solveStatus:this.getSolveStatus(s,0),related:_})):(e.type===P.Mention&&(u=e.userId,N=e.mentionUserId,_=u!==a&&N===a),L(L({},e),{related:this.getRelated(i,_),solveStatus:this.getSolveStatus(s,0)}))},I.prototype.getRelated=function(e,t){return void 0!==e?e:t},I.prototype.getSolveStatus=function(e,t){return void 0!==e?e:t},I.prototype.setupRequest=function(e){this.requestMethod=e},I.prototype.onMessageChange=function(e){this.changeQueue.push(e)},I.prototype.offMessageChange=function(t){this.changeQueue=this.changeQueue.filter(function(e){return e!==t})},I.prototype.getMessages=function(){return this.messageData},I.prototype.getOnCommentChange=function(){return this.onCommentChange},I.prototype.fetchMessages=function(i){return r(this,void 0,void 0,function(){var t,n,r=this;return f(this,function(e){switch(e.label){case 0:return!i&&this.messageData?[2,{messages:this.messageData,entities:{users:{}}}]:(t=3===this.messageVersion?y:m,[4,this.request({url:t,method:d.RequestMethod.POST,data:{obj_token:this.rootToken,obj_type:this.rootType}})]);case 1:return(n=e.sent())&&null!==n.data&&n.message?(this.messageData=n.message.map(function(e){return r.remoteMessageToMessage(e)}),this.getDiffMessages(),this.messageData.forEach(this.markDefaultRead),this.notifyMessageChange(void 0,n.entities),[2,{messages:this.messageData,entities:n.entities,badge:n.badge,messageBoxVersion:n.message_box_version}]):(this.notifyMessageChange(),[2,{messages:[],entities:{users:{}}}])}})})},I.prototype.markRead=function(e){var s=e.messageIds,l=e.memberId;return r(this,void 0,void 0,function(){var t,n,i,r,o,a=this;return f(this,function(e){switch(e.label){case 0:return[4,this.request({url:v,method:d.RequestMethod.POST,data:{member_id:l,msg_id:s}})];case 1:return t=e.sent(),n=[],i=[],r=[],s.forEach(function(r){a.messageData.forEach(function(e,t){var n;e.messageId===r&&1===a.messageData[t].status&&(n=L(L({},a.messageData[t]),{status:2}),i.push(n),a.messageData[t]=n)})}),0<i.length&&(o={deletedMessages:n,updatedMessages:i,addedMessages:r},this.notifyMessageChange(o)),[2,t]}})})},I.prototype.resovleMessage=function(e){var l=e.messageIds,c=e.memberId,u=e.solveStatus;return r(this,void 0,void 0,function(){var t,n,r,i,o,a,s=this;return f(this,function(e){switch(e.label){case 0:return t={member_id:c,obj_token:this.rootToken,obj_type:this.rootType,solve_status:u},1<l.length?t.msg_ids=l:t.msg_id=l,[4,this.request({url:b,method:d.RequestMethod.POST,data:t})];case 1:return n=e.sent(),r=[],i=[],o=[],l.forEach(function(r){s.messageData.forEach(function(e,t){var n;e.messageId===r&&s.messageData[t].solveStatus!==u&&(n=L(L({},s.messageData[t]),{solveStatus:u}),i.push(n),s.messageData[t]=n)})}),0<i.length&&(a={deletedMessages:r,updatedMessages:i,addedMessages:o},this.notifyMessageChange(a)),[2,n]}})})},I.prototype.destroy=function(){var e,t;this.msgBox&&(e=this.getTag(),this.msgBox.deregister(e,this.handleMessageBox),t=this.getUserTag(),this.msgBox.deregister(t,this.handleMessageBox)),this.changeQueue=[]},I);function I(e){var _=this,t=e.rootToken,n=e.rootType,r=e.getComments,i=e.getCurrentUserId,o=e.getIsOwner,a=e.getCurrentMemberId,s=e.messageVersion,l=e.msgBox,c=e.messageCardEnable;this.requestMethod=null,this.changeQueue=[],this.commentData={},this.messageData=[],this.handleMessageBox=function(e){var t={msg:JSON.parse(e).data,type:"MsgBox"};_.handleMessageFromServer(t)},this.handleMessageFromServer=function(e){var o=e.msg;if("NEW_DOC_MESSAGE_V2"===o.type){var t=o.data_str,n=t.message,r=t.oversize,i=t.comment;if(r)return void _.fetchMessages(!0);var a,s,l,c,u,d,f,h,p,g,v=n,m=v.message_id,y=v.comment_id,b=v.reply_id,E=i[y];E?v=L(L({},n),{comment_create_time:E.comment_list[0].create_timestamp,comment_update_time:E.comment_list[0].update_timestamp,content:E.comment_list[0].content,finish:E.finish,is_whole:E.is_whole,quote:E.quote,modify:E.comment_list[0].modify,extra:E.comment_list[0].extra}):_.commentData[y]&&(s=(a=_.commentData[y]).tokenReply,l=a.quote,c=a.isWhole,u=a.finish,v=(d=s[b])?(f=d.createTimestamp,h=d.updateTimestamp,p=d.modify,g=d.extra,L(L({},v),{comment_create_time:f,comment_update_time:h,modify:p,extra:g,finish:u,is_whole:c,quote:l})):L(L({},n),{finish:u,is_whole:c,quote:l}));var k=_.messageData.findIndex(function(e){return e.messageId===m}),C=[],I=[],S=[],T=_.normalizeMessage(_.remoteMessageToMessage(v));if(_.markDefaultRead(T),!0!==T.related)return;-1!==k?(_.messageData[k]=T,I.push(T)):(_.messageData.unshift(T),S.push(T));var O={deletedMessages:C,updatedMessages:I,addedMessages:S};_.notifyMessageChange(O)}if("DOC_MESSAGE_READ"===o.type||"DOC_MESSAGE_SOLVE"===o.type){var w=o.data_str,R=w.message_ids;if(w.user_id===_.getCurrentUserId()){for(var x=[],M=function(e){var t,n=R[e],r=_.messageData.findIndex(function(e){return e.messageId===n}),i=_.messageData[r];i&&(t=L({},i),"DOC_MESSAGE_READ"===o.type&&1===i.status&&(t.status=2),"DOC_MESSAGE_SOLVE"===o.type&&0===i.solveStatus&&(t.solveStatus=1),_.messageData[r]=t,x.push(t))},N=0;N<R.length;N++)M(N);O={deletedMessages:[],updatedMessages:x,addedMessages:[]};0<x.length&&_.notifyMessageChange(O)}}},this.remoteMessageToMessage=function(e){var t={type:e.type,status:e.status,messageId:e.message_id,related:e.related,userId:e.user_id,createTime:e.create_time,avatarUrl:e.avatar_url,name:e.name,solveStatus:e.solve_status,content:e.content,extra:e.extra,commentDelete:e.comment_delete,toUserids:e.to_userids};if(t.type===P.Card){var n=e;return L(L({},t),{type:P.Card,commentId:n.comment_id,replyId:n.reply_id,commentCreateTime:n.comment_create_time,commentUpdateTime:n.comment_update_time,content:n.content,finish:n.finish,isWhole:n.is_whole,quote:n.quote,modify:n.modify,extra:n.extra,replyIndex:n.reply_index,commentMention:n.comment_mention,commentMentionUserIds:n.comment_mention_userids,subType:n.sub_type})}if(t.type===P.Comment){n=e;return L(L({},t),{type:P.Comment,commentId:n.comment_id,replyId:n.reply_id,commentCreateTime:n.comment_create_time,commentUpdateTime:n.comment_update_time,content:n.content,finish:n.finish,isWhole:n.is_whole,quote:n.quote,modify:n.modify,extra:n.extra,replyIndex:n.reply_index,commentMention:n.comment_mention,commentMentionUserIds:n.comment_mention_userids})}if(t.type!==P.Mention)return t;var r=e;return L(L({},t),{type:P.Mention,mentionId:r.mention_id,mentionUserId:r.mention_user_id,createTime:r.create_time})},this.onCommentChange=function(e){_.commentData=e.comments.reduce(function(e,t){return e[t.commentId]=L(L({},t),{tokenReply:t.commentList.reduce(function(e,t){return e[t.replyId]=L({},t),e},{})}),e},{});var t=_.getDiffMessages(),n=t.deletedMessages,r=t.updatedMessages;(0<n.length||0<r.length)&&_.notifyMessageChange(t)},this.getDiffMessages=function(){var O=_.commentData,w=[],R=[],e=[];if(0===Object.keys(O).length)return{deletedMessages:w,updatedMessages:R,addedMessages:e};var t=_.messageData.reduce(function(e,t){var n,r=t.commentId,i=t.replyId,o=t.type,a=t.messageId,s=t.status,l=t.commentDelete,c=t.modify,u=t.translateContent,d=t.translateStatus,f=t.translateLang,h=t.finish;if(!0!==_.messageCardEnable&&t.type===P.Card&&s===D.UNREAD&&(n=_.getCurrentMemberId(),_.markRead({memberId:n,messageIds:[a]})),1===l&&s===D.UNREAD&&(n=_.getCurrentMemberId(),_.markRead({memberId:n,messageIds:[a]})),!r&&o!==P.Comment)return e.push(L({},t)),e;var p=O[r];if(!p)return w.push(t),e.push(L(L({},t),{commentDelete:1})),e;var g=p.tokenReply,v=p.quote,m=p.isWhole,y=p.finish;if(h!==y)return R.push(t),e.push(L(L({},t),{isWhole:m,finish:y})),e;if(""===i)return e.push(L(L({},t),{isWhole:m,finish:y})),e;var b=g[i];if(!b)return w.push(t),e.push(L(L({},t),{isWhole:m,finish:y,commentDelete:1})),e;var E=b.createTimestamp,k=b.modify,C=b.translateContent,I=b.translateStatus,S=b.translateLang,T=L(L({},t),{quote:v,isWhole:m,finish:y,commentCreateTime:E,modify:k,translateContent:C,translateStatus:I,translateLang:S});return c===k&&u===C&&d===I&&S===f&&h===y||R.push(T),e.push(T),e},[]);return _.messageData=t,{deletedMessages:w,updatedMessages:R,addedMessages:e}},this.markDefaultRead=function(e){var t,n=e.messageId,r=e.status,i=e.commentDelete;!0!==_.messageCardEnable&&e.type===P.Card&&r===D.UNREAD&&(t=_.getCurrentMemberId(),_.markRead({memberId:t,messageIds:[n]})),1===i&&r===D.UNREAD&&(t=_.getCurrentMemberId(),_.markRead({memberId:t,messageIds:[n]}))},this.rootToken=t,this.getComments=r,this.rootType=n,this.getCurrentUserId=i,this.getIsOwner=o,this.getCurrentMemberId=a,this.messageVersion=s,this.msgBox=l,this.messageCardEnable=c,this.registerMsgBox(),this.registerUserMsgBox()}(k=E=E||{}).COMMENT="comment",k.ALL_COMMENT="allComment",k.MESSAGE="message";var S=(T.prototype.keyOfFetch=function(e,t,n){return e+"-"+t+"-"+n},T.prototype.getCommentRecord=function(){return this.commentRecordManager.getCommentRecord(this.rootType,this.rootToken)},T.prototype.generateCommentId=function(){return Object(d.generateCommentId)()},T.prototype.generateReplyId=function(){return Object(d.generateReplyId)()},T.prototype.setupCommentRecord=function(){var e,t=this.getCommentRecord();t||((t=this.commentRecordManager.setupCommentRecord(this.rootType,this.rootToken)).setupSetting({isNewMentionUi:this.isNewMentionUi}),this.request&&t.setupRequest(this.request),this.getUserId&&t.setupGetUserId(this.getUserId),this.logger&&t.setupLogger(this.logger),this.getMemberId&&t.setupGetMemberId(this.getMemberId),this.broadcast&&(this.pendingFetch.clear(),this.fetchStatus.clear(),t.setupBroadcast(this.broadcast)),this.messageRecord&&!1!==this.isCommentMergeMessage&&(e=this.messageRecord.getOnCommentChange(),t.onCommentChange(e)),this.getLanguage&&t.setupGetLanguage(this.getLanguage))},T.prototype.setupMessageRecord=function(){var e,t,n;this.messageRecord||(e=new C({rootToken:this.rootToken,rootType:this.rootType,getComments:this.getComments,getCurrentUserId:this.getUserId,getCurrentMemberId:this.getMemberId,getIsOwner:this.getIsOwner,messageVersion:this.messageVersion,msgBox:this.msgBox,messageCardEnable:this.messageCardEnable}),this.request&&e.setupRequest(this.request),t=e.getOnCommentChange(),(n=this.getCommentRecord())&&!1!==this.isCommentMergeMessage&&n.onCommentChange(t),this.messageRecord=e)},T.prototype.setupLogger=function(e){this.logger=e;var t=this.getCommentRecord();t&&t.setupLogger(this.logger)},T.prototype.setupRequest=function(e){this.request=e,this.messageRecord&&this.messageRecord.setupRequest(e);var t=this.getCommentRecord();t&&t.setupRequest(e)},T.prototype.setupBroadcast=function(e){var t=this.getCommentRecord();this.broadcast=e,t&&(this.pendingFetch.clear(),this.fetchStatus.clear(),t.setupBroadcast(e))},T.prototype.getMessages=function(){var e=this.messageRecord;return e?e.getMessages():[]},T.prototype.fetchComments=function(a){return r(this,void 0,void 0,function(){var n,t,r,i,o=this;return f(this,function(e){if(n=this.keyOfFetch(E.ALL_COMMENT,this.rootType,this.rootToken),this.fetchStatus.get(n)&&!a)return[2,this.getComments()];if(t=this.pendingFetch.get(n))return[2,t];if(!(r=this.getCommentRecord()))throw new Error("[comment-service]no record found, setup first");return i=r.fetchInitialData().then(function(t){return o.fetchStatus.set(n,!0),o.pendingDeferred.forEach(function(e){(0,e.resolve)(t)}),o.pendingDeferred.clear(),t}).catch(function(t){if("CommentRecord is not ready, missing broadcast object, please setup first"===t.message)return new Promise(function(e,t){o.pendingDeferred.add({resolve:e,reject:t})});throw o.pendingDeferred.forEach(function(e){(0,e.reject)(t)}),o.pendingDeferred.clear(),t}).finally(function(){o.pendingFetch.has(n)&&o.pendingFetch.delete(n)}),this.pendingFetch.set(n,i),[2,i]})})},T.prototype.fetchComment=function(e){var t=this.getCommentRecord();if(!t)throw new Error("[comment-service]no record found, setup first");return t.fetchCommentAndSync(e)},T.prototype.onCommentChange=function(e){var t=this.getCommentRecord();t&&t.onCommentChange(e)},T.prototype.offCommentChange=function(e){var t=this.getCommentRecord();t&&t.offCommentChange(e)},T.prototype.onMessageChange=function(e){var t=this.messageRecord;if(!t)throw new Error("no message record found");t.onMessageChange(e)},T.prototype.offMessageChange=function(e){var t=this.messageRecord;if(!t)throw new Error("no message record found");t.offMessageChange(e)},T.prototype.addComment=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getCommentRecord()];case 1:if(!(t=e.sent()))throw new Error("no record found");return[2,t.addComment(L({},n))]}})})},T.prototype.replyComment=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getCommentRecord()];case 1:if(!(t=e.sent()))throw new Error("no record found");return[2,t.replyComment(L({},n))]}})})},T.prototype.deleteComment=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getCommentRecord()];case 1:if(!(t=e.sent()))throw new Error("no record found");return[2,t.deleteComment(n)]}})})},T.prototype.updateComment=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getCommentRecord()];case 1:if(!(t=e.sent()))throw new Error("no record found");return[2,t.updateComment(n)]}})})},T.prototype.resolveComment=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getCommentRecord()];case 1:if(!(t=e.sent()))throw new Error("no record found");return[2,t.resolveComment(L({},n))]}})})},T.prototype.reopenComment=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getCommentRecord()];case 1:if(!(t=e.sent()))throw new Error("no record found");return[2,t.reopenComment(n)]}})})},T.prototype.genReplyId=function(n){return r(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:return[4,this.getCommentRecord()];case 1:if(!(t=e.sent()))throw new Error("no record found");return[2,t.genReplyId(n)]}})})},T.prototype.fetchMessages=function(e){if(!this.messageRecord)throw new Error("no message record found");return this.messageRecord.fetchMessages(!!e)},T.prototype.markRead=function(e){var t=e.messageIds;if(!this.messageRecord)throw new Error("no message record found");return this.messageRecord.markRead({messageIds:t,memberId:this.getMemberId()})},T.prototype.resovleMessage=function(e){var t=e.messageIds,n=e.solveStatus;if(!this.messageRecord)throw new Error("no message record found");return this.messageRecord.resovleMessage({messageIds:t,memberId:this.getMemberId(),solveStatus:n})},T.prototype.destroy=function(){this.commentRecordManager.destroyCommentRecord(this.rootType,this.rootToken),this.messageRecord&&this.messageRecord.destroy(),this.fetchStatus.clear(),this.pendingFetch.clear()},T);function T(e){var n=this;this.messageRecord=null,this.request=null,this.broadcast=null,this.pendingFetch=new Map,this.pendingDeferred=new Set,this.fetchStatus=new Map,this.logger=null,this.getComments=function(){var e=n.getCommentRecord();if(!e)return{comments:[],entities:{users:{}}};var t=e.getComments();return{comments:t.comments,entities:t.entities}};var t=e.rootType,r=e.rootToken,i=e.commentRecordManager,o=e.getUserId,a=e.getMemberId,s=e.getIsOwner,l=e.getLanguage,c=e.messageVersion,u=e.msgBox,d=e.isNewMentionUi,f=e.messageCardEnable,h=e.isCommentMergeMessage;this.rootType=t,this.rootToken=r,this.commentRecordManager=i,this.getUserId=o,this.getMemberId=a,this.getIsOwner=s,this.getLanguage=l,this.messageVersion=c,this.msgBox=u,this.isNewMentionUi=d,this.messageCardEnable=f,this.isCommentMergeMessage=h}var O=(w.prototype.getOrCreateCommentService=function(e){var t=this.serviceMap.get(e.rootToken);return t||(t=new S(e),this.serviceMap.set(e.rootToken,t)),t},w.prototype.destroyCommentService=function(e){var t=this.serviceMap.get(e);t&&t.destroy(),this.serviceMap.delete(e)},w);function w(){this.serviceMap=new Map}},ptp9:function(e,t,n){"use strict";n.r(t),n.d(t,"ClientVarsEventType",function(){return w}),n.d(t,"DefaultRecordLogger",function(){return T}),n.d(t,"ForceType",function(){return N}),n.d(t,"JSONSync",function(){return Z}),n.d(t,"Record",function(){return L}),n.d(t,"RecordChangeEventType",function(){return h}),n.d(t,"RecordErrorEventType",function(){return v}),n.d(t,"RecordEventName",function(){return d}),n.d(t,"RecordManager",function(){return a}),n.d(t,"Synchronous",function(){return De}),n.d(t,"UndoEventType",function(){return x}),n.d(t,"Undoable",function(){return st});var i=n("Bw5p"),r=n("Muja"),y=n("YfG3"),b=n("hbEN"),E=n("LrWZ"),k=n("UXvI"),l=n("7EGn"),C=n("GSgQ"),o=n("4O8T"),I=n.n(o),S=n("TYER");n.d(t,"ClientErrorTypes",function(){return S.a}),n.d(t,"CursorChannel",function(){return S.b}),n.d(t,"CursorType",function(){return S.c}),n.d(t,"EngineType",function(){return S.d}),n.d(t,"ErrorEventType",function(){return S.e}),n.d(t,"MemberChannel",function(){return S.f}),n.d(t,"MessageChannel",function(){return S.g}),n.d(t,"MessageTypes",function(){return S.h}),n.d(t,"StatusCode",function(){return S.i}),n.d(t,"Sync",function(){return S.j});var a=(s.prototype.setupRecord=function(e,t){this._recordMap.has(e)?console.warn("Record with token '"+e+"' already exists."):this._recordMap.set(e,t)},s.prototype.getRecord=function(e){if(this._recordMap.has(e))return this._recordMap.get(e)},s.prototype.destroyRecord=function(e){this._recordMap.has(e)&&(this._recordMap.get(e).destroy(),this._recordMap.delete(e))},s);function s(){this._recordMap=new Map}var T=(c.prototype.log=function(e,t){this.loggable&&console.log(this.prefix,e,t)},c.prototype.enable=function(){this.loggable=!0},c.prototype.disable=function(){this.loggable=!1},c);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.loggable=!0,this.prefix="["+e.join("][")+"]"}var u="[DATA_SDK]:";function O(e){var t="string"==typeof e?new Error(u+" "+e):e;window.Slardar&&window.Slardar("Sentry",function(e){e.captureException(t)})}var d,f,h,p,w,g,v,m,R=C.default.compose;(f=d=d||{}).change="RECORD_CHANGE",f.clientVars="RECORD_CLIENTVARS",f.error="RECORD_ERROR",(p=h=h||{}).set="SET",p.remove="REMOVE",p.move="MOVE",p.replaceString="REPLACE_STRING",(g=w=w||{}).local="LOCAL",g.collab="COLLAB",(m=v=v||{}).warn="WARN",m.error="ERROR";var x,M,N,_,L=(D.create=function(e){return new D({initData:e})},D.prototype.getEventEmitter=function(){return this._em},D.prototype._recordEventFactory=function(t,n){var r=this;return function(e){r._em.trigger(t,[{type:n,detail:e}])}},D);function D(e){var s=this;this._em=new I.a,this.setClientVars=function(e,t){void 0===t&&(t=w.local);var n=e.initData;try{s._node=new C.default(null,n),s.triggerClientVarsEvent(t,e)}catch(e){console.log("setClientVars error",e,e&&e.message),O("setClientVars error, "+(e&&e.message)),s.error(e)}},this.getRecord=function(){return s.record},this.set=function(e,t){void 0===t&&(t={});var n,r=s._recordEventFactory(d.change,h.set),i=t.afterApply;try{var o=s._node,a=e.reduce(function(e,t){return R(e,o.set(t.path,t.value))},[]);"function"==typeof i&&i(a),r(a),n=a}catch(e){s.error(e)}return n},this.move=function(e,t,n){void 0===n&&(n={});var r,i=s._recordEventFactory(d.change,h.move),o=n.afterApply;try{var a=s._node.move(e,t);"function"==typeof o&&o(a),i(a),r=a}catch(e){s.error(e)}return r},this.get=function(t){var e;try{e=s._node.get(t)}catch(e){s.warn(e),console.warn("Path '"+t+"' does not exist.")}return e},this.has=function(e){var t=s.getSnapshot();return void 0!==Object(l.default)(t,e.join("."))},this.remove=function(e,t){void 0===t&&(t={});var n,r=s._recordEventFactory(d.change,h.remove),i=t.afterApply;try{var o=s._node,a=e.reduce(function(e,t){return R(e,o.remove(t))},[]);"function"==typeof i&&i(a),r(a),n=a}catch(e){s.error(e)}return n},this.replaceString=function(e,t){void 0===t&&(t={});var n=s._recordEventFactory(d.change,h.replaceString),r=t.afterApply,i=[];try{var a=s._node,o=e.reduce(function(e,t){var n=t.path,r=t.start,i=t.deleteCount,o=t.insertStr;return console.log(e,n,r,i,o),R(e,a.replaceString(n,r,i||0,o))},[]);"function"==typeof r&&r(o),n(o),i=o}catch(e){s.error(e)}return i},this.getSnapshot=function(){return s._node.getSnapshot()},this.destroy=function(){s._node=new C.default(null,{}),s._em.removeEvent(d.change),s._em.removeEvent(d.error)},this.onChange=function(e){s._em.on(d.change,e)},this.removeChangeListener=function(e){s._em.off(d.change,e)},this.onClientVars=function(e){s._em.on(d.clientVars,e)},this.removeClientVarsListener=function(e){s._em.off(d.clientVars,e)},this.onError=function(e){s._em.on(d.error,e)},this.removeErrorListener=function(e){s._em.off(d.error,e)},this.triggerChange=function(e,t,n){void 0===n&&(n=s._recordEventFactory(d.change,e)),n(t)},this.triggerClientVarsEvent=function(e,t){s._em.trigger(d.clientVars,[{type:e,detail:{clientVars:t}}])},this.error=function(e,t){void 0===t&&(t=s._recordEventFactory(d.error,v.error)),t(e)},this.warn=function(e,t){void 0===t&&(t=s._recordEventFactory(d.error,v.warn)),t(e)},this.apply=function(e,t){void 0===t&&(t={});var n=t.afterApply;try{s._node.apply(e),"function"==typeof n&&n(e)}catch(e){s.error(e)}return e},this.applyToBase=this.apply,this.recursivelySetContext=function(e){for(var t=e.record;t;)t.context=e,t=t.record};var t=e.initData,n=e.logger,r=e.namespace;this._node=new C.default(null,t||{}),this.logger=n||new T(r||"DataJS")}(M=x=x||{}).undo="UNDO",M.redo="REDO",(_=N=N||{}).SPLIT="split",_.MERGE="merge",_.REPLACE="replace";var B=function(e,t){return(B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function P(e,t){function n(){this.constructor=e}B(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var F=function(){return(F=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function j(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function z(e,a,n,s){function l(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n=n||Promise)(function(t,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function i(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){e.done?t(e.value):l(e.value).then(r,i)}o((s=s.apply(e,a||[])).next())})}function H(e,n){var r,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function s(t){return function(e){return l([t,e])}}function l(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function U(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function V(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function W(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(V(arguments[t]));return e}var K,Z=(P(q,K=S.j),q.prototype.getVersionOfOversize=function(e){return e.version},q.prototype.getVersionOfChangeset=function(e){return e.version},q.prototype.getChangesets=function(e){return e.ops},q.prototype.getVersionOfClientVars=function(e){return e.version},q.prototype.getVersionOfAcceptCommit=function(e){return e.version},q.prototype.isSelfChangeset=function(e){return e.member_id+""===this.memberId},q);function q(e){var t=K.call(this,F(F({},e),{requestAPI:{CLIENT_VARS:"/api/json/client_vars",NEW_CHANGES:"/api/json/new_changes",USER_CHANGES:"/api/json/user_changes"}}))||this;return t.missVersionLimit=100,t}var J=C.default.transform,Y=C.default.invert,Q=C.default.compose;function X(e){return e.map(function(e){return e.ops})}function $(e,n){return e.length!==n.length?[]:e.map(function(e,t){return F(F({},n[t]),{ops:e})})}function ee(e,t,n){var r=n,i=n===C.TransformType.LEFT?C.TransformType.RIGHT:C.TransformType.LEFT,o=e,a=t.map(function(e){var t=J(e,o,i);return o=J(o,e,r),t});return{tBase:o,tList:a}}function te(e,t){for(var n=e,r=t.length-1;0<=r;r--)n=J(n,Y(t[r]),C.TransformType.LEFT);return n}function ne(e,t){for(var n,r,i,o=[],a=e.length-1;0<=a;a--)e[a].tid===t&&(r=(n=re(e,a)).tOps,i=n.tBase,e=r,o=Q(o,i));return{tOps:e,tBase:o}}function re(e,t){var n=ee(Y(e[t].ops),X(e.slice(t+1)),C.TransformType.RIGHT),r=n.tList,i=n.tBase;return{tOps:e=W(e.slice(0,t),$(r,e.slice(t+1))),tBase:i}}function ie(e,t){var n=e[t],r=te(n.ops,X(e.slice(0,t))),i=re(e,t),o=i.tOps,a=i.tBase;e=o;var s=C.TransformType.RIGHT,l=C.TransformType.LEFT,c=ee(r,X(e.slice(0,t)),s),u=c.tList,d=ee(c.tBase,X(e.slice(t)),l),f=d.tList,h=d.tBase;return{tOps:e=W($(u,e.slice(0,t)),$(f,e.slice(t))),tBase:Q(a,h),head:[F(F({},n),{ops:r})]}}function oe(e){return e.reduce(function(e,t){return W(e,t.ops.map(function(e){return F(F({},t),{ops:[e]})}))},[])}function ae(e){var t,n;try{for(var r=U(e),i=r.next();!i.done;i=r.next()){var o=i.value;if(!o.action||!o.action.oi&&!o.action.od)return!1}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0}function se(e,t){for(var n,r=[],i=[],o=(e=oe(e)).length-1;0<=o;o--)e[o].tid===t&&ae(e[o].ops)&&(s=(n=ce(e,t,o)).tOps,l=n.tBase,c=n.head,e=s,i=Q(i,l),r=c);for(var a,s,l,c,o=0;o<e.length;o++)e[o].tid===t&&(ae(e[o].ops)||(s=(a=ie(e,o)).tOps,l=a.tBase,c=a.head,e=s,i=Q(i,l),r.push.apply(r,W(c)),o--));return{tOps:e,head:r,tBase:i}}function le(e,t,n,r){void 0===r&&(r=0);for(var i=e.ops,o=r,a=r-1;0<=a;a--){if(t[a].tid===n&&ae(t[a].ops)){o=a;break}i=J(i,Y(t[a].ops),C.TransformType.LEFT)}return{tBase:i,nearIndex:o}}function ce(e,t,n){var r,i=!1,o=e[n],a=o.ops,s=le(o,e,t,n),l=s.tBase,c=s.nearIndex;if(n!==s.nearIndex)r=Q(e[c].ops,l);else{if(0===n)return{tOps:e.slice(n+1),tBase:[],head:[F(F({},o),{ops:l})],nearIndex:c};r=l,i=!0}i&&(c=-1,r=l=te(a,X(e.slice(0,n))));var u=re(e,n),d=u.tOps,f=u.tBase,h=ee(l,X((e=d).slice(c+1,n)),C.TransformType.LEFT),p=h.tList,g=ee(h.tBase,X(e.slice(n)),C.TransformType.RIGHT),v=g.tList,m=g.tBase;return{tOps:e=i?W($(p,e.slice(c+1,n)),$(v,e.slice(n))):W(e.slice(0,c),[F(F({},o),{ops:r})],$(p,e.slice(c+1,n)),$(v,e.slice(n))),tBase:Q(f,m),head:[F(F({},o),{ops:l})],nearIndex:c}}function ue(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function de(){return"_"+Math.random().toString(36).substr(2,9)}var fe,he,pe=C.default.compose,ge=C.default.invert,ve=C.default.transform;(he=fe=fe||{}).cancel="TRANSACTION_CANCEL",he.submit="TRANSACTION_SUBMIT";var me=(ye.prototype.set=function(e,t){void 0===t&&(t={}),this.context.set(this.tid,e,t)},ye.prototype.move=function(e,t,n){this.context.move(this.tid,e,t,n)},ye.prototype.cancel=function(){this.context.cancel(this.tid)},ye.prototype.submit=function(e,t){this.context.submit(this.tid,e,t)},ye);function ye(e,t){var n=this;this.tid=e,this.context=t,this.remove=function(e,t){void 0===t&&(t={}),n.context.remove(n.tid,e,t)}}var be=(Ee.prototype.findLastIndexOfTransaction=function(e){for(var t=this.tOps,n=t.length-1;0<=n&&t[n].tid!==e;)n--;return n},Ee.prototype.pushTransactionOp=function(e){var t,n,r,i,o,a=e.tid,s=e.ops,l=e.options,c=this.tOps,u=this.syncRecord.getCoreRecord(),d=s;l.force===N.REPLACE?0<=(t=this.findLastIndexOfTransaction(a))&&(r=(n=re(c,t)).tOps,i=n.tBase,this.tOps=r,d=ve(s,i,C.TransformType.LEFT),u.apply(pe(pe(ge(s),i),d))):l.force===N.MERGE&&(o=c[c.length-1])&&o.tid===a&&(l.force===N.MERGE||l.type===o.options.type&&l.force!==N.SPLIT)&&(c.pop(),d=pe(o.ops,s)),this.tOps.push({ops:d,tid:a,options:l})},Ee.prototype.startTransaction=function(e){var t=this,n=t.set,r=t.cancel,i=t.submit,o=t.move,a=t.transactions,s=t.remove,l=e||de(),c=a.get(l);if(c)return console.warn("Transaction "+e+" is already start"),c;var u=new me(l,{set:n,cancel:r,submit:i,move:o,remove:s});return a.set(l,u),u},Ee.prototype.transform=function(e){var t=this.tOps,n=ee(e,t.map(function(e){return e.ops}),C.TransformType.RIGHT),r=n.tList,i=n.tBase;return t.forEach(function(e,t){e.ops=r[t]}),i},Ee.prototype.getOperations=function(){return X(this.tOps)},Ee.prototype.getComposedTransactionOps=function(e){void 0===e&&(e=this.tOps);var t=X(e),n=[];return t.forEach(function(e){n=pe(n,e)}),n},Ee.prototype.destroy=function(){this.transactions.clear(),this.tOps=[]},Ee);function Ee(e){var u=this;this.syncRecord=e,this.transactions=new Map,this.tOps=[],this.set=function(e,t,n){void 0===n&&(n={});var r=u.syncRecord.getCoreRecord().set(t,n);u.pushTransactionOp({tid:e,ops:r,options:n})},this.move=function(e,t,n,r){void 0===r&&(r={});var i=u.syncRecord.getCoreRecord().move(t,n,r);u.pushTransactionOp({tid:e,ops:i,options:r})},this.cancel=function(e){var t=ne(u.tOps,e),n=t.tOps,r=t.tBase,i=u.syncRecord.getCoreRecord();u.tOps=n,i.apply(r),u.transactions.delete(e),i.triggerChange(fe.cancel,r)},this.submit=function(e,t,n){var r=u.syncRecord.record.context||u.syncRecord.record;if(t)return u.cancel(e),void r.set(t,n);var i=u.syncRecord.getCoreRecord(),o=se(u.tOps,e),a=o.tOps,s=o.head,l=ge(u.getComposedTransactionOps());u.syncRecord.getCoreRecord().apply(l),s.forEach(function(e){var t=e.ops,n=e.options;r.applyToBase(t,n)}),u.tOps=a;var c=u.getComposedTransactionOps();u.syncRecord.getCoreRecord().apply(c),i.triggerChange(fe.submit,u.getComposedTransactionOps(s))},this.remove=function(e,t,n){void 0===n&&(n={});var r=u.syncRecord.getCoreRecord().remove(t,n);r&&u.pushTransactionOp({tid:e,ops:r,options:n})}}var ke=(Object.defineProperty(Ce.prototype,"members",{get:function(){return this._members},enumerable:!0,configurable:!0}),Ce.prototype.assignMemberInfo=function(e,t){var n=Object(l.default)(e,"entities.users",{}),r=Object.assign(t);return r.forEach(function(e){e=Object.assign(e,n[e.suid||e.user_id])}),r},Ce);function Ce(e){var a=this;this._members=new Map,this.handleUserNewInfo=function(e){var t=e.entities,n=j(e,["entities"]),r=Object(l.default)(t,"users",{}),i=Object.assign(n,r[n.user_id]),o=i.member_id;a._members.has(o)||a._members.set(o,i)},this.handleUserLeave=function(e){e.member_id.forEach(function(e){a._members.delete(e)})},this.handleMembersMessage=function(e){var t=a.assignMemberInfo(e,e.members);a._members=new Map(t.map(function(e){return[e.member_id,e]}))},e.on(S.h.USER_NEWINFO,this.handleUserNewInfo),e.on(S.h.USER_LEAVE,this.handleUserLeave),e.on(S.h.ROOM_MEMBERS,this.handleMembersMessage)}var Ie,Se,Te,Oe,we=C.default.compose,Re=C.default.transform,Ae=C.default.invert;(Se=Ie=Ie||{}).userChange="USER_CHANGE",Se.submittedChange="SUBMITTED_CHANGE",Se.operationComposed="OPERATION_COMPOSED",(Oe=Te=Te||{}).unsubmit="UNSUBMITTED",Oe.submitted="SUBMITTED";var xe="member",Me="cursor",Ne=3,_e=8e3,Le="COLLAB";function De(e,m){function t(e,t){var c=this;this.operation=[],this._operationCbs=[],this.submitted=[],this._submittedCbs=[],this.transactionManager=new be(this),this._unhandledCollabEvents=[],this._collab=!0,this._em=new I.a,this.userChangeUuid="",this.submittedUuid="",this.retryTimes=0,this.startTransaction=function(e){return c.transactionManager.startTransaction(e)},this.setClientVars=function(e){var t=e.initData,n=e.version;c.record.setClientVars({initData:t}),c.setUserOperation([]),c.setSubmittedOperation([]),c._operationCbs=[],c._submittedCbs=[],c._sync&&c._sync.setClientVars(n)},this.fetchClientVars=function(){if(c._sync)return c._sync.fetchClientVars().then(function(e){var t,n;e&&e.data&&e.data.data?0===(t=Object.keys(e.data.data)).length&&O("recordKeys: "+t.join(",")):(n="",e.data&&(n+="data.data: "+Object.keys(e.data).join(",")),e.data.data&&(n+="\ndata.data.data: "+Object.keys(e.data.data).join(",")),O(n));var r=e.data.data;return c.record.setClientVars({initData:r},w.collab),e})},this.set=function(r,i){return void 0===i&&(i={}),new Promise(function(n){return z(c,void 0,void 0,function(){var t=this;return H(this,function(e){return this.record.set(r,F(F({},i),{afterApply:function(e){return t.afterApply(e,n,i)}})),[2]})})})},this.move=function(r,i,o){return void 0===o&&(o={}),new Promise(function(n){return z(c,void 0,void 0,function(){var t=this;return H(this,function(e){switch(e.label){case 0:return[4,this.record.move(r,i,F(F({},o),{afterApply:function(e){return t.afterApply(e,n,o)}}))];case 1:return e.sent(),[2]}})})})},this.remove=function(r,i){return void 0===i&&(i={}),new Promise(function(n){return z(c,void 0,void 0,function(){var t=this;return H(this,function(e){switch(e.label){case 0:return[4,this.record.remove(r,F(F({},i),{afterApply:function(e){return t.afterApply(e,n,i)}}))];case 1:return e.sent(),[2]}})})})},this.replaceString=function(e,n){return void 0===n&&(n={}),new Promise(function(t){c.record.replaceString(e,F(F({},n),{afterApply:function(e){return c.afterApply(e,t,n)}}))})},this.afterApply=function(e,t,n){var r=c.transactionManager,i=c.getCoreRecord();i.apply(we(Ae(e),Ae(r.getComposedTransactionOps())));var o=te(e,r.getOperations());return n.afterApply&&n.afterApply(o),r.transform(o),i.apply(we(o,r.getComposedTransactionOps())),o&&c._enqueueUpdateTask(o,t.bind(c,o)),o},this.apply=function(a,s){return void 0===s&&(s={}),new Promise(function(o){return z(c,void 0,void 0,function(){var t,n,r,i=this;return H(this,function(e){switch(e.label){case 0:return t=this.transactionManager.getComposedTransactionOps(),n=Ae(t),this.getCoreRecord().apply(n),[4,this.record.apply(a,F(F({},s),{afterApply:function(e){s.afterApply&&s.afterApply(e),i.transactionManager.transform(e);var t=i.transactionManager.getComposedTransactionOps();i.getCoreRecord().apply(t)}}))];case 1:return(r=e.sent())&&this._enqueueUpdateTask(r,o.bind(this,r)),[2]}})})})},this.applyToBase=function(e,t){void 0===t&&(t={}),c.record.applyToBase(e,t),c._enqueueUpdateTask(e)},this.pauseSync=function(){c._collab=!1},this.resumeSync=function(){c._collab=!0;for(var e=c._unhandledCollabEvents,t=e.length,n=0;n<t;n+=1)c._onCollabChange(e[n]);c._unhandledCollabEvents=[],c.syncChanges()},this.retrySync=function(){c._sync&&c.submitted.length&&c.sendUserChange(c.submitted,c.submittedUuid)},this.throttleRetrySync=Object(k.default)(function(){c._sync&&c.submitted.length&&(c.retryTimes>=Ne?c.record.error({type:S.e.CLIENT_ERROR,code:S.i.RETRY_OVER_TIMES,msg:"data-sdk retry over times"}):(c.retryTimes++,c.retrySync()))},_e),this.destroy=function(){c.transactionManager.destroy(),c.record.destroy(),c.setUserOperation([]),c.userChangeUuid="",c.setSubmittedOperation([]),c.submittedUuid="",c._operationCbs=[],c._submittedCbs=[],c._sync.destroy(),c._unhandledCollabEvents=[],c._collab=!0},this.handleNewChanges=function(e){var t=e.op.operations,n=c.submitted,r=we([],t||[]),i=Re(r,n,C.TransformType.RIGHT),o=Re(n,r,C.TransformType.LEFT);o&&0<o.length?c.setSubmittedOperation(o):(c.setSubmittedOperation([]),c._notifyCbs(Te.submitted));var a=we([],c.operation),s=a;(a=Re(s,i,C.TransformType.LEFT))&&0<a.length?c.setUserOperation(a):(c.setUserOperation([]),c._notifyCbs(Te.unsubmit));var l=Re(i,s,C.TransformType.RIGHT),l=c.transactionManager.transform(l);c.record.apply(l),c._triggerRecordCollabChange(l)},this.handlecceptCommit=function(){c.retryTimes=0,c.setSubmittedOperation([]),c._notifyCbs(Te.submitted)},this.onOperationComposed=function(e){c._em.on(Ie.operationComposed,e)},this.removeOperationComposedListener=function(e){c._em.off(Ie.operationComposed,e)},this.onUserOpChange=function(e){c._em.on(Ie.userChange,e)},this.removeUserOpChangeListener=function(e){c._em.off(Ie.userChange,e)},this.onSubmittedOpChange=function(e){c._em.on(Ie.submittedChange,e)},this.removeSubmittedOpChangeListener=function(e){c._em.off(Ie.submittedChange,e)},this.getSync=function(){return c._sync};var n=t.token,r=t.io,i=t.type,o=t.logger,a=t.tenant_id,s=t.extraMessages,l=t.version,u=t.initData,d=t.resourceType,f=t.routeKey,h=t.routeType,p=t.request;this.record=e,this._token=n;var g=new Set(s);this._sync=new Z({token:n,io:r,type:i||S.d.JSON,logger:null!=o?o:d?new T("DataJS","Sync",i||S.d.JSON,d):new T("DataJS","Sync",i||S.d.JSON),requestDataOptions:F({tenant_id:a},{resource_type:d}),requestWatchDataOptions:{route_type:h,route_key:f},requestExceptWatchHeaderOptions:{"route-key":f,"route-type":h},request:p,isNewProtocol:m.isNewProtocol,registerChannels:function(e){var t={};return g.has(xe)&&(t[xe]=new S.f(e,{fetchMemberList:function(){return e.autoRetryRequest({type:S.h.MESSAGE_CHANNEL,token:e.token,name:S.g.MEMBER_CHANNEL,member_id:e.memberId})}})),g.has(Me)&&(t[Me]=new S.b),t}}),g.has(xe)&&(this.memberTracker=new ke(this._sync.channels.member)),this._sync.on(S.h.NEW_CHANGES,function(e){c._onCollabChange({type:S.h.NEW_CHANGES,data:e})}),this._sync.on(S.h.ACCEPT_COMMIT,function(e){c._onCollabChange({type:S.h.ACCEPT_COMMIT,data:e})}),this._sync.on(S.h.ERROR,this._onCollabError.bind(this)),Object(E.a)(l)||Object(E.a)(u)||this.setClientVars({version:l,initData:u}),this.syncChanges=Object(b.default)(this._collectChanges,500);var v=Object(y.a)({},this.record,this);return v.recursivelySetContext(v),v}return new(t.prototype.getCoreRecord=function(){for(var e=this.record;e.record;)e=e.record;return e},t.prototype._ableToSync=function(){return this._collab},t.prototype._onCollabChange=function(e){if(this._ableToSync())switch(e.type){case S.h.NEW_CHANGES:this.handleNewChanges(e.data);break;case S.h.ACCEPT_COMMIT:this.handlecceptCommit();break;default:console.error("Unhandle collaborative event")}else this._unhandledCollabEvents.push(e)},t.prototype._onCollabError=function(e){this.record.error(e)},t.prototype._enqueueUpdateTask=function(e,t){var n=this.operation,r=we(n,e);this._sync&&(this.userChangeUuid=Be()),this.setUserOperation(r),this._em.trigger(Ie.operationComposed,[e]),t&&this._operationCbs.push(t),this.syncChanges()},t.prototype._collectChanges=function(){var e,t;this._ableToSync()&&this._sync&&(e=!1,this.submitted.length&&(e=!0),e?this.throttleRetrySync():(t=this.operation,!e&&t.length&&(this.setUserOperation([]),this.submittedUuid=this.userChangeUuid,this.setSubmittedOperation(t),this._submittedCbs=this._operationCbs,this._operationCbs=[],this.sendUserChange(t,this.userChangeUuid))))},t.prototype.sendUserChange=function(e,t){this._sync.sendUserChange({content:{operations:e,valid:!0},uuid:t,version:this._sync.version+1})},t.prototype._notifyCbs=function(e){function t(e){var t=e.length;if(t)for(var n=0;n<t;n+=1)e[n]()}e===Te.submitted&&(t(this._submittedCbs),this._submittedCbs=[]),e===Te.unsubmit&&(t(this._operationCbs),this._operationCbs=[])},t.prototype._triggerRecordCollabChange=function(e){this.record.triggerChange(Le,e)},t.prototype.setUserOperation=function(e){this._sync&&!Object(r.default)(e,this.operation)&&(this.operation=e,this._em.trigger(Ie.userChange,[{ops:e,version:this._sync.version,uuid:this.userChangeUuid}]))},t.prototype.setSubmittedOperation=function(e){this._sync&&!Object(r.default)(e,this.submitted)&&(this.submitted=e,this._em.trigger(Ie.submittedChange,[{ops:e,version:this._sync.version,uuid:this.submittedUuid}]))},t)(e,m)}function Be(){var e=(new Date).getTime();return ue()+"-"+e}var Pe=C.default.compose,Fe=C.default.transform,je=C.default.invert,ze="__EXTERNAL_EVENT__";function He(e){var t=e.type;return t||console.warn("Expect a type of undo event but got '"+t+"'. Explicitly defining a type is highly recommended."),F({type:"__DEFAULT_TYPE__",force:null,undoable:!0},e)}function Ue(e){return{operations:e.operations,type:e.type,undoable:e.undoable}}function Ve(e){return e.type===ze}function We(e){return!!e.undoable}var Ke=(Ze.prototype.destroy=function(){this.undoStack=[],this.redoStack=[]},Ze.prototype._getInverseUndoEventType=function(e){return e===x.undo?x.redo:x.undo},Ze.prototype._getStack=function(e){return e===x.undo?this.undoStack:this.redoStack},Ze.prototype._setStack=function(e,t){e===x.undo?this.undoStack=t:this.redoStack=t},Ze.prototype._popStackFactory=function(e){var t=this._getStack(e);return function(){return t&&0!==t.length?t.pop():null}},Ze.prototype._popUndoStack=function(e){return void 0===e&&(e=this._popStackFactory(x.undo)),e()},Ze.prototype._pushStackFactory=function(e){var t=this._getStack(e);return function(e){t.push(e)}},Ze.prototype._pushUndoStack=function(e,t){return void 0===t&&(t=this._pushStackFactory(x.undo)),t(e)},Ze.prototype._getStackTopFactory=function(e){var t=this._getStack(e);return function(){var e=t.length;return 0===e?null:t[e-1]}},Ze.prototype.getUndoStackTop=function(e){return void 0===e&&(e=this._getStackTopFactory(x.undo)),e()},Ze.prototype.getRedoStackTop=function(e){return void 0===e&&(e=this._getStackTopFactory(x.redo)),e()},Ze.prototype._performUndoFactory=function(e,t,n,r){return void 0===t&&(t=this._popStackFactory(e)),void 0===n&&(n=this._getStackTopFactory(e)),void 0===r&&(r=this._pushStackFactory(this._getInverseUndoEventType(e))),function(){var e=t();return e?(r(e),e):null}},Ze.prototype.clearUndoStack=function(){this.undoStack=[]},Ze.prototype.clearRedoStack=function(){this.redoStack=[]},Object.defineProperty(Ze.prototype,"canUndo",{get:function(){return 0<this.undoStack.length},enumerable:!0,configurable:!0}),Object.defineProperty(Ze.prototype,"canRedo",{get:function(){return 0<this.redoStack.length},enumerable:!0,configurable:!0}),Ze.prototype.undo=function(e){return void 0===e&&(e=this._performUndoFactory(x.undo)),e()},Ze.prototype.redo=function(e){return void 0===e&&(e=this._performUndoFactory(x.redo)),e()},Ze.prototype.do=function(e){this._pushUndoStack(e),this.clearRedoStack()},Ze);function Ze(){this.undoStack=[],this.redoStack=[]}var Ge,qe=(P(Je,Ge=Ke),Je.create=function(e){return new Je(e=e||de())},Object.defineProperty(Je.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Je.prototype.trigger=function(e,t){var n,r,i=e===x.undo?this.undoCallbacks:this.redoCallbacks;try{for(var o=U(i),a=o.next();!a.done;a=o.next())(0,a.value)(t)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},Je.prototype.on=function(e,t){(e===x.undo?this.undoCallbacks:this.redoCallbacks).add(t)},Je.prototype.pushEvent=function(e,t){void 0===t&&(t=!0);var n=He(e);return Ve(n)||!We(n)?(this._applyNonUndoableEvent(n),!0):(n.operations=je(n.operations),this._applyUndoableEvent(n,t))},Je.prototype.pushExternalEvent=function(e){return this.pushEvent({operations:e,type:ze})},Je.prototype._performUndoFactory=function(l,c,u,d){var f=this;return void 0===c&&(c=this._popStackFactory(l)),void 0===u&&(u=this._getStackTopFactory(l)),void 0===d&&(d=this._pushStackFactory(this._getInverseUndoEventType(l))),function(){var e=c();if(!e)return null;var t,n=e.type,r=e.operations,i=e.transformBase,o=r;i&&(o=Fe(o,i,C.TransformType.LEFT),t=Fe(i,o,C.TransformType.RIGHT));var a=je(o);d({type:n,operations:a});var s=u();return t&&s&&(s.transformBase=Pe(s.transformBase||[],t)),f.trigger(l,o),o}},Je.prototype._shouldComposeElement=function(e,t,n){return n!==N.SPLIT&&!1!==t.undoable&&(!t.transformBase&&(n===N.MERGE||e.type===t.type))},Je.prototype._composeElements=function(e,t){var n=e.type,r=e.transformBase;return{operations:Pe(e.operations,t.operations),type:n,transformBase:r}},Je.prototype._applyUndoableEvent=function(e,t){var n,r=e.force,i=Ue(e),o=this.getUndoStackTop(),a=!1;return t&&o&&this._shouldComposeElement(i,o,r)?(n=this._composeElements(i,o),this._popUndoStack(),this._pushUndoStack(n),a=!0):this._pushUndoStack(i),this.clearRedoStack(),a},Je.prototype._applyNonUndoableEvent=function(e){var t=this.getUndoStackTop(),n=this.getRedoStackTop(),r=e.operations;t&&(t.transformBase=this._updateTransformBase(t,r)),n&&(n.transformBase=this._updateTransformBase(n,r))},Je.prototype._updateTransformBase=function(e,t){var n=e.transformBase;return Pe(n||[],t)},Je);function Je(e){var r=Ge.call(this)||this;return r._id=e,r.undoCallbacks=new Set,r.redoCallbacks=new Set,r.do=r.pushEvent,r._updateTransformBaseFactory=function(n){return function(e){var t=n===x.undo?r.getUndoStackTop():r.getRedoStackTop();t&&(t.transformBase=r._updateTransformBase(t,e))}},r.updateUndoTransformBase=r._updateTransformBaseFactory(x.undo),r.updateRedoTransformBase=r._updateTransformBaseFactory(x.redo),r}function Ye(e){return"string"==typeof e&&(e=new Qe(e)),e}var Qe=(Xe.prototype.getId=function(){return this.id},Xe);function Xe(e){this.id=e}var $e,et=(P(tt,$e=Ke),tt.prototype.clearByRef=function(e){var t=(e=Ye(e)).getId();this._setStack(x.undo,this._getStack(x.undo).filter(function(e){return e.getId()!==t})),this._setStack(x.redo,this._getStack(x.redo).filter(function(e){return e.getId()!==t}))},tt.prototype.getAllRefsInStack=function(){return new Set(W(this._getStack(x.undo),this._getStack(x.redo)).map(function(e){return e.getId()}))},tt);function tt(){return null!==$e&&$e.apply(this,arguments)||this}var nt=(rt.create=function(){return new rt},rt.prototype.register=function(e){this.undoModules.set(e.id,e)},rt.prototype.unregister=function(e){this.undoModules.delete(e),this.stack.clearByRef(e)},rt.prototype.undo=function(){var e=this.stack.undo();if(e){var t=e.getId();if(this.undoModules.has(t)){var n=this.undoModules.get(t);if(n)return n.undo()}}},rt.prototype.redo=function(){var e=this.stack.redo();if(e){var t=e.getId();if(this.undoModules.has(t)){var n=this.undoModules.get(t);if(n)return n.redo()}}},rt.prototype.do=function(e,t){var n=(e=Ye(e)).getId();if(this.undoModules.has(n)){var r=this.undoModules.get(n);if(r){if(t){if(!0===t.external||!1===t.undoable)return void this.updateTransformBase(t.operations);var i,o=this.stack.getUndoStackTop();r.do&&(i=!o||n===o.getId(),r.do(t,i)?this.stack.clearRedoStack():this.stack.do(e))}else this.stack.do(e);this.undoModules.forEach(function(e){e.clearRedoStack&&e.clearRedoStack()})}}},rt.prototype.getAllRefsInStack=function(){return this.stack.getAllRefsInStack()},rt.prototype._updateTransformBaseFatcory=function(a){var s=this;return function(e){var t,n,r,i,o=a===x.undo?s.stack.getUndoStackTop():s.stack.getRedoStackTop();o&&(t=o.getId(),!s.undoModules.has(t)||(n=s.undoModules.get(t))&&(r=n.updateUndoTransformBase,i=n.updateRedoTransformBase,r&&i&&(a===x.undo?r:i)(e)))}},rt.prototype.updateTransformBase=function(e,t,n){void 0===t&&(t=this._updateTransformBaseFatcory(x.undo)),void 0===n&&(n=this._updateTransformBaseFatcory(x.redo)),t(e),n(e)},Object.defineProperty(rt.prototype,"canUndo",{get:function(){return this.stack.canUndo},enumerable:!0,configurable:!0}),Object.defineProperty(rt.prototype,"canRedo",{get:function(){return this.stack.canRedo},enumerable:!0,configurable:!0}),rt.prototype.destroy=function(){this.undoModules.clear(),this.stack.destroy()},rt.prototype.clearHistory=function(){this.stack.clearRedoStack()},rt);function rt(){this.undoModules=new Map,this.stack=new et}var it="__DataSDK__",ot=(at.prototype.handleUndoEventFactory=function(n){var r=this;return function(e){r.logger.log("dev_"+n,{opLen:e.length});var t=r.record.context||r.record;t.apply(e),t.triggerChange(n,e)}},at.prototype.register=function(){var e=qe.create(it);this.undoDispatcher.register(e),e.on(x.undo,this.handleUndoEventFactory(x.undo)),e.on(x.redo,this.handleUndoEventFactory(x.redo))},at.prototype._handleRecordChange=function(e){var t=e.type,n=e.detail;"COLLAB"===t&&n&&this.undoDispatcher.do(it,{operations:n,external:!0})},at);function at(e,t){var r=this;void 0===t&&(t={}),this.undoDispatcher=nt.create(),this.destroy=function(){r.record.destroy(),r.undoDispatcher.destroy()},this.getUndoDispatcher=function(){return r.undoDispatcher},this.set=function(e,t){return void 0===t&&(t={}),r.record.set(e,F(F({},t),{afterApply:function(e){return r.afterApply(e,t)}}))},this.move=function(e,t,n){return void 0===n&&(n={}),r.record.move(e,t,F(F({},n),{afterApply:function(e){return r.afterApply(e,n)}}))},this.remove=function(e,t){return void 0===t&&(t={}),r.record.remove(e,F(F({},t),{afterApply:function(e){return r.afterApply(e,t)}}))},this.replaceString=function(e,t){void 0===t&&(t={}),r.record.replaceString(e,F(F({},t),{afterApply:function(e){return r.afterApply(e,t)}}))},this.afterApply=function(e,t){var n=e;return t.afterApply&&(n=t.afterApply(e)),n?(r.undoDispatcher.do(it,F({operations:n},Object(i.a)(t,["type","force","undoable"]))),n):[]},this.applyToBase=function(e,t){void 0===t&&(t={}),e&&r.record.applyToBase(e,{afterApply:function(e){r.undoDispatcher.do(it,F({operations:e},Object(i.a)(t,["type","force","undoable"])))}})},this.undo=function(){return r.undoDispatcher.undo()},this.redo=function(){return r.undoDispatcher.redo()},this.canUndo=function(){return r.undoDispatcher.canUndo},this.canRedo=function(){return r.undoDispatcher.canRedo},this.record=e,this.record.onChange(this._handleRecordChange.bind(this));var n=Object(y.a)({},this.record,this);return n.recursivelySetContext(n),this.logger=t.logger||new T("DataJS","Undoable"),this.register(),n}function st(e,t){return new ot(e,t)}},"x/Yo":function(e,t,n){"use strict";n.r(t),n.d(t,"BooleanNumber",function(){return d}),n.d(t,"CHANGE_TYPE",function(){return p}),n.d(t,"CommentRecord",function(){return B}),n.d(t,"CommentRecordManager",function(){return j}),n.d(t,"POST_ADD_COMMENT",function(){return _}),n.d(t,"POST_DELETE_REPLY_COMMENT",function(){return N}),n.d(t,"POST_GET_ALL_COMMENT_LIST",function(){return O}),n.d(t,"POST_GET_COMMENT_LIST",function(){return w}),n.d(t,"POST_REPLY_COMMENT",function(){return R}),n.d(t,"POST_UPDATE_COMMENT",function(){return x}),n.d(t,"POST_UPDATE_REPLY_COMMENT",function(){return M}),n.d(t,"RequestMethod",function(){return g}),n.d(t,"RetryType",function(){return o}),n.d(t,"generateCommentId",function(){return V}),n.d(t,"generateReplyId",function(){return U}),n.d(t,"getCurrentTimestampBySecond",function(){return W}),n.d(t,"keyOf",function(){return F});var p,r,d,i,o,a,g,s,v=n("oaNE"),l=n("IzLi"),c=n("gSGL"),f=n("XIp8"),h=n("Muja"),u=n("1myf"),m=n("7EGn"),y=function(){return(y=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function b(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function E(e,a,n,s){function l(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n=n||Promise)(function(t,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function i(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){e.done?t(e.value):l(e.value).then(r,i)}o((s=s.apply(e,a||[])).next())})}function k(e,n){var r,i,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},t={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function s(t){return function(e){return l([t,e])}}function l(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,i=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(e,a)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function C(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function I(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function S(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(I(arguments[t]));return e}(r=p=p||{}).LOCAL="local",r.COLLABORATE="collaborate",(i=d=d||{})[i.TRUE=1]="TRUE",i[i.FALSE=0]="FALSE",(a=o=o||{}).UPDATE="update",a.DELETE="delete",a.EDIT="edit",a.ADD="add",a.REPLY="reply",(s=g=g||{}).POST="post",s.GET="get";var T="/api",O=T+"/comment/all/",w=T+"/comment/get/",R=T+"/comment/reply/add/",x=T+"/comment/update/",M=T+"/comment/reply/update/",N=T+"/comment/reply/delete/",_=T+"/comment/add/",L=T+"/comment/gen_reply_id/",D=/<at type="0" href="(.*?)" token="([A-Za-z0-9]+?)">([\s\S]*?)<\/at>/gi,B=(P.prototype.remoteReplyToRely=function(e){var t=e.reply_id,n=e.user_id,r=e.delete_flag,i=e.reply_uuid,o=e.modify,a=e.extra,s=e.translate_content,l=e.translate_status,c=e.translate_lang,u=e.equal_lang,d=e.sending,f=e.retry_type,h=e.error;return r?null:{replyId:t,userId:n,name:this.getUserName(e.name,n),avatarUrl:e.avatar_url,content:this.getReplyContent(e.content),createTimestamp:e.create_timestamp,updateTimestamp:e.update_timestamp,deleted:r,modify:o,compatibleReplyIdBeforeSend:i,extra:a,translateStatus:l,translateContent:s,translateLang:c,equalLang:u,sending:d,retryType:f,error:h}},P.prototype.getUserName=function(e,t){var n=this.language;if(!n)return e;var r=Object(m.default)(this.commentData,"entities.users."+t);return r?this.getUserShowNameForLang(n,r):e},P.prototype.getReplyContent=function(e){var o=this,a=this.language;return a?e.replace(D,function(e,t,n){var r=Object(m.default)(o.commentData,"entities.users."+n);if(!r)return e;var i=o.getUserShowNameForLang(a,r);return'<at type="0" href="'+t+'" token="'+n+'">'+(!0===o.isNewMentionUi?i:"@"+i)+"</at>"}):e},P.prototype.getUserShowNameForLang=function(e,t){return"en"===e?t.en_name||t.name||t.cn_name:t.name||t.cn_name||t.en_name},P.prototype.remoteCommentToComment=function(e,t){var n=this,r=t.comment_list.map(function(e){return n.remoteReplyToRely(e)}).filter(function(e){return!!e});return{commentId:e,tempCommentId:t.comment_uuid,commentList:Object(u.a)(r,"createTimestamp"),userId:t.user_id,finish:t.finish,quote:t.quote,finishUserId:t.finish_user_id,finishTimestamp:t.finish_timestamp,isWhole:t.is_whole,parentType:t.parent_type,parentToken:t.parent_token,createTimestamp:t.create_timestamp,updateTimestamp:t.update_timestamp,unSubmitComment:!1}},P.prototype.sort=function(e){return Object(u.a)(e,"createTimestamp")},P.prototype.request=function(n){return E(this,void 0,void 0,function(){var t;return k(this,function(e){switch(e.label){case 0:if(!this.requestMethod)throw new Error("no request method found");return this.getMemberId&&(t={memberId:this.getMemberId()},n.headers&&(t=y(y({},n.headers),t)),n.headers=t),[4,this.requestMethod(n)];case 1:return[2,e.sent().data]}})})},P.prototype.fetchComment=function(t){return E(this,void 0,void 0,function(){return k(this,function(e){switch(e.label){case 0:return[4,this.request({url:w,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,comment_id:t}})];case 1:return[2,e.sent()]}})})},P.prototype.findComment=function(t){return this.commentData.comments.find(function(e){return e.commentId===t})},P.prototype.getNewCommentsByNewReply=function(e,t,n,r){var i=S(e),o=e.findIndex(function(e){return e.commentId===t});if(-1===o)throw new Error("no comment found");var a=e[o],s=!1,l=a.commentList.reduce(function(e,t){return t.replyId===n?(s=!0,r&&e.push(r)):e.push(t),e},[]);return!s&&r&&l.push(r),0===l.length?i.splice(o,1):i[o]=y(y({},a),{commentList:l}),i},P.prototype.getNewComments=function(e,t){var n,r,i=[],o=!1;try{for(var a=C(e),s=a.next();!s.done;s=a.next()){var l=s.value;l.commentId===t.commentId?(i.push(t),o=!0):i.push(l)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o||i.push(t),i},P.prototype.setupSetting=function(e){var t=e.isNewMentionUi;this.isNewMentionUi=t},P.prototype.setupRequest=function(e){this.requestMethod=e},P.prototype.setupGetUserId=function(e){},P.prototype.setupBroadcast=function(e){var t=this.broadcast===e;this.broadcast=e,this.broadcast.unregister("comment",t),this.broadcast.register("comment",this.handleCommentChange,t),this.logger&&this.broadcast.setupLogger(this.logger)},P.prototype.setupGetLanguage=function(e){this.language=e()},P.prototype.setupLogger=function(e){this.logger=e},P.prototype.setupGetMemberId=function(e){this.getMemberId=e},P.prototype.fetchCommentAndSync=function(f){return E(this,void 0,void 0,function(){var t,n,a,s,r,l,i,o,c,u,d;return k(this,function(e){switch(e.label){case 0:return[4,this.fetchComment(f)];case 1:t=e.sent(),n=t.entities,t.version,a=b(t,["entities","version"]),s=S(this.commentData.comments),r=function(t){var r,e,n=a[t],i=s.findIndex(function(e){return e.commentId===t}),o=l.remoteCommentToComment(t,n);0===o.commentList.length?-1<i&&s.splice(i,1):-1<i?(r=s[i],e=o.commentList.reduce(function(e,t){var n=r.commentList.find(function(e){return e.replyId===t.replyId});return n&&(t.translateContent=n.translateContent,t.translateStatus=n.translateStatus),e.push(y({},t)),e},[]),s[i]=y(y({},o),{commentList:e})):s.push(o)},l=this;try{for(i=C(Object.keys(a)),o=i.next();!o.done;o=i.next())c=o.value,r(c)}catch(e){u={error:e}}finally{try{o&&!o.done&&(d=i.return)&&d.call(i)}finally{if(u)throw u.error}}return this.notifyCommentChange(p.COLLABORATE,{comments:s,entities:Object(v.a)(this.commentData.entities,n)}),[2,this.commentData]}})})},P.prototype.getPureUpdateComments=function(n,e){var r=[];n.forEach(function(t){e.find(function(e){return e.commentId===t.commentId})||r.push(y(y({},t),{commentList:[]}))});var i=[],t=[],o=[],a=[];return e.forEach(function(t){var e=n.find(function(e){return e.commentId===t.commentId});if(!e)return i.push(t),void o.push(t);Object(h.default)(e,t)||(e.finish===t.finish?o:a).push(t)}),{addedComments:i,deletedComments:r,updatedComments:o,sendingComments:t,resolveStatusChangedComments:a}},P.prototype.notifyCommentChange=function(t,e){var n=this,r=e.entities,i=e.comments,o=y({},r);delete o.not_notify_users;var a=!Object(h.default)(this.commentData.entities,o),s=this.getPureUpdateComments(this.cache.comments,i),l=s.addedComments,c=s.deletedComments,u=s.updatedComments,d=s.resolveStatusChangedComments;this.cache={comments:e.comments,entities:o},this.commentData=Object(f.default)(this.cache),(a||0<c.length||0<u.length||0<d.length)&&this.changeQueue.forEach(function(e){e(n.commentData,{type:t,addedComments:l,deletedComments:c,updatedComments:u,resolveStatusChangedComments:d})})},P.prototype.getComments=function(){return this.commentData},P.prototype.fetchInitialData=function(){return E(this,void 0,void 0,function(){var t,n;return k(this,function(e){switch(e.label){case 0:if(!this.broadcast)throw new Error("CommentRecord is not ready, missing broadcast object, please setup first");return[4,this.broadcast.fetchClientVars("comment")];case 1:return t=e.sent(),n=t&&t.data?[t.data]:[],[2,this.handleCommentChange(n)]}})})},P.prototype.onCommentChange=function(e){this.changeQueue.push(e)},P.prototype.offCommentChange=function(t){this.changeQueue=this.changeQueue.filter(function(e){return e!==t})},P.prototype.getCommentQuote=function(e){var t="";return Object(c.a)(e)?t=e.slice(0,128):Object(l.a)(e)&&(t=JSON.stringify(e)),t},P.prototype.addComment=function(l){return E(this,void 0,void 0,function(){var t,n,r,i,o,a,s;return k(this,function(e){switch(e.label){case 0:return[4,this.request({url:_,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,parent_type:l.parentType,parent_token:l.parentToken,is_whole:l.isWhole,quote:this.getCommentQuote(l.quote),content:l.content,comment_uuid:l.commentId,reply_uuid:l.replyId,reply_id:l.realReplyId,extra:l.extra?JSON.stringify(l.extra):""}})];case 1:return t=e.sent(),n=t.comment_id,r=t.comment,i=t.entities,o=this.remoteCommentToComment(n,r),a=Object(v.a)(this.commentData.entities,i),this.findComment(n)||(s=this.getNewComments(this.commentData.comments,o),this.notifyCommentChange(p.LOCAL,{comments:s,entities:a})),[2,{comment:o,entities:a}]}})})},P.prototype.replyComment=function(f){return E(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u,d;return k(this,function(e){switch(e.label){case 0:return t=f.commentId,n=f.extra?JSON.stringify(f.extra):"",[4,this.request({url:R,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,content:f.content,comment_id:f.commentId,reply_id:f.realReplyId,reply_uuid:f.replyId,extra:n}})];case 1:if(r=e.sent(),i=r.reply_id,o=r.reply,a=r.entities,s=this.commentData.comments,l=this.remoteReplyToRely(o),c=Object(v.a)(this.commentData.entities,a),!(u=this.findComment(t)))throw Error("comment no found");return!!u.commentList.find(function(e){return e.replyId===l.replyId})||(d=this.getNewCommentsByNewReply(s,t,i,l),this.notifyCommentChange(p.LOCAL,{comments:d,entities:c})),[2,{comment:this.findComment(t),replyId:i,entities:c}]}})})},P.prototype.deleteComment=function(a){return E(this,void 0,void 0,function(){var t,n,r,i,o;return k(this,function(e){switch(e.label){case 0:if(t=a.replyId,n=a.commentId,r=this.commentData.entities,!(i=this.findComment(n)))throw new Error("no found comment");if(!i.commentList.find(function(e){return e.replyId===t}))throw new Error("no found reply");return[4,this.request({url:N,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,reply_id:t,comment_id:n}})];case 1:return(e.sent(),i=this.findComment(n))?(i.commentList.find(function(e){return e.replyId===t})&&(o=this.getNewCommentsByNewReply(this.commentData.comments,n,t,null),this.notifyCommentChange(p.COLLABORATE,{comments:o,entities:r})),[2]):[2]}})})},P.prototype.updateComment=function(h){return E(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c,u,d,f;return k(this,function(e){switch(e.label){case 0:return t=h.replyId,n=h.commentId,r=h.content,i=h.extra?JSON.stringify(h.extra):"",[4,this.request({url:M,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,content:r,reply_id:t,comment_id:n,extra:i}})];case 1:if(o=e.sent(),a=o.reply,s=o.entities,l=this.remoteReplyToRely(a),c=Object(v.a)(this.commentData.entities,s),!(u=this.findComment(n)))throw new Error("comment no found");if(!(d=u.commentList.find(function(e){return e.replyId===l.replyId})))throw new Error("reply no found");return d.updateTimestamp<l.updateTimestamp&&(f=this.getNewCommentsByNewReply(this.commentData.comments,n,t,l),this.notifyCommentChange(p.LOCAL,{comments:f,entities:c})),[2,{comment:u,replyId:t,entities:c}]}})})},P.prototype.resolveComment=function(e){var c=e.commentId;return E(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l;return k(this,function(e){switch(e.label){case 0:return[4,this.request({url:x,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,comment_id:c,finish:d.TRUE}})];case 1:if(t=e.sent(),n=t.finish_user_id,r=t.update_timestamp,i=this.cache,o=i.comments,a=i.entities,s=S(o),-1===(l=o.findIndex(function(e){return e.commentId===c})))throw new Error("no comment found");return s[l].finish!==d.TRUE&&(s[l]=y(y({},o[l]),{finish:d.TRUE,finishUserId:n,updateTimestamp:r}),this.notifyCommentChange(p.LOCAL,{comments:s,entities:a})),[2,{comment:s[l]}]}})})},P.prototype.reopenComment=function(e){var u=e.commentId;return E(this,void 0,void 0,function(){var t,n,r,i,o,a,s,l,c;return k(this,function(e){switch(e.label){case 0:return[4,this.request({url:x,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,comment_id:u,finish:d.FALSE}})];case 1:if(t=e.sent(),n=t.update_timestamp,r=t.obj_type,i=this.cache,o=i.comments,a=i.entities,s=S(o),-1===(l=o.findIndex(function(e){return e.commentId===u})))throw new Error("no comment found");return s[l].finish!==d.FALSE&&(c=y(y({},o[l]),{finish:d.FALSE,finishUserId:"",updateTimestamp:n,objType:r}),s[l]=c,this.notifyCommentChange(p.LOCAL,{comments:s,entities:a})),[2,y(y({},t),{comment:o[l]})]}})})},P.prototype.genReplyId=function(e){var t=(void 0===e?{}:e).commentId;return E(this,void 0,void 0,function(){return k(this,function(e){switch(e.label){case 0:return[4,this.request({url:L,method:g.POST,data:{obj_type:this.serviceType,token:this.serviceToken,comment_id:t}})];case 1:return[2,{replyId:e.sent().reply_id}]}})})},P.prototype.destroy=function(){this.changeQueue=[]},P);function P(e){var u=this,t=e.serviceType,n=e.serviceToken;this.changeQueue=[],this.requestMethod=null,this.getMemberId=null,this.cache={comments:[],entities:{users:{}}},this.commentData={comments:[],entities:{users:{}}},this.logger=null,this.broadcast=null,this.language="",this.handleCommentChange=function(e){var l=S(u.commentData.comments),c=y({},u.commentData.entities);e.forEach(function(e){var t,n,r=e.entities,i=e.comments;c=Object(v.a)(c,r);var o=function(t){var e=i[t],n=l.findIndex(function(e){return e.commentId===t}),r=u.remoteCommentToComment(t,e);0===r.commentList.length?-1!==n&&l.splice(n,1):-1!==n?l[n]=r:l.push(r)};try{for(var a=C(Object.keys(i)),s=a.next();!s.done;s=a.next())o(s.value)}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}});var t={comments:u.sort(l),entities:c};return u.notifyCommentChange(p.COLLABORATE,t),t},this.serviceType=t,this.serviceToken=n}function F(e,t){return e+":"+t}var j=(z.prototype.setupCommentRecord=function(e,t){var n=F(e,t),r=new B({serviceType:e,serviceToken:t});return this.records.set(n,r),r},z.prototype.getCommentRecord=function(e,t){var n=F(e,t);return this.records.get(n)||null},z.prototype.destroyCommentRecord=function(e,t){var n=this.getCommentRecord(e,t);n&&(n.destroy(),this.records.delete(F(e,t)))},z);function z(){this.records=new Map}function H(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function U(){return H()}function V(){return H()}var W=function(){var e=Date.now();return Math.floor(e/1e3)}}}]);
//# sourceMappingURL=chunk_adit.85a5f1820d1e08e1298f.js.map