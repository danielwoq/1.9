(this.webpackJsonp=this.webpackJsonp||[]).push([["permission_application","avatar"],{"3Esl":function(e,D,q){"use strict";(function(t){var e=q("lwsE"),a=q.n(e),n=q("W8MJ"),r=q.n(n),i=q("a1gu"),s=q.n(i),o=q("Nsbk"),u=q.n(o),c=q("7W2i"),l=q.n(c),p=q("q1tI"),h=q.n(p),d=q("i8i4"),f=q("17x9"),m=q.n(f),_=q("ZtzG"),E=q("YO6O"),v=q("2ACu"),O=q("QM+C"),S=q("t+IK"),g=q("KQlH"),C=q("aBgF"),k=q("aR7H"),I=q("VI6H"),b=q("U6jp"),y=q("n/R6"),R=(q("f9I6"),t("permission.i_can_view_this_document")),T=t("permission.i_can_view_and_comment_on_this_document"),N=t("permission.i_can_edit_and_comment_on_this_document"),M=t("permission.chat_in_lark"),P=function(e){return t("permission.not_allow_share_tips",e)},w=t("permission.contact_me_in_lark"),L=t("permission.not_allow_edit_tips"),j=t("permission.single_product_contact_me"),U=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e.includes(O.PERMISSION.EDITABLE)?N:e.includes(O.PERMISSION.COMMENTABLE)?T:e.includes(O.PERMISSION.READABLE)?R:""},B=function(e){function i(){var e,c;a()(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(c=s()(this,(e=u()(i)).call.apply(e,[this].concat(n)))).state={isRequestModalVisible:!1},c.handleChatBtnClick=function(){Object(v.collectSuiteEvent)("share_operation",{action:"click_perimission_application_lark_btn",source:"suite-share-btn",eventType:"click",targetId:"",targetClass:""}),c.setState(function(){return{isRequestModalVisible:!0}})},c.handleClickOutside=function(e){var t,n,r=c.context,i=r.isShareMenuOpen,a=r.closeShareMenu,s=r.getShareBtn,o=r.getLinkSharingBtn;i&&(t=e.target,(n=[]).push(s&&s(),o&&o(),c.getApplicationContainer()),n.some(function(e){return e&&e.contains(t)})||a())},c.handleMenuKeydown=function(e){var t,n,r;e.keyCode===C.c.Esc&&(n=(t=c.context).isShareMenuOpen,r=t.closeShareMenu,n&&(r(),e.stopImmediatePropagation()))},c.hideModal=function(e){Object(k.a)(e),c.setState(function(){return{isRequestModalVisible:!1}})},c.applicationContainerRef=function(e){c._applicationContainerRef=e},c.getApplicationContainer=function(){return Object(d.findDOMNode)(c._applicationContainerRef)},c.handleClickChatInLark=function(){var e=c.props.currentPermissionInfo,t=e.get("relationshipLevel"),n=e.get("contactUrl");t===O.RELATIONSHIP_LEVEL.DIFF_TENANT_AND_STRANGER||t===O.RELATIONSHIP_LEVEL.CUSTOMER_AND_STRANGER?Object(b.y)(n):c.startAchat()},c}return l()(i,e),r()(i,[{key:"componentDidMount",value:function(){this.props.fetchUserDetail(this.theSuiteOwnerId),document.addEventListener("mousedown",this.handleClickOutside),document.addEventListener("keydown",this.handleMenuKeydown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleClickOutside),document.removeEventListener("keydown",this.handleMenuKeydown)}},{key:"startAchat",value:function(){this.props.fetchLarkChatId(this.theSuiteOwnerId).then(function(e){var t=e.payload.chatid;Object(b.x)(t)}).catch(function(e){y.a.error({content:t("lark.opt.fali_tips")})})}},{key:"renderRequestOrContactBtn",value:function(){var e=this.props.isSameTenantAsOwner,t=e||this.suiteOwnerAndUserBoth2cUser?O.PERMISSION.SHAREABLE:O.PERMISSION.EDITABLE;return!e&&this.isEditable?Object(I.x)()?null:h.a.createElement("button",{className:"container__footer__request-btn",onClick:this.handleClickChatInLark},M):h.a.createElement(g.a,{className:"container__footer__request-btn",onClick:this.handleChatBtnClick,requestPerm:t})}},{key:"render",value:function(){var e=this.props,t=e.visible,n=e.style,r=e.currentSuite,i=e.userEntities,a=e.isSameTenantAsOwner,s=r.get("owner_id"),o=r.get("obj_token"),c=i.getIn([s,"avatar_url"]),u=Object(I.o)(s),l=t?null:{display:"none"},p=a?O.PERMISSION.SHAREABLE:O.PERMISSION.EDITABLE;return h.a.createElement("div",{className:"permission-application--wrapper",ref:this.applicationContainerRef,style:Object.assign({},l)},h.a.createElement("div",{className:"permission-application--container",style:Object.assign({},n)},h.a.createElement("div",{className:"container__header"},h.a.createElement(E.default,{token:s,suiteToken:o,trigger:"click",hideAction:["mouseLeave"],placement:"lb",prefixCls:"cooperater-user-popover",source:"share"},h.a.createElement("div",{style:{alignSelf:"flex-start",cursor:"pointer"}},h.a.createElement(_.default,{className:"container__header__owner-avatar",name:u,src:c}))),h.a.createElement("div",{className:"container__header__tip"},h.a.createElement("span",{className:"container__header__tip--owner-name"},u),h.a.createElement("p",{className:"container__header__tip--content"},this.permissionTip))),h.a.createElement("div",{className:"container__footer"},h.a.createElement("span",{className:"container__footer__permission-text"},"Â "),this.renderRequestOrContactBtn())),h.a.createElement(S.a,{owner:{name:u,id:s},getContainer:this.getApplicationContainer,visible:this.state.isRequestModalVisible,defaultRequestPermNum:p,onOk:this.hideModal,onCancel:this.hideModal}))}},{key:"myPermissionText",get:function(){var e=this.props.currentPermissionInfo.get("permissions");return U(e)}},{key:"theSuiteOwnerId",get:function(){return this.props.currentSuite.get("owner_id")}},{key:"isEditable",get:function(){return this.props.currentPermissionInfo.get("permissions").includes(O.PERMISSION.EDITABLE)}},{key:"isCurrentSuiteOwner2cUser",get:function(){var e=this.props.currentSuiteOwner.get("tenant_id");return e&&0===Number(e)}},{key:"isCurrentUser2cUser",get:function(){var e=this.props.currentUser.get("tenant_id");return e&&0===Number(e)}},{key:"suiteOwnerAndUserBoth2cUser",get:function(){return this.isCurrentSuiteOwner2cUser&&this.isCurrentUser2cUser}},{key:"permissionTip",get:function(){var e=this.props,t=e.currentUser,n=e.isSameTenantAsOwner;if(Object(I.x)())return j;var r=t.get("name");return n||this.suiteOwnerAndUserBoth2cUser?P(r):this.isEditable?w:L}}]),i}(p.Component);B.contextTypes={closeShareMenu:m.a.func,isShareMenuOpen:m.a.bool,getShareBtn:m.a.func,getLinkSharingBtn:m.a.func},D.a=B}).call(this,q("2vAP"))},"4P+A":function(e,t,n){n("yPrF"),e.exports=n("8sJw").Object.assign},"5ntc":function(e,t,n){"use strict";var h=n("5kHl"),d=n("ckTn"),f=n("0QCC"),m=n("HuC4"),_=n("4iAN"),E=n("cc70"),r=Object.assign;e.exports=!r||n("/TjG")(function(){var A={},t={},e=Symbol(),n="abcdefghijklmnopqrst";return A[e]=7,n.split("").forEach(function(e){t[e]=e}),7!=r({},A)[e]||Object.keys(r({},t)).join("")!=n})?function(e,t){for(var n=_(e),r=arguments.length,i=1,a=f.f,s=m.f;i<r;)for(var o,c=E(arguments[i++]),u=a?d(c).concat(a(c)):d(c),l=u.length,p=0;p<l;)o=u[p++],h&&!s.call(c,o)||(n[o]=c[o]);return n}:r},KQlH:function(e,t,n){"use strict";var r=n("rTnZ");t.a=r.a},NQgo:function(e,E,v){"use strict";(function(s){var e=v("lwsE"),o=v.n(e),t=v("W8MJ"),n=v.n(t),r=v("a1gu"),c=v.n(r),i=v("Nsbk"),u=v.n(i),a=v("7W2i"),l=v.n(a),p=v("q1tI"),h=v.n(p),d=v("TSYQ"),f=v.n(d);v("17x9");function m(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return"file:"===location.protocol?e:e.replace(/^http?s:/,"")}var _=function(e){function a(){var e,i;o()(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(i=c()(this,(e=u()(a)).call.apply(e,[this].concat(n)))).state={loaded:!1},i.renderAvatarWithoutImg=function(){var e=i.props,t=e.name,n=e.className,r=t.substr(0,1).toUpperCase()||s("common.not");return h.a.createElement("span",{className:f()(n,"without-pic","layout-row","layout-cross-center","layout-main-center")},r)},i.handleAvatarOnload=function(){i.setState({loaded:!0})},i}return l()(a,e),n()(a,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.props.src!==e.src&&this.setState({loaded:!1})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.src;return n?h.a.createElement("img",{className:f()(t,"with-pic"),src:m(n),onLoad:this.handleAvatarOnload}):this.renderAvatarWithoutImg()}}]),a}(h.a.Component);E.a=_}).call(this,v("2vAP"))},"P+uk":function(e,t,n){"use strict";n.r(t);var r=n("m/+l"),i=n("3Esl"),a=n("0GMm"),s=n("m1/u"),o=n("vc5i"),c=n("ZGZ5"),u=n("94ch"),l=n("wgvM"),p=function(e){return{currentUser:Object(c.a)(e),ownerStatus:Object(s.a)("userDetail")(e),currentSuite:Object(o.f)(e),userEntities:Object(u.a)(e),currentSuiteOwner:Object(o.i)(e),isSameTenantAsOwner:Object(o.B)(e)}},h={fetchUserDetail:a.b,fetchLarkChatId:l.fetchLarkChatId};t.default=Object(r.connect)(p,h)(i.a)},P2sY:function(e,t,n){e.exports={default:n("4P+A"),__esModule:!0}},QbLZ:function(e,t,n){"use strict";t.__esModule=!0;var r=i(n("P2sY"));function i(e){return e&&e.__esModule?e:{default:e}}t.default=r.default||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}},ZtzG:function(e,t,n){"use strict";n.r(t);var r=n("NQgo");t.default=r.a},f9I6:function(e,t,n){},rTnZ:function(e,C,k){"use strict";(function(r){k.d(C,"a",function(){return g});var e=k("QILm"),i=k.n(e),t=k("lwsE"),a=k.n(t),n=k("W8MJ"),s=k.n(n),o=k("a1gu"),c=k.n(o),u=k("Nsbk"),l=k.n(u),p=k("7W2i"),h=k.n(p),d=k("cDf5"),f=k.n(d),m=k("q1tI"),_=k("QM+C"),E=k("4PSP"),v=k("xKvl"),O=k("rLED"),S=(k("zlg6"),function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":f()(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;0<=o;o--)(i=e[o])&&(s=(a<3?i(s):3<a?i(t,n,s):i(t,n))||s);return 3<a&&s&&Object.defineProperty(t,n,s),s}),g=function(e){function n(){var t;return a()(this,n),(t=c()(this,l()(n).apply(this,arguments))).getRequestPermissionText=function(){var e=t.props.requestPerm;return e<=_.PERMISSION.READABLE?r("permission.request_access"):e<=_.PERMISSION.EDITABLE?Object(O.U)()?r("CreationDoc_ECM_ApplyEditButton"):r("permission.request_permission"):(_.PERMISSION.SHAREABLE,r("permission.request_permission"))},t}return h()(n,e),s()(n,[{key:"handleRequestPermBtnClick",value:function(e){this.props.onClick(e)}},{key:"render",value:function(){var e=this.props,t=(e.className,e.requestPerm,e.onClick,i()(e,["className","requestPerm","onClick"])),n=this.getRequestPermissionText();return m.createElement("button",Object.assign({className:this.props.className||"permission-request-btn",onClick:this.handleRequestPermBtnClick},t),n)}}]),n}(m.PureComponent);S([Object(E.Bind)(),Object(v.b)("click_authority_apply_btn",function(e){e.context;return{withFileInfo:!0,source:"share"}})],g.prototype,"handleRequestPermBtnClick",null)}).call(this,k("2vAP"))},wgvM:function(e,t,n){"use strict";n.r(t),n.d(t,"fetchLarkChatId",function(){return o}),n.d(t,"fetchDocsCustomerServiceChatId",function(){return c}),n.d(t,"joinLarkChat",function(){return u});var r=n("lSNA"),i=n.n(r),a=n("jp/M"),s=n("QM+C"),o=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return i()({type:a.actionTypes.lark.FETCH_LARK_CHAT_ID},s.REQUEST,{url:a.apiUrls.POST_FETCH_LARK_CHAT_ID,method:a.apiUrls.METHOD.POST,data:{target_user:String(e)}})},c=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return i()({type:a.actionTypes.lark.FETCH_DOCS_CUSTOMER_SERVICE_CHAT_ID},s.REQUEST,{url:a.apiUrls.FETCH_DOCS_CUSTOMER_SERVICE_CHAT_ID,method:a.apiUrls.METHOD.POST,data:{log:e,upload_log:t,join_oncall_chat:n}})},u=function(e,t){return i()({type:a.actionTypes.lark.JOIN_LARK_CHAT},s.REQUEST,{url:a.apiUrls.POST_JOIN_LARK_CHAT,method:a.apiUrls.METHOD.POST,data:{chat_id:e,invitor:t,token:"abcdefghijklmn"}})}},yPrF:function(e,t,n){var r=n("uf80");r(r.S+r.F,"Object",{assign:n("5ntc")})},zlg6:function(e,t,n){}}]);
//# sourceMappingURL=permission_application.080545d64a8c2bb0fb3f.js.map