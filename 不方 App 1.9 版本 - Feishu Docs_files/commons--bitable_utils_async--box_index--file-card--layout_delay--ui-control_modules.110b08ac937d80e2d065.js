(this.webpackJsonp=this.webpackJsonp||[]).push([["commons--bitable_utils_async--box_index--file-card--layout_delay--ui-control_modules"],{"+qwt":function(e,h,b){(function(u,d){var p;(function(){"use strict";var e={function:!0,object:!0},j=e[typeof window]&&window||this,t=e[typeof h]&&h,n=e[typeof u]&&u&&!u.nodeType&&u,a=t&&n&&"object"==typeof d&&d;!a||a.global!==a&&a.window!==a&&a.self!==a||(j=a);var r=Math.pow(2,53)-1,N=/\bOpera/,o=Object.prototype,i=o.hasOwnProperty,B=o.toString;function s(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function V(e,t,n){var a={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(a=a[/[\d.]+$/.exec(e)])&&(e="Windows "+a),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),e=z(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}function l(e,t){var n=-1,a=e?e.length:0;if("number"==typeof a&&-1<a&&a<=r)for(;++n<a;)t(e[n],n,e);else K(e,t)}function z(e){return e=J(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:s(e)}function K(e,t){for(var n in e)i.call(e,n)&&t(e[n],n,e)}function Z(e){return null==e?s(e):B.call(e).slice(8,-1)}function $(e,t){var n=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(n)||"object"==n&&!e[t])}function X(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function H(n,a){var r=null;return l(n,function(e,t){r=a(r,e,t,n)}),r}function J(e){return String(e).replace(/^ +| +$/g,"")}function q(a){var t=j,e=a&&"object"==typeof a&&"String"!=Z(a);e&&(t=a,a=null);var n=t.navigator||{},r=n.userAgent||"";a=a||r;var o,i,s=e?!!n.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(B.toString()),l="Object",c=e?l:"ScriptBridgingProxyObject",u=e?l:"Environment",d=e&&t.java?"JavaPackage":Z(t.java),p=e?l:"RuntimeObject",h=/\bJava/.test(d)&&t.java,b=h&&Z(t.environment)==u,f=h?"a":"α",k=h?"b":"β",w=t.document||{},v=t.operamini||t.opera,m=N.test(m=e&&v?v["[[Class]]"]:Z(v))?m:v=null,S=a,y=[],g=null,x=a==r,T=x&&v&&"function"==typeof v.version&&v.version(),P=C([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),E=F(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),D=R([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),O=_({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),I=M(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function C(e){return H(e,function(e,t){return e||RegExp("\\b"+(t.pattern||X(t))+"\\b","i").exec(a)&&(t.label||t)})}function _(e){return H(e,function(e,t,n){return e||(t[D]||t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(D)]||RegExp("\\b"+X(n)+"(?:\\b|\\w*\\d)","i").exec(a))&&n})}function F(e){return H(e,function(e,t){return e||RegExp("\\b"+(t.pattern||X(t))+"\\b","i").exec(a)&&(t.label||t)})}function M(e){return H(e,function(e,t){var n=t.pattern||X(t);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))&&(e=V(e,n,t.label||t)),e})}function R(e){return H(e,function(e,t){var n=t.pattern||X(t);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(a)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((e=String(t.label&&!RegExp(n,"i").test(t.label)?t.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),t=t.label||t,e=z(e[0].replace(RegExp(n,"i"),t).replace(RegExp("; *(?:"+t+"[_-])?","i")," ").replace(RegExp("("+t+")[-_.]?(\\w)","i"),"$1 $2"))),e})}function U(e){return H(e,function(e,t){return e||(RegExp(t+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}function L(){return this.description||""}if(P=P&&[P],/\bAndroid\b/.test(I)&&!D&&(o=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(a))&&(D=J(o[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),O&&!D?D=R([O]):O&&D&&(D=D.replace(RegExp("^("+X(O)+")[-_.\\s]","i"),O+" ").replace(RegExp("^("+X(O)+")[-_.]?(\\w)","i"),O+" $2")),(o=/\bGoogle TV\b/.exec(D))&&(D=o[0]),/\bSimulator\b/i.test(a)&&(D=(D?D+" ":"")+"Simulator"),"Opera Mini"==E&&/\bOPiOS\b/.test(a)&&y.push("running in Turbo/Uncompressed mode"),"IE"==E&&/\blike iPhone OS\b/.test(a)?(O=(o=q(a.replace(/like iPhone OS/,""))).manufacturer,D=o.product):/^iP/.test(D)?(E=E||"Safari",I="iOS"+((o=/ OS ([\d_]+)/i.exec(a))?" "+o[1].replace(/_/g,"."):"")):"Konqueror"==E&&/^Linux\b/i.test(I)?I="Kubuntu":O&&"Google"!=O&&(/Chrome/.test(E)&&!/\bMobile Safari\b/i.test(a)||/\bVita\b/.test(D))||/\bAndroid\b/.test(I)&&/^Chrome/.test(E)&&/\bVersion\//i.test(a)?(E="Android Browser",I=/\bAndroid\b/.test(I)?I:"Android"):"Silk"==E?(/\bMobi/i.test(a)||(I="Android",y.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&y.unshift("accelerated")):"UC Browser"==E&&/\bUCWEB\b/.test(a)?y.push("speed mode"):"PaleMoon"==E&&(o=/\bFirefox\/([\d.]+)\b/.exec(a))?y.push("identifying as Firefox "+o[1]):"Firefox"==E&&(o=/\b(Mobile|Tablet|TV)\b/i.exec(a))?(I=I||"Firefox OS",D=D||o[1]):!E||(o=!/\bMinefield\b/i.test(a)&&/\b(?:Firefox|Safari)\b/.exec(E))?(E&&!D&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(o+"/")+8))&&(E=null),(o=D||O||I)&&(D||O||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(I))&&(E=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(I)?I:o)+" Browser")):"Electron"==E&&(o=(/\bChrome\/([\d.]+)\b/.exec(a)||0)[1])&&y.push("Chromium "+o),T=T||U(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",X(E),"(?:Firefox|Minefield|NetFront)"]),(o=("iCab"==P&&3<parseFloat(T)?"WebKit":/\bOpera\b/.test(E)&&(/\bOPR\b/.test(a)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&!/^(?:Trident|EdgeHTML)$/.test(P)&&"WebKit"||!P&&/\bMSIE\b/i.test(a)&&("Mac OS"==I?"Tasman":"Trident")||"WebKit"==P&&/\bPlayStation\b(?! Vita\b)/i.test(E)&&"NetFront")&&(P=[o]),"IE"==E&&(o=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(E+=" Mobile",I="Windows Phone "+(/\+$/.test(o)?o:o+".x"),y.unshift("desktop mode")):/\bWPDesktop\b/i.test(a)?(E="IE Mobile",I="Windows Phone 8.x",y.unshift("desktop mode"),T=T||(/\brv:([\d.]+)/.exec(a)||0)[1]):"IE"!=E&&"Trident"==P&&(o=/\brv:([\d.]+)/.exec(a))&&(E&&y.push("identifying as "+E+(T?" "+T:"")),E="IE",T=o[1]),x){if($(t,"global"))if(h&&(S=(o=h.lang.System).getProperty("os.arch"),I=I||o.getProperty("os.name")+" "+o.getProperty("os.version")),b){try{T=t.require("ringo/engine").version.join("."),E="RingoJS"}catch(e){(o=t.system)&&o.global.system==t.system&&(E="Narwhal",I=I||(o[0].os||null))}E=E||"Rhino"}else"object"==typeof t.process&&!t.process.browser&&(o=t.process)&&("object"==typeof o.versions&&("string"==typeof o.versions.electron?(y.push("Node "+o.versions.node),E="Electron",T=o.versions.electron):"string"==typeof o.versions.nw&&(y.push("Chromium "+T,"Node "+o.versions.node),E="NW.js",T=o.versions.nw)),E||(E="Node.js",S=o.arch,I=o.platform,T=(T=/[\d.]+/.exec(o.version))?T[0]:null));else Z(o=t.runtime)==c?(E="Adobe AIR",I=o.flash.system.Capabilities.os):Z(o=t.phantom)==p?(E="PhantomJS",T=(o=o.version||null)&&o.major+"."+o.minor+"."+o.patch):"number"==typeof w.documentMode&&(o=/\bTrident\/(\d+)/i.exec(a))?(T=[T,w.documentMode],(o=+o[1]+4)!=T[1]&&(y.push("IE "+T[1]+" mode"),P&&(P[1]=""),T[1]=o),T="IE"==E?String(T[1].toFixed(1)):T[0]):"number"==typeof w.documentMode&&/^(?:Chrome|Firefox)\b/.test(E)&&(y.push("masking as "+E+" "+T),E="IE",T="11.0",P=["Trident"],I="Windows");I=I&&z(I)}if(T&&(o=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(T)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(x&&n.appMinorVersion))||/\bMinefield\b/i.test(a)&&"a")&&(g=/b/i.test(o)?"beta":"alpha",T=T.replace(RegExp(o+"\\+?$"),"")+("beta"==g?k:f)+(/\d+\+?/.exec(o)||"")),"Fennec"==E||"Firefox"==E&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(I))E="Firefox Mobile";else if("Maxthon"==E&&T)T=T.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(D))"Xbox 360"==D&&(I=null),"Xbox 360"==D&&/\bIEMobile\b/.test(a)&&y.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(E)&&(!E||D||/Browser|Mobi/.test(E))||"Windows CE"!=I&&!/Mobi/i.test(a))if("IE"==E&&x)try{null===t.external&&y.unshift("platform preview")}catch(e){y.unshift("embedded")}else(/\bBlackBerry\b/.test(D)||/\bBB10\b/.test(a))&&(o=(RegExp(D.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||T)?(I=((o=[o,/BB10/.test(a)])[1]?(D=null,O="BlackBerry"):"Device Software")+" "+o[0],T=null):this!=K&&"Wii"!=D&&(x&&v||/Opera/.test(E)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==E&&/\bOS X (?:\d+\.){2,}/.test(I)||"IE"==E&&(I&&!/^Win/.test(I)&&5.5<T||/\bWindows XP\b/.test(I)&&8<T||8==T&&!/\bTrident\b/.test(a)))&&!N.test(o=q.call(K,a.replace(N,"")+";"))&&o.name&&(o="ing as "+o.name+((o=o.version)?" "+o:""),N.test(E)?(/\bIE\b/.test(o)&&"Mac OS"==I&&(I=null),o="identify"+o):(o="mask"+o,E=m?z(m.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(o)&&(I=null),x||(T=null)),P=["Presto"],y.push(o));else E+=" Mobile";(o=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1])&&(o=[parseFloat(o.replace(/\.(\d)$/,".0$1")),o],"Safari"==E&&"+"==o[1].slice(-1)?(E="WebKit Nightly",g="alpha",T=o[1].slice(0,-1)):T!=o[1]&&T!=(o[2]=(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1])||(T=null),o[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(a)||0)[1],537.36==o[0]&&537.36==o[2]&&28<=parseFloat(o[1])&&"WebKit"==P&&(P=["Blink"]),o=x&&(s||o[1])?(P&&(P[1]="like Chrome"),o[1]||((o=o[0])<530?1:o<532?2:o<532.05?3:o<533?4:o<534.03?5:o<534.07?6:o<534.1?7:o<534.13?8:o<534.16?9:o<534.24?10:o<534.3?11:o<535.01?12:o<535.02?"13+":o<535.07?15:o<535.11?16:o<535.19?17:o<536.05?18:o<536.1?19:o<537.01?20:o<537.11?"21+":o<537.13?23:o<537.18?24:o<537.24?25:o<537.36?26:"Blink"!=P?"27":"28")):(P&&(P[1]="like Safari"),(o=o[0])<400?1:o<500?2:o<526?3:o<533?4:o<534?"4+":o<535?5:o<537?6:o<538?7:o<601?8:o<602?9:o<604?10:o<606?11:o<608?12:"12"),P&&(P[1]+=" "+(o+="number"==typeof o?".x":/[.+]/.test(o)?"":"+")),"Safari"==E&&(!T||45<parseInt(T))?T=o:"Chrome"==E&&/\bHeadlessChrome/i.test(a)&&y.unshift("headless")),"Opera"==E&&(o=/\bzbov|zvav$/.exec(I))?(E+=" ",y.unshift("desktop mode"),"zvav"==o?(E+="Mini",T=null):E+="Mobile",I=I.replace(RegExp(" *"+o+"$"),"")):"Safari"==E&&/\bChrome\b/.exec(P&&P[1])?(y.unshift("desktop mode"),E="Chrome Mobile",T=null,I=/\bOS X\b/.test(I)?(O="Apple","iOS 4.3+"):null):/\bSRWare Iron\b/.test(E)&&!T&&(T=U("Chrome")),T&&0==T.indexOf(o=/[\d.]+$/.exec(I))&&-1<a.indexOf("/"+o+"-")&&(I=J(I.replace(o,""))),I&&-1!=I.indexOf(E)&&!RegExp(E+" OS").test(I)&&(I=I.replace(RegExp(" *"+X(E)+" *"),"")),P&&!/\b(?:Avant|Nook)\b/.test(E)&&(/Browser|Lunascape|Maxthon/.test(E)||"Safari"!=E&&/^iOS/.test(I)&&/\bSafari\b/.test(P[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(E)&&P[1])&&(o=P[P.length-1])&&y.push(o),y.length&&(y=["("+y.join("; ")+")"]),O&&D&&D.indexOf(O)<0&&y.push("on "+O),D&&y.push((/^on /.test(y[y.length-1])?"":"on ")+D),I&&(o=/ ([\d.+]+)$/.exec(I),i=o&&"/"==I.charAt(I.length-o[0].length-1),I={architecture:32,family:o&&!i?I.replace(o[0],""):I,version:o?o[1]:null,toString:function(){var e=this.version;return this.family+(e&&!i?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(o=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(S))&&!/\bi686\b/i.test(S)?(I&&(I.architecture=64,I.family=I.family.replace(RegExp(" *"+o),"")),E&&(/\bWOW64\b/i.test(a)||x&&/\w(?:86|32)$/.test(n.cpuClass||n.platform)&&!/\bWin64; x64\b/i.test(a))&&y.unshift("32-bit")):I&&/^OS X/.test(I.family)&&"Chrome"==E&&39<=parseFloat(T)&&(I.architecture=64),a=a||null;var W={};return W.description=a,W.layout=P&&P[0],W.manufacturer=O,W.name=E,W.prerelease=g,W.product=D,W.ua=a,W.version=E&&T,W.os=I||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=q,W.toString=L,W.version&&y.unshift(T),W.name&&y.unshift(E),I&&E&&(I!=String(I).split(" ")[0]||I!=E.split(" ")[0]&&!D)&&y.push(D?"("+I+")":"on "+I),y.length&&(W.description=y.join(" ")),W}var c=q();j.platform=c,void 0===(p=function(){return c}.call(h,b,h,u))||(u.exports=p)}).call(this)}).call(this,b("YuTi")(e),b("yLpj"))},"3VQy":function(e,i,s){"use strict";(function(d){s.d(i,"a",function(){return o});var e=s("o0o1"),p=s.n(e),t=s("yXPU"),h=s.n(t),n=s("lwsE"),b=s.n(n),a=s("W8MJ"),f=s.n(a),r=s("4O8T"),k=s.n(r),w=s("R8bB"),v=s("9WA+"),m=s("YMfo"),S=s("QM+C"),y=s("uJCm"),g=s("h5Vq"),x=s("ATMF"),T=s("EiRM"),P=s("n/R6"),E=s("omim"),D="space:lastDownloadPath",O=6e4,I=3e3,o=function(){function e(){var n=this;b()(this,e),this.eventEmitter=new k.a,this.separator=Object(g.a)()?"\\":"/",this.rust=w.a.getInstance(),this.rust.onReadyCallbacks.push(h()(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getInitialDownloadData();case 2:t=e.sent,n.emit(y.c.TasksAdded,t);case 4:case"end":return e.stop()}},e)}))),this.rust.initPushEvents(this.eventEmitter,[y.c.PushDownloadCallback,y.c.TasksAdded,y.c.TaskRemoved,y.c.TasksChanged,y.c.SpeedChanged,y.c.SubtaskFailed]);try{if(this.lastDownloadPath=localStorage.getItem(D)||"",!this.lastDownloadPath)throw new Error("empty lastDownloadPath")}catch(e){this.lastDownloadPath=this.rust.defaultDownloadPath||""}this.rust.initWebviewEvents(this.eventEmitter),this.on(y.g.WebviewActive,this.handleApplink.bind(this)),E.f||this.on(y.c.PushDownloadCallback,this.handlePushDownloadCallback.bind(this))}function t(e){return n.apply(this,arguments)}var n,a,r,o,i;function s(e,t){return a.apply(this,arguments)}function l(e){return r.apply(this,arguments)}function c(e){return o.apply(this,arguments)}function u(e){return i.apply(this,arguments)}return f()(e,[{key:"on",value:function(e,t){this.eventEmitter.on(e,t)}},{key:"off",value:function(e,t){this.eventEmitter.off(e,t)}},{key:"emit",value:function(e,t){this.eventEmitter.emit(e,t)}},{key:"handlePushDownloadCallback",value:(i=h()(p.a.mark(function e(t){var n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=t.key,a=t.status,e.t0=a,e.next=e.t0===y.a.FAILED?4:e.t0===y.a.SUCCESS?7:e.t0===y.a.CANCEL?10:12;break;case 4:return this.clearToast(n),this.errorToast(),e.abrupt("break",12);case 7:return this.clearToast(n),this.successToast(),e.abrupt("break",12);case 10:return this.clearToast(n),e.abrupt("break",12);case 12:case"end":return e.stop()}},e,this)})),u)},{key:"errorToast",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:d("box.downloader.common.error");P.a.show({duration:I,type:"error",content:e})}},{key:"successToast",value:function(){P.a.show({type:"success",content:d("box.downloader.header.success"),duration:2e3})}},{key:"clearToast",value:function(e){e&&P.a.remove(e)}},{key:"handleApplink",value:(o=h()(p.a.mark(function e(t){var n,a,r,o,i,s,l,c;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.payload){e.next=2;break}return e.abrupt("return");case 2:if(n=t.payload,a=n.data,r=n.event,a&&r===m.a.InvokeDownload){e.next=5;break}return e.abrupt("return");case 5:if(o=a.tid,i=a.uid,o&&i){e.next=10;break}return console.error("Invalid applink params: ",t),Object(T.a)({action:"native_applink_noparams"}),e.abrupt("return");case 10:return e.next=12,this.rust.getAuthInfo();case 12:if(s=e.sent,void 0!==(l=s.userId)){e.next=18;break}console.error("rust getAuthInfo failed"),e.next=30;break;case 18:if(l===i){e.next=22;break}this.emit(m.a.OpenSwitchAccountModal),e.next=30;break;case 22:return e.next=24,this.ackInvokeCode(o);case 24:if((c=e.sent)&&c.length){e.next=27;break}return e.abrupt("return");case 27:return Object(T.a)({action:"native_open_from_applink"}),e.next=30,this.openPathChooseModal(c);case 30:case"end":return e.stop()}},e,this)})),c)},{key:"ackInvokeCode",value:(r=h()(p.a.mark(function e(t){var n,a,r,o,i;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="/api/box/invoke/ack/",a={invoke_code:t},e.prev=2,e.next=5,x.a.post(n,JSON.stringify(a));case 5:if(r=e.sent,o=r.code,i=r.data,0===o&&i&&i.invoke_data){e.next=10;break}throw new Error("failed to ack invoke_code");case 10:return e.abrupt("return",JSON.parse(i.invoke_data));case 13:e.prev=13,e.t0=e.catch(2),console.error("failed to ack invoke_code",e.t0);case 16:return e.abrupt("return",[]);case 17:case"end":return e.stop()}},e,null,[[2,13]])})),l)},{key:"openPathChooseModal",value:function(t){var e,n=this;function a(){return e.apply(this,arguments)}Object(v.b)({filesCount:t.filter(function(e){return!!e.type&&S.NUM_SUITE_TYPE[e.type]}).length,foldersCount:t.filter(function(e){return!!e.type&&S.NUM_FOLDER_TYPE[e.type]}).length,initialPath:this.lastDownloadPath,onClose:function(){},onConfirm:function(e){n.lastDownloadPath=e,n.startDownload(e,t)},onClickPath:(e=h()(p.a.mark(function e(){var t;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.rust.selectFolder();case 2:return t=e.sent,e.abrupt("return",t?t[0]:void 0);case 4:case"end":return e.stop()}},e)})),a)})}},{key:"popProcessingTips",value:function(e,t){this.emit(m.a.SetIsProcessingInvokeTasks,{data:{isProcessing:e,isError:t}})}},{key:"startDownload",value:(a=h()(p.a.mark(function e(t,n){var a,r,o,i,s,l,c;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.popProcessingTips(!0),a=!1,e.prev=2,r=0;case 4:if(!(r<n.length)){e.next=19;break}if(o=n[r],i=o.token,s=o.type,l=o.name,c=o.dataVersion,"number"!=typeof s)return e.abrupt("continue",16);e.next=8;break;case 8:if(S.NUM_SUITE_TYPE[s])return e.next=11,this.rust.callApi(y.d.DownloadFile,{request:{fileToken:i,localPath:[t,l].join(this.separator),mountNodePoint:"",mountPoint:"",dataVersion:c},fileName:l,fileType:s},{request:"space.drive.v1.TaskDownloadRequest",response:"space.drive.v1.DownloadResponse"});e.next=13;break;case 11:e.next=16;break;case 13:if(S.NUM_FOLDER_TYPE[s])return e.next=16,this.rust.callApi(y.d.DownloadFolder,{localPath:t,nodeToken:i});e.next=16;break;case 16:r++,e.next=4;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(2),a=!0,Object(T.a)({action:"native_downloader_error",message:JSON.stringify(e.t0)});case 25:this.popProcessingTips(!1,a);case 26:case"end":return e.stop()}},e,this,[[2,21]])})),s)},{key:"getInitialDownloadData",value:function(){return this.rust.callApi(y.d.GetDownloadProcessList)}},{key:"clearAllDownloadTasks",value:function(){return this.rust.callApi(y.d.ClearAllDownloadTask)}},{key:"retryAllFailedDownloadTasks",value:function(){return this.rust.callApi(y.d.RetryAllFailedDownloadTasks)}},{key:"pauseAllDownloadTasks",value:function(){return this.rust.callApi(y.d.PauseAllDownloadTasks)}},{key:"retryAllPauseDownloadTasks",value:function(){return this.rust.callApi(y.d.RetryAllPauseDownloadTasks)}},{key:"retryDownloadTask",value:function(e){return this.rust.callApi(y.d.RetryDownloadTask,{uuid:e})}},{key:"pauseDownloadTask",value:function(e){return this.rust.callApi(y.d.PauseDownloadTask,{uuid:e})}},{key:"showFileInFolder",value:function(e,t){var n=!S.NUM_FOLDER_TYPE[e];return this.rust.openFolderLocation(t,n)}},{key:"getFolderDownloadErrorDetail",value:function(e){return this.rust.callApi(y.d.GetFolderDownloadErrorDetail,{uuid:e})}},{key:"downloadSingleFile",value:(n=h()(p.a.mark(function e(t){var n,a,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object(T.c)(t),e.prev=1,e.next=4,this.rust.downloadSingleFile(t,n);case 4:a=e.sent,r=a.key,P.a.show({key:r,duration:O,type:"loading",content:d("box.downloader.header.downloading")}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),e.t0.canceled||console.error("downloadSingleFile error",e.t0);case 12:case"end":return e.stop()}},e,this,[[1,9]])})),t)},{key:"lastDownloadPath",get:function(){return this._lastDownloadPath},set:function(e){this._lastDownloadPath=e;try{localStorage.setItem(D,this._lastDownloadPath)}catch(e){console.error("localstorage set lastDownloadPath error: ",e)}}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}()}).call(this,s("2vAP"))},"3acP":function(e,t,n){"use strict";function a(){return o(s,navigator.userAgent,i)}function r(e){return"string"==typeof e&&(e=e.trim?e.trim():e.replace(/^ +| +$/g,"")),e}function o(e,t,n){var a=null;return e.every(function(e){return!(a=(a=RegExp("\\b".concat(e,"(?:/[\\d.]+|[ \\w.]*)"),"i").exec(t))&&n(a[0]))}),a}function i(e){return e=/^Win/i.test(e)?/[\d.]+$/.exec(e)[0]:r(e=e.replace(/\bMacintosh\b/,"").replace(/\b(OS X) [^ \d]+/i,"").replace(/\bMac (OS X)\b/,""))}n.d(t,"a",function(){return a});var s=["Mac OS X","Macintosh","Mac","Windows 98;","Windows ","Linux"]},"9WA+":function(e,t,n){"use strict";n.d(t,"c",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return l}),n.d(t,"a",function(){return c});var a=n("XMIC"),r=n("jryj"),o=n("D7h9"),i=function(e){o.default.dispatch(Object(a.c)(r.MODAL_TYPES.INFO,e))},s=function(e){o.default.dispatch(Object(a.c)(r.MODAL_TYPES.ZIP_DOWNLOAD,e))},l=function(e){o.default.dispatch(Object(a.c)(r.MODAL_TYPES.CHOOSE_DOWNLOAD_PATH,e))},c=function(e){o.default.dispatch(Object(a.c)(r.MODAL_TYPES.ABORT_ALL_TASK,e))}},EiRM:function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"b",function(){return b}),n.d(t,"d",function(){return f}),n.d(t,"a",function(){return k});var a=n("QM+C"),i=n("VIFs"),s=n("VQSS"),l=n("EVj1"),r=n("iP/4"),c=n("5dbN"),u=n("2ACu"),d=n("1dfU"),p=n("omim"),h=n("JC8k");function o(e){if(!e||!e.token)return"";var t=e.token,n=e.mountPoint,a=e.dataVersion,r=Object(i.prependDriveStreamAPI)("/api/box/stream/download/all/".concat(t,"/")),o=Object(s.a)({mount_node_token:n&&n.token,mount_point:n&&n.type,version:a});return r+Object(l.d)(o)}function b(e){var t=r.a.isWindows?/[\\\/\:\*\?\|"<>]/g:/[\/]/g;return e.forEach(function(e){e.name&&(e.name=e.name.replace(t,"_"))}),e}function f(e){return 1===e.length&&e[0].type===a.NUM_SUITE_TYPE.FILE}function k(e){var t=e.action,n=e.fileToken,a=e.fileName,r=e.taskCount,o=e.fileTypeNum,i=e.message,s=Object(h.a)(a||""),l=Object(c.getCurrentRouteObj)();Object(u.default)("client_file_download",{action:t,product_type:"drive",event_type:"mouseclick",file_id:n?Object(d.a)(n):"",file_type:"file",sub_file_type:s,module:l&&l.module?l.module:"",sub_module:"download_layer",task_count:r||1,file_type_num:o,platform:p.c?"lark":"web",message_detail:i})}},R8bB:function(e,o,i){"use strict";(function(h){i.d(o,"a",function(){return r});var e=i("o0o1"),b=i.n(e),t=i("yXPU"),f=i.n(t),n=i("lwsE"),k=i.n(n),a=i("W8MJ"),w=i.n(a),v=i("uJCm"),m=i("w4U8"),S=i("QM+C"),r=function(){function e(){var t=this;k()(this,e),this.ready=!1,this.onReadyCallbacks=[],this.initDrive().then(this.initTaskManager.bind(this)).then(function(){console.log("RustSDK init success"),t.ready=!0,t.onReadyCallbacks.forEach(function(e){"function"==typeof e&&e()})}).catch(function(e){console.error("RustSDK init failed: ",e),t.ready=!1})}function t(e,t){return n.apply(this,arguments)}var n,a,r,o,i,s;function l(e){return a.apply(this,arguments)}function c(){return r.apply(this,arguments)}function u(){return o.apply(this,arguments)}function d(){return i.apply(this,arguments)}function p(e,t,n){return s.apply(this,arguments)}return w()(e,[{key:"getAuthInfo",value:function(){return ShellAPI.app.passport.getAuthInfo().catch(function(e){return console.error("rustSDK getAuthInfo error: ",e),{}})}},{key:"callApi",value:(s=f()(b.a.mark(function e(t,n,a){var r,o,i,s;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v.b[t]){e.next=3;break}return console.error("rustSDK funcName not found:",t),e.abrupt("return");case 3:return e.prev=3,r={command:v.b[t],params:JSON.stringify(n),pb:a||{request:"space.drive.v1.".concat(t,"Request"),response:"space.drive.v1.".concat(t,"Response")},contextId:Object(m.b)()},Object(m.a)("start to callApi: ",r),e.next=8,ShellAPI.app.sdk.invokeAsync(r);case 8:return o=e.sent,i=o.hasError,s=o.result,Object(m.a)("callApi: ",t,i,o,JSON.parse(s)),e.abrupt("return",JSON.parse(s));case 14:throw e.prev=14,e.t0=e.catch(3),console.error("rustSDK callApi error:",e.t0),e.t0;case 18:case"end":return e.stop()}},e,null,[[3,14]])})),p)},{key:"initDrive",value:(i=f()(b.a.mark(function e(){var t,n,a,r,o;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(m.c)(),e.next=3,this.getAuthInfo();case 3:if(n=e.sent,a=n.userId,r=n.sessionId,a&&r){e.next=8;break}throw new Error("wrong user info");case 8:return o={userId:a,session:r,disableSmartUpload:!0,forApp:!1,storagePath:t,driveRustConfig:{enableMultiTask:!0,useRangeInPart:!0,weakOptimize:!0,newCdnDomainSelect:!0,smartClearDb:!0,mergeUpload:!0}},e.abrupt("return",this.callApi(v.d.InitDrive,o));case 10:case"end":return e.stop()}},e,this)})),d)},{key:"initTaskManager",value:(o=f()(b.a.mark(function e(){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.callApi(v.d.InitTaskMgr,{importExts:S.importableTypes});case 2:case"end":return e.stop()}},e,this)})),u)},{key:"initPushEvents",value:function(a,e){ShellAPI.app.ipc.on("SDK_PUSH",function(e){var t=e.detail,n=v.e[t.command];n&&(Object(m.a)("SDK_PUSH: ",n,t.content),a.emit(n,t.content))});var t=e.map(function(e){return{command:~~v.e[e],pb:"space.drive.v1.".concat(e)}});return ShellAPI.app.sdk.init({commands:t})}},{key:"initWebviewEvents",value:function(o){ShellAPI.app.ipc.on("WEBVIEW_EVENT",function(e){var t=e.detail;Object(m.a)("WEBVIEW_EVENT: ",t);var n,a=t.detail,r=t.ipcType;try{n=a?JSON.parse(a):void 0}catch(e){console.error("WEBVIEW_EVENT parse detail error",t),n=a}o.emit(r,n)}),ShellAPI.app.main_window.getLastActiveTabParams().then(function(t){if(!t.error&&t.message){var n;try{n=JSON.parse(t.message)}catch(e){console.error("WEBVIEW_EVENT parse detail error",t.message),n=t.message}o.emit(v.g.WebviewActive,n)}})}},{key:"selectFolder",value:(r=f()(b.a.mark(function e(){var t,n,a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ShellAPI.app.webview.showOpenDialog({type:"OPEN_FOLDER"});case 2:if(t=e.sent,n=t.canceled,a=t.filePaths,!n&&a&&a.length){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",a.map(function(e){return e.path}));case 8:case"end":return e.stop()}},e)})),c)},{key:"selectMultiFile",value:(a=f()(b.a.mark(function e(t){var n,a,r;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ShellAPI.app.webview.showOpenDialog({type:"OPEN_MULTI_FILE",filters:t});case 2:if(n=e.sent,a=n.canceled,r=n.filePaths,!a&&r&&r.length){e.next=7;break}return e.abrupt("return");case 7:return e.abrupt("return",r.map(function(e){return e.path}));case 8:case"end":return e.stop()}},e)})),l)},{key:"openFolderLocation",value:function(e,t){return ShellAPI.app.webview.fsOpenDir({path:e,isFile:t})}},{key:"downloadSingleFile",value:(n=f()(b.a.mark(function e(t,n){var a,r,o,i,s,l;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.name?t.name.split("."):null,r=[{name:"".concat(h("box.downloader.file_filter")," (*.*)"),extensions:["*"]}],a&&1<a.length&&(o=a[a.length-1],r.unshift({name:"".concat(o.toUpperCase()," ").concat(h("common.files")," (*.").concat(o,")"),extensions:[o]})),e.next=5,ShellAPI.app.webview.showOpenDialog({type:"SAVE_AS",filename:t.name,filters:r});case 5:if(i=e.sent,s=i.canceled,l=i.filePaths,!s&&l&&l.length){e.next=10;break}return e.abrupt("return",Promise.reject({canceled:!0}));case 10:return e.abrupt("return",this.callApi(v.d.DownloadNormal,{localPath:l[0].path,remoteUrl:n,fileSize:t.size?String(t.size):void 0}));case 12:case"end":return e.stop()}},e,this)})),t)},{key:"defaultDownloadPath",get:function(){return ShellAPI.app.environment.downloadsPath}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}()}).call(this,i("2vAP"))},"S5/L":function(e,E,D){"use strict";(function(a){D.d(E,"a",function(){return k});var e=D("o0o1"),r=D.n(e),t=D("yXPU"),n=D.n(t),o=D("/DSa"),i=D("EiRM"),s=D("dP4c"),l=D("n/R6"),c=D("dcTM"),u=D("omim"),d=D("toa8"),p=D("TJya"),h=D("3VQy"),b=D("QM+C"),f=D("+mgp");function k(e){return w.apply(this,arguments)}function w(){return(w=n()(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,v(t[0]);case 4:if(e.sent){e.next=8;break}return l.a.show({key:"downloadError",type:"error",content:a("box.downloader.ka_denied","")}),e.abrupt("return");case 8:(u.d?S:u.c?g:P)(t);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function v(e){return m.apply(this,arguments)}function m(){return(m=n()(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.type!==b.NUM_SUITE_TYPE.FILE)return e.abrupt("return",!0);e.next=2;break;case 2:return n=Object(p.a)(),e.prev=3,e.next=6,Object(d.d)({method:"head",url:Object(i.c)(t),headers:n});case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(3),e.abrupt("return",!(e.t0.headers&&"10001"===e.t0.headers["x-forbidden-code"]));case 11:return e.abrupt("return",!0);case 12:case"end":return e.stop()}},e,null,[[3,8]])}))).apply(this,arguments)}function S(e){return y.apply(this,arguments)}function y(){return(y=n()(r.a.mark(function e(t){var n;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=h.a.getInstance(),u.f)return e.next=5,n.openPathChooseModal(t);e.next=7;break;case 5:e.next=9;break;case 7:return e.next=9,n.downloadSingleFile(t[0]);case 9:Object(i.a)({action:"native_trigger_batch_download",taskCount:t.length}),e.next=18;break;case 12:if(e.prev=12,e.t0=e.catch(0),e.t0&&e.t0.canceled)return e.abrupt("return");e.next=16;break;case 16:console.error("native frame download error",e.t0),l.a.show({key:"downloadError",type:"error",content:a("box.downloader.common.error")});case 18:case"end":return e.stop()}},e,null,[[0,12]])}))).apply(this,arguments)}function g(e){return x.apply(this,arguments)}function x(){return(x=n()(r.a.mark(function e(t){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,u.b){e.next=3;break}throw new Error("lark not support download");case 3:return e.next=5,o.b.getInstance().postMessage({type:o.c.PrepareToDownloadFile,data:{files:Object(i.b)(t)}});case 5:Object(i.a)({action:"trigger_batch_download",taskCount:t.length}),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("prepare to download error",e.t0),Object(i.d)(t)?T(t[0]):l.a.show({key:"downloadError",type:"error",content:a("box.downloader.common.error")});case 12:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function T(e){var t,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e&&(t=Object(i.c)(e),f.g?Object(s.d)(t):Object(s.c)(t,n,!n))}function P(e){Object(i.d)(e)?T(e[0]):(new c.a({files:e}).init(),Object(i.a)({action:"trigger_batch_download",taskCount:e.length}))}}).call(this,D("2vAP"))},"TM+l":function(e,t,n){"use strict";var a,r,o=n("S5/L");n("hNo0");(r=a=a||{}).SUITE_DRIVE_INIT_DRIVE="SUITE_DRIVE_INIT_DRIVE",r.SUITE_DRIVE_DOWNLOAD_NORMAL="SUITE_DRIVE_DOWNLOAD_NORMAL";var i=n("EiRM"),s=n("omim"),l=n("dcTM");n.d(t,"b",function(){return o.a}),n.d(t,"c",function(){return i.c}),n.d(t,"d",function(){return s.b}),n.d(t,"g",function(){return s.g}),n.d(t,"f",function(){return s.f}),n.d(t,"e",function(){return s.e}),n.d(t,"a",function(){return l.b})},YMfo:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var a,r,o=n("uJCm");(r=a=a||{}).SetIsProcessingInvokeTasks="SetIsProcessingInvokeTasks",r.InvokeDownload="InvokeDownload",r.OpenSwitchAccountModal="OpenSwitchAccountModal",r.DownloadFolderSubtaskFailed="DownloadFolderSubtaskFailed";var i=Object.assign({},o.c,{},a)},dcTM:function(e,j,N){"use strict";(function(c){N.d(j,"b",function(){return R}),N.d(j,"a",function(){return W});var u,e,d,t,n=N("o0o1"),p=N.n(n),a=N("yXPU"),h=N.n(a),r=N("lwsE"),b=N.n(r),o=N("W8MJ"),f=N.n(o),i=N("cDf5"),l=N.n(i),k=N("Qyje"),w=N("toa8"),v=N("VIFs"),m=N("jp/M"),S=N("dP4c"),y=N("n/R6"),g=N("HIeq"),s=N("4PSP"),x=N("9WA+"),T=N("wzgn"),P=N("EiRM"),E=N("iP/4"),D=function(e,t,n,a){var r,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":l()(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(i=(o<3?r(i):3<o?r(t,n,i):r(t,n))||i);return 3<o&&i&&Object.defineProperty(t,n,i),i};(e=u=u||{})[e.Ready=0]="Ready",e[e.Progress=1]="Progress",e[e.NormalError=2]="NormalError",e[e.NoFile=3]="NoFile",e[e.NodeExceed=4]="NodeExceed",e[e.SizeExceed=5]="SizeExceed",e[e.PartError=101]="PartError",e[e.PathExceed=102]="PathExceed",(t=d=d||{})[t.Ready=0]="Ready",t[t.Progress=1]="Progress";var O=Object(T.d)(),I="https://".concat(Object(v.getDomainConfig)("domain").applink,"/client/drive/download/invoke"),C=2e3,_=6e4,F=10,M=5,R=function(){function e(){b()(this,e)}return f()(e,null,[{key:"push",value:function(e){this.queue.push(e),1===this.queue.length&&this.runNext()}},{key:"shift",value:function(){var e=this;this.queue.shift(),setTimeout(function(){e.runNext()},300)}},{key:"runNext",value:function(){var e=this.queue[0];e&&e()}}]),e}();R.queue=[];var U=2e4,L=200,W=function(){function t(e){b()(this,t),this.instanceID=Object(g.b)(),this.createInvokeAPI=Object(v.prependAPI)(m.apiUrls.CREATE_INVOKE),this.checkInvokeStatusAPI=Object(v.prependAPI)(m.apiUrls.CHECK_INVOKE_STATUS),this.createZipDownloadAPI=Object(v.prependAPI)(m.apiUrls.CREATE_ZIP_DOWNLOAD),this.checkZipDownloadStatusAPI=Object(v.prependAPI)(m.apiUrls.CHECK_ZIP_DOWNLOAD_STATUS),this.downloadZipAPI=Object(v.prependDriveStreamAPI)(m.apiUrls.DOWNLOAD_ZIP_URL),this.invokeLoadingToastKey="invoke-loading-toast-".concat(this.instanceID),this.zipLoadingToastKey="zip-loading-toast-".concat(this.instanceID),this.errorToastKey="error-toast-".concat(this.instanceID),this.pollZipDownloadStatusTimes=0,this.pollInvokeCodeStatusTimes=0,this.files=e.files,this.isWindowsChrome=E.a.isWindows&&E.a.isChrome}function e(){return n.apply(this,arguments)}var n,a,r,o;function i(){return a.apply(this,arguments)}function s(){return r.apply(this,arguments)}function l(){return o.apply(this,arguments)}return f()(t,[{key:"init",value:function(){this.showInvokeLoadingToast(),this.createInvoke()}},{key:"createInvoke",value:(o=h()(p.a.mark(function e(){var t,n,a,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=new FormData,(n=JSON.stringify(Object(P.b)(this.files)))&&n.length>U)return this.handleFinalError(c("box.downloader.zip.node_exceed")),e.abrupt("return");e.next=6;break;case 6:return t.set("invoke_data",n),e.next=9,w.d.post(this.createInvokeAPI,t,{headers:{"Content-Type":"multipart/form-data"}});case 9:if(a=e.sent,!(r=a.data).invoke_code){e.next=16;break}this.invokeCode=r.invoke_code,this.callLarkSchema(r.invoke_code),e.next=17;break;case 16:throw new Error("no invoke code");case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),this.handleInvokeLarkFailed(),console.error("invoke create failed",e.t0);case 23:case"end":return e.stop()}},e,this,[[0,19]])})),l)},{key:"callLarkSchema",value:function(e){var t=this,n={tid:e,uid:window.User.id},a="".concat(I,"?").concat(Object(k.stringify)(n));window.focus(),window.addEventListener("blur",this.handleWindowBlur);var r=Object(S.d)(a);this.isWindowsChrome&&(r.onload=function(){r.contentWindow.focus(),window.blur()}),this.checkHasLarkTimer=window.setTimeout(function(){t.handleInvokeLarkFailed(),r.remove()},5e3)}},{key:"handleWindowBlur",value:function(){this.checkHasLarkTimer&&clearTimeout(this.checkHasLarkTimer),window.removeEventListener("blur",this.handleWindowBlur),window.addEventListener("focus",this.handleWindowFocusAfterSchemaModalShowed),this.isWindowsChrome&&(this.windowsChromeFallbackTimer=window.setTimeout(function(){window.focus()},1e4))}},{key:"handleWindowFocusAfterSchemaModalShowed",value:function(){this.windowsChromeFallbackTimer&&clearTimeout(this.windowsChromeFallbackTimer),this.checkInvokeStatus(),window.removeEventListener("focus",this.handleWindowFocusAfterSchemaModalShowed)}},{key:"checkInvokeStatus",value:(r=h()(p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.pollInvokeCodeStatusTimes+=1,this.pollInvokeCodeStatusTimes>M)return this.handleInvokeLarkFailed(),e.abrupt("return");e.next=5;break;case 5:return e.next=7,w.d.get("".concat(this.checkInvokeStatusAPI,"?invoke_code=").concat(this.invokeCode));case 7:t=e.sent,n=t.data,e.t0=n.invoke_status,e.next=e.t0===d.Ready?12:e.t0===d.Progress?14:16;break;case 12:return this.clear(),e.abrupt("break",18);case 14:return this.checkInvokeStatusTimer=window.setTimeout(this.checkInvokeStatus,C),e.abrupt("break",18);case 16:return this.handleInvokeLarkFailed(),e.abrupt("break",18);case 18:e.next=24;break;case 20:e.prev=20,e.t1=e.catch(0),this.handleInvokeLarkFailed(),console.error("check invoke code status error",e.t1);case 24:case"end":return e.stop()}},e,this,[[0,20]])})),s)},{key:"handleInvokeLarkFailed",value:function(){this.showDownloadZipModal()}},{key:"handleZipDownload",value:(a=h()(p.a.mark(function e(){var t,n,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.files.length>L)return this.handleFinalError(c("box.downloader.zip.node_exceed")),e.abrupt("return");e.next=4;break;case 4:return this.showZipLoadingToast(),t=this.files.map(function(e){return{obj_token:e.token,obj_type:e.type}}),e.next=8,w.d.post(this.createZipDownloadAPI,t,{headers:{"Content-Type":"application/json"}});case 8:if(n=e.sent,!(a=n.data).zip_code){e.next=15;break}this.zipCode=a.zip_code,this.checkZipDownloadStatusTimer=window.setTimeout(this.checkZipDownloadStatus,C),e.next=16;break;case 15:throw new Error("no zip download code");case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(0),this.handleFinalError(),console.error("create zip download failed",e.t0);case 22:case"end":return e.stop()}},e,this,[[0,18]])})),i)},{key:"checkZipDownloadStatus",value:(n=h()(p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.pollZipDownloadStatusTimes+=1,this.pollZipDownloadStatusTimes>F)return this.handleFinalError(),e.abrupt("return");e.next=5;break;case 5:return e.next=7,w.d.get("".concat(this.checkZipDownloadStatusAPI,"?zip_code=").concat(this.zipCode));case 7:t=e.sent,n=t.data,e.t0=n.zip_status,e.next=e.t0===u.Ready?12:e.t0===u.Progress?14:e.t0===u.NoFile?16:e.t0===u.NodeExceed?18:e.t0===u.SizeExceed?20:e.t0===u.PathExceed?22:(e.t0===u.NormalError||(e.t0,u.PartError),24);break;case 12:return this.downloadZip(),e.abrupt("break",26);case 14:return this.checkZipDownloadStatusTimer=window.setTimeout(this.checkZipDownloadStatus,C),e.abrupt("break",26);case 16:return this.handleFinalError(c("box.downloader.zip.no_file")),e.abrupt("break",26);case 18:return this.handleFinalError(c("box.downloader.zip.node_exceed")),e.abrupt("break",26);case 20:return this.handleFinalError(c("box.downloader.zip.size_exceed")),e.abrupt("break",26);case 22:return this.handleFinalError(c("box.downloader.zip.path_exceed",O)),e.abrupt("break",26);case 24:return this.handleFinalError(),e.abrupt("break",26);case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(0),this.handleFinalError(),console.error("check zip download status error",e.t1);case 32:case"end":return e.stop()}},e,this,[[0,28]])})),e)},{key:"showDownloadZipModal",value:function(){this.clear(),R.push(x.d.bind(this,{onDownload:this.handleZipDownload,onClose:R.shift.bind(R)})),Object(P.a)({action:"show_zip_download_modal"})}},{key:"downloadZip",value:function(){this.clear();var e="".concat(this.downloadZipAPI).concat(this.zipCode);Object(S.c)(e,!1,!0)}},{key:"handleFinalError",value:function(e){this.clear(),this.showErrorToast(e),Object(P.a)({action:"prepare_download_error",message:e||""})}},{key:"showErrorToast",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:c("box.downloader.common.error");y.a.show({key:this.errorToastKey,type:"error",content:e})}},{key:"showInvokeLoadingToast",value:function(){y.a.show({key:this.invokeLoadingToastKey,duration:_,type:"loading",content:c("box.downloader.invoking_client",O)})}},{key:"hideInvokeLoadingToast",value:function(){y.a.remove(this.invokeLoadingToastKey)}},{key:"showZipLoadingToast",value:function(){y.a.show({key:this.zipLoadingToastKey,duration:_,type:"loading",content:c("box.downloader.zip.generating")})}},{key:"hideZipLoadingToast",value:function(){y.a.remove(this.zipLoadingToastKey)}},{key:"hideAllLoadingToast",value:function(){this.hideInvokeLoadingToast(),this.hideZipLoadingToast()}},{key:"clear",value:function(){this.checkZipDownloadStatusTimer&&clearTimeout(this.checkZipDownloadStatusTimer),this.checkInvokeStatusTimer&&clearTimeout(this.checkInvokeStatusTimer),this.checkHasLarkTimer&&clearTimeout(this.checkHasLarkTimer),window.removeEventListener("focus",this.handleWindowFocusAfterSchemaModalShowed),window.removeEventListener("blur",this.handleWindowBlur),this.hideAllLoadingToast()}}]),t}();D([Object(s.Bind)()],W.prototype,"handleWindowBlur",null),D([Object(s.Bind)()],W.prototype,"handleWindowFocusAfterSchemaModalShowed",null),D([Object(s.Bind)()],W.prototype,"checkInvokeStatus",null),D([Object(s.Bind)()],W.prototype,"handleInvokeLarkFailed",null),D([Object(s.Bind)()],W.prototype,"handleZipDownload",null),D([Object(s.Bind)()],W.prototype,"checkZipDownloadStatus",null)}).call(this,N("2vAP"))},h5Vq:function(e,t,n){"use strict";var a=n("iA/9"),r=(n("3acP"),n("+qwt"));n.n(r).a.layout;n.d(t,"a",function(){return a.c})},"iA/9":function(e,t,n){"use strict";function a(){return-1<navigator.platform.indexOf("Mac")}function r(){return-1<navigator.platform.indexOf("Linux")}function o(){return-1<navigator.platform.indexOf("Win")}n.d(t,"b",function(){return a}),n.d(t,"a",function(){return r}),n.d(t,"c",function(){return o})},uJCm:function(e,t,n){"use strict";var a,r,o,i,s,l,c,u,d,p,h,b,f,k;n.d(t,"d",function(){return a}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return s}),n.d(t,"f",function(){return c}),n.d(t,"e",function(){return d}),n.d(t,"g",function(){return h}),n.d(t,"a",function(){return f}),(r=a=a||{}).GetDeviceId="GetDeviceId",r.InitDrive="InitDrive",r.InitTaskMgr="InitTaskMgr",r.SetImportExt="SetImportExt",r.DownloadNormal="DownloadNormal",r.DownloadFile="Download",r.DownloadFolder="DownloadFolder",r.GetDownloadProcessList="GetDownloadProcessList",r.ClearAllDownloadTask="ClearAllDownloadTask",r.RetryAllFailedDownloadTasks="RetryAllFailedDownloadTasks",r.PauseAllDownloadTasks="PauseAllDownloadTasks",r.RetryAllPauseDownloadTasks="RetryAllPauseDownloadTasks",r.RetryDownloadTask="RetryDownloadTask",r.PauseDownloadTask="PauseDownloadTask",r.GetFolderDownloadErrorDetail="GetFolderDownloadErrorDetail",r.GeneralUpload="GeneralUpload",r.GetUploadProcessList="GetUploadProcessList",r.RetryAllFailedUploadTasks="RetryAllFailedUploadTasks",r.PauseAllUploadTasks="PauseAllUploadTasks",r.RetryAllPauseUploadTasks="RetryAllPauseUploadTasks",r.RetryUploadTask="RetryUploadTask",r.PauseUploadTask="PauseUploadTask",r.ClearAllUploadTask="ClearAllUploadTask",r.GetFolderUploadErrorDetail="GetFolderUploadErrorDetail",(i=o=o||{})[i.GetDeviceId=2009]="GetDeviceId",i[i.InitDrive=6017]="InitDrive",i[i.InitTaskMgr=6077]="InitTaskMgr",i[i.SetImportExt=6056]="SetImportExt",i[i.DownloadNormal=6001]="DownloadNormal",i[i.Download=6032]="Download",i[i.DownloadFolder=6033]="DownloadFolder",i[i.GetDownloadProcessList=6034]="GetDownloadProcessList",i[i.ClearAllDownloadTask=6035]="ClearAllDownloadTask",i[i.RetryAllFailedDownloadTasks=6036]="RetryAllFailedDownloadTasks",i[i.PauseAllDownloadTasks=6037]="PauseAllDownloadTasks",i[i.RetryAllPauseDownloadTasks=6038]="RetryAllPauseDownloadTasks",i[i.RetryDownloadTask=6031]="RetryDownloadTask",i[i.PauseDownloadTask=6030]="PauseDownloadTask",i[i.GetFolderDownloadErrorDetail=6044]="GetFolderDownloadErrorDetail",i[i.GeneralUpload=6060]="GeneralUpload",i[i.GetUploadProcessList=6047]="GetUploadProcessList",i[i.RetryAllFailedUploadTasks=6049]="RetryAllFailedUploadTasks",i[i.PauseAllUploadTasks=6050]="PauseAllUploadTasks",i[i.RetryAllPauseUploadTasks=6051]="RetryAllPauseUploadTasks",i[i.RetryUploadTask=6059]="RetryUploadTask",i[i.PauseUploadTask=6058]="PauseUploadTask",i[i.ClearAllUploadTask=6048]="ClearAllUploadTask",i[i.GetFolderUploadErrorDetail=6078]="GetFolderUploadErrorDetail",(l=s=s||{}).PushDownloadCallback="PushDownloadCallback",l.TasksAdded="PushDownloadTasksAdded",l.TaskRemoved="PushDownloadTaskRemoved",l.TasksChanged="PushDownloadTasksChanged",l.SpeedChanged="PushDownloadSpeedChanged",l.SubtaskFailed="DownloadFolderSubtaskFailed",(u=c=c||{}).TasksAdded="PushUploadTasksAdded",u.TaskRemoved="PushUploadTaskRemoved",u.TasksChanged="PushUploadTasksChanged",u.SpeedChanged="PushUploadSpeedChanged",u.SubtaskFailed="UploadFolderSubtaskFailed",u.ShowTips="ShowUploadTips",(p=d=d||{})[p.PushDownloadCallback=6004]="PushDownloadCallback",p[p.PushDownloadTasksAdded=6039]="PushDownloadTasksAdded",p[p.PushDownloadTaskRemoved=6040]="PushDownloadTaskRemoved",p[p.PushDownloadTasksChanged=6041]="PushDownloadTasksChanged",p[p.PushDownloadSpeedChanged=6043]="PushDownloadSpeedChanged",p[p.DownloadFolderSubtaskFailed=6084]="DownloadFolderSubtaskFailed",p[p.PushUploadTasksAdded=6052]="PushUploadTasksAdded",p[p.PushUploadTaskRemoved=6053]="PushUploadTaskRemoved",p[p.PushUploadTasksChanged=6054]="PushUploadTasksChanged",p[p.PushUploadSpeedChanged=6055]="PushUploadSpeedChanged",p[p.UploadFolderSubtaskFailed=6083]="UploadFolderSubtaskFailed",p[p.ShowUploadTips=6082]="ShowUploadTips",(b=h=h||{}).WebviewActive="WEBVIEW_ACTIVE",b.DragFiles="DRAG_FILES",(k=f=f||{})[k.PENDING=0]="PENDING",k[k.INFLIGHT=1]="INFLIGHT",k[k.FAILED=2]="FAILED",k[k.SUCCESS=3]="SUCCESS",k[k.QUEUE=4]="QUEUE",k[k.READY=5]="READY",k[k.CANCEL=6]="CANCEL"},w4U8:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"c",function(){return o}),n.d(t,"a",function(){return i});n("o0o1"),n("yXPU");var a=n("h5Vq"),r=function(){var e="0000000000";return"".concat(Math.random().toString(36),"0000000000").substring(2,2+e.length)},o=function(){var e=ShellAPI.app.environment.userDataPath,t=Object(a.a)()?"\\":"/";return[e,"sdk_storage","space"].join(t)};function i(){}}}]);
//# sourceMappingURL=commons--bitable_utils_async--box_index--file-card--layout_delay--ui-control_modules.91f6577b7e187ce4f7f5.js.map