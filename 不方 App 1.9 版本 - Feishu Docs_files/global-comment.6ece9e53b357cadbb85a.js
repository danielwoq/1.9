(this.webpackJsonp=this.webpackJsonp||[]).push([["global-comment"],{"1tpT":function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return r});var o=n("jp/M"),a=function(e){return{type:o.actionTypes.messagePosition.SET_MESSAGE_POSITION_DATA,payload:e}},r=function(e){return{type:o.actionTypes.messagePosition.SET_ACTIVE_NOTIFICATION,payload:e}}},"2z0X":function(e,t,n){"use strict";var r=n("hbEN");function o(t,e){var n=[],o=Object(r.default)(function(){var e=n;n=[],t.call(void 0,e)},e),a=function(){var e=Array.prototype.slice.call(arguments,0);n=Array.from(new Set(n.concat(e))),o()};return a.cancel=o.cancel.bind(o),a.flush=o.flush.bind(o),a}t.a=o},"7HY0":function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n("o0o1"),l=n.n(o),a=n("yXPU"),p=n.n(a),r=n("lwsE"),d=n.n(r),i=n("W8MJ"),c=n.n(i),f=n("VN5G"),m=n("paQS"),h=n("wQna"),C=n("QM+C"),s=function(){function u(e){var m=this;d()(this,u),this.wrapperDispatchAction=function(a,r,i){var c=m.requestCommentActions;return a(c.begin(r)),new Promise(function(){var n=p()(l.a.mark(function e(t,n){var o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i();case 3:o=e.sent,a(c.complete(r,o)),t(o),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0),a(c.error(r,e.t0));case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(e,t){return n.apply(this,arguments)}}())},this.requestCommentActions={begin:function(e){return{type:e.type+"_BEGIN",payload:Object.assign({rootType:m.rootType,rootToken:m.rootToken,subCommentToken:m.subCommentToken},e.payload),meta:{previousAction:e}}},complete:function(e,t){var n=e.payload,o=n?Object.assign({},n,{},t):t;return{type:e.type+"_COMPLETE",payload:Object.assign({rootType:m.rootType,rootToken:m.rootToken,subCommentToken:m.subCommentToken},o),meta:{previousAction:e}}},error:function(e,t){return{type:e.type+"_ERROR",error:t,payload:Object.assign({rootType:m.rootType,rootToken:m.rootToken,subCommentToken:m.subCommentToken},e.payload),meta:{previousAction:e}}}};var t,n=e.rootType,o=e.rootToken,a=e.subCommentToken,r=e.enableAutoTranslate,i=e.translateLang,c=e.shouldSetBroadcast,s=e.transEnabled;this.rootType=n,this.rootToken=o,this.subCommentToken=a,this.commentService=Object(f.a)(n,o),C.isAnonymousAccess?c&&(t=h.a.getOrCreate({suiteType:this.rootType,suiteToken:this.rootToken}),this.commentService.setupBroadcast(t)):this.setUpCommentTranslate(r,i,c,s)}return c()(u,[{key:"setUpCommentTranslate",value:function(e,t,n,o){var a;this.commentTranslate=m.a.getOrCreate({suiteType:this.rootType,suiteToken:this.rootToken,subCommentToken:this.subCommentToken,enableAutoTranslate:e,translateLang:t}),n&&(a=!1!==o?(this.commentTranslate=m.a.getOrCreate({suiteType:this.rootType,suiteToken:this.rootToken,subCommentToken:this.subCommentToken,enableAutoTranslate:e,translateLang:t}),this.commentTranslate.getTranslateBroadcast()):(h.a.destroy({suiteType:this.rootType,suiteToken:this.rootToken}),h.a.getOrCreate({suiteType:this.rootType,suiteToken:this.rootToken})),this.commentService.setupBroadcast(a))}},{key:"setCommentTranslateEnableLang",value:function(e,t){this.commentTranslate=m.a.getOrCreate({suiteType:this.rootType,suiteToken:this.rootToken,subCommentToken:this.subCommentToken,enableAutoTranslate:e,translateLang:t}),this.commentTranslate.setCommentTranslateEnableLang(e,t)}},{key:"addTranslateCommentId",value:function(e){this.commentTranslate&&this.commentTranslate.addTranslateCommentId(e)}},{key:"destroy",value:function(){Object(f.b)(this.rootType,this.rootToken,this.subCommentToken)}},{key:"getCommentService",value:function(){return this.commentService}},{key:"getCommentTranslate",value:function(){return this.commentTranslate}}]),u}()},Douc:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"c",function(){return l});var o,a,r=n("lwsE"),i=n.n(r),c=n("W8MJ"),m=n.n(c),s=n("26FU"),u=n("VnD/");(a=o=o||{}).SUCCESS="SUCCESS",a.SUCCESS_AND_CHANGE="SUCCESS_AND_CHANGE",a.VERSION_OUT_OF_BOUNDS="VERSION_OUT_OF_BOUNDS",a.NET_EXCEPTION="NET_EXCEPTION",a.FOLLOW_EXCEPTION="FOLLOW_EXCEPTION",a.COMMENT_MOUNT_EXCEPTION="COMMENT_MOUNT_EXCEPTION";var l=function(){function n(e){i()(this,n),this.emit=e}return m()(n,[{key:"destroy",value:function(){this.emit=null}},{key:"on",value:function(e,t){this.emit.on(e,t)}},{key:"off",value:function(e,t){this.emit.off(e,t)}},{key:"setListProps",value:function(e){n.listPropsSubject.next(e)}},{key:"onSetListProps",value:function(e){n.listPropsSubscription.set(e,n.listPropsSubject.pipe(Object(u.a)(Boolean)).subscribe(e))}},{key:"offSetListProps",value:function(e){var t=n.listPropsSubscription.get(e);t&&t.unsubscribe()}},{key:"setListMethod",value:function(e){n.listMethodSubject.next(e)}},{key:"onSetListMethod",value:function(e){n.listMethodSubscription.set(e,n.listMethodSubject.pipe(Object(u.a)(Boolean)).subscribe(e))}},{key:"offSetListMethod",value:function(e){var t=n.listMethodSubscription.get(e);t&&t.unsubscribe()}}]),n}();l.listPropsSubject=new s.a(null),l.listPropsSubscription=new Map,l.listMethodSubject=new s.a(null),l.listMethodSubscription=new Map},H6Gw:function(e,t,n){"use strict";var o=n("lwsE"),i=n.n(o),a=n("W8MJ"),c=n.n(a),r=n("a1gu"),m=n.n(r),s=n("Nsbk"),u=n.n(s),l=n("7W2i"),p=n.n(l),d=n("hMnB"),f=n.n(d),h=n("q1tI"),C=(n("17x9"),n("c/bE")),g=function(e){function r(){var e,a;i()(this,r);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(a=m()(this,(e=u()(r)).call.apply(e,[this].concat(n)))).canLeavePage=function(){return!a.props.hasUnSaveData()},a.handleBeforeUnload=function(e){if(a.props.hasUnSaveData()){var t=a.props.getUnSaveTip();return e.returnValue=t}},a.defaultHandleHistoryChange=function(e){if(e.pathname!==f.a.pathname){var t=a.props,n=t.hasUnSaveData,o=t.getUnSaveTip;return n()?o():void 0}},a}return p()(r,e),c()(r,[{key:"componentDidMount",value:function(){window.addEventListener("beforeunload",this.handleBeforeUnload),this.setSoftRoutingBlock(!0),C.a.addCanLeavePageHandler(this.canLeavePage)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.handleBeforeUnload),this.setSoftRoutingBlock(!1),C.a.removeCanLeavePageHandler(this.canLeavePage)}},{key:"setSoftRoutingBlock",value:function(e){this.props.allowSoftRouting||(e?this.blockSoftRouting():this.unblockSoftRouting())}},{key:"blockSoftRouting",value:function(){var e=this.props.history;0===r.blockFns.length&&(r.removeBlockListener=e.block(function(){for(var e=r.blockFns,t=0;t<e.length;t++){var n=e[t].apply(void 0,arguments);if(n)return n}})),r.blockFns.push(this.handleHistoryChange)}},{key:"unblockSoftRouting",value:function(){var e,t,n=this;this.props.allowSoftRouting||(e=r.blockFns,t=r.removeBlockListener,r.blockFns=e.filter(function(e){return e!==n.handleHistoryChange}),r.blockFns.length<=0&&t())}},{key:"render",value:function(){if(this.props.children){var e=h.Children.only(this.props.children);return Object(h.cloneElement)(e)}return null}},{key:"handleHistoryChange",get:function(){return this.props.handleHistoryChange||this.defaultHandleHistoryChange}}]),r}(h.Component);g.defaultProps={allowSoftRouting:!1},g.blockFns=[],g.removeBlockListener=function(){},t.a=g},IEyy:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o={confirm:["meta,enter","ctrl,enter"],lineBreak:["enter"],esc:["esc"]}},NzDz:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n("J4zp"),p=n.n(o),a=n("lwsE"),r=n.n(a),i=n("W8MJ"),c=n.n(i),m=n("cDf5"),s=n.n(m),u=n("xKvl"),l=n("1dfU"),d=n("m3gH"),f=n("lG83"),h=n("fJxK"),C=function(e,t,n,o){var a,r=arguments.length,i=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":s()(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;0<=c;c--)(a=e[c])&&(i=(r<3?a(i):3<r?a(t,n,i):a(t,n))||i);return 3<r&&i&&Object.defineProperty(t,n,i),i};function g(){return d.a.isInFullscreen()?"play_mode_comment":""}var v=function(){function t(e){r()(this,t),this.commentType=e}return c()(t,[{key:"logShowReactionPanel",value:function(){}},{key:"logSelectReaction",value:function(e){}},{key:"logCancelReaction",value:function(e){}},{key:"logShowReactionPage",value:function(e){}},{key:"logShowReactionPageFull",value:function(e){}},{key:"logClientCommentSumbitBox",value:function(e){}},{key:"logClientCommentReplyComment",value:function(e){}},{key:"logClientCommentInputBox",value:function(e){}},{key:"logClientCommentEditComment",value:function(e){}},{key:"logDevCommentEvent",value:function(e){}},{key:"logCommentSubmitSuccess",value:function(e){}},{key:"logSubmitEventError",value:function(e){}},{key:"logClickCommentFinish",value:function(e){}},{key:"logCommentEdit",value:function(e){}},{key:"logCommentEditConfirm",value:function(e){}},{key:"logCommentDelete",value:function(e){}},{key:"logClickCommentInput",value:function(e){}},{key:"getCommentCommonTeaLogData",value:function(e){return Object.assign({comment_type:this.commentType,comment_id:Object(l.a)(e.commentId),reply_id:Object(l.a)(e.replyId)},e.pluginTeaParams)}}]),t}();C([Object(u.a)("client_comment",function(e){return{action:"show_reaction_panel",comment_type:e.context.commentType}})],v.prototype,"logShowReactionPanel",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.reactionKey,i=a.referKey,c=a.commentId;return{action:"select_reaction",comment_id:Object(l.a)(c),reply_id:Object(l.a)(i),comment_type:o.commentType,emoji_type:r}})],v.prototype,"logSelectReaction",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0].reactionKey;return{action:"cancel_reaction",comment_type:o.commentType,emoji_type:a}})],v.prototype,"logCancelReaction",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0].reactionKey;return{action:"show_reaction_page",comment_type:o.commentType,emoji_type:a}})],v.prototype,"logShowReactionPage",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0].reactionKey;return{action:"show_reaction_page_full",comment_type:o.commentType,emoji_type:a}})],v.prototype,"logShowReactionPageFull",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.commentContentType,i=a.source,c=void 0===i?"direct":i,m=a.pluginTeaParams;return Object.assign({},o.getCommentCommonTeaLogData(a),{source:c,action:h.a.SubmitBox,comment_type:o.commentType,comment_content_type:r},m)})],v.prototype,"logClientCommentSumbitBox",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.commentContentType,i=a.source,c=void 0===i?"direct":i,m=a.pluginTeaParams;return Object.assign({},o.getCommentCommonTeaLogData(a),{source:c,action:h.a.ReplyComment,comment_type:o.commentType,comment_content_type:r},m)})],v.prototype,"logClientCommentReplyComment",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.source,i=void 0===r?"direct":r,c=a.pluginTeaParams;return Object.assign({},o.getCommentCommonTeaLogData(a),{action:h.a.InputBox,source:i,comment_type:o.commentType},c)})],v.prototype,"logClientCommentInputBox",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.commentContentType;return Object.assign({},o.getCommentCommonTeaLogData(a),{action:h.a.SubmitEdit,comment_type:o.commentType,comment_content_type:r})})],v.prototype,"logClientCommentEditComment",null),C([Object(u.a)("dev_comment_event",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.commentId,i=void 0===r?"":r,c=a.replyId,m=void 0===c?"":c,s=a.stage,u=a.extra,l=void 0===u?"":u;return Object.assign({},o.getCommentCommonTeaLogData({commentId:i,replyId:m}),{comment_stage:s,comment_extra:l})})],v.prototype,"logDevCommentEvent",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.commentTargetType,i=a.source,c=void 0===i?"direct":i,m=a.pluginTeaParams,s=a.translate_source;return Object.assign({},o.getCommentCommonTeaLogData(a),{action:"submit_comment",status_code:0,status_name:"success",comment_action:"click_submit",is_first:"true",comment_target_type:r,click_comment_submit_source:g(),source:c,zone:Object(f.l)(),translate_source:s},m)})],v.prototype,"logCommentSubmitSuccess",null),C([Object(u.a)("client_comment",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.code,i=a.msg,c=a.pluginTeaParams,m=a.translate_source;return Object.assign({action:"submit_comment",comment_type:o.commentType,status_name:i,status_code:r,zone:Object(f.l)(),translate_source:m},c)})],v.prototype,"logSubmitEventError",null),C([Object(u.a)("click_comment_finish",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.commentId,i=a.pluginTeaParams;return Object.assign({comment_type:o.commentType,comment_id:Object(l.a)(r),click_comment_finish_source:g()},i)})],v.prototype,"logClickCommentFinish",null),C([Object(u.a)("click_comment_edit",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0];return Object.assign({},o.getCommentCommonTeaLogData(a),{translate_source:a.translate_source})})],v.prototype,"logCommentEdit",null),C([Object(u.a)("click_comment_edit_confirm",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0];return o.getCommentCommonTeaLogData(a)})],v.prototype,"logCommentEditConfirm",null),C([Object(u.a)("click_comment_delete",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0];return o.getCommentCommonTeaLogData(a)})],v.prototype,"logCommentDelete",null),C([Object(u.a)("click_comment_input",function(e){var t=e.context,n=e.args,o=t,a=p()(n,1)[0],r=a.isFirst,i=a.pluginTeaParams;return Object.assign({comment_type:o.commentType,comment_action:"click_input",is_first:r?"true":"false"},i)})],v.prototype,"logClickCommentInput",null)},"RNF+":function(e,t,n){"use strict";n.r(t);var o=n("m/+l"),a=n("ANjH"),r=n("RoAh"),i=n("3AGV"),c=n("3M86"),m=n("qYkn"),s=n("vc5i"),u=n("5cZX"),l=n("NltJ"),p=n("Q9MD"),d=n("wIs1"),f=n("myFJ"),h=n("jzcD"),C=n("1tpT"),g=n("QM+C"),v={fetchGlobalComments:i.c,setCommentMessageRead:i.i,updatePCMessageListData:c.b,copyTextWithoutPermission:m.a,setActiveNotification:C.a},y=function(e){return Object.assign({user:Object(l.d)(e),memberId:Object(p.b)(e),commentList:Object(l.l)(e),noteType:Object(s.o)(e),noteToken:Object(s.n)(e),haveCommentPermission:Object(u.b)(e),otherPermissions:Object(u.u)(e),transEnabled:!g.isAnonymousAccess,isCommentsDataReady:Object(l.n)(e)},Object(h.a)(e))},T=Object(a.compose)(Object(o.connect)(y,v),f.a,d.a)(r.a);t.default=T},RoAh:function(e,oe,ae){"use strict";(function(C){var e=ae("o0o1"),M=ae.n(e),t=ae("J4zp"),R=ae.n(t),n=ae("yXPU"),i=ae.n(n),o=ae("lwsE"),c=ae.n(o),a=ae("W8MJ"),m=ae.n(a),r=ae("a1gu"),s=ae.n(r),u=ae("Nsbk"),l=ae.n(u),p=ae("PJYZ"),d=ae.n(p),f=ae("7W2i"),h=ae.n(f),g=ae("xpYl"),N=ae("7EGn"),v=ae("hbEN"),y=ae("q1tI"),T=ae.n(y),b=(ae("17x9"),ae("TSYQ")),E=ae.n(b),D=ae("QM+C"),_=ae("uQON"),k=ae("JXNz"),O=ae("xbZX"),I=ae("3AGV"),S=ae("2z0X"),x=ae("H6Gw"),L=ae("0qwg"),w=ae("IEyy"),P=ae("iP/4"),j=ae("OX8E"),U=(ae("hi6O"),ae("cHHt")),F=ae("ubJt"),B=ae("Scxb"),H=ae("SebV"),K=ae("x/Yo"),W=ae("fOmz"),V=ae("n/R6"),X=ae("PIny"),Y=ae("sLU5"),z=ae("7ESD"),J=ae("Sjdk"),Q=ae("sFgt"),q=ae("X2y7"),Z=ae("2ACu"),$=ae("rLED"),ee=ae("MO5G"),te=200,ne=function(e){function t(e){var x;return c()(this,t),(x=s()(this,l()(t).call(this,e))).setActiveNotificationNull=function(){(0,x.props.setActiveNotification)({commentId:null,commentOption:{}})},x.handleIntersectionObserver=function(e,t){e[0].intersectionRatio<0||(x.observerBottomIntersectionRatio=e[0].intersectionRatio,x.loadNextPage())},x.bindPadEvent=function(){var e=x.props.editor;e.on("handleClientMessage_NEW_DOC_MESSAGE",x.handleClientMessageNewDocMessage),e.on("doc-comment-version-break",x.handleDocCommentVersionBreak)},x.handleSendToGlobalCommentCollabs=function(e){var t=e.type,n=e.data_str;x.props.editor.plugins.client.sendMessage({type:t,data_str:n})},x.handleClientMessageNewDocMessage=function(e){var t,n,o,a,r,i=e.msg;i&&i.data_str&&(t=i.data_str,n=i.token,o=t.comment,a=t.message,o&&a.comment_id&&(r=o[a.comment_id],Object(_.j)(r)&&x.props.updatePCMessageListData({newMessage:t,token:n})))},x.handleDocCommentVersionBreak=function(e){var t=e.version;e.oldVersion;x.fetchData(t)},x.handleReopenGlobalComment=function(e){var t=[{reply_id:Object(N.default)(e,"comment_list[0].reply_id"),action:"update"}];Object(I.h)(t)},x.loadNextPage=Object(v.default)(function(){var e=x.props.commentList,t=x.state,n=t.pageSize,o=t.page;e.length>o*n&&x.setState({page:o+1})},te),x.fetchData=function(e){x.hasLoad=!0;var t=x.props;(0,t.fetchGlobalComments)(t.noteToken,0,e)},x.handleViolatePolicies=function(e){var t=e.error,n=e.type,o=e.commentId,a=e.replyId,r=e.oldContent;if(t&&Object(X.d)(t.code)){var i=d()(x).commentDataActions;if("update"===n){var c=x.commentListRefMap.get(o);c&&c.setContentToUpdateTextarea(a)}else if(x.textareaRef){var m=x.props.commentList.findIndex(function(e){return e.commentId===o});if(-1===m)return;var s=x.props.commentList[m],u=s.content,l=s.entities;x.textareaRef.handleFillHtml(u,l),x.textareaRef.focus(),x.textareaRef.setCursorEnd()}i.deleteTemplateComment({commentId:o,replyId:a,type:n,oldContent:r}),V.a.error({duration:3e3,closable:!0,content:C("mobile.comment_verified_failed")})}},x.handleAddComment=function(){var t=i()(M.a.mark(function e(t){var n,o,a,r,i,c,m,s,u,l,p,d,f,h,C,g,v,y,T,b,E,D,_,k,O,I,S;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.tempCommentId,o=void 0===n?Object(K.generateCommentId)():n,a=t.tempReplyId,r=void 0===a?Object(K.generateReplyId)():a,i=t.content,c=t.imageList,m=t.realReplyId,s=t.stage,u=t.onComplete,l=x.props,p=l.commentList,d=l.user,f=d.user_id,h=p.find(function(e){return e.commentId===o}),C=h?h.source:void 0,y={content:i,quote:g="",userId:f,replyId:r,commentId:o,isWhole:v=1},Object(ee.a)()&&c&&0<c.length&&(y.realReplyId=m,y.extra={image_list:c}),x.commentDataActions.startNewComment({commentId:o,quote:g,isWhole:v}),x.logger.logDevCommentEvent({stage:s.INIT,extra:o}),u&&u(),e.prev=12,e.next=15,x.commentDataActions.addComment(y);case 15:b=e.sent,T=b.comment,e.next=27;break;case 19:return e.prev=19,e.t0=e.catch(12),x.handleViolatePolicies({error:e.t0,type:"add",commentId:o,replyId:r}),Object(H.a)(e.t0),E=e.t0.code,D=e.t0.msg,x.logger.logDevCommentEvent({stage:s.FAILURE,extra:o}),x.logger.logSubmitEventError({msg:D,code:E}),e.abrupt("return");case 27:if(_=T.commentId,k=R()(T.commentList,1),O=k[0].replyId,I=Object(N.default)(b,"entities.not_notify_users",{}),Object(Q.g)(I),x.logger.logCommentSubmitSuccess({commentId:_,replyId:O,commentTargetType:"",source:C}),x.logger.logDevCommentEvent({stage:s.SUCCESS,commentId:_,replyId:O,extra:o}),x.commentDataActions.linkCommentToDoc({commentId:o,tempReplyId:r,replyId:O}),x.commentDataActions.linkCommentToDocOK({commentId:_,tempCommentId:o,replyId:O}),x.textareaRef){e.next=37;break}return e.abrupt("return");case 37:if((S=x.textareaRef.editorComponent.editor).isFocus())return e.abrupt("return",S.blur());e.next=40;break;case 40:x.setState({textareaExpanded:!1});case 41:case"end":return e.stop()}},e,null,[[12,19]])}));return function(e){return t.apply(this,arguments)}}(),x.handleBlur=function(e){x.setState({textareaExpanded:!x.textareaRef.isEmpty(),textareaFocus:!1})},x.handleCancel=function(){x.setState({textareaExpanded:!1,textareaFocus:!1})},x.handleFocus=function(){var e=x.state,t=e.textareaExpanded,n=e.textareaFocus,o=x.props,a=o.commentList,r=o.onFocus;n||x.logger.logClickCommentInput({isFirst:a.length<=0}),j.a.trigger("docComment.clearActiveComment"),t&&n||(x.setState({textareaExpanded:!0,textareaFocus:!0}),r&&r())},x.handleResolve=function(){var t=i()(M.a.mark(function e(t){var n,o,a;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x.logger.logClickCommentFinish({commentId:t}),n=x.props.commentList.find(function(e){return e.commentId===t}),o=n?n.reply_id:null,x.commentDataActions.resolveCommentAnimationEnd({commentId:t}),a=x.props.user.user_id,e.next=7,x.commentDataActions.resolveComment({commentId:t,userId:a});case 7:null!==o&&Object(I.h)([{replyId:o,action:"finish"}]);case 8:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),x.handleReply=function(){var n=i()(M.a.mark(function e(t,n){var o,a,r;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:x.textareaRef&&x.textareaRef.focus(),o=x.getScrollContainer(),a=x.textareaRef.editorAreaRef.getBoundingClientRect().top,r=window.innerHeight,o.scrollTop+=a-r*(2/3),n&&(x.performUserToTextareaHead(n),Object(Z.default)("orientation_comment_click",{from:"full_comment"}));case 6:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),x.handleAddReaction=function(e){var t=e.referKey,n=e.reactionKey;x.getOrCreateReactionSDK(x.props).addReaction(D.COMMENT_REACTION_MODULE,t,n),x.logger.logSelectReaction({reactionKey:n})},x.handleRemoveReaction=function(e){var t=e.referKey,n=e.reactionKey;x.getOrCreateReactionSDK(x.props).removeReaction(D.COMMENT_REACTION_MODULE,t,n),x.logger.logCancelReaction({reactionKey:n})},x.handleReactionDetailClick=function(e,t,n){x.logger.logShowReactionPage({reactionKey:e}),t.some(function(e){return e.userList.length<e.totalCount})&&(x.getOrCreateReactionSDK(x.props).fetchReactionDetail(D.COMMENT_REACTION_MODULE,t[0].referKey),x.logger.logShowReactionPageFull({reactionKey:e}))},x.handleShowReactionPanel=function(){x.logger.logShowReactionPanel()},x.handleRetry=function(){var o=i()(M.a.mark(function e(t,n,o){var a,r,i,c,m;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.content,r=n.reply_id,i=n.extra,c=n.realReplyId,n.error,Object(ee.a)()&&i&&i.image_list&&(m=i.image_list),o&&"update"===o)return x.handleUpdateConfirm(r,a,null,m,t),e.abrupt("return");e.next=5;break;case 5:if(o&&"delete"===o)return x.handleDelete(t,r),e.abrupt("return");e.next=8;break;case 8:x.handleAddComment({tempCommentId:t,tempReplyId:r,content:a,imageList:m,realReplyId:c,stage:B.b});case 9:case"end":return e.stop()}},e)}));return function(e,t,n){return o.apply(this,arguments)}}(),x.handleEdit=function(e,t){var n=t.reply_id;x.logger.logCommentEdit({commentId:e,replyId:n})},x.handleTranslate=function(e,t,n){x.commentDataActions.getCommentTranslate().translateCommentItem(e,t,n)},x.handleVisibilityChange=function(){x.cacheReadIds.length&&Object(_.l)()&&x.markReadStatus(x.cacheReadIds,function(){x.cacheReadIds=[]})},x.hasUnFinishComment=function(){var e=x.getCommentDraft();return(!e||!e.getCommentDrafIsSupport())&&(!!x.textareaRef&&(!x.textareaRef.isEmpty()||x.props.commentList.find(function(e){var t=e.error,n=e.sending;return t||n})))},x.hasComment=function(){var e=x.props.commentList;return e&&e.length},x.getTextareaRef=function(e){x.textareaRef=e,x.handleTextareaLoaded()},x.onContentChange=function(e,t,n,o){var a=!0;Object(L.a)(0<n.length,a);var r=x.getCommentDraft();r&&r.setCommentDraft({whole:1,commentId:e,commentDrafContext:null,replyId:t,content:n,html:o})},x.getCommentDraft=function(){return q.b.getOrCreate({token:x.props.noteToken})},x.handleCommentDraftMount=i()(M.a.mark(function e(){var t;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(t=x.getCommentDraft())&&t.handleCommentDraftMount(null,x.handleAutoFillContentToTextarea);case 2:case"end":return e.stop()}},e)})),x.waitUntilTextareaLoaded=function(){return x.textareaRef?Promise.resolve():new Promise(function(e){x.handleTextareaLoadedQueue.push(function(){e()})})},x.handleTextareaLoaded=function(){x.handleTextareaLoadedQueue.forEach(function(e){return e()}),x.handleTextareaLoadedQueue=[]},x.handleAutoFillContentToTextarea=i()(M.a.mark(function e(){var t,n,o,a,r,i,c,m;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=x.getCommentDraft()){e.next=3;break}return e.abrupt("return");case 3:if(n=t.getActiveDocDraft()){e.next=6;break}return e.abrupt("return");case 6:if(o=n.commentId,a=n.replyId,r=n.id,i=n.html,c=n.content,n.whole){e.next=9;break}return e.abrupt("return");case 9:return t.logDevCommentDraft({action:"setCommentPanelHtml",haveReplyId:!!a,haveHtml:!!i,haveCommentId:!!o,isWhole:!0}),e.next=12,x.waitUntilTextareaLoaded();case 12:o===q.a&&x.textareaRef?(x.textareaRef.handleFillHtml(c,i,null),x.textareaRef.focus(),x.textareaRef.setCursorEnd(),x.setState({textareaExpanded:!0})):a&&o&&(m=x.commentListRefMap.get(o))&&m.setContentToUpdateTextarea(a,i),r&&t.deleteDocDraft(r),t.clearActiveDocDraft();case 15:case"end":return e.stop()}},e)})),x.handleCopy=function(e){var t=x.props.otherPermissions;if(t&&!t.copyable)return e.preventDefault(),x.props.copyTextWithoutPermission(),!1},x.handleAddCommentConfirm=function(e,t,n,o){x.handleAddComment({content:e,imageList:n,realReplyId:o,stage:B.a,onComplete:t})},x.handleUpdateConfirm=function(){var r=i()(M.a.mark(function e(t,n,o,a,r){var i,c,m;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(x.logger.logCommentEditConfirm({commentId:r,replyId:t}),i={commentId:r,content:n,replyId:t},Object(ee.a)()&&a&&(i.extra={image_list:a}),-1===(c=x.props.commentList.findIndex(function(e){return e.commentId===r})))return e.abrupt("return");e.next=6;break;case 6:return m=x.props.commentList[c].content,e.prev=8,e.next=11,x.commentDataActions.updateComment(i);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(8),x.handleViolatePolicies({error:e.t0,type:"update",commentId:r,oldContent:m,replyId:t});case 16:Object(I.h)([{replyId:t,action:"update"}]),o&&o();case 18:case"end":return e.stop()}},e,null,[[8,13]])}));return function(e,t,n,o,a){return r.apply(this,arguments)}}(),x.handleDelete=function(){var n=i()(M.a.mark(function e(t,n){var o;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.reply_id,x.logger.logCommentDelete({commentId:t,replyId:o}),e.next=4,x.commentDataActions.deleteComment({replyId:o,commentId:t});case 4:Object(I.h)([{replyId:o,action:"delete"}]);case 5:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),x.mentionOptions={type:"full_comment"},x.getUpdateTextAreaProps=function(e){return{className:"global-comment__textarea global-comment__textarea--update",expandCls:"global-comment__textarea--expand",limit:1e4,mentionOptions:x.mentionOptions,placeholder:x.getPlaceholder(),shortcuts:w.a,confirmText:C("common.confirm"),onConfirm:x.handleUpdateConfirm,onBlur:x.handleBlur,source:1,onCancel:x.handleCancel,editorDidUpdate:Object(g.a)(x.onContentChange,e)}},x.state={page:1,pageSize:15,textareaExpanded:!1,textareaFocus:!1},x.debounceMarkReadStatus=Object(S.a)(x.markReadStatus.bind(d()(x)),200),x.cacheReadIds=[],x.observerBottomIntersectionRatio=-1,x.logger=new B.c,x.commentDataActions=null,x.commentListRefMap=new Map,x.handleTextareaLoadedQueue=[],x.isUnmounted=!1,x}function n(e){return o.apply(this,arguments)}var o,a;function r(e){return a.apply(this,arguments)}return h()(t,e),m()(t,[{key:"componentDidMount",value:function(){this.bindPadEvent(),this.containerWrapperEl=document.querySelector(".etherpad-container-wrapper"),document.addEventListener("visibilitychange",this.handleVisibilityChange),j.a.on("handleSendToGlobalCommentCollabs",this.handleSendToGlobalCommentCollabs),j.a.on("globalComment.inViewport",this.debounceMarkReadStatus),this.initCommentDataActions(),this.props.highlightServ&&this.props.highlightServ.attach(this),j.a.trigger(Y.a.COMMON.GLOBAL_COMMENT.DID_MOUNT);var e=this.props.commentList;this.commentFindProvider?this.commentFindProvider.setCommentList(e):this.loadCommentFindProvider(),this.observerNextPage(),this.handleCommentDraftMount()}},{key:"componentDidUpdate",value:function(e,t){var n=e.noteToken,o=e.commentList,a=e.noteType,r=this.props,i=r.noteToken,c=r.commentList,m=r.noteType===a;i===n?c.length!==o.length&&(j.a.trigger("viewportContentChange"),this.handleAutoFillContentToTextarea()):m&&!i&&this.initCommentDataActions(),n===i&&(o!==c&&(o.length||c.length)&&(j.a.trigger("viewportContentChange"),this.commentFindProvider&&this.commentFindProvider.setCommentList(c)),t.page!==this.state.page&&this.commentFindProvider&&this.commentFindProvider.triggerFindWhenPageChange(),e.translateContentCompare!==this.props.translateContentCompare&&this.commentFindProvide&&this.commentFindProvider.setTranslateContentCompare(this.props.translateContentCompare))}},{key:"componentWillUnmount",value:function(){var e=this.props.editor;e.off("handleClientMessage_NEW_DOC_MESSAGE",this.handleClientMessageNewDocMessage),e.off("doc-comment-version-break",this.handleDocCommentVersionBreak),j.a.off("handleSendToGlobalCommentCollabs",this.handleSendToGlobalCommentCollabs),document.removeEventListener("visibilitychange",this.handleVisibilityChange),j.a.off("globalComment.inViewport",this.debounceMarkReadStatus),this.props.highlightServ&&this.props.highlightServ.detach(),this.debounceMarkReadStatus=null,this.containerWrapperEl=null,this.cacheReadIds=[],this.observer&&this.observer.disconnect(),this.commentFindProvider&&this.commentFindProvider.destroy(),this.handleTextareaLoadedQueue=[],this.isUnmounted=!0}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.state,n=t.page,o=t.pageSize,a=e.commentList.length,r=Math.ceil(a/o);n*o<=a&&r-n==1&&0<this.observerBottomIntersectionRatio&&this.setState({page:n+1}),this.props.noteToken!==e.noteToken&&this.bindPadEvent()}},{key:"observerNextPage",value:function(){this.containerWrapperEl&&(this.observer=new IntersectionObserver(this.handleIntersectionObserver,{root:this.containerWrapperEl,rootMargin:"0px",threshold:0}),this.observerBottom())}},{key:"activeCommentMessage",value:function(e,t){var n=t.isWhole,o=t.finish;if(n){if(o)return V.a.removeAll(),V.a.error({duration:3e3,closable:!0,content:C("feed.comment_resolve")}),void this.setActiveNotificationNull();this.highlightGlobalComment(e);var a=this.getCommentOffsetTop(e);if(!a)return V.a.removeAll(),V.a.info({duration:3e3,closable:!0,content:C("feed.comment_deleted")}),void this.setActiveNotificationNull();var r,i=document.querySelector("#doc-container");i&&(r=a+i.offsetHeight,this.props.editor.getScrollContainer().scrollTop=r,this.setActiveNotificationNull())}}},{key:"loadCommentFindProvider",value:function(){var t=this,e=z.a.setupGlobalCommentFindProvider();e&&e.then(function(e){t.isUnmounted||(t.commentFindProvider=e,t.commentFindProvider.setup(t,t.props.translateContentCompare),t.commentFindProvider.setCommentList(t.props.commentList))})}},{key:"initCommentDataActions",value:function(){var e=this.props,t=e.noteType,n=e.noteToken,o=e.enableTranslate,a=e.targetLang;this.commentDataActions=new W.a({rootType:t,rootToken:n,isTemplate:!1,enableAutoTranslate:o,translateLang:a})}},{key:"setCommentListRef",value:function(e,t){null===t?this.commentListRefMap.delete(e):this.commentListRefMap.set(e,t)}},{key:"waitCommentRendered",value:(a=i()(M.a.mark(function e(t){var n,o,a,r,i,c,m,s=this;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===(n=this.props.commentList.findIndex(function(e){return e.commentId===t})))return e.abrupt("return",null);e.next=3;break;case 3:if(o=this.props.commentList[n].reply_id,a=this.state,r=a.page,i=a.pageSize,c=Math.floor(n/i)+1,r<c)return e.next=9,new Promise(function(e){return s.setState({page:c},e)});e.next=9;break;case 9:return m=this.commentListRefMap.get(t),e.abrupt("return",{replyId:o,ref:m});case 11:case"end":return e.stop()}},e,this)})),r)},{key:"getScrollContainer",value:function(){return this.props.editor.getScrollContainer()}},{key:"highlightGlobalComment",value:(o=i()(M.a.mark(function e(t){var n;return M.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitCommentRendered(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:n.ref.startHighlightAnimation(n.replyId,"global-comment-highlight-animation");case 6:case"end":return e.stop()}},e,this)})),n)},{key:"getCommentOffsetTop",value:function(e){var t=this.props.editor.getOuterContainer(),n=this.commentListRefMap.get(e),o=document.querySelector(".global-like-pc__wrapper"),a=o?o.offsetHeight:0;return n?n.node.offsetTop+t.offsetHeight+a:null}},{key:"getOrCreateReactionSDK",value:function(e){var t=e.noteType,n=e.noteToken;return F.a.getOrCreate({suiteType:t,suiteToken:n,broadcastType:D.COMMENT_REACTION_MODULE})}},{key:"performUserToTextareaHead",value:function(e){this.textareaRef&&this.textareaRef.performUserToTextareaHead(e)}},{key:"markReadStatus",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=Object(_.l)();if(e.length)if(n)try{this.props.setCommentMessageRead({member_id:this.props.memberId,msg_id:e},D.COMMENT_TYPE_MAP.GLOBAL_COMMENT).then(t)}catch(e){console.log(e)}else this.cacheReadIds=this.cacheReadIds.concat(e)}},{key:"observerBottom",value:function(){var e;this.observer&&0===this.observer.takeRecords().length&&(e=document.querySelector("#globalComment .bottom-position"),this.observer.observe(e))}},{key:"getPlaceholder",value:function(){var e=Object(U.a)(),t=P.a.mac?C("common.mac_meta_key"):C("common.window_meta_key");return e?C("comment.global.metakey.tips",e,t):C("comment.diff_operation_enter_key_tips",t)}},{key:"render",value:function(){var a=this,e=this.props,t=e.commentList,r=e.haveCommentPermission,n=e.history,i=e.user,c=e.translateContentCompare,m=e.transEnabled,o=this.state,s=o.pageSize,u=o.page,l=o.textareaExpanded,p=o.textareaFocus,d=t.slice(0,s*u),f=E()("global-comment__textarea",{"global-comment__textarea--expand":l,"global-comment__textarea--focus":!Object(ee.a)()&&p}),h=T.a.createElement(J.a,{getRef:this.getTextareaRef,className:f,limit:1e4,mentionOptions:this.mentionOptions,placeholder:this.getPlaceholder(),shortcuts:w.a,onConfirm:this.handleAddCommentConfirm,onFocus:this.handleFocus,onBlur:this.handleBlur,source:1,onCancel:this.handleCancel,user:i,editorDidUpdate:Object(g.a)(this.onContentChange,"newComment"),isGlobal:!0,commentImageEnabled:!0});return T.a.createElement(x.a,{history:n,hasUnSaveData:this.hasUnFinishComment,getUnSaveTip:function(){return C("comment.leave_page_warning_message")}},T.a.createElement("div",{className:"global-comment innerdocbody",id:"globalComment"},0<d.length?T.a.createElement("div",{className:"global-comment__title g-pr"},T.a.createElement("span",{style:{paddingLeft:"8px"}},C("common.full.text_review"))):"",d&&T.a.createElement(O.a,null,function(e){var n=e.highlightId,o=e.onHighlightChange;return d.map(function(t){var e=E()("global-comment__item","comment-id-".concat(t.commentId));return T.a.createElement(k.a,{ref:function(e){return a.setCommentListRef(t.commentId,e)},readonly:!r,enableReaction:Object($.i)(),more:!0,myUserId:i.user_id,source:"full_comment",busNameSpace:"globalComment",className:e,key:t.commentId,commentId:t.commentId,list:t.selfAsList,resolvable:!0,showResolveAction:"hover",updateTextAreaProps:a.getUpdateTextAreaProps(t.commentId),onResolve:a.handleResolve,onReply:a.handleReply,onRetry:a.handleRetry,onCopy:a.handleCopy,onCut:a.handleCopy,onEdit:a.handleEdit,onDelete:a.handleDelete,onTranslate:a.handleTranslate,addReaction:a.handleAddReaction,removeReaction:a.handleRemoveReaction,onClickReactionDetail:a.handleReactionDetailClick,onShowReactionPanel:a.handleShowReactionPanel,translateContentCompare:c,transEnabled:m,embedObjShareEnable:Object($.s)(),highlightId:n,onHighlightChange:o,panelExpand:!0,commentImageEnabled:!0})})}),r&&h,T.a.createElement("div",{className:"bottom-position"})))}}]),t}(y.Component);ne.defaultProps={shortcut:w.a,enableTranslate:!1,targetLang:"en"},oe.a=ne}).call(this,ae("2vAP"))},Scxb:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return p});var o,a,r,i,c=n("lwsE"),m=n.n(c),s=n("W8MJ"),u=n.n(s),l=n("NzDz");(a=o=o||{}).INIT="init_global_comment",a.SUCCESS="init_global_comment_success",a.FAILURE="init_global_comment_fail",(i=r=r||{}).INIT="init_global_comment_retry",i.SUCCESS="init_global_comment_retry_success",i.FAILURE="init_global_comment_retry_fail";var p=function(){function e(){m()(this,e),this.commentLogger=new l.a("full_comment")}return u()(e,[{key:"logShowReactionPanel",value:function(){this.commentLogger.logShowReactionPanel()}},{key:"logSelectReaction",value:function(e){this.commentLogger.logSelectReaction(e)}},{key:"logCancelReaction",value:function(e){this.commentLogger.logSelectReaction(e)}},{key:"logShowReactionPage",value:function(e){this.commentLogger.logSelectReaction(e)}},{key:"logShowReactionPageFull",value:function(e){this.commentLogger.logShowReactionPageFull(e)}},{key:"logDevCommentEvent",value:function(e){this.commentLogger.logDevCommentEvent(e)}},{key:"logCommentSubmitSuccess",value:function(e){this.commentLogger.logCommentSubmitSuccess(e)}},{key:"logSubmitEventError",value:function(e){this.commentLogger.logSubmitEventError(e)}},{key:"logClickCommentFinish",value:function(e){this.commentLogger.logClickCommentFinish(e)}},{key:"logCommentEdit",value:function(e){this.commentLogger.logCommentEdit(e)}},{key:"logCommentEditConfirm",value:function(e){this.commentLogger.logCommentEditConfirm(e)}},{key:"logCommentDelete",value:function(e){this.commentLogger.logCommentDelete(e)}},{key:"logClickCommentInput",value:function(e){this.commentLogger.logClickCommentInput(e)}}]),e}()},X2y7:function(e,C,g){"use strict";(function(c){g.d(C,"a",function(){return u}),g.d(C,"b",function(){return h});var e=g("o0o1"),d=g.n(e),t=g("yXPU"),o=g.n(t),n=g("lwsE"),a=g.n(n),f=g("LghI"),r=g("wOYm"),i=g("n/R6"),m=g("Douc"),s=g("2ACu"),u="newComment",l=function e(t){var p=this;a()(this,e),this.isSupportDraft=!1,this.activeDocDraft=null,this.drafCommentId=null,this.commentData=null,this.commentPositionLoaded=!1,this.isHandleCommentDraftMounted=!1,this.commentDrafContextMap=new Map,this.logDevCommentDraft=function(e){Object(s.collectSuiteEvent)("comment_draft_dev_log",e)},this.updateLoadingStatus=function(e){p.commentPositionLoaded=e},this.getCommentPositionLoaded=function(){return p.commentPositionLoaded},this.setCommentData=function(e){p.commentData=e,p.handleUnusualScene()},this.handleUnusualScene=function(){if(p.commentData&&p.activeDocDraft){var e=p.activeDocDraft,t=e.commentId,n=e.replyId,o=e.commentDrafContext;if(t!==u&&!o){var a=p.findCommentById(t);if(!a)return p.resetActiveDocDraft(),p.handleToast(c("draft.comment.deleted")),void console.error("没有评论了");var r=a.finish,i=a.commentList;if(r)return p.resetActiveDocDraft(),void p.handleToast(c("draft.comment.finish"));n&&(i.find(function(e){return e.replyId===n})||(p.resetActiveDocDraft(),p.handleToast(c("draft.comment.deleted"))))}}},this.resetActiveDocDraft=o()(d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.activeDocDraft){e.next=2;break}return e.abrupt("return");case 2:if(t=p.activeDocDraft.id,p.clearActiveDocDraft(),t)return e.next=7,p.deleteDocDraft(t);e.next=7;break;case 7:case"end":return e.stop()}},e)})),this.getIsHandleCommentDraftMounted=function(){return p.isHandleCommentDraftMounted},this.showOriginTextDeleted=function(){p.resetActiveDocDraft(),p.handleToast(c("draft.comment.text_deleted"))},this.handleToast=function(e){i.a.removeAll(),i.a.error({duration:3e3,closable:!0,content:e})},this.findCommentById=function(t){return p.commentData?p.commentData.find(function(e){return e.commentId===t}):null},this.clearDrafCommentId=function(){p.drafCommentId=null},this.clearActiveDocDraft=function(){p.activeDocDraft=null},this.getCommentDrafIsSupport=function(){return p.isSupportDraft},this.getDrafCommentId=function(){return p.drafCommentId},this.getActiveDocDraft=function(){return p.activeDocDraft},this.deleteDocDraft=function(){var t=o()(d.a.mark(function e(t){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.e.deleteDocDraft(t,p.token);case 2:return n=e.sent,p.logDevCommentDraft({action:"deleteDocDraft",draftId:t}),e.abrupt("return",n);case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.destroy=function(){p.clearDrafCommentId(),p.clearActiveDocDraft(),p.isSupportDraft=!1,p.commentPositionLoaded=!1,p.isHandleCommentDraftMounted=!1},this.setCommentDraft=function(){var t=o()(d.a.mark(function e(t){var n,o,a,r,i,c,m,s,u,l;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.isSupportDraft){e.next=2;break}return e.abrupt("return");case 2:if(n=t.commentId,o=t.commentDrafContext,a=t.replyId,r=t.content,i=t.html,c=t.whole,o&&p.commentDrafContextMap.set(n,o),r){e.next=11;break}if(p.drafCommentId)return e.next=8,p.deleteDocDraft(p.drafCommentId);e.next=10;break;case 8:p.clearDrafCommentId(),p.clearActiveDocDraft();case 10:return e.abrupt("return");case 11:if(p.drafCommentId){e.next=16;break}return e.next=14,f.e.saveDocDraft({token:p.token,content:r||"",extra:{commentId:n,replyId:a,html:i||"",whole:c,commentDrafContext:p.commentDrafContextMap.get(n)||null},updateTime:(new Date).getTime()});case 14:return p.drafCommentId=e.sent,e.abrupt("return");case 16:return e.next=18,f.e.getDocDraft(p.token);case 18:if((m=e.sent).length<=0)return e.abrupt("return");e.next=21;break;case 21:return s=m[m.length-1],u=o||s.extra.commentDrafContext||p.commentDrafContextMap.get(n),l={commentId:n,replyId:a,whole:c,html:i||s.extra.html||"",commentDrafContext:u},e.next=26,f.e.saveDocDraft({id:p.drafCommentId,token:p.token,content:r||s.content||"",updateTime:(new Date).getTime(),extra:l});case 26:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),this.getHasDocDraft=o()(d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.activeDocDraft)return e.abrupt("return",!0);e.next=2;break;case 2:if(Object(f.d)()){e.next=4;break}return e.abrupt("return",!1);case 4:return e.prev=4,e.next=7,f.e.getDocDraft(p.token);case 7:if((t=e.sent).length<=0)return e.abrupt("return",!1);e.next=10;break;case 10:if(n=t[t.length-1],p.activeDocDraft=n.extra,"string"==typeof p.activeDocDraft&&(p.activeDocDraft=JSON.parse(p.activeDocDraft)),p.activeDocDraft){e.next=15;break}return e.abrupt("return");case 15:return p.activeDocDraft.id=n.id,e.abrupt("return",!0);case 19:return e.prev=19,e.t0=e.catch(4),e.abrupt("return",!1);case 22:case"end":return e.stop()}},e,null,[[4,19]])})),this.handleCommentDraftMount=function(){var n=o()(d.a.mark(function e(t,n){var o,a,r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.isSupportDraft=Object(f.d)(),p.logDevCommentDraft({action:"handleCommentDraftMount",isSupportDraft:p.isSupportDraft}),p.isSupportDraft){e.next=4;break}return e.abrupt("return");case 4:if(p.isHandleCommentDraftMounted=!1,p.activeDocDraft){e.next=16;break}return e.next=8,f.e.getDocDraft(p.token);case 8:if((o=e.sent).length<=0)return e.abrupt("return");e.next=11;break;case 11:if(a=o[o.length-1],p.activeDocDraft=a.extra,p.activeDocDraft){e.next=15;break}return e.abrupt("return");case 15:p.activeDocDraft.id=a.id;case 16:if(p.activeDocDraft.id)return e.next=19,p.deleteDocDraft(p.activeDocDraft.id);e.next=19;break;case 19:if(p.logDevCommentDraft({action:"getActiveDocDraft",haveHtml:!!p.activeDocDraft.html,haveDrafContext:!!p.activeDocDraft.commentDrafContext,haveOnCommentDraftMount:!!t}),p.activeDocDraft.html){e.next=22;break}return e.abrupt("return");case 22:if(p.activeDocDraft.commentDrafContext&&t)return e.next=25,t({commentId:p.activeDocDraft.commentId,commentDraftContext:p.activeDocDraft.commentDrafContext,token:p.token});e.next=30;break;case 25:if(r=e.sent,p.logDevCommentDraft({action:"onCommentDraftMountResult",result:r}),r===m.a.SUCCESS_AND_CHANGE&&p.handleToast(c("draft.comment.change")),r===m.a.VERSION_OUT_OF_BOUNDS||r===m.a.NET_EXCEPTION||r===m.a.FOLLOW_EXCEPTION||r===m.a.COMMENT_MOUNT_EXCEPTION)return e.abrupt("return");e.next=30;break;case 30:p.handleUnusualScene(),p.isHandleCommentDraftMounted=!0,n();case 33:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}}(),this.token=t.token};function p(e){var t=e.token;return new l({token:t})}var h=Object(r.a)(p,function(e){return"".concat(e.token)})}).call(this,g("2vAP"))},cHHt:function(e,i,c){"use strict";(function(e){c.d(i,"a",function(){return r});var t=c("zhgJ"),n=((e("placeholder.body.blank.guide")||"").split("|||"),(e("placeholder.comment.blank.guide")||"").split("|||")),o="commentPlaceHolderGuide";var a="";function r(){if(a)return a;var e=Object(t.f)(o);return 0<e&&e<=n.length&&(a=n[e-1]),a}}).call(this,c("2vAP"))},fJxK:function(e,t,n){"use strict";n.d(t,"a",function(){return c}),n.d(t,"b",function(){return p});var i,c,o,a=n("lwsE"),r=n.n(a),m=n("W8MJ"),s=n.n(m),u=n("7EGn"),l=n("2ACu");(i=i||{}).ClientComment="client_comment",(o=c=c||{}).InputBox="input_box",o.SubmitBox="submit_box",o.CancelSubmit="cancel_submit",o.StartEditComment="start_edit_comment",o.SubmitEdit="submit_edit",o.ClickCommentEdit="submit_edit",o.DeleteComment="delete_comment",o.ReplyComment="reply_comment",o.UpBtn="up_btn",o.DownBtn="down_btn",o.ClickTarget="click_target",o.FinishComment="finish_comment",o.ViewHistory="view_history",o.ShowReactionPanel="show_reaction_panel",o.SelectReaction="select_reaction",o.CancelReaction="cancel_reaction",o.ShowReactionPage="show_reaction_page",o.ShowReactionPanelFull="show_reaction_page_full";var p=function(){function e(){r()(this,e),this.logContext=null}return s()(e,[{key:"setLogContext",value:function(e){this.logContext=e}},{key:"logClientComment",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o="";e!==c.InputBox&&e!==c.SubmitBox&&e!==c.ReplyComment||(o="direct");var a=this.logContext?this.logContext(e,t):{},r=Object.assign({comment_id:Object(u.default)(t,"commentId",null)},n,{},a);Object(l.collectSuiteEvent)(i.ClientComment,Object.assign({action:e},r,{source:r.source||o,comment_type:"part_comment"}))}}]),e}()},fOmz:function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n("o0o1"),i=n.n(o),a=n("lSNA"),c=n.n(a),r=n("yXPU"),m=n.n(r),s=n("lwsE"),u=n.n(s),l=n("W8MJ"),p=n.n(l),d=n("a1gu"),f=n.n(d),h=n("Nsbk"),C=n.n(h),g=n("7W2i"),v=n.n(g),y=n("jp/M"),T=n("7HY0"),b=n("D7h9"),E=n("cyON"),D=b.default.dispatch,_=function(e){function t(e){var r;return u()(this,t),(r=f()(this,C()(t).call(this,e))).fetchComments=function(){var n,a=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return D({type:"COMMENT_SERVICE",COMMENT:(n=m()(i.a.mark(function e(t,n){var o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=c()({type:y.actionTypes.commentData.FETCH_COMMENTS,payload:{}},E.a,{resetWhenSuiteTokenChange:!0}),e.abrupt("return",r.wrapperDispatchAction(t,o,function(){return r.commentService.fetchComments(a)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e,t){return n.apply(this,arguments)}},r.fetchComment=function(a){return D({type:"COMMENT_SERVICE",COMMENT:(n=m()(i.a.mark(function e(t,n){var o;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=c()({type:y.actionTypes.commentData.FETCH_COMMENT,payload:{}},E.a,{resetWhenSuiteTokenChange:!0}),e.abrupt("return",r.wrapperDispatchAction(t,o,function(){return r.commentService.fetchComment(a)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e,t){return n.apply(this,arguments)}var n},r.startNewComment=function(e){return D({type:y.actionTypes.commentData.START_NEW_COMMENT,payload:Object.assign({rootType:r.rootType,rootToken:r.rootToken,subCommentToken:r.subCommentToken},e)})},r.addComment=function(o){return D({type:"COMMENT_SERVICE",COMMENT:(t=m()(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:y.actionTypes.commentData.ADD_COMMENT,payload:{addCommentParams:o}},e.abrupt("return",r.wrapperDispatchAction(t,n,function(){return r.commentService.addComment(o)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e){return t.apply(this,arguments)}var t},r.resolveComment=function(o){return D({type:"COMMENT_SERVICE",COMMENT:(t=m()(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:y.actionTypes.commentData.RESOLVE_COMMENT,payload:{rootToken:r.rootToken}},e.abrupt("return",r.wrapperDispatchAction(t,n,function(){return r.commentService.resolveComment(o)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e){return t.apply(this,arguments)}var t},r.resolveCommentAnimationEnd=function(e){var t=e.commentId;return D({type:y.actionTypes.commentData.RESOLVE_COMMENT_ANIMATION_END,payload:{rootType:r.rootType,rootToken:r.rootToken,subCommentToken:r.subCommentToken,commentId:t}})},r.replyComment=function(o){return D({type:"COMMENT_SERVICE",COMMENT:(t=m()(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:y.actionTypes.commentData.REPLY_COMMENT,payload:{replyCommentParams:o}},e.abrupt("return",r.wrapperDispatchAction(t,n,function(){return r.commentService.replyComment(o)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e){return t.apply(this,arguments)}var t},r.updateComment=function(o){return D({type:"COMMENT_SERVICE",COMMENT:(t=m()(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:y.actionTypes.commentData.UPDATE_COMMENT,payload:{updateCommentParams:o}},e.abrupt("return",r.wrapperDispatchAction(t,n,function(){return r.commentService.updateComment(o)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e){return t.apply(this,arguments)}var t},r.deleteComment=function(o){return D({type:"COMMENT_SERVICE",COMMENT:(t=m()(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:y.actionTypes.commentData.DELETE_COMMENT,payload:{deleteCommentParams:o}},e.abrupt("return",r.wrapperDispatchAction(t,n,function(){return r.commentService.deleteComment(o)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e){return t.apply(this,arguments)}var t},r.reopenComment=function(o){return D({type:"COMMENT_SERVICE",COMMENT:(t=m()(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:y.actionTypes.commentData.REOPEN_COMMENT,payload:{reopenCommentParams:o,rootType:r.rootType,rootToken:r.rootToken,subCommentToken:r.subCommentToken}},e.abrupt("return",r.wrapperDispatchAction(t,n,function(){return r.commentService.reopenComment(o)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e){return t.apply(this,arguments)}var t},r.genReplyId=function(o){return D({type:"COMMENT_SERVICE",COMMENT:(t=m()(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={type:y.actionTypes.commentData.GEN_REPLY_ID,payload:Object.assign({},o)},e.abrupt("return",r.wrapperDispatchAction(t,n,function(){return r.commentService.genReplyId(o)}));case 2:case"end":return e.stop()}},e)})),e)});function e(e){return t.apply(this,arguments)}var t},r.deleteTemplateComment=function(e){var t=e.commentId,n=e.replyId,o=e.type,a=e.oldContent;return D({type:y.actionTypes.commentData.DELETE_TEMPLATE_COMMENT,payload:{commentId:t,replyId:n,type:o,oldContent:a,subCommentToken:r.subCommentToken,rootType:r.rootType,rootToken:r.rootToken}})},r.linkCommentToDoc=function(e){var t=e.commentId,n=e.replyId,o=e.tempReplyId;return D({type:y.actionTypes.commentData.LINK_COMMENT_TO_DOC,payload:{commentId:t,tempReplyId:o,replyId:n,subCommentToken:r.subCommentToken,rootType:r.rootType,rootToken:r.rootToken}})},r.linkCommentToDocOK=function(e){var t=e.commentId,n=e.tempCommentId,o=e.replyId;return D({type:y.actionTypes.commentData.LINK_COMMENT_TO_DOC_OK,payload:{commentId:t,tempCommentId:n,replyId:o,rootType:r.rootType,rootToken:r.rootToken,subCommentToken:r.subCommentToken}})},r.linkCommentToDocError=function(e){var t=e.commentId,n=e.error,o=e.replyId;return D({type:y.actionTypes.commentData.LINK_COMMENT_TO_DOC_ERROR,payload:{commentId:t,replyId:o,error:n,rootType:r.rootType,rootToken:r.rootToken,subCommentToken:r.subCommentToken}})},r.mergeComments=function(e){return D({type:y.actionTypes.commentData.MERGE_COMMENTS,payload:Object.assign({rootToken:r.rootToken,rootType:r.rootType,subCommentToken:r.subCommentToken},e),ADD_USER:function(){return e.entities.users}})},r.commentService.setupCommentRecord(),r}return v()(t,e),p()(t,[{key:"destroyComments",value:function(){this.destroy(),D({type:y.actionTypes.commentPosition.SET_COMMENT_POSITION_DATA,payload:{commentPositions:[],rootToken:this.rootToken,rootType:this.rootType,subCommentToken:this.subCommentToken,isLoaded:!1}}),D({type:y.actionTypes.commentData.RESET_COMMENTS,payload:{rootToken:this.rootToken,rootType:this.rootType,subCommentToken:this.subCommentToken,comments:[]}})}}]),t}(T.a)},hi6O:function(e,t,n){},kOe7:function(e,v,y){"use strict";(function(e){y.d(v,"i",function(){return o}),y.d(v,"f",function(){return r}),y.d(v,"h",function(){return c}),y.d(v,"a",function(){return p}),y.d(v,"c",function(){return d}),y.d(v,"g",function(){return f}),y.d(v,"b",function(){return h}),y.d(v,"e",function(){return C}),y.d(v,"d",function(){return g});var t,n,o,a,r,i,c,m,s=y("lSNA"),u=y.n(s),l=y("QM+C");(a=o=o||{})[a.USER=0]="USER",a[a.DOC=1]="DOC",a[a.FOLDER=2]="FOLDER",a[a.SHEET=3]="SHEET",a[a.SHEET_DOC=4]="SHEET_DOC",a[a.CHAT=5]="CHAT",a[a.GROUP=6]="GROUP",a[a.BLOCK=7]="BLOCK",a[a.BITABLE=8]="BITABLE",a[a.TABLE=9]="TABLE",a[a.INLINE_BLOCK=10]="INLINE_BLOCK",a[a.MINDNOTE=11]="MINDNOTE",a[a.BOX=12]="BOX",a[a.SLIDE=15]="SLIDE",a[a.WIKI=16]="WIKI",(i=r=r||{})[i.DOC=0]="DOC",i[i.DOC_COMMENT=1]="DOC_COMMENT",i[i.SHEET=2]="SHEET",i[i.SHEET_COMMENT=3]="SHEET_COMMENT",i[i.BITABLE=4]="BITABLE",i[i.OPEN_DOC=6]="OPEN_DOC",i[i.BOX_COMMENT=9]="BOX_COMMENT",i[i.MINDNOTE=10]="MINDNOTE",i[i.MINDNOTE_COMMENT=11]="MINDNOTE_COMMENT",(m=c=c||{})[m.LARK=0]="LARK";var p=[o.DOC,o.SHEET,o.BITABLE,o.MINDNOTE,o.BOX,o.SLIDE,o.WIKI],d=(t={},u()(t,o.DOC,l.NUM_FILE_TYPE.DOC),u()(t,o.SHEET,l.NUM_FILE_TYPE.SHEET),u()(t,o.BITABLE,l.NUM_FILE_TYPE.BITABLE),u()(t,o.MINDNOTE,l.NUM_FILE_TYPE.MINDNOTE),u()(t,o.BOX,l.NUM_FILE_TYPE.FILE),u()(t,o.SLIDE,l.NUM_FILE_TYPE.SLIDE),u()(t,o.WIKI,l.NUM_FILE_TYPE.WIKI),t),f=(n={},u()(n,l.NUM_FILE_TYPE.DOC,o.DOC),u()(n,l.NUM_FILE_TYPE.SHEET,o.SHEET),u()(n,l.NUM_FILE_TYPE.BITABLE,o.BITABLE),u()(n,l.NUM_FILE_TYPE.MINDNOTE,o.MINDNOTE),u()(n,l.NUM_FILE_TYPE.FILE,o.BOX),u()(n,l.NUM_FILE_TYPE.SLIDE,o.SLIDE),u()(n,l.NUM_FILE_TYPE.WIKI,o.WIKI),n),h={1:e("etherpad.server_abnormal"),2:e("error.args_error"),3:e("error.object_not_found"),4:e("error.no_permission"),5:e("warn.login_required_tips"),6:e("error.request_timeout")},C=420,g=390}).call(this,y("2vAP"))},ubJt:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n("MXQz"),a=n("toa8"),r=n("kUgE"),i=n("ZGZ5"),c=n("D7h9"),m=n("wOYm"),s=n("wQna"),u=n("3DAz"),l=Object(o.a)(function(){u.a.setRequestMethod(a.d)});function p(e){l();var t=e.suiteType,n=e.suiteToken,o=e.broadcastType,a=s.a.getOrCreate({suiteType:t,suiteToken:n});return new u.a({broadcastType:o,broadcast:a,getSuiteType:function(){return t},getSuiteToken:function(){return n},getLang:r.getLanguage,getUserId:function(){return Object(i.a)(c.default.getState()).get("id")||window.User.id}})}var d=Object(m.a)(p,function(e){return"".concat(e.suiteType,":").concat(e.suiteToken,":").concat(e.broadcastType)})}}]);
//# sourceMappingURL=global-comment.2b6c3964871d516ccf77.js.map