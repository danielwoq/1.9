(this.webpackJsonp=this.webpackJsonp||[]).push([["comment_find_provider"],{D28M:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"p",function(){return s}),n.d(t,"n",function(){return c}),n.d(t,"f",function(){return o}),n.d(t,"g",function(){return u}),n.d(t,"h",function(){return a}),n.d(t,"c",function(){return d}),n.d(t,"q",function(){return l}),n.d(t,"l",function(){return f}),n.d(t,"b",function(){return h}),n.d(t,"o",function(){return v}),n.d(t,"j",function(){return m}),n.d(t,"m",function(){return p}),n.d(t,"k",function(){return g}),n.d(t,"d",function(){return y}),n.d(t,"r",function(){return E}),n.d(t,"i",function(){return x}),n.d(t,"e",function(){return O});var r=n("nVH4");function i(t){for(var e,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.classList?r.forEach(function(e){return t.classList.add(e)}):t.getAttribute&&(e=(t.getAttribute("class")||"").split(" ").filter(function(e){return!r.includes(e)}).concat(r).join(" "),t.setAttribute("class",e))}function s(t){for(var e,n=arguments.length,r=new Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.classList?r.forEach(function(e){return t.classList.remove(e)}):t.getAttribute&&(e=(t.getAttribute("class")||"").split(" ").filter(function(e){return!r.includes(e)}).join(" "),t.setAttribute("class",e))}function c(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelector(e)}function o(e,t){return e.classList?e.classList.contains(t):!!e.getAttribute&&(e.getAttribute("class")||"").split(" ").some(function(e){return e===t})}function u(e,t){return e.classList?Array.from(e.classList).find(function(e){return 0===e.indexOf(t)}):!!e.getAttribute&&(e.getAttribute("class")||"").split(" ").find(function(e){return 0===e.indexOf(t)})}function a(e,t){for(var n=!1,r=0;r<t.length;r++)u(e,t[r])&&(n=!0);return n}function d(e){var t=document.createElement("style");return t.appendChild(document.createTextNode(e)),t}function l(e){var t;!e||(t=e.parentNode)&&t.removeChild(e)}function f(e,t){for(;e;){if(o(e,t))return!0;e=e.parentNode}return!1}function h(e,t){for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function v(e,t){for(;e;){if(o(e,t))return e;e=e.parentNode}return null}function m(e){var t=e.getBoundingClientRect();return 0<=t.top&&0<=t.left&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function p(e){return e.previousElementSibling||e.previousSibling}function g(e){return e.nextElementSibling||e.nextSibling}function y(e,t){if(!e)return null;for(var n=e,r=0;n!==t&&null!==n;){r+=n.offsetTop;var i=n.offsetParent||b(n);if(!(i instanceof HTMLElement))return console.error(i,"is not HTMLElement"),null;n=i}return r}function b(e){return e&&e.classList.contains("ace-line-collapsed")?e.parentNode:null}function E(e,t){var n=y(e,t);null!==n&&(t.scrollTop=n)}function x(e){return!!e.setAttribute}function O(e){return e instanceof HTMLElement&&-1!==e.className.indexOf(r.b)&&e.dataset.magicdomid&&document.getElementById(e.dataset.magicdomid)||e}},"RU+H":function(e,t,n){"use strict";var r=n("RIqP"),i=n.n(r),s=n("lwsE"),c=n.n(s),o=n("W8MJ"),u=n.n(o),a=n("26FU"),d=function(){function e(){c()(this,e),this.servicesSet=new Set,this.newServices$=new a.a([]),this.services$=this.newServices$.asObservable()}return u()(e,[{key:"sortServices",value:function(){return i()(this.servicesSet).sort(function(e,t){return e.constructor.ORDER_VALUE-t.constructor.ORDER_VALUE})}},{key:"register",value:function(e){this.servicesSet.has(e)||(this.servicesSet.add(e),this.newServices$.next(this.sortServices()))}},{key:"unregister",value:function(e){this.servicesSet.has(e)&&(this.servicesSet.delete(e),this.newServices$.next(this.sortServices()))}},{key:"services",get:function(){return this.newServices$.getValue()}}]),e}();t.a=new d},aucw:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n("o0o1"),o=n.n(r),i=n("yXPU"),u=n.n(i),s=n("lwsE"),a=n.n(s),c=n("W8MJ"),d=n.n(c),l=n("Muja"),f=n("D28M");function h(e,t){var n,r=Object(f.d)(e,t);null!=r&&(n=t.offsetHeight,t.scrollTop=Math.max(0,r-n/2))}var v=function(){function n(e,t){a()(this,n),this.selection=e,this.provider=t,this.isDestroyed=!1}function e(){return t.apply(this,arguments)}var t,r,i;function s(){return r.apply(this,arguments)}function c(e){return i.apply(this,arguments)}return d()(n,[{key:"getRenderer",value:function(){var e=this.selection,t=e.commentId,n=e.replyId,r=e.isTranslateContent;return this.provider.getRenderer(t,n,r)}},{key:"highlight",value:(i=u()(o.a.mark(function e(t){var n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isDestroyed)return e.abrupt("return");e.next=2;break;case 2:if(void 0!==t&&(this.selection.isSelected=t),n=this.getRenderer(),t&&!n)return e.next=7,this.waitCommentRendered();e.next=8;break;case 7:n=this.getRenderer();case 8:if(n){e.next=10;break}return e.abrupt("return");case 10:if(this.isDestroyed)return e.abrupt("return");e.next=12;break;case 12:n.highlight(this.selection);case 13:case"end":return e.stop()}},e,this)})),c)},{key:"clearHighlight",value:function(){var e=this.getRenderer();e?e.clearHighlight(this.selection):console.warn("clearHighlight: renderer not found",JSON.stringify(this.selection))}},{key:"waitCommentRendered",value:(r=u()(o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getRenderer())return e.abrupt("return",!0);e.next=3;break;case 3:return n=this.selection.commentId,e.next=6,this.provider.commentBox.waitCommentRendered(n);case 6:return(t=this.getRenderer())||console.warn("waitCommentRendered: renderer not found",JSON.stringify(this.selection)),e.abrupt("return",!!t);case 9:case"end":return e.stop()}},e,this)})),s)},{key:"scrollIntoView",value:(t=u()(o.a.mark(function e(){var t,n,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.waitCommentRendered();case 2:if(t=this.getRenderer()){e.next=5;break}return e.abrupt("return");case 5:try{n=this.provider.commentBox.getScrollContainer(),r=t.element,Object(f.j)(r)||h(r,n)}catch(e){console.error("scrollIntoView: ",e)}case 6:case"end":return e.stop()}},e,this)})),e)},{key:"destroy",value:function(){this.isDestroyed=!0}},{key:"isOnSelection",value:function(e){return Object(l.default)(e,this.selection)}},{key:"getSelectNextTimesAfterReplacement",value:function(){return 0}},{key:"getPosition",value:function(){return{top:0,left:0}}},{key:"isReplaceable",value:function(){return!1}}]),n}()},nVH4:function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return c});var r={RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,ESC:27,BACKSPACE:8,AT:50,A:65,DELETE:46,H:72},i={UP:r.UP,DOWN:r.DOWN,LEFT:r.LEFT,RIGHT:r.RIGHT},s={IMAGE:"POPUP_IMAGE",CARD:"POPUP_CARD",TEXT:"POPUP_TEXT",SHEET:"POPUP_SHEET",BLOCK:"POPUP_BLOCK",TABLE:"POPUP_TABLE",TABLE_CELL:"POPUP_TABLE_CELL",CODE_BLOCK_V2:"CODE_BLOCK_V2",CALLOUT_BLOCK:"CALLOUT_BLOCK"},c="fake-list-number-trigger"},s4kO:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var c=n("S5bw"),o=n("xlPZ");function r(e,t,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,s=new c.a(e,t,r);return function(e){return Object(o.a)(function(){return s},i)(e)}}},v3vQ:function(e,t,n){"use strict";n.r(t);var r=n("a1gu"),i=n.n(r),s=n("Nsbk"),c=n.n(s),o=n("7W2i"),u=n.n(o),a=n("lwsE"),d=n.n(a),l=n("W8MJ"),f=n.n(l),h=n("Gi3i"),v=n("p0Sj"),m=n("67Y/"),p=n("s4kO"),g=n("yGWI"),y=n("K9Ia"),b=n("p0ib"),E=n("F/XL"),x=n("RU+H"),O=n("aucw"),k=n("J4zp"),C=n.n(k),I=n("uQON");function L(e){return e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function w(e){var o={},u=0,a="";return e.map(function(e){var t=e.startIndex,n=e.endIndex,r=e.content,i=t,s=n;e.isAtNode&&(i+=e.head.length,s-=e.tail.length),a+=r;for(var c=i;c<s;c++)o[u]=c,u++}),{newContent:a,textIndexMap:o}}function R(e,t,n){var r,i,s=C()(t,2),c=s[0],o=s[1],u=[];if(n.map(function(e,t){e.startIndex<=c&&(r=t),void 0===i&&e.endIndex>=o&&(i=t)}),void 0===r||void 0===i)return console.error("findBlocksByRange: no results"),[];var a=n[r];if(r===i)return[{startIndex:c,endIndex:o,content:e.slice(c,o)}];var d=Math.min(o,a.endIndex-(a.tail?a.tail.length:0));u.push({startIndex:c,endIndex:d,content:e.slice(c,d)});for(var l,f,h=r+1;h<i;h++){var v=n[h];u.push({startIndex:v.startIndex+(v.head?v.head.length:0),endIndex:v.endIndex-(v.tail?v.tail.length:0),content:v.content})}return r<i&&(f=(l=n[i]).startIndex+(l.head?l.head.length:0),u.push({startIndex:f,endIndex:o,content:e.slice(f,o)})),u}function S(e){var t=e.key,n=e.commentId,r=e.replyId,i=e.content,s=e.isTranslateContent,c=Object(I.d)(i),o=w(c),u=o.newContent,a=o.textIndexMap,d=new RegExp("".concat(L(t)),"gi");d.lastIndex=0;for(var l=[],f=d.exec(u);f&&f[0].length;){var h=f.index,v=h+f[0].length,m=R(i,[a[h],a[v-1]+1],c);l.push({ranges:m,key:t,commentId:n,replyId:r,isSelected:!1,isTranslateContent:!!s}),f=d.exec(u)}return l}var T,D,P=n("7ESD");n.d(t,"AbstractCommentFindProvider",function(){return M}),n.d(t,"CommentFindProvider",function(){return F}),n.d(t,"commentFindProvider",function(){return U}),(D=T=T||{}).DEFAULT="DEFAULT",D.WORKING="WORKING",D.DESTROYED="DESTROYED";var M=function(){function e(){d()(this,e),this.status=T.DEFAULT,this.rendererMap=P.a.rendererMap,this.commentList=[],this.commentMap={}}return f()(e,[{key:"setup",value:function(e,t){this.triggerFindDebounced$=new y.a,this.findDebounced$=this.triggerFindDebounced$.pipe(Object(h.a)(500)),this.triggerFindAsync$=new y.a,this.findAsync$=this.triggerFindAsync$.pipe(),this.commentBox=e,this.translateContentCompare=t,x.a.register(this),this.status=T.WORKING}},{key:"setTranslateContentCompare",value:function(e){this.translateContentCompare=e,this.triggerFindDebounced$.next()}},{key:"setCommentList",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.commentList=e,this.commentList.map(function(e){t.commentMap[e.commentId]=!0}),this.clearFind(),this.triggerFindAsync$.next()}},{key:"triggerFind",value:function(e){this.commentMap[e]&&this.triggerFindDebounced$.next()}},{key:"triggerFindWhenPageChange",value:function(){this.triggerFindAsync$.next()}},{key:"find",value:function(e){var t=this;return 0===e.length?this.clearFind():Object(b.a)(this.findDebounced$,this.findAsync$).pipe(Object(v.a)(void 0),Object(m.map)(function(){return t.findImpl(e)}),Object(p.a)(1),Object(g.a)())}},{key:"findSelectionsFromData",value:function(e){var t=e.translateContent,n=e.commentId,r=e.replyId,i=[],s=Object.assign({},e,{isTranslateContent:!1}),c=this.getRenderer(n,r,!1),o=this.getRenderer(n,r,!0),u=!1;if(c&&c.props.isEdit&&(u=!0),o&&o.props.isEdit&&(u=!0),u)return[];if(!t)return S(s);var a=Object.assign({},e,{content:t,isTranslateContent:!0}),i=i.concat(S(a));return this.translateContentCompare&&(i=i.concat(S(s))),i}},{key:"getRenderer",value:function(e,t,n){return this.rendererMap["".concat(e,"-").concat(t,"-").concat(n)]}},{key:"clearFind",value:function(){var t=this;return this.updateMatches([]),Object.keys(this.rendererMap).map(function(e){t.rendererMap[e].clearHighlight()}),Object(E.a)([])}},{key:"updateMatches",value:function(e){this.prevMatches&&this.prevMatches.map(function(e){e.destroy()}),this.prevMatches=e}},{key:"destroy",value:function(){this.status=T.DESTROYED,x.a.unregister(this),this.triggerFindDebounced$.complete(),this.triggerFindAsync$.complete(),delete this.commentBox}},{key:"replaceWith",value:function(){}},{key:"replaceAllWith",value:function(){}},{key:"getCurrentSelection",value:function(){return null}},{key:"isDestroyed",get:function(){return this.status===T.DESTROYED}}]),e}(),F=function(e){function t(){return d()(this,t),i()(this,c()(t).apply(this,arguments))}return u()(t,e),f()(t,[{key:"createCommentFindMatch",value:function(e){return new O.a(e,this)}},{key:"findImpl",value:function(c){var o=this;if(0===c.length)return[];var u=[];return this.commentList.map(function(e){var t=e.comment_list,s=e.commentId;t.forEach(function(e){var t=e.reply_id,n=e.content,r=e.translate_content,i={key:c,commentId:s,replyId:t,content:n,translateContent:r};o.findSelectionsFromData(i).map(function(e){u.push(o.createCommentFindMatch(e))})})}),this.updateMatches(u),u}}]),t}(M);F.ORDER_VALUE=12;var U=new F}}]);
//# sourceMappingURL=comment_find_provider.9e277682e9848017095c.js.map