(this.webpackJsonp=this.webpackJsonp||[]).push([["block-editorbar"],{iPxp:function(t,e,o){},"jpF+":function(t,e,o){"use strict";o.r(e),o.d(e,"BlockEditbar",function(){return H});var b,n,i=o("lSNA"),c=o.n(i),a=o("o0o1"),r=o.n(a),l=o("yXPU"),s=o.n(l),d=o("lwsE"),u=o.n(d),p=o("W8MJ"),f=o.n(p),h=o("a1gu"),m=o.n(h),k=o("Nsbk"),v=o.n(k),g=o("7W2i"),E=o.n(g),C=o("q1tI"),y=o.n(C),P=o("m/+l"),S=o("ANjH"),x=o("TSYQ"),B=o.n(x),w=o("OX8E"),O=o("i8i4"),I=o("UlbS"),j=o("djbN"),R=(o("iPxp"),o("H6oK")),X=o("SQ87"),W=o("iP/4"),L=8,U=40,T=64,Y=68,D=20;(n=b=b||{})[n.hide=0]="hide",n[n.absolute=1]="absolute",n[n.fixed=2]="fixed";var H=function(t){function e(){var f;return u()(this,e),(f=m()(this,v()(e).apply(this,arguments))).lock=!1,f.state={visible:!1,positionInfo:{originX:0,originY:0,offsetX:0,offsetY:0,transformX:0,transformY:0,scrollTop:0},scrollLeft:0,commands:[],selection:null,isAllowedComment:!1,context:{block:null},fixed:!1,status:b.absolute},f.handleBlockDelete=function(t){f.state.context.block&&f.state.context.block.blockId===t&&(f.state.context.block=null)},f.updateVerticalPosition=function(){var t,e;f.state.visible&&f.state.context.block&&(t=f.props.editor.getOuterContainer().getBoundingClientRect(),"number"==typeof(e=f.state.context.block.mountPoint.firstElementChild.getBoundingClientRect().top-t.top)&&e!==f.state.positionInfo.originY&&f.setState({positionInfo:Object.assign({},f.state.positionInfo,{originY:e})}))},f.handleShowPopupWithComment=function(t){var e,o,n=t.positionInfo,i=t.commands,a=t.selection,r=t.isAllowedComment,l=t.context,s=f.state.context.block,c=l.block,d=b.absolute;f.unbindScrollEvent(),Object(R.isEditbarConfigurable)(c)&&c.editbarPin&&(f.bindScrollEvent(),e=n.originY,o=n.scrollTop,e-(U+L)<o&&(d=b.fixed)),s&&Object(R.isEditbarConfigurable)(s)&&s!==c&&s.onEditbarUnmount&&s.onEditbarUnmount(),f.props.setEmbedAllowComment(r);var u=f.filterCommands(i,r);f.setState({visible:!0,status:d,positionInfo:n,commands:u,selection:a,isAllowedComment:r,context:l})},f.filterCommands=function(t,e){if(e)return t;var o=t.filter(function(t){return t.key!==R.CommonCommandKey.comment});return o.length&&o[o.length-1].key===R.CommonCommandKey.separator&&o.pop(),o},f.handleUpdatePopup=function(t){var e,o,n,i=t.commands,a=t.callerBlockId,r=t.scrollLeft,l=f.props.editor.getOuterContainer().parentElement,s=$(l).find("."+R.BLOCK_EDITBAR_WRAPPER)[0],c=$(s).attr("data-blockId"),d=f.state.context.block,u=f.state.positionInfo,p={};d&&Object(X.j)(d.mountPoint)&&void 0!==r&&("number"==typeof u.offsetXRight?u.offsetXRight=u.offsetXRight-(f.state.scrollLeft-r):u.offsetX=u.offsetX+(f.state.scrollLeft-r),p={positionInfo:u,scrollLeft:r}),d&&Object(R.isEditbarConfigurable)(d)&&f.state.visible&&(d.editbarPin&&b.absolute||!d.editbarPin&&b.fixed)&&(e=b.absolute,f.unbindScrollEvent(),d.editbarPin&&(f.bindScrollEvent(),o=u.originY,n=f.props.editor&&f.props.editor.getScrollTop(),o-(U+L)<(null!==n&&void 0!==n?n:u.scrollTop)&&(e=b.fixed)),p.status=e),f.setState(p),c!==a&&void 0!==a||!i||f.setState({commands:i})},f.handleShowPopup=function(t){f.setVisibleWithLock(!0,t);var e=f.state.context.block;e&&Object(R.isEditbarConfigurable)(e)&&e.editbarPin&&f.bindScrollEvent()},f.handleHidePopup=function(t){f.setVisibleWithLock(!1,t);var e=f.state.context.block;e&&Object(R.isEditbarConfigurable)(e)&&(e.editbarPin&&f.unbindScrollEvent(),e.onEditbarUnmount&&e.onEditbarUnmount())},f.handleScroll=function(){var t,e,o,n=f.state.context.block;n&&(e=(t=n.mountPoint.getBoundingClientRect()).top-f.getNavigatorHeight(),o=b.absolute,e<-t.height+U?o=b.hide:e<U+L&&(o=b.fixed),f.state.status!==o&&(o===b.hide&&(f.props.hideDropdownMenu(),f.props.hideHyperlinkEditor(),f.props.hideFilterMenu()),f.setState({status:o,visible:o!==b.hide})))},f.computePosStyle=function(){var t=f.state,e=t.positionInfo,o=t.status;if(t.context.block){var n,i,a,r,l=e.offsetX,s=e.offsetXRight,c=e.offsetY,d=e.transformX,u=e.transformY,p={};return o===b.absolute?(n=c-L,p=f.computeXStyle({position:"relative",top:n,transform:"translate3d(".concat(d,"%, ").concat(u,"%, 0)")},l,s)):o===b.fixed&&(a=(i=f.props.editor.getOuterContainer().getBoundingClientRect()).left+l+D,r="number"==typeof s?document.documentElement.clientWidth-i.right+s+D:void 0,p=f.computeXStyle({position:"fixed",top:f.getNavigatorHeight(),transform:"translate3d(".concat(d,"%, 0, 0)")},a,r)),p}},f.handleBtnClick=function(t,e){e(t,f.state.selection)},f.dedupCommandKeys=function(t){var o=0,n=new Set;return t.map(function(t){var e;return n.has(t.key)?(e=Object.assign({},t,{key:t.key+o}),o++):e=Object.assign({},t),n.add(t.key),e})},f.getBtn=function(t){var e=t.key,o=t.Icon,n=t.handler,i=t.tooltip,a=f.props.editor.getOuterContainer().parentElement,r=$(a).find("."+R.BLOCK_EDITBAR_WRAPPER)[0].parentElement,l=B()({"block-editbar--btn":!0,"block-editbar--btn-active":t.active}),s=y.a.createElement("li",{className:l,onClick:function(t){f.handleBtnClick(t,n)}},y.a.createElement(o,null));return y.a.createElement("div",{key:e},i?y.a.createElement(I.Tooltip,{title:i,showDelay:200,placement:"top",getContainer:function(){return r}},s):s)},f}function o(t,e){return n.apply(this,arguments)}var n;return E()(e,t),f()(e,[{key:"componentDidMount",value:function(){w.a.on("showBlockEditbarWithComment",this.handleShowPopupWithComment),w.a.on("updateBlockEditbar",this.handleUpdatePopup),w.a.on("showBlockEditbar",this.handleShowPopup),w.a.on("hideBlockEditbar",this.handleHidePopup),w.a.on("deleteBlock",this.handleBlockDelete),this.props.editor&&this.props.editor.on("verticalPositionUpdate",this.updateVerticalPosition)}},{key:"shouldComponentUpdate",value:function(){return!this.lock}},{key:"componentWillUnmount",value:function(){w.a.off("showBlockEditbarWithComment",this.handleShowPopupWithComment),w.a.off("updateBlockEditbar",this.handleUpdatePopup),w.a.off("showBlockEditbar",this.handleShowPopup),w.a.off("hideBlockEditbar",this.handleHidePopup),w.a.off("deleteBlock",this.handleBlockDelete),this.props.editor&&this.props.editor.off("verticalPositionUpdate",this.updateVerticalPosition)}},{key:"setVisibleWithLock",value:(n=s()(r.a.mark(function t(e,o){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==o){t.next=4;break}this.setState({visible:e}),t.next=13;break;case 4:if(o)return t.next=7,this.setState({visible:e});t.next=10;break;case 7:this.lock=!0,t.next=13;break;case 10:return this.lock=!1,t.next=13,this.setState({visible:e});case 13:case"end":return t.stop()}},t,this)})),o)},{key:"bindScrollEvent",value:function(){var t=document.querySelector(".etherpad-container-wrapper");t&&t.addEventListener("scroll",this.handleScroll)}},{key:"unbindScrollEvent",value:function(){var t=document.querySelector(".etherpad-container-wrapper");t&&t.removeEventListener("scroll",this.handleScroll)}},{key:"computeXStyle",value:function(t,e,o){return Object.assign({},t,{},"number"==typeof o?{right:o}:{left:e})}},{key:"render",value:function(){var t=this.state.context.block;if(!t)return null;var e=this.props.editor.getOuterContainer().parentElement,o=$(e).find("."+R.BLOCK_EDITBAR_WRAPPER)[0];if(!o)return null;$(o).attr("data-blockId",t.blockId);var n=o.parentElement,i=this.dedupCommandKeys(this.state.commands).map(this.getBtn),a="block-editbar",r=B()(a,c()({},a+"--hoverable",t&&Object(R.isEditbarConfigurable)(t)&&t.editbarTrigger===R.Trigger.hover));if(!this.state.visible)return null;var l=i.length?this.computePosStyle():{display:"none"},s=y.a.createElement("div",{className:r,style:l},y.a.createElement("ul",null,i));return $(n).css({top:"".concat(this.state.positionInfo.originY,"px")}),Object(O.createPortal)(s,o)}},{key:"getNavigatorHeight",value:function(){return W.a.isLark?Y:T}}]),e}(C.Component);e.default=Object(P.connect)(function(t){return{}},function(t){return Object(S.bindActionCreators)({setEmbedAllowComment:j.f,hideDropdownMenu:j.c,hideHyperlinkEditor:j.e,hideFilterMenu:j.d},t)})(H)}}]);
//# sourceMappingURL=block-editorbar.4b7f0422b648a52243b9.js.map