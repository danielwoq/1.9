(this.webpackJsonp=this.webpackJsonp||[]).push([["commons--suite--suite_for_3rd"],{"/fVd":function(e,t,n){"use strict";n.d(t,"a",function(){return y});var r=n("J4zp"),d=n.n(r),i=n("UXvI"),s=n("kohC"),h=n("AiBH"),a=n("OX8E"),u=n("2ACu"),f=n("tp5K"),o=[h.E.FILE,h.E.SHEET,h.E.MINDNOTE,h.E.BITABLE,h.E.SLIDE,h.E.BOX,h.E.WIKI];function b(){console.error("Instance EmbedObjPermissionManager is not existed")}function c(e){Object(u.default)("page_visit_embed_info_collect",{initially_request_embed_num:e.length})}function l(){var t=!0;return new s.a({onPermissionChange:function(e){t&&(c(e),t=!1);var s=0,o=0;e.forEach(function(e){var t,n,r=e.token,i=e.permission;i&&(t=i.cantRead,n=i.canInvite,t&&++s,n&&++o,y.hasEmbedObj(r)&&(y.cantReadFiles[r]=t,a.a.trigger(h.D,[r,t])))}),(s||o)&&Object(u.default)("page_visit_embed_info_collect",{self_can_not_access_doc_num:s,collaborator_can_not_access_doc_num:o})},onError:function(e){return console.error(e)}})}var p=1e3,m=500,g=500,y={embedObjCountMap:{},cantReadFiles:{},embedObjPermissionManager:null,embedObjMap:{},zoneToLineNodeIdMap:{},waitingIntoBufferMap:new Map,getInstance:function(){return this.embedObjPermissionManager},initEmbedObjMap:function(c){var l=this;this.recreateEmbedObjPermissionManager();var t=new RegExp("^mention-type_(".concat(o.join("|"),")$")),d=c.getMatchedAttributePositionOnSelection(null,function(e){return t.test(e)},{shouldMerge:!1});c.getMatchedAttributePositionOnSelection(null,function(e){return/mention-token/.test(e)},{shouldMerge:!1}).forEach(function(e){var i,t,n,r=e.attrKey,s=e.docPosition,o=s.selEnd,a=s.selStart,u=s.selZone;d.some(function(e){var t=e.attrKey,n=e.docPosition;if(n.selEnd[0]!==o[0]||n.selEnd[1]!==o[1]||n.selStart[0]!==a[0]||n.selStart[1]!==a[1]||n.selZone!==u)return!1;var r=t.split("_")[1];return i=h.v[r],!0}),i&&(t=Object(f.c)(r),l.embedObjCountMap[t]?++l.embedObjCountMap[t]:l.embedObjCountMap[t]=1,n=l.getTitle(a,o,u,c),l.embedObjMap[t]={token:t,type:i,title:n})})},getTitle:function(e,t,n,r){var i=r.selection.flatten([e[0],e[1],n]),s=r.selection.flatten([t[0],t[1],n]);return r.getRep(n).alltext.slice(i,s)},createEmbedObjPermissionManager:function(){this.embedObjPermissionManager||(this.embedObjPermissionManager=l())},destroyEmbedObjPermissionManager:function(){this.embedObjPermissionManager&&(this.embedObjPermissionManager.destroy(),this.embedObjPermissionManager=null,this.embedObjMap={},this.embedObjCountMap={},this.cantReadFiles={},this.addStash={},this.zoneToLineNodeIdMap={},this.waitingIntoBufferMap.clear())},embedObjPermissionManagerUpdateEmbedObjList:Object(i.default)(function(){this.embedObjPermissionManager&&this.embedObjPermissionManager.updateEmbedObjList(Object.values(this.embedObjMap))},g),recreateEmbedObjPermissionManager:function(){this.destroyEmbedObjPermissionManager(),this.createEmbedObjPermissionManager()},hasEmbedObj:function(e){return this.embedObjCountMap[e]&&this.embedObjMap[e]},addEmbedObj:function(e){if(!this.embedObjPermissionManager)return b();var t=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value,a=o.num,u=o.obj,c=u.token,l=u.title;this.hasEmbedObj(c)?(this.embedObjCountMap[c]+=a,this.embedObjMap[c].title!==l&&(this.embedObjMap[c].title=l)):(this.embedObjCountMap[c]=a,this.embedObjMap[c]=u)}}catch(e){n=!0,r=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw r}}},sendEmbedObjsToManager:function(e){var t;this.embedObjPermissionManager&&0<e.length&&(t=Object(f.b)(e).filter(function(e){return!!e}),this.embedObjPermissionManager.addEmbedObjs(t),Object(u.default)("page_visit_embed_info_collect",{total_request_embed_doc_num:t.length}))},debounceSendEmbedObjsToManager:Object(f.a)(function(e){return y.sendEmbedObjsToManager(e)},m,{maxWait:p}),removeEmbedObj:function(e){if(!this.embedObjPermissionManager)return b();var t=[],n=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value,u=a.num,c=a.obj.token;this.embedObjCountMap[c]&&(this.embedObjCountMap[c]-=u,0===this.embedObjCountMap[c]&&(t.push(this.embedObjMap[c]),delete this.embedObjCountMap[c],delete this.embedObjMap[c]))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.embedObjPermissionManager.removeEmbedObjs(t)},addStash:{},addTokenInStash:function(e){var t=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o,a=i.value,u=d()(Object.entries(a)[0],2),c=u[0],l=u[1];this.addStash[c]?this.addStash[c].num+=l:(o={token:c,type:void 0,title:void 0},this.addStash[c]={num:l,obj:o})}}catch(e){n=!0,r=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw r}}},completeInStash:function(e){var t,n=e.token,r=e.type,i=e.title;!1===this.isCompleteInStash(n)&&((t=this.addStash[n].obj).type=r,t.title=i,this.execStashList())},removeFromStash:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value,u=d()(Object.entries(a)[0],2),c=u[0],l=u[1];this.addStash[c]?this.addStash[c].num&&(this.addStash[c].num-=l,0===this.addStash[c].num&&delete this.addStash[c]):this.hasEmbedObj(c)&&t.push({num:l,obj:this.embedObjMap[c]})}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.removeEmbedObj(t)},isEmptyStash:function(){return!Object.keys(this.addStash).length},isCompleteInStash:function(e){return this.addStash[e]?Object.values(this.addStash[e].obj).every(function(e){return void 0!==e}):null},execStashList:function(){var t=this;if(!this.embedObjPermissionManager)return b();var n=[],e=Object.keys(this.addStash);0<e.length&&(e.forEach(function(e){t.isCompleteInStash(e)&&(n.push(t.addStash[e]),delete t.addStash[e])}),this.addEmbedObj(n))},fetchEmbedObjsPerm:function(){this.embedObjPermissionManager&&this.embedObjPermissionManager.fetchEmbedObjsAllPerm()}}},"0X7r":function(e,t,n){"use strict";var r=n("J4zp"),s=n.n(r),i=n("lwsE"),o=n.n(i),a=n("W8MJ"),u=n.n(a),f=n("LrWZ"),b=n("Muja"),c=n("Mpt7"),l=n("D7h9"),d=n("WzBf"),h=n("MUo5"),p=n("5cZX"),m=function(){function e(){o()(this,e),this.instances={}}return u()(e,[{key:"reroll",value:function(e){var t=this.getUserList(e),n=this.selectPermissions(e),r=[],i=!0,s=!1,o=void 0;try{for(var a,u=n.keys()[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;t.has(c)||r.push(c)}}catch(e){s=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}r.length&&l.default.dispatch(Object(h.removeAuthorizedUsers)(e,r))}},{key:"selectPermissions",value:function(e){var t=Object(p.K)(l.default.getState()).getIn([e,"authorizedUsers"]);return t||Object(c.Map)({})}},{key:"getUserList",value:function(e){var t=new Set,n=!0,r=!1,i=void 0;try{for(var s,o=this.instances[e][Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value.getUsers(),u=!0,c=!1,l=void 0;try{for(var d,h=a[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var f=d.value;t.add(f)}}catch(e){c=!0,l=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw l}}}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}},{key:"ensureToken",value:function(e){this.instances[e]||(this.instances[e]=new Set)}},{key:"add",value:function(e,t){this.ensureToken(e),this.instances[e].add(t),this.reroll(e)}},{key:"delete",value:function(e,t){this.ensureToken(e),this.instances[e].delete(t),this.reroll(e)}},{key:"destroyToken",value:function(e){delete this.instances[e]}}]),e}(),g=n("vc5i"),y=n("eL/v"),v=n("IyQe"),O=n("/PhZ"),S=n("o0o1"),E=n.n(S),_=n("yXPU"),T=n.n(_),k=n("2spZ"),j=10,M=new(function(){function e(){o()(this,e),this.fetchingStatus={},this.pendingUserMap=new Map}function t(e,t){return n.apply(this,arguments)}var n;return u()(e,[{key:"addPendingUserList",value:function(e,t,n){var r,i=this.pendingUserMap.get(e);i=i?(r=n.filter(function(e){return!i.includes(e)}),i.concat(r)):n,this.pendingUserMap.set(e,i),this.startFetchUserPerm(e,t)}},{key:"startFetchUserPerm",value:function(e,t){this.fetchingStatus[e]||(this.fetchingStatus[e]=!0,this.fetchUserPerm(e,t))}},{key:"fetchUserPerm",value:(n=T()(E.a.mark(function e(t,n){var r,i;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.pendingUserMap.get(t))&&0!==r.length){e.next=4;break}return this.fetchingStatus[t]=!1,e.abrupt("return");case 4:return i=r.splice(0,j),l.default.dispatch(Object(h.fetchAuthorizedUsers)(t,n,i)),e.next=8,Object(k.c)(1e3);case 8:this.fetchUserPerm(t,n);case 9:case"end":return e.stop()}},e,this)})),t)}]),e}()),P=new m;function C(e){return{token:"PERMISSION_CHANGE_".concat(e),resourceType:"PERMISSION_CHANGE",routeType:"token",routeKey:e}}var w=function(){function i(e){var h=this,t=e.userList,n=e.onPermissionChange,r=e.onError;o()(this,i),this.ready=!1,this.envInfos=null,this.onError=function(){},this.oldPermissions=Object(c.Map)({}),this.oldUserList=new Set,this.handleStoreChangeForNetworkState=function(){var e=Object(y.a)(l.default.getState());e&&!h.isOnline?(h.isOnline=e,h.fetchUserPermissions()):h.isOnline=e},this.handleStoreChangeForPermission=function(){if(h.ready){var e=h.selectPermissions();if(e!==h.oldPermissions||!Object(b.default)(h.userList,h.oldUserList)){var n=h.oldUserList,t=h.oldPermissions.filter(function(e,t){return n.has(t)});h.oldPermissions=e,h.oldUserList=new Set(h.userList);var r={},i=!0,s=!1,o=void 0;try{for(var a,u=h.userList[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value,l=h.userList.has(c)&&e.get(c),d=t.get(c);Object(f.a)(l)&&!Object(f.a)(d)?r[c]=null:(!Object(f.a)(l)&&Object(f.a)(d)||l!==d)&&(r[c]=null!=e.get(c)?e.get(c):null)}}catch(e){s=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}Object.keys(r).length&&h.emitChanges(r)}}else h.checkEnvReady()},this.handleMessage=function(){h.fetchUserPermissions()},this.userList=new Set(t),this.onPermissionChange=n,r&&(this.onError=r),this.unsubscribePermission=l.default.subscribe(this.handleStoreChangeForPermission),this.unsubscribeNetworkState=l.default.subscribe(this.handleStoreChangeForNetworkState),this.isOnline=Object(y.a)(l.default.getState()),this.checkEnvReady()}return u()(i,[{key:"bootstrap",value:function(){var e=this.envInfos.token,t=C(e);d.a.register(t,this.handleMessage),P.add(e,this)}},{key:"checkEnvReady",value:function(){var e=l.default.getState(),t=Object(g.n)(e),n=Object(g.o)(e);Object(f.a)(t)||Object(f.a)(n)||(this.ready=!0,this.envInfos={token:t,suiteType:n},this.bootstrap(),this.fetchUserPermissions())}},{key:"fetchUserPermissions",value:function(e){var t,n,r,i;this.ready&&this.isOnline&&(n=(t=this.envInfos).token,r=t.suiteType,i=e||Array.from(this.userList),M.addPendingUserList(n,r,i))}},{key:"emitChanges",value:function(e){var i=this,t=Object.entries(e).map(function(e){var t=s()(e,2),n=t[0],r=t[1];return{userId:n,permission:null!=r?i.convert(r):null}});this.onPermissionChange(t)}},{key:"convert",value:function(e){return Object(v.permission2Booleans)(e)}},{key:"selectPermissions",value:function(){if(!this.ready)return Object(c.Map)({});var e=this.envInfos.token,t=Object(p.K)(l.default.getState()).getIn([e,"authorizedUsers"]);return t||Object(c.Map)({})}},{key:"updateUserPerm",value:function(e){this.fetchUserPermissions(e)}},{key:"updateUserList",value:function(e){var t=new Set(e);Object(b.default)(this.userList,t)||(this.userList=t,this.fetchUserPermissions())}},{key:"addUsers",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;this.userList.has(a)||(this.userList.add(a),t.push(a))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}0<t.length&&this.fetchUserPermissions(t)}},{key:"fetchUsers",value:function(e){return l.default.dispatch(Object(O.fetchUserDetail)({mentioned_users:e}))}},{key:"removeUsers",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=i.value;this.userList.has(o)&&this.userList.delete(o)}}catch(e){n=!0,r=e}finally{try{t||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"getUsers",value:function(){return Array.from(this.userList)}},{key:"getUserPermissions",value:function(){var e=this.selectPermissions(),t={},n=!0,r=!1,i=void 0;try{for(var s,o=this.userList[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value;t[a]=e.has(a)?this.convert(e.get(a)):null}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}},{key:"getPermissionByUser",value:function(e){var t=this.selectPermissions();return t.has(e)?this.convert(t.get(e)):null}},{key:"destroy",value:function(){var e,t;this.userList.clear(),this.unsubscribePermission&&this.unsubscribePermission(),this.unsubscribeNetworkState&&this.unsubscribeNetworkState(),this.ready&&(t=C(e=this.envInfos.token),d.a.deregister(t,this.handleMessage),P.delete(e,this))}}],[{key:"destroyToken",value:function(e){P.destroyToken(e)}}]),i}();t.b=w},"3aiM":function(e,t,n){},"4c9a":function(e,t,n){"use strict";n.r(t);var r=n("m/+l"),i=n("mszz"),s=n("vc5i"),o=n("5cZX"),a=n("ZSG8"),u=n("G2xZ"),c=n("HvQa"),l=n("djbN"),d=n("jzcD"),h=n("MUo5"),f=n("ZGZ5"),b=n("lwsE"),p=n.n(b),m=n("W8MJ"),g=n.n(m),y=n("a1gu"),v=n.n(y),O=n("Nsbk"),S=n.n(O),E=n("7W2i"),_=n.n(E),T=n("7EGn"),k=n("hbEN"),j=n("q1tI"),M=n.n(j),P=n("Mpt7"),C=n("TSYQ"),w=n.n(C),I=n("ahx2"),R=n("GIL9"),U=n("1GrX"),D=n("oqjh"),N=n("5dbN"),L=n("wQna"),x=n("WzBf"),B=n("xetH"),V=n("/fVd"),W=n("EVj1"),F=n("iP/4"),H=F.a.isInVC&&(F.a.isFeishuRooms||/VC\/\d+\.\d+\.\d+[^ ]* Apollyon\/\d+/.test(navigator.userAgent)),q=H&&"1"===Object(T.default)(Object(W.l)(location.search),"vcWaterMark"),Q=n("2ACu"),z=n("XCCd"),Z=function(e){function t(e){var i;return p()(this,t),(i=v()(this,S()(t).call(this,e))).handleVisibleChange=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.visibilityState,n=i.props.updateSuiteVisibilityState,r=i.state;n(r.currentSuiteToken,r.currentSuiteType,t)},i.state={currentSuiteToken:i.props.currentSuiteToken,currentSuiteType:i.props.currentSuiteType},i}return _()(t,e),g()(t,[{key:"componentDidMount",value:function(){document.addEventListener("visibilitychange",this.handleVisibleChange)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.currentSuiteToken&&this.props.currentSuiteToken!==e.currentSuiteToken&&(this.setState({currentSuiteToken:e.currentSuiteToken,currentSuiteType:e.currentSuiteType}),this.handleVisibleChange(null,"hidden"))}},{key:"componentWillUnmount",value:function(){this.handleVisibleChange(null,"hidden"),document.removeEventListener("visibilitychange",this.handleVisibleChange)}},{key:"render",value:function(){return null}}]),t}(j.Component),K=function(e){return{currentSuiteType:Object(s.o)(e),currentSuiteToken:Object(s.n)(e),isWikiPage:Object(s.E)(e)}},X={updateSuiteVisibilityState:a.y},J=Object(r.connect)(K,X)(Z),Y=n("n/R6"),$="importSuccessTips";function ee(){Y.a.remove($)}var te=function(e){var t=e.title,n=e.content,r=e.containerCls,i=w()("layout-column layout-cross-center",r||"");return j.createElement("div",{className:i},j.createElement("div",{className:"suite-error__title noselect"},t),j.createElement("div",{className:"suite-error__body layout-column layout-cross-center layout-main-center noselect"},n))},ne=n("CnBM"),re=n.n(ne),ie=n("XmSq"),se=re()({loader:function(){return Promise.all([n.e("vendors--suite_not_authorized"),n.e("suite_not_authorized")]).then(n.bind(null,"nqH0"))},loading:function(){return M.a.createElement(ie.b,null)}}),oe=n("zXTK"),ae=n("aXZO"),ue=n("qzrN"),ce=n("521f"),le=n("toa8"),de=n("jp/M"),he=36e5;function fe(e,t,n){le.d.get(de.apiUrls.GET_USER_PERMISSION_ON_SUITE_V3,{params:{token:e,type:t}}).catch(function(e){var t=e.data;t&&t.permission_status_code===de.error.STATUS_CODE.PASSWORD_REQUIRED&&n()})}var be=function(e){"function"==typeof e&&e()},pe=function(n,e){var r=e.interval,t=e.maxCount,i=e.leading,s=e.onStart,o=e.onStop,a=e.onFinish,u=e.debug,c=null,l="number"==typeof t?0:null,d=function(e){u&&console.log("%c[PollingTimer]: "+e,"font-weight: bold;")},h=function(){return null!==l&&l!==t},f=function(){"number"==typeof l&&l++},b=function(){d("cleared"),clearTimeout(c),c=null},p=function e(t){h()?be(a):(t&&d("skip_head_call"),t||(n(),d("cb_called"),f()),c=setTimeout(e,r))},m=function(){return null!==c};return{start:function(e){d("try_start, isRunning: ".concat(m())),m()?console.warn("Polling had already started"):(d("started, leading: ".concat(e)),p(!e&&!i),be(s))},stop:function(){b(),be(o)},isRunning:m}},me=n("RxHm"),ge=n("l8Om"),ye=n("zIjt"),ve=n("PIny"),Oe=n("ywOK"),Se=n("DC6e"),Ee=n("R/2b"),_e=n("E1bk"),Te=n("QM+C"),ke=n("/PhZ"),je=n("uZCM"),Me=n("VmAD"),Pe=n("noJd"),Ce=n("KrGf"),we=n("rLED"),Ie=function(s){var e=s.currentSuiteType,t=s.currentSuiteToken;return Object(j.useEffect)(function(){var e,t,n,r,i;Object(Ce.b)()||(e=s.isDegradedMode,t=s.fetchRecentObjListInBackNav,n=s.fetchRecentWikiInBackNav,r=s.fetchUserLangCorrectionSettings,i=s.fetchUserSettings,e||(Object(N.isUnderWikiIndex)()?n:t)(),!F.a.isOpendoc&&Object(we.D)()&&r(),i())},[]),Object(j.useEffect)(function(){e&&t&&s.fetchObjSettings({obj_type:e,obj_token:t,color:Te.DEFAULT_DARK_WATERMARK_COLOR})},[e,t]),null},Re={fetchRecentObjListInBackNav:ke.fetchRecentObjListInBackNav,fetchRecentWikiInBackNav:je.d,fetchObjSettings:Pe.a,fetchUserLangCorrectionSettings:Me.c,fetchUserSettings:Me.d},Ae=function(e){var t=Object(f.a)(e),n=Object(s.f)(e);return{isDegradedMode:Object(_e.a)(n,t),currentSuiteType:Object(s.o)(e),currentSuiteToken:Object(s.n)(e)}},Ue=Object(r.connect)(Ae,Re)(Ie),De=n("xYHV"),Ne=n("zfY2"),Le=n("C+Is"),xe=n("OX8E"),Be=(n("3aiM"),n("wSsa")),Ve=[I.STATUS_CODE.NOT_FOUND,I.STATUS_CODE.FORBIDDEN,I.STATUS_CODE.NOTE_DELETED],We=function(e){function d(e){var m;p()(this,d),(m=v()(this,S()(d).call(this,e))).setSuiteRenderedIfError=function(){var e=m.props,t=e.setDocRendered,n=e.setSheetRendered,r=m.getOverlayProps(m.state.error);r&&(Oe.c.renderFail(r.type),Object(N.locateRoute)().isDoc&&(t(!0),ce.b.renderDocAllFail()),Object(N.locateRoute)().isSheet&&n(!0))},m.checkPermission=function(){var e=m.props;fe(e.currentSuiteToken,e.currentSuiteType,m.handlePswRequiredError)},m.handlePswRequiredError=function(){m.isPswRequiredError||m.fetchUserPermission()},m.fetchUserPermission=Object(k.default)(function(){var e=m.props,t=e.currentSuiteToken,n=e.currentSuiteType;(0,e.fetchUserPermissionOnSuite)(t,n)},2e3),m.updateStateError=function(e){var t=Object(T.default)(m.state,"error.code");e&&e!==t?m.setState(function(){return{ready:!1,error:{code:e}}}):e||m.setState(function(e){return{ready:!0,error:null}})},m.getErrorFromNextProps=function(e){return P.default.Set([m.collectDeletedErr(e.currentSuite),m.collectSuiteErr(e.currentSuiteError),m.collectPermissionErr(e.userPermissionError)]).filter(function(e){return void 0!==e}).first()},m.collectDeletedErr=function(e){if(!P.default.is(m.props.currentSuite,e)&&e&&e.isDeleted)return I.STATUS_CODE.NOTE_DELETED},m.collectSuiteErr=function(e){if(!P.default.is(m.props.currentSuiteError,e)&&e){var t=e.get("code");return t===I.STATUS_CODE.FAILED?t:void 0}},m.collectPermissionErr=function(e){if(e)return e.get("code")},m.detectIsCommonError=function(e){return Ve.includes(e)},m.onClientVarsReady=function(){m.setState(function(){return{ready:!0,isCurrentSuiteGetReadyOnce:!0,error:null}}),Object(Ce.b)()||(m.deregisterContentVerifyMsg=m.registerContentVerifyMsg())},m.onClientVarsError=function(t){var e=I.STATUS_CODE.NOT_FOUND,n=I.STATUS_CODE.INVALID_PARAMETERS,r=I.STATUS_CODE.FORBIDDEN,i=t.code;i!==e&&i!==n||(i=e),i===r&&Object(ve.d)(t.permission_status_code)&&(i=ve.c),m.setState(function(e){return{error:t}},function(){i===r&&m.props.setUserPermissionError({msg:t.msg,code:i})})},m.handleSetVcWaterMark=function(){return function(e){m.setState({hideWatermark:e})}},m.getInitialErrorFromClientVars=function(){var e=Object(T.default)(window,"DATA.clientVars.data.code");return m.detectIsCommonError(e)?{code:e}:null},m.getRenderContent=function(){var e=m.state.error,t=m.getOverlayProps(e);if(null!==t)return M.a.createElement(U.a,Object.assign({},t));var n={ready:m.state.ready,onClientVarsReady:m.onClientVarsReady,onClientVarsError:m.onClientVarsError,shouldHandOutError:m.detectIsCommonError},r=m.props.children;return"function"==typeof r?r(n):Object(j.cloneElement)(r,n)},m.getOverlayProps=function(e){if(!e)return null;var t=e.code,n=m.props.isOwner,r=Boolean(!1===n&&Object(ve.d)(t)),i=!Object(R.a)(),s=I.STATUS_CODE.NOT_FOUND,o=I.STATUS_CODE.NOTE_DELETED,a=I.STATUS_CODE.FORBIDDEN,u=I.STATUS_CODE.CONNECT_ERROR,c=I.STATUS_CODE.INVALID_PARAMETERS;if((t===s||t===c)&&i)return{type:ue.a.NOT_FOUND};if(t===o)return{type:ue.a.DELETED};if(t===a){if(m.isVerifyFailed){var l=Object(ae.a)(ue.a.IMPORT_VIOLATE_POLICIES),d=l.msg,h=l.msg1;return{type:ue.a.IMPORT_VIOLATE_POLICIES,getContent:function(){return M.a.createElement(te,{title:d,content:h})}}}return m.isPswRequiredError?{type:ue.a.NOT_AUTHORIZED,getContent:function(){return M.a.createElement(oe.a,null)}}:{type:ue.a.NOT_AUTHORIZED,getContent:function(){return M.a.createElement(se,null)}}}if(t.toString()===u&&!m.state.isCurrentSuiteGetReadyOnce)return{type:ue.a.NETWORK_ERROR};if(t===ve.c||r){var f=Object(ae.a)(ue.a.IMPORT_VIOLATE_POLICIES),b=f.msg,p=f.msg1;return{type:ue.a.IMPORT_VIOLATE_POLICIES,getContent:function(){return M.a.createElement(te,{title:b,content:p})}}}return null},m.state={ready:!1,isCurrentSuiteGetReadyOnce:!1,error:m.getInitialErrorFromClientVars(),reported:!1,hideWatermark:!1},null!==m.state.error&&delete window.DATA,Object(Ce.b)()||L.a.getOrCreate({suiteType:e.currentSuiteType,suiteToken:e.currentSuiteToken}),m.pswCheckPollingControl=pe(m.checkPermission,{interval:he});var t=m.pswCheckPollingControl,n=t.start,r=t.stop;return m.handlePswCheckPollingStart=function(){m.state.ready&&n()},m.handleNetWorkChangeWhenPolling=Object(me.a)(m.handlePswCheckPollingStart,r),m.handleVisibilityChangeWhenPolling=Object(ge.a)(m.handlePswCheckPollingStart,r),m}return _()(d,e),g()(d,[{key:"componentDidMount",value:function(){Object(Ce.b)()||(B.a.createUserPermissionManager(),me.b.on(this.handleNetWorkChangeWhenPolling),ge.b.on(this.handleVisibilityChangeWhenPolling)),this.checkAndUpdateBusinessStage(),this.setSuiteRenderedIfError(),H&&this.vcSetWatermarkApiBinding("on")}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateStateError(this.getErrorFromNextProps(e))}},{key:"componentDidUpdate",value:function(e,t){var n,r,i,s,o=e.currentSuiteToken,a=e.currentSuiteType,u=this.props,c=u.currentSuiteType,l=u.currentSuiteToken;o!==l&&c&&l&&(ee(),this.setState({reported:!1,ready:!1,isCurrentSuiteGetReadyOnce:!1}),B.a.destroyUserPermissionManager(),L.a.destroy({suiteType:a,suiteToken:o}),Object(we.s)()&&V.a.recreateEmbedObjPermissionManager(),Object(Ce.b)()||(B.a.createUserPermissionManager(),L.a.getOrCreate({suiteType:c,suiteToken:l}))),!this.state.reported&&null===t.error&&this.state.error&&(r=(n=this.state.error).code,i=n.msg,this.setState({reported:!0}),Object(Q.default)("suite_error_captured",{code:r,msg:i,token:this.props.currentSuiteToken,type:this.props.currentSuiteType})),!t.ready&&this.state.ready&&(d.initialMounted||(d.initialMounted=!0,Object(D.b)({moduleName:"suite",params:{suiteType:this.props.currentSuiteType}})),this.pswCheckPollingControl.start()),t.ready&&!this.state.ready&&this.pswCheckPollingControl.stop(),!/opendoc=true/.test(location.search)||t.error===this.state.error||(s=this.getOverlayProps(this.state.error))&&Object(Ne.sendOpendocEvent)(Le.d.SUITE_STATUS,s.type),this.setSuiteRenderedIfError(),this.checkAndUpdateBusinessStage(),xe.a.trigger(Be.b,[this.state.ready])}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.currentSuiteType,n=e.currentSuiteToken;ee(),L.a.destroy({suiteType:t,suiteToken:n}),B.a.destroyUserPermissionManager(),V.a.destroyEmbedObjPermissionManager(),this.destroyMsgBox(),H&&this.vcSetWatermarkApiBinding("off")}},{key:"checkAndUpdateBusinessStage",value:function(){this.getOverlayProps(this.state.error)&&this.props.updateBusinessStage(Ee.b.Doc,Ee.c.Done)}},{key:"registerContentVerifyMsg",value:function(){var t=this;this.destroyMsgBox();var e={token:"PERMISSION_CHANGE_".concat(this.props.currentSuiteToken),resourceType:"PERMISSION_CHANGE",routeType:"token",routeKey:this.props.currentSuiteToken},n=function(e){e&&t.fetchUserPermission()};return x.a.register(e,n),function(){x.a.deregister(e,n)}}},{key:"vcSetWatermarkApiBinding",value:function(e){xe.a[e]("setVcWaterMark",this.handleSetVcWaterMark)}},{key:"destroyMsgBox",value:function(){"function"==typeof this.deregisterContentVerifyMsg&&this.deregisterContentVerifyMsg()}},{key:"render",value:function(){var e=this.props.isVerificationFailedInOwnerView;return M.a.createElement("div",{className:w()("suite-body flex layout-column",{"verify-fail-in-owner-view":e}),style:this.wrapperStyle},this.getRenderContent(),M.a.createElement(z.default,{style:{visibility:this.shouldHideWaterMark?"hidden":"unset"}}),this.shouldShowLoading&&M.a.createElement(De.a,null),this.shouldReportVisibility&&M.a.createElement(J,null),M.a.createElement(Se.a,{renderWhen:Ee.h,keepalive:!0,renderOnTimeout:!0},M.a.createElement(Ue,null)))}},{key:"shouldShowLoading",get:function(){return!this.state.ready&&null===this.state.error}},{key:"isPswRequiredError",get:function(){var e=this.props.userPermissionError;return e&&I.STATUS_CODE.PASSWORD_REQUIRED===e.getIn(["data","permission_status_code"])}},{key:"isVerifyFailed",get:function(){var e=this.props.userPermissionError,t=e&&e.getIn(["data","permission_status_code"]);return[I.STATUS_CODE.PROMPT_CONTACT_WHEN_VIOLATE_POLICIES,I.STATUS_CODE.PROMPT_MODIFY_WHEN_VIOLATE_POLICIES].includes(t)}},{key:"wrapperStyle",get:function(){var e=this.props.darkWatermarkSettings,t=e.enable,n=e.url;return 1===t&&n?{background:"url(".concat(n,") repeat")}:{}}},{key:"shouldHideWaterMark",get:function(){return this.state.hideWatermark||q||/opendoc=true/.test(location.search)&&Object(ye.e)()}},{key:"shouldReportVisibility",get:function(){return!Object(Ce.b)()}}]),d}(j.Component);We.initialMounted=!1;var Fe=We,He=function(e){var t=Object(d.b)(e).status.translated;return{currentUser:Object(f.a)(e),currentSuite:Object(s.f)(e),currentSuiteType:Object(s.o)(e),currentSuiteToken:Object(s.n)(e),darkWatermarkSettings:Object(i.c)(e),currentSuiteError:Object(i.a)("currentSuite")(e),userPermissionError:Object(i.a)("userPermissionOnSuite")(e),isVerificationFailed:Object(o.f)(e),isOwner:Object(o.F)(e),currentPermission:Object(o.j)(e),otherPermissions:Object(o.u)(e),isVerificationFailedInOwnerView:Object(o.g)(e),enterTransMode:t}},Ge={updateSuiteVisibilityState:a.y,setDocRendered:u.e,updateBusinessStage:c.c,setSheetRendered:l.g,fetchUserPermissionOnSuite:h.fetchUserPermissionOnSuite,setUserPermissionError:h.setUserPermissionError},qe=Object(r.connect)(He,Ge)(Fe);n.d(t,"ISuiteInjectProps",function(){});t.default=qe},"5f2W":function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={owner:null,userPermissions:0,permission:0,ownersWithPerm:[],ownersWithoutPerm:[]}},BLac:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(global){var codePointAt;__webpack_require__.d(__webpack_exports__,"a",function(){return CanvasWM}),__webpack_require__.d(__webpack_exports__,"b",function(){return SvgWM}),__webpack_require__.d(__webpack_exports__,"c",function(){return WatermarkType}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{configurable:!0,value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n},writable:!0}),"function"!=typeof String.prototype.codePointAt&&(codePointAt=function(e){if(null===this)throw TypeError();var t=String(this),n=t.length,r=e?Number(e):0;if(r!=r&&(r=0),!(r<0||n<=r)){var i,s=t.charCodeAt(r);return 55296<=s&&s<=56319&&r+1<n&&56320<=(i=t.charCodeAt(r+1))&&i<=57343?1024*(s-55296)+i-56320+65536:s}},Object.defineProperty(String.prototype,"codePointAt",{configurable:!0,value:codePointAt,writable:!0}));var _extendStatics=function(e,t){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function __extends(e,t){function n(){this.constructor=e}_extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function __awaiter(s,o,a,u){return new(a=a||Promise)(function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(n,r)}i((u=u.apply(s,o||[])).next())})}function __generator(e,n){var r,i,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function a(t){return function(e){return u([t,e])}}function u(t){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return o.label++,{value:t[1],done:!1};case 5:o.label++,i=t[1],t=[0];continue;case 7:t=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){o=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){o.label=t[1];break}if(6===t[0]&&o.label<s[1]){o.label=s[1],s=t;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(t);break}s[2]&&o.ops.pop(),o.trys.pop();continue}t=n.call(e,o)}catch(e){t=[6,e],i=0}finally{r=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}var BaseWM=(Pl.prototype.contentWidth=function(e){var t=this.getActualLength(e),n=this.options;return t*n.fontSize/2+n.gap},Pl.prototype.getActualLength=function(e){for(var t=0,n=0,r=e;n<r.length;n++)256<=r[n].codePointAt(0)?t+=2:t+=1;return t},Pl);function Pl(e){this.DefaultFontFamily="'PingFang SC', 'Microsoft YaHei',\n  'Helvetica Neue', Helvetica, Arial, sans-serif",this.options=e,this.options.color=this.options.color||"rgba(0, 0, 0, .07)",this.options.fontSize=this.options.fontSize||16,this.options.fontWeight=this.options.fontWeight||"normal",this.options.fontFamily=this.options.fontFamily||this.DefaultFontFamily,this.options.invisibleColor=this.options.invisibleColor||"transparent",this.options.rotate=this.options.rotate||-20,this.options.gap=this.options.gap||120}var CanvasWM=(am=BaseWM,__extends(bm,am),bm.prototype.toDataURI=function(e){var t=this.getActualLength(e),n=this.options,r=n.color,i=n.fontFamily,s=n.fontSize,o=n.fontWeight,a=n.gap,u=n.rotate,c=t*s/2+a,l=document.createElement("canvas");l.setAttribute("width",c+"px"),l.setAttribute("height",c+"px");var d=l.getContext("2d");return d.translate(c/2,c/2),d.rotate(u*Math.PI/180),d.fillStyle="transparent",d.fillRect(0,0,c,c),d.translate(-c/2,-c/2),d.fillStyle=""+r,d.textBaseline="middle",d.textAlign="center",d.font=o+" "+s+"px  "+i,d.fillText(e,c/2,c/2),l.toDataURL()},bm.prototype.genStyle=function(e){var t=this.toDataURI(e),n=this.getActualLength(e),r=this.options,i=n*r.fontSize/2+r.gap;return"\n      background-image: url("+t+"), url("+t+");\n      background-repeat: repeat, repeat;\n      background-position: "+i/2+"px "+i/2+"px, 0 0;\n    "},bm),am;function bm(){return null!==am&&am.apply(this,arguments)||this}var commonjsGlobal="undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var base64=createCommonjsModule(function(module,exports){var xm,ym;xm="undefined"!=typeof self?self:"undefined"!=typeof window?window:commonjsGlobal,ym=function(global){var _Base64=global.Base64,version="2.4.9",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(err){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e.charAt(n)]=n;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?fromCharCode(192|t>>>6)+fromCharCode(128|63&t):fromCharCode(224|t>>>12&15)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return fromCharCode(240|t>>>18&7)+fromCharCode(128|t>>>12&63)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(re_utob,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(1<e.length?e.charCodeAt(1):0)<<8|(2<e.length?e.charCodeAt(2):0);return[b64chars.charAt(n>>>18),b64chars.charAt(n>>>12&63),2<=t?"=":b64chars.charAt(n>>>6&63),1<=t?"=":b64chars.charAt(63&n)].join("")},btoa=global.btoa?function(e){return global.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e)).toString("base64")}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e)).toString("base64")}:function(e){return btoa(utob(e))},encode=function(e,t){return t?_encode(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):_encode(String(e))},encodeURI=function(e){return encode(e,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return fromCharCode(55296+(t>>>10))+fromCharCode(56320+(1023&t));case 3:return fromCharCode((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return fromCharCode((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(re_btou,cb_btou)},cb_decode=function(e){var t=e.length,n=t%4,r=(0<t?b64tab[e.charAt(0)]<<18:0)|(1<t?b64tab[e.charAt(1)]<<12:0)|(2<t?b64tab[e.charAt(2)]<<6:0)|(3<t?b64tab[e.charAt(3)]:0),i=[fromCharCode(r>>>16),fromCharCode(r>>>8&255),fromCharCode(255&r)];return i.length-=[0,0,2,1][n],i.join("")},atob=global.atob?function(e){return global.atob(e)}:function(e){return e.replace(/[\s\S]{1,4}/g,cb_decode)},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e,"base64")).toString()}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e,"base64")).toString()}:function(e){return btou(atob(e))},decode=function(e){return _decode(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var e=global.Base64;return global.Base64=_Base64,e},noEnum;return global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"==typeof Object.defineProperty&&(noEnum=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}},global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(e){return encode(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}),global.Meteor&&(Base64=global.Base64),module.exports&&(module.exports.Base64=global.Base64),{Base64:global.Base64}},module.exports=ym(xm)}),base64_1=base64.Base64,SvgWM=(wn=BaseWM,__extends(xn,wn),xn.prototype.toDataURI=function(e){var t=this.getActualLength(e),n=this.options,r=n.color,i=n.fontFamily,s=n.fontSize,o=n.fontWeight,a=t*s/2+n.gap,u='\n      <svg xmlns="http://www.w3.org/2000/svg"\n        width="'+a+'" height="'+a+'"\n        style="transform: rotate('+n.rotate+'deg); transform-origin: 50% 50%;">\n          <text xmlns="http://www.w3.org/2000/svg"\n            x="50%" y="50%" text-anchor="middle" alignment-baseline="middle"\n            fill="'+r+'"\n            font-weight="'+o+'"\n            style="font-size: '+s+'px;"\n            font-family="'+i+'">\n              '+e+"\n          </text>\n      </svg>\n    ";return"data:image/svg+xml;base64,"+base64_1.encode(u)},xn.prototype.genStyle=function(e){var t=this.toDataURI(e),n=this.getActualLength(e),r=this.options,i=n*r.fontSize/2+r.gap;return"\n      background-image: url("+t+"), url("+t+");\n      background-repeat: repeat, repeat;\n      background-position: "+i/2+"px "+i/2+"px, 0 0;\n    "},xn),wn,WatermarkType,mo;function xn(){return null!==wn&&wn.apply(this,arguments)||this}function observeSelector(i,s){if(i){var e={attributes:!0,childList:!0,subtree:!0},o=i.cloneNode(!0),a=i.parentNode||document.body,t=new MutationObserver(function(e){i&&e.forEach(function(e){var t,n=e.target,r=Array.prototype.slice.call(e.removedNodes)[0];n===i?(t=o.cloneNode(!0),a.replaceChild(t,i),i=t,"function"==typeof s&&s()):r===i&&(i=i.cloneNode(!0),a.appendChild(i),"function"==typeof s&&s())})});return t.observe(document.body,e),function(){return t.disconnect()}}}function loadjs(e){var n=document.getElementsByTagName("head").item(0),r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",e),new Promise(function(e,t){n?(n.appendChild(r),r.onload=function(){e()},r.onerror=function(){t("mutationobserver pkg load error")}):t("head empty")})}function watermarkObserver(n,r){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:if(!(t=document.querySelector(n)))return[3,6];if(t.removeAttribute("class"),"undefined"!=typeof MutationObserver)return[3,5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,loadjs("//unpkg.pstatp.com/mutationobserver-shim/0.3.3/dist/mutationobserver.min.js")];case 2:return e.sent(),[2,observeSelector(t,r)];case 3:return e.sent(),[3,4];case 4:return[3,6];case 5:return[2,observeSelector(t,r)];case 6:return[2]}})})}mo=WatermarkType=WatermarkType||{},mo.SVG="svg",mo.CanvasWM="canvas";var Watermark=(no.prototype.update=function(e,t){if(void 0===t&&(t={}),this.destroy(),this.text=e,this.options=Object.assign(this.options,t),!this.text)throw new Error("水印文字不能为空");this.options.selector=this.options.selector||".watermark",this.options.type=this.options.type||WatermarkType.CanvasWM;var n=this.options,r=n.type,i=n.inline,s=null;switch(r){case WatermarkType.SVG:s=new SvgWM(this.options);break;case WatermarkType.CanvasWM:s=new CanvasWM(this.options)}var o=s.genStyle(e);i?this.addInlineStyle(o):this.addStyleElement(o)},no.prototype.freeze=function(e){return watermarkObserver(this.options.selector,e)},no.prototype.destroy=function(){var e,t;this.options&&(e=this.options.selector,null!==(t=document.getElementById(e))&&document.head.removeChild(t))},no.prototype.addInlineStyle=function(n){var e=document.querySelectorAll(this.options.selector);Array.prototype.slice.call(e).forEach(function(e){var t=e.getAttribute("style");null===t?e.setAttribute("style",n):t.lastIndexOf(";")===t.length-1?e.setAttribute("style",""+t+n):e.setAttribute("style",t+";"+n)})},no.prototype.addStyleElement=function(e){var t=this.options.selector,n=document.createElement("style");n.type="text/css",n.innerHTML=t+" { "+e+" }",n.id=t,document.head.appendChild(n)},no);function no(e,t){void 0===t&&(t={}),this.text=e,this.options=t,this.update(e,t)}var index=function(e,t){return void 0===t&&(t={}),new Watermark(e,t)};__webpack_exports__.d=index}).call(this,__webpack_require__("yLpj"))},E1bk:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r,i,s=n("7EGn"),o=n("5dbN"),a=n("VI6H");(i=r=r||{}).NOT_DEGRADED="0",i.DEGRADED="1";var u=Object(s.default)(window,"User.tenantDegrade")===r.DEGRADED;function c(e,t){if(!u||!e||!t)return!1;if(!Object(o.locateRoute)().isFile)return!1;var n=e.get("owner_id");return!Object(a.t)(t,n)}},EGiY:function(e,t,n){e.exports={watermark:"_3K2NEN-3OMd-r0cfD5r0Ov","pdf-watermark":"_2nP8VwRwyc52IIX_quzx5x"}},G2xZ:function(e,t,n){"use strict";n.d(t,"d",function(){return s}),n.d(t,"b",function(){return o}),n.d(t,"f",function(){return a}),n.d(t,"a",function(){return u}),n.d(t,"h",function(){return c}),n.d(t,"c",function(){return l}),n.d(t,"g",function(){return d}),n.d(t,"i",function(){return h}),n.d(t,"e",function(){return f});n("lSNA"),n("7EGn"),n("QM+C");var r=n("IQB2"),i=(n("GGX4"),n("b9hN")),s=function(e){return{type:i.a.SET_CLIENT_VARS,payload:e}},o=function(){return{type:i.a.RESET_CLIENT_VARS}},a=function(e){var t=e.editorUniqueId;return r.a.set(t,e),{type:i.a.SET_EDITOR,payload:t}},u=function(e){return r.a.delete(e),{type:i.a.DESTROY_EDITOR}},c=function(e){return{type:i.a.SET_TITLE_BLANK,payload:e}},l=function(e){return{type:i.a.SET_BODY_BLANK,payload:e}},d=function(e){return{type:i.a.SET_TITLE_AND_BODY_BLANK,payload:e}},h=function(e){return{type:i.a.TOGGLE_FULLSCREEN,payload:e}},f=function(e){return{type:i.a.SET_RENDERED,payload:e}}},HjLD:function(e,t,n){"use strict";var r,i;n.d(t,"a",function(){return r}),(i=r=r||{}).Readable="readable",i.Editable="editable"},Thla:function(e,t,n){"use strict";var r=n("lSNA"),i=n.n(r),s=n("lwsE"),o=n.n(s),a=n("W8MJ"),u=n.n(a),c=n("a1gu"),l=n.n(c),d=n("Nsbk"),h=n.n(d),f=n("7W2i"),b=n.n(f),p=n("Muja"),m=n("fp5s"),g=n("hMnB"),y=n.n(g),v=n("q1tI"),O=n.n(v),S=(n("17x9"),n("TSYQ")),E=n.n(S),_=n("BLac"),T=n("Zfr0"),k=function(){function r(e,t,n){o()(this,r),this.selector="."+e,this.options=Object.assign({},r.defaultOptions,{},n),this.wm=Object(_.d)(t,Object.assign({},this.options,{type:Object(T.getWatermarkType)(),selector:this.selector}))}return u()(r,[{key:"update",value:function(e,t){this.options=Object.assign({},this.options,{},t),this.wm.update(e,Object.assign({},this.options,{type:Object(T.getWatermarkType)(),selector:this.selector}))}},{key:"destroy",value:function(){this.wm.destroy()}}]),r}();k.defaultOptions=Object(T.getDefaultWatermarkOptions)();var j=n("EGiY"),M=n.n(j),P=n("VI6H"),C=n("QM+C");n.d(t,"a",function(){return w});var w="TIAWBFTROSIDWYKTTIAW";function I(e){var t=Object(P.o)(e.id,e.name);return Object(T.getMark)({name:t,mobile:e.mobile,email:e.email})}function R(){var e=new URLSearchParams(y.a.search),t=e.get("name")||"",n=e.get("mobile")||"",r=e.get("email")||"";return Object(T.getMark)({name:t,mobile:n,email:r})}var U=function(e){function n(e){var t;return o()(this,n),(t=l()(this,h()(n).call(this,e))).wm=null,t.destroyWatermark=function(){t.wm&&(t.removeSSRHandler&&cancelAnimationFrame(t.removeSSRHandler),t.wm.destroy())},t.removeSSRWatermark=function(){var e=document.querySelector(".ssrWaterMark"),t=document.querySelector("#watermarkSSRStyle");e&&e.remove(),t&&t.remove()},t.token=w+Object(m.a)(),t}return b()(n,e),u()(n,[{key:"componentDidMount",value:function(){this.isVisible()&&this.renderWatermark(this.watermarkText,this.props.watermarkOptions)}},{key:"shouldComponentUpdate",value:function(e){return this.props.user.id!==e.user.id||!Object(p.default)(this.props.style,e.style)||this.props.settings.enable_watermark!==e.settings.enable_watermark||!Object(p.default)(this.props.watermarkOptions,e.watermarkOptions)}},{key:"componentDidUpdate",value:function(e){this.isVisible()?this.renderWatermark(this.watermarkText,this.props.watermarkOptions):this.destroyWatermark()}},{key:"componentWillUnmount",value:function(){this.destroyWatermark()}},{key:"componentDidCatch",value:function(e){console.error(e)}},{key:"isVisible",value:function(){return Object(T.isRenderWatermark)(this.props.settings.enable_watermark)}},{key:"renderWatermark",value:function(e,t){this.wm?this.wm.update(e,t):(this.wm=new k(this.token,e,t),this.removeSSRHandler=requestAnimationFrame(this.removeSSRWatermark))}},{key:"render",value:function(){if(this.isVisible()){var e,t=this.props.style,n=E()(this.token,(e={},i()(e,M.a.watermark,!C.isPDFAccess),i()(e,M.a["pdf-watermark"],C.isPDFAccess),e));return O.a.createElement("div",{className:n,style:t})}return null}},{key:"watermarkText",get:function(){var e=this.props.user;return C.isPDFAccess?R():I(e)}}]),n}(O.a.Component);U.defaultProps={style:{},watermarkOptions:{}};t.b=U},Vfrr:function(e,t,n){"use strict";n.d(t,"a",function(){return S});var f,r,b,i,u=n("xpYl");(r=f=f||{}).POST="post",r.GET="get",(i=b=b||{}).InitData="InitData",i.Broadcast="Broadcast",i.VersionBreak="VersionBreak";var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function p(e,o,n,a){function u(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n=n||Promise)(function(t,n){function r(e){try{s(a.next(e))}catch(e){n(e)}}function i(e){try{s(a.throw(e))}catch(e){n(e)}}function s(e){e.done?t(e.value):u(e.value).then(r,i)}s((a=a.apply(e,o||[])).next())})}function m(e,n){var r,i,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function a(t){return function(e){return u([t,e])}}function u(t){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(s=2&t[0]?i.return:t[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,t[1])).done)return s;switch(i=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return o.label++,{value:t[1],done:!1};case 5:o.label++,i=t[1],t=[0];continue;case 7:t=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){o=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){o.label=t[1];break}if(6===t[0]&&o.label<s[1]){o.label=s[1],s=t;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(t);break}s[2]&&o.ops.pop(),o.trys.pop();continue}t=n.call(e,o)}catch(e){t=[6,e],i=0}finally{r=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}}function d(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function g(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}var y="BROADCAST",a="/api/broadcast",h=a+"/get_range_message/",v=a+"/get_init_data/",c=2,l=(O.prototype.sendMessage=function(e,t){var n=this.entity,r=n.type,i=n.token,s={type:r,data:o({type:e,token:i},t),version:c};return this.io.request(s)},O.prototype.addHeartbeat=function(e,t){var n;this.registeredId?this.io.updateEntityObserver(this.entity,this.registeredId,{heartbeats:((n={})[""+e]=t,n)}):this.registHbQueue.push({name:e,options:t})},O.prototype.removeHeartbeat=function(e){this.io.removeHeartbeat(this.entity,e)},O.prototype.setHeartbeatVersion=function(e,t){this.io.setHeartbeatVersion(this.entity,e,t)},O.prototype.destroy=function(){this.registeredId&&this.io.unregisterEntityObserver(this.entity,this.registeredId),this.registeredId="",this.registHbQueue=[]},O);function O(e,t,n){var r=this;this.handleMessageQueue=[],this.registeredId="",this.registHbQueue=[],this.handleMessageFromServer=function(t){r.handleMessageQueue.forEach(function(e){return e(t)})},this.onHandlerMessageFromServer=function(e){r.handleMessageQueue.push(e)},this.offHandlerMessageFromServer=function(t){r.handleMessageQueue=r.handleMessageQueue.filter(function(e){return!(e===t)})},this.io=n,this.entity={type:e,token:t};var i=this.io.registerEntityObserver(this.entity,{heartbeats:{},messageHandler:this.handleMessageFromServer});i.then?i.then(function(e){r.registeredId=e,r.registHbQueue.forEach(function(e){var t=e.name,n=e.options;r.addHeartbeat(t,n)})}):this.registeredId=i}var S=(E.prototype.getHeartbeatEntity=function(e){return"broadcast_"+e.toLowerCase()},E.prototype.getBroadcastEntity=function(e){return e.toUpperCase()},E.prototype.unregister=function(e,t){var n=e.toUpperCase();t||this.versionManager.delete(n);var r=this.messageModuleHandlerManager.get(n);r&&this.syncClient.offHandlerMessageFromServer(r),this.messageModuleHandlerManager.delete(n),this.messageHandleManager.delete(n);var i=this.getHeartbeatEntity(n);this.syncClient.removeHeartbeat(i)},E.prototype.fetchClientVars=function(h){return p(this,void 0,void 0,function(){var t,n,r,i,s,o,a,u,c,l,d=this;return m(this,function(e){switch(e.label){case 0:return h=this.getBroadcastEntity(h),this.pendingFetchStatus.set(h,!0),[4,this.request({url:v,method:f.GET,params:{obj_type:this.serviceType,obj_token:this.serviceToken,data_type:h}}).finally(function(){d.pendingFetchStatus.set(h,!1)})];case 1:return t=e.sent(),n=t.ahead_version,r=t.behind_version,i=t.data,s=this.pendingFetchNewVersion.get(h)||0,this.logger&&this.logger.logInitVersion({aheadVersion:n,behindVersion:r,token:this.serviceToken,source:b.InitData,module:h}),o=Math.max(r,s),this.pendingFetchNewVersion.delete(h),a=[i],n===o?[3,3]:[4,this.fetchMissMessage(h,n,o)];case 2:u=e.sent().messages,c=this.handleRemoteMessage(u),u.push.apply(u,g(c)),e.label=3;case 3:return this.updateVersion(h,n),(l=this.messageHandleManager.get(h))&&l(a),[2,t]}})})},E.prototype.setupRequest=function(e){this.requestMethod=e},E.prototype.setupLogger=function(e){this.logger=e},E.prototype.updateVersion=function(e,t){var n,r=this.versionManager.get(e);void 0!==r&&r<t&&(this.versionManager.set(e,t),n=this.getHeartbeatEntity(e),this.syncClient.setHeartbeatVersion(n,t))},E.prototype.fetchMissMessage=function(a,u,c,l){return void 0===l&&(l=0),p(this,void 0,void 0,function(){var t,n,r,i,s,o;return m(this,function(e){switch(e.label){case 0:return 100<l?[2,{messages:[]}]:[4,this.request({url:h,method:f.GET,params:{obj_type:this.serviceType,obj_token:this.serviceToken,data_type:a,min_version:u,max_version:c}})];case 1:return(t=e.sent(),n=t.max_version,r=t.messages,t.has_more)?(i=l+1,[4,this.fetchMissMessage(a,n,c,i)]):[3,3];case 2:s=e.sent(),o=s.messages,t.messages=[].concat(r,o),e.label=3;case 3:return[2,t]}})})},E.prototype.request=function(n){return p(this,void 0,void 0,function(){var t;return m(this,function(e){switch(e.label){case 0:if(!this.requestMethod)throw new Error("no request method found");return this.getMemberId&&(t={memberId:this.getMemberId()},n.headers&&(t=o(o({},n.headers),t)),n.headers=t),[4,this.requestMethod(n)];case 1:return[2,e.sent().data]}})})},E.prototype.handleRemoteMessage=function(e){return e.map(function(e){return e.data})},E.prototype.destroy=function(){var t,e,n,r;this.pendingFetchNewVersion.clear(),this.pendingFetchStatus.clear(),this.messageHandleManager.clear(),this.versionManager.clear(),this.messageModuleHandlerManager.clear(),this.syncClient.destroy();try{for(var i=d(this.versionManager.keys()),s=i.next();!s.done;s=i.next()){var o=s.value,a=this.getHeartbeatEntity(o);this.syncClient.removeHeartbeat(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}try{for(var u=d(this.messageModuleHandlerManager.values()),c=u.next();!c.done;c=u.next()){var l=c.value;this.syncClient.offHandlerMessageFromServer(l)}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}},E);function E(e){var o=this;this.requestMethod=null,this.logger=null,this.messageHandleManager=new Map,this.messageModuleHandlerManager=new Map,this.versionManager=new Map,this.pendingFetchStatus=new Map,this.pendingFetchNewVersion=new Map,this.register=function(e,t,n){var r=e.toUpperCase(),i=o.getHeartbeatEntity(r);n||o.versionManager.set(r,0);var s=Object(u.a)(o.handleMessageFromServer,r);o.messageModuleHandlerManager.set(r,s),o.messageHandleManager.set(r,t),o.syncClient.onHandlerMessageFromServer(s),o.syncClient.addHeartbeat(i,{interval:1,callback:Object(u.a)(o.handleMessageVersionBreak,r)})},this.handleMessageFromServer=function(d,h){return p(o,void 0,void 0,function(){var t,n,r,i,s,o,a,u,c,l;return m(this,function(e){switch(e.label){case 0:return(e.trys.push([0,4,,5]),h.data)?h.type!==y?[2]:(t=h.data,(n=t.type)!==d?[2]:t.token!==this.serviceToken||void 0===(r=this.pendingFetchStatus.get(d))?(this.fetchClientVars(d),[2]):void 0!==(i=this.versionManager.get(d))&&(s=this.messageHandleManager.get(d))?(o=t.message,a=o.version,!0===r?(this.pendingFetchNewVersion.set(d,a),[2]):(this.logger&&this.logger.logBroadcastVersion({localVersion:i,remoteVersion:a,source:b.Broadcast,module:d,token:this.serviceToken,message:h}),a<i?(this.fetchClientVars(d),[2]):i+1!==a||t.oversize?[3,1]:(c=this.handleRemoteMessage([o]),s(c),[3,3]))):[2]):[2];case 1:return[4,this.fetchMissMessage(n,i,a)];case 2:u=e.sent(),c=this.handleRemoteMessage(u.messages),s(c),e.label=3;case 3:return this.updateVersion(d,a),[3,5];case 4:return l=e.sent(),console.error(l),[3,5];case 5:return[2]}})})},this.handleMessageVersionBreak=function(a,u){return p(o,void 0,void 0,function(){var t,n,r,i,s,o;return m(this,function(e){switch(e.label){case 0:return void 0===(t=this.versionManager.get(a))?[2]:u<=t||void 0===(n=this.pendingFetchStatus.get(a))?[2]:!0===n?(this.pendingFetchNewVersion.set(a,u),[2]):(this.logger&&this.logger.logVersionBreak({localVersion:t,remoteVersion:u,source:b.VersionBreak,module:a,token:this.serviceToken}),u<t?(this.fetchClientVars(a),[2]):(r=this.messageHandleManager.get(a))?(i=this.getBroadcastEntity(a),[4,this.fetchMissMessage(i,t,u)]):[2]);case 1:return s=e.sent(),o=this.handleRemoteMessage(s.messages),r(o),this.versionManager.set(a,u),[2]}})})};var t=e.serviceType,n=e.serviceToken,r=e.engineType,i=e.io,s=e.getRequest,a=e.getMemberId;this.syncClient=new l(r,n,i),this.serviceType=t,this.serviceToken=n,this.getMemberId=a(),this.requestMethod=s()}_.prototype.getOrCreateBroadcast=function(e){var t=this.broadcastMap.get(e.serviceToken);return t||(t=new S(e),this.broadcastMap.set(e.serviceToken,t)),t},_.prototype.destroyBroadcast=function(e){var t=this.broadcastMap.get(e);t&&t.destroy(),this.broadcastMap.delete(e)};function _(){this.broadcastMap=new Map}},VmAD:function(e,t,n){"use strict";n.d(t,"d",function(){return l}),n.d(t,"h",function(){return d}),n.d(t,"e",function(){return h}),n.d(t,"i",function(){return f}),n.d(t,"a",function(){return b}),n.d(t,"c",function(){return p}),n.d(t,"g",function(){return m}),n.d(t,"b",function(){return g}),n.d(t,"f",function(){return y});var r=n("QILm"),o=n.n(r),i=n("lSNA"),a=n.n(i),u=n("jp/M"),c=n("QM+C"),s=n("VIFs"),l=function(){return a()({type:u.actionTypes.settings.FETCH_USER_SETTING},c.REQUEST,{url:u.apiUrls.GET_USER_PROPERTIES,method:u.apiUrls.METHOD.GET})},d=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=e.permission_type,r=e.allow_share_outside,i=o()(e,["permission_type","allow_share_outside"]),s=t?{ext_properties:{onboarding:e}}:{permission_type:n,properties:Object.assign({},i,{allow_share_outside:Boolean(r)})};return a()({type:u.actionTypes.settings.UPDATE_USER_SETTING,payload:{settings:e}},c.REQUEST,{url:u.apiUrls.POST_UPDATE_USER_PROPERTIES,headers:{"Content-Type":"application/json"},method:u.apiUrls.METHOD.POST,data:s,options:{transformResponse:function(){return Object.assign({},e)}}})},h=function(){return a()({type:u.actionTypes.settings.FETCH_USER_TRANSLATE_SETTING},c.REQUEST,{url:u.apiUrls.GET_USER_TRANSLATE_SETTING,method:u.apiUrls.METHOD.POST})},f=function(e){return a()({type:u.actionTypes.settings.UPDATE_USER_TRANSLATE_SETTING},c.REQUEST,{url:u.apiUrls.POST_UPDATE_USER_TRANSLATE_SETTING,method:u.apiUrls.METHOD.POST,headers:{"Content-Type":"application/json"},data:e})},b=function(){return a()({type:u.actionTypes.settings.FETCH_IS_USER_TRANSLATE_VIP},c.REQUEST,{url:u.apiUrls.GET_IS_USER_TRANSLATE_VIP,method:u.apiUrls.METHOD.POST})},p=function(){return a()({type:u.actionTypes.settings.FETCH_USER_LANG_CORRECTION_SETTING},c.REQUEST,{url:u.apiUrls.LANG_CORRECTION,method:u.apiUrls.METHOD.GET,options:{transformResponse:function(e){return{lang_correction_perm:e.enabled?1:0}}}})},m=function(e){return a()({type:u.actionTypes.settings.UPDATE_USER_LANG_CORRECTION_SETTING},c.REQUEST,{url:u.apiUrls.SET_LANG_CORRECTION,method:u.apiUrls.METHOD.POST,headers:{"Content-Type":"application/json"},data:e,options:{baseURL:Object(s.prependPureAPI)(""),transformResponse:function(){return{lang_correction_perm:e.enable_ai_error_correction?1:0}}}})},g=function(){return a()({type:u.actionTypes.settings.FETCH_SMART_COMPOSE_SETTING},c.REQUEST,{url:u.apiUrls.GET_SMART_COMPOSE_SETTING,method:u.apiUrls.METHOD.POST})},y=function(e){return a()({type:u.actionTypes.settings.FETCH_UPDATE_SMART_COMPOSE_SETTING},c.REQUEST,{url:u.apiUrls.POST_UPDATE_SMART_COMPOSE_SETTING,method:u.apiUrls.METHOD.POST,headers:{"Content-Type":"application/json"},data:{setting:e},options:{transformResponse:function(){return e}}})}},XCCd:function(e,t,n){"use strict";n.r(t);var r=n("ZGZ5"),i=n("m/+l"),s=n("Thla"),o=n("mszz"),a=n("peh1"),u=Object(a.createSelector)(r.a,function(e){return e.toJSON()}),c=function(e){return{user:u(e),settings:Object(o.b)(e)}},l=Object(i.connect)(c,null)(s.b);t.default=l},Zfr0:function(e,t,n){"use strict";n.r(t),n.d(t,"getWatermarkType",function(){return h}),n.d(t,"getMark",function(){return f}),n.d(t,"getAnonymousMark",function(){return b}),n.d(t,"getActualLength",function(){return p}),n.d(t,"isLark",function(){return m}),n.d(t,"isRenderWatermark",function(){return g}),n.d(t,"getWatermarkColor",function(){return y}),n.d(t,"getDefaultWatermarkOptions",function(){return v});var r=n("puQj"),i=n.n(r),s=n("qxQb"),o=n.n(s),a=n("MjSh"),u=n("iP/4"),c=n("BLac"),l=n("7cb0"),d=n("QM+C");function h(){return u.a.isQQ||u.a.is360||u.a.windows?c.c.CanvasWM:c.c.SVG}var f=function(e){var t,n="",r=e.name,i=e.mobile,s=e.email,o="",a="";switch(i&&4<=i.length&&(o=i.substring(i.length-4,i.length)),s&&(a=(t=s.match(/.+(?=@)/))?t[0]:""),!0){case o&&p(r+o)<25:n="".concat(r," ").concat(o);break;case o&&25<=p(r+o):n="".concat(r.substring(0,17),"... ").concat(o);break;case p(r+a)<25:n="".concat(r," ").concat(a);break;case 25<p(r)&&25<p(a):n="".concat(a.substring(0,22),"...");break;case p(r)<=25&&25<p(a):n=r;break;case 25<p(r)&&p(a)<=0:n="".concat(r.substring(0,22),"...");break;default:n=a}return n},b=function(e){var t="",n=e.name,r=e.tenant_name;switch(!0){case p(n+r)<=25:t="".concat(r," ").concat(n);break;case 25<p(n+r):t="".concat(r.substring(0,p(n)),"... ").concat(n);break;default:t="".concat(r," ").concat(n)}return t},p=function(e){for(var t=0,n=0;n<e.length;n++)256<=e[n].codePointAt(0)?t+=2:t+=1;return t};function m(){return/Lark/g.test(navigator.userAgent)}function g(e){return!(void 0===e||!d.isAnonymousAccess&&!d.isPDFAccess)||(m()?!Object(l.b)(l.a.isEnabledNativeWatermark):!(!/\blark=\d/.test(location.search)||m())||void 0!==e&&0!==e)}function y(){return i.a.windows?o()(a.N500,.12):(i.a.mac,o()(a.N500,.1))}function v(){return{fontSize:14,color:y(),gap:148,rotate:-15}}},aXZO:function(e,a,u){"use strict";(function(e){var t,n=u("lSNA"),r=u.n(n),i=u("qzrN"),s=(t={},r()(t,i.a.DELETED,{msg:e("common.docuement_deleted")}),r()(t,i.a.NOT_AUTHORIZED,{msg:e("common.not_permission_access_to_document")}),r()(t,i.a.NOT_FOUND,{msg:e("common.document.not_exist")}),r()(t,i.a.SERVICE_FAILED,{msg:e("etherpad.server_abnormal")}),r()(t,i.a.DEFAULT,{msg:e("error.try_later")}),r()(t,i.a.IMPORT_NOT_RETRY,{msg:e("import.error_not_retry"),msg1:e("import.error_not_retry_contact")}),r()(t,i.a.IMPORT_FORBIDDEN,{msg:e("import.error_forbidden"),msg1:e("import.error_not_retry_contact")}),r()(t,i.a.IMPORT_RETRY,{msg:e("import.error_retry")}),r()(t,i.a.IMPORT_OBJ_SIZE,{msg:e("import.error_obj_size")}),r()(t,i.a.IMPORT_OBJ_TYPE,{msg:e("import.error_obj_type")}),r()(t,i.a.IMPORT_PARAM_ERROR,{msg:e("import.error_obj_error")}),r()(t,i.a.IMPORT_LARK_DOC_ACCOUNT_INCONSISTENT,{msg:e("import.error_lark_doc_account_inconsistent")}),r()(t,i.a.FOLDER_NOT_AUTHORIZED,{msg:e("permission.not_permission_access_to_folder")}),r()(t,i.a.OPEN_DOC_ERROR,{msg:e("open_doc.suite.error")}),r()(t,i.a.IMPORT_VIOLATE_POLICIES,{msg:e("import.error_violate_policies"),msg1:e("import.error_violate_policies_contact")}),r()(t,i.a.IMPORT_EXCEED_LIMIT,{msg:e("common.import_fail_of_create_num_limit"),msg1:e("common.please_pay")}),r()(t,i.a.NETWORK_ERROR,{msg:e("server.error_code_-8")}),t),o=function(e){return s[e]};a.a=o}).call(this,u("2vAP"))},kohC:function(e,t,n){"use strict";var r=n("o0o1"),b=n.n(r),i=n("yXPU"),s=n.n(i),o=n("lwsE"),a=n.n(o),u=n("W8MJ"),c=n.n(u),m=n("LrWZ"),g=n("Muja"),l=n("Mpt7"),y=n("D7h9"),p=n("MUo5"),d=n("5cZX"),h=n("eL/v"),f=n("vc5i"),v=n("IyQe"),O=n("2spZ"),S=10,E=new(function(){function e(){a()(this,e),this.instances={}}return c()(e,[{key:"reroll",value:function(e){var t=this.getEmbedObjMap(e),n=Object(d.K)(y.default.getState()).getIn([e,"embedObjects"]),r=[];if(n){var i=!0,s=!1,o=void 0;try{for(var a,u=n.keys()[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c=a.value;t[c]||r.push(c)}}catch(e){s=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}0<r.length&&y.default.dispatch(Object(p.removeEmbedObjects)(e,r))}}},{key:"ensureToken",value:function(e){this.instances[e]||(this.instances[e]=new Set)}},{key:"getEmbedObjMap",value:function(e){if(!this.instances[e])return{};var t={},n=!0,r=!1,i=void 0;try{for(var s,o=this.instances[e][Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value.getEmbedObjs(),u=!0,c=!1,l=void 0;try{for(var d,h=a[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var f=d.value;t[f.token]=f}}catch(e){c=!0,l=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw l}}}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}},{key:"add",value:function(e,t){this.ensureToken(e),this.instances[e].add(t),this.reroll(e)}},{key:"delete",value:function(e,t){this.ensureToken(e),this.instances[e].delete(t),this.reroll(e)}},{key:"destroyToken",value:function(e){delete this.instances[e]}}]),e}()),_=function(){function i(e){var p=this,t=e.embedObjList,n=e.onPermissionChange,r=e.onError;a()(this,i),this.ready=!1,this.olbEmbedObjPermission=Object(l.Map)({}),this.oldEmbedObjList=[],this.handleStoreChangeForNetworkState=function(){var e=Object(h.a)(y.default.getState());e&&!p.isOnline&&(p.isOnline=e,p.fetchEmbedObjPermissions()),p.isOnline=e},this.handleStoreChangeForPermission=function(){if(p.ready){var e=p.selectEmbedObjPermission();if(e!==p.olbEmbedObjPermission||!Object(g.default)(p.oldEmbedObjList,p.embedObjList)){var n=p.oldEmbedObjList,t=p.olbEmbedObjPermission.filter(function(e,t){return 0<n.filter(function(e){return e.token===t}).length});p.olbEmbedObjPermission=e,p.oldEmbedObjList=p.embedObjList.slice(0);var r=[],i=!0,s=!1,o=void 0;try{for(var a,u=p.embedObjList[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var c,l,d,h=a.value,f=e.get(h.token),b=t.get(h.token);Object(m.a)(f)||(!Object(m.a)(f)&&Object(m.a)(b)||!Object(m.a)(b)&&f.get("permission")!==b.get("permission")||!Object(m.a)(b)&&f.get("userPermissions")!==b.get("userPermissions"))&&(c=f.get("permission"),l=f.get("userPermissions"),d=Object.assign({},h,Object.assign({},f.toJS(),{permission:Object(v.embedObjPermission2Booleans)(c),userPermissions:Object(v.permission2Booleans)(l)})),r.push(d))}}catch(e){s=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}0<r.length&&p.onPermissionChange&&p.onPermissionChange(r)}}else p.checkEnvReady()},this.embedObjList=t&&t.slice(0)||[],this.onPermissionChange=n,r&&(this.onError=r),this.unsubscribePermission=y.default.subscribe(this.handleStoreChangeForPermission),this.unsubscribeNetworkState=y.default.subscribe(this.handleStoreChangeForNetworkState),this.isOnline=Object(h.a)(y.default.getState()),this.checkEnvReady()}function e(e){return t.apply(this,arguments)}var t;return c()(i,[{key:"checkEnvReady",value:function(){var e=y.default.getState(),t=Object(f.n)(e),n=Object(f.o)(e);Object(m.a)(t)||Object(m.a)(n)||(this.ready=!0,this.envInfos={token:t,type:n},this.bootstrap(),this.fetchEmbedObjPermissions())}},{key:"bootstrap",value:function(){E.add(this.envInfos.token,this)}},{key:"fetchEmbedObjPermissions",value:(t=s()(b.a.mark(function e(t){var n,r,i,s,o,a,u,c,l,d,h,f;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ready&&this.isOnline){e.next=2;break}return e.abrupt("return");case 2:n=this.envInfos,r=n.token,i=n.type,o=!(s=!0),a=void 0,e.prev=6,u=this.getSplitedEmbedObjList(t)[Symbol.iterator]();case 8:if(s=(c=u.next()).done){e.next=18;break}return l=c.value,d=l.map(function(e){return{token:e.token,type:e.type}}),h=y.default.dispatch(Object(p.fetchEmbedObjectPermissions)(r,i,d)),f=y.default.dispatch(Object(p.fetchUserPermissionOnEmbedObj)(d,r)),e.next=15,Promise.all([h,f,Object(O.c)(1e3)]);case 15:s=!0,e.next=8;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(6),o=!0,a=e.t0;case 24:e.prev=24,e.prev=25,s||null==u.return||u.return();case 27:if(e.prev=27,o)throw a;e.next=30;break;case 30:return e.finish(27);case 31:return e.finish(24);case 32:case"end":return e.stop()}},e,this,[[6,20,24,32],[25,,27,31]])})),e)},{key:"getSplitedEmbedObjList",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:S;return(e||this.getEmbedObjs()).reduce(function(e,t){return e.slice(-1)[0].length===n&&e.push([]),e.slice(-1)[0].push(t),e},[[]])}},{key:"findEmbedObj",value:function(e,n){var r=-1;return e.forEach(function(e,t){e.token===n.token&&(r=t)}),r}},{key:"selectEmbedObjPermission",value:function(){return this.ready&&Object(d.K)(y.default.getState()).getIn([this.envInfos.token,"embedObjects"])||Object(l.Map)({})}},{key:"fetchEmbedObjsAllPerm",value:function(){this.fetchEmbedObjPermissions()}},{key:"updateEmbedObjList",value:function(e){Object(g.default)(this.embedObjList,e)||(this.removeEmbedObjs(this.embedObjList),this.addEmbedObjs(e))}},{key:"addEmbedObjs",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var a=s.value,u=this.findEmbedObj(this.embedObjList,a);-1===u?(t.push(a),this.embedObjList.push(a)):this.embedObjList[u].title!==a.title&&(this.embedObjList[u]=a,t.push(a))}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}0<t.length&&this.fetchEmbedObjPermissions(t)}},{key:"removeEmbedObjs",value:function(e){var t=[],n=[],r=!0,i=!1,s=void 0;try{for(var o,a=this.embedObjList[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value;-1===this.findEmbedObj(e,u)?t.push(u):n.push(u.token)}}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}this.embedObjList=t,0<n.length&&y.default.dispatch(Object(p.removeEmbedObjects)(this.envInfos.token,n))}},{key:"getEmbedObjs",value:function(){return this.embedObjList}},{key:"getEmbedObjsAllBoolPerm",value:function(){var e=this.selectEmbedObjPermission(),t=this.getEmbedObjs(),n={},r=!0,i=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value,c=e.get(u.token);n[u.token]=c?Object.assign({},c.toJS(),{permission:Object(v.embedObjPermission2Booleans)(c.get("permission")),userPermissions:Object(v.permission2Booleans)(c.get("userPermissions"))}):null}}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}},{key:"getEmbedObjAllBoolPermByToken",value:function(e){var t=this.selectEmbedObjPermission().get(e);return t?Object.assign({},t.toJS(),{permission:Object(v.embedObjPermission2Booleans)(t.get("permission")),userPermissions:Object(v.permission2Booleans)(t.get("userPermissions"))}):null}},{key:"getEmbedObjPermissions",value:function(){var e=this.selectEmbedObjPermission(),t=this.getEmbedObjs(),n={},r=!0,i=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var u=o.value,c=e.get(u.token);n[u.token]=c?Object(v.embedObjPermission2Booleans)(c.get("permission")):null}}catch(e){i=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw s}}return n}},{key:"getPermissionByToken",value:function(e){var t=this.selectEmbedObjPermission().get(e);return t?Object(v.embedObjPermission2Booleans)(t.get("permission")):null}},{key:"getOwnerByToken",value:function(e){var t=this.selectEmbedObjPermission().get(e);return t?t.get("owner"):null}},{key:"destroy",value:function(){this.embedObjList=[],this.unsubscribePermission&&this.unsubscribePermission(),this.unsubscribeNetworkState&&this.unsubscribeNetworkState(),this.ready&&E.delete(this.envInfos.token,this)}}],[{key:"destroyToken",value:function(e){E.destroyToken(e)}}]),i}();n("5f2W");n.d(t,"b",function(){return E});t.a=_},noJd:function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return u});var r=n("lSNA"),i=n.n(r),s=n("jp/M"),o=n("QM+C"),a=function(e){return i()({type:s.actionTypes.common.FETCH_OBJ_SETTINGS},o.REQUEST,{url:s.apiUrls.GET_OBJ_SETTINGS,method:s.apiUrls.METHOD.GET,params:e})},u=function(){return{type:s.actionTypes.common.SET_OBJ_SETTINGS}}},tp5K:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return s}),n.d(t,"c",function(){return o});var r=n("RIqP"),p=n.n(r);function m(e){return void 0===e}function i(t,r,e){var i,s,o=e.maxWait,a=0,u=Date.now,c=[],n=function(){c=null,i=void 0},l=function(e){a=e,c&&t(c),n()},d=function(e){var t=e-s,n=e-a;return m(s)||r<=t||t<0||!m(o)&&o<=n},h=function(e){var t=e-a,n=r-(e-s);return m(o)?n:Math.min(n,o-t)},f=function(){var e=u();if(d(e))return l(e);var t=h(e);i=b(t)},b=function(e){return window.setTimeout(f,e)};return function(e){(c=c||[]).push.apply(c,p()(e));var t=u(),n=d(t);if(s=t,n&&(m(i)&&(a=t,i=b(r)),!m(o)))return window.clearTimeout(i),i=b(r),l(s);m(i)&&(i=b(r))}}function s(e){return Array.from(new Set(e))}function o(e){return e.split("_")[1]}},wOYm:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n("lwsE"),s=n.n(r),i=n("W8MJ"),o=n.n(i);function a(r,i){return new(function(){function e(){s()(this,e),this.services=new Map}return o()(e,[{key:"getOrCreate",value:function(e){var t=i(e),n=this.services.get(t);return n||(n=r(e),this.services.set(t,n)),n}},{key:"destroy",value:function(e){var t=i(e),n=this.services.get(t);n&&n.destroy(),this.services.delete(t)}}]),e}())}},wQna:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n("Vfrr"),i=n("D7h9"),s=n("toa8"),o=n("Q9MD"),a=n("5gS9"),u=n("QM+C"),c=n("wOYm");function l(e){var t=e.suiteType,n=e.suiteToken;return new r.a({serviceType:t,serviceToken:n,engineType:u.NUM_SUITE_TYPE_TO_SUITE_ENGINE_TYPE[t],io:a.b.getInstance(),getRequest:function(){return s.d},getMemberId:function(){return function(){return Object(o.b)(i.default.getState())}}})}var d=Object(c.a)(l,function(e){return"".concat(e.suiteType,":").concat(e.suiteToken)})},wSsa:function(e,t,n){"use strict";n.d(t,"c",function(){return d}),n.d(t,"b",function(){return h}),n.d(t,"a",function(){return f});var r=n("VkAN"),i=n.n(r),s=n("MjSh"),o=n("vOnD"),a=n("qxQb"),u=n.n(a);function c(){var e=i()(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 28px;\n  height: 28px;\n  margin-top: 2px;\n  border-radius: 3px;\n  transition: background-color 0.1s linear;\n\n  &:hover {\n    background-color: ",";\n  }\n  &:active {\n    background-color: ",";\n  }\n"]);return c=function(){return e},e}var l=86400,d=(Date.now(),"bytedance_storage.whats_new_storage_key"),h="suiteCanReady",f=o.default.span(c(),u()(s.N900,.1),u()(s.N900,.15))},xetH:function(e,t,n){"use strict";var r=n("lSNA"),a=n.n(r),i=n("UXvI"),s=n("0X7r"),u=n("D7h9"),o=n("jp/M"),c=function(e){return{type:o.actionTypes.etherpad.UPDATE_DOC_PERMISSION_USER_MAP,payload:e}},l=n("HjLD");function d(){return new s.b({onPermissionChange:function(e){var o={};e.forEach(function(e){var t,n,r,i=e.permission,s=e.userId;i&&(t=i.readable,n=i.editable,h.hasUser(s)&&(o[s]=(r={},a()(r,l.a.Readable,t),a()(r,l.a.Editable,n),r)))}),u.default.dispatch(c(o))},onError:function(e){}})}n.d(t,"a",function(){return h});var h={userMap:{},userPermissionManager:null,createUserPermissionManager:function(){this.userPermissionManager=d()},destroyUserPermissionManager:function(){this.userPermissionManager&&(this.userPermissionManager.destroy(),this.userPermissionManager=null)},recreateUserPermissionManager:function(){this.destroyUserPermissionManager(),this.createUserPermissionManager()},hasUser:function(e){return this.userMap[e]},addUser:function(e){this.userMap[e]?this.userMap[e]++:(this.userMap[e]=1,this.userPermissionManagerUpdateUserList())},removeUser:function(e){this.userMap[e]&&(this.userMap[e]--,0===this.userMap[e]&&this.userPermissionManagerUpdateUserList())},updateUserPerm:function(e){this.userPermissionManager.fetchUserPermissions(e)},userPermissionManagerUpdateUserList:Object(i.default)(function(){var t=this;this.userPermissionManager&&this.userPermissionManager.updateUserList(Object.keys(this.userMap).filter(function(e){return 0<t.userMap[e]}))},300)}}}]);
//# sourceMappingURL=commons--suite--suite_for_3rd.d62f9abb39d0eb3920dc.js.map